function getConstructorName(e){function t(e){var t="function"==typeof e,i=t&&(e.name&&["",e.name]||e.toString().match(/function ([^\(]+)/));return!t&&"not a function"||i&&i[1]||"anonymous"}return void 0===e.name?t(e):e.name}function inherit(e,t){function i(){}var r,n;r=getConstructorName(t.prototype.constructor);var o=getConstructorName(e.prototype.constructor),s=r+"::"+o;if(!(s in copiedPrototypeHash)){copiedPrototypeHash[s]=!0,i.prototype=t.prototype;var a=new i;a.constructor=e;var d=e.prototype;e.prototype=a;var u;for(u in d)e.prototype[u]=d[u];for(u in t.prototype)n=r+"_"+u,e.prototype[n]=t.prototype[u];e.prototype[r]=t.prototype.constructor}}function requireDom(){"nodejs"!==runtimeEnvironment.name||runtimeEnvironment.jsdom||(createBasicMondriaDocument(),window=new DOMWindow(document),navigator={},runtimeEnvironment.jsdom=!0)}function requireSurveyMode(){if(!runtimeEnvironment.surveyMode){var e=getArgParser();"nodejs"===runtimeEnvironment.name?runtimeEnvironment.surveyMode="estimate":e.getArg("surveyMode")?runtimeEnvironment.surveyMode=e.getArg("surveyMode"):runtimeEnvironment.surveyMode=runTests?"estimate":"browser"}}function requireWebSockets(){if(!runtimeEnvironment.newWebSocket){var e;if("browser"===runtimeEnvironment.name){if(e=window.WebSocket||window.MozWebSocket,!e)throw"No WebSockets"}else"nodejs"===runtimeEnvironment.name&&(e=require("websocket").w3cwebsocket);runtimeEnvironment.newWebSocket=function(t,i,r){var n,o;r&&(n=r.headers,o=r.protocols);var s=new e(i,o);return s.onopen=function(){t.openHandler()},s.onerror=function(e){t.errorHandler(e)},s.onmessage=function(e){t.messageHandler(e.data)},s.onclose=function(e){t.closeHandler(e)},t.state=function(){return s.readyState},s}}}function requirePerformanceNow(){"nodejs"!==runtimeEnvironment.name||performance||(performance={now:require("performance-now")},runtimeEnvironment.performance=performance)}function requireBtoaAtob(){"nodejs"===runtimeEnvironment.name&&("undefined"==typeof btoa&&(btoa=function(e){return new Buffer(e||"","base64").toString("ascii")}),"undefined"==typeof atob&&(atob=function(e){return new Buffer(e||"","ascii").toString("base64")}))}function requireFS(){return"nodejs"===runtimeEnvironment.name?(void 0===runtimeEnvironment.fs&&(runtimeEnvironment.fs=require("fs")),runtimeEnvironment.fs):void 0}function requirePath(){return"nodejs"===runtimeEnvironment.name?(void 0===runtimeEnvironment.path&&(runtimeEnvironment.path=require("path")),runtimeEnvironment.path):void 0}function requireXMLHttpRequest(){return"nodejs"===runtimeEnvironment.name?(void 0===runtimeEnvironment.xmlhttprequest&&(runtimeEnvironment.xmlhttprequest=require("xmlhttprequest").XMLHttpRequest),runtimeEnvironment.xmlhttprequest):void 0}function initializeModeDetection(){isJSONSupported="undefined"!=typeof JSON,isSvgweb="undefined"!=typeof svgweb,isSVGSupported="undefined"!=typeof document&&(document.xmlVersion&&"string"==typeof document.xmlVersion||document.URL.match(/xhtml$/))||isSvgweb,svgNS="undefined"!=typeof svgns?svgns:"http://www.w3.org/2000/svg","undefined"!=typeof console&&console.log?(useConsoleLog=!0,"function"==typeof console.log&&console.log.prototype&&console.log.prototype.constructor&&console.log.prototype.constructor.toString().indexOf("[native code]")<0&&(useConsoleLogApply=!0)):"undefined"!=typeof opera&&opera.postError&&(useOperaPostError=!0),"undefined"!=typeof document&&document.body&&document.body.style&&document.body.style.setAttribute&&(useSetAttribute=!0),"undefined"==typeof bowser?userLocale="en-US":bowser.msie?(isInternetExplorer=!0,userLocale=navigator.browserLanguage):(userLocale=navigator.language,void 0===userLocale&&(userLocale="en-US")),runtimeEnvironment.supportsPassiveListeners=!1;try{var e=Object.defineProperty({},"passive",{get:function(){runtimeEnvironment.supportsPassiveListeners=!0}});window.addEventListener("test",null,e)}catch(e){}}function getWindowLocation(){return"undefined"==typeof window?void 0:window.location}function initializeDebugTracingLog(){globalDebugTracingLog=new DebugTracingLog}function debugTracingSetDebugMode(){globalPos.posCalc.doDebugging=!1,globalPos.posCalc.equations.doDebugging=!1,globalPos.posCalc.equations.debugSetDebugMode()}function DebugTracingLog(){this.logs=[],this.maxLogLength=100,this.cyclePriority=void 0,this.section=void 0,this.counters={},this.histograms={}}function debugTracingLogNewCycle(e){if(this.logs[0]){if(void 0!==e&&void 0!==this.cyclePriority&&e<this.cyclePriority)return;this.closeSection(),this.recordStatistics()}if(this.maxLogLength>0)for(;this.logs.length>=this.maxLogLength;)this.logs.pop();(!this.logs[0]||this.logs[0].length>0)&&this.logs.unshift([]),this.counters={},this.histograms={},this.cyclePriority=e}function debugTracingLogPushNextLog(e){if(this.logs[0]||this.newCycle(),this.section)return void this.section.push(e);var t=this.logs[0];t&&t.push(e)}function debugTracingLogOpenSection(e){this.logs[0]||this.newCycle();var t=this.section=[];e&&(t.where=e);var i=this.logs[0];i.push(t)}function debugTracingLogCloseSection(){this.section=void 0}function debugTracingLogMessage(){for(var e="",t=0,i=arguments.length;t<i;++t)arguments[t]!=gBR?"number"==typeof arguments[t]||"string"==typeof arguments[t]?e+=arguments[t]:arguments[t]&&(e+=objToString(arguments[t])):(this.pushNextLog(e),e="     ");e.length>0&&this.pushNextLog(e)}function debugTracingLogIncCounter(e){this.counters[e]?this.counters[e]++:this.counters[e]=1}function debugTracingLogIncHistogramCounter(e,t){this.histograms[e]||(this.histograms[e]={_total:0}),this.histograms[e][t]?this.histograms[e][t]++:this.histograms[e][t]=1,this.histograms[e]._total++}function debugTracingLogRecordStatistics(){isEmptyObj(this.counters)||this.pushNextLog(this.counters),isEmptyObj(this.histograms)||this.pushNextLog(this.histograms),this.counters={},this.histograms={}}function DebugTracing(e,t){this.cyclePriority=e,this.doDebugging=!!t,this.debugLogMessages=!0,this.debugStatistics=!0,this.debugCreateSections=!0}function debugTracingDebugNewCycle(){this.doDebugging&&globalDebugTracingLog.newCycle(this.cyclePriority)}function debugTracingDebugOpenLogSection(e){this.doDebugging&&this.debugCreateSections&&globalDebugTracingLog.openSection(e)}function debugTracingDebugCloseLogSection(){this.doDebugging&&globalDebugTracingLog.closeSection()}function debugTracingDebugPushNextLog(e){this.doDebugging&&globalDebugTracingLog.pushNextLog(e)}function debugTracingDebugMessage(){this.doDebugging&&this.debugLogMessages&&globalDebugTracingLog.message.apply(globalDebugTracingLog,arguments)}function debugTracingDebugIncCounter(e){this.doDebugging&&this.debugStatistics&&globalDebugTracingLog.incCounter(e)}function debugTracingDebugIncHistogramCounter(e,t){this.doDebugging&&this.debugStatistics&&globalDebugTracingLog.incHistogramCounter(e,t)}function debugTracingDebugRecordStatistics(){this.doDebugging&&this.debugStatistics&&globalDebugTracingLog.recordStatistics()}function objToString(e,t,i){return"string"==typeof e?e:isJSONSupported&&!i?JSON.stringify(e):_objToString(e,t,i)}function _objToString(e,t,i){if(!e||"object"!=typeof e)return"function"==typeof e?"<function>":String(e);if("undefined"!=typeof i){if(i<=0)return isArray(e)?"<array>":"<object>";i--}var r;if(isArray(e)){r="[";for(var n=0,o=e.length;n<o;n++)n&&(r+=", "),r+=_objToString(e[n],t,i);return r+="]"}r="{";for(var s in e)t&&"function"==typeof e[s]||(r+=r.length>1?", ":" ",r+=s+": "+_objToString(e[s],t,i));return r+=r.length>1?" }":"}"}function SortedList(){this.iteratorId=1,this.clear()}function sortedListClear(){this.root={subpaths:{}},this.first=null,this.last=null}function sortedListGetNextIteratorId(){return this.iteratorId++}function sortedListGetNode(e,t){if(void 0===e)return this.root;if("object"!=typeof e){if(t)return this.root.subpaths[e];e=[e]}if(!e||!e.length)return this.root;var i=this.root;for(var r in e){if(!i.subpaths[e[r]]){if(t)return;i.subpaths[e[r]]={subpaths:{}}}i=i.subpaths[e[r]]}return i}function sortedListGetEntry(e){var t=this.getNode(e,!0);if(t)return t.entry}function sortedListGetNodePath(e){var t=[this.root],i=this.root;if(void 0===e)return t;for(var r in e){if(!i.subpaths[e[r]])break;i=i.subpaths[e[r]],t.push(i)}return t}function sortedListInsert(e,t,i,r){var n=this.getNode(t);if("entry"in n)return n.entry=e,this.changeNodeSortVal(n,i),n;if(n.entry=e,n.sortVal=i,r){var o=this.last;if(this.modifiedOrdering)for(;o&&this.valLessThan(o.sortVal,i);)o=o.firstSameKey?o.firstSameKey.prev:o.prev;else for(;o&&o.sortVal<i;)o=o.firstSameKey?o.firstSameKey.prev:o.prev;this.insertBefore(n,o?o.next:this.first)}else{var s=this.first;if(this.modifiedOrdering)for(;s&&this.valLessOrEqual(i,s.sortVal);)s=s.lastSameKey?s.lastSameKey.next:s.next;else for(;s&&s.sortVal>=i;)s=s.lastSameKey?s.lastSameKey.next:s.next;this.insertBefore(n,s)}return n}function SortedListChangeSortVal(e,t){var i=this.getNode(e,!0);i&&this.changeNodeSortVal(i,t)}function SortedListChangeNodeSortVal(e,t){if(e){var i,r=!("sortVal"in e),n=e.sortVal;if(r||!this.valsEqual(e.sortVal,t)){if(e.sortVal=t,r)if(i=this.first,this.modifiedOrdering)for(;i&&this.valLessOrEqual(t,i.sortVal);)i=i.lastSameKey?i.lastSameKey.next:i.next;else for(;i&&i.sortVal>=t;)i=i.lastSameKey?i.lastSameKey.next:i.next;else if(this.valLessThan(n,t)){var o=e.prev;if(this.modifiedOrdering)for(;o&&this.valLessThan(o.sortVal,t);)o=o.firstSameKey?o.firstSameKey.prev:o.prev;else for(;o&&o.sortVal<t;)o=o.firstSameKey?o.firstSameKey.prev:o.prev;i=o==e.prev?e.next:o?o.next:this.first}else if(i=e.next,this.modifiedOrdering)for(;i&&this.valLessThan(t,i.sortVal);)i=i.lastSameKey?i.lastSameKey.next:i.next;else for(;i&&i.sortVal>t;)i=i.lastSameKey?i.lastSameKey.next:i.next;i!=e.next&&e.iterators&&this.transferIteratorsToPrevNode(e),this.removeNodeFromList(e),this.insertBefore(e,i)}}}function sortedListRemove(e){var t=void 0;if(void 0!==e){var i;if("object"!=typeof e){if(!this.root.subpaths[e])return;i=[this.root,this.root.subpaths[e]],e=[e]}else if(i=this.getNodePath(e),i.length!=e.length+1)return;var r=e.length;void 0!==i[r].sortVal&&this.removeNodeFromList(i[r]),"entry"in i[r]&&(t=i[r].entry),delete i[r].entry,delete i[r].sortVal;for(;r>=1&&isEmptyObj(i[r].subpaths)&&!("entry"in i[r])&&!("sortVal"in i[r]);)delete i[r-1].subpaths[e[r-1]],--r;return t}}function sortedListRemoveWhenLabelInPath(e,t){var i=this.getNode(t,!0);i&&(this.removeWhenLabelInPathFromNode(e,i),i!=this.root&&(!isEmptyObj(i.subpaths)||"entry"in i||"sortVal"in i||this.remove(t)))}function sortedListRemoveWhenLabelInPathFromNode(e,t){t||(t=this.root),t.subpaths[e]&&(this.removeNodesUnder(t.subpaths[e]),this.removeNodeFromList(t.subpaths[e]),delete t.subpaths[e]);for(var i in t.subpaths)this.removeWhenLabelInPathFromNode(e,t.subpaths[i]),!isEmptyObj(t.subpaths[i].subpaths)||"entry"in t.subpaths[i]||"sortVal"in t.subpaths[i]||delete t.subpaths[i]}function sortedListRemoveNodesUnder(e){if(e)for(var t in e.subpaths){var i=e.subpaths[t];this.removeNodesUnder(i),"sortVal"in i&&this.removeNodeFromList(i),delete e.subpaths[t]}}function sortedListInsertBefore(e,t){e&&((e.prev||e.next)&&this.removeNodeFromList(e),t?(e.prev=t.prev,e.next=t,t.prev?t.prev.next=e:this.first=e,t.prev=e):(this.last?this.last.next=e:this.first=e,e.prev=this.last,e.next=null,this.last=e),e.prev&&this.valsEqual(e.prev.sortVal,e.sortVal)?(e.sameValKey=e.prev.sameValKey-1,e.prev.firstSameKey?(e.firstSameKey=e.prev.firstSameKey,e.firstSameKey.lastSameKey=e,delete e.prev.firstSameKey):(e.firstSameKey=e.prev,e.prev.lastSameKey=e)):e.next&&this.valsEqual(e.next.sortVal,e.sortVal)?(e.sameValKey=e.next.sameValKey+1,e.next.lastSameKey?(e.lastSameKey=e.next.lastSameKey,e.lastSameKey.firstSameKey=e,delete e.next.lastSameKey):(e.lastSameKey=e.next,e.next.firstSameKey=e)):e.sameValKey=0)}function sortedListRemoveNodeFromList(e){e&&"undefined"!=typeof e.next&&"undefined"!=typeof e.prev&&(e.iterators&&this.transferIteratorsToPrevNode(e),e.lastSameKey?(e.lastSameKey==e.next?delete e.next.firstSameKey:(e.lastSameKey.firstSameKey=e.next,e.next.lastSameKey=e.lastSameKey),delete e.lastSameKey):e.firstSameKey&&(e.firstSameKey==e.prev?delete e.prev.lastSameKey:(e.firstSameKey.lastSameKey=e.prev,e.prev.firstSameKey=e.firstSameKey),delete e.firstSameKey),e.next?e.next.prev=e.prev:this.last=e.prev,e.prev?e.prev.next=e.next:this.first=e.next,delete e.prev,delete e.next)}function sortedListTransferIteratorsToPrevNode(e){if(e.iterators){var t,i=e.prev;i&&!(t=i.iterators)&&(t=i.iterators={});for(var r in e.iterators){var n=e.iterators[r];t&&(t[r]=n),n.node=i}delete e.iterators}}function sortedListIsEmpty(){return null===this.first}function sortedListIsBoforePos(e,t){var i=this.getNode(e,!0);return!!(i&&"entry"in i)&&(!t||(!!this.valLessThan(t.sortVal,i.sortVal)||!this.valLessThan(i.sortVal,t.sortVal)&&i.sameValKey>t.sameValKey))}function sortedListIsAfterPos(e,t){var i=this.getNode(e,!0);return!!(i&&"entry"in i)&&(!!t&&(!!this.valLessThan(i.sortVal,t.sortVal)||!this.valLessThan(t.sortVal,i.sortVal)&&t.sameValKey>i.sameValKey))}function sortedListPositionCompare(e,t){return this.valLessThan(t.sortVal,e.sortVal)?-1:this.valLessThan(e.sortVal,t.sortVal)?1:t.sameValKey<e.sameValKey?-1:e.sameValKey<t.sameValKey?1:0}function sortedListPathPositionCompare(e,t){var i=this.getNode(e,!0);if(i&&"entry"in i)return this.positionCompare(i,t)}function sortedListValsEqual(e,t){return e==t}function sortedListValLessThan(e,t){return e<t}function sortedListValLessOrEqual(e,t){return e<=t}function sortedListDebugPrint(){if(this.first){console.log("sorted list:");for(var e=this.first;e;e=e.next)console.log("sortVal: ",objToString(e.sortVal)," sameValKey: ",e.sameValKey," entry: ",objToString(e.entry),"firstSameKey: ",e.firstSameKey?objToString(e.firstSameKey.entry):"undefined","lastSameKey: ",e.lastSameKey?objToString(e.lastSameKey.entry):"undefined")}else console.log("sorted list: empty")}function SortedListIter(e){this.sortedList=e,this.id=e.getNextIteratorId(),this.node=null,this.atEnd=!1}function sortedListIterDestroy(){this.node&&(delete this.node.iterators[this.id],this.node=null),this.atEnd=!0}function sortedListIterNext(){if(this.node)delete this.node.iterators[this.id],this.node=this.node.next;else{if(this.atEnd)return null;this.node=this.sortedList.first}return this.node?(this.node.iterators||(this.node.iterators={}),this.node.iterators[this.id]=this):this.atEnd=!0,this.node}function sortedListIterGetNode(){return this.node}function PairSortedList(){this.SortedList(),this.modifiedOrdering=!0}function pairSortedListValsEqual(e,t){return e[0]==t[0]&&e[1]==t[1]}function pairSortedListValLessThan(e,t){return e[0]<t[0]||e[0]==t[0]&&e[1]<t[1]}function pairSortedListValLessOrEqual(e,t){return e[0]<t[0]||e[0]==t[0]&&e[1]<=t[1]}function getArgParser(){return void 0===gArgParser&&(gArgParser="undefined"==typeof process||"undefined"==typeof process.argv?new UrlArgParser(window.location.search.substring(1)):new ArgvParser(process.argv)),gArgParser}function addProfileParameters(e){try{var t=(new StringParseCDLValue).parse(packageParameters_str).tree.result;if("object"==typeof t)for(var i in t)e[i]=t[i];if(t=(new StringParseCDLValue).parse(profileParameters_str).tree.result,"object"==typeof t)for(var i in t)e[i]=t[i]}catch(e){}}function ArgvParser(e){this.argv=e,this.parsed={},this.unparsed=[],this.appName=e[1];for(var t=0;t<e.length;t++){var i=e[t];if("--"===i){this.unparsed.push.apply(this.unparsed,e.slice(t+1));break}var r=i.indexOf("=");if(r>0){var n=i.substring(0,r),o=i.substring(r+1);this.parsed[n]=argvConvertString(o)}else this.unparsed.push(i)}addProfileParameters(this.parsed)}function argvConvertString(e){return"true"===e||"false"!==e&&(""===e||isNaN(Number(e))?e:Number(e))}function argvParserGetArg(e,t){return e in this.parsed?this.parsed[e]:t}function argvParserHasArg(e){return e in this.parsed}function argvParserGetArgv(){return this.unparsed}function argvParserGetRawArgv(){return this.argv()}function argvParserGetArgList(){return Object.keys(this.parsed)}function argvParserGetAppName(){return this.appName}function UrlArgParser(e){if(this.queryString=e,this.queryList=this.queryString.split("&"),this.appName=void 0,"undefined"!=typeof window&&"undefined"!=typeof window.location){var t=window.location.href,i=t.indexOf("?");i>=0&&(t=t.slice(0,i)),this.appName=t}this.variable={};for(var r=0;r<this.queryList.length;r++){var n=this.queryList[r],o=n.split("="),s=decodeURIComponent(o[0]),a=decodeURIComponent(o[1]);this.variable[s]=argvConvertString(a)}addProfileParameters(this.variable)}function urlArgParserGetArg(e,t){return e in this.variable?this.variable[e]:t}function urlArgParserHasArg(e){return e in this.variable}function urlArgParserGetArgv(){return[]}function urlArgParserGetRawArgv(){return[]}function urlArgParserGetArgList(){return Object.keys(this.variable)}function urlArgParserGetAppName(){return this.appName}function IdMgr(){this.nextMax=0,this.freeIds=[],this.idCount=0}function idMgrAllocate(){return this.idCount++,this.freeIds.length?this.freeIds.pop():this.nextMax++}function idMgrFree(e){this.idCount--,this.freeIds.push(e)}function idMgrCount(){return this.idCount}function mhelp(){var e=window.open("https://docs0.google.com/a/agora-mobile.com/document/edit?id=1ZfgB-F0OeRwuNc-tDz3E8F1SF5gAdSzt1CWmuPlz0lg#","Mondria Help");e.focus()}function initializeDebugging(){initDebugObjMgr(),initializeDebugTiming(),initializeDebugTracingLog(),gProfiling&&initProfiling()}function mLogger(e,t,i){if(!isArray(ConsoleLogAttributes[e]))return void mMessage("Cannot log type:"+e+" - "+objToString(ConsoleLogAttributes[e]));var r=ConsoleLogAttributes[e][0];if(!(t>r)){switch(e){case"constraints":if(r<2&&i.indexOf("MondriaPointer_To_ScreenArea")>=0)return}var n=ConsoleLogAttributes[e][1];if(n!=prevConsoleLogAttributeFilter[e])if(prevConsoleLogAttributeFilter[e]=n,"string"==typeof n){var o=n.length;"/"==n[0]&&o>=2&&"/"==n[o-1]&&(compiledConsoleLogAttributesFilters[e]=new RegExp,compiledConsoleLogAttributesFilters[e].compile(n.substr(1,o-2)))}else delete compiledConsoleLogAttributesFilters[e];var s=compiledConsoleLogAttributesFilters[e];s&&!s.test(i)||mMessage(i)}}function mDebug(){doDebugging&&(maxDebugCount>0&&debugCounter>=maxDebugCount||(debugCounter++,mMessage.apply(null,arguments),debugCounter==maxDebugCount&&mMessage("Stopping debug messages: limit reached")))}function AssertException(e){this.message=e}function assert(e,t){if(!e)throw mMessage(t),console.trace(t),new AssertException(t)}function assertTrue(e,t){assert(!!e,t)}function assertFalse(e,t){assert(!e,t)}function debugCountPosVariables(){var e=0;for(var t in globalPos.posCalc.variables)e++;return e}function debugCountPosEqVariables(){return globalPos.posCalc.equations.equations.baseSet.componentIndex.size}function debugCountPosPairIds(){var e=0,t={},i=0,r=0,n=0,o=0,s=0,a=new RegExp("("+areaBaseId+"\\d+)","g"),d=new RegExp(areaBaseId+"\\d+rv"+areaBaseId+"\\d+"),u=globalPos.posCalc.pairEquations.edgeById;for(var h in u){e++,d.test(h)&&i++;for(var l=0;;){var c=a.exec(h);if(!a.lastIndex)break;l++,debugAllAreas[c[1]]||(t[c[1]]=!0)}l<2&&s++,u[h].inForest&&o++,u[h].isNormal&&n++,u[h].isWatched&&r++}var p=0;for(var f in t)p++;var v={pairNumber:e,unknownAreasInPairs:p,failedToMatch:s,relativeVisibility:i,inForest:o,isNormal:n,isWatched:r};return v}function debugPosEqCount(){var e={},t=globalPos.posCalc.equations.equations.baseSet.vectors,i=0;e.equationCount=0;for(var r in t){e.equationCount++;for(var n in t[r])i++}e.equationCount?e.baseSetAverageVarsPerEq=i/e.equationCount:e.baseSetAverageVarsPerEq=0;var o=globalPos.posCalc.equations.equations.combinationSet.vectors;i=0;for(var r in o)for(var n in o[r])i++;return e.equationCount?e.combSetAverageVarsPerEq=i/e.equationCount:e.combSetAverageVarsPerEq=0,e}function binarySearch(e,t,i,r,n,o){r="undefined"==typeof r?0:r,n="undefined"==typeof n?e.length-1:n;var s,a=0;if(r>n)return-1;for(;r<n;)if(a=Math.floor((n+r)/2),s=i(e[a],t,o),s<0)r=a+1;else{if(!(s>0))return a;n=a-1}return s=i(e[r],t,o),s<0?-(r+2):s>0?-(r+1):r}function binarySearch2(e,t,i,r,n){r=void 0===r?0:r,n=void 0===n?e.length-1:n;for(var o=r-1,s=n+1;o+1<s;){for(var a=Math.floor((o+s)/2),d=a;a>o&&void 0===e[a];)a--;void 0===e[a]||i(e[a],t)<0?o=d:s=a}return o+1}function cconcat(e,t){return t.length<1e4?(Array.prototype.push.apply(e,t),e):e.concat(t)}function alignArrays(e,t,i,r){var n=t.length;if(void 0===r&&(r=[]),0===n)return r;for(var o=0,s=0,a=e.length;s<a;++s)if(e[s]===t[o]&&(r[s]=i[o],++o>=n))return r;return r}function mergeArraysOfArrays(e,t){if(void 0===e)return t;if(void 0===t)return e;for(var i=e.length<t.length,r=i?e:t,n=i?t:e,o=0,s=r.length;o<s;++o){var a=r[o];if(void 0!==a){var d=n[o];if(void 0===d||0===d.length)n[o]=a;else if(0===a.length)continue;n[o]=cconcat(d,a)}}return n}function debugPPIAInfo(e){var t=EventQueue.debugPPIAInfo.map(shallowCopy);void 0===e&&(e=globalTaskQueue.pendingTasks.isEmpty(),e||console.warn("not forcing evaluation of inactive expressions")),resetDebugObjCache(),gDebugObjMgr.init();for(var i=0;i<t.length;i++)void 0!==allAreaMonitor.getAreaById(t[i].areaId)&&(t[i].A_=gDebugObjMgr.getArea(t[i].areaId,e));return t}function initDebugObjCache(){debugObjCache=!0,gDebugObjMgr.initCache()}function resetDebugObjCache(){gDebugObjMgr.resetCache()}function initDebugObjMgr(){gDebugObjMgr=new DebugObjMgr}function DebugObjMgr(){this.embeddingDepth=0,this.syncCount=0}function allConstraints(){var e=[];debugObjCache||initDebugObjCache(),gDebugObjMgr.init();for(var t in gDebugObjMgr.constraints.pointsArr){var i=gDebugObjMgr.constraints.pointsArr[t];for(var r in i)"Cycles"!==r&&"Violations"!==r&&e.push(r)}return e.sort().join("\n")}function A_(e,t){function i(e,i){if("p1"===e){var r=shallowCopy(gDomEvent.pointerObj);return r.constraints=gDebugObjMgr.constraints.getConstraintOfArea("p1"),r}var n=allAreaMonitor.getAreaById(e);if(!n)return void(e&&mMessage("no such area: '"+e+"'"));var o=gDebugObjMgr.getArea(e,t);if(i){var s=debugObjAbsAreaPosition(n);gDebugObjMgr.drawFrame(!0,e,o.classes,s)}return o}if(void 0===e)return gDebugObjMgr.drawFrame(!1),[];if(void 0===t&&(t=globalTaskQueue.pendingTasks.isEmpty(),t||console.warn("not forcing evaluation of inactive expressions")),resetDebugObjCache(),gDebugObjMgr.init(),gDebugObjMgr.constraints.violationMessageList.length>0){console.groupCollapsed("%c%d constraint violations","font-weight: 500;",gDebugObjMgr.constraints.violationMessageList.length);for(var r=0;r<gDebugObjMgr.constraints.violationMessageList.length;r++)console.log(gDebugObjMgr.constraints.violationMessageList[r]);console.groupEnd()}var n=!1;e instanceof Array?e.every(function(e){return"string"==typeof e||"number"==typeof e})||(e=ensureOS(I(e)),n=!0):e=[e];for(var o=[],r=0;r<e.length;r++){var s=e[r];switch(typeof s){case"string":;s.match(/^@[0-9]+:[0-9]+$/)?o.push(i(s.slice(1),!1)):!n&&s.match(/^[0-9]+:[0-9]+$/)?o.push(i(s,!0)):"p1"===s&&o.push(i(s,!0))}}return 0===o.length?void 0:1===o.length?o[0]:o}function a_(e){return allAreaMonitor.allAreas[e]}function ae_(e,t,i){var r=allAreaMonitor.allAreas[e];if(void 0===r)return void console.log("no such area:",e);if("number"==typeof t)return r.evaluationNodes[0][t];var n=debugAreaInfo[r.template.id].context,o=n[t];return void 0===o?void console.log("no such attribute:",t):r.getExprByFNRef(o,i)}function Ac_(e,t,i){var r,n,o;if(void 0===t&&(t=globalTaskQueue.pendingTasks.isEmpty()),resetDebugObjCache(),gDebugObjMgr.init(),"number"==typeof e)r=allAreaMonitor.getAllAreaIds().filter(function(t){return allAreaMonitor.getAreaById(t).template.id==e}),r.map(function(e){var t=allAreaMonitor.getAreaById(e);gDebugObjMgr.drawFrame(!0,e,"",debugObjAbsAreaPosition(t))});else{if("string"!=typeof e)return void mMessage("please provide a string class specifier");r=[],n=allAreaMonitor.getAllAreaIds(),o=null===e.match(/[^a-zA-Z0-9_]/)?void 0:new RegExp(e),gDebugObjClassesInactive=0;for(var s=0;s!=n.length;s++){var a,d=n[s],u=allAreaMonitor.getAreaById(d);if(void 0===o)debugObjAreaOfClass(u,e,t)&&(a=debugObjAbsAreaPosition(u),gDebugObjMgr.drawFrame(!0,d,[e],a),r.push(d));else{var h=debugObjClasses(u,t);for(var l in h)if(o.test(l)){a=debugObjAbsAreaPosition(u),gDebugObjMgr.drawFrame(!0,d,Object.keys(h),a),r.push(d);break}}}gDebugObjClassesInactive>0&&console.warn("warning:",gDebugObjClassesInactive,"areas with inactive class function")}return 1!==r.length||i?r:A_(r[0],t)}function S_(e,t,i){var r=!1;if(void 0===i&&(i=globalTaskQueue.pendingTasks.isEmpty(),i||console.warn("not forcing evaluation of inactive expressions")),void 0===e)return gDebugObjMgr.drawFrame(!1),[];e instanceof Array?e.every(function(e){return"string"==typeof e||"number"==typeof e})||(e=ensureOS(I(e)),r=!0):e=[e];for(var n=[],o=0;o<e.length;o++){var s=e[o];switch(typeof s){case"number":r||(n=n.concat(allAreaMonitor.getAllAreaIds().filter(function(e){return allAreaMonitor.getAreaById(e).template.id===s})));break;case"string":s.match(/^@[0-9]+:[0-9]+$/)?n.push(s.slice(1)):!r&&s.match(/^[0-9]+:[0-9]+$/)?n.push(s):r||(n=n.concat(allAreaMonitor.getAllAreaIds().filter(function(e){var t=allAreaMonitor.getAreaById(e);return debugObjAreaOfClass(t,s,i)})))}}t=mergeConst(t,{borderStyle:""});for(var o=0;o<n.length;o++){var a=n[o],d=allAreaMonitor.getAreaById(a);if(void 0!==d){var u=debugObjAbsAreaPosition(d);gDebugObjMgr.drawFrame(!0,a,"",u,t)}}return n}function Attr_(e,t){var i;if(e instanceof Array){for(var r={},n=0;n<e.length;n++)i=allAreaMonitor.getAreaById(e[n]),i?r[e[n]]=i.debugGetContextLabelValue(t):e&&mMessage("no such area: '"+e+"'");return r}return i=allAreaMonitor.getAreaById(e),i?i.debugGetContextLabelValue(t):void(e&&mMessage("no such area: '"+e+"'"))}function Attrc_(e,t,i){void 0===i&&(i=globalTaskQueue.pendingTasks.isEmpty());for(var r=Ac_(e,i,!0),n={},o=t instanceof Array?t:[t],s=0;s<r.length;s++){for(var a=r[s],d={},u=!1,h=0;h<o.length;h++){var l=o[h],c=ae_(a,l,i);void 0!==c&&(d[l]=stripArray(c.result.value,!0),u=!0)}u&&(n[a]=1===o.length?d[o[0]]:d)}return n}function DebugObj(){this.currentArea={},this.currentAreaID=void 0,this.areasUnderCursorArr=void 0}function DebugObjArea(e,t,i){this.areaID=e;var r=allAreaMonitor.getAreaById(e);if(r){gDebugObjMgr.allDebugObjAreas[e]={nesting:gDebugObjMgr.embeddingDepth,obj:this},this.tAreaId=r.tAreaId,this.embedding=debugObjEmbedding(r);var n=debugObjEmbeddingStar(r);this.embeddingStar=n.map(function(t,i){return t+"."+allAreaMonitor.getAreaById(0===i?e:n[i-1]).template.childName}),r.display&&(this.display=r.display.descriptionDisplay),r.zArea&&(this.zIndex=r.zArea.zIndexStatus+":"+(""===r.zArea.zIndex?'""':r.zArea.zIndex)),this.areaObj=r,this.explanation=r.explain(t),this.name="","context"in this.explanation&&r.debugAddContext(this,t),this.classes=getClassesForArea(r,t),this.constraints=gDebugObjMgr.constraints.getConstraintOfArea(e),gDebugObjMgr.constraints.visualizeConstraints(this.constraints),i||(this.embedded=debugObjEmbedded(r,t),this.position=debugObjAbsAreaPosition(r),r.isIntersection()&&(this.intersection={},this.intersection.referredArea=debugObjReferredArea(r),this.intersection.expressionArea=debugObjExpressionArea(r),this.intersection.summary=debugObjSummaryLine(r)))}}function getClassesForArea(e,t){var i={watcherId:getNextWatcherId(),dataSourceAware:!0,totalUpdateInputTime:0,attributedTime:0,updateInput:function(e,t){},debugName:function(){return"debugObjAreaOfClassWatcher"},getDebugOrigin:function(){return[]},isDeferred:function(){return!1},defer:function(){},undefer:function(){},isActive:function(){return!0},isReady:function(){return!0}};if(e.exports&&0 in e.exports){var r=[],n=[];for(var o in e.exports[0].inputByAttr){var s=e.exports[0].inputByAttr[o];if(t&&!s.isActive()&&t){try{s.forceActive(i)||console.log("node not evaluated on time:",s.prototype.idStr())}catch(e){Utilities.warn(e.toString())}s.deactivate(i)}isTrue(s.result.value)?r.push({className:(s.isActive()||t?"":"?")+o,prio:e.template.classNamePrio[o]}):n.push((s.isActive()||t?"":"?")+"*"+o)}return r.sort(function(e,t){return e.prio-t.prio}),n.sort(),r.map(function(e){return e.className}).concat(n)}return[]}function debugObjEmbedded(e,t){var i,r=e.getEmbeddedAreaList();gDebugObjMgr.embeddingDepth++;for(var n=0;n!==r.length;n++){var o=r[n];i||(i={});var s;s=gDebugObjMgr.embeddingDepth>0?o.areaId:gDebugObjMgr.getArea(o.areaId,t),i[o.comment?o.areaId+"("+o.comment+")":o.areaId]=s}return gDebugObjMgr.embeddingDepth--,i}function debugObjAbsAreaPosition(e){if(e instanceof DisplayArea){var t=e.relative,i=t.top,r=t.left,n=t.height,o=t.width,s=e.getOffsets();"left"in s&&(i+=s.top,r+=s.left);for(var a=t.embedding;a;a=a.relative.embedding){var s=a.getOffsets();"left"in s&&(i+=s.top,r+=s.left),i+=a.relative.top,r+=a.relative.left}var d={absTop:i,absLeft:r,relTop:t.top,relLeft:t.left,height:n,width:o,zIndex:e.getZ()};return e.contentPos&&(d.relContentTop=e.contentPos.top,d.absContentTop=i+e.contentPos.top,d.relContentLeft=e.contentPos.left,d.absContentLeft=r+e.contentPos.left,d.contentHeight=e.contentPos.height,d.contentWidth=e.contentPos.width),d}}function debugObjReferredArea(e){return e&&e.intersectionChain.referredArea.areaId}function debugObjExpressionArea(e){return e&&e.intersectionChain.expressionArea.areaId}function debugObjSummaryLine(e){if(e){var t=getLCE(e.intersectionChain.expressionArea,e.intersectionChain.referredArea),i="Expression="+e.intersectionChain.expressionArea.areaId+", Referred="+e.intersectionChain.referredArea.areaId+", commonEmbedding="+t.id+", Embedding="+(e.relative&&e.relative.embedding?e.relative.embedding.areaId:"None");return i}}function debugObjClasses(e,t){var i={},r={watcherId:getNextWatcherId(),dataSourceAware:!0,totalUpdateInputTime:0,attributedTime:0,updateInput:function(e,t){},debugName:function(){return"debugObjAreaOfClassWatcher"},getDebugOrigin:function(){return[]},isDeferred:function(){return!1},defer:function(){},undefer:function(){},isActive:function(){return!0},isReady:function(){return!0}};if(void 0!==e.exports&&"0"in e.exports){if(void 0===e.exports[0]){if(!t)return void gDebugObjClassesInactive++;e.getExport(0)}for(var n in e.exports[0].inputByAttr){var o=e.exports[0].inputByAttr[n];if(t){if(!o.isActive()&&t){try{o.forceActive(r)||console.log("node not evaluated on time:",o.prototype.idStr())}catch(e){Utilities.warn(e.toString())}o.deactivate(r)}}else 0===o.nrActiveWatchers&&gDebugObjClassesInactive++;var s=o.result.value;isTrue(s)&&(i[n]=!0)}}return i}function printAllExpressions(e){function t(e,i,r,n){""===e&&console.log("For area "+i+" <"+n+">");for(var o=0;o<r.length;o++){var s=r[o];if(s&&console.log(e+s.prototype.idStr()+"#"+s.watcherId+":",s.prototype.toString(),"active="+s.nrActiveWatchers,"value="+vstringifyLim(s.result.value,100),s.__proto__.constructor.name),s instanceof EvaluationApply||s instanceof EvaluationMap||s instanceof EvaluationFilter||s instanceof EvaluationMultiQuery)if(void 0!==s.environment)t(e+"    ",i,s.environment.cache,n);else if(void 0!==s.environments)for(var a=0;a<s.environments.length;a++)t(e+"    ",i,s.environments[a].cache,n)}}var i;if(0===e||"global"===e)t("","global",globalEvaluationNodes,"");else if(void 0!==e){var i=allAreaMonitor.allAreas[e];t("",e,i.evaluationNodes[0],i.tAreaId)}else{t("","global",globalEvaluationNodes);for(e in allAreaMonitor.allAreas)i=allAreaMonitor.allAreas[e],t("",e,i.evaluationNodes[0],i.tAreaId)}}function printAllExpressionsOfType(e){function t(i,r){for(var n=!1,o="",s=0;s<r.length;s++){var a=r[s];if(a&&a.debugName()===e&&(n||(n=!0),o+=i+" "+a.prototype.idStr()+" "+a.prototype.toString()+" active="+a.nrActiveWatchers+" value="+vstringifyLim(a.result.value,100)+"\n"),a instanceof EvaluationApply||a instanceof EvaluationMap||a instanceof EvaluationFilter||a instanceof EvaluationMultiQuery)if(void 0!==a.environment)t(i,a.environment.cache);else if(void 0!==a.environments)for(var d=0;d<a.environments.length;d++)t(i,a.environments[d].cache)}return o}var i,r;r=t("global",globalEvaluationNodes);for(areaId in allAreaMonitor.allAreas)i=allAreaMonitor.allAreas[areaId],r+=t(areaId,i.evaluationNodes[0]);
return r}function printHierarchy(e,t){function i(e,t){var i=allAreaMonitor.getAreaById(e.getElement()),r=i.comment.slice(i.comment.lastIndexOf(":")+1),n=allAreaMonitor.getAreaById(t.getElement()),o=n.comment.slice(n.comment.lastIndexOf(":")+1);return r<o?-1:r>o?1:i.areaId<n.areaId?-1:1}e||(e="1:1"),t||(t="");var r=allAreaMonitor.getAreaById(e),n=areaRelationMonitor.getRelation(e,"embedded"),o=t+"area "+e+"("+r.tAreaId+") "+r.comment;r.intersectionChain&&(o+=" expression="+areaRelationMonitor.getExpressionId(e).getElement()+" referred="+areaRelationMonitor.getReferredId(e).getElement());var s=r.getZAreaRep();s&&(o+=" z="+s.zIndex),console.log(o),n.sort(i);for(var a=0;a!==n.length;a++){var d=n[a].getElement();printHierarchy(d,t+"  ")}}function exprStatPerArea(){function e(t,i,r){assert(i);for(var n=0;n<i.length;n++){var o=i[n];if(o&&(r.nrInstances++,r.nrUpdates+=o.nrCallsToUpdate,r.nrEvals+=o.nrCallsToEval,r.nrTimesChanged+=o.nrCallsToEval,r.totalEvalTime+=o.totalEvalTime,r.totalInformWatchersTime+=o.totalInformWatchersTime,r.totalUpdateInputTime+=o.totalUpdateInputTime,r.totalAttributedTime+=o.totalAttributedTime,r.nrQueueResets+=o.nrQueueResets,o instanceof EvaluationApply||o instanceof EvaluationMap||o instanceof EvaluationFilter||o instanceof EvaluationMultiQuery))if(void 0!==o.environment)e(t,o.environment.cache,r);else if(void 0!==o.environments)for(var s=0;s<o.environments.length;s++)e(t,o.environments[s].cache,r)}}var t,i={global:{id:"global",nrInstances:0,nrUpdates:0,nrEvals:0,nrTimesChanged:0,totalEvalTime:0,totalInformWatchersTime:0,totalUpdateInputTime:0,totalAttributedTime:0,nrQueueResets:0}};e("global",globalEvaluationNodes,i.global);for(var r in allAreaMonitor.allAreas){t=allAreaMonitor.allAreas[r],i[r]={id:r,tid:t.tAreaId,nrInstances:0,nrUpdates:0,nrEvals:0,nrTimesChanged:0,totalEvalTime:0,totalInformWatchersTime:0,totalUpdateInputTime:t.totalUpdateInputTime,totalAttributedTime:t.attributedTime,nrQueueResets:0},e(t.tAreaId,t.evaluationNodes[0],i[r]);for(var n in t.children){var o=t.children[n];i[r].totalUpdateInputTime+=o.totalUpdateInputTime,i[r].totalAttributedTime+=o.attributedTime}}return"id\ttId\tnrInstances\tnrUpdates\tnrEvals\tnrTimesChanged\tevalTime\tinformWatchersTime\tupdateInputTime\tattributedTime\tnrQueueResets\n"+objValues(i).map(function(e){return e.id+"\t"+e.tid+"\t"+e.nrInstances+"\t"+e.nrUpdates+"\t"+e.nrEvals+"\t"+e.nrTimesChanged+"\t"+e.totalEvalTime+"\t"+e.totalInformWatchersTime+"\t"+e.totalUpdateInputTime+"\t"+e.totalAttributedTime+"\t"+e.nrQueueResets}).join("\n")}function exprStatAreaAttributedTime(){function e(t,i){var r,n,o=i.attributedTime+i.totalUpdateInputTime,s=o,a=void 0;for(var d in i.writes){var u=i.writes[d];for(var h in u.whenBecomesTrue){var l=u.whenBecomesTrue[h];o+=l.attributedTime,o+=l.totalUpdateInputTime,void 0!==l.mergeExpression&&(o+=l.mergeExpression.attributedTime,o+=l.mergeExpression.totalUpdateInputTime),void 0!==l.toExpression&&(o+=l.toExpression.attributedTime,o+=l.toExpression.totalUpdateInputTime)}for(var h in u.whenBecomesFalse){var l=u.whenBecomesFalse[h];o+=l.attributedTime,o+=l.totalUpdateInputTime,void 0!==l.mergeExpression&&(o+=l.mergeExpression.attributedTime,o+=l.mergeExpression.totalUpdateInputTime),void 0!==l.toExpression&&(o+=l.toExpression.attributedTime,o+=l.toExpression.totalUpdateInputTime)}}for(var c in i.children){var p=i.children[c];o+=p.totalUpdateInputTime+p.attributedTime,r=void 0,n=0;for(var f in p.identifier2area){var v=p.identifier2area[f];void 0===r&&(r={}),n+=e(r,v)}for(var g=0;g<p.children.length;g++){var v=p.children[g];void 0===a&&(a={}),void 0===r&&(r={}),n+=e(r,v)}s+=n,void 0===a&&(a={}),a[c+" "+n.toFixed(0)]=r}return t[i.areaId+" "+o.toFixed(0)+" "+s.toFixed(0)]=a,s}var t={};return e(t,allAreaMonitor.allAreas[gPaidMgr.getScreenAreaId()]),t}function exprStatPerTemplate(){function e(t,i,r){assert(i);for(var n=0;n<i.length;n++){var o=i[n];if(o&&(r.nrInstances++,r.nrUpdates+=o.nrCallsToUpdate,r.nrEvals+=o.nrCallsToEval,r.nrTimesChanged+=o.nrCallsToEval,r.totalEvalTime+=o.totalEvalTime,r.totalInformWatchersTime+=o.totalInformWatchersTime,r.totalUpdateInputTime+=o.totalUpdateInputTime,r.totalAttributedTime+=o.totalAttributedTime,r.nrQueueResets+=o.nrQueueResets,o instanceof EvaluationApply||o instanceof EvaluationMap||o instanceof EvaluationFilter||o instanceof EvaluationMultiQuery))if(void 0!==o.environment)e(t,o.environment.cache,r);else if(void 0!==o.environments)for(var s=0;s<o.environments.length;s++)e(t,o.environments[s].cache,r)}}var t={global:{id:"global",nrAreas:0,nrInstances:0,nrUpdates:0,nrEvals:0,nrTimesChanged:0,totalEvalTime:0,totalInformWatchersTime:0,totalUpdateInputTime:0,totalAttributedTime:0,nrQueueResets:0}};e("global",globalEvaluationNodes,t.global);for(var i in allAreaMonitor.allAreas){var r,n=allAreaMonitor.allAreas[i];n.template.id in t?(r=t[n.template.id],r.nrAreas++):r=t[n.template.id]={id:n.template.id,nrAreas:1,nrInstances:0,nrUpdates:0,nrEvals:0,nrTimesChanged:0,totalEvalTime:0,totalInformWatchersTime:0,totalUpdateInputTime:0,totalAttributedTime:0,nrQueueResets:0},e(n.tAreaId,n.evaluationNodes[0],r)}return"template\tnrAreas\tnrInstances\tnrUpdates\tnrEvals\tnrTimesChanged\tevalTime\tinformWatchersTime\tupdateInputTime\tattributedTime\tnrQueueResets\n"+objValues(t).map(function(e){return e.id+"\t"+e.nrAreas+"\t"+e.nrInstances+"\t"+e.nrUpdates+"\t"+e.nrEvals+"\t"+e.nrTimesChanged+"\t"+e.totalEvalTime+"\t"+e.totalInformWatchersTime+"\t"+e.totalUpdateInputTime+"\t\t"+e.totalAttributedTime+"\t"+e.nrQueueResets}).join("\n")}function exprStatPerType(){function e(t){for(var r=0;r<t.length;r++){var n=t[r];if(n){var o=n.constructor.name;if(n instanceof EvaluationFunctionApplication&&(o=n.bif.name),o in i?(i[o].nrInstances++,i[o].nrUpdates+=n.nrCallsToUpdate,i[o].nrEvals+=n.nrCallsToEval,i[o].nrTimesChanged+=n.nrCallsToEval,i[o].totalEvalTime+=n.totalEvalTime,i[o].totalInformWatchersTime+=n.totalInformWatchersTime,i[o].totalUpdateInputTime+=n.totalUpdateInputTime,i[o].totalAttributedTime+=n.totalAttributedTime,i[o].nrQueueResets+=n.nrQueueResets):i[o]={id:o,nrInstances:1,nrUpdates:n.nrCallsToUpdate,nrEvals:n.nrCallsToEval,nrTimesChanged:n.nrTimesChanged,totalEvalTime:n.totalEvalTime,totalInformWatchersTime:n.totalInformWatchersTime,totalUpdateInputTime:n.totalUpdateInputTime,totalAttributedTime:n.totalAttributedTime,nrQueueResets:n.nrQueueResets},n instanceof EvaluationApply||n instanceof EvaluationMap||n instanceof EvaluationFilter||n instanceof EvaluationMultiQuery)if(void 0!==n.environment)e(n.environment.cache);else if(void 0!==n.environments)for(var s=0;s<n.environments.length;s++)e(n.environments[s].cache)}}}var t,i={};e(globalEvaluationNodes);for(var r in allAreaMonitor.allAreas)t=allAreaMonitor.allAreas[r],e(t.evaluationNodes[0]);return"type\tnrInstances\tnrUpdates\tnrEvals\tnrTimesChanged\tevalTime\tinformWatchersTime\tupdateInputTime\tattributedTime\tnrQueueResets\n"+objValues(i).map(function(e){return e.id+"\t"+e.nrInstances+"\t"+e.nrUpdates+"\t"+e.nrEvals+"\t"+e.nrTimesChanged+"\t"+e.totalEvalTime+"\t"+e.totalInformWatchersTime+"\t"+e.totalUpdateInputTime+"\t"+e.totalAttributedTime+"\t"+e.nrQueueResets}).join("\n")}function findAreaContextAttributeForEvaluationNode(e,t){for(;void 0!==e;){var i=e.getDebugAttributeFor(t);if(void 0!==i)return"@"+e.areaId+":context:"+i.join(",");e=void 0!==e.controller?e.controller.parent:void 0}return""}function exprStatPerPrototype(){function e(t,r){for(var n=0;n<t.length;n++){var o=t[n];if(o){var s=o.prototype.idStr();if(s in i?(i[s].nrInstances++,i[s].nrUpdates+=o.nrCallsToUpdate,i[s].nrCallsToEval+=o.nrCallsToEval,i[s].nrTimesChanged+=o.nrCallsToEval,i[s].totalEvalTime+=o.totalEvalTime,i[s].totalInformWatchersTime+=o.totalInformWatchersTime,i[s].totalUpdateInputTime+=o.totalUpdateInputTime,i[s].totalAttributedTime+=o.totalAttributedTime,i[s].nrQueueResets+=o.nrQueueResets):i[s]={id:s,nrInstances:1,nrUpdates:o.nrCallsToUpdate,nrCallsToEval:o.nrCallsToEval,nrTimesChanged:o.nrTimesChanged,totalEvalTime:o.totalEvalTime,totalInformWatchersTime:o.totalInformWatchersTime,totalUpdateInputTime:o.totalUpdateInputTime,totalAttributedTime:o.totalAttributedTime,nrQueueResets:o.nrQueueResets,contextAttribute:findAreaContextAttributeForEvaluationNode(r,o)},o instanceof EvaluationApply||o instanceof EvaluationMap||o instanceof EvaluationFilter||o instanceof EvaluationMultiQuery)if(void 0!==o.environment)e(o.environment.cache,void 0);else if(void 0!==o.environments)for(var a=0;a<o.environments.length;a++)e(o.environments[a].cache,void 0)}}}var t,i={};e(globalEvaluationNodes,void 0);for(var r in allAreaMonitor.allAreas)t=allAreaMonitor.allAreas[r],e(t.evaluationNodes[0],t);return"id\tnrInstances\tnrUpdates\tnrCallsToEval\tnrTimesChanged\tevalTime\tinformWatchersTime\tupdateInputTime\tattributedTime\tnrQueueResets\tcontextAttribute\n"+objValues(i).filter(function(e){return 0!==e.nrUpdates}).map(function(e){return e.id+"\t"+e.nrInstances+"\t"+e.nrUpdates+"\t"+e.nrCallsToEval+"\t"+e.nrTimesChanged+"\t"+e.totalEvalTime+"\t"+e.totalInformWatchersTime+"\t"+e.totalUpdateInputTime+"\t"+e.totalAttributedTime+"\t"+e.nrQueueResets+"\t"+e.contextAttribute}).join("\n")}function resetExprStat(){function e(t){for(var i=0;i<t.length;i++){var r=t[i];if(r&&(r.nrCallsToEval=0,r.nrCallsToUpdate=0,r.nrTimesChanged=0,r.totalEvalTime=0,r.totalInformWatchersTime=0,r.totalUpdateInputTime=0,r.totalAttributedTime=0,r.attributedTime=0,r.nrQueueResets=0,r instanceof EvaluationApply||r instanceof EvaluationMap||r instanceof EvaluationFilter||r instanceof EvaluationMultiQuery))if(void 0!==r.environment)e(r.environment.cache);else if(void 0!==r.environments)for(var n=0;n<r.environments.length;n++)e(r.environments[n].cache)}}var t;e(globalEvaluationNodes);for(var i in allAreaMonitor.allAreas){t=allAreaMonitor.allAreas[i],e(t.evaluationNodes[0]),t.attributedTime=0,t.totalUpdateInputTime=0;for(var r in t.writes){var n=t.writes[r];for(var o in n.whenBecomesTrue){var s=n.whenBecomesTrue[o];s.attributedTime=0,s.totalUpdateInputTime=0,void 0!==s.mergeExpression&&(s.mergeExpression.attributedTime=0,s.mergeExpression.totalUpdateInputTime=0),void 0!==s.toExpression&&(s.toExpression.attributedTime=0,s.toExpression.totalUpdateInputTime=0)}for(var o in n.whenBecomesFalse){var s=n.whenBecomesFalse[o];s.attributedTime=0,s.totalUpdateInputTime=0,void 0!==s.mergeExpression&&(s.mergeExpression.attributedTime=0,s.mergeExpression.totalUpdateInputTime=0),void 0!==s.toExpression&&(s.toExpression.attributedTime=0,s.toExpression.totalUpdateInputTime=0)}}}EvaluationNode.accumulatedTimes=[]}function exprStatCount(){function e(t){for(var n=0;n<t.length;n++){var o=t[n];if(o&&(i++,"attributedTime"in o&&(r+=o.attributedTime),o instanceof EvaluationApply||o instanceof EvaluationMap||o instanceof EvaluationFilter||o instanceof EvaluationMultiQuery))if(void 0!==o.environment)e(o.environment.cache);else if(void 0!==o.environments)for(var s=0;s<o.environments.length;s++)e(o.environments[s].cache)}}var t,i=0,r=0;e(globalEvaluationNodes);for(var n in allAreaMonitor.allAreas)t=allAreaMonitor.allAreas[n],e(t.evaluationNodes[0]);return{nrNodes:i,attributedRem:r}}function nrWatchers(e,t,i,r){function n(s,a){for(var d=0;d<a.length;d++){var u=a[d];if(u&&(u.nrWatchers>=e&&u.nrActiveWatchers>=t&&u.nrWatchersAdded>=i&&u.nrWatchersRemoved>=r&&o.push({areaId:s,node:u}),u instanceof EvaluationApply||u instanceof EvaluationMap||u instanceof EvaluationFilter||u instanceof EvaluationMultiQuery))if(void 0!==u.environment)n(s,u.environment.cache);else if(void 0!==u.environments)for(var h=0;h<u.environments.length;h++)n(s,u.environments[h].cache)}}var o=[];void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),n("global",globalEvaluationNodes);for(var s in allAreaMonitor.allAreas){var a=allAreaMonitor.allAreas[s];n(s,a.evaluationNodes[0])}return o.sort(function(e,t){return e.node.nrWatchers-t.node.nrWatchers}),o.map(function(e){return e.areaId+"\t"+e.node.prototype.idStr()+"\t"+e.node.nrWatchers+"\t"+e.node.nrActiveWatchers+"\t"+e.node.nrWatchersAdded+"\t"+e.node.nrWatchersRemoved}).join("\n")}function printAppState(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r instanceof EvaluationWrite&&console.log(r.prototype.id+"L"+e,r.prototype.path.join("."),vstringify(r.result.value))}}var t;e("global",globalEvaluationNodes);for(var i in allAreaMonitor.allAreas)t=allAreaMonitor.allAreas[i],e(i,t.evaluationNodes[0])}function id_(e){for(var t in allAreaMonitor.allAreas){var i=allAreaMonitor.allAreas[t];if(i.tAreaId===e)return t}}function tid_(e){var t=allAreaMonitor.allAreas[e];return t?t.tAreaId:void 0}function testInternalFunction(e){for(var t=e.factory(),i=[],r=1;r<arguments.length;r++)i.push(new Result(arguments[r]));return t.execute(i)}function exprStatHeavy(e){function t(i){for(var n=0;n<i.length;n++){var o=i[n];if(o&&o.totalEvalTime+o.totalInformWatchersTime+o.totalUpdateInputTime>=e&&r.push(o),o instanceof EvaluationApply||o instanceof EvaluationMap||o instanceof EvaluationFilter||o instanceof EvaluationMultiQuery)if(void 0!==o.environment)t(o.environment.cache);else if(void 0!==o.environments)for(var s=0;s<o.environments.length;s++)t(o.environments[s].cache)}}var i,r=[];t(globalEvaluationNodes);for(var n in allAreaMonitor.allAreas)i=allAreaMonitor.allAreas[n],t(i.evaluationNodes[0]);return r}function unwatchedActiveExpressions(){function e(e){var t=!0;return e.forEach(function(e){e.watcher instanceof EvaluationNode&&!(e.watcher.nrActiveWatchers>0)||(t=!1)}),t}function t(i,r,n){assert(r);for(var o=0;o<r.length;o++){var s=r[o];if(s&&(s.nrActiveWatchers>0&&e(s.watchers)&&n.push(s),s instanceof EvaluationApply||s instanceof EvaluationMap||s instanceof EvaluationFilter||s instanceof EvaluationMultiQuery))if(void 0!==s.environment)t(i,s.environment.cache,n);else if(void 0!==s.environments)for(var a=0;a<s.environments.length;a++)t(i,s.environments[a].cache,n)}}var i,r={global:[]};t("global",globalEvaluationNodes,r.global),0===r.global.length&&delete r.global;for(var n in allAreaMonitor.allAreas)i=allAreaMonitor.allAreas[n],r[n]=[],t(i.tAreaId,i.evaluationNodes[0],r[n]),0===r[n].length&&delete r[n];return Utilities.isEmptyObj(r)?void 0:r}function printAreaSetExpressions(e,t){function i(){var i=[],r=t.length;for(var n in allAreaMonitor.allAreas){var o=allAreaMonitor.allAreas[n];o.template.id===e&&valueEqual(o.setIndices.slice(0,r),t)&&i.push(o)}return i}function r(e){if(void 0===e)return"undefined";var t=vstringify(e);return t.length>80&&(t=t.substr(0,40)+"..."+t.substr(-37)),e instanceof Array&&e.length>1&&(t+=" size="+e.length),t}var n=i();if(0!==n.length){for(var o,s=n[0],a=s.template,d=s.evaluationNodes[0].length,u="id\tproto",h=0;h<n.length;h++)s=n[h],u+="\t"+s.areaId;u+="\n";for(var l=0;l<d;l++){u+=String(l)+"\t"+a.functionNodes[l].toString();for(var h=0;h<n.length;h++)s=n[h],o=s.evaluationNodes[0][l],u+=o?0===o.nrActiveWatchers?"\tinactive":"\t"+r(o.result.value)+"/"+o.nrActiveWatchers:"\t";u+="\n"}return u}}function printExprOfPrototype(e,t,i){function r(n,o){var s=o[e];if(s&&s.prototype.localToArea===t&&s.prototype.localToDefun===i&&console.log(n.join(":"),"#"+s.watcherId,"active="+s.nrActiveWatchers,"value="+(void 0===s.result?"<undefined>":vstringifyLim(s.result.value,80)),"size="+(void 0!==s.result&&s.result.value instanceof Array?s.result.value.length:1)),0!==i)for(var a=0;a<o.length;a++)if(s=o[a],s&&(s instanceof EvaluationApply||s instanceof EvaluationMap||s instanceof EvaluationFilter||s instanceof EvaluationMultiQuery))if(void 0!==s.environment)r(n,s.environment.cache);else if(void 0!==s.environments)for(var d=0;d<s.environments.length;d++)r(n,s.environments[d].cache)}var n;if(t>0)for(var o in allAreaMonitor.allAreas)n=allAreaMonitor.allAreas[o],n.template.id!==t&&0===i||r([n.areaId],n.evaluationNodes[0]);else r(["global"],globalEvaluationNodes)}function printDataSourceExpr(){function e(e){if(e.param&&e.param.data&&e.param.data.dataSource){var t=e.param.data.dataSource,i=e.evaluationNodes[0][paramSetDataIndex];console.log(e.areaId+"\t"+t.id+"\t"+i.prototype.idStr()+"\tareaSetContent")}}function t(e,i){for(var r=0;r<i.length;r++){var n=i[r];if(n&&(n.dataSourceAware||n.result&&n.result.dataSource)){var o=n.result.dataSource;o?console.log(e+"\t"+o.id+"\t"+n.prototype.idStr()+"\t"+n.prototype.toString()):console.log(e+"\t"+n.prototype.idStr()+"\t"+n.prototype.toString())}if(n instanceof EvaluationApply||n instanceof EvaluationMap||n instanceof EvaluationFilter||n instanceof EvaluationMultiQuery)if(void 0!==n.environment)t(e,n.environment.cache);else if(void 0!==n.environments)for(var s=0;s<n.environments.length;s++)t(e,n.environments[s].cache)}}t("global",globalEvaluationNodes);for(var i=sortAreaIds(Object.keys(allAreaMonitor.allAreas)),r=0;r<i.length;r++){var n=i[r],o=allAreaMonitor.allAreas[n];e(o),t(n,o.evaluationNodes[0])}}function listUnreachableDataSources(){function e(i,r){for(var n=0;n<r.length;n++){var o=r[n];if(o&&o instanceof EvaluationFunctionApplication&&("datatable"===o.bif.name||"database"===o.bif.name)&&void 0!==o.result.dataSource&&o.result.dataSource.collectReachableDSIds(t),o instanceof EvaluationApply||o instanceof EvaluationMap||o instanceof EvaluationFilter||o instanceof EvaluationMultiQuery)if(void 0!==o.environment)e(i,o.environment.cache);else if(void 0!==o.environments)for(var s=0;s<o.environments.length;s++)e(i,o.environments[s].cache)}}var t=new Set;e("global",globalEvaluationNodes);for(var i=sortAreaIds(Object.keys(allAreaMonitor.allAreas)),r=0;r<i.length;r++){var n=i[r],o=allAreaMonitor.allAreas[n];e(n,o.evaluationNodes[0])}var s=[];for(var a in debugDataSourceObject){var d=Number(a);t.has(d)||s.push(d)}return s}function printAllAreaContexts(){for(var e=allAreaMonitor.getAllAreaIds(),t=0;t<e.length;t++){var i=allAreaMonitor.getAreaById(e[t]),r={};i.debugAddContext(r,!1),"context"in r&&console.log(i.tAreaId,"@"+i.areaId,"content",cdlifyLim(r.content,80));for(var n in r.context)console.log(i.tAreaId,"@"+i.areaId,n,cdlifyLim(r.context[n],80))}}function printAllAreaClasses(){for(var e=allAreaMonitor.getAllAreaIds(),t=0;t<e.length;t++)for(var i=allAreaMonitor.getAreaById(e[t]),r=getClassesForArea(i),n=0;n<r.length;n++)console.log(i.tAreaId,"@"+i.areaId,r[n])}function wid_(e){function t(i){for(var r=0;r<i.length;r++){var n=i[r];if(n){if(n.watcherId===e)return n;if(n instanceof EvaluationApply||n instanceof EvaluationMap||n instanceof EvaluationFilter||n instanceof EvaluationMultiQuery)if(void 0!==n.environment){var o=t(n.environment.cache);if(void 0!==o)return o}else if(void 0!==n.environments)for(var s=0;s<n.environments.length;s++){var o=t(n.environments[s].cache);if(void 0!==o)return o}}}}var i=t(globalEvaluationNodes);if(void 0!==i)return i;for(var r in allAreaMonitor.allAreas){var n=allAreaMonitor.allAreas[r],i=t(n.evaluationNodes[0]);if(void 0!==i)return i}}function printAreasOverlapping(e){function t(e,i,r,o,s,a){var d=allAreaMonitor.getAreaById(e),u=areaRelationMonitor.getRelation(e,"embedded"),h=e+" "+d.zArea.zIndexStatus+" "+d.zArea.zIndex;n+=a+(d.display&&d.display.isOpaque()?h:"("+h+")")+"\n";for(var l=0;l<u.length;l++){var c=allAreaMonitor.getAreaById(u[l].getElement());if(c instanceof DisplayArea){var p=c.getPos();if(p){var f=c.getOffsets(),v=void 0!==f&&"left"in f?{left:p.left+f.left,top:p.top+f.top,width:p.width-f.left-f.right,height:p.height-f.top-f.bottom}:p,g=c.hasVisibleBorder()?p:v;g.left<s&&g.left+g.width>=r&&g.top<o&&g.top+g.height>=i&&t(c.areaId,i-v.top,r-v.left,o-v.top,s-v.left,a+"  ")}}}}var i=allAreaMonitor.getAreaById(e),r=debugObjAbsAreaPosition(i),n="";return t("1:1",r.absTop,r.absLeft,r.absTop+r.height,r.absLeft+r.width,""),n}function printLargeQueries(e,t){function i(t,r,n){for(var o=0;o<r.length;o++){var s=r[o];if(s&&s.nrCallsToUpdate>0&&s.isLargeQuery(e,!0)&&console.log('ae_("'+t+'", '+s.prototype.id+")","T"+n,"#"+s.watcherId,s.prototype.idStr(),"active="+s.nrActiveWatchers,"value="+vstringifyLim(s.result.value,100),s.__proto__.constructor.name),s instanceof EvaluationApply||s instanceof EvaluationMap||s instanceof EvaluationFilter||s instanceof EvaluationMultiQuery)if(void 0!==s.environment)i(t,s.environment.cache,n);else if(void 0!==s.environments)for(var a=0;a<s.environments.length;a++)i(t,s.environments[a].cache,n)}}var r;if(0===t||"global"===t)i("global",globalEvaluationNodes,"");else if(void 0!==t){var r=allAreaMonitor.allAreas[t];i(t,r.evaluationNodes[0],r.tAreaId)}else{i("global",globalEvaluationNodes);for(t in allAreaMonitor.allAreas)r=allAreaMonitor.allAreas[t],i(t,r.evaluationNodes[0],r.tAreaId)}}function exprNrWatchersStatPerPrototype(){function e(t){for(var r=0;r<t.length;r++){var n=t[r];if(n){var o=n.watchers?n.watchers.size:0,s=n.prototype.idStr();if(s in i?(i[s].nrInstances++,i[s].totalNrWatchers+=o,i[s].minNrWatchers>o&&(i[s].minNrWatchers=o),i[s].maxNrWatchers<o&&(i[s].maxNrWatchers=o)):i[s]={id:s,nrInstances:1,totalNrWatchers:o,minNrWatchers:o,maxNrWatchers:o},n instanceof EvaluationApply||n instanceof EvaluationMap||n instanceof EvaluationFilter||n instanceof EvaluationMultiQuery)if(void 0!==n.environment)e(n.environment.cache);else if(void 0!==n.environments)for(var a=0;a<n.environments.length;a++)e(n.environments[a].cache)}}}var t,i={};e(globalEvaluationNodes);for(var r in allAreaMonitor.allAreas)t=allAreaMonitor.allAreas[r],e(t.evaluationNodes[0]);return"id\tnrInstances\ttotalNrWatchers\tavgNrWatchers\tminNrWatchers\tmaxNrWatchers\n"+objValues(i).map(function(e){return e.id+"\t"+e.nrInstances+"\t"+e.totalNrWatchers+"\t"+e.totalNrWatchers/e.nrInstances+"\t"+e.minNrWatchers+"\t"+e.maxNrWatchers}).join("\n")}function memStatsPerTemplate(){function e(t,i,r){assert(i);for(var n=0;n<i.length;n++){var o=i[n];if(o&&(r.nrEvaluationNodes++,0===o.nrActiveWatchers&&r.nrNonActive++,r.nrWatchers+=void 0===o.watchers?0:o.watchers.size,o instanceof EvaluationApply||o instanceof EvaluationMap||o instanceof EvaluationFilter||o instanceof EvaluationMultiQuery))if(void 0!==o.environment)e(t,o.environment.cache,r);else if(void 0!==o.environments)for(var s=0;s<o.environments.length;s++)e(t,o.environments[s].cache,r)}}var t={global:{id:"global",nrAreas:0,nrEvaluationNodes:0,nrNonActive:0,nrConstraints:0,nrWatchers:0,path:[]}};e("global",globalEvaluationNodes,t.global);for(var i in allAreaMonitor.allAreas){var r,n=allAreaMonitor.allAreas[i];n.template.id in t?(r=t[n.template.id],r.nrAreas++):r=t[n.template.id]={id:n.template.id,nrAreas:1,nrEvaluationNodes:0,nrNonActive:0,nrConstraints:0,nrWatchers:0,path:n.template.getChildPath()},r.nrConstraints+=Object.keys(n.allPosConstraints.constraints).length,e(n.tAreaId,n.evaluationNodes[0],r)}return"template\tnrAreas\tnrEvNodes\tnrNonActive\tnrConstraints\tnrWatchers\tpath\n"+objValues(t).map(function(e){return e.id+"\t"+e.nrAreas+"\t"+e.nrEvaluationNodes+"\t"+e.nrNonActive+"\t"+e.nrConstraints+"\t"+e.nrWatchers+"\t"+e.path.join(".")}).join("\n")}function memStatsTotal(){function e(i,r){for(var n=0;n<r.length;n++){var o=r[n];if(o&&(t.nrEvaluationNodes++,0===o.nrActiveWatchers&&t.nrNonActive++,o instanceof EvaluationApply||o instanceof EvaluationMap||o instanceof EvaluationFilter||o instanceof EvaluationMultiQuery))if(void 0!==o.environment)e(i,o.environment.cache);else if(void 0!==o.environments)for(var s=0;s<o.environments.length;s++)e(i,o.environments[s].cache)}}var t={nrAreas:0,nrEvaluationNodes:0,nrNonActive:0,nrConstraints:0};e("global",globalEvaluationNodes);for(var i in allAreaMonitor.allAreas){var r=allAreaMonitor.allAreas[i];t.nrAreas++,t.nrConstraints+=Object.keys(r.allPosConstraints.constraints).length,e(r.tAreaId,r.evaluationNodes[0])}console.log("nrAreas="+t.nrAreas+", nrEvaluationNodes="+t.nrEvaluationNodes+", nrNonActive="+t.nrNonActive+", nrConstraints="+t.nrConstraints)}function countLocalWatchers(){function e(n,o){for(var s=0;s<o.length;s++){var a=o[s];if(a&&(t++,void 0!==a.watchers&&(i+=a.watchers.size,a.watchers.forEach(function(e){var t=e.watcher;t instanceof EvaluationNode&&t.local===a.local&&r++})),a instanceof EvaluationApply||a instanceof EvaluationMap||a instanceof EvaluationFilter||a instanceof EvaluationMultiQuery))if(void 0!==a.environment)e(n,a.environment.cache);else if(void 0!==a.environments)for(var d=0;d<a.environments.length;d++)e(n,a.environments[d].cache)}}var t=0,i=0,r=0;e("global",globalEvaluationNodes);for(var n in allAreaMonitor.allAreas){var o=allAreaMonitor.allAreas[n];e(o.tAreaId,o.evaluationNodes[0])}console.log("nrNodes="+t+", nrWatchers="+i+", nrLocalWatchers="+r)}function markAllFunctionNodes(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r&&(r.__MARKED__=!0)}}e("global",globalEvaluationNodes);for(var t in allAreaMonitor.allAreas){var i=allAreaMonitor.allAreas[t];e(i.tAreaId,i.evaluationNodes[0])}}function countAllUnmarkedFunctionNodes(){function e(e,i){for(var r=0;r<i.length;r++){var n=i[r];if(n&&!n.__MARKED__){n.__MARKED__=!0;var o=n.prototype.id,s=n.prototype.localToArea;void 0===s&&(s=0),void 0===t[s]&&(t[s]=[]),void 0===t[s][o]?t[s][o]=1:t[s][o]++}}}var t=[];e("global",globalEvaluationNodes);for(var i in allAreaMonitor.allAreas){var r=allAreaMonitor.allAreas[i];e(r.tAreaId,r.evaluationNodes[0])}for(var n="tid\tid\tn\tlabels\n",o=0;o<t.length;o++){var s=t[o];if(void 0!==s)for(var a=0;a<s.length;a++){var d=s[a];void 0!==d&&(n+=o+"\t"+a+"\t"+d+"\t"+(void 0===functionNodeToExpressionPaths[o]?"":functionNodeToExpressionPaths[o][a])+"\n")}}return n}function printAllDefunAppl(){function e(t,i){for(var r="",n=0;n<i.length;n++){var o=i[n];if(o instanceof EvaluationApply&&"fun"in o&&(r+=t+" "+o.prototype.idStr()+" "+o.prototype.toString()+" active="+o.nrActiveWatchers+" value="+vstringifyLim(o.result.value,100)+"\n"),o instanceof EvaluationApply||o instanceof EvaluationMap||o instanceof EvaluationFilter||o instanceof EvaluationMultiQuery)if(void 0!==o.environment)e(t,o.environment.cache);else if(void 0!==o.environments)for(var s=0;s<o.environments.length;s++)e(t,o.environments[s].cache)}return r}var t,i;i=e("global",globalEvaluationNodes);for(areaId in allAreaMonitor.allAreas)t=allAreaMonitor.allAreas[areaId],i+=e(areaId,t.evaluationNodes[0]);return i}function nukeAllWatcherMaps(){function e(t){for(var i=0;i<t.length;i++){var r=t[i];if(void 0!==r&&(r.watchers=void 0),r instanceof EvaluationApply||r instanceof EvaluationMap||r instanceof EvaluationFilter||r instanceof EvaluationMultiQuery)if(void 0!==r.environment)e(r.environment.cache);else if(void 0!==r.environments)for(var n=0;n<r.environments.length;n++)e(r.environments[n].cache)}}e(globalEvaluationNodes);for(var t in allAreaMonitor.allAreas)e(allAreaMonitor.allAreas[t].evaluationNodes[0])}function printAppStateChangeList(){return gAppStateChangeList.map(function(e){return"@"+e.areaId+":"+e.path.join(".")+":"+cdlify(e.value)}).join("\n")}function printNrInitiatedDeferrals(){function e(i,r){assert(r);for(var n=0;n<r.length;n++){var o=r[n];if(o&&(o.nrDeferralsInitiated>0&&t.push(String(o.nrDeferralsInitiated)+"\t@"+i+"\t"+o.prototype.idStr()+"\t"+o.watcherId+"\t"+o.nrActiveWatchers+"\t"+vstringifyLim(o.result.value,100)+"\t"+o.__proto__.constructor.name),o instanceof EvaluationApply||o instanceof EvaluationMap||o instanceof EvaluationFilter||o instanceof EvaluationMultiQuery))if(void 0!==o.environment)e(i,o.environment.cache);else if(void 0!==o.environments)for(var s=0;s<o.environments.length;s++)e(i,o.environments[s].cache)}}var t=["nrdef\tarea\tprototype\twatcherId\tactive\tvalue\ttype"];e("global",globalEvaluationNodes);for(var i in allAreaMonitor.allAreas){var r=allAreaMonitor.allAreas[i];e(i,r.evaluationNodes[0])}return t.join("\n")}function resetNrInitiatedDeferrals(){function e(t,i){assert(i);for(var r=0;r<i.length;r++){var n=i[r];if(n&&(n.nrDeferralsInitiated=0,n instanceof EvaluationApply||n instanceof EvaluationMap||n instanceof EvaluationFilter||n instanceof EvaluationMultiQuery))if(void 0!==n.environment)e(t,n.environment.cache);else if(void 0!==n.environments)for(var o=0;o<n.environments.length;o++)e(t,n.environments[o].cache)}}var t;e("global",globalEvaluationNodes);for(var i in allAreaMonitor.allAreas)t=allAreaMonitor.allAreas[i],e(i,t.evaluationNodes[0])}function DebugObjConstraint(){this.pointsArr={},this.pointsOfAreaArr={},this.allPairsCyclesMat={},this.violations={},this.violationMessageList=[],this.constraintIds=[],this.pointLabelById=[]}function debugObjConstraintInit(){this.mapConstraintIds(),this.mapPointLabels(),this.readAllLinearConstraints(),this.readAllSegmentConstraints(),this.fillInPointersToPoints(),this.fillInPairsCycles(),this.fillInViolations()}function debugObjConstraintMapConstraintIds(){for(var e in allAreaMonitor.allAreas){var t=allAreaMonitor.allAreas[e].allPosConstraints;if(t&&t.constraints)for(var i in t.constraints){var r=t.constraints[i];r&&r.constraint&&(this.constraintIds[r.constraint.id]={aid:e,name:i})}}}function debugObjConstraintMapPointLabels(){for(var e in globalPointLabelIds){var t=globalPointLabelIds[e];this.pointLabelById[t]=e}}function debugObjConstraintReadAllLinearConstraints(){var e,t,i,r=globalPos.posCalc.linearConstraints.constraintById,n=globalPos.posCalc.linearConstraints.pairById,o=globalPos.posCalc.linearConstraints.cycles;for(var s in r){var a=getPointConstraintId(s),d=this.constraintIds[a],u=r[s];if(u&&2==u.length){var h=[];for(var l in u){var c=u[l],p=n[c];if(p)for(var f in p.points)h.push(p.points[f])}var v=o.getEdge(u[0],u[1]);if(v){var g=v.prop?v.prop[0]:void 0;if(g){var m=g.priority,y=g.scalar,I=[];for(e=0;e<h.length;e++)i=this.getPointAreaID(h[e]),I[e]=i;this.addPairCycles(h[0],h[1]),this.addPairCycles(h[2],h[3]);var b,C="",S="",R=globalPos.getPairOffset(h[0],h[1]),P=globalPos.getPairOffset(h[2],h[3]),A=R*y;Math.round(A)!=Math.round(P)&&(S=" ****OOOPS****");var M=Math.round(100*R)/100,x=Math.round(100*P)/100;for(e=0;e<h.length;e++)if(i=I[e]){var E=h[e],T=this.getPointEntry(E,i),N=[];for(t=0;t<h.length;t++)N[t]=this.getFullName(h[t],I[t],i);for(b="<"+N[0]+", "+N[1]+": "+M+"> * "+y+" == <"+N[2]+", "+N[3]+": "+x+">[ID="+a+";"+(void 0===d?"?":d.aid+":"+d.name)+"; priority = "+m+S+C+"]",T[b]={},t=0;t<h.length;t++)h[t]!=E&&(T[b][h[t]]="*")}S.length>0&&mMessage(b)}}}}}function debugObjConstraintReadAllSegmentConstraints(){var e,t,i,r,n,o=globalPos.posCalc.segmentConstraints.pairById,s=globalPos.posCalc.orGroups.orGroups;for(var a in o){var d=o[a].points;if(0!==d.length){var u=[];for(t=0;t<d.length;t++)r=this.getPointAreaID(d[t]),u[t]=r;this.addPairCycles(d[0],d[1]);var h=globalPos.getPairOffset(d[0],d[1]),l=Math.round(100*h)/100,c=[],p=[];d[0]+";"+d[1],d[1]+";"+d[0];for(e in o[a].ids){var f=parseInt(e);isNaN(f)&&(f=e);var v="[ID="+(gPointNameMap?"#":f)+";",g=this.constraintIds[f];g&&(v+=void 0!==gPointNameMap&&g.aid in gPointNameMap?gPointNameMap[g.aid]+":"+g.name+";":g.aid+":"+g.name+";");var m=!1,y=!1,I=o[a].ids[e],b=!0;if(I.orGroups){v+=" groups=";var C=!0;for(var S in I.orGroups.labels)C?C=!1:v+=",",v+=S,s[S]&&s[S].numSatisfied||(b=!1);C&&(b=!1,v+="<none>"),v+=";"}else b=!1;void 0!==I.min&&(v+=" min="+I.min,!b&&I.min!=1/0&&I.min>h&&(0===I.min&&"min"==I.preference?y=!0:m=!0)),void 0!==I.max&&(v+=" max="+I.max,!b&&I.max!=-(1/0)&&I.max<h&&(0===I.max&&"min"==I.preference?y=!0:m=!0)),I.stability&&(v+=" stability=true"),I.preference&&(v+=" preference="+I.preference),v+=" priority="+I.priority,m&&(v+=" *violated*"),v+="]",c.push(v),m&&p.push(v),(m||y)&&this.addSegmentViolation(a,e)}for(t=0;t<d.length;t++)if(r=u[t]){var R=d[t],P=this.getPointEntry(R,r);for(n=[],i=0;i<d.length;i++)n[i]=this.getFullName(d[i],u[i],r);var A="<"+n[0]+", "+n[1]+": "+l+">"+c.join(" ");for(P[A]={},i=0;i<d.length;i++)d[i]!=R&&(P[A][d[i]]="*")}if(p.length>0){for(n=[],i=0;i<d.length;i++)n[i]=this.getFullName(d[i],u[i],void 0);var M="<"+n[0]+", "+n[1]+": "+l+">"+p.join("");this.violationMessageList.push(M)}}}}function debugObjConstraintFillInPointersToPoints(){for(var e in this.pointsArr){var t=this.pointsArr[e];for(var i in t)for(var r in t[i])t[i][r]=this.getPointEntry(r)}}function debugObjConstraintFillInPairsCycles(){for(var e in this.allPairsCyclesMat){var t=this.allPairsCyclesMat[e];
for(var i in t)if("*"!=t[i]){var r=globalPos.getPairOffset(e,i),n=this.getFullName(e,this.getPointAreaID(e),"unusedAreaID"),o=this.getFullName(i,this.getPointAreaID(i),"unusedAreaID"),s="<"+n+", "+o+"> = "+r,a=[e,i];for(var d in a){var u=this.getPointEntry(a[d]);u.Cycles||(u.Cycles={}),u.Cycles[s]||(u.Cycles[s]={});for(var h in t[i])u.Cycles[s][h]=t[i][h]}}}}function DebugObjConstraintAddPairCycles(e,t){var i=e<t?e:t,r=e<t?t:e,n=this.allPairsCyclesMat[i];if(n||(n=this.allPairsCyclesMat[i]={}),!n[r]){var o=globalPos.debugGetPairCycles(i,r);n[r]=o?o:"*"}}function debugObjConstraintGetPointEntry(e,t){if(this.pointsArr[e])return this.pointsArr[e];t||(t=this.getPointAreaID(e));var i=this.pointsOfAreaArr[t];i||(this.pointsOfAreaArr[t]=i={});var r=this.pointsArr[e]=i[e]={};return r}function debugObjConstraintGetFullName(e,t,i){var r=this.pointLabelById[e];if(void 0===gPointNameMap&&t==i&&0===r.search(t))return"___"+r.substr(String(t).length);if(void 0===gPointNameMap)return r;var n=this.getPointAreaID(r);return void 0===n?r:n in gPointNameMap?gPointNameMap[n]+r.substr(n.length):r}function getPointConstraintId(e){getPointConstraintIDRegExp||(getPointConstraintIDRegExp=new RegExp("^([0-9]+)"));var t=getPointConstraintIDRegExp.exec(e);return t?t[0]:void 0}function getPointAreaID(e){getPointAreaIDRegExp||(getPointAreaIDRegExp=new RegExp("^(p[0-9]+|[0-9]+:)(?:(?:[0-9-]+|<[^>]*>)(?:\\.(?:[0-9-]+|<[^>]*>))*)?"));var t=getPointAreaIDRegExp.exec(e);return t?t[0]:void 0}function debugObjConstraintGetPointAreaID(e){var t=this.pointLabelById[e];return getPointAreaID(t)}function debugObjMgrVerifyConsistency(){if(""!==singleConstraintLabelsIgnore){mMessage('*** Single constraints labels (singleConstraintLabelsIgnore="'+singleConstraintLabelsIgnore+'") ***');for(var e in this.pointsOfAreaArr)for(var t in this.pointsOfAreaArr[e]){var i=this.pointsOfAreaArr[e][t],r=0;for(var n in i)r++;if(r<=1){var o=t.substr(e.length,6);switch(o){case"lf":case"rf":case"tf":case"bf":case"cvf":case"chf":case"lfb":case"rfb":case"tfb":case"bfb":case"lc":case"rc":case"tc":case"bc":case"cvc":case"chc":case"lcb":case"rcb":case"tcb":case"bcb":case"rvarea":case"extrem":break;default:var s=this.getFullName(t,e,"unusedAreaID");s.match(singleConstraintLabelsIgnore)||console.log(s)}}}}}function debugObjConstraintAddSegmentViolation(e,t){this.violations||(this.violations={}),this.violations.byPoint||(this.violations.byPoint={});var i=debugGetViolationObj(e,t);if(i&&i.point)for(var r in i.point)this.violations.byPoint[r]||(this.violations.byPoint[r]={}),this.violations.byPoint[r][t]=i}function debugObjConstraintFillInViolations(){if(this.violations)for(var e in this.violations.byPoint){var t=this.getPointEntry(e);t.Violations||(t.Violations={});for(var i in this.violations.byPoint[e]){var r=this.violations.byPoint[e][i];if(r){var n=this.getPointAreaID(e),o={};if(t.Violations[i]=o,void 0!==r.target&&(o.target=r.target),r.blocking){o.blocking={};for(var s in r.blocking){var a=r.blocking[s];o.blocking[s]={},o.blocking[s].direction=r.violation.blockedBy[s].direction;for(var d in a){var u=globalPos.posCalc.segmentConstraints.pairById[d];if(u){var h=u.points,l={},c=[];for(var p in h){var f=this.getPointAreaID(h[p]);c[p]=this.getFullName(h[p],f,n),l[c[p]]=this.getPointEntry(h[p])}var v="<"+c[0]+";"+c[1]+">";o.blocking[s][v]=l}}}}}else t.Violations[i]=void 0}}}function debugObjConstraintGetConstraintOfArea(e){var t={},i=this.pointsOfAreaArr[e];for(var r in i){var n=this.pointLabelById[r];t[n]=i[r]}return t}function debugObjConstraintVisualizeConstraints(e){for(var t in e){var i=(globalPointLabelIds[t],e[t]);for(var r in i)if("Cycles"!==r&&"Violations"!==r){var n=Object.keys(i[r])[0];this.pointLabelById[n]}}}function debugGetViolationObj(e,t){var i=globalPos.posCalc.segmentConstraints.pairById[e];if(i){var r={point:{}};r.point[i.points[0]]=!0,r.point[i.points[1]]=!0;var n=globalPos.posCalc.segmentConstraints.pairById[e];if(n){var o=n.ids[t];if(o){var s=void 0!==o.cloneIndex?o.cloneIndex:n.index,a=globalPos.posCalc.equations.debugGetViolation(s);r.target=a.target,r.violation=a,r.blocking={};for(var d in a.blockedBy){var u=r.blocking[d]={},h=globalPos.posCalc.linearConstraints.getMainVariable(d),l=globalPos.posCalc.linearConstraints.variables[h];if(l)for(var c in l.pairs)u[c]=!0}return r}}}}function _mondriaErrorInternal(){if(!(errorsReported>=maxErrorReports)){errorsReported++;var e=[];e[0]="unknown(): ";for(var t=0,i=arguments.length;t<i;++t)e.push(JSON.stringify(arguments[t]));mMessage.apply(null,e),console.trace&&debugPrintStackStrace&&console.trace()}}function mondriaAuthorError(){_mondriaErrorInternal.apply(this,arguments),alertMessageCounter>=maxAlertPopups||(alertMessageCounter++,alert(Array.prototype.join.call(arguments,"")))}function mondriaAuthorHint(){mMessage.apply(this,arguments)}function mondriaInternalError(){_mondriaErrorInternal.apply(this,arguments),mondriaInternalErrorCounter++}function mMessage(){if(useConsoleLogApply)console.log.apply(this,arguments);else if(useConsoleLog){var e,t,i,r,n,o,s,a,d,u;switch(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3],n=arguments[4],o=arguments[5],s=arguments[6],a=arguments[7],d=arguments[8],u=arguments[9],arguments.length){case 1:console.log(e);break;case 2:console.log(e,t);break;case 3:console.log(e,t,i);break;case 4:console.log(e,t,i,r);break;case 5:console.log(e,t,i,r,n);break;case 6:console.log(e,t,i,r,n,o);break;case 7:console.log(e,t,i,r,n,o,s);break;case 8:console.log(e,t,i,r,n,o,s,a);break;case 9:console.log(e,t,i,r,n,o,s,a,d);break;case 10:console.log(e,t,i,r,n,o,s,a,d,u);break;default:console.log(Array.prototype.join.call(arguments," "))}}else useOperaPostError&&opera.postError.apply(this,arguments)}function debugStartTimer(e,t){}function debugStopTimer(e){}function debugTotalTimeStop(e){}function debugTotalTimeStart(e){}function isArray(e){return e instanceof Array}function isEmptyObj(e){return void 0===e||0===Object.keys(e).length}function objFirstProp(e){for(var t in e)return t}function addAssociationPath(e,t,i,r){var n,o=e;for(n=void 0===r?0:r;n<t.length-1;n++)t[n]in o&&o[t[n]]&&o[t[n]]instanceof Object||(o[t[n]]={}),o=o[t[n]];o[t[t.length-1]]=i}function getAssociationPath(e,t,i){var r,n=e;for(r=void 0===i?0:i;r<t.length;r++){if(!(n instanceof Object&&t[r]in n))return;n=n[t[r]]}return n}function hasAssociationPath(e,t,i){return void 0!==getAssociationPath(e,t,i)}function deleteAssociationPath(e,t,i){var r;return void 0===i&&(i=0),e instanceof Object&&t[i]in e&&(i==t.length-1?(r=e[t[i]],delete e[t[i]]):(r=deleteAssociationPath(e[t[i]],t,i+1),isEmptyObj(e[t[i]])&&delete e[t[i]])),r}function isEqualNaN(e){return isNaN(e)}function isXDRTemplateDefinition(e){return e instanceof Object&&"templateId"in e&&(1===e.templateId||"number"==typeof e.templateId&&e.templateId>0&&"number"==typeof e.parentId&&e.parentId>0&&"string"==typeof e.childType&&"string"==typeof e.childName&&(void 0===e.referredId||"number"==typeof e.referredId))}function isXDRIndexDefinition(e){return e instanceof Object&&(1===e.indexId||"number"==typeof e.indexId&&e.indexId>0&&"number"==typeof e.prefixId&&e.prefixId&&(void 0===e.compose||"number"==typeof e.compose))}function createRemoteMgr(){gRemoteMgr=new RemoteMgr,gRemoteDebug=gArgParser.getArg("debugRemote",0)}function debugForceClose(e){void 0!==gRemoteMgr&&gRemoteMgr.debugForceClose(e)}function debugReleaseForceClose(){void 0!==gRemoteMgr&&gRemoteMgr.debugReleaseForceClose()}function extractElementFromEmbedding(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function updateElementPos(e,t){if(e&&t){var i=["left","top","width","height"];for(var r in i){var n=i[r];if(t.hasOwnProperty(n)){var o=elementPosNormalize(n,t[n]);void 0!==o&&(e.style[n]=o)}}}}function updateZeroOffsetElementPos(e,t){if(e&&t){e.style.left="0px",e.style.top="0px";var i=elementPosNormalize("width",t.width),r=elementPosNormalize("height",t.height);void 0!==i&&(e.style.width=i),void 0!==r&&(e.style.height=r)}}function elementPosNormalize(e,t){var i={width:1,height:1};if(e in i&&(t=Math.max(0,t)),!isNaN(t))return t+"px"}function embedElementAtPos(e,t,i,r,n){n!==!0&&updateElementPos(e,t),embedElementInElement(e,i,r)}function embedZeroOffsetElementAtPos(e,t,i,r){updateZeroOffsetElementPos(e,t),embedElementInElement(e,i,r)}function embedElementInElement(e,t,i){return assert(void 0!==i),t?void(e.parentNode!=t&&t.insertBefore(e,i)):void extractElementFromEmbedding(e)}function embedAreaFrameElementAtPos(e,t,i){if(e&&e.display.frameDiv){if(!t||"undefined"==typeof t.embedding)return void extractElementFromEmbedding(e.display.frameDiv);var r;if(t.embedding){var n=t.embedding;assert(n.display,"there can't be an area without display"),r=n.display.getEmbeddingDiv()}else r=null===t.embedding?document.body:void 0;r&&embedElementAtPos(e.display.frameDiv,t,r,null,i)}}function removeElement(e){if(e&&e.parentNode){var t=e.parentNode;document.activeElement===e&&gDomEvent.setGlobalFocus(),t.removeChild(e),"INPUT"===e.tagName&&(t.parentNode.scrollLeft=0,t.parentNode.scrollTop=0)}}function createDiv(e,t){if("1:1"===e)return document.getElementById("mondriaRootDiv");var i=document.createElement("div");return i.id=e,i.style.position="absolute",i.style.overflow=void 0!==t?t:"hidden",i.style.left="0px",i.style.top="0px",i.style.width="0px",i.style.height="0px",i}function cssValTranslate(e,t){return"background-color"===e&&void 0===t?"":t}function assignCSSStyleProp(e,t,i){var r=t in cssPropTranslationTable?cssPropTranslationTable[t]:t,n=cssValTranslate(r,i);if(r instanceof Array)for(var o in r)e.setProperty(r[o],n,"");else e.setProperty(r,n,"")}function resetCssStyleProp(e,t){if(t in cssPropTranslationTable){var i=cssPropTranslationTable[t];if(i instanceof Array)for(var r in i)e.removeProperty(i[r]);else e.removeProperty(i)}else e.removeProperty(t)}function assignCSSStylePropToElements(e,t,i,r){if(e)for(var n in t)e[t[n]]&&assignCSSStyleProp(e[t[n]].style,i,r)}function parseColorStopsArr(e){var t="";if(void 0!==e){e instanceof Array||(e=[e]);for(var i=0;i<e.length;i++){var r=e[i];if(!(r instanceof Object))return;r.color&&(t+=r.color,r.length&&(t+=isNaN(r.length)?" "+r.length:" "+r.length+"px"),i<e.length-1&&(t+=","))}return t}}function copyBackgroundLinearGradientCssProp(e,t){var i=parseColorStopsArr(t.stops);if(i){var r="linear-gradient("+t.start+", "+i+")";assignCSSStyleProp(e.style,"background",r),assignCSSStyleProp(e.style,"background","-ms-"+r)}}function copyBackgroundRadialGradientCssProp(e,t){var i=parseColorStopsArr(t.stops);if(i){var r="radial-gradient(";(t.position||t.angle)&&(r+=(t.position?t.position+" ":"")+(t.angle?t.angle:"")+", "),(t.shape||t.size)&&(r+=(t.shape?t.shape+" ":"")+(t.size?t.size:"")+", "),r+=i+")",assignCSSStyleProp(e.style,"background","-moz-"+r),assignCSSStyleProp(e.style,"background","-webkit-"+r),assignCSSStyleProp(e.style,"background","-ms-"+r)}}function copyBackgroundImage(e,t){var i={position:!0,size:!0,repeat:!0};for(var r in t){var n=getDeOSedValue(t[r]);assignCSSStyleProp(e.style,"background-"+r,"image"===r?"url("+n+")":n)}for(r in i)r in t||assignCSSStyleProp(e.style,"background-"+r,"")}function num2Pixel(e){return e=getDeOSedValue(e),isNaN(e)?e:e+"px"}function copyDisplayCssProp(e,t,i){if(void 0!==e.displayDiv)switch(i=getDeOSedValue(i),t){case"displayType":case"text":case"html":case"iframe":case"triangle":case"arc":case"image":case"pointerOpaque":case"transitions":case"foreign":return;case"background":var r=!0,n=!0;if(!(i instanceof Object)){"string"!=typeof i||i.indexOf("-webkit-")==-1&&i.indexOf("gradient")==-1?(assignCSSStyleProp(e.displayDiv.style,"backgroundColor",i),r=!1):mondriaAuthorError("Unsupported attribute: "+t+"="+vstringify(i));break}return"linearGradient"in i?(copyBackgroundLinearGradientCssProp(e.displayDiv,i.linearGradient),r=!1,n=!1):"radialGradient"in i?(copyBackgroundRadialGradientCssProp(e.displayDiv,i.radialGradient),r=!1,n=!1):"image"in i&&(copyBackgroundImage(e.displayDiv,i),n=!1,"color"in i&&(r=!1)),r&&assignCSSStyleProp(e.displayDiv.style,"backgroundColor",""),void(n&&assignCSSStyleProp(e.displayDiv.style,"background-image",""));case"borderTopLeftRadius":case"borderTopRightRadius":case"borderBottomLeftRadius":case"borderBottomRightRadius":return void assignCSSStylePropToElements(e,["displayDiv","frameDiv"],t,num2Pixel(i));case"boxShadow":if(""===i||e.independentContentPosition)e.frameDiv&&(e.frameDiv.style.overflow="hidden"),assignCSSStyleProp(e.displayDiv.style,t,"");else{var o="";i instanceof Array||(i=[i]);for(var s=0;s!==i.length;s++)void 0!==i[s].color&&void 0!==i[s].horizontal&&void 0!==i[s].vertical&&(0!==s&&(o+=", "),i[s].inset&&(o+="inset "),o+=num2Pixel(i[s].horizontal)+" "+num2Pixel(i[s].vertical),void 0!==i[s].blurRadius&&(o+=" "+num2Pixel(i[s].blurRadius),void 0!==i[s].spread&&(o+=" "+num2Pixel(i[s].spread))),o+=" "+getDeOSedValue(i[s].color));e.frameDiv&&(e.frameDiv.style.overflow=""!==o?"visible":"hidden"),assignCSSStyleProp(e.displayDiv.style,t,o)}return;case"borderStyle":case"borderWidth":case"borderColor":case"borderLeftStyle":case"borderLeftWidth":case"borderLeftColor":case"borderRightStyle":case"borderRightWidth":case"borderRightColor":case"borderTopStyle":case"borderTopWidth":case"borderTopColor":case"borderBottomStyle":case"borderBottomWidth":case"borderBottomColor":case"overflowX":case"overflowY":case"paddingTop":case"paddingBottom":case"paddingLeft":case"paddingRight":case"opacity":return void assignCSSStyleProp(e.displayDiv.style,t,i);case"filter":return void assignCSSStyleProp(e.displayDiv.style,t,getCSSFilterString(i));case"hoverText":return void(e.displayDiv.title=i);case"windowTitle":return void("string"==typeof i&&(document.title=i));case".tag":return;case"transform":return void e.applyHTMLTransform(i);default:return void mondriaAuthorError("Unsupported attribute: "+t+"="+vstringify(i))}}function getCSSFilterString(e){var t="",i={dropShadow:"drop-shadow",hueRotate:"hue-rotate"},r={blur:"px",hueRotate:"deg"};if(!(e&&e instanceof Object))return"";for(var n in e){var o=getDeOSedValue(e[n]);"number"==typeof o&&n in r&&(o+=r[n]),n in i&&(n=i[n]),t+=" "+n+"("+o+")"}return t}function copyTransitionCssProp(e,t,i){function r(e){var t="";for(var r in i)if(e===elementTransitionProperties[r])for(var n=(r in cssPropTranslationTable?cssPropTranslationTable[r]:r),o=i[r],s=0;n instanceof Array&&s<n.length||s<1;s++){var a=n instanceof Array?n[s]:n;switch(t.length>0&&(t+=","),t+=a+" ",o instanceof Array&&(o=o[0]),typeof o){case"number":t+=o+"s";break;case"string":t+=o;break;case"object":"duration"in o&&(t+="number"==typeof o.duration?o.duration+"s":o.duration,"timingFunction"in o&&(t+=" "+o.timingFunction,"delay"in o&&(t+=" "+o.delay)))}}return t}e.setProperty("transition",r(void 0)),void 0!==t&&void 0!==t.root&&t.root.style.setProperty("transition",r(!0))}function resetTransitionCssProp(e,t){e.removeProperty("transition"),void 0!==t&&void 0!==t.root&&t.root.style.removeProperty("transition")}function copyDisplayTypeCssProp(e,t,i,r){if(void 0!==t&&void 0!==t.format){switch(r=getDeOSedValue(r),e){case"text":case"html":switch(i){case"value":case"numericFormat":case"dateFormat":case"input":case"handleClick":return}break;case"image":switch(i){case"URL":return}}switch(i){case"clip":break;case"textFillColor":case"textStrokeColor":case"fontFamily":case"fontStyle":case"fontWeight":case"fontVariant":case"color":case"textDecoration":case"borderSpacing":assignCSSStyleProp(t.format.style,i,r);break;case"textStrokeWidth":case"fontSize":assignCSSStyleProp(t.format.style,i,num2Pixel(r));break;case"overflow":case"whiteSpace":case"lineHeight":case"textAlign":case"textIndent":case"textTransform":case"verticalAlign":void 0!==t.content&&assignCSSStyleProp(t.content.style,i,r);break;case"textShadow":if(t.type in elementsWithTextProperties&&t.format){r=ensureOS(r);for(var n="",o=0;o!==r.length;o++)0!==o&&(n+=", "),n+=num2Pixel(r[o].horizontal)+" "+num2Pixel(r[o].vertical),r[o].blurRadius&&(n+=" "+num2Pixel(r[o].blurRadius)),n+=" "+getDeOSedValue(r[o].color);assignCSSStyleProp(t.format.style,i,""===n?"none":n)}break;default:return void mondriaAuthorError("Unsupported attribute: "+i+"="+JSON.stringify(r))}}}function getTransformObjectAsString(e,t,i){var r="";return e instanceof Object&&("number"==typeof e.rotate&&(r+="text"===t?"translateX(-50%) translateX("+i/2+"px) rotate("+e.rotate+"deg) ":"rotate("+e.rotate+"deg) "),"number"==typeof e.scale?r+="scale("+e.scale+") ":e.scale instanceof Object&&("number"==typeof e.scale.x&&(r+="scaleX("+e.scale.x+") "),"number"==typeof e.scale.y&&(r+="scaleY("+e.scale.y+") ")),void 0!==e.flip&&("horizontally"===e.flip||e.flip instanceof Array&&e.flip.indexOf("horizontally")!==-1?r+="matrix(-1,0,0,1,0,0) ":("vertically"===e.flip||e.flip instanceof Array&&e.flip.indexOf("vertically")!==-1)&&(r+="matrix(1,0,0,-1,0,0) "))),r}function ContentDisplay(){this.displayDiv=void 0,this.descriptionDisplay=void 0,this.prevProperties=void 0,this.prevDisplayType=void 0,this.displayType=void 0,this.displayElement=void 0,this.showEmbedding=!0,this.extraWidth=0,this.extraHeight=0}function Display(e){this.ContentDisplay(),this.baseArea=e,this.frameDiv=createDiv(e.areaId),this.frameZ="",this.displayZ="",this.embeddingDiv=null,this.independentContentPosition=!1}function getValueForCSSStyle(e){return e instanceof Array?1===e.length?e[0]:"":e instanceof Object?"":e}function getNumberForCSSStyle(e){var t=Number(getValueForCSSStyle(e));return isNaN(t)?0:t}function SurveyDisplay(e,t){requireSurveyMode(),this.areaId=e,this.surveyor=t,this.swidth=void 0,this.sheight=void 0}function createScreenArea(){var e="1:1",t={areaId:e};globalScreenWidthConstraint=new PosConstraint(t,void 0,"screenWidth"),globalScreenHeightConstraint=new PosConstraint(t,void 0,"screenHeight"),runTests?document.body.style.setProperty("overflow","scroll"):handleScreenAreaResize()}function updateScreenAreaPosition(){var e=determineScreenAreaSize();globalScreenWidthConstraint.newDescription({point1:{type:"left"},point2:{type:"right"},equals:e.width,priority:1e4},1e4),globalScreenHeightConstraint.newDescription({point1:{type:"top"},point2:{type:"bottom"},equals:e.height,priority:1e4},1e4),gDomEvent.resizeScreenArea(e.width,e.height)}function handleScreenAreaResize(){function e(){globalScreenResizeTask.schedule()}window.addEventListener?window.addEventListener("resize",e,!1):window.attachEvent&&window.attachEvent("onresize",e)}function determineScreenAreaSize(){return runTests?{width:1517,height:714}:void 0!==window.innerWidth?{width:window.innerWidth,height:window.innerHeight}:void 0!==document.documentElement&&void 0!==document.documentElement.clientWidth&&0!==document.documentElement.clientWidth?{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}:{width:document.getElementsByTagName("body")[0].clientWidth,height:document.getElementsByTagName("body")[0].clientHeight}}function IntersectionChain(e,t,i){var r=t.areaId,n=e.areaId;this.referredArea=t,this.expressionArea=e,this.fullChain={},this.fullChain[r]=!0,this.fullChain[n]=!0,this.referred={},this.referred[r]=!0,this.expressions={},this.expressions[n]={},this.expressions[n][i]=!0,this.mergeIntersectionChain(t),this.mergeIntersectionChain(e)}function intersectionChainMergeIntersectionChain(e){var t,i,r=e.intersectionChain;if(r){for(t in r.fullChain)this.fullChain[t]=!0;for(i in r.referred)this.referred[i]=!0;for(i in r.expressions){this.expressions[i]||(this.expressions[i]={});for(t in r.expressions[i])this.expressions[i][t]=!0}}}function chainsAllowIntersection(e,t,i){return void 0===e.intersectionChain||!e.intersectionChain.expressions[t.areaId]||!e.intersectionChain.expressions[t.areaId][i]}function intersectionChainContains(e){return e&&this.fullChain[e.areaId]}function posPointLabelSuffixSuffix(e,t,i){return(t&&e&&!e.isInZeroContentOffsetMode()?"c":"f")+(i?"i":"")}function leftSuffix(e,t,i){return"l"+posPointLabelSuffixSuffix(e,t,i)}function leftFrameSuffix(){return leftSuffix(void 0,!1,!1)}function rightSuffix(e,t,i){return"r"+posPointLabelSuffixSuffix(e,t,i)}function rightFrameSuffix(){return rightSuffix(void 0,!1,!1)}function topSuffix(e,t,i){return"t"+posPointLabelSuffixSuffix(e,t,i)}function topFrameSuffix(){return topSuffix(void 0,!1,!1)}function bottomSuffix(e,t,i){return"b"+posPointLabelSuffixSuffix(e,t,i)}function bottomFrameSuffix(){return bottomSuffix(void 0,!1,!1)}function centerSuffix(e,t,i){return"c"+(t?"v":"h")+posPointLabelSuffixSuffix(e,i,!1)}function centerFrameSuffix(e){return centerSuffix(void 0,e,!1)}function leftLabel(e,t,i){return pointId(e.areaId+leftSuffix(e,t,i))}function leftFrameLabel(e){return pointId(e+leftFrameSuffix())}function rightLabel(e,t,i){return pointId(e.areaId+rightSuffix(e,t,i))}function rightFrameLabel(e){return pointId(e+rightFrameSuffix())}function topLabel(e,t,i){return pointId(e.areaId+topSuffix(e,t,i))}function topFrameLabel(e){return pointId(e+topFrameSuffix())}function bottomLabel(e,t,i){return pointId(e.areaId+bottomSuffix(e,t,i))}function bottomFrameLabel(e){return pointId(e+bottomFrameSuffix())}function centerLabel(e,t,i){return pointId(e.areaId+centerSuffix(e,t,i))}function centerFrameLabel(e,t){return pointId(e+centerFrameSuffix(t))}function edgeLabel(e,t,i){if(t in posPointLabelFuncByEdge)return posPointLabelFuncByEdge[t](e,i)}function edgeFrameLabel(e,t){if(t in posPointFrameLabelFuncByEdge)return posPointFrameLabelFuncByEdge[t](e)}function labelBySuffix(e,t){var i;return i="function"==typeof t?t(allAreaMonitor.getAreaById(e)):t,pointId(e+i)}function rvLabel(e,t,i,r){return edgeFrameLabel(e+(r?"rvi":"rv")+t,i)}function getEdgeSuffixFunction(e,t,i){var r=e+!!t+!!i;if(!edgePointSuffixFunctions[r])switch(e){case"left":edgePointSuffixFunctions[r]=function(e){return leftSuffix(e,t,i)};break;case"right":edgePointSuffixFunctions[r]=function(e){return rightSuffix(e,t,i)};break;case"top":edgePointSuffixFunctions[r]=function(e){return topSuffix(e,t,i)};break;case"bottom":edgePointSuffixFunctions[r]=function(e){return bottomSuffix(e,t,i)};break;default:return void mondriaInternalError("suffix function type not supported: ",e)}return edgePointSuffixFunctions[r]}function getCenterSuffixFunction(e,t){var i=""+!!e+!!t;return centerPointSuffixFunctions[i]||(centerPointSuffixFunctions[i]=function(i){return centerSuffix(i,e,t)}),centerPointSuffixFunctions[i]}function pointId(e){return e in globalPointLabelIds?globalPointLabelIds[e]:globalPointLabelIds[e]=nextPointLabelId++}function RVPosPoint(e,t){this.posPoint=t,this.type=void 0,this.rvuid="rvp"+ ++RVPosPoint.uid,this.elem={visibilityOf:{tag:["visibilityOf",this.rvuid],id:{}},relativeTo:{tag:["relativeTo",this.rvuid],id:{}}},this.labels={}}function rvPosPointGetNextUid(){return++RVPosPoint.nextUid}function rvPosPointDestroy(){this.removeAllLabels(),this.cleanElement("visibilityOf"),this.cleanElement("relativeTo")}function rvPosPointNewDescription(e){e||(e={});var t=isTrue(e.includeFrame),i=this.includeFrame!==t;this.includeFrame=t,i&&(this.includeFrame?this.destroyEmbeddingChangeRequests():this.embeddingChangeRequests={});var r=this.type!=getDeOSedValue(e.type);(r||i)&&(this.type=void 0,this.removeAllLabels()),e.visibilityOf?this.setElement("visibilityOf","id",e.visibilityOf):this.setElement("visibilityOf",void 0),e.relativeTo?this.setElement("relativeTo","id",e.relativeTo):this.setElement("relativeTo",void 0),(r||i)&&(this.type=getDeOSedValue(e.type),this.createAllLabels())}function rvPosPointDestroyEmbeddingChangeRequests(){for(var e in this.embeddingChangeRequests)allAreaMonitor.removeAreaSpecificCallBack("change",this.embeddingChangeRequests[e]);delete this.embeddingChangeRequests}function rVPosPointSetElement(e,t,i){var r=this.elem[e];assert("object"==typeof r),r.type===t&&r.val===i||(this.cleanElement(e),r.type=t,r.val=i.getElement(),"undefined"==typeof t||"id"===t&&this.addIdRef(e,"id",r.val))}function rVPosPointCleanElement(e){var t=this.elem[e];"undefined"!=typeof t&&("undefined"==typeof t.type||"id"===t.type&&this.removeIdRef(e,"id",t.val),delete t.type,delete t.val)}function rVPosPointAddIdRef(e,t,i){var r=this.elem[e].id,n=r[i];"undefined"==typeof n&&(n=r[i]={},this.addId(e,i)),assert(!(t in n)),n[t]=!0}function rVPosPointRemoveIdRef(e,t,i){var r=this.elem[e].id,n=r[i];assert("undefined"!=typeof n),assert(t in n),delete n[t],isEmptyObj(n)&&(delete r[i],this.removeId(e,i))}function rVPosPointAddId(e,t){this.addRemoveId(!0,e,t)}function rVPosPointRemoveId(e,t){this.addRemoveId(!1,e,t)}function rVPosPointAddRemoveId(e,t,i){var r,n,o="relativeTo"===t?"visibilityOf":"relativeTo",s=this.elem[o].id;"visibilityOf"===t?r=i:n=i;for(var a in s)"visibilityOf"===t?n=a:r=a,e?this.addAreaPair(r,n):this.removeAreaPair(r,n);this.posPoint.applyChanges()}function rvPosPointCreateAllLabels(){for(var e in this.elem.visibilityOf.id)for(var t in this.elem.relativeTo.id)this.addAreaPair(e,t);this.posPoint.applyChanges()}function rvPosPointRemoveAllLabels(){for(var e in this.elem.visibilityOf.id)for(var t in this.elem.relativeTo.id)this.removeAreaPair(e,t)}function rvPosPointAddAreaPair(e,t,i){var r=this.isSimple(e,t);this.includeFrame||e==t||void 0===this.embeddingChangeRequests[e]&&(this.embeddingChangeRequests[e]=allAreaMonitor.addAreaSpecificCallBack("change",e,this,this.updateEmbedding));var n=allAreaMonitor.getAreaById(e),o=r&&!n.isInIndependentContentPositionMode();if("undefined"!=typeof this.type){var s=o?edgeLabel(n,this.type,!n.isInZeroContentOffsetMode()):rvLabel(e,t,this.type,this.includeFrame);this.posPoint.addLabel(s)}var a;a=o||"undefined"==typeof this.type?[s,void 0]:n.allPosConstraints.addRVPointConstraints(s,t,this.type,this.includeFrame,r),this.labels[e]||(this.labels[e]={}),this.labels[e][t]=a,r&&!i&&this.registerToContentPosModule(e,t)}function rvPosPointRemoveAreaPair(e,t,i){if(this.labels[e]){var r=this.labels[e][t];if(r){var n=r[0];if(void 0!==r[1]){var o=allAreaMonitor.getAreaById(e);o&&o.allPosConstraints.removeAutomaticPointConstraints(r)}if(this.posPoint.removeLabel(n),delete this.labels[e][t],isEmptyObj(this.labels[e])&&(delete this.labels[e],this.embeddingChangeRequests)){var s=this.embeddingChangeRequests[e];void 0!==s&&allAreaMonitor.removeAreaSpecificCallBack("change",s),delete this.embeddingChangeRequests[e]}i||this.unregisterFromContentPosModule(e,t)}}}function rvPosPointUpdateEmbedding(e,t,i,r,n){if(r!=n){var o,s=this.labels[i][r];if(r&&s&&(this.unregisterFromContentPosModule(i,r),void 0===s[1]?(this.removeAreaPair(i,r,!1),this.addAreaPair(i,r,!1)):(o=allAreaMonitor.getAreaById(i),o&&o.allPosConstraints.updateRVPointSimplicity(s[0],!1))),s=this.labels[i][n],n&&s){if(this.registerToContentPosModule(i,n),o=allAreaMonitor.getAreaById(i),!o)return;o.isInIndependentContentPositionMode()?o.allPosConstraints.updateRVPointSimplicity(s[0],!0):(this.removeAreaPair(i,r,!1),this.addAreaPair(i,r,!1))}this.posPoint.applyChanges()}}function rvPosPointIsSimple(e,t){return e==t||!this.includeFrame&&t==RVPosPoint.getEmbeddingId(e)}function rvPosPointRegisterToContentPosModule(e,t){if(this.isSimple(e,t)){void 0===this.uid&&(this.uid=this.getNextUid());var i=allAreaMonitor.getAreaById(e);i&&i.contentPosManager.registerAllModeChange("rvPoint",this.uid,this)}}function rvPosPointUnregisterFromContentPosModule(e,t){if(this.isSimple(e,t)){var i=this.labels[e];if(i)if(e!=t){if(i[e])return}else if(!this.includeFrame){var r=RVPosPoint.getEmbeddingId(e);if(r&&i[r])return}var n=allAreaMonitor.getAreaById(e);n&&n.contentPosManager.unregisterAllModeChange("rvPoint",this.uid)}}function rvPosPointContentOffsetModeChange(e,t,i){var r=this.labels[e];if(r){if(r[e]&&(this.removeAreaPair(e,e,!1),this.addAreaPair(e,e,!1)),!this.includeFrame){var n=RVPosPoint.getEmbeddingId(e);r[n]&&(this.removeAreaPair(e,n,!1),this.addAreaPair(e,n,!1))}this.posPoint.applyChanges()}}function rvPosPointGetEmbeddingId(e){var t=areaRelationMonitor.getEmbeddingId(e);return void 0===t?void 0:t.getElement()}function SuffixPosPoint(e,t,i){this.baseAreaId=e,this.posPoint=t,this.isLabel=i,this.label={},this.attr={},this.areas={}}function suffixPosPointDestroy(){this.destroyAllLabels()}function suffixPosPointNewDescription(e){var t=!1,i=this.isLabel?this.labelAttrs:this.typeAttrs;for(var r in i){var n=e?e[r]:void 0,o=n instanceof Array?n[0]:n;switch(r){case"element":(void 0===this.attr[r]&&void 0!==n||void 0!==this.attr[r]&&void 0===n)&&(t=!0),this.attr[r]=n;break;case"intersection":o=!!o&&getDeOSedValue(e.type)in PosPoint.definedEdgeTypes;case"label":case"type":case"content":this.attr[r]!==o&&(t=!0,this.attr[r]=o)}}var s=!!this.attr.content;if(t)if(this.destroyAllLabels(),this.isZMTRegistered=s,void 0===this.attr.element)this.addArea(this.baseAreaId);else if(this.attr.element instanceof Array)for(var a=0;a!==this.attr.element.length;a++){var d=this.attr.element[a];d instanceof ElementReference&&this.addArea(d.getElement())}else this.attr.element instanceof ElementReference&&this.addArea(this.attr.element.getElement());else{s!=this.isZMTRegistered&&(this.allAreasRegisterZeroModeToggle(s),this.isZMTRegistered=s);var u={};if(void 0===this.attr.element)u[this.baseAreaId]=!0;else if(this.attr.element instanceof Array)for(var a=0;a!==this.attr.element.length;a++){var d=this.attr.element[a];d instanceof ElementReference&&(u[d.getElement()]=!0)}else this.attr.element instanceof ElementReference&&(u[this.attr.element.getElement()]=!0);this.updateAreas(u)}this.posPoint.callHandlers()}function suffixPosPointDestroyAllLabels(){for(var e in this.label)this.removeAreaLabel(e);this.areas={}}function suffixPosPointCreateAreaLabel(e){var t,i,r,n,o,s,a;if(this.isLabel){if(void 0===this.attr.label)return;i=this.labelPrefixStr+this.attr.label}else r=this.attr.type,n=this.attr.content,o=this.attr.intersection,i=this.getSuffixFunc(r,n,o);void 0!==i&&(t=labelBySuffix(e,i),this.label[e]=t,this.posPoint.addLabel(t),"horizontal-center"==r||"vertical-center"==r?(a=allAreaMonitor.getAreaById(e),a&&(s=a.allPosConstraints.addCenterPointConstraints(t,r,n))):o&&(a=allAreaMonitor.getAreaById(e),a&&(s=a.allPosConstraints.addIntersectionPointConstraints(t,r,n))),s&&(this.autoConstraintIds||(this.autoConstraintIds={}),this.autoConstraintIds[e]=s),this.isZMTRegistered&&this.registerZeroModeToggle(e))}function suffixPosPointUpdateAreas(e){for(var t in this.areas)t in e||this.removeArea(t);for(var t in e)t in this.areas||this.addArea(t)}function suffixPosPointAddArea(e){e in this.areas?this.areas[e]++:(this.createAreaLabel(e),this.areas[e]=1)}function suffixPosPointRemoveArea(e){assert(e in this.areas&&this.areas[e]>=0,"area count"),this.areas[e]--,0===this.areas[e]&&(this.removeAreaLabel(e),delete this.areas[e])}function suffixPosPointRemoveAreaLabel(e){var t=this.label[e];if(t&&this.posPoint.removeLabel(t),this.autoConstraintIds){var i=this.autoConstraintIds[e];if("undefined"!=typeof i){var r=allAreaMonitor.getAreaById(e);r&&r.allPosConstraints.removeAutomaticPointConstraints(i),delete this.autoConstraintIds[e]}}delete this.label[e],this.isZMTRegistered&&this.unregisterZeroModeToggle(e)}function suffixPosPointGetSuffixFunc(e,t,i){switch(e){case"left":case"right":case"top":case"bottom":return getEdgeSuffixFunction(e,t,i);case"horizontal-center":return getCenterSuffixFunction(!1,t);case"vertical-center":return getCenterSuffixFunction(!0,t);case void 0:return;default:return void mondriaInternalError("unsupported point type: ",e)}}function suffixPosPointZeroOffsetToggle(e,t){assert(e in this.label),this.removeAreaLabel(e),this.createAreaLabel(e),this.posPoint.applyChanges()}function suffixPosPointAllAreasRegisterZeroModeToggle(e){for(var t in this.areas)e?this.registerZeroModeToggle(t):this.unregisterZeroModeToggle(t)}function suffixPosPointRegisterZeroModeToggle(e){var t=allAreaMonitor.getAreaById(e);if(this.isZMTRegistered&&("undefined"==typeof this.uid&&(this.uid=++suffixPosPointNextUid),t)){var i=t.contentPosManager;i.registerZeroOffsetModeToggle("suffixPosPoint",this.uid,this)}}function suffixPosPointUnregisterZeroModeToggle(e){var t=allAreaMonitor.getAreaById(e);if(t){var i=t.contentPosManager;
i.unregisterZeroOffsetModeToggle("suffixPosPoint",this.uid)}}function PosPoint(e,t,i,r){this.areaId=e.areaId,this.labels={},this.changes={},this.handlerId=0,this.handlers=[],this.name=i,this.pointNr=r}function posPointDestroyPoint(){this.descriptionRefresh=!0,this.callReleaseElementFunctions(),this.impl&&(this.impl.destroy(),delete this.impl),delete this.descriptionRefresh}function posPointCallReleaseElementFunctions(){if(this.releaseElementFunctions)for(var e=this.releaseElementFunctions,t=0;t!=e.call.length;t++)e.call[t](e.paid)}function posPointAddLabel(e){e in this.labels||(this.labels[e]=!0,"removed"==this.changes[e]?delete this.changes[e]:this.changes[e]="added")}function posPointRemoveLabel(e){this.labels[e]&&(delete this.labels[e],"added"==this.changes[e]?delete this.changes[e]:this.changes[e]="removed")}function posPointRemoveAllLabels(){for(var e in this.labels)this.removeLabel(e)}function posPointGetLabels(){return this.labels}function posPointNewDescription(e){var t=this.determineType(e);if(this.descriptionRefresh=!0,!this.impl||this.type!=t)switch(this.impl&&(this.impl.destroy(),delete this.impl),this.type=t,t){case void 0:this.impl=new UndefinedPosPoint(this.areaId,this),this.callHandlersSuppressed=!0;break;case"relativeVisibility":this.impl=new RVPosPoint(this.areaId,this);break;case"canvas":assert(!1,"unsupported type");break;case"label":this.impl=new SuffixPosPoint(this.areaId,this,!0);break;case"type":this.impl=new SuffixPosPoint(this.areaId,this,!1);break;case"globalLabel":this.impl=new GlobalLabelPosPoint(this.areaId,this);break;case"internalLabel":this.impl=new InternalLabelPosPoint(this.areaId,this)}this.impl.newDescription(e),delete this.descriptionRefresh,this.callHandlersSuppressed&&(delete this.callHandlersSuppressed,this.callHandlers())}function posPointDetermineType(e){if(e)return"object"!=typeof e?"globalLabel":void 0!==e.internal?"internalLabel":void 0!==e.visibilityOf?"relativeVisibility":void 0!==e.value?"canvas":void 0!==e.label?"label":void 0!==e.type?"type":void 0}function isAPosPointDescription(e){var t=PosPoint.prototype.determineType(e);return void 0!==t}function posPointRegisterHandler(e){if(!e||"function"!=typeof e.call)return void mondriaInternalError("registering improper handler object: ",e);var t=this.handlerId++;return this.handlers[t]=e,t}function posPointRemoveHandlerById(e){delete this.handlers[e]}function posPointRemoveHandler(e){for(var t in this.handlers)this.handlers[t]==e&&this.removeHandlerById(t)}function posPointApplyChanges(){this.descriptionRefresh?this.callHandlersSuppressed=!0:this.callHandlers()}function posPointCallHandlers(){for(var e in this.handlers)this.handlers[e].call(null,this);this.changes={}}function UndefinedPosPoint(){}function undefinedPosPointDestroy(){}function undefinedPosPointNewDescription(){}function GlobalLabelPosPoint(e,t){this.posPoint=t}function globalLabelPosPointDestroy(){this.posPoint.removeLabel(this.label)}function globalLabelPosPointNewDescription(e){this.label=this.constPrefixStr+String(e),this.posPoint.addLabel(this.label),this.posPoint.callHandlers()}function InternalLabelPosPoint(e,t){this.posPoint=t}function internalLabelPosPointDestroy(){this.posPoint.removeLabel(this.label)}function internalLabelPosPointNewDescription(e){this.posPoint.removeAllLabels(),this.label=e.internal,this.posPoint.addLabel(this.label),this.posPoint.callHandlers()}function PosPair(e,t,i,r){this.areaId=e,this.name=r,this.points=[new PosPoint(e,t,r,0),new PosPoint(e,t,r,1)],this.changes={},this.nextHandlerId=1,this.labels={},this.handlers={},this.dontCallHandlers=!1,this.points[0].registerHandler(new PairPointHandler(this,0)),this.points[1].registerHandler(new PairPointHandler(this,1)),i&&this.newDescription(i)}function posPairDestroyPair(){this.points[0].destroyPoint(),this.points[1].destroyPoint()}function posPairNewDescription(e){this.dontCallHandlers=!0,e?(this.points[0].newDescription(e.point1),this.points[1].newDescription(e.point2)):(this.points[0].newDescription(void 0),this.points[1].newDescription(void 0)),this.dontCallHandlers=!1,this.callHandlers()}function PosPair_updatePointsDescription(e,t){this.points[0].newDescription(e),this.points[1].newDescription(t)}function posPairPointHandler(e,t){var i,r=t?this.points[0]:this.points[1];for(var n in e.changes)if("removed"==e.changes[n])for(i in r.getLabels())t?this.removePair(i,n):this.removePair(n,i);else for(i in r.getLabels())t?this.addPair(i,n):this.addPair(n,i);this.dontCallHandlers||this.callHandlers()}function posPairAddPair(e,t){this.labels[e]||(this.labels[e]={}),this.labels[e][t]=!0,this.changes[e]||(this.changes[e]={}),"removed"==this.changes[e][t]?delete this.changes[e][t]:this.changes[e][t]="added"}function posPairRemovePair(e,t){this.labels[e]&&(delete this.labels[e][t],isEmptyObj(this.labels[e])&&delete this.labels[e]),this.changes[e]||(this.changes[e]={}),"added"==this.changes[e][t]?delete this.changes[e][t]:this.changes[e][t]="removed"}function posPairRegisterHandler(e){if(!e||"function"!=typeof e.call)return void mondriaInternalError("registering improper handler object: ",e);var t=this.handlers[this.nextHandlerId]=e;return++this.nextHandlerId,t}function posPairRemoveHandlerById(e){delete this.handlers[e]}function posPairRemoveHandler(e){for(var t in this.handlers)this.handlers[t]==e&&delete this.handlers[t]}function posPairCallHandlers(){for(var e in this.handlers)this.handlers[e].call(null,this,this.name);this.changes={}}function PairPointHandler(e,t){this.posPair=e,this.pointNum=t}function pairPointHandlerCall(e,t){this.posPair&&this.posPair.pointHandler(t,this.pointNum)}function nextPosConstraintId(){return++posConstraintLastId}function PosConstraint(e,t){this.baseArea=e,this.id=nextPosConstraintId(),this.pairs=[],this.ids={},this.idByPair=[{},{}],this.pairChanges=[{},{}],this.dontProcessPairChanges=!1,this.name=t}function posConstraintNewDescription(e,t){if(mustBeLinearConstraint(e))if("ratio"in e&&0===Number(getDeOSedValue(e.ratio))){var i={};i.point1=e.pair2.point1,i.point2=e.pair2.point2,i.equals=0,this.setSegmentConstraint(i,maxNonSystemPosPriority)}else this.setLinearConstraint(e,t);else this.setSegmentConstraint(e,t)}function mustBeLinearConstraint(e){return e&&e.pair1}function posConstraintSetType(e){return this.type!=e&&("linear"!=e&&"segment"!=e?e=void 0:this.type=e,!0)}function posConstraintCreateLinearId(e,t,i,r){return this.id+";"+e+";"+t+";"+i+";"+r}function posConstraintCreateSegmentId(e,t){return this.id+";"+e+";"+t}function posConstraintClearConstraintParameters(){this.priority=void 0,this.ratio=void 0,this.min=void 0,this.max=void 0,this.stability=void 0,this.preference=void 0,this.orGroups=void 0}function posConstraintDestroyConstraint(){this.removeAllConstraints(),this.pairs[0]&&this.pairs[0].destroyPair(),this.pairs[1]&&this.pairs[1].destroyPair()}function posConstraintRemoveAllConstraints(){for(var e in this.ids){var t=this.ids[e];2==t.length?globalPosConstraintSynchronizer.removeSegment(t[0],t[1],e):4==t.length&&this.removeLinearFromPosCalc(t,e)}this.ids={},this.idByPair[0]={},this.idByPair[1]={}}function posConstraintRemoveConstraintsByPair(e,t,i){if(this.idByPair[i]&&this.idByPair[i][e]){var r=this.idByPair[i][e][t];for(var n in r){var o=0;o<=ConsoleLogAttributes.constraints[0]&&mLogger("constraints",o,"removeConstraintsByPair: label1="+e+" label2="+t+" id="+n);var s=this.ids[n];2==s.length?globalPosConstraintSynchronizer.removeSegment(s[0],s[1],n):4==s.length&&this.removeLinearFromPosCalc(s,n),this.removeIdFromPairEntry(this.idByPair[0],n,s[0],s[1]),4==s.length&&this.removeIdFromPairEntry(this.idByPair[1],n,s[2],s[3]),delete this.ids[n]}}}function posConstraintAddIdUnderPairEntry(e,t,i,r){e[i]||(e[i]={}),e[i][r]||(e[i][r]={}),e[i][r][t]=!0}function posConstraintRemoveIdFromPairEntry(e,t,i,r){delete e[i][r][t],isEmptyObj(e[i][r])&&(delete e[i][r],isEmptyObj(e[i])&&delete e[i])}function posConstraintSetLinearConstraint(e,t){var i=this.setType("linear");i&&(this.removeAllConstraints(),this.clearConstraintParameters());var r,n=getDeOSedValue(e.ratio);r=void 0!=t?t:void 0!=e.priority?getDeOSedValue(e.priority):this.defaultPriority;for(var o=0;o<=1;++o)this.pairs[o]||(this.pairs[o]=new PosPair(this.baseArea,this.cm,this.name),this.pairs[o].registerHandler(new ConstraintPairHandler(this,o)));this.dontProcessPairChanges=!0,this.pairs[0].newDescription(e.pair1),this.pairs[1].newDescription(e.pair2),this.dontProcessPairChanges=!1,i?this.createAllLinearConstraints(n,r):this.updateChangedLinearConstraints(this.pairChanges[0],this.pairChanges[1],n,r),this.pairChanges[0]={},this.pairChanges[1]={}}function posConstraintCreateAllLinearConstraints(e,t){this.ratio=e,this.priority=t;for(var i in this.pairs[0].labels)for(var r in this.pairs[0].labels[i])for(var n in this.pairs[1].labels)for(var o in this.pairs[1].labels[n]){var s=this.createLinearId(i,r,n,o);this.addLinearConstraint(s,[i,r,n,o])}}function posConstraintUpdateChangedLinearConstraints(e,t,i,r){var n=[];if(n[0]=this.pairChangesRemoveAndCreateLinear(0,e),n[1]=this.pairChangesRemoveAndCreateLinear(1,t),i!==this.ratio||r!==this.priority){this.ratio=i,this.priority=r;for(var o in this.ids)this.updateLinearConstraint(o)}for(var s=0;s<=1;++s)for(var o in n[s])this.addLinearConstraint(o,n[s][o])}function posConstraintPairChangesRemoveAndCreateLinear(e,t){var i={},r=1-e;for(var n in t)for(var o in t[n])if("removed"==t[n][o])this.removeConstraintsByPair(n,o,e);else for(var s in this.pairs[r].labels)for(var a in this.pairs[r].labels[s])e?i[this.createLinearId(s,a,n,o)]=[s,a,n,o]:i[this.createLinearId(n,o,s,a)]=[n,o,s,a];return i}function posConstraintUpdateLinearConstraint(e){var t=this.ids[e];t&&4==t.length&&(void 0===this.ratio||void 0===this.priority?this.removeLinearFromPosCalc(t,e):this.addLinearToPosCalc(t,this.ratio,this.priority,e))}function posConstraintAddLinearConstraint(e,t){var i=0;i<=ConsoleLogAttributes.constraints[0]&&mLogger("constraints",i,"addLinearConstraint: p0="+t[0]+" p1="+t[1]+" p2="+t[2]+" p3="+t[3]+" id="+e),this.ids[e]=t,this.addIdUnderPairEntry(this.idByPair[0],e,t[0],t[1]),this.addIdUnderPairEntry(this.idByPair[1],e,t[2],t[3]),void 0!==this.ratio&&void 0!==this.priority&&this.addLinearToPosCalc(t,this.ratio,this.priority,e)}function posConstraintAddLinearToPosCalc(e,t,i,r){if(e[0]==e[1]){if(e[2]==e[3])return;globalPosConstraintSynchronizer.addSegment(e[2],e[3],r,maxNonSystemPosPriority,0,0)}else e[2]==e[3]?globalPosConstraintSynchronizer.addSegment(e[0],e[1],r,maxNonSystemPosPriority,0,0):globalPosConstraintSynchronizer.addLinear(e[0],e[1],e[2],e[3],t,i,r)}function posConstraintRemoveLinearFromPosCalc(e,t){if(e[0]==e[1]){if(e[2]==e[3])return;globalPosConstraintSynchronizer.removeSegment(e[2],e[3],t)}else e[2]==e[3]?globalPosConstraintSynchronizer.removeSegment(e[0],e[1],t):globalPosConstraintSynchronizer.removeLinearById(t)}function posConstraintUpdatePairChangesForLinear(e,t){var i=this.pairChangesRemoveAndCreateLinear(e,t);for(var r in i)this.addLinearConstraint(r,i[r])}function posConstraintSetSegmentConstraint(e,t){var i=this.setType("segment");i&&(this.removeAllConstraints(),this.clearConstraintParameters());var r,n=convertValueToPixels(getDeOSedValue(e.equals)),o="min"in e&&void 0!==e.min?convertValueToPixels(getDeOSedValue(e.min)):n,s="max"in e&&void 0!==e.max?convertValueToPixels(getDeOSedValue(e.max)):n,a=!!getDeOSedValue(e.stability);r=void 0!=t?t:void 0!=e.priority?getDeOSedValue(e.priority):this.defaultPriority;var d=getDeOSedValue(e.preference),u=e.orGroups;this.pairs[0]||(this.pairs[0]=new PosPair(this.baseArea,this.cm,void 0,this.name),this.pairs[0].registerHandler(new ConstraintPairHandler(this,0))),this.dontProcessPairChanges=!0,this.pairs[0].newDescription(e),this.dontProcessPairChanges=!1,i?this.createAllSegmentConstraints(o,s,a,r,d,u):this.updateChangedSegmentConstraints(this.pairChanges[0],o,s,a,r,d,u),this.pairChanges[0]={}}function posConstraintCreateAllSegmentConstraints(e,t,i,r,n,o){this.min=e,this.max=t,this.stability=i,this.priority=r,this.preference=n,this.orGroups=o;for(var s in this.pairs[0].labels)for(var a in this.pairs[0].labels[s]){var d=this.createSegmentId(s,a);this.addSegmentConstraint(d,[s,a])}}function posConstraintUpdateChangedSegmentConstraints(e,t,i,r,n,o,s){var a=this.pairChangesRemoveAndCreateSegment(e);if(this.min!=t||this.max!=i||this.stability!=r||this.priority!=n||this.preference!=o||this.orGroups||s){this.min=t,this.max=i,this.stability=r,this.priority=n,this.preference=o,this.orGroups=s;for(var d in this.ids)this.updateSegmentConstraint(d)}for(var u in a)this.addSegmentConstraint(u,a[u])}function posConstraintPairChangesRemoveAndCreateSegment(e){var t={};for(var i in e)for(var r in e[i])"removed"==e[i][r]?this.removeConstraintsByPair(i,r,0):t[this.createSegmentId(i,r)]=[i,r];return t}function posConstraintUpdateSegmentConstraint(e){var t=this.ids[e];t&&2==t.length&&globalPosConstraintSynchronizer.addSegment(t[0],t[1],e,this.priority,this.min,this.max,this.stability,this.preference,this.orGroups?{baseArea:this.baseArea,orGroupDesc:this.orGroups}:void 0)}function posConstraintAddSegmentConstraint(e,t){var i=0;i<=ConsoleLogAttributes.constraints[0]&&mLogger("constraints",i,"addSegmentConstraint: p0="+t[0]+" p1="+t[1]+" id="+e),this.ids[e]=t,this.addIdUnderPairEntry(this.idByPair[0],e,t[0],t[1]),globalPosConstraintSynchronizer.addSegment(t[0],t[1],e,this.priority,this.min,this.max,this.stability,this.preference,this.orGroups?{baseArea:this.baseArea,orGroupDesc:this.orGroups}:void 0)}function posConstraintUpdatePairChangesForSegment(e){var t=this.pairChangesRemoveAndCreateSegment(e);for(var i in t)this.addSegmentConstraint(i,t[i])}function posConstraintPairHandler(e,t){if(!this.pairs[t])return void mondriaInternalError("callback for non-existing pair: ",t);if(this.dontProcessPairChanges)for(var i in e.changes){var r=e.changes[i];this.pairChanges[t][i]||(this.pairChanges[t][i]={});var n=this.pairChanges[t][i];for(var o in r)n[o]?n[o]!=r[o]&&delete n[o]:n[o]=r[o]}else"linear"==this.type?this.updatePairChangesForLinear(t,e.changes):"segment"==this.type&&this.updatePairChangesForSegment(e.changes)}function ConstraintPairHandler(e,t){this.posConstraint=e,this.pairNum=t}function constraintPairHandlerCall(e,t){this.posConstraint&&this.posConstraint.pairHandler(t,this.pairNum)}function convertValueToPixels(e){if(e instanceof Array&&(e=e[0]),void 0!=e){if("number"==typeof e)return e;if("string"==typeof e){var t=Number(e);return isNaN(t)?void 0:t}}}function PosConstraintManager(e,t,i){this.baseArea=e,this.systemPositioning=!!t,this.groupConstraints={},this.constraints={},this.needToAddAutoConstraints=!0,e&&i&&this.newDescription(i)}function posConstraintManagerDestroyConstraints(){for(var e in this.constraints)this.constraints[e].constraint.destroyConstraint(),delete this.constraints[e];this.groupConstraints={},this.needToAddAutoConstraints=!0}function posConstraintManagerMakeInnerName(e){return"_"+e}function posConstraintManagerMakeConfName(e){return e.substr(1)}function posConstraintManagerRemoveConstraintsNotInDescription(e){for(var t in this.constraints)if(!this.constraints[t].automatic){var i=this.makeConfName(t);e&&(void 0!==e[i]||void 0!==this.groupConstraints[i]&&void 0!==e[this.groupConstraints[i]])||this.removeConstraint(t)}}function posConstraintManagerNewDescription(e){this.needToAddAutoConstraints&&(this.addAutoConstraints&&this.addAutoConstraints(),this.needToAddAutoConstraints=!1),this.removeConstraintsNotInDescription(e);for(var t in e)this.addNewConstraint(t,e)}function posConstraintManagerAddNewDescription(e,t){var i=t[e];if(i){var r=this.resolveGroupMembers(e,t);for(var n in r){n!=e&&(this.groupConstraints[n]=e);var o=i;this.getReservedConstraintNameEntry(n);this.addConstraint(n,o,!1)}}}function posConstraintManagerRemoveConstraint(e){var t=0;t<=ConsoleLogAttributes.constraints[0]&&mLogger("constraints",t,"removeConstraint: name="+e),this.constraints[e]&&(this.constraints[e].constraint.destroyConstraint(),delete this.constraints[e],delete this.groupConstraints[e])}function posConstraintManagerRemoveConstraintInnerName(e){this.removeConstraint(this.makeInnerName(e))}function posConstraintManagerAddConstraint(e,t,i,r){if(t&&i||(e=this.makeInnerName(e)),!t)return void this.removeConstraint(e);if("object"!=typeof t)return mondriaAuthorError('constraint "',i?e:this.makeConfName(e),'" is not a reserved constraint name'),void this.removeConstraint(e);this.constraints[e]||(this.constraints[e]={});var n=this.constraints[e];n.automatic=i,void 0===r&&(r=t.priority,void 0===r&&(r=defaultPosPriority)),!n.automatic&&!this.systemPositioning&&r>maxNonSystemPosPriority&&(r=maxNonSystemPosPriority),n.constraint||(n.constraint=new PosConstraint(this.baseArea,e)),n.constraint.newDescription(t,r)}function posConstraintManagerMakeLinearDesc(e,t,i,r,n){var o=e instanceof Array?this.makePointDesc.apply(this,e):e,s=t instanceof Array?this.makePointDesc.apply(this,t):t,a=i instanceof Array?this.makePointDesc.apply(this,i):i,d=r instanceof Array?this.makePointDesc.apply(this,r):r,u={pair1:{point1:o,point2:s},pair2:{point1:a,point2:d},ratio:n,priority:defaultPosPriority};return u}function posConstraintManagerMakeSegmentDesc(e,t,i,r){var n=e instanceof Array?this.makePointDesc.apply(this,e):e,o=t instanceof Array?this.makePointDesc.apply(this,t):t,s={point1:n,point2:o,min:i,max:r,priority:defaultPosPriority};return s}function posConstraintManagerMakePreferenceDesc(e,t,i){var r=e instanceof Array?this.makePointDesc.apply(this,e):e,n=t instanceof Array?this.makePointDesc.apply(this,t):t,o={point1:r,point2:n,preference:i,priority:defaultPosPriority};return o}function posConstraintManagerMakePointDesc(e,t,i){var r;return r=PosPoint.definedTypes[e]?{type:e}:{label:e},void 0!==t&&(r.element="string"==typeof t?[t]:t),r.type&&i&&(r.content=!0),r}function posConstraintManagerResolveGroupMembers(e,t){if(!this.reservedGroupNames){var i={};return i[e]=!0,i}return this.rResolveGroupMembers(e,t)}function posConstraintManagerRResolveGroupMembers(e,t){var i={};if(!(e in this.reservedGroupNames))return i[e]=!0,i;for(var r=this.reservedGroupNames[e],n=0;n<r.length;n++){var o=r[n];if(!(o in t)){var s=this.rResolveGroupMembers(o,t);for(var a in s)i[a]=!0}}return i}function isAPosConstraintDescription(e){return"point1"in e||"pair1"in e}function posConstraintManagerIsReservedPoint(e,t){switch(t){case"beforeOther":return e.isFirst;case"beforeEmbedding":return!e.isFirst}}function posConstraintManagerGetReservedConstraintNameEntry(e){return this.reservedNames?this.reservedNames[e]:void 0}function AllPosConstraints(e){this.systemPositioning=e.systemPositioning,this.initAutomaticPointConstraints(),this.PosConstraintManager(e,this.systemPositioning)}function allPosConstraintsDestroy(){this.removeAllAutomaticPointConstraints(),this.destroyConstraints()}function allPosConstraintsAddAutoConstraints(){this.baseArea.areaId;this.baseArea.isInAutoContentOffsetMode()&&this.setAllAutoContentConstraints(),this.recreateAutomaticPointConstraints()}function allPosConstraintsSetAutoContentConstraint(e,t){t||(t=0);var i;switch(e){case"left":case"top":i=this.makeSegmentDesc([e],[e,void 0,!0],t,t);break;case"right":case"bottom":i=this.makeSegmentDesc([e,void 0,!0],[e],t,t);break;default:return void mondriaInternalError("unknown auto content constraint edge: ",e)}i.priority=strongAutoPosPriority;var r=e+"-content-offset";this.addConstraint(r,i,!0)}function allPosConstraintsSetAllAutoContentConstraints(){var e=this.baseArea.contentPosManager;if(e)for(var t in ContentPosManager.edgeNames)this.setAutoContentConstraint(t,e.offsets[t])}function allPosConstraintsRemoveAutoContentConstraints(){for(var e in ContentPosManager.edgeNames)this.removeConstraint(e+"-content-offset")}function allPosConstraintsInitAutomaticPointConstraints(){this.automaticPointConstraints={}}function allPosConstraintsRemoveAllAutomaticPointConstraints(){for(var e in this.automaticPointConstraints){var t=this.automaticPointConstraints[e];this.doRemoveAutomaticPointConstraint(t)}}function allPosConstraintsRecreateAutomaticPointConstraints(){for(var e in this.automaticPointConstraints){var t=this.automaticPointConstraints[e];this.makeAutomaticPointConstraint(t)}}function allPosConstraintsMakeAutomaticPointConstraint(e){switch(e.type){case"center":this.makeCenterPointConstraints(e);break;case"intersection":this.makeIntersectionPointConstraints(e);break;case"rv":this.makeRVPointConstraints(e);break;default:mondriaInternalError("unexpected type '"+e.type+"'")}}function allPosConstraintsAddCenterPointConstraints(e,t,i){this.baseArea.isInZeroContentOffsetMode()&&(i=!1);var r=this.automaticPointConstraints[e];return r||(r=this.automaticPointConstraints[e]={use:new IdMgr,type:"center",label:e,centerType:t,isContent:i},this.makeAutomaticPointConstraint(r)),[e,r.use.allocate()]}function allPosConstraintsMakeCenterPointConstraints(e){var t,i,r;"horizontal-center"==e.centerType?(i="left",r="right"):(i="top",r="bottom"),t=this.makeLinearDesc([i,void 0,e.isContent],{internal:e.label},[i,void 0,e.isContent],[r,void 0,e.isContent],2),t.priority=strongAutoPosPriority;var n=(e.isContent?"content-":"")+e.centerType;this.addConstraint(n,t,!0),e.constraintNames={},e.constraintNames[n]=!0}function allPosConstraintsAddRVPointConstraints(e,t,i,r,n){var o=this.automaticPointConstraints[e];return o||(o=this.automaticPointConstraints[e]={use:new IdMgr,type:"rv",label:e,frameId:t,rvType:i,includeFrame:r,isSimple:n},this.makeAutomaticPointConstraint(o),n||(this.registerToContentPosModule(e),this.registerToEmbeddingChanges(e))),[e,o.use.allocate()]}function allPosConstraintsUpdateRVPointSimplicity(e,t){var i=this.automaticPointConstraints[e];if(i&&i.isSimple!=t)if(i.isSimple=t,t)this.removeRVPointConstraintsBySuffix(i,["e","oe"]),this.unregisterFromContentPosModule(e),this.unregisterFromEmbeddingChanges(e);else{var r=this.makeRVPointConstraintDescs(e,["e","oe"]);this.addRVPointConstraintsFromDesc(i,r),this.registerToContentPosModule(e),this.registerToEmbeddingChanges(e)}}function allPosConstraintsMakeRVPointConstraintDescs(e,t){var i=this.automaticPointConstraints[e];new ElementReference(e);if(i&&i.rvType){var r=i.rvType,n="left"==r||"top"==r,o={};for(var s in t){var a=t[s],d="o"==a[0];switch(o[a]={point1:{internal:e},priority:strongAutoPosPriority},d&&(o[a].orGroups=e),n^d?o[a].max=0:o[a].min=0,a){case"c":case"oc":o[a].point2={internal:edgeLabel(this.baseArea,r,!0)};break;case"f":case"of":o[a].point2={internal:edgeLabel(this.baseArea,r,!1)};break;case"e":case"oe":o[a].point2={visibilityOf:i.embeddingId,relativeTo:new ElementReference(i.frameId),type:r,includeFrame:i.includeFrame}}}return o}}function allPosConstraintsAddRVPointConstraintsFromDesc(e,t,i){var r,n={};e.constraintNames||(e.constraintNames={});for(var o in t){var s=t[o];r=e.label+"_"+o,n[r]=!0,this.addConstraint(r,s,!0),e.constraintNames[r]=!0}if(i&&e.constraintNames)for(r in e.constraintNames)n[r]||(this.removeConstraint(r),delete e.constraintNames[r])}function allPosConstraintsRemoveRVPointConstraintsBySuffix(e,t){var i=e.label;for(var r in t){var n=i+"_"+t[r];e.constraintNames[n]&&(delete e.constraintNames[n],this.removeConstraint(n))}}function allPosConstraintsMakeRVPointConstraints(e){var t=["c","oc"];this.baseArea.isInIndependentContentPositionMode()&&t.push("f","of"),e.isSimple||t.push("e","oe"),e.embeddingId=areaRelationMonitor.getEmbeddingId(this.baseArea.areaId);var i=this.makeRVPointConstraintDescs(e.label,t);this.addRVPointConstraintsFromDesc(e,i,!0)}function allPosConstraintsRVPointContentOffsetModeChange(e,t,i){if(t!=i){var r,n;if("zero"==i?(r=["c","oc"],"auto"==t&&(n=["f","of"])):"auto"==i?(r=["f","of"],"zero"==t&&(n=["c","oc"])):n="zero"==t?["c","oc"]:["f","of"],r&&this.removeRVPointConstraintsBySuffix(e,r),n){var o=this.makeRVPointConstraintDescs(e.label,n);this.addRVPointConstraintsFromDesc(e,o)}}}function allPosConstraintsRvPointEmbeddingChange(e,t,i){if(t!==this.embeddingId){assertFalse(e.isSimple),this.removeRVPointConstraintsBySuffix(e,["e","oe"]),this.embeddingId=t;var r=this.makeRVPointConstraintDescs(i,["e","oe"]);this.addRVPointConstraintsFromDesc(e,r)}}function allPosConstraintsAddIntersectionPointConstraints(e,t,i){var r=this.automaticPointConstraints[e];return r||(r=this.automaticPointConstraints[e]={use:new IdMgr,type:"intersection",label:e,intersectionType:t,isContent:i},this.makeAutomaticPointConstraint(r)),[e,r.use.allocate()]}function allPosConstraintsMakeIntersectionPointConstraints(e){var t,i=e.intersectionType,r=this.baseArea.getIntersectionParents();e.desc=[],e.constraintNames={};var n,o,s;if("undefined"==typeof r)return void mondriaAuthorHint("makeIntersectionPointConstraints: area "+this.baseArea.areaId+"is not an intersection area");for(var a=0;a<=1;a++){t=e.isContent?{element:r[a],type:i,content:!0}:{visibilityOf:r[a],type:i,includeFrame:!1};var d=e.desc[a]=[];for(d[0]={point1:{internal:e.label},point2:t,priority:strongAutoPosPriority},d[1]={point1:{internal:e.label},point2:t,priority:strongAutoPosPriority,orGroups:e.label},"left"==i||"top"==i?(d[0].max=0,d[1].min=0):(d[0].min=0,d[1].max=0),o=0;o<=1;o++)s=this.makeIntersectionConstraintName(e.label,a,o),e.constraintNames[s]=!0}if(e.isContent)for(n=0;n<=1;n++)for(o=0;o<=1;o++)s=this.makeIntersectionConstraintName(e.label,n,o),this.addConstraint(s,e.desc[n][o],!0);else{var u={};for(n=0;n<=1;n++){var h=r[n].getElement();u[h]=allAreaMonitor.getAreaById(h)}e.lceReqId=allAreaMonitor.registerLCE(u,this,this.lceHandler,e)}}function allPosConstraintsLceHandler(e,t,i){var r,n,o,s="undefined"==typeof t?void 0:t.areaId;if(s!==i.areaId){if("undefined"!=typeof i.areaId)for(o in i.constraintNames)this.removeConstraint(o);if(i.areaId=s,"undefined"!=typeof i.areaId)for(r=0;r<=1;r++)for(n=0;n<=1;n++){var a=i.desc[r][n];a.point2.relativeTo=new ElementReference(t.areaId),o=this.makeIntersectionConstraintName(i.label,r,n),this.addConstraint(o,i.desc[r][n],!0)}}}function allPosConstraintsMakeIntersectionConstraintName(e,t,i){return e+"_"+t+"_"+i}function allPosConstraintsRemoveAutomaticPointConstraints(e){var t=e[0],i=e[1],r=this.automaticPointConstraints[t];r&&(r.use.free(i),r.use.count()>0||(this.doRemoveAutomaticPointConstraint(r),delete this.automaticPointConstraints[t]))}function allPosConstraintsDoRemoveAutomaticPointConstraint(e){for(var t in e.constraintNames)this.removeConstraint(t);"rv"!=e.type||e.isSimple||this.unregisterFromContentPosModule(e.label),e.lceReqId&&allAreaMonitor.unregisterLCE(e.lceReqId)}function allPosConstraintsRegisterToContentPosModule(e){this.baseArea&&this.baseArea.contentPosManager.registerAllModeChange("autoConstraints",e,this,e)}function allPosConstraintsUnregisterFromContentPosModule(e){this.baseArea&&this.baseArea.contentPosManager.unregisterAllModeChange("autoConstraints",e)}function allPosConstraintsContentOffsetModeChange(e,t,i,r){var n=this.automaticPointConstraints[r];n&&"rv"===n.type&&this.rvPointContentOffsetModeChange(n,t,i)}function allPosConstraintsRegisterToEmbeddingChanges(e){var t=this.automaticPointConstraints[e],i=this.baseArea.areaId;t.embeddingChangeReqId=allAreaMonitor.addAreaSpecificCallBack("change",i,this,this.updateEmbedding,e)}function allPosConstraintsUnregisterFromEmbeddingChanges(e){var t=this.automaticPointConstraints[e],i=t.embeddingChangeReqId;assert("undefined"!=typeof i),allAreaMonitor.removeAreaSpecificCallBack("change",i),delete t.embeddingChangeReqId}function allPosConstraintsUpdateEmbedding(e,t,i,r,n){var o=this.automaticPointConstraints[t];assert(o),assert("rv"===o.type),this.rvPointEmbeddingChange(o,n,t)}function initPosConstraintSynchronizer(){globalPosConstraintSynchronizer=new PosConstraintSynchronizer,gArgParser.getArg("keepPosBuffer",!1)&&globalPosConstraintSynchronizer.logBuffers()}function initAbsolutePosManager(){globalAbsolutePosManager=new AbsolutePosManager}function AbsolutePosManager(){this.pairToOffset={},this.newOffsets={},this.changedAreas={}}function absolutePosManagerMakeEmptyPosObject(){return{left:0,width:0,top:0,height:0,exact:{left:0,width:0,top:0,height:0},error:{left:0,top:0}}}function absolutePosManagerAddArea(e,t){assert(e instanceof DisplayArea,"only DisplayArea allowed"),void 0!=t&&(assert(t instanceof DisplayArea,"only DisplayArea allowed"),this.addOffset(leftLabel(t,!0),leftLabel(e,!1),e.areaId,"left",!1),this.addOffset(topLabel(t,!0),topLabel(e,!1),e.areaId,"top",!1)),this.addOffset(leftLabel(e,!1),rightLabel(e,!1),e.areaId,"width",!1),this.addOffset(topLabel(e,!1),bottomLabel(e,!1),e.areaId,"height",!1),e.isInZeroContentOffsetMode()||this.addAreaContentOffsets(e)}function absolutePosManagerAddAreaContentOffsets(e){assert(e instanceof DisplayArea,"only DisplayArea allowed"),this.addOffset(leftLabel(e,!1),leftLabel(e,!0),e.areaId,"left",!0),this.addOffset(topLabel(e,!1),topLabel(e,!0),e.areaId,"top",!0),this.addOffset(leftLabel(e,!0),rightLabel(e,!0),e.areaId,"width",!0),this.addOffset(topLabel(e,!0),bottomLabel(e,!0),e.areaId,"height",!0),e.contentPos=AbsolutePosManager.makeEmptyPosObject(),e.contentPos.embedding=e,e.displayDivPos={},e.displayDivPos.embedding=e}function absolutePosManagerRemoveArea(e,t){assert(e instanceof DisplayArea,"only DisplayArea allowed"),assert(t instanceof DisplayArea,"only DisplayArea allowed"),void 0!=t&&(this.removeOffset(leftLabel(t,!0),leftLabel(e,!1)),this.removeOffset(topLabel(t,!0),topLabel(e,!1))),this.removeOffset(leftLabel(e,!1),rightLabel(e,!1)),this.removeOffset(topLabel(e,!1),bottomLabel(e,!1)),e.isInZeroContentOffsetMode()||this.removeAreaContentOffsets(e)}function absolutePosManagerRemoveAreaContentOffsets(e){assert(e instanceof DisplayArea,"only DisplayArea allowed"),this.removeOffset(leftLabel(e,!1),leftLabel(e,!0)),this.removeOffset(topLabel(e,!1),topLabel(e,!0)),this.removeOffset(leftLabel(e,!0),rightLabel(e,!0)),this.removeOffset(topLabel(e,!0),bottomLabel(e,!0)),delete e.contentPos,delete e.displayDivPos,this.changedAreas[e.areaId]=e}function absolutePosManagerNewEmbedding(e,t,i){assert(e instanceof DisplayArea,"only DisplayArea allowed"),void 0!=t&&(assert(t instanceof DisplayArea,"only DisplayArea allowed"),this.removeOffset(leftLabel(t,!0),leftLabel(e,!1)),this.removeOffset(topLabel(t,!0),topLabel(e,!1))),void 0!=i&&(assert(i instanceof DisplayArea,"only DisplayArea allowed"),this.addOffset(leftLabel(i,!0),leftLabel(e,!1),e.areaId,"left",!1),this.addOffset(topLabel(i,!0),topLabel(e,!1),e.areaId,"top",!1))}function absolutePosManagerAddOffset(e,t,i,r,n){var o=globalPos.addWatchedCalcPair(e,t,this,void 0),s=o.id;if(s in this.pairToOffset)return void mondriaInternalError("already have a registered pair for offset <",e,";",t,">");var a=globalPos.getOffsetByPairEntry(o);"number"==typeof a&&(this.newOffsets[s]=a);var d=this.pairToOffset[s]={};d.dir=o.dir,d.area=i,d.offset=r,d.isContent=n}function absolutePosManagerRemoveOffset(e,t){var i=globalPos.getPair(e,t);i&&(delete this.pairToOffset[i.id],delete this.newOffsets[i.id],globalPos.removeWatchedCalcPair(e,t,this,null))}function absolutePosManagerRefreshPos(){var e=globalPos.getChangedPairs();for(var t in this.newOffsets)t in e&&delete this.newOffsets[t];this.updatePairOffset(this.newOffsets),this.newOffsets={},this.updatePairOffset(e);for(var i in this.changedAreas)if(allAreaMonitor.exists(i)){var r=this.changedAreas[i];r.updatePos()}this.changedAreas={}}function absolutePosManagerUpdatePairOffset(e){for(var t in e){var i=this.pairToOffset[t];if(i){var r=allAreaMonitor.getAreaById(i.area),n=Math.round(1024*(i.dir*e[t]))/1024;"left"==i.offset||"top"==i.offset?this.updateCornerOffset(r,i.isContent,i.offset,n):this.updateSizeOffset(r,i.isContent,i.offset,n),i.isContent&&(r.displayDivPos[i.offset]=r.contentPos[i.offset],"left"!=i.offset&&"top"!=i.offset||(r.displayDivPos[i.offset]-=r.contentPosManager.getOffset(i.offset))),this.changedAreas[r.areaId]=r}}}function absolutePosManagerUpdateCornerOffset(e,t,i,r){var n,o=t?e.contentPos:e.relative;t?n=e.relative:e.relative.embedding&&(n=e.relative.embedding.contentPos?e.relative.embedding.contentPos:e.relative.embedding.relative),
void 0==r?r=o.exact[i]:o.exact[i]=r;var s=r+(n?n.error[i]:0),a=o[i];o[i]=Math.round(s),a!=o[i]&&(this.changedAreas[e.areaId]=e);var d=o.error[i];if(o.error[i]=s-o[i],t&&(e.displayDivPos[i]=e.contentPos[i]-e.contentPosManager.getOffset(i)),d!=o.error[i])if(this.updateSizeOffset(e,t,"left"==i?"width":"height",void 0),!t&&e.contentPos)this.updateCornerOffset(e,!0,i,void 0);else for(var u=areaRelationMonitor.getRelation(e.areaId,"embedded"),h=0;h<u.length;h++){var l=u[h],c=allAreaMonitor.getAreaById(l.getElement());c instanceof DisplayArea&&this.updateCornerOffset(c,!1,i,void 0)}}function absolutePosManagerUpdateSizeOffset(e,t,i,r){var n=t?e.contentPos:e.relative;void 0==r?r=n.exact[i]:n.exact[i]=r;var o=n[i];n[i]=Math.round(r+n.error["width"==i?"left":"top"]),t&&(e.displayDivPos[i]=e.contentPos[i]),o!=n[i]&&(this.changedAreas[e.areaId]=e)}function absolutePosManagerRefreshDisplayOffset(e,t,i){"left"!=t&&"top"!=t||(e.displayDivPos[t]=e.contentPos[t]-i,this.changedAreas[e.areaId]=e)}function ContentPosManager(e,t){this.baseArea=e,this.ipcPropVal=void 0,this.offsets={},this.allModeCallbacks={},this.zeroOffsetCallbacks={},this.determineMode()}function contentPosManagerIndependentContentPositionHandler(e){this.ipcPropVal="object"==typeof e?void 0:e,this.determineMode()}function contentPosManagerSetContentOffset(e,t){if(!(e in ContentPosManager.edgeNames))return mondriaInternalError("unknown edge name for content offset: ",e),!1;var i=this.offsets[e];return t!==i&&(void 0===t?(delete this.offsets[e],this.isInAutoOffsetMode()&&isEmptyObj(this.offsets)&&this.setZeroOffsetMode()):(this.offsets[e]=t>0?t:0,this.zeroOffsetMode&&this.setAutoOffsetMode()),"left"!=e&&"top"!=e||!t&&!i||!this.isInIndependentContentPositionMode()||globalAbsolutePosManager.refreshDisplayOffset(this.baseArea,e,t?t:0),!this.isInAutoOffsetMode()||(!i&&!t||(this.setAutoConstraint(e),!0)))}function contentPosManagerSetAllContentOffsets(e){if(void 0==e)return!this.zeroOffsetMode&&(this.isInIndependentContentPositionMode()&&(this.offsets.left&&globalAbsolutePosManager.refreshDisplayOffset(this.baseArea,"left",0),this.offsets.top&&globalAbsolutePosManager.refreshDisplayOffset(this.baseArea,"top",0)),this.offsets={},this.isInAutoOffsetMode()&&this.setZeroOffsetMode(),!0);var t=!1;for(var i in ContentPosManager.edgeNames)this.setContentOffset(i,e)&&(t=!0);return t}function contentPosManagerSetAutoConstraint(e){this.baseArea.allPosConstraints&&this.baseArea.allPosConstraints.setAutoContentConstraint(e,this.offsets[e])}function contentPosManagerGetOffset(e){var t=this.offsets[e];return t?t:0}function contentPosManagerDetermineMode(){var e=this.ipcPropVal;void 0===e&&(e=!!this.baseArea.isIntersection()),e?this.setIndependentContentPositionMode():isEmptyObj(this.offsets)?this.setZeroOffsetMode():this.setAutoOffsetMode()}function contentPosManagerIsInAutoOffsetMode(){return!this.independentContentPosition&&!this.zeroOffsetMode}function contentPosManagerIsInZeroOffsetMode(){return this.zeroOffsetMode}function contentPosManagerIsInIndependentContentPositionMode(){return this.independentContentPosition}function contentPosManagerSetZeroOffsetMode(){if(!this.zeroOffsetMode){var e=this.independentContentPosition?"independent":"auto";"auto"==e&&this.baseArea.allPosConstraints&&this.baseArea.allPosConstraints.removeAutoContentConstraints(),this.toggleZeroOffsetMode(!1),this.callCallbacks(e,"zero")}}function contentPosManagerSetAutoOffsetMode(){if(this.zeroOffsetMode!==!1||this.independentContentPosition!==!1){var e=this.independentContentPosition?"independent":"zero";if(this.zeroOffsetMode?this.toggleZeroOffsetMode(!1):(this.independentContentPosition=!1,this.zeroOffsetMode=!1),this.baseArea.allPosConstraints)for(var t in ContentPosManager.edgeNames)this.baseArea.allPosConstraints.setAutoContentConstraint(t,this.offsets[t]);this.callCallbacks(e,"auto")}}function contentPosManagerSetIndependentContentPositionMode(){if(!this.independentContentPosition){var e=this.zeroOffsetMode?"zero":"auto";this.zeroOffsetMode?this.toggleZeroOffsetMode(!0):(this.baseArea.allPosConstraints&&this.baseArea.allPosConstraints.removeAutoContentConstraints(),this.independentContentPosition=!0,this.zeroOffsetMode=!1),this.callCallbacks(e,"independent")}}function contentPosManagerToggleZeroOffsetMode(e){var t,i=this.baseArea,r=this.baseArea.areaRegisteredToAbsolutePosManager;this.independentContentPosition;if(r){t=i.getEmbeddedAreaList();for(var n=0;n!=t.length;n++){var o=t[n];o instanceof DisplayArea&&globalAbsolutePosManager.newEmbedding(o,i,void 0)}this.zeroOffsetMode||globalAbsolutePosManager.removeAreaContentOffsets(i)}if(this.zeroOffsetMode=!this.zeroOffsetMode,this.independentContentPosition=!this.zeroOffsetMode&&!!e,r){this.zeroOffsetMode||globalAbsolutePosManager.addAreaContentOffsets(i);for(var n=0;n!=t.length;n++){var o=t[n];o instanceof DisplayArea&&globalAbsolutePosManager.newEmbedding(o,void 0,i)}}}function contentPosManagerRegisterAllModeChange(e,t,i,r){var n=this.allModeCallbacks[e];n||(n=this.allModeCallbacks[e]={}),n[t]={obj:i,opq:r}}function contentPosManagerUnregisterAllModeChange(e,t){var i=this.allModeCallbacks[e];i&&delete i[t]}function contentPosManagerUnregisterZeroOffsetModeToggle(e,t){var i=this.zeroOffsetCallbacks[e];i&&delete i[t]}function contentPosManagerRegisterZeroOffsetModeToggle(e,t,i,r){var n=this.zeroOffsetCallbacks[e];n||(n=this.zeroOffsetCallbacks[e]={}),n[t]={obj:i,opq:r}}function contentPosManagerUnregisterZeroOffsetModeToggle(e,t){var i=this.zeroOffsetCallbacks[e];i&&delete i[t]}function contentPosManagerCallCallbacks(e,t){for(var i in this.allModeCallbacks)for(var r in this.allModeCallbacks[i]){var n=this.allModeCallbacks[i][r];n.obj.contentOffsetModeChange(this.baseArea.areaId,e,t,n.opq)}if("zero"==e||"zero"==t)for(var i in this.zeroOffsetCallbacks)for(var r in this.zeroOffsetCallbacks[i]){var n=this.zeroOffsetCallbacks[i][r];n.obj.zeroOffsetToggle(this.baseArea.areaId,"zero"==t,n.opq)}}function LabelPairOffset(e,t,i,r){this.label1=i,this.label2=r,this.consumer=e,this.consumerIdent=t;globalPos.addWatchedCalcPair(this.label1,this.label2,this,this.updateOffset)}function labelPairOffsetDestroy(){globalPos.removeWatchedCalcPair(this.label1,this.label2,this,this.updateOffset)}function labelPairOffsetGet(){return globalPos.getPairOffset(this.label1,this.label2)}function labelPairOffsetUpdateOffset(e,t,i){var r=globalPos.getPairPoints(t);r&&(r[0]==this.label1?assert(r[1]==this.label2):(assert(r[1]==this.label1),assert(r[0]==this.label2)),this.consumer.updateOffset(this.consumerIdent,this.label1,this.label2,e))}function ZRelation(e,t,i,r,n,o){this.id=gZRelationId++,this.below=e,this.above=t,this.priority=i,this.relationSet=void 0,this.embedded=r,this.name=n,this.userInfo=o}function zrelationGetId(){return this.id}function zRelationGetBelow(){return this.below}function zRelationGetAbove(){return this.above}function zrelationGetRelationSet(){return this.relationSet}function zrelationGetPriority(){return this.priority}function zrelationIsPresent(){return void 0!==this.relationSet}function zrelationIsActive(){return void 0!==this.relationSet&&this.relationSet.getActive()===this}function ZRelationSet(){this.active=void 0,this.maxPrioRel=void 0,this.relations={},this.nrRelations=0,this.suspendedBecauseOf=void 0}function zrelationSetToString(){var e=this.getId(),t=!0;for(var i in this.relations){var r=this.relations[i];t?(e+=":",t=!1):e+=",",this.active===r&&(e+="*"),this.maxPrioRel===r&&(e+="!"),e+="#"+r.id+"("+r.priority+")"}return e}function zrelationSetToString2(){var e="",t=!0;for(var i in this.relations){var r=this.relations[i];t?t=!1:e+=",",e+=this.active!==r?"*"+r.id:r.id,e+=this.maxPrioRel!==r?"(!"+r.priority+")":"("+r.priority+")"}return e}function zRelationSetGetId(){for(var e in this.relations)return this.relations[e].above+" > "+this.relations[e].below}function zrelationSetGetActive(){return this.active}function zrelationSetContains(e){return e.id in this.relations}function zrelationSetAdd(e){e.id in this.relations||this.nrRelations++,this.relations[e.id]=e,(void 0===this.maxPrioRel||this.maxPrioRel.priority<e.priority)&&(this.maxPrioRel=e),e.relationSet=this}function zrelationSetRemove(e){e.id in this.relations&&this.nrRelations--,delete this.relations[e.id],this.maxPrioRel===e&&(this.maxPrioRel=void 0),e.relationSet=void 0}function zrelationSetActivate(e){this.active=e,this.maxPrioRel=e,this.suspendedBecauseOf=void 0}function zrelationSetDeactivate(e){assert(!(e instanceof ZRelation),"must be set or undefined"),this.active===this.maxPrioRel&&(this.maxPrioRel=void 0),this.active=void 0,this.suspendedBecauseOf=e}function zrelationSetGetMaxPriorityRelation(){if(void 0===this.maxPrioRel){var e=void 0;this.maxPrioRel=void 0;for(var t in this.relations)(void 0===e||e<this.relations[t].priority)&&(this.maxPrioRel=this.relations[t],e=this.relations[t].priority)}return this.maxPrioRel}function zrelationSetGetMaxPriority(){var e=this.getMaxPriorityRelation();return void 0===e?void 0:e.priority}function zrelationSetIsEmpty(){return 0===this.nrRelations}function zRelationSetFindEquivalentRel(e){for(var t in this.relations)if(this.relations[t]!==e&&this.relations[t].priority===e.priority)return this.relations[t]}function Vertex(e){this.elementId=e,this.above={},this.nrAbove=0,this.below={},this.nrBelow=0}function lowerThanAddAbove(e){e.above in this.above||this.nrAbove++,this.above[e.above]=e}function lowerThanAddBelow(e){e.below in this.below||this.nrBelow++,this.below[e.below]=e}function vertexIsDirectlyBelow(e){return e in this.above}function vertexIsDirectlyAbove(e){return e in this.below}function vertexGetAbove(e){return e in this.above?this.above[e]:void 0}function lowerThanRemoveAbove(e){e in this.above&&this.nrAbove--,delete this.above[e]}function lowerThanRemoveBelow(e){e in this.below&&this.nrBelow--,delete this.below[e]}function vertexIsBottom(){return 0===this.nrBelow}function vertexIsRoot(){return 0===this.nrBelow&&this.nrAbove>0}function vertexIsIsolated(){return 0===this.nrAbove&&0===this.nrBelow}function vertexIsLeaf(){return 0===this.nrAbove}function ZRelationGraph(){this.vertices={},this.nrConnectedVertices=0,this.relations={},this.suspended=[],this.zValues={},this.changed={},this.nrChanged=0,this.newZValues={},this.callbackObject=void 0,this.callbackFunction=void 0,this.resolveCycleBlockRel=void 0}function zRelationGraphRegisterCallback(e,t){this.callbackObject=e,this.callbackFunction=t}function zRelationGraphUnregisterCallback(){this.callbackObject=void 0,this.callbackFunction=void 0}function zRelationGraphCallback(e,t){void 0!==this.callbackFunction&&this.callbackFunction.call(this.callbackObject,e,t)}function onDirectedPath(e,t,i,r){for(;void 0!==t;){if(t===e)return!0;t=r[i][t],i--}return!1}function getDirectedPath(e,t,i,r){for(var n=[e];t!==e;)assert(void 0!==t,"cannot happen when onDirectedPath returns true"),n.push(t),t=r[i][t],i--;return n}function ZRelationGraphFindDirectedPath(e,t){var i=[];if(e in this.vertices&&t in this.vertices){var r=this.getZValue(e),n={};if(n[e]=this.getZValue(e),!(n[e]<this.getZValue(t))){for(n[t]=n[e]+1,i[r]={},i[r][e]=void 0,r++,i[r]={},i[r][t]=e;r<i.length;){var o=i[r];if(void 0!==o){var s=i[r+1];for(var a in o){n[a]=r;for(var t in this.vertices[a].above){if(t in n){if(onDirectedPath(t,a,r,i))return getDirectedPath(t,a,r,i)}else n[t]=this.getZValue(t);n[t]<=r&&(void 0===s&&(i[r+1]=s={}),s[t]=a)}}}r++}for(a in n)this.setZValue(a,n[a])}}}function zRelationGraphCollectAllRelations(e,t){for(var i=[t],r=0;r<e.length-1;r++)i.push(this.getActiveRel(e[r+1],e[r]));return i.sort(function(e,t){return e.priority-t.priority})}function zRelationGraphResolveCycle(e){var t=this.findDirectedPath(e.below,e.above);for(this.resolveCycleBlockRel=void 0;void 0!==t;){var i=this.collectAllRelations(t,e);if(i[0]===e)return this.resolveCycleBlockRel=i.slice(1),!1;this.suspendRel(i[0],i.slice(1).concat(e)),t=this.findDirectedPath(e.below,e.above)}return!0}function zRelationGraphGetActiveRel(e,t){return e in this.relations&&t in this.relations[e]?this.relations[e][t].getActive():void 0}function makePosConstraint(e){var t=e.split(" ");return"{element:'"+t[0]+"',type:'"+(1===t.length?"bottom":t[1])+"'}"}function zRelationGraphAddRel(e){var t,i,r,n;return e.below!==e.above&&(void 0!==e.getRelationSet()?void 0:(t=this.getEdgeRelationSet(e.below,e.above),n=t.isEmpty(),i=t.getActive(),r=t.getMaxPriority(),t.add(e),!(void 0!==r&&e.priority<=r)&&(i?(t.activate(e),this.replaceRel(e),!0):this.potentialCycle(e)?this.resolveCycle(e)?(n||this.removeSuspended(t),this.activate(e),this.retestSuspended(),!0):(n&&this.addSuspended(t,this.resolveCycleBlockRel),!1):(this.activate(e),!0))))}function zRelationGraphPotentialCycle(e){return e.below in this.vertices&&this.vertices[e.below].nrBelow>0&&e.above in this.vertices&&this.vertices[e.above].nrAbove>0}function zRelationGraphGetEdgeRelationSet(e,t){var i,r=this.relations[e];return r||(this.relations[e]=r={}),i=r[t],i||(r[t]=i=new ZRelationSet),i}function zRelationGraphRemoveVertex(e){var t;delete this.relations[e],e in this.changed&&delete this.changed[e];for(t in this.vertices[e].above)delete this.vertices[t].below[e];for(t in this.vertices[e].below)delete this.vertices[t].above[e];delete this.vertices[e]}function zRelationGraphAddSuspended(e,t){assert(!(t instanceof ZRelation),"must be set or undefined"),assert(void 0===e.getActive()&&!e.isEmpty(),"active or empty set suspended"),e.suspendedBecauseOf=t,this.suspended.push(e)}function zRelationGraphRemoveSuspended(e){var t=this.suspended.indexOf(e);assert(t>=0,"relation not suspended"),this.suspended.splice(t,1)}function zRelationGraphCheckVertex(e){var t=this.vertices[e];return t||(this.vertices[e]=t=new Vertex(e)),t.isIsolated()&&this.nrConnectedVertices++,e in this.zValues||this.setZValue(e,""),t}function zRelationGraphActivate(e){e.getRelationSet().activate(e),this.checkVertex(e.below).addAbove(e),this.checkVertex(e.above).addBelow(e),this.propagateChange(e.below)||this.getZValue(e.above)<=this.getZValue(e.below)&&this.propagateChange(e.above),this.changed[e.above]=!0,this.changed[e.below]=!0}function zRelationGraphReplaceRel(e){this.vertices[e.below].addAbove(e),this.vertices[e.above].addBelow(e)}function zRelationGraphIsEdgeActive(e,t){return e in this.vertices&&this.vertices[e].isDirectlyBelow(t)}function zRelationGraphDeactivateRel(e,t){e&&e.isActive()&&(e.getRelationSet().deactivate(t),this.callback(e,!1))}function zRelationGraphRemoveEdge(e,t){this.vertices[e].getAbove(t);this.vertices[e].removeAbove(t),this.vertices[t].removeBelow(e),this.vertices[e].isIsolated()&&this.nrConnectedVertices--,this.vertices[t].isIsolated()&&this.nrConnectedVertices--,this.vertices[e].isBottom()&&this.setZValue(e,""),this.vertices[t].isBottom()&&this.setZValue(t,"")}function ZRelationGraphSuspendRel(e,t){this.removeEdge(e.below,e.above),this.deactivateRel(e,t),this.callback(e,!1),this.addSuspended(this.getEdgeRelationSet(e.below,e.above),t)}function zRelationGraphRetestSuspended(){for(var e,t,i=!0,r=function(e,t){return t.getMaxPriority()-e.getMaxPriority()};i;){i=!1,e=this.suspended.sort(r),this.suspended=[];for(var n=0;n!==e.length;n++){var o=e[n],s=o.getMaxPriorityRelation();if(s&&!this.blockingCycleStillActive(s))if(t=this.suspended,this.suspended=[],this.resolveCycle(s)){if(o.suspendedBecauseOf=void 0,this.activate(s),this.callback(s,!0),0!==this.suspended.length){i=!0,this.suspended=cconcat(this.suspended,cconcat(t,e.slice(n+1)));break}this.suspended=t}else o.suspendedBecauseOf=this.resolveCycleBlockRel,this.suspended=cconcat(this.suspended,t),this.suspended.push(o);else this.suspended.push(o)}}}function ZRelationGraphBlockingCycleStillActive(e){var t;if(void 0===e.relationSet)return!1;if(t=e.relationSet.suspendedBecauseOf,void 0!==t)for(var i=0;i!==t.length;i++)if(!t[i].isActive()||t[i].priority<e.priority)return!1;return!0}function zRelationGraphRemoveRel(e,t){var i,r=e.getRelationSet(),n=e.isActive();if(void 0===r)return!1;if(n){if(r.deactivate(void 0),i=r.findEquivalentRel(e))return r.remove(e),this.replaceRel(i),r.activate(i),!1;this.removeEdge(e.below,e.above)}if(r.remove(e),r.isEmpty()?(delete this.relations[e.below][e.above],n||this.removeSuspended(r)):n&&this.addSuspended(r,void 0),n){if(t)return!0;this.retestSuspended()}return!1}function ZRelationGraphUpdateViolatingLevels(e,t){for(;t<e.length;){var i=e[t];if(void 0!==i){var r=e[t+1];for(var n in i){this.setZValue(n,t);for(var o in this.vertices[n].above)this.getZValue(o)<=t&&(void 0===r&&(e[t+1]=r={}),r[o]=!0)}}t++}}function zRelationGraphPropagateChanges(e){var t,i,r,n,o=[],s=void 0;for(t in e)i=this.getMinimalZValue(t),this.getZValue(t)<i&&(r=o[i],void 0===r&&(o[i]=r={}),r[t]=!0,(void 0===s||s>i)&&(s=i));if(s)for(this.updateViolatingLevels(o,s);s<o.length;){if(r=o[s],void 0!==r){n=o[s+1];for(t in r){this.setZValue(t,s);for(var a in this.vertices[t].above)this.getZValue(a)<=s&&(void 0===n&&(o[s+1]=n={}),n[a]=!0)}}s++}}function zRelationGraphPropagateChange(e){var t=this.getMinimalZValue(e);if(this.getZValue(e)<t){var i=[],r=t;return i[t]={},i[t][e]=!0,this.updateViolatingLevels(i,r),!0}return!1}function zRelationGraphGetMinimalZValue(e){var t,i,r=-1;for(i in this.vertices[e].below)t=this.getZValue(i),r<t&&(r=t);return r+1}function zRelationGraphAllLowerVerticesIn(e,t){for(var i in this.vertices[e].below)if(!(i in t))return!1;return!0}function zRelationGraphGetHTMLZValue(e){return this.zValues[e]}function zRelationGraphGetZValue(e){return""===this.zValues[e]?0:this.zValues[e]}function zRelationGraphSetZValue(e,t){0===t&&(t=""),this.zValues[e]!==t&&(e in this.changed||(this.changed[e]=!0,this.nrChanged++),this.zValues[e]=t,this.newZValues[e]=t)}function zRelationGraphGetEdge(e,t){if(e in this.vertices)return this.vertices[e].above[t]}function zRelationGraphHasPath(e,t){var i,r,n=[{vertex:e,prev:void 0}],o={},s=0,a=this.getZValue(t);if(o[e]=[],e===t)return!0;for(;0!==n.length&&s<=this.nrConnectedVertices+2;){var d=n;n=[];for(var u=0;u!==d.length;u++){var h=d[u];if(h.vertex===t)return!0;if(this.getZValue(h.vertex)>a&&h.vertex!==t&&h.vertex in this.vertices)for(var l in this.vertices[h.vertex].below)r=this.vertices[h.vertex].below[l],l in o?o[l].push({rel:r,prev:h.prev}):(i=[{rel:r,prev:h.prev}],o[l]=i,n.push({vertex:l,prev:i}))}s++}return!1}function zRelationGraphCheckConsistency(){var e,t,i,r,n,o,s,a,d;for(e in this.relations)for(t in this.relations[e])i=this.relations[e][t],assert(!i.isEmpty(),"(1) edgeRS may not be empty"),r=i.getActive(),r?(assert(this.isEdgeActive(e,t),"(2) edgeRS is active and should be in graph"),assert(e in this.vertices&&t in this.vertices[e].above&&this.vertices[e].above[t]===r,"(3) activeRel should be the active edge"),assert(r.priority>=i.getMaxPriority(),"(4) activeRel should have highest priority")):assert(this.suspended.indexOf(i)!==-1,"(4) edgeRS has no active edge so should be suspended");for(e in this.vertices)for(t in this.vertices[e].above)assert(e in this.relations&&t in this.relations[e]&&void 0!==this.relations[e][t],"(15) active edge should have be in relations"),r=this.vertices[e].above[t],i=r.getRelationSet(),assert(i,"(5) active edge should be part of a relation set"),assert(e in this.relations&&t in this.relations[e],"(6) active edge should be in relations"),assert(i===this.getEdgeRelationSet(e,t),"(7) edge relation set should be unique");for(d={},n=0;n!==this.suspended.length;n++){i=this.suspended[n],assert(!(i.getId()in d),"(16) relation should be suspended only once: "+i.toString()),d[i.getId()]=!0,assert(!i.isEmpty(),"(8) suspended rs should not be empty: "+i.toString()),assert(void 0===i.getActive(),"(9) suspended relation set should not have active edge: "+i.toString()),a=void 0;for(o in i.relations)s=i.relations[o],a?assert(s.below===a.below&&s.above===a.above,"(11) relation set should contain similar relations"):(assert(!(s.below in this.vertices&&s.above in this.vertices[s.below].above&&void 0!==this.vertices[s.below].above[s.above]),"(10) no active edge should have a suspended relation set:"+i.toString()),a=s),assert(void 0===i.getMaxPriority()||s.priority<=i.getMaxPriority(),"(12) higher priority relation in relation set");var u=this.findDirectedPaths(s.below,s.above);assert(s.above in u,"(13) relation should only be suspended because of cycle or dependencies: "+s.id)}}function zRelationGraphDump(e,t){function i(e,t){var i,r;if(!(e in dbgAreaSetRepr)||e in d)return"";d[e]=!0,i='subgraph "cluster_'+e+'" {\n"'+e+"="+t+'";\n',r=dbgAreaSetRepr[e];for(var n in r.areaSet)i+='"'+n+'";\n';return i+="}\n"}var r,n,o,s,a="digraph zrelation {\nrankdir=BT;\n",d={};for(r in this.relations){var u=r.slice(2),h=this.getZValue(r),l=u+"="+h;a+=i(u,h);for(n in this.relations[r]){var c=n.slice(2);if(o=this.relations[r][n],s=void 0!==o.getActive(),e||s){var p=this.getZValue(n),f=c+"="+p;a+=i(c,p),a+='"'+l+'" -> "'+f+'"',a+=t?' [label="'+o.toString2()+'"'+(s?"];\n":",style=dotted];\n"):s?void 0!==o.maxPrioRel&&(o.maxPrioRel.priority<-9999||o.maxPrioRel.priority>9999)?' [style="dashed"];\n':";\n":" [style=dotted];\n"}}}return a+"}\n"}function zRelationGraphFindCompleteBipartiteSubGraphs(e){for(var t in this.vertices){var i=this.vertices[t],r={};r[t]=!0;for(var n in i.above){var o=(this.vertices[n],{});o[n]=!0,this.expandKnm(r,1,o,1,e)}}}function zRelationGraphExpandKnm(e,t,i,r,n){function o(e,t){for(var i in t)if(e<i)return!1;return!0}function s(e){return"a_"!==e.substr(0,2)||" top"===e.substr(-4)}function a(e){return"a_"!==e.substr(0,2)||" top"!==e.substr(-4)}var d=!1;for(var u in this.vertices)if(!(u in e||u in i)){var h=this.vertices[u];!(o(u,e)&&s(u)&&this.allContainedIn(i,h.above))||n&&this.pathFrom(u,e)||(d=!0,e[u]=!0,!this.expandKnm(e,t+1,i,r,n)&&r>1&&console.log(Object.keys(e),"->",Object.keys(i)),delete e[u]),!(o(u,i)&&a(u)&&this.allContainedIn(e,h.below))||n&&this.pathFrom(u,i)||(d=!0,i[u]=!0,!this.expandKnm(e,t,i,r+1,n)&&t>1&&console.log(Object.keys(e),"->",Object.keys(i)),delete i[u])}return d}function zRelationGraphAllContainedIn(e,t){for(var i in e)if(!(i in t))return!1;return!0}function zRelationGraphPathFrom(e,t){for(var i in t)if(this.hasPath(e,i)||this.hasPath(i,e))return!0;return!1}function zRelationGraphIsKnm(e,t){for(var i in e)if(!this.allContainedIn(t,this.vertices[i].above))return"no l: "+i;for(var r in t)if(!this.allContainedIn(e,this.vertices[r].below))return"no u: "+r;for(i in e){if(delete e[i],this.pathFrom(i,e))return"not proper l: "+i;e[i]=!0}for(r in t){if(delete t[r],this.pathFrom(r,t))return"not proper u: "+r;t[r]=!0}return"yes"}function zRelationGraphMinimizeZValues(){var e,t=!0,i=[],r=0,n={},o={};for(var s in this.vertices){var a=this.getMinimalZValue(s);a!==this.getZValue(s)&&(t=!1),0===a&&i.push(s)}if(!t)for(e=i;e.length>0;){var d=e;e=[];for(var u=0;u<d.length;u++){var s=d[u];if(this.allLowerVerticesIn(s,n)){this.setZValue(s,r),n[s]=!0;for(var h in this.vertices[s].above)h in o||(e.push(h),o[h]=!0)}else e.push(s),o[h]=!0}r++}}function ZArea(e,t){this.id=e,this.area=t,this.areaId=t.areaId,this.children={},this.parent=void 0,this.zIndexStatus=ZIndexStatus.none,this.zIndex="",this.pathsToIndependentDescendants=void 0,this.lowestIndependentAncestor=void 0,this.embeddingRelationTop=void 0,this.embeddingRelationBottom=void 0,this.nrRelations=0,this.topRelation=void 0,this.constraints={},this.refCount=0}function zAreaDestroy(){this.topRelation&&this.removeTopRelation();for(var e in this.constraints)this.removeConstraint(e);if(0!==this.nrRelations){var t=this.getAncestorPath();if(t){var i=t.ancestor,r=t.path;deleteAssociationPath(i.pathsToIndependentDescendants,r),this.setLowestIndependentAncestor(void 0)}}this.nrRelations=0,this.constraints={},this.pathsToIndependentDescendants=void 0,this.lowestIndependentAncestor=void 0,this.embeddingRelationTop=void 0,this.embeddingRelationBottom=void 0}function zAreaGet(e){var t,i="a_"+e.areaId;return i in ZArea.areaMap?(t=ZArea.areaMap[i],assert(void 0===t.area,"not released?"),t.area=e):ZArea.areaMap[i]=t=new ZArea(i,e),t.refCount++,ZArea.areaMap[i]}function zAreaRelease(e){assert(e.refCount>0,"releaseZArea called too often"),e.refCount--,0===e.refCount&&(e.destroy(),delete ZArea.areaMap[e.id])}function zAreaClear(){for(var e in this.constraints)this.removeConstraint(e);this.setRepresentative&&this.setRepresentative.area.setMemberDestruction(this.area),this.parent&&(this.parent.removeChild(this),this.parent=void 0),this.area=void 0}function zAreaDump(e){void 0===e&&(e=""),console.log(e,this.id,this.zIndex,this.zIndexStatus);for(var t in this.children)this.children[t].dump(e+"  ")}function zAreaIsEmbeddedIn(e){for(var t=this;t;){if(t===e)return!0;t=t.parent}return!1}function zAreaAddChild(e){if(this.children[e.id]=e,e.zIndexStatus===ZIndexStatus.none){if(e.hasAncestorPath()){var t=e.getAncestorPath(),i=t.ancestor,r=t.path,n=getAssociationPath(i.pathsToIndependentDescendants,r.slice(0,-1));void 0!==n?(e.zIndex=i.zIndex,e.zIndexStatus=ZIndexStatus.copy,e.area.setZIndex(e.zIndex,"")):this.zIndexStatus===ZIndexStatus.copy&&e.clearZIndex(this.zIndex,ZIndexStatus.copy)}}else e.area.setZIndex(e.zIndex,"")}function zAreaRemoveChild(e){delete this.children[e.id]}function zAreaGetEmbeddingDepth(){for(var e=0,t=this.parent;void 0!==t;)t=t.parent,e++;return e}function zAreaGetFrameDiv(){return void 0!==this.area?this.area.getFrameDiv():void 0}function zAreaGetZ(){return""===this.zIndex?0:this.zIndex}function ZAreaSetSetRepresentative(e,t){this.setRepresentative=e,Utilities.isEmptyObj(e.constraints)||console.log("warning: mixed areaSet relations: @"+this.areaId,"individual:",Object.keys(this.setRepresentative.constraints).join(","),"set:",t)}function ZAreaRemoveSetRepresentative(){delete this.setRepresentative}function zAreaCollectIndependentDescendants(e){var t,i=void 0;for(var r in this.children){var n=this.children[r];0!==n.nrRelations?(t=n,n.setLowestIndependentAncestor(e)):t=n.collectIndependentDescendants(e),void 0!==t&&(void 0===i&&(i={}),i[r]=t)}return i}function zAreaFindChildName(e){for(var t in this.children)if(this.children[t]===e)return t;assert(!1,"there shouldn't be orphans")}function zAreaHasIndependentDescendants(){return void 0!==this.pathsToIndependentDescendants&&!isEmptyObj(this.pathsToIndependentDescendants)}function zAreaHasAncestorPath(){for(var e=this.parent;e&&0===e.nrRelations;)e=e.parent;return void 0!==e}function zAreaGetAncestorPath(){for(var e=this,t=e.parent,i=[];t;){if(i.push(t.findChildName(e)),0!==t.nrRelations)return{ancestor:t,child:e,path:i.reverse()};e=t,t=t.parent}}function zAreaClearZIndex(e,t){this.zIndex=e,this.zIndexStatus=t,void 0!==this.area&&this.area.setZIndex(e,"");for(var i in this.children){var r=this.children[i];0===r.nrRelations&&void 0===r.setRepresentative&&r.clearZIndex("",ZIndexStatus.none)}}function zAreaMarkPath(e){for(var t=this,i=0;i!==e.length;i++)t=t.children[e[i]],t.zIndexStatus=ZIndexStatus.mark}function zAreaEmbeddedIn(e){for(var t=this;t;){if(t===e)return!0;t=t.parent}return!1}function zAreaSetTopRelation(){return assert(void 0===this.topRelation),this.topRelation=new ZRelation(this.id,this.id+" top",gZIndex.highestUserPriority+1,!1,"automatic top",{}),this.topRelation.userInfo[this.areaId]={"automatic top":!0},gZIndex.zRelations.addRel(this.topRelation)}function zAreaAddRelation(e,t){var i=!1;return this.setRepresentative&&console.log("warning: mixed areaSet relations: @"+this.areaId,"individual:",t,"set:",Object.keys(this.setRepresentative.constraints).join(",")),this.nrRelations++,1===this.nrRelations&&(this.zIndexStatus=ZIndexStatus.independent,this.propagateUp()&&(i=!0),this.pathsToIndependentDescendants=this.collectIndependentDescendants(this),this.setTopRelation()&&(i=!0)),i}function zAreaRemoveTopRelation(){assert(void 0!==this.topRelation),gZIndex.zRelations.removeRel(this.topRelation),this.topRelation=void 0}function zAreaRemoveRelation(e){assert(this.nrRelations>0,"too many calls to removeRelation"),this.nrRelations--,0===this.nrRelations&&(this.zIndexStatus===ZIndexStatus.independent&&(this.zIndexStatus=ZIndexStatus.none),this.stopPropagateUp(),this.removeTopRelation())}function zAreaPropagateUp(){var e=this.getAncestorPath();if(void 0===e)return!1;var t=e.ancestor,i=e.child,r=e.path,n=t.hasIndependentDescendants();return void 0===t.pathsToIndependentDescendants&&(t.pathsToIndependentDescendants={}),this.pathsToIndependentDescendants=getAssociationPath(t.pathsToIndependentDescendants,r),addAssociationPath(t.pathsToIndependentDescendants,r,this),this.setLowestIndependentAncestor(t),n?(i.copyZIndexToDescendants(t.zIndex,ZIndexStatus.copy,t.pathsToIndependentDescendants[r[0]]),this.updateLowestIndependentAncestor(this,this.pathsToIndependentDescendants)):t.copyZIndexToDescendants(t.zIndex,ZIndexStatus.independent,t.pathsToIndependentDescendants),!0}function zAreaStopPropagateUp(){var e=this.getAncestorPath();if(e){var t=e.ancestor,i=(e.child,e.path);if(this.hasIndependentDescendants()){var r=this.pathsToIndependentDescendants;this.updateLowestIndependentAncestor(t,r),this.pathsToIndependentDescendants=void 0,void 0===t.pathsToIndependentDescendants&&(t.pathsToIndependentDescendants={}),addAssociationPath(t.pathsToIndependentDescendants,i,r),this.copyZIndexToDescendants(t.zIndex,ZIndexStatus.copy,r)}else deleteAssociationPath(t.pathsToIndependentDescendants,i);t.markPath(i),t.copyZIndexToDescendants(t.zIndex,ZIndexStatus.independent,t.pathsToIndependentDescendants)}else this.clearZIndex("",ZIndexStatus.none);this.setLowestIndependentAncestor(void 0)}function zAreaSetLowestIndependentAncestor(e){var t=!1;return e!==this.lowestIndependentAncestor&&(this.embeddingRelationTop&&(gZIndex.zRelations.removeRel(this.embeddingRelationTop),this.embeddingRelationTop=void 0,gZIndex.zRelations.removeRel(this.embeddingRelationBottom),this.embeddingRelationBottom=void 0,t=!0),this.lowestIndependentAncestor=e,e&&(this.embeddingRelationTop=new ZRelation(this.id+" top",e.id+" top",gZIndex.lowestUserPriority-2,!1,"automatic embedding top",{}),this.embeddingRelationTop.userInfo[this.areaId]={"automatic embedding top":!0},gZIndex.zRelations.addRel(this.embeddingRelationTop)&&(t=!0),this.embeddingRelationBottom=new ZRelation(e.id,this.id,gZIndex.lowestUserPriority-1,!0,"automatic embedding bottom",{}),this.embeddingRelationBottom.userInfo[this.areaId]={" automatic embedding bottom":!0},gZIndex.zRelations.addRel(this.embeddingRelationBottom)&&(t=!0))),t}function zAreaUpdateLowestIndependentAncestor(e,t){if(t instanceof ZArea)t.setLowestIndependentAncestor(e);else for(var i in t)i in this.children&&this.children[i].updateLowestIndependentAncestor(e,t[i])}function zAreaCopyZIndexToDescendants(e,t,i){if(this.zIndex=e,this.zIndexStatus=t,void 0===i||isEmptyObj(i))this.clearZIndex(e,t);else{void 0!==this.area&&this.area.setZIndex("",e);for(var r in this.children){var n=this.children[r];0===n.nrRelations&&void 0===n.setRepresentative&&n.copyZIndexToDescendants(e,ZIndexStatus.copy,i[r])}}}function zAreaConfigurationUpdate(e,t){if(t.incremental){for(var i in t.removed())this.removeConstraint(i);for(i in t.added())this.addConstraint(i,e[i]),this.constraints[i].update(this.areaId,i);for(i in t.modified())this.addConstraint(i,e[i]),this.constraints[i].update(this.areaId,i)}else this.newDescription(e)}function ZAreaUpdateConstraint(e,t){this.constraints[e].update(t,e)}function zAreaNewDescription(e){for(var t in this.constraints)t in e||(this.constraints[t].unregisterAll(this,t),this.removeConstraint(t));for(t in e)this.addConstraint(t,e[t]),this.constraints[t].update(this.areaId,t)}function zAreaAddConstraint(e,t){var i;e in this.constraints?i=this.constraints[e]:this.constraints[e]=i=new ZConstraint(this),i.newPriority="priority"in t?t.priority:0,i.higher.parseDescr(t.higher,this,e),i.lower.parseDescr(t.lower,this,e)}function zAreaRemoveConstraint(e){if(e in this.constraints){var t=this.constraints[e];t.destroy(this.areaId,e),delete this.constraints[e]}}function zAreaFindLce(e,t,i){for(var r=this,n=r.getEmbeddingDepth(),o=e.getEmbeddingDepth();n>o;)t&&t.push(r),
r=r.parent,n--;for(;o>n;)i&&i.push(e),e=e.parent,o--;for(;r&&e;){if(r===e)return r;t&&t.push(r),i&&i.push(e),r=r.parent,e=e.parent}}function zAreaFindIndependentAncestor(){for(var e=this;e&&0===e.nrRelations;)e=e.parent;return e}function zAreaCompare(e,t){function i(e){return e&&""!==e.zIndex?e.zIndex:0}var r,n,o=e.findIndependentAncestor(),s=t.findIndependentAncestor();if(o!==s&&(r=i(o),n=i(s),r!==n))return r-n;if(void 0===o&&e.zIndex!==t.zIndex)return e.zIndex-t.zIndex;var a=[],d=[],u=e.findLce(t,a,d);return assert(u,"there is always area1 common area, the screen area"),u===e?-1:u===t?1:ZArea.divFollows(a[a.length-1],d[d.length-1])?-1:1}function zAreaDivFollows(e,t){var i=e.getFrameDiv(),r=t.getFrameDiv();if(void 0===i)return!1;if(void 0===r)return!0;for(var n=i.nextElementSibling;n;){if(n===r)return!0;n=n.nextElementSibling}return!1}function ZConstraint(e){this.zArea=e,this.higher=new ZConstraintSection,this.lower=new ZConstraintSection,this.priority=void 0,this.newPriority=0}function zConstraintUnregisterAll(e,t){this.higher.unregisterAll(e,t,"higher"),this.lower.unregisterAll(e,t,"lower")}function zConstraintDestroy(e,t){debugStartTimer("z-index","removeall");var i,r,n=this.higher.getOld(),o=this.lower.getOld(),s=[];this.higher.releaseAreaSetReprs(),this.lower.releaseAreaSetReprs();for(i in n)for(r in o)i!==r&&s.push({below:r,above:i,priority:this.priority});gZIndex.removeAll(s,e,t),scheduleGeometryTask(),debugStopTimer("removeall")}function zConstraintHasChanged(){return this.lower.hasChanged()||this.higher.hasChanged()}function zConstraintUpdate(e,t){debugStartTimer("z-index","zconstraint update");var i,r,n,o,s=void 0!==this.newPriority&&this.newPriority!==this.priority,a=this.higher.getDiff(s,t),d=this.lower.getDiff(s,t),u=[];for(n in a.removed)for(o in d.removed)n!==o&&u.push({below:o,above:n,priority:this.priority});if(!d.fullReplace)for(n in a.removed){r||(r=this.lower.getOld());for(o in r)o in d.removed||n===o||u.push({below:o,above:n,priority:this.priority})}if(!a.fullReplace){i||(i=this.higher.getOld());for(n in i)if(!(n in a.removed))for(o in d.removed)n!==o&&u.push({below:o,above:n,priority:this.priority})}0!==u.length&&(gZIndex.removeAll(u,e,t),u=[]),void 0!==this.newPriority&&(this.priority=this.newPriority,this.newPriority=void 0);for(n in a.added)for(o in d.added)n!==o&&u.push({below:o,above:n,priority:this.priority});if(!d.fullReplace)for(n in a.added){r||(r=this.lower.getOld());for(o in r)o in d.removed||n===o||u.push({below:o,above:n,priority:this.priority})}if(!a.fullReplace){i||(i=this.higher.getOld());for(n in i)if(!(n in a.removed))for(o in d.added)n!==o&&u.push({below:o,above:n,priority:this.priority})}gZIndex.addAll(u,e,t),this.higher.reset(),this.lower.reset(),debugStopTimer("zconstraint update"),scheduleGeometryTask()}function ZConstraintSection(){this.type=ZConstraintType.none,this.label=void 0,this.newType=void 0,this.newLabel=void 0,this.areaSet=!1,this.newAreaSet=void 0,this.areas=void 0,this.areaSetReprs=void 0,this.newAreaSetReprs=void 0,this.added=void 0,this.removed=void 0,this.areaPath=void 0}function zConstraintSectionParseDescr(e,t,i){var r;for(var n in this.areas)this.removeArea(n);if(e instanceof Array&&1===e.length&&(e=e[0]),void 0===e?this.newType=ZConstraintType.none:e instanceof Array?(this.newType=ZConstraintType.areaSet,r=e):e instanceof ElementReference?(this.newType=ZConstraintType.areaSet,r=e):e instanceof Object?("label"in e&&void 0!==e.label?(this.newType=ZConstraintType.localLabelSet,this.newLabel=e.label,this.newLabel instanceof Array&&1===this.newLabel.length&&(this.newLabel=this.newLabel[0])):this.newType=ZConstraintType.areaSet,r="element"in e?e.element:t.area.areaReference,"areaSet"in e&&(this.newAreaSet=e.areaSet)):"string"==typeof e?(this.newType=ZConstraintType.globalLabel,this.newLabel=e):this.newType=ZConstraintType.none,r instanceof Array)for(var o=0;o!==r.length;o++)assert(r[o]instanceof ElementReference),this.addArea(r[o].getElement());else r instanceof ElementReference&&this.addArea(r.getElement())}function zConstraintSectionAddArea(e){this.areas||(this.areas={}),e in this.areas?this.areas[e]++:(this.areas[e]=1,this.removed&&e in this.removed?delete this.removed[e]:(this.added||(this.added={}),this.added[e]=1))}function zConstraintSectionHasChanged(){return this.newType!==this.type||this.newLabel!==this.label||!!this.areaSet!=!!this.newAreaSet||this.added||this.removed}function zConstraintSectionRemoveArea(e){assert(this.areas&&e in this.areas&&this.areas[e]>=0,"area count"),this.areas[e]--,0===this.areas[e]&&(delete this.areas[e],this.added&&e in this.added?delete this.added[e]:(this.removed||(this.removed={}),this.removed[e]=1))}function zConstraintSectionGetDiff(e,t){return e||this.newType!==this.type||this.newLabel!==this.label||!!this.newAreaSet!=!!this.areaSet?{added:this.getNew(t),removed:this.getOld(),fullReplace:!0}:{added:this.getChanges(this.added,!0,t),removed:this.getChanges(this.removed,!1,t),fullReplace:!1}}function zConstraintSectionGetNew(e){var t,i,r={},n=void 0===this.newType?this.type:this.newType;switch(n){case ZConstraintType.none:break;case ZConstraintType.areaSet:if(this.newAreaSet){void 0===this.newAreaSetReprs&&(this.newAreaSetReprs={});for(i in this.areas){var o=allAreaMonitor.getAreaById(i).makeAreaSetRepr(e);r["a_"+o.areaId]=!0,this.newAreaSetReprs[i]=o.areaId}}else for(i in this.areas)r["a_"+i]=!0;break;case ZConstraintType.localLabelSet:if(t=void 0===this.newLabel?this.label:this.newLabel,this.newAreaSet){void 0===this.newAreaSetReprs&&(this.newAreaSetReprs={});for(i in this.areas){var o=allAreaMonitor.getAreaById(i).makeAreaSetRepr();r["l_"+o.areaId+"_"+t]=!0,this.newAreaSetReprs[i]=o.areaId}}else for(i in this.areas)r["l_"+i+"_"+t]=!0;break;case ZConstraintType.globalLabel:t=void 0===this.newLabel?this.label:this.newLabel,r["g_"+t]=!0}return r}function zConstraintSectionGetOld(){var e,t,i={},r=this.type;switch(r){case ZConstraintType.none:break;case ZConstraintType.areaSet:for(e in this.areas)t=this.areaSet?this.areaSetReprs[e]:e,this.added&&t in this.added||(i["a_"+t]=!0);for(e in this.removed)t=this.areaSet?this.areaSetReprs[e]:e,i["a_"+t]=!0;break;case ZConstraintType.localLabelSet:for(e in this.areas)this.added&&e in this.added||(t=this.areaSet?this.areaSetReprs[e]:e,i["l_"+t+"_"+this.label]=!0);for(e in this.removed)t=this.areaSet?this.areaSetReprs[e]:e,i["l_"+t+"_"+this.label]=!0;break;case ZConstraintType.globalLabel:i["g_"+this.label]=!0}return i}function zConstraintSectionGetChanges(e,t,i){var r,n,o,s,a={};switch(this.type){case ZConstraintType.none:break;case ZConstraintType.areaSet:if(this.areaSet){t&void 0===this.newAreaSetReprs&&(this.newAreaSetReprs={});for(n in e)t&&void 0!==(area=allAreaMonitor.getAreaById(n))?(o=allAreaMonitor.getAreaById(n).makeAreaSetRepr(i),s=o.areaId):s=this.areaSetReprs[n],a["a_"+s]=!0,t&&(this.newAreaSetReprs[n]=s)}else for(n in e)a["a_"+n]=!0;break;case ZConstraintType.localLabelSet:if(r=this.label,this.areaSet){t&&void 0===this.newAreaSetReprs&&(this.newAreaSetReprs={});for(n in e)t&&void 0!==(area=allAreaMonitor.getAreaById(n))?(o=area.makeAreaSetRepr(i),s=o.areaId):s=this.areaSetReprs[n],a["l_"+s+"_"+r]=!0,t&&(this.newAreaSetReprs[n]=s)}else for(n in e)a["l_"+n+"_"+r]=!0;break;case ZConstraintType.globalLabel:r=void 0===this.newLabel?this.label:this.newLabel,a["g_"+r]=!0}return a}function zConstraintSectionReset(){this.type=this.newType,this.newType=void 0,this.label=this.newLabel,this.newLabel=void 0,this.added=void 0,this.removed=void 0,this.releaseAreaSetReprs()}function zConstraintSectionReleaseAreaSetReprs(){for(var e in this.areaSetReprs){var t=allAreaMonitor.getAreaById(e);void 0!==t&&t.removeAreaSetRepr()}this.areaSetReprs=this.newAreaSetReprs,this.newAreaSetReprs=void 0}function initZIndex(){gZIndex=new ZIndex}function ZIndex(){this.lowestUserPriority=-9999,this.highestUserPriority=9999,this.newZValues={},this.dependentRelations={},this.dependentRelationsPerArea={},this.dependencies={},this.relations={},this.zRelations=new ZRelationGraph,this.zRelations.registerCallback(this,this.addToNewZ),this.changes=!1,this.tempStore=void 0}function zIndexAddArea(e,t){var i=t?ZArea.areaMap["a_"+t.areaId]:void 0,r=ZArea.get(e);return r.parent=i,i&&i.addChild(r),ZArea.areaMap[r.id]=r,r.area.setZIndex("",r.zIndex),r}function zIndexRemoveArea(e){var t,i,r=ZArea.areaMap["a_"+e.areaId];if(void 0!==r){for(i in this.dependentRelations)r.id in this.dependentRelations[i]&&this.hardDeleteDependentRelation(this.dependentRelations[i][r.id],i,r.id);for(t in this.dependentRelations[r.id])this.hardDeleteDependentRelation(this.dependentRelations[r.id][t],r.id,t);r.clear(),ZArea.release(r)}}function zIndexNewEmbedding(e,t,i){var r=ZArea.areaMap["a_"+e.areaId],n=i?ZArea.areaMap["a_"+i.areaId]:void 0;this.retractRelations(r),r.parent&&r.parent.removeChild(r),r.parent=n,n&&n.addChild(r),this.reassertRelations(),scheduleGeometryTask()}function zIndexGetZArea(e){return ZArea.areaMap[e]}function zIndexAddToNewZ(e,t){this.markRelElements(e)}function zIndexMarkRelElements(e){var t=e.getBelow();"string"==typeof t&&" top"===t.substr(-4)&&(t=t.substr(0,t.length-4)),this.newZValues[t]=0,this.newZValues[e.getAbove()]=0}function zIndexUpdateZ(){var e;this.zRelations.minimizeZValues();for(e in this.newZValues)this.newZValues[e]=this.zRelations.getHTMLZValue(e);for(e in this.zRelations.newZValues)this.newZValues[e]=this.zRelations.getHTMLZValue(e);for(e in this.newZValues){var t=ZArea.areaMap[e],i=this.newZValues[e];t&&(""===i?t.zIndexStatus!==ZIndexStatus.copy&&(t.area.setZIndex("",""),t.zIndex=""):t.copyZIndexToDescendants(i,ZIndexStatus.independent,t.pathsToIndependentDescendants))}this.changes=!1,this.newZValues={},this.zRelations.newZValues={}}function zIndexFindCurrentZRelation(e,t){if(this.zRelations.getEdge(t.id,e.id))return[t,e];if(this.zRelations.getEdge(e.id,t.id))return[e,t];var i=this.zRelations.getZValue(e.id),r=this.zRelations.getZValue(t.id);if(void 0!==i&&0!==i||void 0!==r&&0!==r){if(i>r)return[t,e];if(i<r)return[e,t]}return ZArea.divFollows(e,t)?[e,t]:[t,e]}function zIndexAddDependentRelation(e,t,i,r){var n=i.getId();n in this.dependencies||(this.dependencies[n]={}),t in this.dependencies[n]||(this.dependencies[n][t]={}),e in this.dependencies[n][t]||(this.dependencies[n][t][e]=!0,this.createDependentRelation(e,t,r))}function zIndexRemoveDependentRelations(e){for(var t in this.dependencies[e])for(var i in this.dependencies[e][t])this.deleteDependentRelation(i,t)&&(this.changes=!0);delete this.dependencies[e]}function zIndexCreateRelation(e,t,i,r){var n,o,s=ZArea.areaMap[e],a=ZArea.areaMap[t],d=s&&a&&a.isEmbeddedIn(s);return n=s?e+" top":e,o=new ZRelation(n,t,i,d,r,{}),s&&(s.addRelation(o.id,r)&&(this.changes=!0),s.refCount++),a&&(a.addRelation(o.id,r)&&(this.changes=!0),a.refCount++),o}function zIndexCreateDependentRelation(e,t,i){var r;ZArea.areaMap[e],ZArea.areaMap[t];e in this.dependentRelations||(this.dependentRelations[e]={}),t in this.dependentRelations[e]?(r=this.dependentRelations[e][t],r.count++):(r=this.dependentRelations[e][t]={count:1,rel:this.createRelation(e,t,i,"sys:dependent")},this.zRelations.addRel(r.rel)&&(this.changes=!0))}function zIndexDeleteDependentRelation(e,t){var i=this.dependentRelations[e][t];i&&(i.count--,0===i.count&&this.hardDeleteDependentRelation(i,e,t))}function removeZIndexRelation(e,t,i){void 0!==e&&(e.removeRelation(i),ZArea.release(e)),void 0!==t&&(t.removeRelation(i),ZArea.release(t))}function zIndexHardDeleteDependentRelation(e,t,i){var r=ZArea.areaMap[t],n=ZArea.areaMap[i];e.rel.isActive()&&(this.changes=!0),removeZIndexRelation(r,n,e.rel.id),this.zRelations.removeRel(e.rel,!1),delete this.dependentRelations[t][i]}function zIndexCheckLceUpward(e,t,i){return!1}function zIndexAssignDefaultSiblingRelations(e,t,i){var r=!1;for(var n in e.children){var o=e.children[n];if(o!==t){var s=this.findCurrentZRelation(o,t),a=s[0],d=s[1];this.addDependentRelation(a.id,d.id,i,this.lowestUserPriority-3)}}return r}function zIndexAddAll(e,t,i){for(var r=0;r!==e.length;r++){var n,o,s=e[r];if(n=s.below in this.relations?this.relations[s.below]:this.relations[s.below]={},n=s.above in n?n[s.above]:n[s.above]={},s.priority in n)n[s.priority].count++,o=n[s.priority].rel.userInfo;else{var a=this.createRelation(s.below,s.above,s.priority,i);n[s.priority]={count:1,rel:a},o=a.userInfo,this.zRelations.addRel(a)&&(this.changes=!0);var d=ZArea.areaMap[s.below],u=ZArea.areaMap[s.above];d&&u&&this.checkLceUpward(d,u,a)&&(this.changes=!0)}t in o||(o[t]={}),o[t][i]=!0}}function zIndexRemoveAll(e,t,i){for(var r,n,o=!1,s=0;s!==e.length;s++)if(n=e[s],n.below in this.relations&&(r=this.relations[n.below],n.above in r&&(r=r[n.above],n.priority in r&&(r[n.priority].count--,0===r[n.priority].count)))){var a=r[n.priority].rel;removeZIndexRelation(ZArea.areaMap[n.below],ZArea.areaMap[n.above],a.id),a.userInfo&&t in a.userInfo&&delete a.userInfo[t][i],delete r[n.priority],this.changes=!0,this.removeDependentRelations(a.id),this.zRelations.removeRel(a,!0)&&(o=!0)}o&&this.zRelations.retestSuspended()}function zIndexRetractRelations(e){var t,i,r,n=!1;this.tempStore=[];for(t in this.relations)for(i in this.relations[t])if(t===e.id||i===e.id)for(r in this.relations[t][i]){var o=this.relations[t][i][r];removeZIndexRelation(ZArea.areaMap[t],ZArea.areaMap[i],o.rel.id),this.changes=!0,this.removeDependentRelations(o.rel.getId()),this.zRelations.removeRel(o.rel,!0)&&(n=!0),this.tempStore.push({above:i,below:t,count:o.count,name:o.rel.name,prio:o.rel.priority,userInfo:o.rel.userInfo})}n&&this.zRelations.retestSuspended()}function zIndexReassertRelations(){var e,t,i,r,n,o;for(e=0;e!==this.tempStore.length;e++){t=this.tempStore[e].above,i=this.tempStore[e].below,n=this.tempStore[e].count,r=this.tempStore[e].prio,o=this.createRelation(i,t,r,this.tempStore[e].name),o.userInfo=this.tempStore[e].userInfo,this.relations[i][t][r]={count:n,rel:o},this.zRelations.addRel(o)&&(this.changes=!0);var s=ZArea.areaMap[i],a=ZArea.areaMap[t];s&&a&&this.checkLceUpward(s,a,o)&&(this.changes=!0)}this.tempStore=void 0}function debugZRelations(e){function t(e){var t;for(var i in e)for(var r in e[i])t?t+=", "+i+":"+r:t=i+":"+r;return t?t:"system"}function i(e){var i=e.below+" < "+e.above+" set by "+t(e.userInfo);return e.getRelationSet().getActive()||(i+=e.getRelationSet().suspendedBecauseOf?" with priority "+e.priority+", suspended by "+e.getRelationSet().suspendedBecauseOf.filter(function(t){return t.isActive()&&t.priority>=e.priority}).map(function(e){return e.below+" < "+e.above+" set by "+t(e.userInfo)+" with priority "+e.priority}).join(" and "):", removed"),i}var r,n,o,s,a,d,u;void 0!==e&&(u=new RegExp("(^a_"+e+"( top)?)$|(^l_"+e+"_)"));for(r in gZIndex.relations)for(n in gZIndex.relations[r])for(o in gZIndex.relations[r][n])(void 0===e||u.test(r)||u.test(n))&&(a=gZIndex.relations[r][n][o],console.log(i(a.rel)));for(s=0;s!==gZIndex.zRelations.suspended.length;s++)d=gZIndex.zRelations.suspended[s],d.isEmpty()||void 0!==e&&!u.test(d.maxPrioRel.above)&&!u.test(d.maxPrioRel.below)||console.log(i(d.getMaxPriorityRelation()))}function traceStacking(e,t){function i(e,t,r,n){var o=gZIndex.zRelations.vertices[e],s=ZArea.areaMap[e],a=s&&s.area,d=s&&s.parent,u=a instanceof AreaSetStackable?e.slice(2)+"S":e.slice(2),h=t+u.replace(/./g," "),l=void 0===o||void 0===o[r]?[]:Object.keys(o[r]);if(e in n)0!==l.length&&(u+="*"),t.length<n[e].length&&(u=n[e].slice(t.length).replace(/  /g,"below"===r?"> ":"< ")+u);else{var c=void 0,p="below"===r?-1:1;if(n[e]=t.replace(/\|/g," "),void 0===d||void 0!==o&&void 0!==o[r]&&d.id in o[r]||(c=d.id),l.sort(function(e,t){return p*(gZIndex.zRelations.zValues[e]-gZIndex.zRelations.zValues[t])}),void 0===c||0!==l.length&&"below"!==r||l.push(c),0===l.length)return u;for(var f=0;f!==l.length;f++){var v=o&&o[r]&&o[r][l[f]];f>0&&(u+="\n"+h),u+=void 0===v?" : "+i(l[f],h+(f<l.length-1?" | ":"   "),r,n):void 0!==v.relationSet&&void 0!==v.relationSet.active?("below"===r?" > ":" < ")+i(l[f],h+(f<l.length-1?" | ":"   "),r,n):" # "+l[f].slice(2)}}return u}var r=void 0===t?"a_"+e:"l_"+e+"_"+t;return"higher than:\n"+i(r,"","below",{})+"\n\nlower than:\n"+i(r,"","above",{})}function CombinationVectors(e,t){this.zeroRounding=e&&e>0?e:0,this.normalizationThreshold=t?t:0,this.baseSet=new VectorSet(this.zeroRounding),this.combinationSet=new VectorSet(this.zeroRounding),this.combinations={},this.inverse={},this.normalizationCandidates={}}function combinationVectorsGetComponentChanges(){return this.baseSet.componentChanges}function combinationVectorsClearComponentChanges(){this.baseSet.clearComponentChanges(),this.combinationSet.clearComponentChanges()}function combinationVectorsHasComponent(e){return this.baseSet.componentIndex.has(e)}function combinationVectorsCombinationComponentIndex(e){return this.combinationSet.componentIndex.get(e)}function combinationVectorsBaseSetSize(){return this.baseSet.setSize}function combinationVectorsCombinationSetSize(){return this.combinationSet.setSize}function combinationVectorsBaseNonZeroSize(){return this.baseSet.nonZeroSize}function combinationVectorsCombinationNonZeroSize(){return this.combinationSet.nonZeroSize}function combinationVectorsGetValue(e,t){return this.combinationSet.getValue(e,t)}function combinationVectorsAddValue(e,t,i){var r=this.combinations[e];for(var n in r){var o=i*r[n];this.combinationSet.addValue(n,t,o)}this.baseSet.addValue(e,t,i)}function combinationVectorsTransferValue(e,t,i,r,n){if(void 0!=t&&r!=t&&this.addValue(e,t,-i),void 0!=r)if(r==t){var o=n-i;if(0===o||0!==this.zeroRounding&&i&&o&&Math.abs(o/i)<this.zeroRounding)return;this.addValue(e,r,o)}else this.addValue(e,r,n)}function combinationVectorsNewVector(e,t){var i=this.baseSet.newVector(e);this.combinations[i]={};var r;return t&&(r=this.newCombVector(i,1)),[i,r]}function combinationVectorsSetVector(e,t){var i=[];if(!this.baseSet.setVector(e,t,i))return!1;var r=this.combinations[e];for(var n in r)this.combinationSet.addToVector(n,i,void 0,r[n]);return!0}function combinationVectorsRemoveVector(e){var t=this.baseSet.vectors[e];if(!t)return!1;var i=this.combinations[e];if(i){for(var r in i)this.combinationSet.addToVector(r,void 0,e,-i[r]);for(var r in i)delete this.inverse[r][e];delete this.combinations[e]}return this.baseSet.removeVector(e),!0}function combinationVectorsAddToVector(e,t,i){if(0!=i){this.baseSet.addToVector(e,t,void 0,i);var r=this.combinations[e];if(r)for(var n in r)this.combinationSet.addToVector(n,t,void 0,i*r[n])}}function combinationVectorsNewCombVector(e,t){if(0==t)return this.combinationSet.newVector([]);var i=this.baseSet.vectors[e];if(void 0==i)return this.combinationSet.newVector([]);var r=this.combinationSet.newVector(i);return 1!=t&&this.combinationSet.multiplyVector(r,t),this.combinations[e][r]=t,this.inverse[r]={},this.inverse[r][e]=t,r}function combinationVectorsRemoveCombVector(e){this.combinationSet.removeVector(e);for(var t in this.inverse[e])delete this.combinations[t][e];delete this.inverse[e]}function combinationVectorsAddBaseToCombVector(e,t,i){var r=this.baseSet.vectors[t];return void 0!==r&&e in this.combinationSet.vectors&&(e in this.combinations[t]?this.inverse[e][t]=this.combinations[t][e]+=i:(this.combinations[t][e]=i,this.inverse[e][t]=i),this.combinationSet.addToVector(e,r,void 0,i),!0)}function combinationVectorsAddCombToCombVector(e,t,i){if(!(e in this.combinationSet.vectors&&t in this.combinationSet.vectors))return!1;if(!i)return!0;var r=this.inverse[e],n=this.inverse[t];for(var o in n){var s=o in r?r[o]:0,a=s+n[o]*i;0!=this.zeroRounding&&0!=a&&0!=s&&Math.abs(a/s)<this.zeroRounding&&(a=0);var d=Math.abs(a);0!=d&&this.normalizationThreshold&&(d>this.normalizationThreshold||1/d>this.normalizationThreshold)&&(this.normalizationCandidates[e]=!0),0!=a?(r[o]=a,this.combinations[o][e]=a):(delete r[o],delete this.combinations[o][e])}return this.combinationSet.addToVector(e,void 0,t,i),!0}function combinationVectorsEliminate(e,t){var i=this.combinationSet.componentIndex.get(e);if(!i.has(t))return!1;var r=i.get(t).value,n=this.inverse[t],o=Object.keys(n),s=this;return i.forEach(function(i,a){if(a!=t){for(var d=-i.value/r,u=s.inverse[a],h=0,l=o.length;h<l;++h){var c=o[h],p=c in u?u[c]:0,f=p+n[c]*d;0!=s.zeroRounding&&0!=f&&0!=p&&Math.abs(f/p)<s.zeroRounding&&(f=0);var v=Math.abs(f);0!=v&&s.normalizationThreshold&&(v>s.normalizationThreshold||1/v>s.normalizationThreshold)&&(s.normalizationCandidates[a]=!0),0!=f?(u[c]=f,s.combinations[c][a]=f):(delete u[c],delete s.combinations[c][a])}s.combinationSet.addToVector(a,void 0,t,d),s.combinationSet.setValue(a,e,0)}}),!0}function combinationVectorsRepairCombinations(){var e=this.baseSet.componentChanges;for(var t in e)"removed"==e[t]&&this.combinationSet.componentIndex.has(t)&&this.combinationSet.setToZeroInAllVectors(t)}function combinationVectorsCalcNormalizationConstant(e){if(e in this.inverse){for(var t=0,i=1/0,r=this.inverse[e];;){for(var n in r){var o=Math.abs(r[n]);if(o){if(o>t)t=o;else if(o/t<this.zeroRounding)continue;o<i&&(i=o)}}if(i/t>=this.zeroRounding)break;i=1/0}return i>1?1/i:t<1?1/t:1}}function combinationVectorsNormalize(e,t,i){if(e in this.inverse){var r=this.inverse[e];for(var n in r){var o=r[n]*t;r[n]=o,this.combinations[n][e]=o}return i?void this.recalculateCombination(e):void this.combinationSet.multiplyVector(e,t)}}function combinationVectorsRecalculateCombination(e){var t={},i={},r=[],n=this.inverse[e];for(var o in n)for(var s=n[o],a=this.baseSet.vectors[o],d=0,u=a.length;d<u;++d){var h=a[d],l=h.name,c=h.value*s;c&&(l in t||(t[l]=0,i[l]=0),c>0?t[l]+=c:i[l]+=c)}for(var l in t){var p=t[l],f=p+i[l];p&&Math.abs(f/p)<this.zeroRounding||r.push({name:l,value:f})}for(var l in i)l in t||r.push({name:l,value:i[l]});this.combinationSet.setVector(e,r)}function combinationVectorsClearNormalizationCandidates(){this.normalizationCandidates={}}function nextTreeId(){return++treeIdCounter}function TreeNode(e,t){this.name=e,this.up=t,this.down={},this.downNum=0,t?(this.isRoot=!1,this.root=t.root,this.treeId=t.treeId,this.depthId=t.depthId,this.depth=t.depth+1,t.down[e]=this,t.downNum++):(this.isRoot=!0,this.root=this,this.treeId=nextTreeId(),this.depthId=0,this.depth=0)}function treeNodeMakeIntoRoot(){this.up=null,this.root=this,this.isRoot=!0,this.depth=0,this.treeId=nextTreeId(),this.depthId=0}function treeNodeIsUpToDate(){return this.isRoot||this.root.isRoot&&this.treeId==this.root.treeId}function treeNodeIsDepthUpToDate(){return this.isRoot||this.root.isRoot&&this.treeId==this.root.treeId&&this.depthId==this.root.depthId}function treeNodeGetTreeId(){if(this.isUpToDate())return this.treeId;for(this.depth=0,this.root=this;!this.root.isRoot;)++this.depth,this.root=this.root.up;return this.depthId=this.root.depthId,this.treeId=this.root.treeId}function treeNodeGetDepth(){if(this.isDepthUpToDate())return this.depth;for(this.depth=0,this.root=this;!this.root.isRoot;)++this.depth,this.root=this.root.up;return this.treeId=this.root.treeId,this.depthId=this.root.depthId,this.depth}function treeNodeGetRootNode(){return this.getTreeId(),this.root}function treeNodeIsLeaf(){return 0==this.downNum}function Forest(){this.nodes={}}function forestNodeInForest(e){return e in this.nodes}function forestGetNode(e){return this.nodes[e]}function forestIsRoot(e){return e in this.nodes&&this.nodes[e].isRoot}function forestIsLeaf(e){return e in this.nodes&&this.nodes[e].isLeaf()}function forestAddEdge(e,t){if(!e||2!=e.length)return!1;var i=[this.nodes[e[0]],this.nodes[e[1]]];if(i[0]){if(i[1]){if(i[0].getTreeId()==i[1].getTreeId())return!1;var r=i[1].root;return this.mergeTrees(i[0],i[1]),void 0!==t&&t.notifyTreesMerged(r,i[0],i[1]),!0}this.nodes[e[1]]=new TreeNode(e[1],i[0])}else i[1]?this.nodes[e[0]]=i[0]=new TreeNode(e[0],i[1]):(this.nodes[e[0]]=i[0]=new TreeNode(e[0],null),this.nodes[e[1]]=new TreeNode(e[1],i[0]));return void 0!==t&&t.notifyEdgeAdded(e[0],e[1]),!0}function forestRemoveEdge(e,t){if(e&&2==e.length){var i=[this.nodes[e[0]],this.nodes[e[1]]];if(i[0]&&i[1]){var r,n;if(i[0]==i[1].up)r=i[0],n=i[1];else{if(i[1]!=i[0].up)return;r=i[1],n=i[0]}var o;return delete r.down[n.name],0==--r.downNum&&r.isRoot&&(delete this.nodes[r.name],void 0!==t&&t.notifyNodeRemoved(r.name)),0!==n.downNum?(o=r.getRootNode(),r.root.treeId=nextTreeId(),n.makeIntoRoot(),void 0!==t&&t.notifyTreeSplit(o,r,n)):(delete this.nodes[n.name],n.isRoot=!0,void 0!==t&&t.notifyNodeRemoved(n.name)),n}}}function forestReplaceEdge(e,t,i){var r,n;if(e[0]in this.nodes&&(r=this.nodes[e[0]].getTreeId(),n=this.removeEdge(e,i)),void 0===n||0==n.downNum)return this.addEdge(t,i);var o=this.nodes[t[0]],s=this.nodes[t[1]];if(o&&s){var a=o.getTreeId(),d=s.getTreeId(),u=n.treeId,h=n.treeId-1;a==h&&d==u?(o.root.treeId=r,o.root.depthId++):a==u&&d==h&&(s.root.treeId=r,s.root.depthId++,t=[s.name,o.name])}return this.addEdge(t,i)}function forestExchangeWithRoot(e){if(e.up&&!e.up.up){var t=e.up;e.makeIntoRoot(),e.down[t.name]=t,e.downNum++,t.up=e,t.root=e,t.isRoot=!1,t.treeId=e.treeId,t.depthId=0,t.depth=1,delete t.down[e.name],--t.downNum}}function forestSetName(e,t){if(e.name==t)return e;if(!(t in this.nodes))return delete this.nodes[e.name],this.nodes[t]=e,e.up&&(delete e.up.down[e.name],e.up.down[t]=e),e.name=t,e;var i,r;if(e.up){if(i=this.nodes[t],i.up)return!1;r=e}else i=e,r=this.nodes[t];for(var n in i.down){var o=r.down[n]=i.down[n];o.up=r}return r.downNum+=i.downNum,i.isRoot=!1,i==e?delete this.nodes[e.name]:(this.nodes[t]=r,r.name=t),r}function forestMergeTrees(e,t){if(e&&t&&(e.isUpToDate()||e.getTreeId(),t.isUpToDate()||t.getTreeId(),e.treeId!=t.treeId)){for(var i,r=e,n=t;n;)i=n.up,n.up=r,r.down[n.name]=n,r.downNum++,r.name in n.down&&(delete n.down[r.name],n.downNum--),n.root=r.root,n.treeId=r.treeId,n.depthId=r.depthId,n.depth=r.depth+1,r=n,n=i;r.isRoot=!1}}function forestGetTreeId(e){if(e){var t=this.nodes[e];if(t)return t.getTreeId()}}function forestInSameTree(e,t){if(!e||!t)return!1;var i,r;return!(!(i=this.nodes[e])||!(r=this.nodes[t]))&&i.getTreeId()==r.getTreeId()}function forestGetPath(e,t){if(e&&t){var i,r;if((i=this.nodes[e])&&(r=this.nodes[t])&&i.getTreeId()==r.getTreeId()){for(var n=i.getDepth(),o=r.getDepth(),s=[i],a=[r];n>o;)i=i.up,s.push(i),n--;for(;o>n;)r=r.up,a.push(r),o--;for(;i!=r;)i=i.up,s.push(i),r=r.up,a.push(r);for(var d=s.length,u=a.length,h=0;h<u-1;++h)s[d+u-h-2]=a[h];return s}}}function nextVectorId(){return""+ ++vectorIdCounter}function VectorSet(e){this.zeroRounding=e&&e>0?e:0,this.componentIndex=new Map,this.componentChanges={},this.vectors={},this.setSize=0,this.nonZeroSize=0,this.innerProducts=[]}function vectorSetRemoveComponent(e){this.componentIndex.delete(e),"added"==this.componentChanges[e]?delete this.componentChanges[e]:this.componentChanges[e]="removed"}function vectorSetAddComponent(e){var t=new Map;return this.componentIndex.set(e,t),"removed"==this.componentChanges[e]?delete this.componentChanges[e]:this.componentChanges[e]="added",t}function vectorGetValue(e,t){var i;return(i=this.componentIndex.get(t))&&i.has(e)?i.get(e).value:0}function vectorAddValue(e,t,i,r){if(0!=i){var n;if(n=this.componentIndex.has(t)?this.componentIndex.get(t):this.addComponent(t),n.has(e)){var o=n.get(e),s=(o.value,o.value=o.value+i);if(0!==this.zeroRounding&&0!==s&&Math.abs(s/i)<this.zeroRounding&&(s=0),0===s){var a=this.vectors[e],d=a.length-1,u=o.pos;d>o.pos&&(o=a[u]=a[d],o.pos=u),--a.length||--this.nonZeroSize,n.delete(e),0==n.size&&this.removeComponent(t)}}else{var a=this.vectors[e];0===a.length&&this.nonZeroSize++;var o={name:t,value:i,pos:a.length};a.push(o),n.set(e,o)}if(!r)for(var h=this.innerProducts.length-1;h>=0;--h)this.innerProducts[h].addToProducts(this,e,t,i)}}function vectorSetValue(e,t,i,r){var n;if(this.componentIndex.has(t))n=this.componentIndex.get(t);else{if(0==i)return;n=this.addComponent(t)}var o;if(n.has(e))if(r||(o=i-n.get(e).value),0==i){var s=this.vectors[e],a=n.get(e),d=s.length-1,u=a.pos;d>a.pos&&(a=s[u]=s[d],a.pos=u),--s.length||--this.nonZeroSize,n.delete(e),0==n.size&&this.removeComponent(t)}else n.get(e).value=i;else{if(0==i)return;o=i;var s=this.vectors[e];0===s.length&&this.nonZeroSize++;var a={name:t,value:i,pos:s.length};s.push(a),n.set(e,a)}if(!r)for(var h=this.innerProducts.length-1;h>=0;--h)this.innerProducts[h].addToProducts(this,e,t,o)}function vectorSetTransferValue(e,t,i,r,n){if(void 0!=t&&r!=t&&this.addValue(e,t,-i),void 0!==r){var o=r==t?n-i:n;this.addValue(e,r,o)}}function vectorSetMultiplyVector(e,t){if(e in this.vectors){var i=this.vectors[e];if(0!=i.length){if(0==t){for(var r=0,n=i.length;r<n;++r){var o=i[r].name,s=this.componentIndex.get(o);s.delete(e),0==s.size&&this.removeComponent(o)}--this.nonZeroSize}else for(var r=0,n=i.length;r<n;++r)i[r].value*=t;for(var r=this.innerProducts.length-1;r>=0;--r)this.innerProducts[r].multiplyVector(this,e,t)}}}function vectorSetNewVector(e){var t=new Array(e.length),i=nextVectorId();this.vectors[i]=t;for(var r=0,n=e.length;r<n;++r){var o=e[r],s=o.name,a={name:s,value:o.value,pos:r};if(t[r]=a,this.componentIndex.has(s))this.componentIndex.get(s).set(i,a);else{var d=this.addComponent(s);d.set(i,a)}}++this.setSize,t.length>0&&this.nonZeroSize++;for(var r=this.innerProducts.length-1;r>=0;--r)this.innerProducts[r].calcInnerProducts(this,i);return i}function vectorSetSetVector(e,t,i){var r=this.vectors[e];if(!r)return!1;var n=t.length,o=r.length;0===o?0!==n&&this.nonZeroSize++:0===n&&this.nonZeroSize--;for(var s=0;s<n;++s){var a,d=t[s],u=d.name;if(this.componentIndex.has(u)){if(a=this.componentIndex.get(u),a.has(e)){var h=a.get(e);if(void 0!==i){var l=d.value-h.value;0!==l&&(0===this.zeroRounding||Math.abs(l/h.value)>=this.zeroRounding)&&i.push({name:u,value:l})}h.value=d.value;var c=h.pos;if(c>s){var p=r[c]=r[s];p.pos=c,r[s]=h,h.pos=s}continue}}else a=this.addComponent(u);if(o>s){var h;r[o]=h=r[s],h.pos=o,o++}var h={name:u,value:d.value,pos:s};r[s]=h,a.set(e,h),void 0!==i&&i.push({name:u,value:d.value})}if(o>n){for(var s=n;s<o;++s){var u=r[s].name,a=this.componentIndex.get(u);a.delete(e),0==a.size&&this.removeComponent(u),void 0!==i&&i.push({name:u,value:-r[s].value})}r.length=n}for(var s=this.innerProducts.length-1;s>=0;--s)this.innerProducts[s].calcInnerProducts(this,e);return!0}function vectorSetRemoveVector(e){var t=this.vectors[e];if(!t)return!1;0!==t.length&&--this.nonZeroSize;for(var i=0,r=t.length;i<r;++i){var n=t[i].name,o=this.componentIndex.get(n);o.delete(e),0==o.size&&this.removeComponent(n)}delete this.vectors[e],--this.setSize;for(var i=this.innerProducts.length-1;i>=0;--i)this.innerProducts[i].removeVector(this,e);return!0}function vectorSetAddToVector(e,t,i,r){if(void 0!=e&&(void 0!=i&&(t=this.vectors[i]),void 0!==t&&0!==r)){for(var n=0,o=t.length;n<o;++n){var s=t[n];this.addValue(e,s.name,s.value*r,void 0!==i)}if(void 0!=i)for(var n=this.innerProducts.length-1;n>=0;--n)this.innerProducts[n].addVectors(this,e,i,r)}}function vectorSetSetToZeroInAllVectors(e){if(this.componentIndex.has(e)){var t=this.componentIndex.get(e),i=this;t.forEach(function(t,r){for(var n=i.innerProducts.length-1;n>=0;--n)i.innerProducts[n].addToProducts(i,r,e,-t.value);var o=i.vectors[r],s=o.length-1;if(t.pos<s){var a=o[t.pos]=o[s];a.pos=t.pos}--o.length||--i.nonZeroSize}),this.removeComponent(e)}}function vectorSetMerge(e){if(e)for(var t in e.vectors)this.newVector(e.vectors[t])}function vectorSetDuplicate(){var e=new VectorSet(this.zeroRounding);for(var t in this.vectors)e.newVector(this.vectors[t]);return e}function vectorSetRegisterInnerProducts(e){e&&this.innerProducts.push(e)}function vectorSetDeregisterInnerProducts(e){if(e)for(var t=this.innerProducts.length-1;t>=0;--t)if(this.innerProducts[t]==e){this.innerProducts.splice(t,1);break}}function vectorSetClearComponentChanges(){this.componentChanges={}}function Edges(){this.edges={},this.edgesById={}}function edgesGetEdge(e,t){var i;if(e in this.edges&&t in(i=this.edges[e].labels))return i[t]}function edgesGetEdgeId(e,t){var i=this.getEdge(e,t);return void 0===i?void 0:i.id}function edgesGetEdgePoints(e){
if(e in this.edgesById)return this.edgesById[e].labels}function edgesEdgeOtherEnd(e,t){var i=[];if(!(e in this.edges))return i;var r;for(var n in r=this.edges[e].labels)t&&r[n].dir<0||i.push(n);return i}function edgesAllLabelEdges(e){if(e in this.edges)return this.edges[e].labels}function edgesEdgeOppositeEnd(e,t){if(t in this.edgesById){var i=this.edgesById[t].labels;return i[0]==e?i[1]:i[1]==e?i[0]:void 0}}function edgesGetEdgePropById(e){if(e in this.edgesById)return this.edgesById[e].prop}function edgesAddEdge(e,t,i,r,n,o){var s,a;if(e in this.edges&&t in(s=this.edges[e]).labels)s=s.labels[t],r&&this.edgesById[s.id].refCount++,void 0!==n&&(s.prop=n,this.edgesById[s.id].prop=n),void 0!==o&&(this.edges[t].labels[e].prop=o,this.edgesById[s.id].revProp=o);else{var d=void 0===i?makePairId(e,t):i;s||(s=this.edges[e]={labels:{},numLabels:0}),void 0===(a=this.edges[t])&&(a=this.edges[t]={labels:{},numLabels:0}),s.numLabels++,s=s.labels[t]={id:d,dir:1},a.numLabels++,a=a.labels[e]={id:d,dir:-1};var u=this.edgesById[d]={labels:[e,t],refCount:r?1:0};void 0!==n&&(s.prop=n,u.prop=n),void 0!==o&&(a.prop=o,u.revProp=o)}return s}function edgesAllocateEdge(e){if(e in this.edgesById)return++this.edgesById[e].refCount}function edgesSetEdgeProp(e,t,i){var r;e in this.edges&&t in(r=this.edges[e].labels)&&(r=r[t],r.prop=i,1==r.dir?this.edgesById[r.id].prop=i:this.edgesById[r.id].revProp=i)}function edgesReleaseEdge(e){if(!(e in this.edgesById))return!1;var t=this.edgesById[e];return!(--t.refCount>0)&&(this.removeEdge(e,t),!0)}function edgesRemoveEdge(e,t){void 0===t&&(t=this.edgesById[e]);var i=t.labels,r=this.edges[i[0]];delete r.labels[i[1]],0==--r.numLabels&&delete this.edges[i[0]],r=this.edges[i[1]],delete r.labels[i[0]],0==--r.numLabels&&delete this.edges[i[1]],delete this.edgesById[e]}function makePairId(e,t){return e+";"+t}function Cycles(e){this.forest=new Forest,this.cycles=new VectorSet,this.cycleNonForestEdge={},this.edges=e?e:new Edges,this.edgesById={},this.changes={},this.watchedCycles=new VectorSet,this.watchedCycleToEdge={},this.watchedChanges={}}function cyclesNodeInForest(e){return this.forest.nodeInForest(e)}function cyclesGetEdge(e,t){return this.edges.getEdge(e,t)}function cyclesGetEdgePoints(e){return this.edges.getEdgePoints(e)}function cyclesGetEdgeTreeId(e){var t=this.getEdgePoints();if(void 0!==t)return this.forest.getTreeId(t[0])}function cyclesEdgeOtherEnd(e,t){var i=[];if(!(e in this.edges.edges))return i;var r;for(var n in r=this.edges.allLabelEdges(e)){var o=r[n];!(t&&o.dir<0)&&o.id in this.edgesById&&i.push(n)}return i}function cyclesEdgeOppositeEnd(e,t){return this.edges.edgeOppositeEnd(e,t)}function cyclesGetEdgeInfo(e){return this.edgesById[e]}function cyclesIsNormal(e,t){var i=this.edges.getEdgeId(e,t);return i in this.edgesById&&this.edgesById[i].isNormal}function cyclesIsNormalById(e){return e in this.edgesById&&this.edgesById[e].isNormal}function cyclesIsWatched(e,t){var i=this.edges.getEdgeId(e,t);return i in this.edgesById&&this.edgesById[i].isWatched}function cyclesIsWatchedById(e){return e in this.edgesById&&this.edgesById[e].isWatched}function cyclesInForest(e,t){var i=this.edges.getEdgeId(e,t);return i in this.edgesById&&this.edgesById[i].inForest}function cyclesInForestById(e){return e in this.edgesById&&this.edgesById[e].inForest}function cyclesEdgeExists(e){if(!(e in this.edgesById))return!1;var t=this.edgesById[e];return t.inForest||t.isNormal||t.isWatched}function cyclesCreateEdge(e,t,i){var r=this.edges.addEdge(e,t,i),n=r.id;return n in this.edgesById||(this.edgesById[n]={labels:1==r.dir?[e,t]:[t,e],id:n,inForest:!1,isNormal:!1,isWatched:!1},this.edges.allocateEdge(n)),r}function cyclesAddEdge(e,t,i,r,n){var o=this.createEdge(e,t,n),s=this.edgesById[o.id];return void 0!=i&&i!=s.isNormal&&(i?this.addNormalEdge(s):this.removeNormalEdge(s)),void 0!=r&&r!=s.isWatched&&(r?this.addWatchedEdge(s):this.removeWatchedEdge(s)),o}function cyclesAddNormalEdge(e){if(e&&!e.isNormal&&(e.isNormal=!0,!e.inForest)){if(this.forest.addEdge(e.labels,this.notifyMeOfTreeChanges?this:void 0))return void(e.inForest=!0);e.inForest=!1,this.addCycleOrPath(e)}}function cyclesAddCycleOrPath(e){if(!e||e.inForest)return!1;var t=e.isNormal?this.forest.getPath(e.labels[1],e.labels[0]):this.forest.getPath(e.labels[0],e.labels[1]);if(!t)return!1;var i=[];e.isNormal&&i.push({name:e.id,value:1});for(var r,n=void 0,o=0,s=t.length-1;o<s;++o){var a=this.getEdge(t[o].name,t[o+1].name);i.push({name:a.id,value:a.dir}),n||this.edgesById[a.id].isNormal||(n=this.edgesById[a.id],r=a.dir)}if(e.isNormal){var d=!1;void 0!=e.watchedCycle&&(this.removeWatchedCycle(e),d=!0);var u=this.cycles.newVector(i);if(this.cycleNonForestEdge[u]=e.id,this.changes[u]="added",!n)return void(void 0===this.notifyCycleAdded||d||this.notifyCycleAdded(this.cycles,u));this.forest.replaceEdge(n.labels,e.labels,this.notifyMeOfTreeChanges?this:void 0),e.inForest=!0,n.inForest=!1;var h=n.watchedCycle=this.watchedCycles.newVector([{name:n.id,value:1}]);this.watchedCycleToEdge[h]=n.id,this.watchedChanges[h]="added",this.reduceWatchedCyclesByCycle(u,this.cycles.vectors[u],r,n),this.cycles.removeVector(u),delete this.cycleNonForestEdge[u],delete this.changes[u],void 0===this.notifyCycleAdded||d||this.notifyCycleAdded(this.watchedCycles,h)}else e.watchedCycle=this.watchedCycles.newVector(i),this.watchedCycleToEdge[e.watchedCycle]=e.id,this.watchedChanges[e.watchedCycle]="added",void 0!==this.notifyCycleAdded&&this.notifyCycleAdded(this.watchedCycles,u)}function cyclesReduceWatchedCyclesByCycle(e,t,i,r){if(t&&r){var n=r.id,o=this.watchedCycles.componentIndex.get(n),s=this;o.forEach(function(r,n){if(n!=e){var o=r.value;s.watchedCycles.addToVector(n,t,void 0,o==i?-1:1),"added"!=s.watchedChanges[n]&&(s.watchedChanges[n]="changed")}})}}function cyclesAddExternalCycle(e,t,i,r){if(!r)return!1;var n=this.getEdge(e,t);if(n&&this.edgesById[n.id].inForest)return!1;var o=this.forest.getPath(t,e);if(!o)return!1;var s={};n?s[n.id]=n.dir:s[i]=1;for(var a=0,d=o.length-1;a<d;++a){var u=this.getEdge(o[a].name,o[a+1].name);s[u.id]=u.dir}return r.newVector(s),!0}function cyclesAddWatchedEdge(e){if(e&&!e.isWatched&&(e.isWatched=!0,!e.isNormal)){if(this.forest.addEdge(e.labels,this.notifyMeOfTreeChanges?this:void 0))return void(e.inForest=!0);e.inForest=!1,this.addCycleOrPath(e)}}function cyclesRemoveEdge(e,t,i,r){var n=this.getEdge(e,t);return!!n&&this.removeEdgeById(n.id,i,r)}function cyclesRemoveEdgeById(e,t,i){var r=this.edgesById[e];if(!r)return!1;var n=!1;return 0!=i&&r.isWatched&&(n=this.removeWatchedEdge(r)),0!=t&&r.isNormal&&(n=this.removeNormalEdge(r)),r.isNormal||r.isWatched||(this.edges.releaseEdge(e),delete this.edgesById[e]),n}function cyclesRemoveNormalEdge(e){if(!e||!e.isNormal)return!1;if(e.isNormal=!1,e.inForest)return this.removeEdgeFromForest(e);var t=this.cycles.componentIndex.get(e.id),i=this;return t.forEach(function(t,r){i.removeCycle(r,e)}),!1}function cyclesRemoveWatchedEdge(e){if(e&&e.isWatched&&(e.isWatched=!1,!e.isNormal))return e.inForest?this.removeEdgeFromForest(e):(this.removeWatchedCycle(e),!1)}function cyclesRemoveEdgeFromForest(e){if(e&&e.inForest&&!e.isNormal){var t,i,r=e.id;t=this.cycles.componentIndex.get(r),i=this.watchedCycles.componentIndex.get(r);var n=void 0!==t;if(!n){if(e.isWatched)return!1;if(void 0===i)return e.inForest=!1,this.forest.removeEdge(e.labels,this.notifyMeOfTreeChanges?this:void 0)}return n?this.replaceEdgeByCycle(e,t,i):this.replaceEdgeByWatchedCycle(e,i),!1}}function cyclesReplaceEdgeByCycle(e,t,i){if(e&&e.inForest&&void 0!==t){var r=this;t.forEach(function(n,o){var s=r.edgesById[r.cycleNonForestEdge[o]];r.forest.replaceEdge(e.labels,s.labels,r.notifyMeOfTreeChanges?r:void 0),s.inForest=!0,e.inForest=!1;var a=(e.id,r.cycles.vectors[o]),d=n.value;t.forEach(function(e,t){if(t!=o){var i=e.value;r.cycles.addToVector(t,void 0,o,i==d?-1:1),"added"!=r.changes[t]&&(r.changes[t]="changed")}}),void 0!==i&&i.forEach(function(e,t){var i=e.value;r.watchedCycles.addToVector(t,a,void 0,i==d?-1:1),"added"!=r.watchedChanges[t]&&(r.watchedChanges[t]="changed")}),r.removeCycle(o,e)})}}function cyclesReplaceEdgeByWatchedCycle(e,t){if(e&&e.inForest&&void 0!==t){var i=this;t.forEach(function(t,r){var n=i.edgesById[i.watchedCycleToEdge[r]];i.forest.replaceEdge(e.labels,n.labels,i.notifyMeOfTreeChanges?i:void 0),n.inForest=!0,e.inForest=!1,i.watchedCycles.addValue(r,n.id,-1);var o=i.watchedCycles.vectors[r],s=t.value;i.reduceWatchedCyclesByCycle(r,o,s,e);var a=i.edgesById[i.watchedCycleToEdge[r]];i.removeWatchedCycle(a)})}}function cyclesRemoveCycle(e,t){t.isWatched?this.makeWatchedCycleFromCycle(e,t):(void 0!==this.notifyCycleRemoved&&this.notifyCycleRemoved(this.cycles,e),this.cycles.removeVector(e),delete this.cycleNonForestEdge[e],"added"==this.changes[e]?delete this.changes[e]:this.changes[e]="removed")}function cyclesRemoveWatchedCycle(e){var t=e.watchedCycle;void 0!=t&&(void 0===this.notifyCycleRemoved||e.isNormal||this.notifyCycleRemoved(this.watchedCycles,t),this.watchedCycles.removeVector(t),delete this.watchedCycleToEdge[t],"added"==this.watchedChanges[t]?delete this.watchedChanges[t]:this.watchedChanges[t]=e.id,delete e.watchedCycle)}function cyclesMakeWatchedCycleFromCycle(e,t){var i=t.id,r=this.cycles.getValue(e,i);this.cycles.setValue(e,i,0);var n=t.watchedCycle=this.watchedCycles.newVector([]);this.watchedCycles.addToVector(n,this.cycles.vectors[e],void 0,-r),this.watchedCycleToEdge[n]=t.id,this.watchedChanges[n]="added",this.cycles.removeVector(e),delete this.cycleNonForestEdge[e],"added"==this.changes[e]?delete this.changes[e]:this.changes[e]="removed"}function cyclesEdgeInCycle(e){return this.cycles.componentIndex.has(e)}function cyclesClearChanges(){this.changes={},this.watchedChanges={}}function nextVariableId(){return""+ ++variableIdCounter}function LinearConstraints(){this.edges=new Edges,this.cycles=new Cycles(this.edges),this.pairs={},this.pairById={},this.variables={},this.changes={},this.suspended=new SortedList,this.suspendedIndex={},this.byVariable={},this.constraintById={},this.cloneVariables={},this.cloneChanges={}}function linearConstraintsGetPair(e,t,i){if(e&&t){var r=this.pairs[e];if(!r){if(void 0===i)return;r=this.pairs[e]={}}var n=this.pairs[t];if(!n){if(void 0===i)return;n=this.pairs[t]={}}var o=r[t];if(o)return o;if(void 0!==i)return o=r[t]={id:i,dir:1},n[e]={id:i,dir:-1},this.pairById[i]={points:[e,t],pair:o},o}}function linearConstraintsGetPairById(e){var t=this.pairById[e];if(t)return t.pair}function linearConstraintsGetPairPoints(e){var t=this.pairById[e];if(t)return t.points}function linearConstraintsGetPairVariable(e,t){var i=this.getPair(e,t);if(i)return i.index}function linearConstraintsGetOtherInPair(e){var t=[];for(var i in this.pairs[e])t.push(i);return t}function linearConstraintsGetPairVal(e,t){return this.getPair(e,t)}function linearConstraintsSetPairIndexAndRatio(e,t,i,r){var n,o=this.getPair(e,t);if((n=this.variables[i])?o.id in n.pairs||n.numPairs++:n=this.variables[i]={pairs:{},numPairs:1},n.pairs[o.id]=!0,o.index!=i&&void 0!=o.index&&(n=this.variables[o.index],o.id in n.pairs&&(--n.numPairs||n.numClones?delete n.pairs[o.id]:delete this.variables[o.index])),o.index!=i||o.ratio!=r){var s;s=o.id in this.changes?this.changes[o.id]:this.changes[o.id]={prevIndex:o.index,prevRatio:void 0==o.index?void 0:o.ratio*o.dir},s.index=i,s.ratio=r*o.dir,void 0!=o.index&&o.index!=i&&this.changeIndexByPairInByVariable(o,i)}o.index=i,o.ratio=r,o=this.getPair(t,e),o.index=i,o.ratio=-r}function linearConstraintsAddPair(e,t,i){var r=this.getPair(e,t,i);return void 0==r.index&&this.setPairIndexAndRatio(e,t,nextVariableId(),1),r}function linearConstraintsRemovePair(e,t){if(this.pairs[e]&&this.pairs[e][t]){this.removePairConstraints(e,t);var i=this.pairs[e][t],r=this.variables[i.index];i.id in r.pairs&&(--r.numPairs||r.numClones?delete r.pairs[i.id]:delete this.variables[i.index]),this.changes[i.id]||(this.changes[i.id]={prevIndex:i.index,prevRatio:void 0==i.index?void 0:i.ratio*i.dir}),this.changes[i.id].index=void 0,this.changes[i.id].ratio=void 0,delete this.pairById[i.id],delete this.pairs[e][t],isEmptyObj(this.pairs[e])&&delete this.pairs[e],e!==t&&(delete this.pairs[t][e],isEmptyObj(this.pairs[t])&&delete this.pairs[t])}}function linearConstraintsGetEdgeConstraints(e,t){if(this.pairById[e]&&this.pairById[t]){var i=this.edges.getEdge(e,t);if(void 0!==i)return i.prop;if(!this.suspended.isEmpty()){var r=this.suspended.getEntry([e,t]);return r?r:this.suspended.getEntry([t,e])}}}function linearConstraintsGetConstraintByPairIds(e,t){var i=this.getEdgeConstraints(e,t);if(i){if(isArray(i))return{suspended:!1,priority:i[0].priority,scalar:i[0].scalar};var r=i.constraints[0],n=i.pairs[0]==e?r.scalar:1/r.scalar;return{suspended:!0,priority:r.priority,scalar:n}}}function linearConstraintsGetConstraint(e,t,i,r){var n=this.getPair(e,t);if(n){var o=this.getPair(i,r);if(o){var s=this.getConstraintByPairIds(n.id,o.id);if(s)return s.scalar=s.scalar*n.dir*o.dir,s}}}function linearConstraintsAddConstraintToEdge(e,t,i,r,n){var o=this.getEdgeConstraints(e,t);if(!o)return{exists:!1,priority:r,scalar:i,id:n};var s=!isArray(o),a=s?o.constraints:o,d=a[0].priority,u=a[0].scalar,h=!1;s&&o.pairs[0]!=e&&(i=1/i,h=!0);var l;s||(l=this.edges.getEdge(t,e).prop);for(var c=0;c<a.length;++c)if(a[c].id==n){a.splice(c,1),l&&l.splice(c,1);break}var p;for(p=0;p<a.length&&!(r>=a[p].priority);++p);if(a.splice(p,0,{priority:r,scalar:i,id:n}),l&&l.splice(p,0,{priority:r,scalar:1/i,id:n}),d==a[0].priority&&u==a[0].scalar)return!1;var f={exists:!0,suspended:s,otherHighestId:a[0].id!=n,priority:a[0].priority,scalar:h?1/a[0].scalar:a[0].scalar,id:a[0].id};return f.suspended||(f.lowerPriority=d>f.priority),f}function linearConstraintsRemoveConstraintFromEdge(e,t,i){var r=this.getEdgeConstraints(e,t);if(!r)return!1;var n=!isArray(r),o=n?r.constraints:r,s=n?void 0:this.edges.getEdge(t,e).prop;if(void 0==i){for(var a=0;a<o.length;++a)this.removeEdgeAllocationToConstraintId(o[a].id);return o.splice(0),s&&s.splice(0),{empty:!0,suspended:n}}for(var d=o[0].priority,u=o[0].scalar,h=!1,a=0;a<o.length;++a)if(o[a].id==i){h=!0,o.splice(a,1),s&&s.splice(a,1),this.removeEdgeAllocationToConstraintId(i);break}if(!h||o.length&&u==o[0].scalar&&d==o[0].priority)return!1;var l={empty:!o.length,suspended:n};return l.empty||(l.priority=o[0].priority,l.scalar=n&&r.pairs[0]!=e?1/o[0].scalar:o[0].scalar,l.id=o[0].id,l.lowerPriority=d>l.priority),l}function linearConstraintsSetConstraint(e,t,i,r,n,o,s){var a=this.getPair(e,t),d=this.getPair(i,r);return this.setConstraintByPairIds(a.id,d.id,n*a.dir*d.dir,o,s)}function linearConstraintsSetConstraintByPairIds(e,t,i,r,n){if(!i||i==1/0||i==-(1/0))return this.removeConstraint(e,t,n),!1;var o=this.pairById[e],s=this.pairById[t];if(!o||!s)return!1;if(this.allocateEdgeToConstraintId(n,e,t),void 0!=o.pair.index&&void 0!=s.pair.index&&s.pair.index<o.pair.index){var a=e;e=t,t=a;var d=o;o=s,s=d,i=1/i}var u=this.addConstraintToEdge(e,t,i,r,n);return!!u&&(!u.suspended&&u.lowerPriority?this.addLowerPriorityConstraint(e,t,u):this.addHigherPriorityConstraint(e,t,u))}function linearConstraintsAddHigherPriorityConstraint(e,t,i){var r=this.pairById[e]?this.pairById[e].pair:void 0,n=this.pairById[t]?this.pairById[t].pair:void 0;if(!r||!n)return!1;var o=this.checkConflict(r,n,i.scalar,i.priority);if(1==!!o){if(!o.length)return i.exists?i.suspended||this.suspendOrRemoveConstraint(e,t):this.suspendNewEdge(e,t,i.scalar,i.priority,i.id),!1;1==!!o&&this.suspendEdgesById(o)}if(i.suspended)return this.reactivateSuspendedEdge(e,t),!i.otherHighestId;if(i.exists)this.refreshEdge(e,t);else{var s={priority:i.priority,scalar:i.scalar,id:i.id};this.addActiveEdge(e,t,[s])}return(i.exists&&!i.suspended||1==!!o&&o.length>0)&&this.reactivateNonconflictingSuspended(),!0}function linearConstraintsAddLowerPriorityConstraint(e,t,i){var r=this.pairById[e];if(r){for(var n=r.pair.index,o=void 0,s=i.empty?-(1/0):i.priority,a=this.suspended.first;a&&a.sortVal>s;a=a.next)if(this.pairById[a.entry.pairs[0]].pair.index==n){o=a;break}o?this.replaceBySuspendedConstraint(o,e,t):i.empty?this.removeEdge(e,t):this.refreshEdge(e,t),this.reactivateNonconflictingSuspended()}}function linearConstraintsRemoveConstraintById(e){var t=this.constraintById[e];t&&this.removeConstraint(t[0],t[1],e)}function linearConstraintsRemoveConstraint(e,t,i){this.removeEdgeAllocationToConstraintId(i);var r=this.removeConstraintFromEdge(e,t,i);if(r)if(r.suspended){if(r.empty)this.removeEdgeFromSuspended(e,t);else if(r.lowerPriority){var n=this.suspended.getEntry([e,t]);n&&this.addEdgeToSuspended(n,n.pairs,n.constraints[0].priority)}}else(r.lowerPriority||r.empty)&&this.addLowerPriorityConstraint(e,t,r)}function linearConstraintsRemoveConstraintByPoints(e,t,i,r,n){var o=this.getPair(e,t);if(o){var s=this.getPair(i,r);if(s)return this.removeConstraint(o.id,s.id,n)}}function linearConstraintsRemovePairConstraints(e,t){if(this.pairs[e]&&this.pairs[e][t]){var i=this.pairs[e][t];for(var r in this.suspendedIndex[i.id])this.removeConstraint(i.id,r);for(var n=this.cycles.edgeOtherEnd(i.id),o=0,s=n.length;o<s;++o){var r=n[o],a=this.removeConstraintFromEdge(i.id,r);this.addLowerPriorityConstraint(i.id,r,a)}}}function linearConstraintsAddActiveEdge(e,t,i,r){for(var n=[],o=0;o<i.length;++o){var s={id:i[o].id,priority:i[o].priority,scalar:1/i[o].scalar};n.push(s)}this.edges.addEdge(e,t,void 0,!1,i,n),this.cycles.addEdge(e,t,!0,!1),r||this.refreshEdge(e,t)}function linearConstraintsRefreshEdge(e,t){if(!this.cycles.inForest(e,t))return void this.addToByVariable(e,t);var i,r,n,o=this.pairById[e],s=this.pairById[t],a=this.cycles.forest.nodes[e],d=this.cycles.forest.nodes[t];a==d.up?(i=a,r=d,n=o.pair.index):(i=d,r=a,n=s.pair.index),i.isRoot&&void 0==n&&(i==a?this.setPairIndexAndRatio(o.points[0],o.points[1],nextVariableId(),1):this.setPairIndexAndRatio(s.points[0],s.points[1],nextVariableId(),1)),this.addToByVariable(e,t),this.updateVariableAndRatio(r)}function linearConstraintsRemoveEdge(e,t){var i=this.cycles.removeEdge(e,t);i&&this.updateVariableAndRatio(i)}function linearConstraintsUpdateVariableAndRatio(e){if(e){var t=this.pairById[e.name];if(e.isRoot)this.setPairIndexAndRatio(t.points[0],t.points[1],nextVariableId(),1);else{var i=this.edges.getEdge(e.up.name,e.name).prop[0].scalar,r=this.getPairById(e.up.name);this.setPairIndexAndRatio(t.points[0],t.points[1],r.index,r.ratio*i)}for(var n in e.down)this.updateVariableAndRatio(e.down[n])}}function linearConstraintsCheckConflict(e,t,i,r,n){if(!e||!t)return!1;if(void 0==e.index||e.index!=t.index)return!1;if(e.ratio*i==t.ratio)return!1;var o=this.edges.getEdge(e.id,t.id);if(o&&!this.cycles.edgeInCycle(o.id))return!1;if(n)return[];var s=this.conflictResolvingSet(e,t,r);return s}function linearConstraintsConflictResolvingSet(e,t,i){var r=this.cycles.cycles.duplicate(),n=this.edges.getEdge(e.id,t.id);n||(n={id:makePairId(e.id,t.id),dir:1},this.cycles.addExternalCycle(e.id,t.id,n.id,r));for(var o=n.id,s=[],a=r.componentIndex.get(o);0!=a.size;){var d=void 0,u=i,h=this;if(a.forEach(function(e,t){for(var i=r.vectors[t],n=0,s=i.length;n<s;++n){var a=i[n].value;if(a!=o){var l=h.edges.getEdgePropById(a)[0].priority;l<u&&(d=a)}}}),void 0==d)return[];s.push(d);var l=r.componentIndex.get(d);l.forEach(function(e,t){var i=r.vectors[t];l.forEach(function(e,n){if(n!=t){var o=r.vectors[n];r.addToVector(n,void 0,t,o[d]==i[d]?-1:1)}}),r.removeVector(t)})}return s}function linearConstraintsReactivateNonconflictingSuspended(){for(var e,t,i=this.suspended.first;i;){e=this.pairById[i.entry.pairs[0]].pair,t=this.pairById[i.entry.pairs[1]].pair;var r=i.next;void 0!=e.index&&e.index==t.index&&e.ratio*i.entry.scalar!=t.ratio||this.reactivateSuspendedEdge(i.entry.pairs[0],i.entry.pairs[1]),i=r}}function linearConstraintsReactivateSuspendedEdge(e,t){var i=this.suspended.getEntry([e,t]);if(!i){if(i=this.suspended.getEntry([t,e]),!i)return!1;e=i.pairs[0],t=i.pairs[1]}return this.removeEdgeFromSuspended(e,t),this.addActiveEdge(e,t,i.constraints),!0}function linearConstraintsSuspendOrRemoveConstraint(e,t){var i=this.edges.getEdge(e,t);if(i){var r;if(i.dir<0){r=this.edges.getEdgePropById(i.id);var n=e;e=t,t=n}else r=i.prop;if(r.length>0){var o={pairs:[e,t],constraints:r};this.addEdgeToSuspended(o,o.pairs,o.constraints[0].priority)}this.cycles.removeEdge(e,t)}}function linearConstraintsSuspendNewEdge(e,t,i,r,n){var o={pairs:[e,t],constraints:[{scalar:i,priority:r,id:n}]};this.addEdgeToSuspended(o,o.pairs,r)}function linearConstraintsSuspendEdgesById(e){for(var t in e){var i=this.edges.edgesById[e[t]];this.suspendOrRemoveConstraint(i.labels[0],i.labels[1])}}function linearConstraintsReplaceBySuspendedConstraint(e,t,i){var r=e.entry.pairs[0],n=e.entry.pairs[1];this.addActiveEdge(r,n,e.entry.constraints,!0),this.suspended.remove(e.entry.pairs),this.suspendOrRemoveConstraint(t,i),this.refreshEdge(r,n)}function linearConstraintsAddEdgeToSuspended(e,t,i){this.suspended.insert(e,t,i),this.suspendedIndex[t[0]]||(this.suspendedIndex[t[0]]={}),this.suspendedIndex[t[0]][t[1]]=1,this.suspendedIndex[t[1]]||(this.suspendedIndex[t[1]]={}),this.suspendedIndex[t[1]][t[0]]=-1}function linearConstraintsRemoveEdgeFromSuspended(e,t){if(this.suspendedIndex[e]){var i=this.suspendedIndex[e][t];i&&(i>0?this.suspended.remove([e,t]):this.suspended.remove([t,e]),delete this.suspendedIndex[e][t],delete this.suspendedIndex[t][e],isEmptyObj(this.suspendedIndex[e])&&delete this.suspendedIndex[e],isEmptyObj(this.suspendedIndex[t])&&delete this.suspendedIndex[t])}}function linearConstraintsClearChanges(){this.changes={}}function linearConstraintsAddToByVariable(e,t){if(e&&t){var i=this.edges.getEdge(e,t);if(i){var r={pairs:1==i.dir?[e,t]:[t,e],priority:i.prop[0].priority,scalar:1==i.dir?i.prop[0].scalar:1/i.prop[0].scalar},n=this.pairById[e].pair.index;this.byVariable[n]||(this.byVariable[n]=new SortedList),this.byVariable[n].insert(r,r.pairs,r.priority)}}}function linearConstraintsRemoveFromByVariable(e,t,i){if(this.byVariable[i]){var r=this.byVariable[i].remove([e,t]);if(r||(r=this.byVariable[i].remove([t,e])),r)return this.byVariable[i].isEmpty()&&delete this.byVariable[i],r}}function linearConstraintsChangeIndexByPairInByVariable(e,t){if(e&&void 0!=e.index&&e.index!=t){var i=this.cycles.edgeOtherEnd(e.id,!0);if(i.length){this.byVariable[t]||(this.byVariable[t]=new SortedList);for(var r in i){var n=this.removeFromByVariable(e.id,i[r],e.index);n&&this.byVariable[t].insert(n,n.pairs,n.priority)}}}}function linearConstraintsAllocateEdgeToConstraintId(e,t,i){var r=this.constraintById[e];if(r){if(t==r[0]&&i==r[1]||i==r[0]&&t==r[1])return;this.removeConstraint(r[0],r[1],e)}this.constraintById[e]=[t,i]}function linearConstraintsRemoveEdgeAllocationToConstraintId(e){var t=this.constraintById[e];if(t)return delete this.constraintById[e],t}function linearConstraintsCreateClone(e){var t=nextVariableId();this.cloneVariables[t]=e;var i;return(i=this.variables[e])?"clones"in i?i.numClones++:(i.clones={},i.numClones=1):i=this.variables[e]={pairs:{},numPairs:0,clones:{},numClones:1},i.clones[t]=!0,"removed"==this.cloneChanges[t]?this.cloneChanges[t]:this.cloneChanges[t]="added",t}function linearConstraintsDestroyIfClone(e){var t=this.cloneVariables[e];if(void 0!=t){delete this.cloneVariables[e];var i;void 0!==(i=this.variables[t])&&"clones"in i&&e in i.clones&&(--i.numClones||0!=i.numPairs?delete i.clones[e]:delete this.variables[t]),"added"==this.cloneChanges[e]?delete this.cloneChanges[e]:this.cloneChanges[e]="removed"}}function linearConstraintsClearCloneChanges(e){this.cloneChanges={}}function linearConstraintsGetMainVariable(e){return void 0==this.cloneVariables[e]?e:this.cloneVariables[e]}function linearConstraintsVariableExists(e){return!!this.variables[e]||!!this.cloneVariables[e]}function linearConstraintsHasConstraint(e,t){var i=this.getPair(e,t);return!!i&&(!!this.cycles.nodeInForest(i.id)||!!this.suspendedIndex[i.id])}function linearConstraintsHasActiveConstraint(e){return!!this.byVariable[e]}function linearConstraintsGetPointsById(e){var t=this.constraintById[e];if(t){var i=this.pairById[t[0]].points,r=this.pairById[t[1]].points;return[i[0],i[1],r[0],r[1]]}}function linearConstraintsDebugGetVarStr(e){var t=e+" (",i=0,r="",n=0;if(this.cloneVariables[e])return t+"clone of: "+this.cloneVariables[e]+")";var o=this.variables[e];if(o.numClones)for(var s in o.clones)n++,n>1&&(r+=", "),3==n?r+="...":n<3&&(r+=s);for(var s in o.pairs){if(i++,i>1&&(t+=", "),i>2){t+="...";break}t+=s}return i||(t+="clones: "+r),t+=")"}function SegmentConstraints(e){this.variables={},this.pairs={},this.pairById={},this.linearConstraints=e?e:new LinearConstraints,this.changes={},this.orGroups={},this.orGroupsRemoved={},this.orGroupPriorityChanges={}}function segmentConstraintsGetPair(e,t){if(e&&t){if(this.pairs[e]||(this.pairs[e]={}),this.pairs[t]||(this.pairs[t]={}),this.pairs[e][t])return this.pairs[e][t];var i=this.linearConstraints.getPairVal(e,t),r=i.dir,n={points:r>0?[e,t]:[t,e],index:i.index,ratio:r>0?i.ratio:-i.ratio,ids:{}},o=i.id;return this.pairs[e][t]={id:o,dir:r,entry:n},this.pairs[t][e]={id:o,dir:-r,entry:n},this.pairById[o]=this.pairs[e][t].entry,this.pairs[e][t]}}function segmentConstraintsGetIndexEntry(e){return this.variables[e]||(this.variables[e]={hasOrGroups:!1}),this.variables[e]}function segmentConstraintsClearIndexEntry(e){var t=this.variables[e];t&&void 0==t.min&&void 0==t.max&&void 0==t.stability&&(delete this.variables[e],this.linearConstraints.destroyIfClone(e))}function segmentConstraintsSetConstraint(e,t,i,r,n,o,s,a,d){if(void 0==n&&void 0==o&&!s&&"min"!=a&&"max"!=a)return void this.removeConstraint(e,t,i);d&&!d.orGroupDesc&&(d=void 0);var u=!1,h=this.getPair(e,t),l=h.entry.ids[i];l?l.priority!=r&&(u=!0):l=h.entry.ids[i]={},void 0==n?void 0==o?l.min=l.max=void 0:(l.min=1==h.dir?void 0:-o,l.max=1==h.dir?o:void 0):void 0==o?(l.min=1==h.dir?n:void 0,l.max=1==h.dir?void 0:-n):n<=o?(l.min=1==h.dir?n:-o,l.max=1==h.dir?o:-n):(l.min=1==h.dir?o:-n,l.max=1==h.dir?n:-o),l.priority=r,l.stability=!!s,"min"==a?((void 0==l.min||l.min<0)&&(l.min=void 0!=l.max&&l.max<0?l.max:0),(void 0==l.max||l.max>0)&&(l.max=void 0!=l.min&&l.min>0?l.min:0),l.preference="min"):"max"==a?(h.dir>0?l.min=void 0==l.max?1/0:l.max:l.max=void 0==l.min?-(1/0):l.min,l.preference="max"):delete l.preference,(d||l.orGroups)&&this.updateOrGroups(h,i,d,u),this.updateVariableSegmentConstraints(h,i),this.updateVariableStability(h.entry,i),void 0==l.min&&void 0==l.max&&l.cloneIndex&&(this.clearIndexEntry(l.cloneIndex),delete l.cloneIndex),this.clearIndexEntry(h.entry.index)}function segmentConstraintsUpdateVariableSegmentConstraints(e,t){if(e){var i=e.entry.ids[t];if(i){var r,n;e.entry.ratio<0?(void 0!=i.max&&(r=i.max/e.entry.ratio),void 0!=i.min&&(n=i.min/e.entry.ratio)):(void 0!=i.min&&(r=i.min/e.entry.ratio),void 0!=i.max&&(n=i.max/e.entry.ratio)),this.assignConstraintToVariable(e.entry,t,r,n)}}}function segmentConstraintsAssignConstraintToVariable(e,t,i,r){var n,o=e.ids[t];if(void 0!=o.cloneIndex)n=o.cloneIndex;else{var s=this.getIndexEntry(e.index);if(void 0!=i&&s.max&&s.max.value<i&&(s.max.idNum>1||!s.max.ids[t])||void 0!=r&&s.min&&s.min.value>r&&(s.min.idNum>1||!s.min.ids[t])||s.stability&&(void 0!=r||void 0!=i))return this.replaceConstraintOnVariable(t,e.index,!0),this.replaceConstraintOnVariable(t,e.index,!1),n=o.cloneIndex=this.linearConstraints.createClone(e.index),this.addConstraintToVariable(n,t,i,o.priority,o.orGroups?o.orGroups.labels:void 0,!0),void this.addConstraintToVariable(n,t,r,o.priority,o.orGroups?o.orGroups.labels:void 0,!1);n=e.index}this.replaceConstraintOnVariable(t,n,!0,i,o.priority,o.orGroups?o.orGroups.labels:void 0),this.replaceConstraintOnVariable(t,n,!1,r,o.priority,o.orGroups?o.orGroups.labels:void 0)}function segmentConstraintsReplaceConstraintOnVariable(e,t,i,r,n,o){for(var s=this.getIndexEntry(t),a=void 0,d=i?s.min:s.max;d&&!d.ids[e];)a=d,d=d.next;var u=d?d.ids[e]:void 0,h=!1,l=u?u.orGroups:void 0,c=u?u.priority:void 0;u&&void 0!=r&&r==d.value?(u.priority=n,o?o!=u.orGroups&&(u.orGroups=o,h=!0):u.orGroups&&(h=!0,delete u.orGroups),this.updateConstraintPriority(d,c,n,l,o)&&(h=!0)):u&&(delete d.ids[e],--d.idNum?this.updateConstraintPriority(d,c,void 0,l,void 0)&&(h=!0):(a?a.next=d.next:i?s.min=d.next:s.max=d.next,h=!0)),void 0==r||d&&d.value==r||(i?this.addConstraintToVariable(t,e,r,n,o,!0):this.addConstraintToVariable(t,e,r,n,o,!1)),h&&this.addChange(t),(l||o)&&this.refreshOrGroupsOnVariable(t,s,l,o)}function segmentConstraintsAddConstraintToVariable(e,t,i,r,n,o){if(void 0!=i){for(var s=this.getIndexEntry(e),a=void 0,d=o?s.min:s.max,u=o?-1:1;d&&!(u*d.value>=u*i);)a=d,d=d.next;(!d||u*d.value>u*i)&&(d={value:i,priority:-(1/0),ids:{},idNum:0,next:d},a?a.next=d:o?s.min=d:s.max=d);var h=d.ids[t]?d.ids[t].orGroups:void 0;d.ids[t]={priority:r},n&&(d.ids[t].orGroups=n,this.addChange(e)),d.idNum++,this.updateConstraintPriority(d,void 0,r,h,n)&&this.addChange(e),(h||n)&&this.refreshOrGroupsOnVariable(e,s,h,n)}}function segmentConstraintsUpdateVariableStability(e,t){if(!e)return!1;var i=e.ids[t];if(!i)return!1;var r,n=void 0==e.stabilityClone?e.index:e.stabilityClone,o=this.getIndexEntry(n),s=o.stability;if(!i.stability){if(!s||!s.ids[t])return;return void this.removeStability(e,t)}s||((o.min||o.max)&&(n=e.stabilityClone=this.linearConstraints.createClone(e.index),o=this.getIndexEntry(n)),s=o.stability={priority:-(1/0),ids:{}});var a=s.ids[t];a||(a=s.ids[t]={}),r=a.orGroups,a.priority=i.priority,i.orGroups?i.orGroups.labels!=a.orGroups&&(a.orGroups=i.orGroups.labels,this.addChange(n)):a.orGroups&&(delete a.orGroups,this.addChange(n)),this.recalcStabilityPriority(n),(r||i.orGroups)&&this.refreshOrGroupsOnVariable(n,o,r,i.orGroups?i.orGroups.labels:void 0)}function segmentConstraintsRecalcStabilityPriority(e){var t=this.variables[e];if(t){var i=t.stability;if(i){var r=-(1/0);for(var n in i.ids){var o=i.ids[n];o.orGroups&&!isEmptyObj(o.orGroups)||r<o.priority&&(r=o.priority)}r!=i.priority&&(i.priority=r,this.addChange(e))}}}function segmentConstraintsRemoveStability(e,t){var i=void 0==e.stabilityClone?e.index:e.stabilityClone,r=this.variables[i];if(r&&r.stability&&r.stability.ids[t]){var n=r.stability,o=n.ids[t].orGroups;delete n.ids[t],o&&this.refreshOrGroupsOnVariable(i,r,o,void 0),isEmptyObj(n.ids)?(delete r.stability,this.clearIndexEntry(i),this.addChange(i),delete e.stabilityClone):this.recalcStabilityPriority(i)}}function segmentConstraintsRemoveConstraint(e,t,i){this.pairs[e]&&this.pairs[e][t]&&this.removeConstraintByPairId(this.pairs[e][t].id,i)}function segmentConstraintsRemoveConstraintByPairId(e,t){var i=this.pairById[e]?this.pairById[e]:void 0;if(i&&void 0!=t&&i.ids[t]){var r=i.ids[t],n=void 0!=r.cloneIndex?r.cloneIndex:i.index;if(this.replaceConstraintOnVariable(t,n,!0),this.replaceConstraintOnVariable(t,n,!1),r.stability&&(delete r.stability,this.updateVariableStability(i,t),this.clearIndexEntry(i.index)),n!=i.index?this.clearIndexEntry(n):this.clearIndexEntry(i.index),delete i.ids[t],isEmptyObj(i.ids)){var o=i.points[0],s=i.points[1];delete this.pairById[e],delete this.pairs[o][s],isEmptyObj(this.pairs[o])&&delete this.pairs[o],delete this.pairs[s][o],isEmptyObj(this.pairs[s])&&delete this.pairs[s]}}}function segmentConstraintsRemovePair(e,t){if(this.pairs[e]){var i=this.pairs[e][t];if(i)for(var r in i.entry.ids)this.removeConstraintByPairId(i.id,r)}}function segmentConstraintsAddChange(e){this.changes[e]=!0}function segmentConstraintsClearChanges(){this.changes={}}function segmentConstraintsUpdateConstraintPriority(e,t,i,r,n){if(t==i&&r==n)return!1;if(void 0==e.priority&&(e.priority=-(1/0)),void 0!=i&&i>=e.priority&&isEmptyObj(n))return e.priority!=i&&(e.priority=i,!0);if(void 0==t||t<e.priority||r&&!isEmptyObj(r))return!1;var t=e.priority;e.priority=-(1/0);for(var o in e.ids){var s=e.ids[o];s.priority>e.priority&&(!s.orGroups||isEmptyObj(s.orGroups))&&(e.priority=s.priority)}return t!=e.priority}function segmentConstraintsAddConstraintNonOrGroupPriority(e,t){
var i=this.variables[e];if(!i)return!1;var r=!1;for(var n in{min:!0,max:!0,stability:!0})if(i[n]&&void 0!==t[n]&&t[n]!==!1){var o=i[n];if("stability"!=n)for(;t[n]!=o.value;)o=o.next;t.priority>o.priority&&(o.priority=t.priority,r=!0)}return r}function segmentConstraintsRemoveConstraintNonOrGroupPriority(e,t,i){var r=this.variables[e];if(!r)return!1;var n=!1;for(var o in{min:!0,max:!0,stability:!0})if(r[o]&&void 0!==i[o]&&i[o]!==!1){var s=r[o];if("stability"!=o)for(;s&&i[o]!=s.value;)s=s.next;if(!s)return!1;if(i.priority==s.priority){var a=s.priority,d=-(1/0);for(var u in s.ids)if(u!=t){var h=s.ids[u];h.priority<=d||h.orGroups&&!isEmptyObj(h.orGroups)||(d=h.priority)}a!=d&&(s.priority=d,n=!0)}}return n}function segmentConstraintsHasConstraint(e,t){return!!this.pairs[e]&&!!this.pairs[e][t]}function segmentConstraintsVariableHasConstraint(e){return!!this.variables[e]}function segmentConstraintsPairHasConstraint(e){return!!this.pairById[e]}function segmentConstraintsVariableHasOrGroups(e){return!!this.variables[e]&&this.variables[e].hasOrGroups}function segmentConstraintsSetVariableHasOrGroups(e){this.variables[e]&&(this.variables[e].hasOrGroups=!0)}function segmentConstraintsGetVariableOrGroups(e){var t=this.variables[e];if(t&&t.hasOrGroups){var i={};for(var r in t)for(var n=t[r];n;){for(var o in n.ids)if(n.ids[o].orGroups)for(var s in n.ids[o].orGroups)i[s]=!0;n=n.next}return i}}function segmentConstraintsProcessLinearConstraintChanges(){var e=this.linearConstraints.changes;for(var t in e)if(void 0!=e[t].index){var i=this.linearConstraints.pairById[t].points;this.updateNewIndexOrRatio(i[0],i[1])}}function segmentConstraintsUpdateNewIndexOrRatio(e,t){if(this.pairs[e]&&this.pairs[e][t]){var i=this.pairs[e][t],r=i.entry,n=this.linearConstraints.getPairVal(r.points[0],r.points[1]);if(r.index!=n.index||r.ratio!=n.ratio){var o=r.index;r.ratio;if(o!=n.index)for(var s in r.ids){var a=r.ids[s],d=void 0!=a.cloneIndex?a.cloneIndex:o;delete a.cloneIndex,this.replaceConstraintOnVariable(s,d,!0),this.replaceConstraintOnVariable(s,d,!1),this.removeStability(r,s),d!=o&&this.clearIndexEntry(d)}r.index=n.index,r.ratio=n.ratio;for(var s in r.ids){var a=r.ids[s];o!=r.index&&this.updateVariableStability(r,s),this.updateVariableSegmentConstraints(i,s)}this.clearIndexEntry(o)}}}function segmentConstraintsGetMax(e,t){var i=this.variables[e];if(!i||!i.max)return 1/0;var r=i.max;return t&&r.value==-(1/0)&&(r=r.next),r?r.value:1/0}function segmentConstraintsGetMin(e,t){var i=this.variables[e];if(!i||!i.min)return-(1/0);var r=i.min;return t&&r.value==1/0&&(r=r.next),r?r.value:-(1/0)}function segmentConstraintsPriorityForValue(e,t,i){var r=this.variables[e];if(r){var n=i?r.min:r.max;if(n){for(var o,s=-(1/0);n;){if(i&&n.value<=t||!i&&n.value>=t)break;n.priority>s&&(s=n.priority,o=n.value),n=n.next}var a;if(!n||i&&n.value<t||!i&&n.value>t){if(s==-(1/0))return;a={priorityAtVal:-(1/0)}}else a={priorityAtVal:n.priority};return a.violatedPriority=s,s!=-(1/0)&&(a.violatedValue=o),a}}}function segmentConstraintsNextValue(e,t,i){var r=this.variables[e];if(!r)return i?-(1/0):1/0;var n=i?r.min:r.max;if(i){for(var n=r.min;n&&n.value>=t;)n=n.next;return n?n.value:-(1/0)}for(var n=r.max;n&&n.value<=t;)n=n.next;return n?n.value:1/0}function segmentConstraintsGetOrGroupMinOrMaxSatisfaction(e,t,i){for(var r={},n=this.variables[e],o=i?n.min:n.max;o;){var s;s=i?o.value>t?o.value:o.value==t?"[":"(":o.value<t?o.value:o.value==t?"]":")";for(var a in o.ids)if(o.ids[a].orGroups)for(var d in o.ids[a].orGroups)r[d]=s;o=o.next}return r}function segmentConstraintsGetOrGroupSatisfaction(e,t,i){var r={},n=this.variables[e];if(!n||!n.hasOrGroups)return r;r=this.getOrGroupMinOrMaxSatisfaction(e,t,!0);var o=this.getOrGroupMinOrMaxSatisfaction(e,t,!1);for(var s in r)"number"!=typeof r[s]&&(s in o?"number"==typeof o[s]?r[s]=o[s]:r[s]=r[s]+o[s]:r[s]=r[s]+")");for(var s in o)s in r||("number"==typeof o[s]?r[s]=o[s]:r[s]="("+o[s]);if(void 0==i||!n.stability)return r;for(var a in n.stability.ids){var d=n.stability.ids[a];if(d.orGroups)for(var u in d.orGroups)u in r&&!r[u]||(r[u]=t==i?"[]":i)}return r}function segmentConstraintsAllowsMovement(e,t,i){var r=this.variables[e];if(!r)return!0;if(r.stability)return!1;for(var n="down"==t,o=n?r.min:r.max,s={};o&&!(n&&o.value<=i||!n&&o.value>=i);){if(o.priority>-(1/0))return!1;for(var a in o.ids)for(var d in o.ids[a].orGroups)s[d]=!0;o=o.next}if(isEmptyObj(s))return!0;for(;o;){for(var a in o.ids)for(var d in o.ids[a].orGroups)delete s[d];o=o.next}return!!isEmptyObj(s)||s}function segmentConstraintsGetStability(e){var t=this.variables[e];return t&&t.stability&&void 0!=t.stability.priority?t.stability.priority:-(1/0)}function segmentConstraintsGetPreferredValue(e,t){var i=this.variables[e];if(!i)return 0;var r=this.getMin(e,!0),n=this.getMax(e,!0);return void 0==t&&(t=0),r>t?t=r:n<t&&(t=n),t}function segmentConstraintsUpdateOrGroups(e,t,i,r){if(e){var n=e.entry.ids[t];if(n){if(!i||!i.baseArea){if(!n.orGroups)return;return void this.destroyOrGroups(e.id,t)}if(n.orGroups&&n.orGroups.baseArea!=i.baseArea&&this.destroyOrGroups(e.id,t),n.orGroups||(n.orGroups=new PosPoint(i.baseArea,i.cm),n.orGroups.registerHandler(new OrGroupHandler(this,e.id,t)),r=!1),n.orGroups.newDescription(i.orGroupDesc),r)for(var o in n.orGroups.labels)this.refreshOrGroupPriority(o)}}}function segmentConstraintsDestroyOrGroups(e,t){var i=this.pairById[e];if(i){var r=i.ids[t];r&&r.orGroups&&(r.orGroups.destroyPoint(),delete r.orGroups)}}function segmentConstraintsAddToOrGroup(e,t,i){this.orGroups[e]||(this.orGroups[e]={constraints:{}}),this.orGroups[e].constraints[t]||(this.orGroups[e].constraints[t]={}),this.orGroups[e].constraints[t][i]=!0;var r=this.pairById[t].ids[i],n=r.priority;n!=this.orGroups[e].priority&&this.refreshOrGroupPriority(e);var o=void 0==r.cloneIndex?this.pairById[t].index:r.cloneIndex;void 0!=o&&(isEmptyObj(r.orGroups.labels)||this.removeConstraintNonOrGroupPriority(o,i,r),this.addChange(o),this.delOrGroupRemove(e,o),this.setVariableHasOrGroups(o))}function segmentConstraintsRemoveFromOrGroup(e,t,i){if(this.orGroups[e]&&this.orGroups[e].constraints[t]){delete this.orGroups[e].constraints[t][i],isEmptyObj(this.orGroups[e].constraints[t])&&delete this.orGroups[e].constraints[t],isEmptyObj(this.orGroups[e].constraints)&&delete this.orGroups[e],this.orGroups[e]&&!this.orGroups[e].allPrioritiesEqual&&this.refreshOrGroupPriority(e);var r=this.pairById[t].ids[i],n=void 0==r.cloneIndex?this.pairById[t].index:r.cloneIndex;void 0!=n&&(isEmptyObj(r.orGroups)&&this.addConstraintNonOrGroupPriority(n,r),this.addChange(n),this.addOrGroupRemove(e,n),this.refreshHasOrGroups(n))}}function segmentConstraintsRefreshOrGroupPriority(e){var t=this.orGroups[e];if(t){var i=-(1/0),r=!0,n=!0,o=t.constraints;for(var s in o)for(var a in o[s]){var d=this.pairById[s].ids[a].priority;d<i?n=!1:d>i&&(r||(n=!1),i=d),r=!1}t.priority!=i&&void 0==this.orGroupPriorityChanges[e]&&(this.orGroupPriorityChanges[e]=t.priority),t.priority=i,t.allPrioritiesEqual=n}}function segmentConstraintsRefreshOrGroupsOnVariable(e,t,i,r){if(i!=r){if(i)for(var n in i)r&&n in r||this.variableHasOrGroup(t,n)||(this.addChange(e),this.addOrGroupRemove(n,e));if(r&&!isEmptyObj(r)){t.hasOrGroups=!0;for(var n in r)i&&n in i||(this.addChange(e),this.delOrGroupRemove(n,e))}else t.hasOrGroups=this.hasAnyOrGroups(t)}}function segmentConstraintsVariableHasOrGroup(e,t){if(!e)return!1;for(var i in e)for(var r=e[i];r;){for(var n in r.ids)if(r.ids[n].orGroups&&r.ids[n].orGroups[t])return!0;r=r.next}return!1}function segmentConstraintsHasAnyOrGroups(e){if(!e)return!1;for(var t in e)for(var i=e[t];i;){for(var r in i.ids)if(i.ids[r].orGroups&&!isEmptyObj(i.ids[r].orGroups))return!0;i=i.next}return!1}function segmentConstraintsRefreshHasOrGroups(e){var t=this.variables[e];t&&(t.hasOrGroups=this.hasAnyOrGroups(t))}function segmentConstraintsVariableHasOrGroups(e){var t=this.variables[e];return!!t&&t.hasOrGroups}function segmentConstraintsGetOrGroupPriority(e){return this.orGroups[e]&&void 0!=this.orGroups[e].priority?this.orGroups[e].priority:-(1/0)}function segmentConstraintsAddOrGroupRemove(e,t){var i=this.orGroupsRemoved[e];i||(i=this.orGroupsRemoved[e]={}),i[t]=!0}function segmentConstraintsDelOrGroupRemove(e,t){var i=this.orGroupsRemoved[e];i&&delete i[t]}function segmentConstraintsClearOrGroupChanges(){this.orGroupsRemoved={},this.orGroupPriorityChanges={}}function segmentConstraintsOrGroupHandler(e,t){var i=this.pairById[e];if(i){var r=i.ids[t];if(r){var n=r.orGroups;for(var o in n.changes)"added"==n.changes[o]?this.addToOrGroup(o,e,t):this.removeFromOrGroup(o,e,t)}}}function OrGroupHandler(e,t,i){this.segmentConstraints=e,this.pairId=t,this.constraintId=i}function orGroupHandlerCall(e,t){this.segmentConstraints&&this.segmentConstraints.orGroupHandler(this.pairId,this.constraintId)}function OrGroups(e){this.segmentConstraints=e,this.orGroups={},this.changes={}}function orGroupsGetGroupStatus(e){return this.orGroups[e]?this.orGroups[e].numSatisfied>0?"satisfied":"violated":"unknown"}function orGroupsGetOrGroupSatisfaction(e,t){var i=this.orGroups[e];if(i)return i.satisfied[t]?i.satisfied[t]:t in i.violated?i.violated[t]:void 0}function orGroupsIsOrGroupSatisfiedOnVariable(e,t){return!!this.orGroups[e]&&this.orGroups[e].satisfied[t]}function orGroupsOrGroupSatisfiedOnVariableOnly(e,t){return!!this.orGroups[e]&&this.orGroups[e].satisfied[t]&&1==this.orGroups[e].numSatisfied}function orGroupsIsOrGroupSatisfiedOnOtherVariable(e,t){if(!this.orGroups[e])return!1;for(var i in this.orGroups[e].satisfied)if(i!=t)return!0;return!1}function orGroupsGetFirstSatisfiedVariable(e,t){var i=this.orGroups[e];if(i)for(var r in i.satisfied)if(r!=t)return r}function orGroupsGetSatisfiedVariables(e){if(this.orGroups[e])return this.orGroups[e].satisfied}function orGroupsUpdateVariableSatisfaction(e,t,i){var r=this.segmentConstraints.getOrGroupSatisfaction(e,t,i);for(var n in r){var o=this.orGroups[n];o||(o=this.orGroups[n]={satisfied:{},numSatisfied:0,violated:{},numViolated:0},this.addStatusChange(n,"unknown")),"number"==typeof r[n]?(o.satisfied[e]?(this.addVariableChange(n,e,o.satisfied[e]),delete o.satisfied[e],o.numSatisfied--,o.numSatisfied||this.addStatusChange(n,"satisfied"),o.numViolated++):void 0!=o.violated[e]?o.violated[e]!=r[n]&&this.addVariableChange(n,e,o.violated[e]):(o.numViolated++,this.addVariableChange(n,e,void 0)),o.violated[e]=r[n]):(void 0!=o.violated[e]&&(this.addVariableChange(n,e,o.violated[e]),delete o.violated[e],o.numViolated--),o.satisfied[e]?o.satisfied[e]!=r[n]&&this.addVariableChange(n,e,o.satisfied[e]):(this.addVariableChange(n,e,void 0),o.numSatisfied++,1==o.numSatisfied&&this.addStatusChange(n,"violated")),o.satisfied[e]=r[n])}}function orGroupsRemoveVariableFromGroup(e,t){var i=this.orGroups[t];i&&(i.satisfied[e]?(i.numSatisfied--,i.numSatisfied||this.addStatusChange(t,"satisfied"),this.addVariableChange(t,e,i.satisfied[e]),delete i.satisfied[e]):void 0!=i.violated[e]&&(this.addVariableChange(t,e,i.violated[e]),delete i.violated[e],i.numViolated--,i.numViolated||i.numSatisfied||this.addStatusChange(t,"violated")),i.numSatisfied||i.numViolated||delete this.orGroups[t])}function orGroupsRefreshModifiedGroups(){var e=this.segmentConstraints.orGroupsRemoved;for(var t in e)for(var i in e[t])this.removeVariableFromGroup(i,t);var r=this.segmentConstraints.orGroupPriorityChanges;for(var t in r)this.addPriorityChange(t,r[t]);this.segmentConstraints.clearOrGroupChanges()}function orGroupsAddVariableChange(e,t,i){this.changes[e]||(this.changes[e]={}),this.changes[e].variables||(this.changes[e].variables={}),t in this.changes[e].variables||(this.changes[e].variables[t]=i)}function orGroupsAddStatusChange(e,t){this.changes[e]||(this.changes[e]={}),this.changes[e].status||(this.changes[e].status=t)}function orGroupsAddPriorityChange(e,t){this.changes[e]||(this.changes[e]={}),"priority"in this.changes[e]||(this.changes[e].priority=t)}function orGroupsClearChanges(){this.changes={}}function VecInnerProducts(e,t,i){this.zeroRounding=i&&i>0?i:0,e&&t&&(this.vectorSet=e,this.dualVector=t,this.innerProducts={},this.vectorSet.registerInnerProducts(this),this.calcDualInnerProducts())}function vecInnerProductsAddToProducts(e,t,i,r){var n;if(this.dualVector[i]){if(t in this.innerProducts){var o=this.innerProducts[t];n=o+this.dualVector[i]*r,0!==this.zeroRounding&&0!=n&&Math.abs(n/o)<this.zeroRounding?n=0:n&&(this.innerProducts[t]=n)}else n=this.innerProducts[t]=this.dualVector[i]*r;n||delete this.innerProducts[t]}}function vecInnerProductsAddDualToProducts(e,t){if(this.vectorSet.componentIndex.has(e)){var i=this.vectorSet.componentIndex.get(e),r=this;i.forEach(function(e,i){var n,o=e.value;if(i in r.innerProducts){var s=r.innerProducts[i];n=s+o*t,0!==r.zeroRounding&&0!=n&&Math.abs(n/s)<r.zeroRounding?n=0:n&&(r.innerProducts[i]=n)}else n=r.innerProducts[i]=o*t;n||delete r.innerProducts[i]})}}function vecInnerProductsCalcInnerProducts(e,t){var i=e.vectors[t];if(i){for(var r=0,n=0,o=i.length;n<o;++n){var s=i[n],a=s.name,d=s.value;if(this.dualVector[a]){var u=r;r+=this.dualVector[a]*d,0!==this.zeroRounding&&0!=r&&Math.abs(r/u)<this.zeroRounding&&(r=0)}}0!==r?this.innerProducts[t]=r:t in this.innerProducts&&delete this.innerProducts[t]}}function vecInnerProductsCalcDualInnerProducts(){this.innerProducts={};for(var e in this.vectorSet.vectors)this.calcInnerProducts(this.vectorSet,e)}function vecInnerProductsAddVectors(e,t,i,r){if(i in this.innerProducts&&0!=r){var n;if(t in this.innerProducts){var o=this.innerProducts[t];n=o+r*this.innerProducts[i],0!=this.zeroRounding&&0!=n&&Math.abs(n/o)<this.zeroRounding&&(n=0),n&&(this.innerProducts[t]=n)}else n=this.innerProducts[t]=r*this.innerProducts[i];n||delete this.innerProducts[t]}}function vecInnerProductsRemoveVector(e,t){delete this.innerProducts[t]}function vecInnerProductsSetToZero(e){delete this.innerProducts[e]}function vecInnerProductsMultiplyVector(e,t,i){i?t in this.innerProducts[t]&&(this.innerProducts[t]*=i):delete this.innerProducts[t]}function Resistance(e){this.posEquations=e,this.equations=e.equations.combinationSet,this.boundVars=e.boundVars,this.boundVarsByEq=e.boundVarsByEq,this.innerProducts=e.innerProducts,this.segmentConstraints=e.segmentConstraints,this.solution=e.solution,this.orGroups=e.posCalc.orGroups,this.variables={},this.needRecalc={},this.totalResistance={},this.totalResistanceNum=0,this.resistingBoundVars={},this.pendingRecalcTotal={},this.freeRequireOrGroupResistance={},this.numFreeRequireOrGroupResistance=0,this.freeRequiredByModule={},this.tightFreeVariablesCalculated={},this.tightVariables={},this.tightGroups={},this.violatedOrGroupVars={},this.pendingRecalcTightOrGroups={},this.needRecalcForViolatedOrGroups={},this.needRecalcTotalForViolatedOrGroups={},this.needRecalcViolatedOrGroupResistance={},this.resistanceChanged={},this.satOrGroupResistanceChanged={},this.tightOrGroupChanged={},this.violationChanged={},this.totalResistanceChanged={},this.dirs={down:!0,up:!0},this.opDirs={down:"up",up:"down"},this.sameDirs={down:"down",up:"up"}}function resistanceRefreshEntry(e){this.variables[e]||(this.variables[e]={});var t=this.variables[e];t.min=this.segmentConstraints.getMin(e),t.max=this.segmentConstraints.getMax(e);var i=this.segmentConstraints.getStability(e);return i!=-(1/0)?t.stabilityResistance=i:delete t.stabilityResistance,t.resistance={},t.withoutViolatedOrGroups={},t.violationPriority=-(1/0),t}function resistanceCalcResistance(e,t){if(!this.posEquations.hasVariable(e))return!1;var i=this.variables[e];i||(i=this.refreshEntry(e));var r=i.resistance,n=i.withoutViolatedOrGroups,o=i.violationPriority,s=i.violationTarget;i.resistance={up:-(1/0),down:-(1/0)},delete i.violation,delete i.violationTarget,i.violationPriority=-(1/0),i.withoutViolatedOrGroups={},this.calcMinOrMaxResistance(e,t,!0),this.calcMinOrMaxResistance(e,t,!1),this.calcStabilityResistance(e,t),this.segmentConstraints.variableHasOrGroups(e)&&(this.addSatisfiedOrGroupResistance(e),this.addAllOrGroupViolationResistance(e,t)),i.violationPriority==o&&i.violationTarget==s||(this.violationChanged[e]=!0);var a=r.up!=i.resistance.up||r.down!=i.resistance.down;return(a||n.up!=i.withoutViolatedOrGroups.up||n.down!=i.withoutViolatedOrGroups.down)&&this.refreshTotalAfterResistanceChange(e),a&&(this.resistanceChanged[e]=!0),a}function resistanceAddToResistance(e,t,i){var r=this.variables[e];if(r){var n=!1;i>=0&&r.withoutViolatedOrGroups.up<t&&(r.withoutViolatedOrGroups.up=t,n=!0,r.resistance.up<t&&(r.resistance.up=t,this.resistanceChanged[e]=!0)),i<=0&&r.withoutViolatedOrGroups.down<t&&(r.withoutViolatedOrGroups.down=t,n=!0,r.resistance.down<t&&(r.resistance.down=t,this.resistanceChanged[e]=!0)),n&&this.refreshTotalAfterResistanceChange(e)}}function resistanceCalcMinOrMaxResistance(e,t,i){var r=this.variables[e];if(r){var n=-(1/0);if(!(i&&r.min<t||!i&&r.max>t)){var o=this.segmentConstraints.priorityForValue(e,t,i);o&&(n=o.violatedPriority>o.priorityAtVal?o.violatedPriority:o.priorityAtVal,o.violatedPriority!=-(1/0)&&(r.violation=i?"min":"max",r.violationPriority=o.violatedPriority,r.violationTarget=o.violatedValue)),i?r.withoutViolatedOrGroups.down=r.resistance.down=n:r.withoutViolatedOrGroups.up=r.resistance.up=n}}}function resistanceCalcStabilityResistance(e,t){var i=this.variables[e];if(i){if(void 0!=i.stabilityResistance&&i.stabilityResistance>-(1/0)&&void 0!=i.stableValue){var r=i.stabilityResistance;t<i.stableValue||t>i.stableValue?(t>i.stableValue?(i.resistance.up=r,i.violation="max"):(i.resistance.down=r,i.violation="min"),i.violationPriority=r,i.violationTarget=i.stableValue):(i.resistance.up=r,i.resistance.down=r)}i.withoutViolatedOrGroups.up=i.resistance.up,i.withoutViolatedOrGroups.down=i.resistance.down}}function resistanceAddOrGroupViolationResistance(e,t,i,r){var n=this.getViolatedOrGroupVarsGroupEntry(e,i,!1);if(!n||void 0==n.target)return!1;var o=this.variables[e];if(!o)return!1;n.priority>o.violationPriority?(o.violation=t>n.target?"max":"min",o.violationPriority=n.priority,o.violationTarget=n.target,r&&(this.violationChanged[e]=!0)):n.priority==o.violationPriority&&Math.abs(n.target-t)>Math.abs(o.violationTarget-t)&&(o.violationTarget=n.target,r&&(this.violationChanged[e]=!0));var s=!1;return"max"==o.violation?n.boundVarOpt&&n.boundVarOpt.num.up||o.resistance.up<n.priority&&(o.resistance.up=n.priority,s=!0,this.addOwnResistanceToTotal(e,"up")):n.boundVarOpt&&n.boundVarOpt.num.down||o.resistance.down<n.priority&&(o.resistance.down=n.priority,s=!0,this.addOwnResistanceToTotal(e,"down")),s&&r&&(this.resistanceChanged[e]=!0),s}function resistanceAddAllOrGroupViolationResistance(e,t){var i=this.violatedOrGroupVars[e];if(!i)return!1;for(var r in i)this.addOrGroupViolationResistance(e,t,r)}function resistanceRecalcViolatedOrGroupResistance(e,t){var i=this.variables[e];if(!i)return void this.calcResistance(e,this.solution[e]);var r=i.violationPriority,n=i.violationTarget,o=i.resistance;i.resistance={},i.resistance.up=i.withoutViolatedOrGroups.up,i.resistance.down=i.withoutViolatedOrGroups.down,this.addAllOrGroupViolationResistance(e,t),i.resistance.up==o.up&&i.resistance.down==o.down||(this.resistanceChanged[e]=!0),i.violationPriority==r&&i.violationTarget==n||(this.violationChanged[e]=!0)}function resistanceAddSatisfiedOrGroupResistance(e){var t=this.variables[e];if(t){var i=this.tightVariables[e];if(i){for(var r in i){var n=i[r];if(n.varSatByGroup&&n.onlySatByGroup){var o=this.segmentConstraints.getOrGroupPriority(r);n.dir>=0&&o>t.withoutViolatedOrGroups.up&&(t.withoutViolatedOrGroups.up=o),n.dir<=0&&o>t.withoutViolatedOrGroups.down&&(t.withoutViolatedOrGroups.down=o)}}t.withoutViolatedOrGroups.up>t.resistance.up&&(t.resistance.up=t.withoutViolatedOrGroups.up),t.withoutViolatedOrGroups.down>t.resistance.down&&(t.resistance.down=t.withoutViolatedOrGroups.down),this.calcMultiVariableSatisfiedOrGroupResistance(e)}}}function resistanceCalcMultiVariableSatisfiedOrGroupResistance(e,t){var i=this.variables[e];if(i){var r=this.tightVariables[e];if(r||i.satOrGroupResistance){var n={up:-(1/0),down:-(1/0)};for(var o in r)if(o!=t){var s=r[o];if(s.varSatByGroup&&!s.onlySatByGroup){var a=this.segmentConstraints.getOrGroupPriority(o);s.dir>=0&&a>n.up&&(n.up=a),s.dir<=0&&a>n.down&&(n.down=a)}}n.up==-(1/0)&&n.down==-(1/0)?i.satOrGroupResistance&&(this.satOrGroupResistanceChanged[e]=!0,delete i.satOrGroupResistance):i.satOrGroupResistance&&i.satOrGroupResistance.up==n.up&&i.satOrGroupResistance.down==n.down||(this.satOrGroupResistanceChanged[e]=!0,i.satOrGroupResistance=n)}}}function resistanceRefreshAfterBoundVarRemoved(e){this.removeBoundVarTotalResistance(e,!0),this.orGroupResistanceRemoveBoundVar(e)}function resistanceRefreshAfterBoundVarAdded(e){this.refreshTotalAfterBoundVarChange(e,void 0,!0),this.orGroupResistanceAddBoundVar(e)}function resistanceRefreshAfterEquationChange(e){this.refreshTotalAfterEquationChange(e),this.orGroupResistanceAfterEquationChange(e)}function resistanceRefreshAfterBoundVarChange(e,t){this.refreshTotalAfterBoundVarChange(e,t,!0),this.orGroupResistanceAfterBoundVarChange(e,t)}function resistanceCalcPendingResistance(){for(var e in this.needRecalcViolatedOrGroupResistance)this.posEquations.hasVariable(e)&&(this.needRecalc[e]||this.recalcViolatedOrGroupResistance(e,this.solution[e]));for(var e in this.needRecalc)this.calcResistance(e,this.solution[e]);this.needRecalcViolatedOrGroupResistance={},this.needRecalc={}}function resistanceCalcAllPending(){this.processOrGroupChanges(),this.calcPendingResistanceFromViolatedOrGroups(),this.calcPendingTotalResistanceFromViolatedOrGroups(),this.calcPendingTightOrGroups(),this.calcPendingResistance(),this.calcTotalOfAllPending()}function resistanceSetStableValue(e){var t=this.variables[e],i=this.solution[e];if(!t||void 0==i)return!1;if(t.stableValue==i)return!1;t.stableValue=i;var r=t.stabilityResistance;return void 0!=r&&r!=-(1/0)&&(this.calcResistance(e,i),!0)}function resistanceGetStableValue(e){if(this.variables[e])return this.variables[e].stableValue}function resistanceRemove(e){delete this.variables[e],delete this.needRecalc[e],delete this.pendingRecalcTotal[e],delete this.needRecalcViolatedOrGroupResistance[e]}function resistanceGetMaxResistance(e){var t=this.variables[e];if(t)return Math.max(t.resistance.up,t.resistance.down)}function resistanceGetMinResistance(e){var t=this.variables[e];if(t)return Math.min(t.resistance.up,t.resistance.down)}function resistanceGetUpResistance(e){var t=this.variables[e];if(t)return t.resistance.up}function resistanceGetDownResistance(e){var t=this.variables[e];if(t)return t.resistance.down}function resistanceGetResistance(e,t){var i=this.variables[e];return i?i.resistance[t]:-(1/0)}function resistanceGetSatOrGroupResistance(e,t){var i=this.variables[e];return i&&i.satOrGroupResistance?i.satOrGroupResistance[t]:-(1/0)}function resistanceGetResistanceWithSatOrGroups(e,t){var i=this.variables[e];return i?i.satOrGroupResistance&&i.satOrGroupResistance[t]>i.resistance[t]?i.satOrGroupResistance[t]:i.resistance[t]:-(1/0)}function resistanceViolationIsOrGroup(e){var t=this.variables[e];if(!t||!t.violation)return!1;var i="max"==t.violation?"up":"down";return t.withoutViolatedOrGroups[i]<t.resistance[i]}function resistanceViolatedBoundResistsFree(e,t,i){var r=this.variables[t];if(!r||!r.violation)return!1;var n="max"==r.violation?"up":"down";return r.withoutViolatedOrGroups[n]==r.resistance[n]||(this.addToRequireOrGroupResistance(e,i),!!this.violatedOrGroupsOfBoundResistFree(e,t)||this.satisfiedOrGroupsOfViolatedBoundResistFree(e,t))}function resistanceHasViolation(e){var t=this.variables[e];return!!t&&t.violationPriority>-(1/0)}function resistanceGetViolationPriority(e){var t=this.variables[e];return t?t.violationPriority:-(1/0)}function resistanceClearResistanceChanges(){this.resistanceChanged={},this.satOrGroupResistanceChanged={},this.tightOrGroupChanged={},this.violationChanged={},this.totalResistanceChanged={}}function resistanceGetTotalResistance(e,t){if(void 0==t)return this.totalResistance[e];if(void 0!=this.boundVars[e]){var i=this.variables[e];return{dir:t,resistance:i.resistance[t]}}if(this.totalResistance[e]){if(this.totalResistance[e].dir==t)return this.totalResistance[e];this.totalResistance[e]={dir:t,resistance:-(1/0)}}else this.totalResistance[e]={dir:t,resistance:-(1/0)},this.totalResistanceNum++,this.addToRequireOrGroupResistance(e,"total"),this.calcAllOrGroupsForFreeVar(e,!1);return this.calcTotalResistance(e,!1),this.totalResistance[e]}function resistanceRemoveTotalResistanceVariable(e){var t=this.totalResistance[e];t&&(void 0!=t.resistingVar&&this.clearFreeFromBound(t.resistingVar,e),delete this.totalResistance[e],this.totalResistanceNum--,this.removeFromRequireOrGroupResistance(e,"total"))}function resistanceRemoveAllTotalResistanceVariablesExcept(e){for(var t in this.totalResistance)e&&e[t]||this.removeTotalResistanceVariable(t)}function resistanceClearFreeFromBound(e,t){var i=this.resistingBoundVars[e];i&&(delete i[t],isEmptyObj(i)&&delete this.resistingBoundVars[e])}function resistanceAddFreeToBound(e,t){this.resistingBoundVars[e]||(this.resistingBoundVars[e]={}),this.resistingBoundVars[e][t]=!0}function resistanceAddToTotalResistance(e,t,i,r,n,o,s){var a=this.totalResistance[e];a&&(i==e&&(i=void 0),t>=a.resistance?((t>a.resistance||void 0==i||void 0!=a.resistingOrGroup&&void 0==r)&&this.setTotalResistingVarAndGroup(a,e,i,r,o),s&&t>a.resistance&&(this.totalResistanceChanged[e]=!0),a.resistance=t):!n&&(void 0!=r&&a.resistingOrGroup==r||void 0==r&&a.resistingVar==i)&&(this.pendingRecalcTotal[e]=!0))}function resistanceSetTotalResistingVarAndGroup(e,t,i,r,n){e.resistingOrGroup=r,e.resistingVar!=i&&(void 0!=e.resistingVar&&this.clearFreeFromBound(e.resistingVar,t),void 0==i?delete e.resistingVar:(e.resistingVar=i,n&&this.addFreeToBound(i,t)))}function resistanceAddOwnResistanceToTotal(e,t){var i=this.totalResistance[e];if(i&&i.dir==t){var r=this.variables[e];r&&this.addToTotalResistance(e,r.resistance[t],e,void 0,!0,!0,!0)}}function resistanceIncreaseTotalResistanceByBound(e,t,i,r,n){var o=this.totalResistance[e];if(o){var s=(r<0?this.opDirs:this.sameDirs)[o.dir],a=i.withoutViolatedOrGroups[s];this.addToTotalResistance(e,a,t,void 0,!0,n,!0)}}function resistanceCalcTotalResistance(e,t){var i=this.totalResistance[e];if(i){if(t)return void(this.pendingRecalcTotal[e]=!0);delete this.pendingRecalcTotal[e];var r=this.variables[e];if(r){var n=i.resistance;if(i.resistance=r.resistance[i.dir],void 0!=i.resistingVar&&(this.clearFreeFromBound(i.resistingVar,e),delete i.resistingVar),delete i.withoutOwnSatOrGroups,void 0!=this.boundVars[e])return void(n!=i.resistance&&(this.totalResistanceChanged[e]=!0));var o=this.equations.componentIndex.get(e),s=this;o.forEach(function(t,i){if(!(i in s.innerProducts)){var r=s.boundVarsByEq[i];if(void 0!=r){var n=s.variables[r];if(n){var o=t.value,a=s.equations.getValue(i,r);s.increaseTotalResistanceByBound(e,r,n,-o*a,!1)}}}}),this.addOrGroupTotalResistance(e,!1),void 0!=i.resistingVar&&this.addFreeToBound(i.resistingVar,e),n!=i.resistance&&(this.totalResistanceChanged[e]=!0)}}}function resistanceAddOrGroupTotalResistance(e,t){this.addViolatedOrGroupTotalResistance(e,t,!1),this.addSatisfiedOrGroupTotalResistance(e,t)}function resistanceAddSatisfiedOrGroupTotalResistance(e,t){if(this.tightVariables[e]){var i=this.totalResistance[e];if(i)for(var r in this.tightVariables[e]){var n=this.tightVariables[e][r];if(!n.varSatByGroup&&("up"==i.dir&&n.dir>=0||"down"==i.dir&&n.dir<=0)){var o=this.segmentConstraints.getOrGroupPriority(r);this.addToTotalResistance(e,o,n.representative,r,!0,t,!0)}}}}function resistanceAddViolatedOrGroupTotalResistance(e,t,i){var r=this.violatedOrGroupVars[e];if(r)for(var n in r)this.addSingleViolatedOrGroupTotalResistance(e,n,t,i)}function resistanceAddSingleViolatedOrGroupTotalResistance(e,t,i,r){var n=this.getViolatedOrGroupVarsGroupEntry(e,t);if(n){var o=this.totalResistance[e];if(o&&void 0===n.target){var s=n.boundVarOpt;if(s&&0==s.num[o.dir]&&s.num[this.opDirs[o.dir]]>0){var a=objFirstProp(s[this.opDirs[o.dir]]);this.addToTotalResistance(e,n.priority,a,t,!0,i,r)}}}}function resistanceCalcTotalOfAllPending(){for(var e in this.pendingRecalcTotal)this.calcTotalResistance(e,!1);this.pendingRecalcTotal={}}function resistanceRemoveBoundVarTotalResistance(e,t){if(void 0!=e){var i=this.resistingBoundVars[e];if(i){for(var r in i)this.calcTotalResistance(r,t);delete this.resistingBoundVars[e]}}}function resistanceRefreshTotalAfterBoundVarChange(e,t,i){if(this.totalResistanceNum){var r=this.variables[e],n=this.boundVars[e];if(void 0!=n){if(r.withoutViolatedOrGroups.up==-(1/0)&&r.withoutViolatedOrGroups.down==-(1/0)||this.innerProducts[n])return void(void 0!=t&&this.removeBoundVarTotalResistance(t,i));for(var o=this.equations.vectors[n],s=this.equations.getValue(n,e),a=0,d=o.length;a<d;++a){var u=o[a],h=u.name;h!=e&&h in this.totalResistance&&this.increaseTotalResistanceByBound(h,e,r,-u.value*s,!0)}void 0!=t&&this.removeBoundVarTotalResistance(t,i)}}}function resistanceRefreshTotalAfterEquationChange(e,t){if(this.totalResistanceNum){var i=this.boundVarsByEq[e];if(void 0!=i){if(!this.equations.getValue(e,i)||this.innerProducts[e])return void this.removeBoundVarTotalResistance(i,t);for(var r in this.resistingBoundVars[i])this.equations.getValue(e,r)||(this.calcTotalResistance(r,t),this.clearFreeFromBound(i,r));this.refreshTotalAfterBoundResistanceChange(i,t)}}}function resistanceRefreshTotalAfterBoundResistanceChange(e,t){if(this.totalResistanceNum){var i=this.boundVars[e];if(void 0!=i){if(this.innerProducts[i])return void this.removeBoundVarTotalResistance(e,t);var r=this.variables[e];if(r)for(var n=this.equations.vectors[i],o=this.equations.getValue(i,e),s=0,a=n.length;s<a;++s){var d=n[s],u=d.name;if(u!=e&&u in this.totalResistance){var h=this.totalResistance[u],l=d.value*o>0?this.opDirs[h.dir]:h.dir;this.addToTotalResistance(u,r.withoutViolatedOrGroups[l],e,void 0,!1,!0,!0)}}}}}function resistanceRefreshTotalAfterResistanceChange(e){if(this.totalResistanceNum){var t=this.variables[e];if(t&&void 0!=t.resistance.up){var i=this.totalResistance[e];i&&this.addToTotalResistance(e,t.resistance[i.dir],e,void 0,!1,!0,!0),void 0!=this.boundVars[e]&&this.refreshTotalAfterBoundResistanceChange(e,!0)}}}function resistanceProcessOrGroupChanges(){for(var e in this.orGroups.changes){var t=this.orGroups.changes[e],i=this.orGroups.getGroupStatus(e);t.status&&t.status!=i?this.applyOrGroupStatusChange(e,t.status,i):(this.tightGroups[e]&&(this.tightOrGroupChanged[e]=!0),"satisfied"==this.orGroups.getGroupStatus(e)?this.processSatisfiedOrGroupChanges(e):this.processViolatedOrGroupChanges(e))}this.orGroups.clearChanges()}function resistanceApplyOrGroupStatusChange(e,t,i){if(t!=i){this.orGroups.changes[e];"satisfied"==t?this.removeSatisfiedOrGroupResistance(e):"violated"==t&&this.removeViolatedOrGroupResistance(e),"satisfied"==i?this.calcSatisfiedResistanceOfOrGroup(e,!0):"violated"==i&&this.addViolatedOrGroupResisance(e)}}function resistanceOrGroupResistanceAfterBoundVarChange(e,t){this.satisfiedOrGroupResistanceAfterBoundVarChange(e,t),this.violatedOrGroupResistanceAfterBoundVarChange(e,t)}function resistanceOrGroupResistanceAfterEquationChange(e){this.satisfiedOrGroupResistanceAfterEquationChange(e),this.violatedOrGroupResistanceAfterEquationChange(e)}function resistanceOrGroupResistanceAddBoundVar(e){this.satisfiedOrGroupResistanceAddBoundVar(e),this.violatedOrGroupResistanceAddBoundVar(e)}function resistanceOrGroupResistanceRemoveBoundVar(e){this.satisfiedOrGroupResistanceRemoveBoundVar(e),this.violatedOrGroupResistanceRemoveBoundVar(e)}function resistanceAddToRequireOrGroupResistance(e,t){if(void 0!=t){var i=this.freeRequireOrGroupResistance[e];i||(i=this.freeRequireOrGroupResistance[e]={},this.numFreeRequireOrGroupResistance++),i[t]=!0,this.freeRequiredByModule[t]||(this.freeRequiredByModule[t]={}),this.freeRequiredByModule[t][e]=!0}}function resistanceRemoveFromRequireOrGroupResistance(e,t){
if(void 0!=t){var i=this.freeRequireOrGroupResistance[e];i&&(this.freeRequiredByModule[t]&&(delete this.freeRequiredByModule[t][e],isEmptyObj(this.freeRequiredByModule[t])&&delete this.freeRequiredByModule[t]),delete i[t],isEmptyObj(i)&&(delete this.freeRequireOrGroupResistance[e],this.numFreeRequireOrGroupResistance--,delete this.tightFreeVariablesCalculated[e],this.violatedOrGroupsRemoveNonGroupFree(e),this.satisfiedOrGroupsRemoveFree(e)))}}function resistanceRemoveModuleFromFreeRequireOrGroup(e,t){var i=this.freeRequiredByModule[e];if(i){t||delete this.freeRequiredByModule[e];for(var r in i)t&&t[r]||this.removeFromRequireOrGroupResistance(r,e)}}function resistanceCalcAllOrGroupsForFreeVar(e,t){if(void 0==this.boundVars[e]){var i=this.equations.componentIndex.get(e),r={},n=this;i.forEach(function(e,t){if(!n.innerProducts[t]){var i=n.boundVarsByEq[t];if(void 0!=i)for(var o in n.segmentConstraints.getVariableOrGroups(i))r[o]=!0}});for(var o in r)if("violated"==this.orGroups.getGroupStatus(o))this.addVariableAndGroupToViolatedOrGroupVars(e,o);else{if(this.freeRequireOrGroupResistance[e]&&(this.freeRequireOrGroupResistance[e]===!0||this.freeRequireOrGroupResistance[e][o]))continue;this.checkAndSetTightOrGroupOnFreeVar(o,e,t)}this.freeRequireOrGroupResistance[e]&&(this.tightFreeVariablesCalculated[e]=!0)}}function resistanceSatisfiedOrGroupResistanceAfterBoundVarChange(e,t){if(this.satisfiedOrGroupResistanceRemoveBoundVar(t),void 0!=e&&!this.innerProducts[this.boundVars[e]]){var i=this.segmentConstraints.getVariableOrGroups(e);for(var r in i)this.calcSatisfiedResistanceOfOrGroup(r,!0)}}function resistanceSatisfiedOrGroupResistanceAfterEquationChange(e){var t=this.boundVarsByEq[e];if(void 0!=t){var i=this.segmentConstraints.getVariableOrGroups(t);if(i){var r=this.equations.getValue(e,t);if(this.innerProducts[e]||!r)return void this.satisfiedOrGroupResistanceRemoveBoundVar(t);var n=this.equations.vectors[e];for(var o in i){var s=this.tightGroups[o],a=this.orGroups.orGroups[o].satisfied,d=a[t];if(d&&"()"!=d){for(var u=0,h=n.length;u<h;++u){var l=n[u],c=l.name;c==t||s&&s[c]||!this.freeRequireOrGroupResistance[c]&&!this.orGroups.orGroupSatisfiedOnVariableOnly(o,c)||this.checkAndSetTightOrGroupOnFreeVar(o,c,!0)}for(var p in s){var f=this.equations.getValue(e,p);if(f){if("[]"!=d){var v=this.tightVariables[p],g=v[o].dir,m=-f*r;(g*m>=0&&")"==d[1]||g*m<=0&&"("==d[0])&&this.checkAndSetTightOrGroupOnFreeVar(o,p,!0)}}else this.setTightOrGroupOnVariable(o,p,!1,!1)}}}}}}function resistanceSatisfiedOrGroupResistanceAddBoundVar(e){var t=void 0==e?void 0:this.segmentConstraints.getVariableOrGroups(e);if(t)for(var i in t)this.calcSatisfiedResistanceOfOrGroup(i,!0)}function resistanceSatisfiedOrGroupResistanceRemoveBoundVar(e){if(void 0!=e){var t=void 0==e?void 0:this.segmentConstraints.getVariableOrGroups(e);if(t)for(var i in t)if(this.orGroups.isOrGroupSatisfiedOnVariable(i,e))for(var r in this.tightGroups[i])r!=e&&this.setTightOrGroupOnVariable(i,r,!1,!1)}}function resistanceAddSatOrGroupToVarRes(e,t){if(this.tightVariables[t]){var i=this.tightVariables[t][e];if(i){var r=this.segmentConstraints.getOrGroupPriority(e);if(i.varSatByGroup)i.onlySatByGroup?this.addToResistance(t,r,i.dir):this.calcMultiVariableSatisfiedOrGroupResistance(t);else{var n=this.totalResistance[t];n&&("up"==n.dir&&i.dir>=0||"down"==n.dir&&i.dir<=0)&&this.addToTotalResistance(t,r,i.representative,e,!0,!0,!0)}}}}function resistanceRemoveSatOrGroupFromVarRes(e,t,i,r){if(this.tightVariables[t]){var n=this.tightVariables[t][e];if(n)if(void 0==i&&(i=this.segmentConstraints.getOrGroupPriority(e)),n.varSatByGroup)if(n.onlySatByGroup){var o=this.variables[t];if(!o)return;(n.dir>=0&&o.resistance.up==i||n.dir<=0&&o.resistance.down==i)&&(this.needRecalc[t]=!0)}else r&&this.calcMultiVariableSatisfiedOrGroupResistance(t,e);else{var s=this.totalResistance[t];s&&("up"==s.dir&&n.dir>=0||"down"==s.dir&&n.dir<=0)&&this.addToTotalResistance(t,-(1/0),n.representative,e,!1,!0,!0)}}}function resistanceRefreshAfterSatisfiedOrGroupPriorityChange(e,t,i){if(t!=i){var r=this.tightGroups[e];for(var n in r)t>i&&this.removeSatOrGroupFromVarRes(e,n,t,!1),this.addSatOrGroupToVarRes(e,n)}}function resistanceCalcPendingTightOrGroups(){for(var e in this.pendingRecalcTightOrGroups)if("object"==typeof this.pendingRecalcTightOrGroups[e])for(var t in this.pendingRecalcTightOrGroups[e])this.checkAndSetTightOrGroupOnFreeVar(e,t);else this.calcSatisfiedResistanceOfOrGroup(e,!1);this.pendingRecalcTightOrGroups={}}function resistanceRemoveSatisfiedOrGroupResistance(e){var t=this.tightGroups[e];if(t){for(var i in t){var r=this.tightVariables[i];this.removeSatOrGroupFromVarRes(e,i,void 0,!0),delete r[e],isEmptyObj(r)&&delete this.tightVariables[i]}delete this.tightGroups[e]}}function resistanceCalcSatisfiedResistanceOfOrGroup(e,t){if(t)return void(this.pendingRecalcTightOrGroups[e]=!0);this.removeSatisfiedOrGroupResistance(e);var i=this.orGroups.orGroups[e];if(i&&0!=i.numSatisfied){var r=this.satisfiedOrGroupMayBeTight(e);if(r){if(1==i.numSatisfied){var n=objFirstProp(i.satisfied),o=i.satisfied[n];this.setTightOrGroupOnVariable(e,n,"["==o[0],"]"==o[1])}if(r!==!0)return void(i.numSatisfied>1&&this.checkAndSetTightOrGroupOnFreeVar(e,r,!1));var s={},a=!0;for(var d in i.satisfied){var u=this.boundVars[d],h=this.equations.getValue(u,d),o=i.satisfied[d],l="("==o[0]?1:")"==o[1]?-1:0;if(l*=h,a){for(var c=this.equations.vectors[u],p=0,f=c.length;p<f;++p){var v=c[p],g=v.name;g!=d&&this.freeRequireOrGroupResistance[g]&&(s[g]=-v.value*l)}a=!1}else for(var g in s){var m=this.equations.getValue(u,g);(!m||-m*l*s[g]<0)&&delete s[g]}}for(var g in s)this.setTightOrGroupOnVariable(e,g,s[g]<=0,s[g]>=0)}}}function resistanceSatisfiedOrGroupMayBeTight(e){var t=this.orGroups.orGroups[e];if(!t||!t.numSatisfied)return!1;var i,r=0;for(var n in t.satisfied){if(!this.posEquations.hasVariable(n))return!1;if("()"==t.satisfied[n])return!1;if(this.boundVars[n]){if(this.innerProducts[this.boundVars[n]])return!(t.numSatisfied>1)&&n}else{if(++r>1)return!1;i=n}}return!r||i}function resistanceSetTightOrGroupOnVariable(e,t,i,r){if(!i&&!r)return void this.removeTightOrGroupFromVariable(e,t);var n=this.tightVariables[t],o=this.tightGroups[e];o||(o=this.tightGroups[e]={}),o[t]=!0,n||(n=this.tightVariables[t]={});var s=n[e],a={};a.dir=(i?-1:0)+(r?1:0),a.varSatByGroup=!!this.orGroups.orGroups[e].satisfied[t],a.onlySatByGroup=!!this.orGroups.orGroupSatisfiedOnVariableOnly(e,t),a.onlySatByGroup||(s&&void 0!=s.representative&&this.orGroups.isOrGroupSatisfiedOnVariable(e,s.representative)?a.representative=s.representative:a.representative=this.orGroups.getFirstSatisfiedVariable(e,a.varSatByGroup?t:void 0)),s&&a.dir==s.dir&&a.varSatByGroup==s.varSatByGroup&&a.onlySatByGroup==s.onlySatByGroup&&a.representative==s.representative||(this.removeSatOrGroupFromVarRes(e,t,void 0,!0),n[e]=a,this.addSatOrGroupToVarRes(e,t))}function resistanceRemoveTightOrGroupFromVariable(e,t){var i=this.tightVariables[t];if(i){e in i&&(this.removeSatOrGroupFromVarRes(e,t,void 0,!0),delete i[e],isEmptyObj(i)&&delete this.tightVariables[t]);var r=this.tightGroups[e];r&&r[t]&&(delete r[t],isEmptyObj(r)&&delete this.tightGroups[e])}}function resistanceSatisfiedOrGroupsRemoveFree(e){if(!this.freeRequireOrGroupResistance[e]){var t=this.tightVariables[e];if(t){for(var i in t)if(!t[i].onlySatByGroup){delete t[i];var r=this.tightGroups[i];r&&r[e]&&(delete r[e],isEmptyObj(r)&&delete this.tightGroups[i])}isEmptyObj(t)&&delete this.tightVariables[e],this.calcMultiVariableSatisfiedOrGroupResistance(e)}}}function resistanceGetTightOrGroupOnFreeVar(e,t){if(void 0==this.boundVars[t]){var i=!0;return this.freeRequireOrGroupResistance[t]&&(this.tightFreeVariablesCalculated[t]||(this.tightFreeVariablesCalculated[t]={}),this.tightFreeVariablesCalculated[t]===!0||this.tightFreeVariablesCalculated[t][e]?i=!1:this.tightFreeVariablesCalculated[t][e]=!0),i&&this.checkAndSetTightOrGroupOnFreeVar(e,t,!1),this.tightVariables[t]?this.tightVariables[t][e]:void 0}}function resistanceCheckAndSetTightOrGroupOnFreeVar(e,t,i){if(i){if(this.pendingRecalcTightOrGroups[e]){if("boolean"==typeof this.pendingRecalcTightOrGroups[e])return}else this.pendingRecalcTightOrGroups[e]={};return void(this.pendingRecalcTightOrGroups[e][t]=!0)}var r=this.checkTightOrGroupOnFreeVar(e,t);this.setTightOrGroupOnVariable(e,t,"["==r[0],"]"==r[1])}function resistanceCheckTightOrGroupOnFreeVar(e,t){var i=this.orGroups.orGroups[e];if(!i||!i.numSatisfied)return"()";var r=i.satisfied[t];if("()"==r)return"()";if(r){if(1==i.numSatisfied)return r}else r="[]";for(var n in i.satisfied)if(n!=t){var o=this.boundVars[n];if(!o||this.innerProducts[o])return"()";var s=this.equations.getValue(o,t);if(!s)return"()";var a=i.satisfied[n],d=this.equations.getValue(o,n);if(s*d>0?("("==a[0]&&(r=r[0]+")"),")"==a[1]&&(r="("+r[1])):("("==a[0]&&(r="("+r[1]),")"==a[1]&&(r=r[0]+")")),"()"==r)return"()"}return r}function resistanceSatisfiedOrGroupsOfViolatedBoundResistFree(e,t){var i=this.boundVars[t];if(void 0==i)return!1;var r=this.variables[t];if(!r||!r.violation)return!1;var n=-this.equations.getValue(i,e)*this.equations.getValue(i,t)*("max"==r.violation?1:-1),o=this.segmentConstraints.getVariableOrGroups(t);for(var s in o)if(this.orGroups.isOrGroupSatisfiedOnVariable(s,t)){var a=this.getTightOrGroupOnFreeVar(s,e);if(a&&!(a.dir*n<0)&&this.segmentConstraints.getOrGroupPriority(s)>=r.violationPriority)return!0}return!1}function resistanceProcessSatisfiedOrGroupChanges(e){if(!this.recalcAfterSatisfiedOrGroupChanges(e)){var t=this.orGroups.changes[e],i=this.orGroups.orGroups[e],r=this.tightGroups[e];if("priority"in t){var n=this.segmentConstraints.getOrGroupPriority(e);n!=t.priority&&this.refreshAfterSatisfiedOrGroupPriorityChange(e,t.priority,n)}for(var o in r){var s=this.tightVariables[o][e];for(var a in t.variables){var d=i.satisfied[a];if(d){var u=this.boundVars[a],h=this.equations.getValue(u,o);if(!h){this.setTightOrGroupOnVariable(e,o,!1,!1),s=void 0;break}if("[]"!=d){var l=("(]"==d?1:-1)*(h*this.equations.getValue(u,a)>0?-1:1);if(s.dir){if(s.dir*l<0){this.removeSatOrGroupFromVarRes(e,o,void 0,!0),delete this.tightVariables[o][e],isEmptyObj(this.tightVariables[o])&&delete this.tightVariables[o],delete r[o],s=void 0;break}}else s.dir=l}}}if(s){var c=!!this.orGroups.orGroupSatisfiedOnVariableOnly(e,o);c!=s.onlySatByGroup&&(this.removeSatOrGroupFromVarRes(e,o,void 0,!0),s.onlySatByGroup=c,this.addSatOrGroupToVarRes(e,o))}}isEmptyObj(r)&&delete this.tightGroups[e]}}function resistancerecalcAfterSatisfiedOrGroupChanges(e){var t=this.orGroups.changes[e],i=this.orGroups.orGroups[e];if(!t)return!0;var r=0;for(var n in t.variables){if(i.satisfied[n]){if("()"==i.satisfied[n]||!this.posEquations.hasVariable(n))return this.removeSatisfiedOrGroupResistance(e),!0;if(!this.boundVars[n]||this.innerProducts[this.boundVars[n]])return this.removeSatisfiedOrGroupResistance(e),this.checkAndSetTightOrGroupOnFreeVar(e,n,!0),!0;r++}if("string"==typeof t.variables[n]&&("[]"!=t.variables[n]||"(]"!=i.satisfied[n]&&"[)"!=i.satisfied[n]))return this.calcSatisfiedResistanceOfOrGroup(e,!0),!0}return!r}function resistanceGetResistingEqsOfSatOrGroupsForVar(e){if(void 0==this.boundVars[e]){var t=this.tightVariables[e];if(t){var i;for(var r in t){var n=t[r];if(n.varSatByGroup&&!n.onlySatByGroup)for(var o in this.orGroups.getSatisfiedVariables(r))if(o!=e){var s=this.boundVars[o];i||(i={}),i[s]=!0}}return i}}}function resistanceViolatedOrGroupResistanceAfterBoundVarChange(e,t){void 0!=t&&this.violatedOrGroupResistanceRemoveBoundVar(t),void 0==e||this.innerProducts[this.boundVars[e]]||this.violatedOrGroupResistanceAddBoundVar(e)}function resistanceViolatedOrGroupResistanceAfterEquationChange(e){var t=this.boundVarsByEq[e];if(void 0!=t){var i=this.violatedOrGroupVars[t];if(i){if(this.innerProducts[e]||!this.equations.getValue(e,t))return void this.violatedOrGroupResistanceRemoveBoundVar(t);for(var r in i){var n=i[r];for(var o in n.freeVars)this.equations.getValue(e,o)||(this.removeBoundViolatedOrGroupVarFromFreeVar(t,o,r),delete n.freeVars[o]);this.addBoundViolatedOrGroupVarToFree(t,r,n.priority,n.target)}}}}function resistanceViolatedOrGroupResistanceAddBoundVar(e){var t=this.violatedOrGroupVars[e];if(t)for(var i in t){var r=t[i];if(void 0!=r.target)this.resetViolatedOrGroupVarsGroupEntry(e,i),this.addOrGroupViolationResistance(e,this.solution[e],i,!0),this.addBoundViolatedOrGroupVarToFree(e,i,r.priority,r.target);else if(delete t[i],isEmptyObj(t))return void delete this.violatedOrGroupVars[e]}}function resistanceViolatedOrGroupResistanceRemoveBoundVar(e){this.removeBoundViolatedOrGroupVarFromFree(e);var t=this.violatedOrGroupVars[e];if(t){for(var i in t)this.resetViolatedOrGroupVarsGroupEntry(e,i);this.needRecalcViolatedOrGroupResistance[e]=!0}}function resistanceRemoveViolatedOrGroupResistance(e){var t=this.orGroups.changes[e]?this.orGroups.changes[e].variables:void 0;if(t)for(var i in t)void 0!=t[i]&&this.removeViolatedOrGroupResistanceFromVariable(e,i);var r=this.orGroups.orGroups[e];if(r&&r.violated)for(var i in r.violated)t&&i in t||this.removeViolatedOrGroupResistanceFromVariable(e,i)}function resistanceRemoveViolatedOrGroupResistanceFromVariable(e,t){var i=this.getViolatedOrGroupVarsGroupEntry(t,e);i&&(void 0!=i.target&&(delete i.target,this.queueRecalcForViolatedOrGroups(t,e,i.priority),this.queueRecalcTotalForViolatedOrGroups(t,e,i.priority)),this.removeBoundViolatedOrGroupVarFromFree(t,e),i.boundVarOpt&&(i.boundVarOpt.num.up||i.boundVarOpt.num.down)||(delete this.violatedOrGroupVars[t][e],isEmptyObj(this.violatedOrGroupVars[t])&&delete this.violatedOrGroupVars[t]))}function resistanceRemoveBoundViolatedOrGroupVarFromFree(e,t){var i=this.violatedOrGroupVars[e];if(i){var r=void 0==t?i:{};void 0!=t&&(r[t]=!0);for(var n in r){var o=i[n];if(o){for(var s in o.freeVars)this.removeBoundViolatedOrGroupVarFromFreeVar(e,s,n);o.freeVars={}}}}}function resistanceRemoveBoundViolatedOrGroupVarFromFreeVar(e,t,i){var r=this.getViolatedOrGroupVarsGroupEntry(t,i);if(r&&r.boundVarOpt){for(var n in this.dirs)r.boundVarOpt[n][e]&&(delete r.boundVarOpt[n][e],r.boundVarOpt.num[n]--,r.boundVarOpt.num[n]||(void 0!=r.target?this.queueRecalcForViolatedOrGroups(t,i,r.priority):this.queueRecalcTotalForViolatedOrGroups(t,i,r.priority)));void 0!=r.target||r.boundVarOpt.num.up||r.boundVarOpt.num.down||delete this.violatedOrGroupVars[t][i],isEmptyObj(this.violatedOrGroupVars[t])&&delete this.violatedOrGroupVars[t]}}function resistanceViolatedOrGroupsRemoveNonGroupFree(e){if(!this.freeRequireOrGroupResistance[e]){var t=this.violatedOrGroupVars[e];if(t){for(var i in t)void 0===t[i].target&&delete t[i];isEmptyObj(t)&&delete this.violatedOrGroupVars[e]}}}function resistanceAddViolatedOrGroupResisance(e){var t=this.orGroups.orGroups[e];if(t&&!(t.numSatisfied>0))for(var i in t.violated)this.addViolatedOrGroupResistanceToVariable(e,i)}function resistanceAddViolatedOrGroupResistanceToVariable(e,t){var i=this.orGroups.orGroups[e];if(i&&i.violated){var r=i.violated[t],n=this.segmentConstraints.getOrGroupPriority(e);if(void 0!=r&&n!=-(1/0)){var o=this.getViolatedOrGroupVarsGroupEntry(t,e,!0);o.target==r&&o.priority==n||(this.queueRecalcForViolatedOrGroups(t,e,o.priority),void 0==r&&this.queueRecalcTotalForViolatedOrGroups(t,e,o.priority),o.target=r,o.priority=n,this.addBoundViolatedOrGroupVarToFree(t,e,n,r))}}}function resistanceAddBoundViolatedOrGroupVarToFree(e,t,i,r){var n=this.getViolatedOrGroupVarsGroupEntry(e,t);if(n){var o=this.boundVars[e];if(void 0!=o&&!this.innerProducts[o])for(var s=r>this.solution[e]?1:-1,a=this.equations.getValue(o,e),d=this.equations.vectors[o],u=0,h=d.length;u<h;++u){var l=d[u],c=l.name;if(c!=e&&(this.violatedOrGroupVars[c]||this.freeRequireOrGroupResistance[c])){var p=this.getViolatedOrGroupVarsGroupEntry(c,t,!0);n.freeVars||(n.freeVars={}),n.freeVars[c]=l.value>0?1:-1;var f=p.priority,v=f!=i;p.priority=i,p.boundVarOpt||this.resetViolatedOrGroupVarsGroupEntry(c,t);var g=l.value*a*s>0?"down":"up",m=this.opDirs[g];p.boundVarOpt[m][e]&&(delete p.boundVarOpt[m][e],p.boundVarOpt.num[m]--,p.boundVarOpt.num[m]||(v=!0)),p.boundVarOpt[g][e]||(p.boundVarOpt[g][e]=!0,p.boundVarOpt.num[g]++,1==p.boundVarOpt.num[g]&&(v=!0)),v&&(void 0!=p.target?this.queueRecalcForViolatedOrGroups(c,t,f):this.queueRecalcTotalForViolatedOrGroups(c,t,f))}}}}function resistanceAddVariableAndGroupToViolatedOrGroupVars(e,t){var i=this.orGroups.orGroups[t];if(i&&!(i.numSatisfied>0)){if(this.violatedOrGroupVars[e]&&this.violatedOrGroupVars[e][t])return this.violatedOrGroupVars[e][t];var r=void 0,n=this.segmentConstraints.getOrGroupPriority(t);if(i.violated[e]&&(r=this.getViolatedOrGroupVarsGroupEntry(e,t,!0),r.priority=n,r.target=i.violated[e]),void 0!=this.boundVars[e])return r;var o=this.equations.componentIndex.get(e),s=this;return o.forEach(function(o,a){if(!s.innerProducts[a]){var d=s.boundVarsByEq[a];if(d&&void 0!=i.violated[d]){r||(r=s.getViolatedOrGroupVarsGroupEntry(e,t,!0),r.priority=n);var u=o.value,h=s.equations.getValue(a,d),l=s.getViolatedOrGroupVarsGroupEntry(d,t,!0);l.freeVars||(l.freeVars={}),l.freeVars[e]=u>0?1:-1,l.priority=n;var c=l.target=i.violated[d],p=c>s.solution[d]?1:-1,f=u*h*p>0?"down":"up";r.boundVarOpt||s.resetViolatedOrGroupVarsGroupEntry(e,t),r.boundVarOpt[f][d]=!0,r.boundVarOpt.num[f]++}}}),r}}function resistanceGetViolatedOrGroupVarsGroupEntry(e,t,i){if(!this.violatedOrGroupVars[e]){if(!i)return;this.violatedOrGroupVars[e]={}}if(!this.violatedOrGroupVars[e][t]){if(!i)return;this.violatedOrGroupVars[e][t]={priority:-(1/0)},this.resetViolatedOrGroupVarsGroupEntry(e,t)}return this.violatedOrGroupVars[e][t]}function resistanceResetViolatedOrGroupVarsGroupEntry(e,t,i){if(this.violatedOrGroupVars[e]){var r=this.violatedOrGroupVars[e][t];r&&(this.boundVars[e]?(delete r.boundVarOpt,r.freeVars&&!i||(r.freeVars={})):(delete r.freeVars,r.boundVarOpt&&!i||(r.boundVarOpt={up:{},down:{},num:{up:0,down:0}})))}}function resistanceViolatedOrGroupsOfBoundResistFree(e,t){var i=this.violatedOrGroupVars[t],r=-(1/0),n=-(1/0);for(var o in i){var s=this.addVariableAndGroupToViolatedOrGroupVars(e,o);if(!s)return!1;var a=i[o].priority;if(!(a<=n)){if(a<r&&(r=a),!s.boundVarOpt)return!1;(!s.boundVarOpt.num.up&&s.boundVarOpt.num.down>0&&s.boundVarOpt.down[t]||!s.boundVarOpt.num.down&&s.boundVarOpt.num.up>0&&s.boundVarOpt.up[t])&&(n=a)}}return r>-(1/0)&&r==n}function resistanceQueueRecalcForViolatedOrGroups(e,t,i){this.needRecalcForViolatedOrGroups[e]||(this.needRecalcForViolatedOrGroups[e]={}),t in this.needRecalcForViolatedOrGroups[e]||(this.needRecalcForViolatedOrGroups[e][t]=i)}function resistanceQueueRecalcTotalForViolatedOrGroups(e,t,i){this.needRecalcTotalForViolatedOrGroups[e]||(this.needRecalcTotalForViolatedOrGroups[e]={}),t in this.needRecalcTotalForViolatedOrGroups[e]||(this.needRecalcTotalForViolatedOrGroups[e][t]=i)}function resistanceCalcPendingResistanceFromViolatedOrGroups(){for(var e in this.needRecalcForViolatedOrGroups)if(!this.needRecalc[e])for(var t in this.needRecalcForViolatedOrGroups[e]){var i=this.needRecalcForViolatedOrGroups[e][t],r=this.getViolatedOrGroupVarsGroupEntry(e,t,!0),n=this.variables[e];if(!n){this.needRecalc[e]=!0;break}var o=n.resistance.up>n.withoutViolatedOrGroups.up&&n.resistance.up==i||n.resistance.down>n.withoutViolatedOrGroups.down&&n.resistance.down==i;if(o&&r.boundVarOpt&&r.boundVarOpt.num.up>0&&r.boundVarOpt.num.down>0){this.needRecalc[e]=!0;break}if(r&&void 0!=r.target&&r.priority>=i){if(r.priority==i){this.needRecalc[e]=!0;break}o&&r.boundVarOpt&&r.boundVarOpt.num.up>0&&r.boundVarOpt.num.down>0?this.needRecalcViolatedOrGroupResistance[e]=!0:this.addOrGroupViolationResistance(e,this.solution[e],t,!0)}else{if(n.violationPriority==i){this.needRecalc[e]=!0;break}o&&(this.needRecalcViolatedOrGroupResistance[e]=!0)}}this.needRecalcForViolatedOrGroups={}}function resistanceCalcPendingTotalResistanceFromViolatedOrGroups(){for(var e in this.needRecalcTotalForViolatedOrGroups)if(!this.pendingRecalcTotal[e]){var t=this.totalResistance[e];if(t)for(var i in this.needRecalcTotalForViolatedOrGroups[e]){var r=this.getViolatedOrGroupVarsGroupEntry(e,i),n=-(1/0),o=void 0;if(r){var s=r.boundVarOpt;s&&(s.num.up||s.num.down)&&0==s.num[t.dir]&&(n=r.priority,o=objFirstProp(s[this.opDirs[t.dir]]))}this.addToTotalResistance(e,n,o,i,!1,!0,!0)}}this.needRecalcTotalForViolatedOrGroups={}}function resistanceProcessViolatedOrGroupChanges(e){var t=this.orGroups.changes[e];if(t){var i=this.orGroups.orGroups[e];if(i&&!(i.satisfied>0)){var r="priority"in t?this.segmentConstraints.getOrGroupPriority(e)-t.priority:0;for(var n in t.variables){var o=t.variables[n],s=i.violated[n];s!=o&&(void 0==s?this.removeViolatedOrGroupResistanceFromVariable(e,n):r||this.addViolatedOrGroupResistanceToVariable(e,n))}if(r)for(var n in i.violated)r<0&&this.removeViolatedOrGroupResistanceFromVariable(e,n),this.addViolatedOrGroupResistanceToVariable(e,n)}}}function PosEquations(e){this.posCalc=e,this.zeroRounding=e.zeroRounding,this.segmentConstraints=e.segmentConstraints,this.normalizationThreshold=1e3,this.equations=new CombinationVectors(this.zeroRounding,this.normalizationThreshold),this.equationVecs=this.equations.combinationSet.vectors,this.changedEquations={},this.solution={},this.solutionChanges={},this.innerProductObj=new VecInnerProducts(this.equations.combinationSet,this.solution,this.zeroRounding),this.innerProducts=this.innerProductObj.innerProducts,this.errorDerivatives={},this.variablesByResistance=new PairSortedList,this.satOrGroupVariables=void 0,this.boundVars={},this.boundVarsByEq={},this.needToRefreshBoundVar={},this.resistance=new Resistance(this),this.violatedVars=new SortedList,this.optimizationSuspension={blocked:{},selfBlocked:{},equations:{},nextSuspensionId:1},this.optimizationVar=void 0,this.optimizationDir=void 0,this.optimizationTarget=void 0,this.optimizationPriority=void 0,this.DebugTracing(1)}function posEquationsHasVariable(e){return this.equations.hasComponent(e)}function posEquationsTransferValue(e,t,i,r,n){this.equations.transferValue(e,t,i,r,n),t&&void 0!=this.boundVars[t]&&(this.needToRefreshBoundVar[this.boundVars[t]]=!0),r&&void 0!=this.boundVars[r]&&(this.needToRefreshBoundVar[this.boundVars[r]]=!0),this.recordModifiedBaseEq(e)}function posEquationsAddEquation(e){for(var t=0,i=e.length;t<i;){var r=e[t];if(0!=r.value){var n=r.name;n in this.boundVars&&(this.needToRefreshBoundVar[this.boundVars[n]]=!0),++t}else t<i-1&&(e[t]=e[i-1]),i=--e.length}var o=this.equations.newVector(e,!0);return this.needToRefreshBoundVar[o[1]]=!0,o[0]}function posEquationsSetEquation(e,t){for(var i=0,r=t.length;i<r;++i){var n=t[i].name;n in this.boundVars&&(this.needToRefreshBoundVar[this.boundVars[n]]=!0)}for(var o=this.equations.baseSet.vectors[e],i=0,r=o.length;i<r;++i){var n=o[i].name;n in this.boundVars&&(this.needToRefreshBoundVar[this.boundVars[n]]=!0)}this.equations.setVector(e,t),this.recordModifiedBaseEq(e)}function posEquationsRemoveEquation(e){this.removeOneCombinationVector(e);for(var t=this.equations.baseSet.vectors[e],i=0,r=t.length;i<r;++i){var n=t[i].name;n in this.boundVars&&(this.needToRefreshBoundVar[this.boundVars[n]]=!0)}this.equations.removeVector(e)}function posEquationsRemoveOneCombinationVector(e){var t,i=this.equations.combinations[e];for(var r in i)i[r]&&(this.changedEquations[r]=!0,void 0!==t?this.equations.addCombToCombVector(r,t,-i[r]/i[t]):t=r);var n=this.boundVarsByEq[t];void 0!=n&&(delete this.boundVars[n],delete this.boundVarsByEq[t],delete this.needToRefreshBoundVar[t],this.resistance.refreshAfterBoundVarRemoved(n));for(var o=this.equationVecs[t],s=0,a=o.length;s<a;++s){var d=o[s].name;d in this.boundVars&&(this.needToRefreshBoundVar[this.boundVars[d]]=!0)}this.equations.removeCombVector(t)}function posEquationsRecordModifiedBaseEq(e){for(var t in this.equations.combinations[e])this.changedEquations[t]=!0}function posEquationsPrepareAndSolve(){debugStartTimer("positioning","prepare to solve equations");var e=this.prepareToSolve();debugStopTimer("prepare to solve equations"),this.clearAllInputChanges(),e&&(debugStartTimer("positioning","find feasible solution"),this.findFeasibleSolution(),debugStopTimer("find feasible solution"),debugStartTimer("positioning","find optimal solution"),this.findOptimalSolution(),debugStopTimer("find optimal solution"),this.setResistanceForNextRound(),this.resistance.removeAllTotalResistanceVariablesExcept(),this.doDebugging&&(this.debugRecordStatistics(),this.debugBreakOnOptimizationSuspensionErrors()))}function posEquationsRemoveFromSolution(e){var t=this.solution[e];t&&this.innerProductObj.addDualToProducts(e,-t),void 0!=t&&delete this.solution[e],delete this.solutionChanges[e]}function posEquationsSetSolution(e,t){t&&t<this.zeroRounding&&-this.zeroRounding<t&&(t=0),t!=this.solution[e]&&(this.solutionChanges[e]=t);var i=this.solution[e];this.solution[e]=t,this.innerProductObj.addDualToProducts(e,i?t-i:t)}function posEquationsAddToSolution(e,t){var i=this.solution[e]?this.solution[e]+t:t;this.setSolution(e,i)}function posEquationsPrepareToSolve(){this.equations.repairCombinations(),debugStartTimer("positioning","initialize values");var e=this.initializeValues();return debugStopTimer("initialize values"),!(isEmptyObj(e)&&isEmptyObj(this.changedEquations)&&isEmptyObj(this.needToRefreshBoundVar))&&(this.debugNewSolutionCycle(e),this.doDebugging&&this.debugRecord("before initialization: ",["optimizationSuspension"]),debugStartTimer("positioning","initializing changed variable resistance"),this.initializeChangedVariableResistance(e),debugStopTimer("initializing changed variable resistance"),debugStartTimer("positioning","normalize equations"),this.normalizeEquations(),debugStopTimer("normalize equations"),debugStartTimer("positioning","initialize bound variables"),this.assignMissingBoundVariables(),debugStopTimer("initialize bound variables"),debugStartTimer("positioning","reduce error by bound variables"),this.reduceErrorByNoResistanceBoundVars(),debugStopTimer("reduce error by bound variables"),debugStartTimer("positioning","initialize error derivatives"),this.initializeErrorDerivatives(),debugStopTimer("initialize error derivatives"),debugStartTimer("positioning","complete resistance initialization"),this.completeResistanceInitialization(),debugStopTimer("complete resistance initialization"),debugStartTimer("positioning","initialize variables by resistance"),this.initializeVariablesByResistance(),debugStopTimer("initialize variables by resistance"),!0)}function posEquationsInitializeValues(){var e={},t=this.equations.getComponentChanges();for(var i in t)"removed"==t[i]?this.removeVariable(i):this.refreshSingleVariable(i,e);var r=this.segmentConstraints.changes;for(var i in r)e[i]||this.refreshSingleVariable(i,e);return e}function posEquationsRemoveVariable(e){this.removeFromSolution(e),this.removeFromViolationList(e),this.boundVars[e]&&(this.needToRefreshBoundVar[this.boundVars[e]]=!0,delete this.boundVarsByEq[this.boundVars[e]],delete this.boundVars[e],this.resistance.refreshAfterBoundVarRemoved(e)),this.resistance.remove(e)}function posEquationsRefreshSingleVariable(e,t){if(!t[e]&&this.equations.hasComponent(e)){var i=this.resistance.refreshEntry(e),r=this.posCalc.getLastValue(e),n=r?r:0;(n>i.max||n<i.min)&&(n=this.segmentConstraints.getPreferredValue(e,r)),this.setSolution(e,n),this.updateOrGroupSatisfaction(e,r),t[e]=void 0==r?"new":"old"}}function posEquationsInitializeChangedVariableResistance(e){for(var t in e)(t in this.posCalc.variables||"new"!=e[t])&&this.resistance.setStableValue(t)||this.resistance.calcResistance(t,this.solution[t])}function posEquationsCompleteResistanceInitialization(){for(var e in this.changedEquations)this.resistance.refreshAfterEquationChange(e);for(var e in this.innerProducts)e in this.changedEquations||this.resistance.refreshAfterBoundVarRemoved(this.boundVarsByEq[e],!0);this.calcAllPendingResistance(),this.updateViolationsAfterResistanceChanges(),this.updateOptimizationSuspensionOfChangedEquations(),this.changedEquations={},this.resistance.clearResistanceChanges()}function posEquationsNormalizeEquations(){if(this.normalizationThreshold){var e=this.normalizationThreshold/10;for(var t in this.equations.normalizationCandidates){var i=this.equations.calcNormalizationConstant(t),r=Math.abs(i);(r>e||r<1/e)&&(this.equations.normalize(t,i,!0),this.doDebugging&&this.debugMessage("normalizing equation ",t," by ",i))}this.equations.clearNormalizationCandidates()}}function posEquationsAssignMissingBoundVariables(){var e=[];for(var t in this.needToRefreshBoundVar){var i=this.boundVarsByEq[t];void 0!=i?0!==this.equations.getValue(t,i)?(this.eliminate(i,t,!0),this.doDebugging&&this.debugIncCounter("refreshed bound variable")):(delete this.boundVarsByEq[t],delete this.boundVars[i],this.resistance.refreshAfterBoundVarRemoved(i),e.push(t)):e.push(t)}for(var r=0,n=e.length;r<n;++r){var t=e[r];this.doDebugging&&this.debugIncCounter("missing bound variable");var o=this.findBoundVarCandidate(t);void 0!=o&&(this.boundVarsByEq[t]=o,this.boundVars[o]=t,this.eliminate(o,t,!0),this.innerProducts[t]||this.resistance.refreshAfterBoundVarAdded(o))}this.needToRefreshBoundVar={}}function posEquationsFindBoundVarCandidate(e){for(var t=this.equationVecs[e],i=[],r=this.innerProducts[e]>0?-1:this.innerProducts[e]<0?1:0,n=0,o=t.length;n<o;++n){var s,a=t[n],d=a.name,u=a.value;s=r?r*u>0?this.resistance.getUpResistance(d):this.resistance.getDownResistance(d):u>0?[this.resistance.getDownResistance(d),this.resistance.getUpResistance(d)]:[this.resistance.getUpResistance(d),this.resistance.getDownResistance(d)];for(var h=void 0,l=0,c=i.length;l<c;l++){if(r){s>i[l].resistance?h=!1:s<i[l].resistance&&(h=!0,i=[],c=0);break}if(!h&&s[0]>=i[l].resistance[0]&&s[1]>=i[l].resistance[1]&&(s[0]>i[l].resistance[0]||s[1]>i[l].resistance[1])){h=!1;break}s[0]<=i[l].resistance[0]&&s[1]<=i[l].resistance[1]&&(s[0]<i[l].resistance[0]||s[1]<i[l].resistance[1])&&(c--,l<c&&(i[l]=i[c],l--),h=!0)}h||void 0===h?(i[c]={variable:d,resistance:s},i.length=c+1):i.length=c}for(var p,f=void 0,v=this.equations.combinationSet.componentIndex,l=0,c=i.length;l<c;++l){d=i[l].variable;var g=v.get(d).size;void 0==f?(f=d,p=g):g<p&&(f=d,p=g)}return f}function posEquationsReduceErrorByNoResistanceBoundVars(){for(var e in this.innerProducts){var t=this.boundVarsByEq[e],i=-this.innerProducts[e]/this.equations.getValue(e,t),r=i+this.solution[t],n=this.segmentConstraints.allowsMovement(t,i>0?"up":"down",r);if(n){if(n!==!0){var o=!1;for(var s in n)if(!this.posCalc.orGroups.isOrGroupSatisfiedOnOtherVariable(s,t)){o=!0;break}if(o)continue}this.setSolution(t,r),this.innerProductObj.setToZero(e),this.updateOrGroupSatisfaction(t),this.resistance.calcResistance(t,this.solution[t]),this.resistance.refreshAfterBoundVarAdded(t)}}}function posEquationsInitializeErrorDerivatives(){this.errorDerivatives={};for(var e in this.innerProducts)this.innerProducts[e]>0?this.addEquationToErrorDerivatives(e,1):this.innerProducts[e]<0&&this.addEquationToErrorDerivatives(e,-1)}function posEquationsInitializeVariablesByResistance(){this.recalcAllErrorReducingResistance()}function posEquationsEliminate(e,t,i){var r=[],n=this.innerProducts[t]?void 0:{},o=this;this.equations.combinationComponentIndex(e).forEach(function(e,i){i!=t&&(r.push(i),!n||i in o.innerProducts||(n[i]=!0))}),this.equations.eliminate(e,t);for(var s=r.length-1;s>=0;--s)i||this.resistance.refreshAfterEquationChange(r[s]),this.changedEquations[r[s]]=!0,n&&n[r[s]]&&this.innerProductObj.setToZero(r[s])}function posEquationsFindFeasibleSolution(){var e=0;for(this.doDebugging&&this.debugRecord("before search for feasible solution",["errors","derivatives","solution","error-equations","zero-error-equations","resistance","variablesByResistance","orGroups"]);!isEmptyObj(this.innerProducts);){if(!this.reduceError())return;if(this.doDebugging&&this.debugRecord("after error reduction",["errors","derivatives","solution","error-equations","zero-error-equations","resistance","variablesByResistance"]),
++e>posEquationsMaxReductionStepNum)return void mondriaInternalError("too many error reduction steps")}}function posEquationsFindOptimalSolution(){for(var e,t=0,i=new SortedListIter(this.violatedVars);e=i.next();){if(++t>posEquationsMaxOptimizationSteps)return void mondriaInternalError("too many optimization steps");if(e.entry.suspended)this.doDebugging&&this.debugIncCounter("suspended violations"),e=e.next;else{var r=e.entry.variable,n=e.sortVal;this.doDebugging&&this.debugRecord("optimization",["violations"],"optimizing variable ",this.debugGetVarStr(r),"(value = ",this.solution[r],")");var o=this.calcOptimizationDirection(r,e.entry.target,n);if(this.doDebugging&&this.debugMessage("optimization direction: ",o," priority: ",n),o)if(this.doDebugging&&this.debugIncCounter("active violation"),this.calcOptimizationErrorDerivatives(r,n,o),this.checkOptimizationResistance(n)){for(void 0!=this.boundVars[r]&&this.removeBlockingEquation(this.boundVars[r]),this.doDebugging&&this.debugRecord("calculated optimization derivative: ",["solution","zero-error-equations","derivatives","resistance","variablesByResistance"]),this.optimizationVar=r,this.optimizationDir=o,this.optimizationPriority=n,this.optimizationTarget=e.entry.target;n==this.resistance.getViolationPriority(r);){var s=this.reduceError();if(!s||s==-1){s===!1&&this.suspendOptimization(r,n,o);break}if(++t>posEquationsMaxOptimizationSteps)return i.destroy(),void mondriaInternalError("too many optimization error steps")}this.doDebugging&&this.debugRecord("after optimization step: ",["solution"])}else this.suspendOptimization(r,n,o),e=e.next;else doDebugging&&this.debugIncCounter("self-suspending violation"),e=e.next}}this.optimizationVar=void 0,this.optimizationDir=void 0,this.optimizationPriority=void 0,this.optimizationTarget=void 0}function posEquationsCalcOptimizationDirection(e,t,i){var r,n=this.solution[e];return r=n<t?1:-1,r>0&&i<=this.resistance.getUpResistance(e)||r<0&&i<=this.resistance.getDownResistance(e)?0:r}function posEquationsCheckOptimizationResistance(e){var t=!1;for(var i in this.errorDerivatives)if(this.errorDerivatives[i]>0){if(e>this.resistance.getDownResistance(i)){t=!0;break}}else if(e>this.resistance.getUpResistance(i)){t=!0;break}return t?(this.recalcAllErrorReducingResistance(),!0):(this.doDebugging&&this.debugRecord("cannot move: ",["derivatives","resistance"]),!1)}function posEquationsCalcOptimizationErrorDerivatives(e,t,i,r){void 0==r?this.errorDerivatives={}:delete this.errorDerivatives[r];var n=this.boundVars[e];if(n){var o,s=i*this.equations.getValue(n,e)>0?1:-1,a=this.optimizationSuspension.equations[n];if(a&&(o=a.suspensionId),void 0===r)for(var d=this.equationVecs[n],u=0,h=d.length;u<h;++u){var l=d[u].name;l!=e&&(this.isBlocked(l,t,o)||(this.errorDerivatives[l]=s*d[u].value))}else if(r!=e){var c=this.equations.getValue(n,r);0==c||this.isBlocked(r,t,o)||(this.errorDerivatives[r]=s*c)}}else void 0!=r&&r!=e||this.isBlocked(e,t)||(this.errorDerivatives[e]=-i)}function posEquationsIsBlocked(e,t,i){if(this.resistance.getMinResistance(e)>=t)return!0;var r=this.optimizationSuspension.blocked[e];return!(!r||r.priority<t)&&!(void 0!=i&&this.optimizationSuspension.equations[r.blocking].suspensionId>=i)}function posEquationsSuspendOptimization(e,t,i){this.suspendOptimizationByBlocked(e,t,i,this.errorDerivatives),this.errorDerivatives={}}function posEquationsSuspendOptimizationByBlocked(e,t,i,r){var n=this.violatedVars.getEntry(e);n.suspended=!0;var o=this.optimizationSuspension.blocked,s=this.optimizationSuspension.equations,a=this.boundVars[e];if(void 0!=a){var d=s[a];if(d){for(var o in d.blocked)r[o]||(delete d.blocked[o],this.removeBlockedVariable(o,!0));for(var u in d.blocking)if(0===this.equations.getValue(a,u)||r[u]){var h=this.optimizationSuspension.blocked[u];h&&h.blockedEq.delete(a),delete d.blocking[u]}for(var l in d.selfBlocked)0!==this.equations.getValue(a,l)&&l!=e||this.removeSelfBlockedFromEquation(l,a)}else d=s[a]={boundVar:e,suspensionId:++this.optimizationSuspension.nextSuspensionId,blocked:{},blocking:{},selfBlocked:{}};d.optimizationPriority=t,d.optimizationDir=i;for(var c={},p=this.equationVecs[a],f=0,v=p.length;f<v;++f){var g=p[f].name;g!=e&&(r[g]?this.resistance.violatedBoundResistsFree(g,e,a)&&this.addBlockedVariable(g,a):c[g]=!0)}for(var m in c){var h=this.optimizationSuspension.blocked[m];if(h)h.blockedEq.set(a,!0),d.blocking[m]=!0;else{var l=this.getSelfBlockedEntry(m);l.equations[a]=!0,d.selfBlocked[m]=!0}}this.doDebugging&&this.debugRecord("suspended optimization of variable "+this.debugGetVarStr(e),["optimizationSuspension","violations","variablesByResistance"])}}function posEquationsAddBlockedVariable(e,t){if(this.optimizationSuspension.selfBlocked[e])this.setBlockedVarEntry(e,t,void 0);else{var i=this.optimizationSuspension.blocked[e];if(i){var r=new Map;i.blocking!=t&&r.set(i.blocking,!0);for(var n in i.blockedEq)r.set(n,!0);this.setBlockedVarEntry(e,t,r)}else this.setBlockedVarEntry(e,t,void 0)}}function posEquationsRemoveOptimizationSuspension(e,t,i){if(void 0!=e){var r=this.violatedVars.getNode(e,!0);if(r&&r.entry&&r.entry.suspended){if(i){var n=this.optimizationSuspension.blocked[e];if(n&&n.priority>=r.sortVal)return}t&&this.resistance.getMinResistance(e)>=r.sortVal||(delete r.entry.suspended,this.doDebugging&&this.debugRecord("removing optimization suspension: ",["optimizationSuspension"],"removing optimization suspension for variable ",this.debugGetVarStr(e)))}}}function posEquationsRemoveBlockingEquation(e){var t=this.optimizationSuspension.equations[e];if(t){this.removeOptimizationSuspension(t.boundVar,!0,!1);for(var i in t.blocked)this.removeBlockedVariable(i,!0);for(var r in t.blocking){var n=this.optimizationSuspension.blocked[r];n&&n.blockedEq.delete(e)}for(var o in t.selfBlocked){var n=this.optimizationSuspension.selfBlocked[o];delete n.equations[e],isEmptyObj(n.equations)&&delete this.optimizationSuspension.selfBlocked[o]}delete this.optimizationSuspension.equations[e],this.resistance.removeModuleFromFreeRequireOrGroup(e)}}function posEquationsRemoveSelfBlockedFromEquation(e,t){var i=this.optimizationSuspension.equations[t];i&&delete i.selfBlocked[e];var r=this.optimizationSuspension.selfBlocked[e];r&&(delete r.equations[t],isEmptyObj(r.equations)&&delete this.optimizationSuspension.selfBlocked[e])}function posEquationsRemoveBlockedVariable(e,t,i){var r=this.optimizationSuspension.blocked[e];if(r){this.refreshBlockedEqAfterBlockedRemoval(r.blocking,e,!t);var n=i?void 0:this.splitByFirstEquationWhereBlocked(e,r.blockedEq);if(n)this.setBlockedVarEntry(e,n.blocked,n.blocking),this.removeOptimizationSuspension(e,!1,!0);else{var o=this;r.blockedEq.forEach(function(t,i){o.refreshBlockedEqAfterBlockedRemoval(i,e,!0),r.blockedEq.delete(i)}),delete this.optimizationSuspension.blocked[e],this.resistance.removeFromRequireOrGroupResistance(e,"blocked"),this.removeOptimizationSuspension(e,!0,!1)}}}function posEquationsSetBlockedVarEntry(e,t,i){var r=this.optimizationSuspension.blocked[e];r||(r=this.optimizationSuspension.blocked[e]={blockedEq:new Map});var n=this.optimizationSuspension.equations[t],o=n.optimizationPriority,s=this.boundVarsByEq[t];if(void 0!=r.blocking&&r.blocking!=t){var a=this.optimizationSuspension.equations[r.blocking];a&&delete a.blocked[e]}r.priority=o,r.blocking=t,r.relativeSign=this.equations.getValue(t,e)*this.equations.getValue(t,s),r.resistanceDir=-n.optimizationDir*r.relativeSign,n.blocked[e]=!0,delete n.blocking[e];var d=r.resistanceDir>0?"up":"down";this.resistance.getResistance(e,d)<o&&(this.resistance.getSatOrGroupResistance(e,d)>=o?this.resistance.addToRequireOrGroupResistance(e,"blocked"):mondriaInternalError("blocked variable's priority too low"));var u={};if(this.optimizationSuspension.selfBlocked[e]){for(var h in this.optimizationSuspension.selfBlocked[e].equations){var l=this.optimizationSuspension.equations[h];delete l.selfBlocked[e],h!=t?(l.blocking[e]=!0,r.blockedEq.set(h,!0)):l.blocked[e]=!0,i&&i.has(h)&&i.delete(h)}delete this.optimizationSuspension.selfBlocked[e]}else i&&r.blockedEq.forEach(function(e,n){i.has(n)||(r.blockedEq.delete(n),n!=t&&(u[n]=!0))});if(i){var c=this;i.forEach(function(t,i){if(!r.blockedEq.has(i)){r.blockedEq.set(i,!0);var n=c.optimizationSuspension.equations[i];n.blocking[e]=!0}})}for(var p in u)this.refreshBlockedEqAfterBlockedRemoval(p,e,!0);return r}function posEquationRefreshBlockedEqAfterBlockedRemoval(e,t,i){if(!(e in this.equationVecs))return!1;var r=this.optimizationSuspension.equations[e];if(!r)return!1;delete r.blocking[t],delete r.blocked[t];var n=this.equations.getValue(e,t)*this.equations.getValue(e,this.boundVarsByEq[e])*r.optimizationDir>0?"down":"up",o="up"==n?"down":"up",s=this.resistance.variables[t],a=!1;if(s&&(a=s.resistance[n]>=r.optimizationPriority,a&&s.resistance[o]>=r.optimizationPriority)){var d=this.getSelfBlockedEntry(t);d.equations[e]=!0,r.selfBlocked[t]=!0}return!a&&i&&this.removeBlockingEquation(e),a}function posEquationsDecreaseVariableBlockingPriority(e,t){var i=this.optimizationSuspension.blocked[e];if(i&&!(t>=i.priority)){var r=this.resistance.getMinResistance(e);if(r>=t)return void this.makeBlockedIntoSelfBlocked(e,r);i.priority=t;var n=this;i.blockedEq.forEach(function(e,i){n.optimizationSuspension.equations[i].optimizationPriority>t&&n.removeBlockingEquation(i)})}}function posEquationsGetSelfBlockedEntry(e){var t=this.optimizationSuspension.selfBlocked[e];return t||(t=this.optimizationSuspension.selfBlocked[e]={resistance:this.resistance.getMinResistance(e),equations:{}}),t}function posEquationsMakeBlockedIntoSelfBlocked(e,t){var i=this.optimizationSuspension.blocked[e];if(i&&!(i.priority>t)){var r=this.optimizationSuspension.selfBlocked[e]={resistance:t,equations:{}},n=this.optimizationSuspension.equations,o=n[i.blocking];delete o.blocked[e],o.selfBlocked[e]=!0,r.equations[i.blocking]=!0,i.blockedEq.forEach(function(t,i){var o=n[i];delete o.blocking[e],o.selfBlocked[e]=!0,r.equations[i]=!0}),delete this.optimizationSuspension.blocked[e],this.resistance.removeFromRequireOrGroupResistance(e,"blocked")}}function posEquationsChangeSelfBlockingPriority(e,t){var i=this.optimizationSuspension.selfBlocked[e];if(i){if(i.resistance<=t)return void(i.resistance=t);i.resistance=t;var r=this.optimizationSuspension.equations;for(var n in i.equations)r[n].optimizationPriority>t&&this.removeBlockingEquation(n);this.removeOptimizationSuspension(e,!0,!1)}}function posEquationsFindFirstEquationWhereBlocked(e,t){if(void 0==this.boundVars[e]){var i,r,n=this.resistance.getMinResistance(e),o=-(1/0),s=this;return t.forEach(function(t,a){var d=s.optimizationSuspension.equations[a];d&&(d.optimizationPriority<=n||d.optimizationPriority<o||d.optimizationPriority==o&&d.suspensionId>r||s.stillBlocksOptimization(a,e)&&s.resistance.violatedBoundResistsFree(e,d.boundVar,a)&&(i=a,o=d.optimizationPriority,r=d.suspensionId))}),i}}function posEquationsSplitByFirstEquationWhereBlocked(e,t){var i=this.findFirstEquationWhereBlocked(e,t);if(void 0!=i){var r={blocked:i,blocking:new Map},n=this.optimizationSuspension.equations[i],o=n.optimizationPriority,s=n.suspensionId,a=this;return t.forEach(function(e,t){if(t!=i){var n=a.optimizationSuspension.equations[t];n&&(n.optimizationPriority<o||n.optimizationPriority==o&&n.suspensionId>s)&&r.blocking.set(t,!0)}}),r}}function posEquationsOptimizationBlockingAfterResistanceChange(e){var t=this.optimizationSuspension.blocked[e];if(t){var i=this.resistance.getMinResistance(e);if(i>=t.priority)return void this.makeBlockedIntoSelfBlocked(e,i);var r=t.resistanceDir>0?"up":"down";i=this.resistance.getResistanceWithSatOrGroups(e,r),i>=t.priority||this.removeBlockedVariable(e)}else if(this.optimizationSuspension.selfBlocked[e]){var i=this.resistance.getMinResistance(e);this.changeSelfBlockingPriority(e,i)}}function posEquationsOptimizationBlockingAfterViolationChange(e){var t=this.boundVars[e];if(void 0==t)return void this.removeOptimizationSuspension(e,!0,!0);var i=this.optimizationSuspension.equations[t];if(i){var r=this.violatedVars.getNode(e,!0);if(!r)return void this.removeBlockingEquation(t);var n=r.entry.target-this.solution[e];if(n*i.optimizationDir<0)return void this.removeBlockingEquation(t);var o=r.sortVal;if(o>i.optimizationPriority)this.doDebugging&&this.debugMessage("violation priority of variable ",e," increased to ",o," while it is bound in a blocked equation ",t," with priority ",i.optimizationPriority),this.removeOptimizationSuspension(e,!0,!1);else if(o<i.optimizationPriority){i.optimizationPriority=o;for(var s in i.blocked)this.decreaseVariableBlockingPriority(s,o)}}}function posEquationsUpdateOptimizationSuspensionOfChangedEquations(){for(var e in this.changedEquations)this.optimizationBlockingAfterEquationChange(e)}function posEquationsOptimizationBlockingAfterEquationChange(e){var t=this.optimizationSuspension.equations[e];if(t){var i=this.boundVarsByEq[e];if(i!=t.boundVar)return void this.removeBlockingEquation(e);for(var r=this.equations.getValue(e,i),n=t.optimizationPriority,o={},s=this.equationVecs[e],a={},d=0,u=s.length;d<u;++d){var h=s[d],l=h.name,c=h.value;if(a[l]=!0,l!=t.boundVar&&!(this.resistance.getMinResistance(l)>=n)){var p=this.optimizationSuspension.blocked[l];if(p&&p.blocking!=e){if(p.priority>n)continue;if(p.priority==n){var f=this.optimizationSuspension.equations[p.blocking].suspensionId;if(f<t.suspensionId)continue}}if(!this.stillBlocksOptimization(e,l))return void this.removeBlockingEquation(e);var v=-t.optimizationDir*c*r;o[l]=v>0?-c:c}}this.suspendOptimizationByBlocked(i,n,t.optimizationDir,o),this.resistance.removeModuleFromFreeRequireOrGroup(e,a)}}function posEquationsOptimizationBlockingAfterViolatedOrGroupChange(e){if(void 0==this.boundVars[e]){var t=this.equations.combinationComponentIndex(e);if(t){var i=this.optimizationSuspension.blocked[e],r=this.splitByFirstEquationWhereBlocked(e,t);if(!r){if(!i)return;return void this.removeBlockedVariable(e,!0,!0)}i&&r.blocked==i.blocking||(i=this.setBlockedVarEntry(e,r.blocked,r.blocking),this.removeOptimizationSuspension(e,!0,!0))}}}function posEquationsStillBlocksOptimization(e,t){var i=this.optimizationSuspension.equations[e];if(!i)return!1;var r=this.equations.getValue(e,t);if(!r)return!1;var n=this.boundVarsByEq[e];if(void 0==n)return!1;var o=-i.optimizationDir*r*this.equations.getValue(e,n),s=o>0?this.resistance.getUpResistance(t):this.resistance.getDownResistance(t);return s>=i.optimizationPriority}function posEquationsReduceResistance(){var e=this.variablesByResistance.last;if(!e)return!0;for(var t,i=1,r={},n=void 0,o=1/0;this.continueResistanceReduction(r);){var e=this.variablesByResistance.last,s=e.entry.variable,a=this.getResistingVar(e.entry,r);if(r[s]&&r[s][a]){this.doDebugging&&this.debugMessage("variables already exchanged: ",s," (free) and ",a," (bound)");var d=i-r[s][a];if(void 0==n||t!=d)n=i,t=d,o=e.sortVal[1];else{if(n<=r[s][a]&&o==e.sortVal[1])return!1;o>e.sortVal[1]&&(o=e.sortVal[1])}}else n=void 0,o=1/0;this.exchangeFreeAndBound(s,a),r[s]||(r[s]={}),r[s][a]=i}return!0}function posEquationsContinueResistanceReduction(e){var t=this.variablesByResistance.last;if(!t)return!1;if(void 0!=this.optimizationPriority&&this.optimizationPriority<=t.sortVal[0])return!1;if(t.sortVal[0]<t.sortVal[1])return!0;var i=t.entry.variable,r=this.errorDerivatives[i]>0?"down":"up",n=this.resistance.getSatOrGroupResistance(i,r);return!(n<=t.sortVal[0])&&(!!this.reduceResistanceWithSatisfiedOrGroupVariable(e)||this.continueResistanceReduction(e))}function posEquationsReduceResistanceWithSatisfiedOrGroupVariable(e){var t=this.variablesByResistance.last,i=t.entry.variable,r=this.errorDerivatives[i]>0?"down":"up",n=this.resistance.getSatOrGroupResistance(i,r),o=n,s=t.prev;s&&s.sortVal[0]<o&&(o=s.sortVal[0]),void 0!=this.optimizationVar&&this.optimizationPriority<o&&(o=this.optimizationPriority);var a,d,u=this.resistance.getResistingEqsOfSatOrGroupsForVar(i),h=1/0;for(var l in u)for(var c=this.boundVarsByEq[l],p=this.equations.getValue(l,i),f=this.equationVecs[l],v=0,g=f.length;v<g;++v){var m=f[v],y=m.name;if(y!=i&&y!=c&&void 0==e[y]&&!(this.resistance.getMinResistance(y)>=o||void 0!=this.optimizationVar&&this.isBlocked(y,this.optimizationPriority))){var I=this.errorDerivatives[y];I||(I=0);var b=I-this.errorDerivatives[i]*m.value/p;if(!(I&&Math.abs(b/I)<this.zeroRounding||I*b>0)){var C=this.resistance.getResistance(y,b>0?"down":"up");C<h&&(h=C,d=l,a=y)}}}if(h>=o){var S=this.resistance.getResistance(i,r);return this.addToSatOrGroupVariables(i),this.variablesByResistance.insert({variable:i},[i],[n,n]),this.variablesByResistance.last.sortVal[0]>S&&this.variablesByResistance.last.entry.variable!=i&&this.refreshTotalForVariablesByResistance(),!1}return t.entry.resistingVar=this.boundVarsByEq[d],this.addToSatOrGroupVariables(this.boundVarsByEq[d]),!0}function posEquationsGetResistingVar(e,t){var i=e.resistingOrGroup;if(void 0==i||"satisfied"!=this.posCalc.orGroups.getGroupStatus(i))return e.resistingVar;var r=this.posCalc.orGroups.getSatisfiedVariables(i),n=void 0;for(var o in r)if(void 0!=this.boundVars[o]&&(void 0==n&&(n=o),!t[o]))return o;return n}function posEquationsExchangeFreeAndBound(e,t){var i=this.boundVars[t];delete this.boundVars[t],this.boundVars[e]=i,this.boundVarsByEq[i]=e,this.eliminate(e,i),this.resistance.refreshAfterBoundVarChange(e,t),this.refreshResistanceAfterExchange(t,e),void 0!=this.optimizationVar?this.calcOptimizationErrorDerivatives(this.optimizationVar,this.optimizationPriority,this.optimizationDir):this.addEquationToErrorDerivatives(i,-this.errorDerivatives[e]/this.equations.getValue(i,e)),delete this.errorDerivatives[e],this.updateErrorReducingResistanceAfterExchange(e),this.resistance.clearResistanceChanges(),this.changedEquations[i]=!0,this.updateOptimizationSuspensionOfChangedEquations(),this.changedEquations={},this.doDebugging&&(this.debugIncCounter("free-bound exchange"),this.debugMessage("exchanged free variable ",this.debugGetVarStr(e)," with bound ",this.debugGetVarStr(t)," in eq. ",i),this.debugRecord("after free-bound exchange",["derivatives","resistance","variablesByResistance","zero-error-equations"]))}function posEquationsReduceError(){var e=!0;this.reduceResistance()||(e=!1);var t=this.variablesByResistance.last;if(!t)return this.doDebugging&&this.debugMessage("no more variables to move"),!1;if(void 0!=this.optimizationPriority&&this.optimizationPriority<=t.sortVal[1])return this.doDebugging&&(this.debugIncCounter("failed optimization move"),this.debugMessage("cannot move: optimization priority (",this.optimizationPriority,") ","smaller or equals least resistance variable (",this.debugGetVarStr(t.entry.variable),"): ",objToString(t.sortVal))),!e&&-1;var i,r,n=t.entry.variable,o=this.errorDerivatives[n],s=this.solution[n],a=this.moveAllowedByVar(n,o<0),d=a-s,u=this.inducedMaxMove(n);return void 0==this.optimizationVar&&o*u.exactDerivative<=0?(this.doDebugging&&this.debugMessage("Incorrect derivative (variable ",n,": ",o," should be ",u.exactDerivative,"). Correcting."),this.initializeErrorDerivatives(),this.recalcAllErrorReducingResistance(),!0):(Math.abs(d)<Math.abs(u.move)?r=d:(r=u.move,i=u.tightEq),r==-(1/0)||r==1/0?(void 0==this.optimizationVar?mondriaInternalError("unbound move in feasible solution step"):Math.abs(this.optimizationTarget)==1/0?this.debugMessage("unbound optimium reached, not moving"):mondriaInternalError("unbound move in bound optimization"),0):(this.doDebugging&&(this.debugIncCounter("variable moved"),this.debugMessage("moving variable ",this.debugGetVarStr(n),this.boundVars[n]?" (bound)":" (free)"," by ",r)),this.applyMove(n,r,r==d?a:void 0,i),!0))}function posEquationsInducedMaxMove(e){var t=this.errorDerivatives[e],i=0,r={tightEq:{},move:t>0?-(1/0):1/0},n=this.equations.combinationComponentIndex(e),o=this;return n.forEach(function(e,n){var s,a,d=o.innerProducts[n],u=e.value;if(d){if(d>0?i+=u:i-=u,s=-d/u,s*t>0)return;a="no error"}else{var h=o.boundVarsByEq[n],l=o.equations.getValue(n,h),c=u*l*t>0;a=o.moveAllowedByVar(h,c),s=-l*(a-o.solution[h])/u}s==r.move?r.tightEq[n]=a:Math.abs(s)<Math.abs(r.move)&&(r.move=s,r.tightEq={},r.tightEq[n]=a)}),r.exactDerivative=i,r}function posEquationsApplyMove(e,t,i,r){var n={},o={},s={},a=this.equations.combinationComponentIndex(e),d=this;a.forEach(function(e,i){if(d.innerProducts[i])return void(o[i]=d.innerProducts[i]);n[i]=!0;var a=d.boundVarsByEq[i];r&&void 0!=r[i]&&"no error"!=r[i]?d.setSolution(a,r[i]):d.addToSolution(a,-t*(e.value/d.equations.getValue(i,a))),s[a]=!0}),void 0!=i?this.setSolution(e,i):this.addToSolution(e,t),this.updateOrGroupSatisfaction(e);for(var u in s)this.updateOrGroupSatisfaction(u);this.resistance.calcResistance(e,this.solution[e]);for(var u in s)this.resistance.calcResistance(u,this.solution[u]);for(var h in n)this.innerProductObj.setToZero(h);var l={};for(var h in o)this.innerProducts[h]&&(!r||"no error"!=r[h])&&this.innerProducts[h]*o[h]>0||(this.doDebugging&&this.debugMessage("equation ",h," error became 0"),this.innerProductObj.setToZero(h),this.addEquationToErrorDerivatives(h,o[h]>0?-1:1,l),this.resistance.refreshAfterBoundVarAdded(this.boundVarsByEq[h]));this.refreshResistanceAfterMove(l)}function posEquationsMoveAllowedByVar(e,t){var i,r=this.solution[e],i=this.segmentConstraints.nextValue(e,r,!t);return e==this.optimizationVar&&(t&&this.optimizationTarget<i||!t&&this.optimizationTarget>i)&&(i=this.optimizationTarget),i}function posEquationsAddEquationToErrorDerivatives(e,t,i){if(t)for(var r=this.equationVecs[e],n=0,o=r.length;n<o;++n){var s,a=r[n],d=a.name,u=this.errorDerivatives[d];u?(s=this.errorDerivatives[d]+=a.value*t,Math.abs(s/u)<this.zeroRounding&&(s=0)):s=this.errorDerivatives[d]=a.value*t,s?i&&(void 0==u||s*u<=0)&&(i[d]=!0):(delete this.errorDerivatives[d],i&&u&&(i[d]=!0))}}function posEquationsCalcAllPendingResistance(){var e=this.resistance.needRecalcTotalForViolatedOrGroups;this.resistance.calcAllPending();for(var t in e)this.optimizationBlockingAfterViolatedOrGroupChange(t)}function posEquationsUpdateOrGroupSatisfaction(e,t){this.segmentConstraints.variableHasOrGroups(e)&&(void 0==t&&(t=this.resistance.getStableValue(e)),this.posCalc.orGroups.updateVariableSatisfaction(e,this.solution[e],t))}function posEquationsUpdateViolationsAfterResistanceChanges(){for(var e in this.resistance.resistanceChanged)this.optimizationBlockingAfterResistanceChange(e);for(var e in this.resistance.satOrGroupResistanceChanged)this.resistance.resistanceChanged[e]||this.optimizationBlockingAfterResistanceChange(e);for(var e in this.resistance.violationChanged)this.refreshViolation(e)}function posEquationsCalcErrorReducingResistanceAndTotal(e,t,i){var r=this.resistance.getTotalResistance(e,i?t:void 0),n=this.resistance.getResistanceWithSatOrGroups(e,t),o=this.satOrGroupVariables&&this.satOrGroupVariables[e]?n:this.resistance.getResistance(e,t),s={resistance:o};return r&&r.resistance>n?s.total=r:s.total={resistance:o},s}function posEquationsUpdateErrorReducingResistanceAndTotal(e,t,i,r,n){var o=this.calcErrorReducingResistanceAndTotal(e,t,n),s=o.total;return i&&r[0]==o.resistance&&r[1]==s.resistance&&i.resistingVar==s.resistingVar&&i.resistingOrGroup==s.resistingOrGroup?o.resistance:(i={variable:e},void 0!=s.resistingVar&&(i.resistingVar=s.resistingVar),void 0!=s.resistingOrGroup&&(i.resistingOrGroup=s.resistingOrGroup),this.variablesByResistance.insert(i,[e],[o.resistance,s.resistance]),o.resistance)}function posEquationsCalcErrorReducingResistance(e){this.errorDerivatives[e]||void 0==this.optimizationVar||this.calcOptimizationErrorDerivatives(this.optimizationVar,this.optimizationPriority,this.optimizationDir,e);var t=this.errorDerivatives[e];if(!t)return void this.removeErrorReducingResistance(e);var i=this.errorDerivatives[e]>0?"down":"up";this.updateErrorReducingResistanceAndTotal(e,i,void 0,void 0,!1)}function posEquationsRefreshTotalForVariablesByResistance(){var e={},t=void 0,i=this.variablesByResistance.last;if(i)for(t=i.sortVal[0];i&&i.sortVal[0]==t;)e[i.entry.variable]=i,i=i.prev;if(void 0!=t){for(var r in e){var i=e[r],n=this.errorDerivatives[r]>0?"down":"up",o=this.updateErrorReducingResistanceAndTotal(r,n,i.entry,i.sortVal,!0);o>t&&delete e[r]}if(isEmptyObj(e))return void this.refreshTotalForVariablesByResistance();if(this.satOrGroupVariables)for(var r in this.satOrGroupVariables)e[r]=!0;this.resistance.removeAllTotalResistanceVariablesExcept(e)}}function posEquationsRecalcAllErrorReducingResistance(){this.variablesByResistance.clear(),delete this.satOrGroupVariables;for(var e in this.errorDerivatives)this.calcErrorReducingResistance(e);this.refreshTotalForVariablesByResistance()}function posEquationsRemoveErrorReducingResistance(e){this.variablesByResistance.remove(e),this.deleteFromSatOrGroupVariables(e),this.resistance.removeTotalResistanceVariable(e)}function posEquationsRefreshResistanceAfterExchange(e,t){this.calcAllPendingResistance(),this.updateViolationsAfterResistanceChanges()}function posEquationsUpdateErrorReducingResistanceAfterExchange(e){for(var t=this.boundVars[e],i=this.equationVecs[t],r=0,n=i.length;r<n;++r){var o=i[r].name;o!=e&&this.errorDerivatives[o]?this.calcErrorReducingResistance(o):this.removeErrorReducingResistance(o)}this.refreshTotalForVariablesByResistance()}function posEquationsRefreshResistanceAfterMove(e){this.calcAllPendingResistance(),this.clearSatOrGroupVariables();var t={};for(var i in this.resistance.resistanceChanged)this.calcErrorReducingResistance(i),t[i]=!0;for(var i in this.resistance.totalResistanceChanged)t[i]||(this.calcErrorReducingResistance(i),t[i]=!0);for(var i in e)t[i]||(this.calcErrorReducingResistance(i),t[i]=!0);this.refreshTotalForVariablesByResistance(),this.updateViolationsAfterResistanceChanges(),this.resistance.clearResistanceChanges()}function posEquationsSetResistanceForNextRound(){for(var e in this.solutionChanges)this.resistance.setStableValue(e)&&(this.refreshViolation(e),this.optimizationBlockingAfterResistanceChange(e))}function posEquationsAddToSatOrGroupVariables(e){this.satOrGroupVariables||(this.satOrGroupVariables={}),this.doDebugging&&this.debugMessage("adding variable ",this.debugGetVarStr(e)," to satOrGroupVariables"),this.satOrGroupVariables[e]=!0}function posEquationsDeleteFromSatOrGroupVariables(e){this.satOrGroupVariables&&(delete this.satOrGroupVariables[e],isEmptyObj(this.satOrGroupVariables)&&delete this.satOrGroupVariables)}function posEquationsRemoveFromSatOrGroupVariables(e){this.satOrGroupVariables&&this.satOrGroupVariables[e]&&(this.deleteFromSatOrGroupVariables(e),this.calcErrorReducingResistance(e))}function posEquationsClearSatOrGroupVariables(){if(this.satOrGroupVariables)for(var e in this.satOrGroupVariables)this.removeFromSatOrGroupVariables(e)}function posEquationsRefreshViolation(e){var t=this.resistance.variables[e];if(!t)return this.removeFromViolationList(e),-(1/0);if(void 0==t.violation)return this.removeFromViolationList(e),-(1/0);var i=t.violationPriority,r=t.violationTarget,n=this.solution[e];n||(n=0);var o,s=this.violatedVars.getNode(e,!0);return o=s?s.entry:{variable:e},o.target=r,this.violatedVars.insert(o,[e],i,!0),o.suspended&&this.optimizationBlockingAfterViolationChange(e),i}function posEquationsRemoveFromViolationList(e){this.violatedVars.remove(e),this.optimizationBlockingAfterViolationChange(e)}function posEquationsClearAllInputChanges(){this.equations.clearComponentChanges()}function posEquationsClearSolutionChanges(){this.solutionChanges={}}function PosCalc(e){this.zeroRounding=e&&e>0?e:posCalcDefaultZeroRounding,this.linearConstraints=new LinearConstraints,this.segmentConstraints=new SegmentConstraints(this.linearConstraints),this.orGroups=new OrGroups(this.segmentConstraints),this.pairEquations=new Cycles,this.equations=new PosEquations(this),this.idConvert={},this.cloneEquations={},this.pairValues={},this.watchedInProdObj=new VecInnerProducts(this.pairEquations.watchedCycles,this.pairValues,this.zeroRounding),this.watchedInProd=this.watchedInProdObj.innerProducts,this.variables={},this.newVariables={},this.newVarPairValues={},this.changedVariables={},this.changedPairs={},this.addedNewWatchedPairs={},this.hasAddedNewWatchedPairs=!1,this.removedWatchedPairsInForest={},this.hasRemovedWatchedPairsInForest=!1,this.removedWatchedPairsNotInForest={},this.hasRemovedWatchedPairsNotInForest=!1,this.addedLinearConstraints={},this.hasAddedLinearConstraints=!1,this.removedLinearConstraints={},this.hasRemovedLinearConstraints=!1,this.addedSegmentConstraints={},this.hasAddedSegmentConstraints=!1,this.removedSegmentConstraints={},this.hasRemovedSegmentConstraints=!1,this.DebugTracing(2)}function posCalcGetPair(e,t,i){var r=this.pairEquations.getEdge(e,t);if(void 0!==r||!i)return r;var r;if(e in this.addedNewWatchedPairs&&t in(r=this.addedNewWatchedPairs[e]))return r[t];if(t in this.addedNewWatchedPairs&&e in(r=this.addedNewWatchedPairs[t])){if(r=r[e],void 0===r)return;return{id:r.id,dir:-r.dir,queued:!0}}}function posCalcGetVarPairById(e){return this.linearConstraints.getPairById(e)}function posCalcGetPairPoints(e){return this.pairEquations.getEdgePoints(e)}function posCalcGetOtherInPair(e){return this.pairEquations.edgeOtherEnd(e)}function posCalcAddWatchedPair(e,t){if(e!=t){var i,r=this.pairEquations.getEdge(e,t);if(void 0!==r){var n=this.pairEquations.getEdgeInfo(r.id);if(n.isWatched)return n.inForest?r.id in this.removedWatchedPairsInForest&&(this.removedWatchedPairsInForest[r.id]=void 0):r.id in this.removedWatchedPairsNotInForest&&(this.removedWatchedPairsNotInForest[r.id]=void 0),r;i=r.id}var o;if(t in this.addedNewWatchedPairs&&e in(o=this.addedNewWatchedPairs[t]))return o=void 0===o[e]?o[e]={id:void 0!==i?i:makePairId(t,e),dir:void 0!==i?-r.dir:1,queued:!0}:o[e],r?r:{id:o.id,dir:-o.dir,queued:!0};if(e in this.addedNewWatchedPairs){if(t in(o=this.addedNewWatchedPairs[e])&&void 0!==o[t])return o[t]}else o=this.addedNewWatchedPairs[e]={};return this.hasAddedNewWatchedPairs=!0,o[t]={id:void 0!==i?i:makePairId(e,t),dir:void 0!==i?r.dir:1,queued:!0}}}function posCalcRemoveWatchedPair(e,t,i){if(i.queued)return void(1==i.dir?this.addedNewWatchedPairs[e][t]=void 0:this.addedNewWatchedPairs[t][e]=void 0);var r=this.pairEquations.getEdgeInfo(i.id);if(!r.isWatched){var n;return void(1==i.dir?e in this.addedNewWatchedPairs&&t in(n=this.addedNewWatchedPairs[e])&&(n[t]=void 0):t in this.addedNewWatchedPairs&&e in(n=this.addedNewWatchedPairs[t])&&(n[e]=void 0))}r.inForest?(this.removedWatchedPairsInForest[i.id]=!0,this.hasRemovedWatchedPairsInForest=!0):(this.removedWatchedPairsNotInForest[i.id]=!0,this.hasRemovedWatchedPairsNotInForest=!0)}function posCalcAddLinear(e,t,i,r,n,o,s){s in this.removedLinearConstraints&&(this.removedLinearConstraints[s]=void 0),this.addedLinearConstraints[s]=[e,t,i,r,n,o,s],this.hasAddedLinearConstraints=!0}function posCalcRemoveLinearById(e){e in this.addedLinearConstraints&&(this.addedLinearConstraints[e]=void 0),this.removedLinearConstraints[e]=!0,this.hasRemovedLinearConstraints=!0}function posCalcAddSegment(e,t,i,r,n,o,s,a,d){i in this.removedSegmentConstraints&&(this.removedSegmentConstraints[i]=void 0);var u;s&&(u=this.getCurrentValue(e,t)),this.addedSegmentConstraints[i]=[e,t,i,r,n,o,s,a,d,u],this.hasAddedSegmentConstraints=!0}function posCalcRemoveSegment(e,t,i){i in this.addedSegmentConstraints&&(this.addedSegmentConstraints[i]=void 0),this.removedSegmentConstraints[i]=[e,t],this.hasRemovedSegmentConstraints=!0}function posCalcInternalAddPair(e,t,i,r,n){if(e!=t){if(!i&&this.hasAddedNewWatchedPairs){var o;if(e in this.addedNewWatchedPairs&&t in(o=this.addedNewWatchedPairs[e]))void 0!==(o=o[t])&&(r=o.id);else if(t in this.addedNewWatchedPairs&&e in(o=this.addedNewWatchedPairs[t])&&void 0!==(o=o[e])){r=o.id;var s=t;t=e,e=s}}var a=this.pairEquations.addEdge(e,t,!i||void 0,!!i||void 0,r);void 0!==n&&(this.newVarPairValues[a.id]=a.dir*n);var d=this.pairEquations.edgesById[a.id];(d.inForest||d.isNormal)&&(a.dir>0?this.linearConstraints.addPair(e,t,a.id):this.linearConstraints.addPair(t,e,a.id));
}}function posCalcInternalRemoveWatchedPair(e){var t=this.pairEquations.getEdgePoints(e);void 0!==t&&(this.pairEquations.removeEdgeById(e,!1,!0),this.pairEquations.isNormalById(e)||this.linearConstraints.removePair(t[0],t[1]))}function posCalcSuspendOrRemoveUnusedPair(e,t){var i=this.getPair(e,t);if(void 0!=i){var r=this.linearConstraints.getPairVariable(e,t);void 0!=r&&(this.segmentConstraints.hasConstraint(e,t)||this.linearConstraints.hasActiveConstraint(r)||(this.pairEquations.removeEdgeById(i.id,!0,!1),this.linearConstraints.hasConstraint(e,t)||this.segmentConstraints.hasConstraint(e,t)||this.pairEquations.inForest(e,t)||this.linearConstraints.removePair(e,t)))}}function posCalcGetChangedPairs(){return this.changedPairs}function posCalcInternalAddLinear(e,t,i,r,n,o,s){e!=t&&i!=r&&(this.internalAddPair(e,t,!1),this.internalAddPair(i,r,!1),this.linearConstraints.setConstraint(e,t,i,r,n,o,s),this.doDebugging&&this.debugMessage("adding linear constraint ",s,":",gBR,"<",e,";",t,"> * ",n," = <",i,";",r,">"))}function posCalcInternalRemoveLinearById(e){var t=this.linearConstraints.getPointsById(e);t&&(this.linearConstraints.removeConstraintById(e),this.doDebugging&&this.debugMessage("removing linear constraint ",e),this.suspendOrRemoveUnusedPair(t[0],t[1]),this.suspendOrRemoveUnusedPair(t[2],t[3]))}function posCalcInternalAddSegment(e,t,i,r,n,o,s,a,d,u){void 0==n&&void 0==o&&void 0==s&&void 0==a||e!=t&&(this.internalAddPair(e,t,!1,void 0,u),this.segmentConstraints.setConstraint(e,t,i,r,n,o,s,a,d),this.doDebugging&&this.debugMessage("adding segment constraint ",i,":",gBR,void 0!=n?""+n+" <= ":"","<",e,";",t,">",void 0!=o?" <= "+o:"",a?" preference: "+a:"",s?" stability: "+s:""))}function posCalcInternalRemoveSegment(e,t,i){this.segmentConstraints.removeConstraint(e,t,i),this.doDebugging&&this.debugMessage("removing segment constraint ",i),this.suspendOrRemoveUnusedPair(e,t)}function posCalcUpdateQueuedPairsAndConstraints(){if(debugStartTimer("positioning","removing non-forest watched pairs"),this.hasRemovedWatchedPairsNotInForest){for(var e in this.removedWatchedPairsNotInForest)this.removedWatchedPairsNotInForest[e]===!0&&this.internalRemoveWatchedPair(e);this.hasRemovedWatchedPairsNotInForest=!1,this.removedWatchedPairsNotInForest={}}if(debugStopTimer("removing non-forest watched pairs"),debugStartTimer("positioning","removing in-forest watched pairs"),this.hasRemovedWatchedPairsInForest){for(var e in this.removedWatchedPairsInForest)this.removedWatchedPairsInForest[e]===!0&&this.internalRemoveWatchedPair(e);this.hasRemovedWatchedPairsInForest=!1,this.removedWatchedPairsInForest={}}if(debugStopTimer("removing in-forest watched pairs"),debugStartTimer("positioning","removing segment constraints"),this.hasRemovedSegmentConstraints){for(var t in this.removedSegmentConstraints){var i=this.removedSegmentConstraints[t];void 0!==i&&this.internalRemoveSegment(i[0],i[1],t)}this.hasRemovedSegmentConstraints=!1,this.removedSegmentConstraints={}}if(debugStopTimer("removing segment constraints"),debugStartTimer("positioning","removing linear constraints"),this.hasRemovedLinearConstraints){for(var t in this.removedLinearConstraints)void 0!==this.removedLinearConstraints[t]&&this.internalRemoveLinearById(t);this.hasRemovedLinearConstraints=!1,this.removedLinearConstraints={}}if(debugStopTimer("removing linear constraints"),debugStartTimer("positioning","adding linear constraints"),this.hasAddedLinearConstraints){for(var t in this.addedLinearConstraints){var i=this.addedLinearConstraints[t];void 0!==i&&this.internalAddLinear.apply(this,i)}this.hasAddedLinearConstraints=!1,this.addedLinearConstraints={}}if(debugStopTimer("adding linear constraints"),debugStartTimer("positioning","adding segment constraints"),this.hasAddedSegmentConstraints){for(var t in this.addedSegmentConstraints){var i=this.addedSegmentConstraints[t];void 0!==i&&this.internalAddSegment.apply(this,i)}this.hasAddedSegmentConstraints=!1,this.addedSegmentConstraints={}}if(debugStopTimer("adding segment constraints"),debugStartTimer("positioning","adding watched pairs"),this.hasAddedNewWatchedPairs){for(var r in this.addedNewWatchedPairs){var n=this.addedNewWatchedPairs[r];for(var o in n){var s;void 0!==(s=n[o])&&(s.dir===-1?this.internalAddPair(o,r,!0,s.id):this.internalAddPair(r,o,!0,s.id))}}this.hasAddedNewWatchedPairs=!1,this.addedNewWatchedPairs={}}debugStopTimer("adding watched pairs")}function posCalcConstraintQueueIsEmpty(){return!(this.hasAddedLinearConstraints||this.hasAddedSegmentConstraints||this.hasRemovedLinearConstraints||this.hasRemovedSegmentConstraints)}function posCalcNeedToRecalcConstraintSolution(){return!isEmptyObj(this.linearConstraints.changes)||(!isEmptyObj(this.segmentConstraints.changes)||!isEmptyObj(this.pairEquations.changes))}function posCalcWatchedEquationsChanged(){return!isEmptyObj(this.pairEquations.watchedChanges)}function posCalcNeedToRecalcPositioning(){return this.hasAddedNewWatchedPairs||this.hasRemovedWatchedPairsInForest||this.hasRemovedWatchedPairsNotInForest||this.hasAddedLinearConstraints||this.hasRemovedLinearConstraints||this.hasAddedSegmentConstraints||this.hasRemovedSegmentConstraints||this.needToRecalcConstraintSolution()||this.watchedEquationsChanged()}function posCalcRefreshEquations(){this.segmentConstraints.processLinearConstraintChanges(),debugStartTimer("positioning","refresh changed equations"),this.refreshChangedEquations(),debugStopTimer("refresh changed equations"),debugStartTimer("positioning","refresh changed pairs"),this.refreshChangedVarPairs(),debugStopTimer("refresh changed pairs")}function posCalcRefreshChangedVarPairs(){var e=this.linearConstraints.changes;for(var t in e){var i=e[t];void 0!=i.index||this.pairEquations.edgeExists(t)||this.removePairValue(t),void 0==i.prevIndex||i.prevIndex==i.index||this.linearConstraints.variableExists(i.prevIndex)||this.removeVariable(i.prevIndex);var r=this.pairEquations.edgesById[t];r&&(void 0==i.index||i.index in this.variables||(i.prevIndex&&i.prevIndex in this.variables?this.newVariables[i.index]=this.variables[i.prevIndex]*i.prevRatio/i.ratio:t in this.newVarPairValues&&void 0===this.newVariables[i.index]?this.newVariables[i.index]=this.newVarPairValues[t]/i.ratio:i.index in this.newVariables||(this.newVariables[i.index]=void 0)),(r.isNormal||r.inForest)&&this.refreshChangedPairEquations(t,i))}this.newVarPairValues={}}function posCalcRefreshChangedPairEquations(e,t){if(this.equations.equations.baseSetSize()){var i=this.pairEquations.cycles,r=this.pairEquations.changes;if(i.componentIndex.has(e)){var n=i.componentIndex.get(e),o=this;n.forEach(function(e,i){if(!r[i]){var n=e.value;o.equations.transferValue(o.idConvert[i],t.prevIndex,t.prevRatio*n,t.index,t.ratio*n)}})}}}function posCalcRefreshChangedEquations(){debugStartTimer("positioning","refresh clone equations"),this.refreshCloneEquations(),debugStopTimer("refresh clone equations"),debugStartTimer("positioning","refresh changed cycles"),this.refreshChangedCycles(),debugStopTimer("refresh changed cycles"),debugStartTimer("positioning","refresh changed watched cycles"),this.refreshChangedWatchedCycles(),debugStopTimer("refresh changed watched cycles")}function posCalcRefreshCloneEquations(){for(var e in this.linearConstraints.cloneChanges)if("added"==this.linearConstraints.cloneChanges[e]){var t=this.linearConstraints.cloneVariables[e],i=[];i.push({name:t,value:1},{name:e,value:-1}),this.cloneEquations[e]=this.equations.addEquation(i)}else this.equations.removeEquation(this.cloneEquations[e]),delete this.cloneEquations[e];this.linearConstraints.clearCloneChanges()}function posCalcRefreshChangedCycles(){var e=this.pairEquations.changes;for(var t in e)if("removed"==e[t])this.equations.removeEquation(this.idConvert[t]),delete this.idConvert[t];else{for(var i={},r=[],n=this.pairEquations.cycles.vectors[t],o=0,s=n.length;o<s;++o){var a=n[o],d=a.name,u=this.getVarPairById(d);if(!u){var h=this.pairEquations.getEdgePoints(d);u=this.linearConstraints.addPair(h[0],h[1],d)}if(u.index in i)i[u.index].value+=a.value*u.ratio;else{var a=i[u.index]={name:u.index,value:a.value*u.ratio};r.push(a)}}"added"==e[t]?this.idConvert[t]=this.equations.addEquation(r):this.equations.setEquation(this.idConvert[t],r)}}function posCalcRefreshChangedWatchedCycles(){var e=this.pairEquations.watchedChanges;for(var t in e)if("added"==e[t]||"changed"==e[t]){var i=this.pairEquations.watchedCycleToEdge[t];this.setPairValue(i,this.watchedInProd[t]?this.watchedInProd[t]:0);var r=this.pairEquations.getEdgePoints(i);r&&this.linearConstraints.removePair(r[0],r[1])}else{var i=e[t];this.pairEquations.edgeExists(i)||this.removePairValue(i)}}function posCalcSolveConstraints(){debugStartTimer("positioning","equation refresh"),this.doDebugging&&this.debugNewCycle(),this.updateQueuedPairsAndConstraints(),this.refreshEquations(),debugStopTimer("equation refresh"),this.orGroups.refreshModifiedGroups(),debugStartTimer("positioning","set new and independent variables"),this.setNewAndIndependentVariables(),debugStopTimer("set new and independent variables"),this.needToRecalcConstraintSolution()&&(debugStartTimer("positioning","solve equations"),this.equations.prepareAndSolve(),debugStopTimer("solve equations"),this.updateChangesFromEquations()),debugStartTimer("positioning","calculate changed pair offsets"),this.calcChangedPairs(),debugStopTimer("calculate changed pair offsets"),this.clearAllChanges()}function posCalcUpdateChangesFromEquations(){for(var e in this.equations.solutionChanges)this.setVariable(e,this.equations.solutionChanges[e]);this.equations.clearSolutionChanges()}function posCalcClearAllChanges(){this.linearConstraints.clearChanges(),this.segmentConstraints.clearChanges(),this.pairEquations.clearChanges(),this.clearNewVariables()}function posCalcClearNewVariables(){this.newVariables={}}function posCalcClearSolutionChanges(){this.changedVariables={},this.changedPairs={}}function posCalcSetVariable(e,t){void 0!=this.variables[e]&&this.variables[e]<=t+this.zeroRounding&&this.variables[e]>=t-this.zeroRounding||(this.variables[e]=t,this.changedVariables[e]=t)}function posCalcRemoveVariable(e){delete this.variables[e],delete this.changedVariables[e]}function posCalcSetNewAndIndependentVariables(){var e={};for(var t in this.newVariables)if(this.equations.hasVariable(t)){var i=this.newVariables[t];void 0!==i&&this.equations.setSolution(t,i)}else this.setToPreferredValue(t),e[t]=!0;for(var r in this.segmentConstraints.changes)e[r]||this.equations.hasVariable(r)||this.linearConstraints.variableExists(r)&&(this.setToPreferredValue(r),e[r]=!0);var n=this.equations.equations.getComponentChanges();for(var o in n)"removed"!=n[o]||e[o]||this.linearConstraints.variableExists(o)&&(this.setToPreferredValue(o),e[o]=!0)}function posCalcSetToPreferredValue(e){var t=this.getLastValue(e);t=this.segmentConstraints.getPreferredValue(e,t),t!=this.variables[e]&&this.setVariable(e,t),this.segmentConstraints.variables[e]&&this.segmentConstraints.variables[e].hasOrGroups&&this.orGroups.updateVariableSatisfaction(e,t,t)}function posCalcGetLastValue(e){var t=this.variables[e];if(void 0==t){var i=this.linearConstraints.cloneVariables[e];t=void 0!=i?this.variables[i]:this.newVariables[e]}return t}function posCalcGetCurrentValue(e,t){var i=this.getPair(e,t,!1);if(i)return i.dir*this.pairValues[i.id];var r=this.pairEquations.forest.getPath(e,t);if(r){for(var n=0,o=0,s=r.length-1;o<s;++o){if(i=this.getPair(r[o].name,r[o+1].name,!1),!i)return;n+=i.dir*this.pairValues[i.id]}return n}}function posCalcSetPairValue(e,t){var i=this.pairValues[e];if(void 0!=t&&i!=t){var r=i?t-i:t;if(this.watchedInProdObj.addDualToProducts(e,r),this.pairValues[e]=t,this.changedPairs[e]=t,this.doDebugging&&this.debugMessage("set pair <",e,"> = ",t),this.pairEquations.watchedCycles.componentIndex.has(e)){var n=this.pairEquations.watchedCycles.componentIndex.get(e),o=this;n.forEach(function(e,t){o.setPairValue(o.pairEquations.watchedCycleToEdge[t],o.watchedInProd[t]?o.watchedInProd[t]:0)})}}}function posCalcRemovePairValue(e){this.doDebugging&&this.debugMessage("removing pair <",e,">"),delete this.pairValues[e],delete this.changedPairs[e]}function posCalcCalcChangedPairs(){var e=this.linearConstraints.changes;for(var t in e){var i=e[t];void 0!=i.index&&this.setPairValue(t,this.variables[i.index]?this.variables[i.index]*i.ratio:0)}var r=this.linearConstraints.variables;for(var n in this.changedVariables)if(n in r){var o=r[n].pairs;for(var t in o){var s=this.getVarPairById(t);this.setPairValue(t,this.variables[s.index]?this.variables[s.index]*s.ratio:0)}}}function Positioning(e){this.zeroRounding=void 0==e?positioningDefaultZeroRounding:e,this.posCalc=new PosCalc(this.zeroRounding),this.objectsUsingWatchedPairArr={},this.watchedPairCallbacks={},this.refreshing=!1}function Positioning_GetPairOffset(e,t){if(e==t)return 0;var i=this.getPair(e,t);return this.getOffsetByPairEntry(i)}function positioningGetOffsetByPairEntry(e){if(e){var t=this.posCalc.pairValues[e.id];return void 0==t?void 0:t*e.dir}}function PositioningGetChangedPairs(){return this.posCalc.getChangedPairs()}function positioningGetPair(e,t){return this.posCalc.getPair(e,t,!0)}function positioningGetPairPoints(e){return this.posCalc.getPairPoints(e)}function positioningAddLinear(e,t,i,r,n,o,s){var a=this.posCalc.addLinear(e,t,i,r,n,o,s);return scheduleGeometryTask(!1),a}function positioningRemoveLinearById(e){var t=this.posCalc.removeLinearById(e);return scheduleGeometryTask(!1),t}function positioningAddSegment(e,t,i,r,n,o,s,a,d){this.posCalc.addSegment(e,t,i,r,n,o,s,a,d),scheduleGeometryTask(!1)}function positioningRemoveSegment(e,t,i){this.posCalc.removeSegment(e,t,i),scheduleGeometryTask(!1)}function positioningAddWatchedCalcPair(e,t,i,r){if(e!=t){var n=this.posCalc.addWatchedPair(e,t);return this.addObjUsingWatchedPair(n,i,r),scheduleGeometryTask(!1),n}}function positioningCalcRemoveWatchedCalcPair(e,t,i,r){var n=this.getPair(e,t);n&&this.delObjUsingWatchedPair(e,t,n,i,r)}function Positioning_addObjUsingWatchedPair(e,t,i){var r=this.objectsUsingWatchedPairArr[e.id];r||(r=this.objectsUsingWatchedPairArr[e.id]=[]);for(var n=r.length-1;n>=0;--n)if(r[n].obj==t&&r[n].CB==i)return;r[r.length]={obj:t,CB:i},i&&this.addWatchedCallback(e,t,i)}function Positioning_delObjUsingWatchedPair(e,t,i,r,n){var o=this.objectsUsingWatchedPairArr[i.id];if(o)for(var s=0;s<o.length;s++)if(o[s].obj==r&&o[s].CB==n){o.splice(s,1);break}n&&this.removeWatchedCallback(i.id,r,n),this.delWatchedPairIfNotUsed(e,t,i)}function Positioning_delWatchedPairIfNotUsed(e,t,i){this.objectsUsingWatchedPairArr[i.id]&&this.objectsUsingWatchedPairArr[i.id].length>0||(delete this.objectsUsingWatchedPairArr[i.id],this.posCalc.removeWatchedPair(e,t,i))}function positioningAddWatchedCallback(e,t,i){if(e&&i){if(!this.watchedPairCallbacks[e.id]){var r=this.getOffsetByPairEntry(e);void 0!==r&&(r*=e.dir),this.watchedPairCallbacks[e.id]={lastValue:r,callbacks:[]}}for(var n=this.watchedPairCallbacks[e.id].callbacks,o=n.length-1;o>=0;--o)if(n[o].callingObj==t&&n[o].CB==i)return;var s={dir:e.dir,callingObj:t,CB:i};n.push(s)}}function positioningRemoveWatchedCallback(e,t,i){if(void 0!=e&&i){var r=this.watchedPairCallbacks[e];if(r)for(var n=r.callbacks,o=n.length-1;o>=0;--o)if(n[o].callingObj==t&&n[o].CB==i)return n.splice(o,1),void(n.length||delete this.watchedPairCallbacks[e])}}function positioningCallWatchedCallback(){var e=this.getChangedPairs();for(var t in this.watchedPairCallbacks)if(void 0!=e[t]){var i=this.watchedPairCallbacks[t];if(i.lastValue!=e[t]){var r=i.lastValue=e[t],n=i.callbacks;for(var o in n)n[o].CB.call(n[o].callingObj,n[o].dir*r,t,n[o].dir)}}}function positioningReposition(e){for(;this.needToRefresh();){if(e&&e.timedOut())return!1;this.refresh()}return!0}function positioningNeedToRefresh(){return!!this.posCalc.needToRecalcPositioning()}function positioningRefresh(){debugStartTimer("positioning","positioning refresh"),this.refreshing||(this.refreshing=!0,debugStartTimer("positioning","calculate all variables"),this.posCalc.needToRecalcPositioning()&&this.posCalc.solveConstraints(),debugStopTimer("calculate all variables"),debugStartTimer("positioning","watched callbacks"),this.callWatchedCallbacks(),debugStopTimer("watched callbacks"),this.refreshing=!1,debugStopTimer("positioning refresh"))}function positioningClearSolutionChanges(){this.posCalc.clearSolutionChanges()}function positioningDebugGetPairCycles(e,t){var i=this.getPair(e,t);if(i&&i.id&&!i.queued){var r=this.posCalc.pairEquations.edgesById[i.id],n=void 0;if(r){if(r.inForest||r.isNormal){var o=this.posCalc.pairEquations.cycles.componentIndex.get(i.id);if(o){var s=this;n={},o.forEach(function(e,t){n[t]=s.posCalc.pairEquations.cycles.vectors[t]})}}else r.watchedCycle&&(n={},n[r.watchedCycle]=this.posCalc.pairEquations.watchedCycles.vectors[r.watchedCycle]);return n}}}function initializeDebugTiming(){globalDebugTimingObj=new DebugTimingObj("global"),debugTimingAddGroup("area"),debugTimingAddGroup("description"),debugTimingAddGroup("positioning"),debugTimingAddGroup("content"),debugTimingAddGroup("construction"),debugTimingAddGroup("task queue"),debugTimingAddGroup("profiling"),debugTimingAddGroup("event processing"),debugTimingAddGroup("query"),debugTimingAddGroup("z-index"),debugTimingAddGroup("intersection"),debugTimingAddGroup("scheduler"),globalDebugTimingObj.debugProfilingGroups.profiling=!0}function debugStartTimer(e,t){doDebugTiming&&(globalDebugTimingObj||initializeDebugTiming(),globalDebugTimingObj.debugStartTimer(e,t))}function debugStopTimer(e){globalDebugTimingObj&&globalDebugTimingObj.debugStopTimer(e)}function debugTimingAddGroup(e){globalDebugTimingObj.debugTimingAddGroup(e)}function debugTimingAddConditionalGroup(e,t){globalDebugTimingObj.debugTimingAddConditionalGroup(e,t)}function debugTimingRemoveGroup(e){globalDebugTimingObj.debugTimingRemoveGroup(e)}function debugTimingClear(e){globalDebugTimingObj.debugTimingClear(e)}function debugLogTimeElapsed(){return globalDebugTimingObj.debugLogTimeElapsed()}function debugTotalTimeStart(e){doDebugTiming&&(totalTimeDebugTimingObj||(totalTimeDebugTimingObj=new DebugTimingObj("total"),totalTimeDebugTimingObj._totalTime=0,totalTimeDebugTimingObj.debugTimingAddGroup("total")),totalTimeDebugTimingObj.debugLogTimeElapsed(),totalTimeDebugTimingObj.debugStartTimer("total",e))}function debugTotalTimeStop(e){if(doDebugTiming&&totalTimeDebugTimingObj){var t=totalTimeDebugTimingObj.debugLogTimeElapsed();totalTimeDebugTimingObj._totalTime+=t,totalTimeDebugTimingObj.debugStopTimer(e)}}function debugTotalTimeClear(){totalTimeDebugTimingObj&&totalTimeDebugTimingObj.debugTimingClear(),globalDebugTimingObj&&globalDebugTimingObj.debugTimingClear()}function debugTotalTimeReport(){return!!doDebugTiming&&(totalTimeDebugTimingObj&&(mMessage("totalTime: ",totalTimeDebugTimingObj._totalTime),mMessage("======================== totalTime =========================="),totalTimeDebugTimingObj.calcStatistics(),totalTimeDebugTimingObj.displayStatistics(),mMessage("=============================================================")),globalDebugTimingObj&&(mMessage("=================== globalDebugTimingObj ===================="),globalDebugTimingObj.calcStatistics(),globalDebugTimingObj.displayStatistics(),mMessage("=============================================================")),!0)}function DebugTimingObj(e){this.name=e,this.activeDebugTimingGroups={},this.debugProfilingGroups={},this.debugTimingTable={},this.logElapsedLastTime=void 0}function debugTimingObjDebugStartTimer(e,t){if(doDebugTiming&&e in this.activeDebugTimingGroups){var i=this.debugTimingTable[t];i||(i=this.debugTimingTable[t]={results:[]}),i.startTime||(i.startTime=new Date,e in this.debugProfilingGroups&&void 0!==console.profile&&(i.profiling=!0,console.profile(t)))}}function debugTimingObjDebugStopTimer(e,t){if(doDebugTiming){var i=this.debugTimingTable[e];if(i&&i.startTime){i.profiling&&(console.profileEnd(e),i.profiling=!1);var r=new Date,n={start:i.startTime,end:r};n.diff=n.end.getTime()-n.start.getTime(),i.results.push(n),i.startTime=void 0,t&&this.printLastDebugTiming(e)}}}function debugTimingObjCalcStatistics(e){if(void 0!==e){var t=this.debugTimingTable[e];if(t){var i=t.stat={};if(i.count=t.results.length,t.results.length){i.start=t.results[0].start.getTime(),i.end=t.results[t.results.length-1].end.getTime(),i.totalTime=0,i.minTime=1/0,i.maxTime=-(1/0),i.timeDistribution=[];for(var r=0,n=t.results.length;r<n;++r){var o=t.results[r].end.getTime()-t.results[r].start.getTime();i.totalTime+=o,o<i.minTime&&(i.minTime=o),o>i.maxTime&&(i.maxTime=o),i.timeDistribution[o]?i.timeDistribution[o]++:i.timeDistribution[o]=1}i.average=i.totalTime/i.count}}}else for(var s in this.debugTimingTable)this.calcStatistics(s)}function debugTimingObjDebugTimingClear(e){if(void 0===e){for(var t in this.debugTimingTable)this.debugTimingClear(t);return void(this._totalTime&&(this._totalTime=0))}delete this.debugTimingTable[e]}function debugTimingObjDebugTimingAddGroup(e){this.activeDebugTimingGroups[e]=!0}function debugTimingObjDebugTimingAddConditionalGroup(e,t){this.activeDebugTimingGroups[e]&&(this.activeDebugTimingGroups[t]=!0)}function debugTimingObjDebugTimingRemoveGroup(e){delete this.activeDebugTimingGroups[e]}function debugTimingObjPrintLastDebugTiming(e){var t=this.debugTimingTable[e];if(t&&t.result.length){var i=t.results[t.result.length-1];this.printSingleDebugTiming(e,i)}}function debugTimingObjPrintSingleDebugTiming(e,t){t&&mMessage("%s: start: %s (%s), now: %s (%s) elapsed: %s ms",e,t.start.toLocaleTimeString(),t.start.getTime(),t.end.toLocaleTimeString(),t.end.getTime(),t.end.getTime()-t.start.getTime())}function debugTimingObjDebugLogTimeElapsed(){var e,t=new Date,i=t.getTime();return e=void 0===this.logElapsedLastTime?0:i-this.logElapsedLastTime,this.logElapsedLastTime=i,e}function debugTimingObjDisplayStatistics(){function e(e,t,i){for(var r=String(e),n=i?r.substr(0,t):r;n.length<t;)n+=" ";return n}function t(t){mMessage(e(t.name,45)+"  "+e(t.totalTime,10)+"  "+e(t.count,10)+"  "+e(t.timePerCall,6,!0))}var i;if(doDebugTiming){if("json"===gArgParser.getArg("ddtr")){var r={};for(var n in this.debugTimingTable)this.debugTimingTable[n].stat&&(r[n]=this.debugTimingTable[n].stat.totalTime);var o=gArgParser.getArgList();for(i=0;i<o.length;i++){var s=o[i];r[s]=gArgParser.getArg(s)}var a=this.name;return void console.log(a+"="+objToString(r))}t({name:"name",totalTime:"Total Time",count:"Count",timePerCall:"tm/call"}),mMessage("--------------------------------------------------------------");var d=[];for(var u in this.debugTimingTable){var h=this.debugTimingTable[u].stat;h&&d.push({name:u,totalTime:h.totalTime,count:h.count,timePerCall:h.count?h.totalTime/h.count:"?"})}for(d.sort(function(e,t){return e.totalTime-t.totalTime}),i=0;i<d.length;i++){var l=d[i];t(l)}}}function initPositioning(){globalPos=new Positioning,initializeDebugTracingLog(),initializeDebugTiming()}function InnerProducts(e,t,i){if(this.zeroRounding=i&&i>0?i:0,e&&t){this.vectorSet=e,this.dualSet=t,this.innerProducts={},this.vectorSet.registerInnerProducts(this),this.dualSet.registerInnerProducts(this);for(var r in this.dualSet.vectors)this.innerProducts[r]={};for(var n in this.vectorSet.vectors)this.calcInnerProducts(this.vectorSet,n)}}function innerProductsAddToProducts(e,t,i,r){if(e==this.vectorSet){var n=this.dualSet.componentIndex.get(i),o=this;n.forEach(function(e,i){var n,s=e.value,a=o.innerProducts[i];if(t in a){var d=a[t];n=d+s*r,n&&Math.abs(n/d)<o.zeroRounding&&(n=0),n&&(a[t]=n)}else n=a[t]=s*r;n||delete a[t]})}else if(e==this.dualSet){var s=this.vectorSet.componentIndex.get(i),a=this.innerProducts[t],o=this;s.forEach(function(e,t){var i,n=e.value;if(t in a){var s=a[t];i=s+n*r,i&&Math.abs(i/s)<o.zeroRounding&&(i=0),i&&(a[t]=i)}else i=a[t]=n*r;i||delete a[t]})}}function innerProductsCalcInnerProducts(e,t){if(vector=e.vectors[t],vector){this.initInnerProducts(e,t);for(var i=0,r=vector.length;i<r;++i){var n=vector[i];this.addToProducts(e,t,n.name,n.value)}}}function innerProductsInitInnerProducts(e,t){if(e==this.vectorSet)for(var i in this.dualSet.vectors)this.innerProducts[i]?delete this.innerProducts[i][t]:this.innerProducts[i]={};else e==this.dualSet&&(this.innerProducts[t]={})}function innerProductsAddVectors(e,t,i,r){if(r)if(e==this.vectorSet)for(var n in this.innerProducts){var o,s=this.innerProducts[n];if(i in s){if(t in s){var a=s[t];o=a+r*s[i],o&&Math.abs(o/a)<this.zeroRounding?o=0:o&&(s[t]=o)}else o=s[t]=r*s[i];o||delete s[t]}}else if(e==this.dualSet){var d=this.innerProducts[i],u=this.innerProducts[t];for(var h in this.vectorSet.vectors){var o;if(h in d){if(u[h]){var a=u[h];o=a+r*d[h],o&&Math.abs(o/a)<this.zeroRounding?o=0:o&&(u[h]=o)}else o=u[h]=r*d[h];o||delete u[h]}}}}function innerProductsRemoveVector(e,t){if(e==this.vectorSet)for(var i in this.innerProducts)delete this.innerProducts[i][t];else e==this.dualSet&&delete this.innerProducts[t]}function innerProductsSetToZero(e,t){t in this.innerProducts&&delete this.innerProducts[t][e]}function innerProductsMultiplyVector(e,t,i){if(e==this.vectorSet)for(var r in this.innerProducts)i?this.innerProducts[r][t]*=i:delete this.innerProducts[r][t];else if(e==this.dualSet){var n=this.innerProducts[t];for(var o in n)i?n[o]*=i:delete n[o]}}function posEquationsDebugSetDebugMode(){this.doDebugging?"object"!=typeof this.doDebugging?(this.debugLogMessages=!0,this.debugCreateSections=!0,this.debugStatistics=!1):(this.debugLogMessages=!!this.doDebugging.trace,this.debugStatistics=!!this.doDebugging.statistics,this.debugCreateSections=!!this.doDebugging.trace):(this.debugLogMessages=!0,this.debugStatistics=!0,this.debugCreateSections=!0)}function posEquationsDebugNewSolutionCycle(e){this.doDebugging&&(this.debugNewCycle(),this.debugReportProblemChanges(e),this.debugInitStatistics(e))}function posEquationsDebugRecord(e,t){if(this.doDebugging&&this.doDebugging.trace){var i="object"==typeof this.doDebugging.trace?this.doDebugging.trace:void 0,r={};"string"==typeof t&&(t=[t]);for(var n in t)switch(t[n]){case"errors":if(i&&!i.errors)break;r.errors={};for(var o in this.innerProducts)r.errors[o]=this.innerProducts[o];break;case"derivatives":if(i&&!i.derivatives)break;r.derivatives={};for(var s in this.errorDerivatives){var a=this.debugGetVarStr(s);r.derivatives[a]=this.errorDerivatives[s]}break;case"solution":if(i&&!i.solution)break;r.solution={};for(var n in this.solution)if(this.solution[n]||isNaN(this.solution[n])){var a=this.debugGetVarStr(n);r.solution[a]=this.solution[n]}break;case"error-equations":if(i&&!i["error-equations"])break;r.errorEquations={};for(var o in this.innerProducts)r.errorEquations[o]=this.debugGetEquation(o);break;case"zero-error-equations":if(i&&!i["zero-error-equations"])break;r.zeroErrorEquations={};for(var d in this.errorDerivatives){var u=this;this.equations.combinationComponentIndex(d).forEach(function(e,t){u.innerProducts[t]||r.zeroErrorEquations[t]||(r.zeroErrorEquations[t]=u.debugGetEquation(t))})}break;case"resistance":if(i&&!i.resistance)break;r.resistance={};var h={};for(var d in this.errorDerivatives){r.resistance[this.debugGetVarStr(d)]=this.debugGetResistance(d);var u=this;this.equations.combinationComponentIndex(d).forEach(function(e,t){if(!u.innerProducts[t]&&!h[t]){h[t]=!0;var i=u.boundVarsByEq[t];void 0!=i&&(r.resistance[u.debugGetVarStr(i)]=u.debugGetResistance(i))}})}break;case"variablesByResistance":if(i&&!i.variablesByResistance)break;r.variablesByResistance=[];for(var l=this.variablesByResistance.first;l;){var c=dupObj(l.entry);c.sortVal=dupObj(l.sortVal),r.variablesByResistance.push(c),l=l.next}break;case"violations":if(i&&!i.violations)break;r.violations=[];for(var l=this.violatedVars.first;l;){var c={variable:this.debugGetVarStr(l.entry.variable),priority:l.sortVal,target:l.entry.target,value:this.solution[l.entry.variable],suspended:!!l.entry.suspended};l.entry.suspended&&(c.suspended=!0),r.violations.push(c),l=l.next}break;case"optimizationSuspension":if(i&&!i.optimizationSuspension)break;r.optimizationSuspension=dupObj(this.optimizationSuspension);break;case"orGroups":if(i&&!i.orGroups)break;var h={};r.orGroups={};for(var d in this.errorDerivatives){var p=this.segmentConstraints.getVariableOrGroups(d);for(var f in p)r.orGroups[f]={};var u=this;this.equations.combinationComponentIndex(d).forEach(function(e,t){if(!u.innerProducts[t]&&!h[t]){h[t]=!0;var i=u.boundVarsByEq[t];if(void 0!=i){p=u.segmentConstraints.getVariableOrGroups(i);for(var n in p)r.orGroups[n]={}}}})}for(var f in r.orGroups){var c=this.posCalc.orGroups.orGroups[f];if(c){var v=r.orGroups[f];v.numSatisfied=c.numSatisfied,v.satisfied={};for(var g in c.satisfied)v.satisfied[this.debugGetVarStr(g)]=c.satisfied[g];v.numViolated=c.numViolated,v.violated={};for(var d in c.violated)v.violated[this.debugGetVarStr(d)]=c.violated[d]}else r.orGroups[f]="cannot find entry!"}}if(isEmptyObj(r)||(r.where=e,this.debugPushNextLog(r)),arguments.length>=3){var m=Array.prototype.slice.call(arguments,2);this.debugMessage.apply(this,m)}}}function posEquationsDebugGetEquation(e){for(var t={},i=this.equationVecs[e],r=0,n=i.length;r<n;++r){var o=i[r],s=this.debugGetVarStr(o.name);t[s]=o.value}return t["bound variable"]=this.boundVarsByEq[e],t}function posEquationsDebugGetResistance(e){var t=this.resistance.variables[e];return t?dupObj(t):"no resistance defined"}function posEquationsDebugGetVarStr(e){return this.segmentConstraints.linearConstraints.debugGetVarStr(e)}function posEquationsDebugInitStatistics(e){if(this.doDebugging&&this.doDebugging.statistics){var t={where:"initial statistics"};t.equations=0;for(var i in this.equationVecs)t.equations++;t.variables=this.equations.combinationSet.componentIndex.size,t.varInitRefreshed=0;for(var i in e)t.varInitRefreshed++;t.suspendedViolations=0,t.activeViolations=0;for(var i=this.violatedVars.first;i;i=i.next)i.entry.suspended?t.suspendedViolations++:t.activeViolations++;this.debugPushNextLog(t)}}function posEquationsDebugReportProblemChanges(e){if(this.doDebugging&&this.doDebugging.changes){var t={where:"changes to problem from last solution"};t.variables={};for(var i in e)t.variables[this.debugGetVarStr(i)]=this.solution[i];t.changedEquations={};for(var r in this.changedEquations)t.changedEquations[r]=this.debugGetEquation(r);t.newBoundEquations={};for(var r in this.needToRefreshBoundVar)t.newBoundEquations[r]=this.debugGetEquation(r);this.debugPushNextLog(t)}}function posEquationsDebugCheckOptimizationSuspension(){var e=[];return e.push((new Date).getTime()),this.debugCheckOptimizationSuspensionInternalConsistency(e),this.debugCheckOptimizationSuspensionCorrectness(e),e}function posEquationsDebugBreakOnOptimizationSuspensionErrors(){var e=this.debugCheckOptimizationSuspension();e&&e.length>1&&mondriaInternalError(e)}function posEquationsDebugCheckOptimizationSuspensionInternalConsistency(e){e||(e=[]);for(var t in this.optimizationSuspension.blocked){this.equations.hasComponent(t)||e.push("Blocked variable "+t+" no longer in equations"),this.boundVars[t]&&e.push("Blocked variable "+t+" is bound (in equation "+this.boundVars[t]+")");var i=this.optimizationSuspension.blocked[t];this.equationVecs[i.blocking]?this.equations.getValue(i.blocking,t)?this.optimizationSuspension.equations[i.blocking]?this.optimizationSuspension.equations[i.blocking].blocked[t]||e.push("blocked variable "+t+" does not appear as blocked in equation "+r):e.push("blocking equation "+i.blocking+" of blocked variable "+t+" does not appear in the list of blocking equations."):e.push("blocked variable "+t+" does not appear in its blocking equation "+i.blocking):e.push("blocking equation "+i.blocking+" of blocked variable "+t+" is no longer defined.");for(var r in i.blockedEq)this.equationVecs[r]?this.equations.getValue(r,t)?this.optimizationSuspension.equations[r]?this.optimizationSuspension.equations[r].blocking[t]||e.push("blocked variable "+t+" does not appear in as blocking for equation "+r+", which it blocks"):e.push("blocked equation "+r+" blocked by variable "+t+" does not appear in the list of blocking equations."):e.push("blocked variable "+t+" does not appear in equation "+r+" which it blocks"):e.push("blocked equation "+r+" blocked by variable "+t+" is no longer defined.");
}for(var n in this.optimizationSuspension.selfBlocked){this.equations.hasComponent(n)||e.push("Self-blocked variable "+n+" no longer in equations"),this.boundVars[n]&&e.push("Self-blocked variable "+n+" is bound (in equation "+this.boundVars[n]+")");var o=this.optimizationSuspension.selfBlocked[n];for(var s in o.equations)this.equationVecs[s]?this.equations.getValue(s,n)?this.optimizationSuspension.equations[s]?this.optimizationSuspension.equations[s].selfBlocked[n]||e.push("self-blocked variable "+n+" does not appear as self-blocked for equation "+s+", which it blocks"):e.push("blocking equation "+s+" of self-blocked variable "+n+" does not appear in the list of blocking equations."):e.push("self-blocked variable "+n+" does not appear in the blocking equation "+s):e.push("blocked equation "+s+" of self-blocked variable "+n+" is no longer defined.")}for(var s in this.optimizationSuspension.equations){var a=this.optimizationSuspension.equations[s];for(var t in a.blocked){var i=this.optimizationSuspension.blocked[t];i?i.priority!=a.optimizationPriority&&e.push("the priority of the blocked variable "+t+" ("+i.priority+") does not match the priority of its blocking equation "+s+" ("+a.optimizationPriority+")"):e.push("variable "+t+" registered as blocked by equation "+s+" but is not a blocked variable")}for(var d in a.blocking){var u=this.optimizationSuspension.blocked[d];if(u)if(u.priority==a.optimizationPriority){var h=this.optimizationSuspension.equations[u.blocking];h&&h.suspensionId>=a.suspensionId&&e.push("blocked variable "+d+" is blocking for equation "+s+" but both have same priority and the suspension ID of the equation ("+a.suspensionId+" is not larger than that of the equation blocking the variable ("+h.suspensionId+", eq.= "+u.blocking+")")}else u.priority<a.optimizationPriority&&e.push("the priority of the blocked variable "+d+" ("+u.priority+") is smaller than the priority of  equation "+s+" ("+a.optimizationPriority+") which it blocks");else e.push("variable "+d+" registered as blocking for equation "+s+" but is not a blocked variable")}for(var n in a.selfBlocked){var l=this.optimizationSuspension.selfBlocked[n];l?l.equations[s]||e.push("variable "+n+" registered as self-blocked for equation "+s+" but equation is not registered as blocked by it"):e.push("variable "+n+" registered as self-blocked for equation "+s+" but is not a self-blocked variable")}var c=this.boundVarsByEq[s];if(void 0==c)e.push("no bound variable defined for blocking equation "+s);else{var p=this.violatedVars.getNode(c,!0);if(p){p.sortVal!=a.optimizationPriority&&e.push("violation priority of bound variable "+c+" ("+p.sortVal+") does not equal the priority ("+a.optimizationPriority+") of its blocking equation ("+s+")");var f=p.entry.target-this.solution[c];f*a.optimizationDir<=0&&e.push("optimization direction of bound variable "+c+" ("+f+" does not agree with the direction ("+a.optimizationDir+") recorded  on its blocking equation ("+s+")"),p.entry.suspended||e.push("missing suspension flag on violated variable "+c+" which is bound in blocking eq. "+s)}else e.push("bound variable ("+c+") of blocking equation "+s+" is not violated")}}for(var p=this.violatedVars.first;p;p=p.next)if(p.entry.suspended){var s=this.boundVars[p.entry.variable];if(void 0==s){var o=this.optimizationSuspension.selfBlocked[p.entry.variable],i=this.optimizationSuspension.blocked[p.entry.variable];o?p.entry.sortVal>o.resistance&&e.push("suspended violated variable "+p.entry.variable+" is self-blocking but has higher violation priority ("+p.entry.sortVal+") than its self-blocking resistance ("+o.resistance+")"):i?p.entry.sortVal>i.priority&&e.push("suspended violated variable "+p.entry.variable+" is blocked but has higher violation priority ("+p.entry.sortVal+") than its blocked priority ("+i.priority+")"):e.push("suspended violated variable "+p.entry.variable+" is free but is not blocked or self-blocked")}else this.optimizationSuspension.equations[s]||p.sortVal>this.resistance.getMinResistance(p.entry.variable)&&e.push("suspended violated variable "+p.entry.variable+" is bound, but it is not self-blocked and its equation is not blocking")}return e}function posEquationsDebugCheckOptimizationSuspensionCorrectness(e){e||(e=[]);for(var t in this.optimizationSuspension.equations){var i=this.optimizationSuspension.equations[t];if(this.equationVecs[t])for(var r in i.blocked){var n=this.optimizationSuspension.blocked[r];if(!n)break;var o=this.equations.getValue(t,i.boundVar)*this.equations.getValue(t,r);n.relativeSign*o<=0&&e.push("incorrect relative sign for blocked variable "+r+" in its blocking equation ("+t+") should be: "+o+" but is "+n.relativeSign);var s=o*-i.optimizationDir;n.resistanceDir*s<=0&&e.push("incorrect resistance direction for blocked variable "+r+" in its blocking equation ("+t+") should be: "+s+" but is "+n.resistanceDir);var a=s>0?"up":"down";this.resistance.getResistance(r,a)<n.priority&&this.resistance.getSatOrGroupResistance(r,a)<n.priority&&e.push("resistance in direction of optimization of blocked variable "+r+" ("+u+") smaller than its blocked priority ("+n.priority+")")}}for(var d in this.optimizationSuspension.selfBlocked){var u=this.resistance.getMinResistance(d),h=this.optimizationSuspension.selfBlocked[d].resistance;u!=h&&e.push("self blocked variable "+d+" registered with resistance "+h+" but the actual resistance is "+u)}return e}function posEquationsDebugReportViolations(){var e={};for(var t in this.resistance.variables){var i=this.resistance.variables[t],r=void 0;void 0!=i.violatedMinPriority&&i.violatedMinPriority>-(1/0)&&(r||(r={}),r.minViolation=i.violatedMinValue,r.minViolationPriority=i.violatedMinPriority),void 0!=i.violatedMaxPriority&&i.violatedMaxPriority>-(1/0)&&(r||(r={}),r.maxViolation=i.violatedMaxValue,r.maxViolationPriority=i.violatedMaxPriority),r&&(r.currentValue=this.solution[t]?this.solution[t]:0,e[this.debugGetVarStr(t)]=r)}return e}function posEquationsDebugGetViolatedVarsByPairId(e){var t=globalPos.posCalc.segmentConstraints.pairById[e];if(!t)return[];var i=t.index;result=[],this.violatedVars.getNode(i,!0)&&result.push(i);var r=globalPos.posCalc.linearConstraints.variables[i];for(var n in r)"clone"==r[n]&&this.violatedVars.getNode(n,!0)&&result.push(n);return result}function posEquationsDebugGetViolation(e){var t=this.violatedVars.getNode(e,!0);if(!t)return"no violation";var i={variable:e,priority:t.sortVal,value:this.solution[e],target:t.entry.target,blockedBy:{},equations:{}},r=i.target-i.value;return this.debugAddBlockingToResult(i,e,r),i}function posEquationsDebugAddBlockingToResult(e,t,i){var r=i>0?this.resistance.getUpResistance(t):this.resistance.getDownResistance(t);if(r>=e.priority){var n=e.blockedBy[t]={};return n.direction=i>0?"up":"down",void(n.resistance=r)}var o=this.optimizationSuspension.blocked[t];if(o){if(e.equations[o.blocking])return;return void this.debugAddBlockingEquationToResult(e,o.blocking,t,i)}var s=this.boundVars[t];if(s)return void(e.equations[s]||this.debugAddBlockingEquationToResult(e,s,t,i));var n=e.blockedBy[t]={};n.direction=i>0?"up":"down",n.resistance="not blocked!"}function posEquationsDebugAddBlockingEquationToResult(e,t,i,r){e.equations[t]=!0;var n=this.equationVecs[t];if(n&&this.equations.getValue(t,i))for(var o=this.equations.getValue(t,i),s=0,a=n.length;s<a;++s){var d=n[s].name;d!=i&&this.debugAddBlockingToResult(e,d,-r*n[s].value*o)}}function posEquationsDebugUpdateInnerProdOfBaseEqWithSolution(){return this.debugInnerProductWithBaseEq?this.debugInnerProductWithBaseEq.calcDualInnerProducts():this.debugInnerProductWithBaseEq=new VecInnerProducts(this.equations.baseSet,this.solution,this.zeroRounding),this.debugInnerProductWithBaseEq}function dupObj(e,t){return rdupObj(e,t,0)}function rdupObj(e,t,i){if(void 0===t&&(t=1e3),i>20&&mondriaInternalError("DupObj recursion level: "+i),i++,!e||t<0||"object"!=typeof e)return e;var r;r=e instanceof Array?[]:{};for(var n in e){var o=e[n];if(t<1||!o||"object"!=typeof o)r[n]=o;else{var s;s=o instanceof Array?[]:{};for(var a in o){var d=o[a];if(t<2||!d||"object"!=typeof d)s[a]=d;else{var u;u=d instanceof Array?[]:{};for(var h in d){var l=d[h];if(t<3||!l||"object"!=typeof l)u[h]=l;else{var c;c=l instanceof Array?[]:{};for(var p in l){var f=l[p];if(t<4||!f||"object"!=typeof f)c[p]=f;else{var v;v=f instanceof Array?[]:{};for(var g in f){var m=f[g];if(t<5||!m||"object"!=typeof m)v[g]=m;else{var y;y=m instanceof Array?[]:{};for(var I in m){var b=m[I];t<6||!b||"object"!=typeof b?y[I]=b:y[I]=rdupObj(b,t-6)}v[g]=y}}c[p]=v}}u[h]=c}}s[a]=u}}r[n]=s}}return r}function Heap(e){this.compare=e,this.heap=[]}function heapAddSingle(e){this.heap.push(e),this.bubbleUp(this.heap.length-1)}function heapAddMulti(e){this.heap=this.heap.concat(e);for(var t=this.heap.length+1<<0;t>=0;t--)this.maxHeapify(t)}function heapPop(){var e;return this.heap.length>1?(e=this.heap[0],this.heap[0]=this.heap.pop(),this.maxHeapify(0)):e=this.heap.pop(),e}function heapPeek(){return this.heap[0]}function heapBubbleUp(e){for(var t=e-1>>1;e>0&&this.compare(this.heap[t],this.heap[e])>0;){var i=this.heap[t];this.heap[t]=this.heap[e],this.heap[e]=i,e=t,t=e-1>>1}}function heapMaxHeapify(e){for(var t,i,r,n=e;t=2*e+1,i=t+1,t<this.heap.length&&this.compare(this.heap[t],this.heap[n])<0&&(n=t),i<this.heap.length&&this.compare(this.heap[i],this.heap[n])<0&&(n=i),n!==e;)r=this.heap[e],this.heap[e]=this.heap[n],this.heap[n]=r,e=n}function heapIsEmpty(){return 0===this.heap.length}function heapGetSize(){return this.heap.length}function InternalQCMPathIdAllocator(){this.rootId=1025,this.nextId=1026,this.pathByPrefix={},this.pathById={},this.pathById[this.rootId]={count:1,length:0,skPair:[1,1],skNext:[1,0],skHighest:[1,1],skHighestPathId:this.rootId,sortKey:1,strings:void 0}}function internalQCMPathIdAllocatorAllocatePathId(e,t){void 0===e&&(e=this.rootId);var i=this.pathById[e];if(i){this.pathByPrefix[e]||(this.pathByPrefix[e]={});var r;if(r=this.pathByPrefix[e][t])return this.pathById[r].count++,r;r=this.pathByPrefix[e][t]=this.nextId++;var n=this.pathById[r]={prefix:e,length:i.length+1,firstAttr:i.firstAttr?i.firstAttr:r,lastAttr:t,count:1};return i.count++,this.calculateSK(r),n.suffixes={},r}}function internalQCMPathIdAllocatorAllocatePathIdFromPath(e,t){e||(e=this.rootId);var i,r=t.length;if(this.pathById[e]){for(i=0;i<r;++i){var n=t[i];if(!this.pathByPrefix[e]||!this.pathByPrefix[e][n])break;e=this.pathByPrefix[e][n]}if(i==r)return this.pathById[e].count++,e;for(var o;i<r;++i)e=this.allocatePathId(e,t[i]),o&&this.releasePathId(o),o=e;return e}}function internalQCMPathIdAllocatorAllocateConcatPathId(e,t){if(t==this.rootId)return this.allocatePathIdByPathId(e),e;var i=this.getPathStrings(t);if(i)return this.allocatePathIdFromPath(e,i)}function internalQCMPathIdAllocatorAllocatePathIdByPathId(e){e!=this.rootId&&this.pathById[e]&&this.pathById[e].count++}function internalQCMPathIdAllocatorAllocateSuffixPath(e,t,i){if(!(i>e)){if(i==this.rootId)return e;if(i==e)return this.rootId;if(i in t.suffixes)return t.suffixes[i];var r=t.prefix==i?this.rootId:this.allocateSuffixPath(t.prefix,this.pathById[t.prefix],i);if(void 0===r)return t.suffixes[i]=void 0;var n=t.suffixes[i]=this.allocatePathId(r,t.lastAttr);return n}}function internalQCMPathIdAllocatorReleasePathId(e){if(e!=this.rootId){var t=this.pathById[e];if(t&&!--t.count){for(var i=t.prefix,r=this.pathById[i];r.skHighestPathId==e&&(r.skHighestPathId=i,r.prefix);)r=this.pathById[r.prefix];for(var n in t.suffixes){var o=t.suffixes[n];void 0!==o&&this.releasePathId(o)}this.pathByPrefix[e]&&delete this.pathByPrefix[e],delete this.pathByPrefix[i][t.lastAttr],delete this.pathById[e],this.releasePathId(i)}}}function internalQCMPathIdAllocatorDiffPathId(e,t){if(t==this.rootId)return e;if(e==t)return this.rootId;var i=this.pathById[e];if(i)return this.allocateSuffixPath(e,i,t)}function internalQCMPathIdAllocatorIsPrefixOf(e,t){if(t==this.rootId||e==t)return!0;var i=this.pathById[e];return!!i&&!!this.allocateSuffixPath(e,i,t)}function internalQCMPathIdAllocatorGetRootPathId(){return this.rootId}function internalQCMPathIdAllocatorGetPathId(e,t){var i;if(i=this.pathByPrefix[e])return i[t]}function internalQCMPathIdAllocatorGetPathLength(e){return this.pathById[e]?this.pathById[e].length:void 0}function internalQCMPathIdAllocatorGetPrefix(e){if(e!=this.rootId)return this.pathById[e]?this.pathById[e].prefix:void 0}function internalQCMPathIdAllocatorGetCommonPrefix(e){for(var t=e[0],i=1,r=e.length;i<r;){var n=e[i];if(n==this.rootId)return this.rootId;for(;n!==t;){if(n<t){var o=t;t=n,n=o}n=this.pathById[n].prefix}i++}return t}function internalQCMPathIdAllocatorGetFirstAttrAfterPrefix(e,t){if(t!=this.rootId&&t!=e){var i=this.pathById[t];if(i){if(e!=this.rootId){var r=this.allocateSuffixPath(t,i,e);if(void 0==r)return;i=this.pathById[r]}return i.firstAttr?this.pathById[i.firstAttr].lastAttr:void 0}}}function internalQCMPathIdAllocatorGetLastPathAttr(e){var t=this.pathById[e];if(t)return t.lastAttr}function internalQCMPathIdAllocatorGetPathStrings(e){var t=this.pathById[e];if(void 0!==t)return void 0===t.strings&&(void 0!==t.lastAttr?t.strings=this.getPathStrings(t.prefix).concat(t.lastAttr):t.strings=[]),t.strings}function internalQCMPathIdAllocatorGetPathSuffix(e,t){if(t==this.rootId)return e;if(e==t)return this.rootId;var i;if(i=this.pathById[e])return this.allocateSuffixPath(e,i,t)}function internalQCMPathIdAllocatorGetSortKey(e){var t;return(t=this.pathById[e])?t.sortKey:0}function internalQCMPathIdAllocatorExtensionSortKeyRange(e){var t;if(t=this.pathById[e])return[t.sortKey,t.skHighest[0]/t.skHighest[1]]}function internalQCMPathIdAllocatorCalculateSK(e){var t=this.pathById[e],i=t.prefix,r=this.pathById[i];t.skPair=[r.skHighest[0]+r.skNext[0],r.skHighest[1]+r.skNext[1]],t.sortKey=t.skPair[0]/t.skPair[1],t.skNext=r.skNext;for(var n=r.skHighestPathId;n!=i;){var o=this.pathById[n];o.skNext=t.skPair,n=o.prefix}t.skHighestPathId=e,t.skHighest=t.skPair;var s=r.skHighestPathId;do{if(r.skHighestPathId=e,r.skHighest=t.skPair,!r.prefix)break;r=this.pathById[r.prefix]}while(r.skHighestPathId==s)}function significantDigitRounding(e,t){if(0===e)return 0;var i=Math.pow(10,-Math.floor(Math.log(e<0?-e:e)/Math.LN10)+t-1);return Math.round(e*i)/i}function fixedRounding(e,t){var i=Math.pow(10,t);return Math.round(e*i)/i}function shiftRounding(e,t){return Math.round(e*t)/t}function InternalQCMCompression(e,t){this.rootPathId=t,this.emptyRangeCompression=1,this.nextCompressedValue=2,this.quickCompressedValue=1,this.rounding=void 0,this.defaultRounding=void 0,this.simpleCompression=new Map,this.rangeValues=new IntHashMap,this.numberTypeCompression=new Map,this.simpleCompression.set("number",this.numberTypeCompression),this.stringTypeCompression=new Map,this.simpleCompression.set("string",this.stringTypeCompression),this.simpleCompressedValues=new IntHashPairMapUint,this.pathCompression=new IntHashMap,this.sequenceCompression=new IntHashMap,this.queuedSimpleRelease=new IntHashMapUint,this.initRounding(e)}function internalQCMCompressionInitRounding(e){if(e){this.rounding=new Map,e.default&&(this.defaultRounding=this.createRoundingFunction(e.default));var t=this;e.byType&&e.byType.forEach(function(e,i){var r=t.createRoundingFunction(e);r&&t.rounding.set(i,r)}),void 0===this.defaultRounding&&0==this.rounding.size&&(this.rounding=void 0)}}function internalQCMCompressionCreateRoundingFunction(e){if(e){var t=e.rounding;if(void 0!==t){if("significant digits"==e.method){if(t<1)return;return function(e){return significantDigitRounding(e,t)}}if("fixed"==e.method){var i=Math.pow(10,e.rounding);return function(e){return Math.round(e*i)/i}}}}}function internalQCMCompressionNextQuick(){return this.quickCompressedValue=16807*this.quickCompressedValue%2147483647}function internalQCMCompressionSimple(e,t){var i,r,n;if("object"==typeof t){if(t.isEmpty())return this.emptyRangeCompression;r=t.getMinOpen(),n=t.getMaxOpen(),i=t.getMaxKey(),t=t.getMinKey()}if(void 0!==this.rounding&&"number"==typeof t){var o=this.rounding.get(e);if(void 0===o&&this.defaultRounding&&(o=this.defaultRounding,this.rounding.set(e,o)),void 0!==o&&(t=o(t),void 0!==i&&(i=o(i))),i===t){if(r||n)return this.emptyRangeCompression;i=void 0}}else if(i===t){if(r||n)return this.emptyRangeCompression;i=void 0}var s;"number"==e?s=this.numberTypeCompression:"string"==e?s=this.stringTypeCompression:(s=this.simpleCompression.get(e))||(s=new Map,this.simpleCompression.set(e,s));var a;if(s.has(t)?(a=s.get(t),void 0===i&&this.simpleCompressedValues.inc(a,1)):(a=this.nextCompressedValue++,s.set(t,a),this.simpleCompressedValues.setPair(a,1,{type:e,roundedValue:t})),void 0===i)return a;var d;void 0===(d=this.rangeValues.get(a))&&(d=new Map,this.rangeValues.set(a,d));var u,h=(r?1:0)+(n?2:0);void 0===(u=d.get(i))&&(u=[],u[4]=0,d.set(i,u));var l=u[h];return void 0===l?(l=u[h]=this.nextCompressedValue++,u[4]++,this.simpleCompressedValues.setPair(l,1,{type:e,roundedValue:new ConstRangeKey(void 0,e,t,i,r,n)}),this.simpleCompressedValues.inc(a,1)):this.simpleCompressedValues.inc(l,1),l}function internalQCMCompressionReallocateSimple(e){if(e==this.emptyRangeCompression)return!0;var t=this.simpleCompressedValues.incAndGetSecond(e,1);return!!t||(this.simpleCompressedValues.delete(e),!1)}function internalQCMCompressionPath(e,t){var i;(i=this.pathCompression.get(e))||(i=new IntHashMap,this.pathCompression.set(e,i));var r;return(r=i.get(t))?r.count++:(r={count:1,value:[this.nextQuick(),e===this.rootPathId?t:this.nextCompressedValue++]},i.set(t,r)),r.value}function internalQCMCompressionPathAndValue(e,t,i){return this.path(e,this.simple(t,i))}function internalQCMCompressionNext(e,t){if(!e)return t;var i;(i=this.sequenceCompression.get(e))||(i=new IntHashMap,this.sequenceCompression.set(e,i));var r;return(r=i.get(t))?r.count++:(r={count:1,value:this.nextCompressedValue++},i.set(t,r)),r.value}function internalQCMCompressionReleaseSimple(e,t){var i,r,n;if("object"==typeof t){if(t.isEmpty())return this.emptyRangeCompression;r=t.getMinOpen(),n=t.getMaxOpen(),i=t.getMaxKey(),t=t.getMinKey()}if(void 0!==this.rounding&&this.rounding.size>0&&"number"==typeof t){var o=this.rounding.get(e);if(void 0!==o&&(t=o(t),void 0!==i&&(i=o(i))),i===t){if(r||n)return this.emptyRangeCompression;i=void 0}}else if(i===t){if(r||n)return this.emptyRangeCompression;i=void 0}var s;if("number"==e)s=this.numberTypeCompression;else if("string"==e)s=this.stringTypeCompression;else if(!(s=this.simpleCompression.get(e)))return 0;var a;if(!(a=s.get(t)))return 0;if(void 0===i)return this.queuedSimpleRelease.inc(a,1),a;var d,u=this.rangeValues.get(a);if(void 0===u)return 0;var h=(r?1:0)+(n?2:0),l=u.get(i);return void 0===l?0:(d=l[h],void 0===d?0:(this.queuedSimpleRelease.inc(d,1),d))}function internalQCMCompressionReleaseSimpleCompressed(e){e!=this.emptyRangeCompression&&this.queuedSimpleRelease.inc(e,1)}function internalQCMCompressionApplyQueuedSimpleRelease(){var e=this;this.queuedSimpleRelease.forEach(function(t,i){var r=e.simpleCompressedValues.decAndGetSecond(i,t,!1,!0);if(void 0!==r){var n=e.simpleCompression.get(r.type);if("object"!=typeof r.roundedValue)return void n.delete(r.roundedValue);var o=r.roundedValue.getMinKey(),s=n.get(o),a=e.rangeValues.get(s),d=r.roundedValue.getMaxKey(),u=a.get(d);(r.roundedValue.getMinOpen()?1:0)+(r.roundedValue.getMaxOpen()?2:0);0==--u[4]&&(1==a.size?e.rangeValues.delete(s):a.delete(d)),0===e.simpleCompressedValues.dec(s,t)&&n.delete(o)}}),this.queuedSimpleRelease.clear()}function internalQCMCompressionReleasePath(e,t){var i;if(!(i=this.pathCompression.get(e)))return 0;var r;return(r=i.get(t))?(--r.count||(1==i.size?this.pathCompression.delete(e):i.delete(t)),r.value):0}function internalQCMCompressionReleasePathAndValue(e,t,i){return this.releasePath(e,this.releaseSimple(t,i))}function internalQCMCompressionReleaseNext(e,t){if(!e)return t;var i;if(!(i=this.sequenceCompression.get(e)))return 0;var r;return(r=i.get(t))?(--r.count||(i.delete(t),this.sequenceCompression.delete(r.value)),r.value):0}function internalQCMCompressionGetSimpleValue(e){return e==this.emptyRangeCompression?{type:"range",roundedValue:new ConstRangeKey}:this.simpleCompressedValues.getSecond(e)}function IndexerQueue(){this.pathNodeQueue=new Heap(this.comparator),this.queuedIndexers=new Map,this.identityUpdateQueue=[],this.orderServiceQueue=[],this.compCalcQueue=[],this.completeIncrementalUpdateTasks=[],this.queuedDataElements=new Map}function indexerQueueSchedulePathNode(e){if(!e.scheduled){e.scheduled=!0,this.pathNodeQueue.addSingle(e);var t=e.indexer.getId();this.queuedIndexers.has(t)?this.queuedIndexers.set(t,this.queuedIndexers.get(t)+1):this.queuedIndexers.set(t,1)}}function indexerQueueDecreaseIndexerCount(e){var t=e.indexer.getId(),i=this.queuedIndexers.get(t)-1;0==i?this.queuedIndexers.delete(t):this.queuedIndexers.set(t,i)}function indexerQueueRemoveIndexerFromQueues(e){this.queuedIndexers.has(e)&&this.queuedIndexers.delete(e),this.queuedDataElements.has(e)&&this.queuedDataElements.delete(e)}function indexerQueueScheduleIdentityUpdate(e){e.identityUpdatesScheduled||(e.identityUpdatesScheduled=!0,this.identityUpdateQueue.push(e))}function indexerQueueScheduleCompCalc(e){e.removalQueued||(e.removalQueued=!0,this.compCalcQueue.push(e))}function indexerQueueScheduleOrderService(e){e.refreshQueued||(e.refreshQueued=!0,this.orderServiceQueue.push(e))}function indexerQueueScheduleCompleteIncrementalUpdate(e){e.scheduledForCompleteIncrementalUpdateTask||(e.scheduledForCompleteIncrementalUpdateTask=!0,this.completeIncrementalUpdateTasks.push(e))}function indexerQueueScheduleDataElements(e){this.queuedDataElements.set(e.indexer.id,e)}function indexerQueueQueuesEmpty(e,t){return e?0===this.identityUpdateQueue.length&&this.pathNodeQueue.isEmpty():0===this.identityUpdateQueue.length&&0===this.orderServiceQueue.length&&0===this.compCalcQueue.length&&0===this.completeIncrementalUpdateTasks.length&&this.pathNodeQueue.isEmpty()&&(!!t||0==this.queuedDataElements.size)}function indexerQueueIndexerIsScheduled(e){return void 0!==e&&this.queuedIndexers.has(e.getId())}function indexerQueueExecuteScheduled(e,t){for(;!this.queuesEmpty(t,!0);){if(!this.executeIdentityUpdates(e))return this.queuesEmpty(t);if(!this.executePathNodeUpdates(e))return this.queuesEmpty(t);if(0===this.identityUpdateQueue.length){if(t)return!0;if(!this.executeCompCalcUpdates(e))return this.queuesEmpty();if(!this.executeOrderServiceUpdates(e))return this.queuesEmpty();if(!(this.identityUpdateQueue.length>0)&&this.pathNodeQueue.isEmpty()&&!this.executeCompleteIncrementalUpdateTasks(e))return this.queuesEmpty()}}return!!this.executeFinalCleanups(e)||this.queuesEmpty()}function indexerQueueExecuteFinalCleanups(e){return!!this.executeDataElementCleanup(e)||this.queuesEmpty()}function indexerQueueExecuteIdentityUpdates(e){for(var t=0;t<this.identityUpdateQueue.length;++t){var i=this.identityUpdateQueue[t];if(i.identityUpdatesScheduled=!1,i.updatePendingIdentities(),e&&e.timedOut())return this.identityUpdateQueue.splice(0,t+1),!1}return this.identityUpdateQueue.length=0,!0}function indexerQueueExecutePathNodeUpdates(e){for(var t;t=this.pathNodeQueue.pop();)if(t.scheduled){if(t.scheduled=!1,t.indexer.updateEpilogForPathNode(t),this.decreaseIndexerCount(t),e&&e.timedOut())return!1;if(this.identityUpdateQueue.length>0)break}return!0}function indexerQueueExecuteOrderServiceUpdates(e){for(var t=!1,i=0;i<this.orderServiceQueue.length;++i){var r=this.orderServiceQueue[i];if(!r.destroyed&&(r.refreshQueued=!1,r.unsuspend(),e&&(t=e.timedOut())||this.identityUpdateQueue.length>0||!this.pathNodeQueue.isEmpty()))return this.orderServiceQueue.splice(0,i+1),!t}return this.orderServiceQueue.length=0,!0}function indexerQueueExecuteCompCalcUpdates(e){for(var t=!1,i=0;i<this.compCalcQueue.length;++i){var r=this.compCalcQueue[i];if(r.removalQueued&&(r.removalQueued=!1,r.applyQueuedRemovals(),e&&(t=e.timedOut())||this.identityUpdateQueue.length>0||!this.pathNodeQueue.isEmpty()))return this.compCalcQueue.splice(0,i+1),!t}return this.compCalcQueue.length=0,!0}function indexerQueueExecuteCompleteIncrementalUpdateTasks(e){for(var t=0;t<this.completeIncrementalUpdateTasks.length;t++){var i=this.completeIncrementalUpdateTasks[t];if(!i.destroyed&&i.isActive()){if(i.scheduledForCompleteIncrementalUpdateTask&&(i.scheduledForCompleteIncrementalUpdateTask=!1,i.completeIncrementalUpdate(),e&&e.timedOut()))return this.completeIncrementalUpdateTasks.splice(0,t+1),!1}else i.completeIncrementalUpdateTaskCancelled=!0}return this.completeIncrementalUpdateTasks.length=0,!0}function indexerQueueExecuteDataElementCleanup(e){var t=!1,i=this;return this.queuedDataElements.forEach(function(r,n){t||(r.removePendingRemovals(),i.queuedDataElements.delete(n),e&&(t=e.timedOut()))}),!t}function BinaryTree(e){this.root=void 0,this.first=void 0,this.last=void 0,e&&(this.compare=e),this.allocateTreeNode=this.defaultAllocateTreeNode}function binaryTreeDefaultAllocateTreeNode(e,t,i,r){return new BinaryTreeNode(e,t,i,r)}function binaryTreeCompare(e,t){return e===t?0:e-t}function binaryTreeIsEmpty(){return void 0===this.root}function binaryTreeInsertKey(e){var t,i,r;for(i=this.root;i;i=r<0?i.left:i.right){if(r=this.compare(e,i.key),0===r)return i;t=i}return void 0===t?(i=this.root=this.allocateTreeNode(e),this.first=i,this.last=i):this.compare(e,t.key)<0?(i=t.left=new this.allocateTreeNode(e,t,t.prev,t),t.prev?t.prev.next=i:this.first=i,t.prev=i):(i=t.right=new this.allocateTreeNode(e,t,t,t.next),t.next?t.next.prev=i:this.last=i,t.next=i),i}function binaryTreeRemoveKey(e){for(var t,i=this.root;i;i=t<0?i.left:i.right)if(t=this.compare(i.key,e),0===t)return this.removeNode(i),!0;return!1}function binaryTreeRemoveNode(e){var t;t=void 0===e.left||void 0===e.right?e:e.next,t.prev?t.prev.next=t.next:this.first=t.next,t.next?t.next.prev=t.prev:this.last=t.prev;var i=void 0!==t.left?t.left:t.right;return void 0!==i&&(i.parent=t.parent),void 0===t.parent?this.root=i:t==t.parent.left?t.parent.left=i:t.parent.right=i,t!=e&&this.copySplicedToRemovedNode(t,e),t}function binaryTreeCopySplicedToRemovedNode(e,t){t.key=e.key,t.value=e.value}function binaryTreeFind(e){for(var t=this.root;t;){var i=this.compare(e,t.key);if(i<0){if(void 0===t.left)return t;t=t.left}else{if(0===i)return t;if(void 0==t.right)return t.next;t=t.right}}}function binaryTreePrint(){void 0!==this.root&&this.root.print("")}function BinaryTreeNode(e,t,i,r){this.parent=t,this.left=void 0,this.right=void 0,this.prev=i,this.next=r,this.key=e,this.value=void 0}function binaryTreeNodePrint(e){void 0!==this.left&&this.left.print(e+"  "),console.log(e+config2str(this.key),"=>",config2str(this.value)),void 0!==this.right&&this.right.print(e+"  ")}function RedBlackTree(e){this.BinaryTree(e)}function redBlackTreeInsertKey(e){var t=this.BinaryTree_insertKey(e);return this.fixAfterInsertion(t),t}function redBlackTreeFixAfterInsertion(e){if(void 0===e.red){e.red=!0;for(var t;e!=this.root&&(t=e.parent).red===!0;)if(t==t.parent.left){var i=t.parent.right;void 0!==i&&i.red===!0?(t.red=!1,i.red=!1,t.parent.red=!0,e=t.parent):(e==t.right&&(e=t,this.rotateLeft(e)),(t=e.parent).red=!1,t.parent.red=!0,this.rotateRight(t.parent))}else{var i=t.parent.left;void 0!==i&&i.red===!0?(t.red=!1,i.red=!1,t.parent.red=!0,e=t.parent):(e==t.left&&(e=t,this.rotateRight(e)),(t=e.parent).red=!1,t.parent.red=!0,this.rotateLeft(t.parent))}this.root.red=!1}}function redBlackTreeRemoveNode(e){var t=this.BinaryTree_removeNode(e);this.fixAfterRemoval(t)}function redBlackTreeFixAfterRemoval(e){if(e.red!==!0){for(var t=void 0!==e.left?e.left:e.right,i=e.parent;void 0!==i&&(void 0===t||t.red!==!0);)if(t===i.left){var r=i.right;if(r.red===!0&&(r.red=!1,i.red=!0,this.rotateLeft(i),r=i.right),void 0!==r.left&&0!=r.left.red||void 0!==r.right&&0!=r.right.red){void 0!==r.right&&r.right.red!==!1||(r.left.red=!1,r.red=!0,this.rotateRight(r),r=i.right),r.red=i.red,i.red=!1,r.right.red=!1,this.rotateLeft(i),t=this.root;break}r.red=!0,t=i,i=t.parent}else{var r=i.left;if(r.red===!0&&(r.red=!1,i.red=!0,this.rotateRight(i),r=i.left),void 0!==r.right&&0!=r.right.red||void 0!==r.left&&0!=r.left.red){void 0!==r.left&&r.left.red!==!1||(r.right.red=!1,r.red=!0,this.rotateLeft(r),r=i.left),r.red=i.red,i.red=!1,r.left.red=!1,this.rotateRight(i),t=this.root;break}r.red=!0,t=i,i=t.parent}void 0!==t&&(t.red=!1)}}function redBlackTreeRotateRight(e){var t=e.left;e.left=t.right,void 0!==t.right&&(t.right.parent=e),t.parent=e.parent,void 0===e.parent?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,t.right=e,e.parent=t}function redBlackTreeRotateLeft(e){var t=e.right;e.right=t.left,void 0!==t.left&&(t.left.parent=e),t.parent=e.parent,void 0===e.parent?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}function Uint31HashSet(e){this.buffer=void 0,this.size=0,this.maxFill=void 0,this.minFill=void 0,this.bufferSize=void 0,this.init(e)}function uint31HashSetInit(e){e||(e=Uint31HashSet.defaultInitialSize);var t=new ArrayBuffer(4*e);this.buffer=new Int32Array(t),this.size=0,this.maxFill=Math.floor(e*Uint31HashSet.loadFactor),this.minFill=this.maxFill>>2,this.bufferSize=e}function uint31HashSetClear(){this.init()}function uint31HashSetSet(e){e+=1,this.size>this.maxFill&&this.increaseSize();for(var t,i=e%this.bufferSize,r=i,n=void 0;0!==(t=this.buffer[r]);){if(t===e)return r;if(t<0&&(n=r,-t===e))break;if(++r===this.bufferSize&&(r=0),r===i)break}return this.size++,void 0!==n?(this.buffer[n]=e,n):(this.buffer[r]=e,r)}function uint31HashSetHas(e){e+=1;for(var t,i=e%this.bufferSize,r=i;0!==(t=this.buffer[r]);){if(t===e)return!0;if(-t===e)return!1;if(++r===this.bufferSize&&(r=0),r===i)return!1}return!1}function uint31HashSetGetPos(e){e+=1;for(var t,i=e%this.bufferSize,r=i;0!==(t=this.buffer[r]);){if(t===e)return r;if(-t===e)return;if(++r===this.bufferSize&&(r=0),r===i)return}}function uint31HashSetDelete(e){e+=1,this.size<this.minFill&&this.decreaseSize();for(var t,i=e%this.bufferSize,r=i;0!==(t=this.buffer[r]);){if(t===e)return this.buffer[r]=-t,this.size--,r;if(-t===e)return;if(++r===this.bufferSize&&(r=0),r===i)return}}function uint31HashSetDeleteAtPos(e,t){e+=1,this.buffer[t]=-e,this.size--,this.size<this.minFill&&this.decreaseSize()}function uint31HashSetForEach(e){if(0!==this.size){this.suspendMinFill();var t,i=this.buffer,r=this.bufferSize;for(t=0;t<r;++t){var n=i[t];if(n>0&&e(void 0,n-1),i!==this.buffer)break}if(t<r){var o=this.buffer;for(++t;t<r;++t){var s=i[t]-1;if(!(s<0)){var n=o[s];if(n>0&&e(void 0,n-1),o!==this.buffer){for(var a=t+1;a<r;++a)s=i[a]-1,s<0||(i[a]=o[s]);o=this.buffer}}}}this.resetMinFill()}}function uint31HashSetPushTo(e){for(var t=0,i=0;t<this.size;++i){var r=this.buffer[i];r>0&&(e.push(r-1),t++)}}function uint31HashSetGetList(){for(var e=new Array(this.size),t=0,i=0;t<this.size;++i){var r=this.buffer[i];r>0&&(e[t]=r-1,t++)}return e}function uint31HashSetExpectSize(e){this.maxFill>=e||(2*this.bufferSize*Uint31HashSet.loadFactor>=e?this.bufferSize*=2:this.bufferSize=Math.ceil(e/Uint31HashSet.loadFactor),this.resize())}function uint31HashSetSuspendMinFill(){this.minFill=0}function uint31HashSetResetMinFill(){this.minFill=this.maxFill>>2,this.size<this.minFill&&this.decreaseSize()}function uint31HashSetIncreaseSize(){this.bufferSize*=2,this.resize()}function uint31HashSetDecreaseSize(){if(!(this.bufferSize<16)){for(var e=this.minFill;this.size<e&&(this.bufferSize=this.bufferSize>>1,!(this.bufferSize<16));)e>>=1;this.resize()}}function uint31HashSetResize(){var e=this.buffer;this.maxFill=Math.floor(this.bufferSize*Uint31HashSet.loadFactor),this.minFill=this.maxFill>>2;var t=new ArrayBuffer(4*this.bufferSize);this.buffer=new Int32Array(t);var i=this.size;this.size=0;for(var r=0,n=e.length;r<n;++r){var o=e[r];if(!(o<=0)){for(var s,a=o%this.bufferSize;0!==(s=this.buffer[a]);)++a===this.bufferSize&&(a=0);if(this.size++,this.buffer[a]=o,e[r]=a+1,i===this.size)break}}}function IntHashMap(e){this.hashSet=new Uint31HashSet(e),this.values=this.makeValueArray(),
this.hashSetBuffer=this.hashSet.buffer,this.size=0}function intHashMapClear(){this.hashSet.clear(),this.values=this.makeValueArray(),this.hashSetBuffer=this.hashSet.buffer,this.size=0}function intHashMapMakeValueArray(){return new Array(this.hashSet.bufferSize)}function intHashMapSet(e,t){var i=this.hashSet.set(e);this.hashSetBuffer!==this.hashSet.buffer&&this.resize(),this.values[i]=t,this.size=this.hashSet.size}function intHashMapHas(e){return this.hashSet.has(e)}function intHashMapGet(e){var t=this.hashSet.getPos(e);if(void 0!==t)return this.values[t]}function intHashMapGetPos(e){return this.hashSet.getPos(e)}function intHashMapDelete(e){var t=this.hashSet.delete(e);this.hashSetBuffer!==this.hashSet.buffer&&this.resize(),void 0!==t&&(this.values[t]=0,this.size--)}function intHashMapForEach(e){if(0!==this.size){this.suspendMinFill();for(var t=this.hashSet.bufferSize,i=this.hashSet.buffer,r=0;r<t;++r){var n=i[r];if(n>0&&e(this.values[r],n-1),i!==this.hashSet.buffer)break}if(r<t){var o=this.hashSet.buffer;for(++r;r<t;++r){var s=i[r]-1;if(!(s<0)){var n=o[s];if(n>0&&e(this.values[s],n-1),o!==this.hashSet.buffer){for(var a=r+1;a<t;++a)s=i[a]-1,s<0||(i[a]=o[s]);o=this.hashSet.buffer}}}}this.resetMinFill()}}function intHashMapSuspendMinFill(){this.hashSet.suspendMinFill()}function intHashMapResetMinFill(){this.hashSet.resetMinFill(),this.hashSetBuffer!==this.hashSet.buffer&&this.resize()}function intHashMapExpectSize(e){this.hashSet.expectSize(e),this.hashSetBuffer!==this.hashSet.buffer&&this.resize()}function intHashMapResize(){if(this.hashSetBuffer!==this.hashSet.buffer){var e=this.values;this.values=this.makeValueArray();for(var t=this.size,i=0,r=0,n=this.hashSetBuffer.length;r<n;++r){var o=this.hashSetBuffer[r]-1;if(!(o<0)&&(this.values[o]=e[r],++i===t))break}this.hashSetBuffer=this.hashSet.buffer}}function IntHashMapUint(e,t){this.nBytes=this.getByteNumForMaxValue(e),this.IntHashMap(t)}function intHashMapUintMakeValueArray(){var e=new ArrayBuffer(this.nBytes*this.hashSet.bufferSize);return 1==this.nBytes?new Uint8Array(e):2==this.nBytes?new Uint16Array(e):new Int32Array(e)}function intHashMapUintGetByteNumForMaxValue(e){return void 0===e?4:e<256?1:e<65536?2:4}function intHashMapUintAdjustByteNumber(e,t){var i=this.getByteNumForMaxValue(e);if(this.nBytes!==i&&!(t&&this.nBytes>i)){for(var r=this.makeValueArray(),n=0,o=this.values.length;n<o;++n)r[n]=this.values[n];this.values=r}}function intHashMapUintInc(e,t){var i=this.hashSet.set(e);return this.hashSetBuffer!==this.hashSet.buffer&&this.resize(),this.size=this.hashSet.size,this.values[i]+=t}function intHashMapUintDec(e,t,i){var r=this.hashSet.getPos(e);if(void 0!==r){this.hashSetBuffer!==this.hashSet.buffer&&this.resize();var n=this.values[r]-=t;return n>0?n:(n<0&&(this.values[r]=0),i||(this.hashSet.deleteAtPos(e,r),this.hashSetBuffer!==this.hashSet.buffer&&this.resize()),this.size=this.hashSet.size,n)}}function IntHashPairMap(e){this.hashSet=new Uint31HashSet(e),this.values=this.makeValueArray(),this.values2=this.makeSecondValueArray(),this.hashSetBuffer=this.hashSet.buffer,this.size=0}function intHashPairMapClear(){this.IntHashMap_clear(),this.values2=this.makeSecondValueArray()}function intHashPairMapMakeValueArray(){return new Array(this.hashSet.bufferSize)}function intHashPairMapMakeSecondValueArray(){return new Array(this.hashSet.bufferSize)}function intHashPairMapSetSecond(e,t){var i=this.hashSet.set(e);this.hashSetBuffer!==this.hashSet.buffer&&this.resize(),this.values2[i]=t,this.size=this.hashSet.size}function intHashPairMapSetPair(e,t,i){var r=this.hashSet.set(e);this.hashSetBuffer!==this.hashSet.buffer&&this.resize(),this.values[r]=t,this.values2[r]=i,this.size=this.hashSet.size}function intHashPairMapGetSecond(e){var t=this.hashSet.getPos(e);if(void 0!==t)return this.values2[t]}function intHashPairMapGetPair(e){var t=this.hashSet.getPos(e);if(void 0!==t)return[this.values[t],this.values2[t]]}function intHashPairMapDelete(e){var t=this.hashSet.delete(e);this.hashSetBuffer!==this.hashSet.buffer&&this.resize(),void 0!==t&&(this.values[t]=0,this.values2[t]=0,this.size--)}function intHashPairMapForEachPair(e){if(0!==this.size){this.suspendMinFill();for(var t=this.hashSet.bufferSize,i=this.hashSet.buffer,r=0;r<t;++r){var n=i[r];if(n>0&&e(this.values[r],this.values2[r],n-1),i!==this.hashSet.buffer)break}if(r<t){var o=this.hashSet.buffer;for(++r;r<t;++r){var s=i[r]-1;if(!(s<0)){var n=o[s];if(n>0&&e(this.values[s],this.values2[s],n-1),o!==this.hashSet.buffer){for(var a=r+1;a<t;++a)s=i[a]-1,s<0||(i[a]=o[s]);o=this.hashSet.buffer}}}}this.resetMinFill()}}function intHashPairMapResize(){if(this.hashSetBuffer!==this.hashSet.buffer){var e=this.values,t=this.values2;this.values=this.makeValueArray(),this.values2=this.makeSecondValueArray();for(var i=this.size,r=0,n=0,o=this.hashSetBuffer.length;n<o;++n){var s=this.hashSetBuffer[n]-1;if(!(s<0)&&(this.values[s]=e[n],this.values2[s]=t[n],++r===i))break}this.hashSetBuffer=this.hashSet.buffer}}function IntHashPairMapUint(e,t){this.nBytes=this.getByteNumForMaxValue(e),this.IntHashPairMap(t)}function intHashPairMapUintIncAndGetSecond(e,t){var i=this.hashSet.set(e);return this.hashSetBuffer!==this.hashSet.buffer&&this.resize(),this.size=this.hashSet.size,this.values[i]+=t,this.values2[i]}function intHashPairMapUintDecAndGetSecond(e,t,i,r){var n=this.hashSet.getPos(e);if(void 0!==n){this.hashSetBuffer!==this.hashSet.buffer&&this.resize();var o=this.values[n]-=t;if(o>0)return r?void 0:this.values2[n];o<0&&(this.values[n]=0);var s=this.values2[n];return i?(this.size=this.hashSet.size,s):(this.values2[n]=0,this.hashSet.deleteAtPos(e,n),this.hashSetBuffer!==this.hashSet.buffer&&this.resize(),this.size=this.hashSet.size,s)}}function intHashPairMapUintGetSecondIfZeroCount(e,t){var i=this.hashSet.getPos(e);if(void 0!==i&&0===this.values[i]){var r=this.values2[i];return t&&(this.values[i]=0,this.values2[i]=0,this.hashSet.deleteAtPos(e,i),this.hashSetBuffer!==this.hashSet.buffer&&this.resize(),this.size=this.hashSet.size),r}}function IdStorage(){this.size=0,this.idList=[],this.iForEach=void 0,this.idSet=void 0}function idStorageHas(e){if(void 0!==this.idSet)return this.idSet.has(e);for(var t=0,i=this.size;t<i;++t)if(this.idList[t]==e)return!0;return!1}function idStorageSet(e){var t=this.idList.push(e);if(this.size++,void 0!==this.idSet)this.idSet.set(e,t-1);else if(this.size>IdStorage.minMapSize){this.idSet=new Map;for(var i=0,t=this.size;i<t;++i)this.idSet.set(this.idList[i],i)}}function idStorageDelete(e){var t;if(void 0===this.idSet)for(t=0,m=this.size;t<m&&this.idList[t]!=e;++t);else t=this.idSet.get(e),this.idSet.delete(e);if(void 0!==this.iForEach&&this.iForEach>t){var i=this.idList[this.size-1],r=this.idList[this.iForEach];this.idList[t]=r,this.idList[this.iForEach]=i,this.iForEach--,void 0!==this.idSet&&(this.idSet.set(i,this.iForEach),this.idSet.set(r,t))}else if(t!==this.size-1){var i=this.idList[this.size-1];this.idList[t]=i,void 0!==this.idSet&&this.idSet.set(i,t),this.iForEach===t&&this.iForEach--}this.idList.length--,this.size--}function idStorageForEach(e){for(this.iForEach=0;this.iForEach<this.size;++this.iForEach)e(!0,this.idList[this.iForEach]);this.iForEach=void 0}function idStoragePushTo(e){for(var t=0,i=this.size;t<i;++t)e.push(this.idList[t])}function idStorageGetList(){return this.idList.slice(0)}function IntIdStorage(){this.size=0,this.idList=void 0,this.hashSet=void 0,this.iForEachOrId=void 0}function intIdStorageHas(e){if(void 0!==this.hashSet)return this.hashSet.has(e);if(void 0!==this.idList){for(var t=0,i=this.size;t<i;++t)if(this.idList[t]==e)return!0;return!1}return this.iForEachOrId===e}function intIdStorageSet(e){if(this.size++,void 0!==this.hashSet)return void this.hashSet.set(e);if(void 0===this.idList)1===this.size?this.iForEachOrId=e:(this.idList=[this.iForEachOrId,e],this.iForEachOrId=void 0);else if(this.idList.push(e),this.size>IntIdStorage.minMapSize){this.hashSet=new Uint31HashSet(Math.ceil(this.size/IntIdStorage.initialLoadFactor));for(var t=0,i=this.size;t<i;++t)this.hashSet.set(this.idList[t]);this.idList=void 0}}function intIdStorageDelete(e){if(void 0!==this.hashSet)return this.hashSet.delete(e),void this.size--;if(void 0!==this.idList){var t;for(t=0,m=this.size;t<m&&this.idList[t]!=e;++t);if(void 0!==this.iForEachOrId&&this.iForEachOrId>t){var i=this.idList[this.size-1],r=this.idList[this.iForEachOrId];this.idList[t]=r,this.idList[this.iForEachOrId]=i,this.iForEachOrId--}else if(t!==this.size-1){var i=this.idList[this.size-1];this.idList[t]=i,this.iForEachOrId===t&&this.iForEachOrId--}return this.idList.length--,void this.size--}this.iForEachOrId=void 0,this.size=0}function intIdStorageForEach(e){if(void 0!==this.hashSet)return void this.hashSet.forEach(e);if(void 0!==this.idList){for(this.iForEachOrId=0;this.iForEachOrId<this.size;++this.iForEachOrId)e(!0,this.idList[this.iForEachOrId]);return void(this.iForEachOrId=void 0)}0!==this.size&&e(!0,this.iForEachOrId)}function intIdStoragePushTo(e){if(void 0!==this.hashSet)return void this.hashSet.pushTo(e);if(void 0===this.idList)0!==this.size&&e.push(this.iForEachOrId);else for(var t=0,i=this.size;t<i;++t)e.push(this.idList[t])}function intIdStorageGetList(){return void 0!==this.hashSet?this.hashSet.getList():void 0!==this.idList?this.idList.slice(0):0!==this.size?[this.iForEachOrId]:void 0}function IntBinaryTreeNode(e,t,i,r){this.IntIdStorage(),this.parent=t,this.left=void 0,this.right=void 0,this.prev=i,this.next=r,this.key=e,this.value=this}function DegenerateIntervalTree(e,t){this.RedBlackTree(e);var i=void 0===e&&!t;this.storageAllocate=i?this.intStorageAllocate:this.nonIntStorageAllocate,i&&(this.allocateTreeNode=this.allocateIntTreeNode),debugAllDegenerateIntervalTrees&&debugAllDegenerateIntervalTrees.push(this)}function degenerateIntervalTreeIntStorageAllocate(){return new IntIdStorage}function degenerateIntervalTreeNonIntStorageAllocate(){return new IdStorage}function degenerateIntervalTreeAllocateIntTreeNode(e,t,i,r){return new IntBinaryTreeNode(e,t,i,r)}function degenerateIntervalTreeInsertPoint(e,t){var i=this.insertKey(t);void 0===i.value&&(i.value=this.storageAllocate()),i.value.has(e)||i.value.set(e,!0)}function degenerateIntervalTreeRemovePoint(e,t){var i=this.RedBlackTree_find(t);void 0===i||this.compare(i.key,t)||void 0===i.value||i.value.has(e)&&(i.value.delete(e),0==i.value.size&&this.removeNode(i))}function degenerateIntervalTreeGetFirst(){var e=this.first;return e&&0!=e.value.size?e.value.getList():[]}function degenerateIntervalTreeGetFirstKey(){var e=this.first;if(void 0!==e)return e.key}function degenerateIntervalTreeFind(e){var t=this.RedBlackTree_find(e);return!t||this.compare(t.key,e)||0==t.value.size?[]:t.value.getList(0)}function degenerateIntervalTreeFindIntersections(e,t,i,r){var n=this.compare(e,t);if(0==n)return i||r?[]:this.find(e);if(n>0){var o=e;e=t,t=o}var s=[],a=this.RedBlackTree_find(e);i&&a&&!this.compare(a.key,e)&&(a=a.next);for(var d;a&&((d=this.compare(a.key,t))<0||!r&&0==d);)a.value.size>0&&a.value.pushTo(s),a=a.next;return s}function degenerateIntervalTreeFindContained(e,t,i,r){return this.findIntersections(e,t,i,r)}function degenerateIntervalTreeFindWithUpperBound(e,t,i,r,n,o){var s=this.compare(e,t);if(s>0){var a=e;e=t,t=a,s=-s}var d=this.compare(t,n);if(d>=0){if(d>0&&(t=n,(s=this.compare(e,t))>0))return[];o&&(r=!0)}return 0==s&&(i||r)?[]:this.findIntersections(e,t,i,r)}function degenerateIntervalTreeFindWithLowerBound(e,t,i,r,n,o){var s=this.compare(e,t);if(s>0){var a=e;e=t,t=a,s=-s}var d=this.compare(e,n);if(d<=0){if(d<0&&(e=n,(s=this.compare(e,t))>0))return[];o&&(i=!0)}return 0==s&&(i||r)?[]:this.findIntersections(e,t,i,r)}function degenerateIntervalTreeDebugGetValueDistribution(e){for(var t=0,i=0,r=0,n=0,o=0,s=0,a=this.first;a;a=a.next)s++,0!==a.value.size?(t+=a.value.size,void 0!==a.value.hashSet?(i+=a.value.hashSet.size,n+=a.value.hashSet.buffer.length):void 0!==a.value.idSet&&(r+=a.value.idSet.size)):o++;return{totalIds:t,totalIdsWithHash:i,totalIdsWithMap:r,totalHashBuffer:n,totalEmptyNodes:o,totalNodes:s}}function debugGetValueDistribution(){for(var e={totalIds:0,totalIdsWithHash:0,totalIdsWithMap:0,totalHashBuffer:0,totalEmptyNodes:0,totalNodes:0},t=0,i=debugAllDegenerateIntervalTrees.length;t<i;++t){var r=debugAllDegenerateIntervalTrees[t].debugGetValueDistribution();e.totalIds+=r.totalIds,e.totalIdsWithHash+=r.totalIdsWithHash,e.totalIdsWithMap+=r.totalIdsWithMap,e.totalHashBuffer+=r.totalHashBuffer,e.totalEmptyNodes+=r.totalEmptyNodes,e.totalNodes+=r.totalNodes}return e}function IndexerGarbageCollector(){this.timerId=void 0,this.scheduledTime=void 0,this.queue=new PathNodeQueue}function indexerGarbageCollectorScheduleGarbageCollection(e){void 0!==this.scheduledTime&&this.scheduledTime.getTime()-e.getTime()<IndexerGarbageCollector.collectionTimeStep||(void 0!==this.timerId&&clearTimeout(this.timerId),this.timerId=setTimeout(scheduleIndexerGarbageCollectionTask,e.getTime()-Date.now()),this.scheduledTime=e)}function indexerGarbageCollectorScheduleIndexDestroy(e){var t=new Date(Date.now()+IndexerGarbageCollector.indexTimeout);this.queue.add(e,"index",t.getTime()),this.scheduleGarbageCollection(t)}function indexerGarbageCollectorDescheduleIndexDestroy(e){this.queue.remove(e,"index")}function indexerGarbageCollectorScheduleTraceDeactivation(e){var t=new Date(Date.now()+IndexerGarbageCollector.tracingTimeout);this.queue.add(e,"tracing",t.getTime()),this.scheduleGarbageCollection(t)}function indexerGarbageCollectorDescheduleTraceDeactivation(e){this.queue.remove(e,"tracing")}function indexerGarbageCollectorExecuteGarbageCollection(e){this.timerId=void 0,this.scheduledTime=void 0;do{var t=this.queue.peek();if(void 0===t)return!0;if(t-Date.now()>IndexerGarbageCollector.collectionTimeStep)return this.scheduleGarbageCollection(new Date(t)),!0;var i=this.queue.pop(),r=i.pathNode;switch(i.type){case"index":r.indexer.destroyIndexAtNode(r);break;case"tracing":r.indexer.removePathNodeTracing(r)}}while(!e.timedOut());return!!this.queue.isEmpty()}function PathNodeQueue(){this.queue=new DegenerateIntervalTree(PathNodeQueue.stringCompare),this.byId=new Map}function pathNodeQueueGetPathNodeId(e,t){return e.pathId+":"+e.indexer.getId()+":"+t}function pathNodeQueueAdd(e,t,i){var r,n,o=this.getPathNodeId(e,t);return this.byId.has(o)&&(r=this.byId.get(o),n=r.expirationTime,this.queue.removePoint(o,n)),void 0!==r?r.expirationTime=i:this.byId.set(o,{pathNode:e,type:t,expirationTime:i}),this.queue.insertPoint(o,i),n}function pathNodeQueueRemove(e,t){var i=this.getPathNodeId(e,t);if(this.byId.has(i)){var r=this.byId.get(i);return this.queue.removePoint(i,r.expirationTime),this.byId.delete(i),r.expirationTime}}function pathNodeQueuePeek(){if(0!=this.byId.size)return this.queue.getFirstKey()}function pathNodeQueuePop(){if(0!=this.byId.size){var e=this.queue.getFirst();if(0!=e.length){var t=e[0],i=this.byId.get(t);return this.queue.removePoint(t,i.expirationTime),this.byId.delete(t),i}}}function pathNodeQueueIsEmpty(){return 0==this.byId.size}function InternalQCM(e){this.rootQueryCalcs=new Map,this.compCalcs=new Map,this.orderServices=new Map,this.pathIdAllocator=new InternalQCMPathIdAllocator,this.compression=new InternalQCMCompression(e,this.getRootPathId()),this.queue=new IndexerQueue,this.garbageCollector=new IndexerGarbageCollector,this.debugInitStoreObjects()}function internalQCMSchedulePathNode(e){this.queue.schedulePathNode(e)}function internalQCMScheduleIdentityUpdate(e){this.queue.scheduleIdentityUpdate(e)}function internalQCMScheduleCompCalc(e){this.queue.scheduleCompCalc(e)}function internalQCMScheduleOrderService(e){this.queue.scheduleOrderService(e)}function internalQCMScheduleCompleteIncrementalUpdate(e){this.queue.scheduleCompleteIncrementalUpdate(e)}function internalQCMScheduleDataElements(e){this.queue.scheduleDataElements(e)}function internalQCMIndexerIsScheduled(e){return this.queue.indexerIsScheduled(e)}function internalQCMExecuteScheduled(e,t){var i=this.queue.executeScheduled(e,t);return i&&this.compression.applyQueuedSimpleRelease(),i}function internalQCMRemoveIndexerFromQueues(e){this.queue.removeIndexerFromQueues(e)}function internalQCMScheduleIndexDestroy(e){this.garbageCollector.scheduleIndexDestroy(e)}function internalQCMDescheduleIndexDestroy(e){this.garbageCollector.descheduleIndexDestroy(e)}function internalQCMScheduleTraceDeactivation(e){this.garbageCollector.scheduleTraceDeactivation(e)}function internalQCMDescheduleTraceDeactivation(e){this.garbageCollector.scheduleTraceDeactivation(e)}function internalQCMExecuteGarbageCollection(e){return this.garbageCollector.executeGarbageCollection(e)}function internalQCMAllocatePathId(e,t){return this.pathIdAllocator.allocatePathId(e,t)}function internalQCMAllocatePathIdFromPath(e,t){return this.pathIdAllocator.allocatePathIdFromPath(e,t)}function internalQCMAllocateConcatPathId(e,t){return this.pathIdAllocator.allocateConcatPathId(e,t)}function internalQCMAllocatePathIdByPathId(e){this.pathIdAllocator.allocatePathIdByPathId(e)}function internalQCMGetPathId(e,t){return this.pathIdAllocator.getPathId(e,t)}function internalQCMReleasePathId(e){return this.pathIdAllocator.releasePathId(e)}function internalQCMDiffPathId(e,t){return this.pathIdAllocator.diffPathId(e,t)}function internalQCMGetRootPathId(){return this.pathIdAllocator.getRootPathId()}function internalQCMGetPathSortKey(e){return this.pathIdAllocator.getSortKey(e)}function internalQCMExtensionSortKeyRange(e){return this.pathIdAllocator.extensionSortKeyRange(e)}function internalQCMIsPrefixOf(e,t){return this.pathIdAllocator.isPrefixOf(e,t)}function internalQCMGetPathLength(e){return this.pathIdAllocator.getPathLength(e)}function internalQCMGetPrefix(e){return this.pathIdAllocator.getPrefix(e)}function internalQCMGetCommonPrefix(e){return this.pathIdAllocator.getCommonPrefix(e)}function internalQCMGetFirstAttrAfterPrefix(e,t){return this.pathIdAllocator.getFirstAttrAfterPrefix(e,t)}function internalQCMGetLastPathAttr(e){return this.pathIdAllocator.getLastPathAttr(e)}function internalQCMGetPathStrings(e){return this.pathIdAllocator.getPathStrings(e)}function internalQCMGetPathSuffix(e,t){return this.pathIdAllocator.getPathSuffix(e,t)}function internalQCMGetRootQueryCalc(e,t,i,r){if(e&&t&&i){r||(r=this.getRootPathId());var n,o=i.getId()+";"+t.getId()+";"+r;return this.rootQueryCalcs.has(o)?n=this.rootQueryCalcs.get(o):(n=t.newRootQueryCalc(i,r,o),this.rootQueryCalcs.set(o,n)),n.addQueryResult(e),n}}function internalQCMReleaseRootQueryCalc(e,t){if(t&&e&&!t.removeQueryResult(e)){var i=t.getQCMKey();t.destroy(),this.rootQueryCalcs.delete(i)}}function internalQCMGetCompCalc(e,t,i,r){if(e&&t&&i){r||(r=this.getRootPathId());var n,o=i.getId()+";"+t.getId()+";"+r;return this.compCalcs.has(o)?n=this.compCalcs.get(o):(n=t.newCompCalc(i,r,o),this.compCalcs.set(o,n)),n.addCompResult(e),n}}function internalQCMReleaseCompCalc(e,t){if(t&&e&&!t.removeCompResult(e)){var i=t.getQCMKey();t.destroy(),this.compCalcs.delete(i)}}function internalQCMGetOrderService(e,t){if(void 0!==t){var i,r=t.getId();return this.orderServices.has(r)?i=this.orderServices.get(r):(i=new OrderService(this),i.setData(t),this.orderServices.set(r,i)),i}}function internalQCMReleaseOrderService(e){if(e){var t=e.orderService;if(void 0!==t&&!t.removeOrderResult(e)){var i=t.dataObj.getId();this.orderServices.delete(i),t.destroy()}}}function internalQCMDebugInitStoreObjects(){debugInternalQCMStoreObjects&&(debugAllCompResults={},debugAllOrderResults={},debugAllIdentityResults={},debugAllQueryResults={},debugAllMergeIndexers={})}function DataElements(e){this.indexer=e,this.useDefaultIdentities=!1,this.rootDefaultEntry={pathId:e.rootPathNodeId,parentId:void 0},this.dataElements=new IntHashPairMapUint(255),this.countByPath=new IntHashMapUint,this.pendingRemovals=[],this.pendingBaseIdentities=new Map}function dataElementsUpdateNumPathNodes(e){this.dataElements.adjustByteNumber(e+1)}function dataElementsExpectAdditionalDataElementNum(e){this.dataElements.expectSize(this.dataElements.size+e)}function dataElementsAddNewDataElement(e,t,i,r,n,o){if(this.dataElements.has(t))return this.dataElements.inc(t,1),void this.setBaseIdentityForExistingNode(t,r);1===this.countByPath.inc(e,1)&&this.indexer.notifyPathHasDataElements(e);var s,a,d;void 0!==i&&(s=this.dataElements.getSecond(i),s=this.getNonDefaultElementEntry(i,s),void 0===(a=s.children)?(this.dataElements.inc(i,1),a=s.children=new Map,d=this.getNewDataElementPathChildren(i,e),a.set(e,d)):a.has(e)?d=a.get(e):(d=this.getNewDataElementPathChildren(i,e),a.set(e,d)),d.ids.set(t));var u=this.getEntryForNewElement(e,i,d,t,n,o);u=this.setBaseIdentityForNewNode(t,u,s,d,r),this.dataElements.setPair(t,1,u)}function dataElementsGetNewDataElementPathChildren(e,t){return new DataElementPathChildren(e,t)}function dataElementsGetEntryForNewElement(e,t,i){return void 0===i?this.rootDefaultEntry:i.childDefaultEntry}function dataElementsNewDataElementEntry(e,t){return{pathId:e,parent:t,identity:void 0,defaultIdentity:!0,children:void 0}}function dataElementsGetNonDefaultElementEntry(e,t){return void 0!==t.defaultIdentity?t:(t=this.newDataElementEntry(t.pathId,t.parent,t,e),t.identity=e,this.dataElements.setSecond(e,t),t)}function dataElementsIncRef(e){var t=this.dataElements.incAndGetSecond(e,1);return t?t:(assert(!1,"increasing reference count of non-exsistent element"),void this.dataElements.delete(e))}function dataElementsReleaseDataElement(e){var t=this.dataElements.decAndGetSecond(e,1,!0,!0);return void 0!==t&&(0===this.pendingRemovals.length&&this.indexer.qcm.scheduleDataElements(this),this.pendingRemovals.push(e),!0)}function dataElementsRemoveDataElement(e){var t=this.dataElements.getSecondIfZeroCount(e,!0);void 0!==t&&this.removeDataElementFromParent(e,t)}function dataElementsRemoveDataElementFromParent(e,t){var i=t.pathId;if(0===this.countByPath.dec(i,1)&&this.indexer.notifyPathHasNoDataElements(i),void 0!==t.parent){var r=this.dataElements.getSecond(t.parent),n=r.children.get(i).ids;if(1==n.size)1===r.children.size?(r.children=void 0,0===this.dataElements.dec(t.parent,1)&&this.removeDataElementFromParent(t.parent,r)):r.children.delete(i);else if(n.delete(e),1==n.size&&this.useDefaultIdentities){var o=this;n.forEach(function(e,t){o.verifyDefaultBaseIdentity(t,1)})}}}function dataElementsRemovePendingRemovals(){for(var e=0,t=this.pendingRemovals.length;e<t;++e){var i=this.pendingRemovals[e];this.removeDataElement(i)}this.pendingRemovals=[]}function dataElementsHasPendingRemovals(){return 0!==this.pendingRemovals.length}function dataElementsGetBaseIdentity(e){var t=this.dataElements.getSecond(e);return void 0===t.identity?e:t.identity}function dataElementsGetBaseIdentities(e){for(var t=[],i=0,r=e.length;i<r;++i){var n=e[i];if(void 0===n)t.push(void 0);else{var o=this.dataElements.getSecond(n);t.push(void 0===o.identity?n:o.identity)}}return t}function dataElementsSetBaseIdentityForNewNode(e,t,i,r,n){if(void 0===n)this.useDefaultIdentities&&i&&1==r.ids.size&&(t=this.newDataElementEntry(t.pathId,t.parent,t,e),t.identity=i.identity);else{if(!this.useDefaultIdentities&&n===e&&void 0===t.defaultIdentity)return t;t=this.newDataElementEntry(t.pathId,t.parent,t,e),t.defaultIdentity=!1,t.identity=n}if(this.useDefaultIdentities&&void 0!==r&&2==r.ids.size){var o=this;r.ids.forEach(function(t,i){i!=e&&o.verifyDefaultBaseIdentity(i,2)})}return t}function dataElementsAssignDefaultBaseIdentity(e){this.setBaseIdentityForExistingNode(e,void 0)}function dataElementsSetBaseIdentityForExistingNode(e,t){var i=this.dataElements.getSecond(e);if(void 0!==i){if(this.indexer.notificationRequired(i.pathId,0))return void this.addBasePendingIdentity(e,i.pathId,t);if(void 0===t){if(i.defaultIdentity!==!1)return;if(i.defaultIdentity=!0,void 0===i.parent)t=i.identity=e;else{var r=this.dataElements.getSecond(i.parent);t=this.useDefaultIdentities&&1==r.children.get(i.pathId).ids.size?r.identity:e}}else{if(!this.useDefaultIdentities&&t===e&&void 0===i.defaultIdentity)return;i.defaultIdentity!==!1&&(i=this.getNonDefaultElementEntry(e,i),i.defaultIdentity=!1)}i.identity!=t&&(i.identity=t,this.useDefaultIdentities&&this.updateSingleChildrenWithIdentity(i))}}function dataElementsUpdateSingleChildrenWithIdentity(e){if(void 0!==e.children){var t=this;e.children.forEach(function(e,i){var r=e.ids;1==r.size&&r.forEach(function(e,i){t.verifyDefaultBaseIdentity(i,1)})})}}function dataElementsVerifyDefaultBaseIdentity(e,t){if(this.useDefaultIdentities){var i=this.dataElements.getSecond(e);if(i.defaultIdentity!==!1&&void 0!==i.parent){if(this.indexer.notificationRequired(i.pathId,0))return void this.addBasePendingIdentity(e,i.pathId,void 0,!0);var r;if(t>1){if(void 0===i.defaultIdentity||i.identity===e)return;r=i.identity=e}else{i=this.getNonDefaultElementEntry(e,i);var n=this.dataElements.getSecond(i.parent);if(i.identity===n.identity)return;r=i.identity=n.identity}this.updateSingleChildrenWithIdentity(i)}}}function dataElementsAddBasePendingIdentity(e,t,i,r){var n;this.pendingBaseIdentities.has(e)?r||(n=this.pendingBaseIdentities.get(e),n.identity=i,penidngEntry.verify=void 0):(n=r?{pathId:t,verify:!0}:{pathId:t,identity:i},this.pendingBaseIdentities.set(e,n)),this.indexer.scheduleIdentityUpdate()}function dataElementsHasPendingBaseIdentities(){return this.pendingBaseIdentities.size>0}function dataElementsCreateBaseIdentityNotifications(){if(0!=this.pendingBaseIdentities.size){var e,t,i=new Map,r=this;return this.pendingBaseIdentities.forEach(function(n,o){var s=r.dataElements.getSecond(o);if(void 0!==s&&(!n.verify||s.defaultIdentity!==!1)){var a=n.verify?void 0:n.identity,d=!1;return void 0===a&&(d=!0,a=void 0===s.parent||r.dataElementHasSiblings(o)?o:r.getBaseIdentity(s.parent)),a===s.identity?void(s.defaultIdentity=d):void(d&&a===o&&void 0===s.defaultIdentity||(s.pathId!=e&&(i.has(s.pathId)?t=i.get(s.pathId):(t={elementIds:[],identities:[]},i.set(s.pathId,t)),e=s.pathId),t.elementIds.push(o),t.identities.push(a)))}}),this.pendingBaseIdentities=new Map,i}}function dataElementsSetNotifiedBaseIdentities(e,t){for(var i=0,r=e.length;i<r;++i){var n=e[i],o=t[i],s=this.dataElements.getSecond(n);s=this.getNonDefaultElementEntry(n,s),s.identity=o,this.useDefaultIdentities&&void 0!==s.children&&this.updateSingleChildrenWithIdentity(s)}}function dataElementsHasEntry(e){return this.dataElements.has(e)}function dataElementsGetEntry(e){return this.dataElements.getSecond(e)}function dataElementsGetParentId(e){var t=this.dataElements.getSecond(e);if(void 0!==t)return t.parent}function dataElementsGetPathId(e){var t=this.dataElements.getSecond(e);if(void 0!==t)return t.pathId}function dataElementsDataElementHasSiblings(e){var t=this.dataElements.getSecond(e);if(!t)return!1;if(void 0===t.parent)return!0;var i=this.dataElements.getSecond(t.parent);return i.children.get(t.pathId).ids.size>1}function dataElementsGetNumDirectChildDataElements(e,t){var i=this.dataElements.getSecond(e);return void 0!==i&&void 0!==i.children&&i.children.has(t)?i.children.get(t).ids.size:0}function dataElementsGetDirectChildDataElements(e,t){var i=this.dataElements.getSecond(e);if(void 0!==i&&void 0!==i.children&&i.children.has(t)){var r=i.children.get(t).ids,n=[];return r.forEach(function(e,t){n.push(t)}),n}}function dataElementsGetDirectChildDataElementsAsObj(e,t){var i=this.dataElements.getSecond(e);if(void 0!==i&&void 0!==i.children&&i.children.has(t))return i.children.get(t).ids}function dataElementsHasDirectChildDataElements(e,t){var i=this.dataElements.getSecond(e);return!(void 0===i||void 0===i.children||!i.children.has(t))}function dataElementsGetAllDominatedDataElements(e,t){void 0===t&&(t=[]);var i;if(!(i=this.dataElements.getSecond(e))||!(i=i.children))return t;var r=this;return i.forEach(function(e,i){e.ids.forEach(function(e,i){t.push(i),r.getAllDominatedDataElements(i,t)})}),t}function dataElementsGetChildDataElements(e,t,i){for(var r=[],n=[],o=[],s=0,a=t.length;s<a;++s){var d=t[s],u=this.dataElements.getSecond(d);void 0===u.children?r.push(d):(n.push(d),o.push(u))}if(0==n.length)return r;var h,l=[];for(h=e;h>i;h=this.indexer.qcm.getPrefix(h))this.countByPath.has(h)&&l.push(h);this.indexer.pathHasOperands(i,!0)&&l.push(i);for(var c,p=0,f=this,s=l.length-1;s>=0;--s){h=l[s];for(var v=h===i||this.indexer.pathHasOperands(i,!0),g=p,a=n.length;g<a;++g){var m=o[g];m.children.has(h)&&(c=m.children.get(h),g!=p&&(n[g]=n[p],o[g]=o[p]),p++,h!=e||v?c.ids.forEach(function(e,t){m=f.dataElements.getSecond(t),void 0===m.children?r.push(t):(n.push(t),o.push(m),v&&a++)}):c.ids.forEach(function(e,t){r.push(t)}))}}return r=cconcat(r,n.slice(p))}function dataElementsLowerDataElementsTo(e,t){if(0==t.length)return e;for(var i=this.dataElements,r=0,n=e.length;r<n;++r){var o=e[r];if(i.has(o)){var s=i.getSecond(o).children;if(void 0!==s)for(var a=0,d=t.length;a<d;++a){var u=t[a];if(s.has(u)){var h=s.get(u);h.ids.forEach(function(t,i){e.push(i)})}}}}return e}function dataElementsRaiseToPath(e,t){for(var i;(i=this.dataElements.getSecond(e)).pathId>t;)e=i.parent;return e}function dataElementsRaiseExactlyToPath(e,t){for(var i;(i=this.dataElements.getSecond(e)).pathId>t;)e=i.parent;return i.pathId==t?e:void 0}function dataElementsRaiseAllToPath(e,t){for(var i=[],r=0,n=e.length;r<n;++r){for(var o,s=e[r];(o=this.dataElements.getSecond(s)).pathId>t;)s=o.parent;i.push(s)}return i}function dataElementsGetLowestParentWithSiblings(e,t){if(e===t)return e;var i=this.dataElements.getSecond(e);for(void 0===t&&(t=0);e>t;){var r=i;if(i=this.dataElements.getSecond(r.parent),void 0===i.parent||i.children.get(r.pathId).ids.size>1)return r.parent;e=r.parent}return t}function dataElementsFilterDataElementsUnderPathId(e,t){if(void 0===t)return e;for(var i=[],r=0,n=e.length;r<n;++r){var o=e[r],s=this.dataElements.getSecond(o);void 0!==s&&s.pathId>t&&i.push(o)}return i}function DataElementPathChildren(e,t){this.childDefaultEntry={parent:e,pathId:t},this.ids=new Uint31HashSet}function MergeDataElements(e){this.DataElements(e),this.useDefaultIdentities=!1,this.rootDefaultEntry=new IntHashMap(4)}function mergeDataElementsGetNewDataElementPathChildren(e,t){return new MergeDataElementPathChildren(e,t)}function mergeDataElementsGetEntryForNewElement(e,t,i,r,n,o){if(void 0!==o&&o!==r)return this.newInitialDataElementEntry(e,t,n,o);var s=void 0===t?this.rootDefaultEntry:i.childDefaultEntry,a=s.get(n);return a?a:(a={pathId:e,parent:t,groupId:n},s.set(n,a),a)}function mergeDataElementsNewInitialDataElementEntry(e,t,i,r){return{pathId:e,parent:t,identity:void 0,defaultIdentity:!1,children:void 0,groupId:i,sourceId:r}}function mergeDataElementsNewDataElementEntry(e,t,i,r){return void 0!==i.defaultIdentity?i:{pathId:i.pathId,parent:i.parent,identity:void 0,defaultIdentity:!1,children:void 0,groupId:i.groupId,sourceId:r}}function mergeDataElementsGetGroupId(e){var t=this.dataElements.getSecond(e);if(void 0!==t)return t.groupId}function mergeDataElementsGetSourceId(e){var t=this.dataElements.getSecond(e);if(void 0!==t)return void 0===t.sourceId?e:t.sourceId}function mergeDataElementsFilterTranslated(e,t){for(var i,r,n=new Map,o=0,s=e.length;o<s;++o){var a=e[o],d=this.dataElements.getSecond(a);void 0!==d&&void 0!==d.sourceId&&d.sourceId!==a&&(d.groupId!==i&&(i=d.groupId,n.has(i)?r=n.get(i):(r={source:[],dominating:[]},n.set(i,r))),r.source.push(d.sourceId),r.dominating.push(d.pathId===t?d.parent:a))}return n}function MergeDataElementPathChildren(e,t){this.childDefaultEntry=new IntHashMap(4),this.ids=new Uint31HashSet}function mergeArrays(e,t,i,r){r||(r=0);for(var n=r,o=t.length,s=0,a=e,d=e.length,u=n,h=[];u<d||s<o;)if(u==d&&a!=e&&(u=n,a=e,d=e.length),u<d&&void 0==a[u])u++;else if(s<o&&void 0==t[s])s++;else{if(s==o||u<d&&i(a[u],t[s])<=0){if(a!=e||n!=u){var l;(l=e[n])&&(a.push(l),d++),e[n]=a[u],a[u]=void 0}u++}else{var l;(l=e[n])&&(a==e?(a=h,u=0,d=1,a.push(l)):(a.push(l),d++)),e[n]=t[s],s++}n++}n<e.length&&(e.length=n)}function CompressedValue(e,t,i){this.indexer=e,this.compression=e.qcm.compression,this.pathId=t,
this.dataElementId=i,this.numElements=0,this.numRootElements=0,this.xor=0,this.quickCompression="",this.fullCompression=void 0,this.fullCompressionNrRequests=0,this.elements={}}function compressedValueDestroy(){this.destroySequences();for(var e in this.elements){var t=this.elements[e];for(var i in t)"number"!=i&&this.compression.releasePath(i,t[i].simple)}}function compressedValueUpdateSimpleElement(e,t,i,r,n){if(!n)return this.removeSimpleElement(e,t);var o;(o=this.elements[t])||(o=this.elements[t]={});var s;if((s=o[e])||(s=o[e]={},o.number?o.number++:o.number=1),s.simple!=n){s.simple?(this.compression.releasePath(e,s.simple),this.xor=this.xor^s.quick,void 0!==this.fullCompression&&s.sequencePos>=0&&this.modifiedInSequence(s.sequenceId,s.sequencePos,!1)):(this.numElements++,e==this.compression.rootPathId&&this.numRootElements++,void 0!==this.fullCompression&&this.addToFullCompression(e,t,s)),s.simple=n;var a=this.compression.path(e,n);s.quick=a[0],s.value=a[1],this.xor=this.xor^s.quick,e===this.compression.rootPathId&&1===this.numElements?this.quickCompression=s.value:this.quickCompression=this.numElements+":"+this.xor}}function compressedValueRemoveSimpleElement(e,t){var i;if(i=this.elements[t]){var r;(r=i[e])&&(this.compression.releasePath(e,r.simple),this.xor=this.xor^r.quick,void 0!==this.fullCompression&&this.removeFromSequence(r),delete i[e],--i.number||delete this.elements[t],this.numElements--,e==this.compression.rootPathId&&this.numRootElements--,1===this.numElements&&this.numRootElements?this.quickCompression=r.value:this.quickCompression=this.numElements+":"+this.xor)}}function compressedValueCompleteUpdate(){void 0!==this.fullCompression&&this.sortAndCompressModifiedSequences()}function compressedValueGetCompression(){return"number"==typeof this.quickCompression?[this.quickCompression,this.quickCompression]:[this.quickCompression,this.fullCompression]}function compressedValueGetFullCompression(){return"number"==typeof this.quickCompression?this.quickCompression:this.fullCompression}function compressedValueHasFullCompression(){return void 0!==this.fullCompression}function compressedValueRequestFullCompression(){if(this.fullCompressionNrRequests++,void 0!==this.fullCompression)return this.fullCompression;this.sequences={},this.sequences[this.dataElementId]=[];var e=this.indexer.qcm;for(var t in this.elements){var i=this.elements[t];for(var r in i)if("number"!=r){var n=i[r];n.pathSortKey=e.getPathSortKey(r),n.dataElementId=t,this.addToSequences(n)}}return this.sortAndCompressAllSequences(),this.modifiedSequences={},this.fullCompression}function compressedValueAddToFullCompression(e,t,i){i.pathSortKey=this.indexer.qcm.getPathSortKey(e),i.dataElementId=t,this.addToSequences(i)}function compressedValueGetSequenceId(e){return e==this.dataElementId?e:this.indexer.dataElements.getLowestParentWithSiblings(e,this.dataElementId)}function compressedValueAddToSequences(e){var t=this.getSequenceId(e.parentId?e.parentId:e.dataElementId);if(!this.sequences[t]){this.sequences[t]=[];var i=this.indexer.dataElements.getEntry(t);this.addToSequenceParents(i.parent,i.pathId);var r={dataElementId:t,parentId:i.parent,pathId:i.pathId},n=this.indexer.qcm.diffPathId(i.pathId,this.pathId);r.pathSortKey=this.indexer.qcm.getPathSortKey(n),this.addToSequences(r),this.compoundElements||(this.compoundElements={}),this.compoundElements[t]=r}if(e.sequenceId=t,void 0===this.fullCompression)this.sequences[t].push(e);else{var o=this.getSeqModEntry(t,!0);o.added.push(e),e.sequencePos=-o.added.length}}function compressedValueAddToSequenceParents(e,t){this.sequenceParents||(this.sequenceParents={});var i;if(i=this.sequenceParents[e]){if(i[t])return;i[t]=!0,i.number++}else i=this.sequenceParents[e]={number:1},i[t]=!0;if(void 0!==this.fullCompression)for(var r=this.extractExistingSequenceEntries(e,t),n=0,o=r.length;n<o;++n)this.addToSequences(r[n])}function compressedValueExtractExistingSequenceEntries(e,t){for(var i=this.indexer.getDataElements();!this.sequences[e];)e=i.getParentId(e);var r=this.sequences[e],n=r.length;t=this.indexer.qcm.diffPathId(t,this.pathId);var o=this.indexer.qcm.extensionSortKeyRange(t),s=o[0],a=binarySearch2(r,s,function(e,t){return e.pathSortKey-t},0,n-1),d=[],u=o[1];if(a<n&&void 0!==r[a]&&r[a].pathSortKey<=u){this.modifiedInSequence(e,a,!0);do{var h;d.push(h=r[a]),h.sequenceId=void 0,r[a]=void 0,a++}while(a<n&&(void 0===r[a]||r[a].pathSortKey<=u))}var l=this.getSeqModEntry(e);if(!l||!l.added.length)return d;for(a=0,n=l.added.length;a<n;++a){var h=l.added[a];h.pathSortKey>=s&&h.pathSortKey<=u&&(d.push(h),h.sequenceId=void 0,r[a]=void 0)}return d}function compressedValueCheckMultipleChildren(e,t){var i=this.indexer.getDataElements();if(!(i.getNumDirectChildDataElements(e,t)>1)){var r;if(this.sequenceParents&&(r=this.sequenceParents[e])&&r[t]&&(delete r[t],--r.number||delete this.sequenceParents[e],children)){var n;children.ids.forEach(function(e,t){n=t});var o=this.removeSequence(n);if(o.length)for(var s=0,a=o.length;s<a;++s)this.addToSequences(o[s])}}}function compressedValueRemoveFromSequence(e){if(e.sequenceId)if(e.sequencePos<0){var t=this.getSeqModEntry(e.sequenceId);t.added[-e.sequencePos-1]=void 0}else{var i=this.sequences[e.sequenceId];this.modifiedInSequence(e.sequenceId,e.sequencePos,!0),i[e.sequencePos]=void 0}}function compressedValueModifiedInSequence(e,t,i){var r=this.getSeqModEntry(e,!0);if(i&&r.resequencePos>t&&(r.resequencePos=t),!(t>=r.compressPos)){for(var n=this.sequences[e],o=r.compressPos-1;o>=t;--o)this.compression.releaseNext(o?n[o-1].prefix:0,n[o].value);r.compressPos=t}}function compressedValueGetSeqModEntry(e,t){var i;return(i=this.modifiedSequences[e])||!t?i:(i=this.modifiedSequences[e]={added:[]},i.resequencePos=i.compressPos=this.sequences[e]?this.sequences[e].length:0,this.newModifiedSequences&&this.newModifiedSequences.push(e),i)}function compressedValueDestroySequences(){if(void 0!==this.fullCompression){for(var e in this.sequences)this.releaseSequence(e);delete this.sequences,delete this.sequenceParents,delete this.modifiedSequences,delete this.compoundElements}}function compressedValueReleaseSequence(e){for(var t=this.getSeqModEntry(e),i=this.sequences[e],r=(t?t.compressPos:i.length)-1;r>=0;--r)this.compression.releaseNext(r?i[r-1].prefix:0,i[r].value)}function compressedValueDeactivateFullCompression(){if(void 0!==this.fullCompression&&0===--this.fullCompressionNrRequests){this.destroySequences();for(var e in this.elements){var t=this.elements[e];delete t.sequenceId,delete t.sequencePos,delete t.prefix,delete t.dataElementId,delete t.pathSortKey}this.fullCompression=void 0}}function compressedValueRemoveSequence(e){var t=this.sequences[e],i=[];if(!t)return i;if(t.length){this.releaseSequence(e);for(var r=0,n=t.length;r<n;++r)t[r]&&i.push(t[r])}var o=this.getSeqModEntry(e);if(o){var s;if((s=o.added).length)for(var r=0,n=s.length;r<n;++r)s[r]&&i.push(s[r])}if(delete this.sequences[e],e===this.dataElementId)return assert(void 0===this.compoundElements||!(e in this.compoundElements)),this.fullCompression=0,i;var a=this.compoundElements[e];return this.removeFromSequence(a),this.checkMultipleChildren(a.parentId,a.pathId),delete this.compoundElements[e],i}function compressedValueEntryCompFuncByValue(e,t){if(!e)return-1;if(!t)return 1;var i;return(i=e.pathSortKey-t.pathSortKey)?i:e.value-t.value}function compressedValueSortAndCompressAllSequences(){var e,t=Object.keys(this.sequences);(e=t.length)>1&&t.sort(function(e,t){return t-e});for(var i=0;i<e;++i){var r=t[i],n=this.sequences[r];n.length>1&&n.sort(this.entryCompFuncByValue),this.compressSequence(r,0)}}function compressedValueSortAndCompressModifiedSequences(){var e,t=Object.keys(this.modifiedSequences);(e=t.length)>1&&t.sort(function(e,t){return t-e});for(var i=0;i<e;++i){this.newModifiedSequences=[];var r=t[i],n=this.modifiedSequences[r],o=n.added;o.length>1&&o.sort(this.entryCompFuncByValue);var s=this.sequences[r];if(o[0]&&this.modifiedInSequence(r,binarySearch2(s,o[0],this.entryCompFuncByValue,0,n.resequencePos-1),!0),mergeArrays(s,o,this.entryCompFuncByValue,n.resequencePos),s.length?this.compressSequence(r,n.compressPos):this.removeSequence(r),this.newModifiedSequences.length)for(var a=function(e,t){return t-e},d=0,u=this.newModifiedSequences.length;d<u;++d){var h=this.newModifiedSequences[d];t.splice(binarySearch2(t,h,a,i),0,h),e++}}this.modifiedSequences={},this.newModifiedSequences=void 0}function compressedValueCompressSequence(e,t){var i=this.sequences[e];if(!(t>=i.length)){for(var r=t?i[t-1].prefix:0,n=t,o=i.length;n<o;++n){var s=i[n];r=s.prefix=this.compression.next(r,s.value),s.sequencePos=n}if(e==this.dataElementId)this.fullCompression=r;else{var a=this.compoundElements[e];if(a.value==r)return;if(a.value=r,void 0!==this.fullCompression&&a.sequencePos>=0){this.removeFromSequence(a);var d=this.getSeqModEntry(a.sequenceId);d.added.push(a)}}}}function InternalSubTree(e,t,i,r,n){this.indexer=e,this.pathId=t,this.dataElementId=i,this.monitors=new Map,this.elements=new Map,this.numElements=0,this.numCompressionRequests=0,this.numFullCompressionRequests=0,void 0!==r&&this.addMonitor(r,n)}function internalSubTreeDestroy(){this.clear()}function internalSubTreeClear(){this.compressedValue&&(this.compressedValue.destroy(),this.compressedValue=void 0),this.numCompressionRequests&&(this.simpleCompressedValue=0);var e,t=0,i=!!this.numCompressionRequests;if(this.monitors.size>this.numCompressionRequests&&(e=[],this.monitors.forEach(function(t,i){"boolean"!=typeof t&&e.push(t)}),t=e.length),0!==t||i){var r=this;this.elements.forEach(function(n,o){n.forEach(function(n,s){if(0!==t)for(var a=0;a<t;++a)e[a].removeSimpleElement(o,s);if(i){var d=n.compressedValue;r.compression.releaseSimpleCompressed(d)}})})}this.elements=new Map,this.numElements=0}function internalSubTreeClearSimpleCompressedValues(){var e=this;this.elements.forEach(function(t,i){t.forEach(function(t,i){t.compressedValue&&(e.compression.releaseSimpleCompressed(t.compressedValue),t.compressedValue=void 0)})})}function internalSubTreeIsSimple(){if(1!=this.numElements)return!1;var e=this.indexer.getRootPathId();return this.elements.has(e)&&1==this.elements.get(e).size}function internalSubTreeIsEmpty(){return 0==this.numElements}function internalSubTreeAddMonitor(e,t){if(!this.monitors.has(e)){if(!t)return void this.addCompressionMonitor(e);this.monitors.set(e,t),0!==this.numElements&&(this.elements.forEach(function(e,i){e.forEach(function(e,r){t.updateSimpleElement(i,r,e.type,e.key)})}),t.completeUpdate())}}function internalSubTreeAddCompressionMonitor(e){if(this.monitors.set(e,!1),!(++this.numCompressionRequests>1||(this.simpleCompressedValue=0,this.compression=this.indexer.qcm.compression,this.isEmpty()))){var t=this;if(this.isSimple()){var i=this.elements.get(this.indexer.getRootPathId());i.forEach(function(e,i){e.compressedValue?t.simpleCompressedValue=e.compressedValue:t.simpleCompressedValue=e.compressedValue=t.compression.simple(e.type,e.key)})}else this.compressedValue=new CompressedValue(this.indexer,this.pathId,this.dataElementId),this.elements.forEach(function(e,i){e.forEach(function(e,r){e.compressedValue||(e.compressedValue=t.compression.simple(e.type,e.key)),t.compressedValue.updateSimpleElement(i,r,e.type,e.key,e.compressedValue)})}),this.compressedValue.completeUpdate()}}function internalSubTreeRemoveMonitor(e){var t=this.monitors.get(e);if(void 0!==t)return this.monitors.delete(e),"boolean"!=typeof t?void this.elements.forEach(function(e,i){e.forEach(function(e,r){t.removeSimpleElement(i,r)})}):void(--this.numCompressionRequests?t===!0&&!--this.numFullCompressionRequests&&this.compressedValue&&this.compressedValue.deactivateFullCompression():(this.numFullCompressionRequests=0,this.compressedValue&&(this.compressedValue.destroy(),this.compressedValue=void 0),this.simpleCompressedValue=0,this.clearSimpleCompressedValues()))}function internalSubTreeGetMonitorIds(){return this.monitors}function internalSubTreeUpdateSimpleElement(e,t,i,r,n){e=this.indexer.qcm.diffPathId(e,this.pathId),"object"==typeof r&&(r=r.simpleCopy());var o,s;this.elements.has(e)?o=this.elements.get(e):(o=new Map,this.elements.set(e,o)),o.has(t)?(s=o.get(t),s.type=i,s.key=r):(s={type:i,key:r},o.set(t,s),this.numElements++),this.monitors.size>this.numCompressionRequests&&this.monitors.forEach(function(n,o){"boolean"!=typeof n&&n.updateSimpleElement(e,t,i,r)}),this.numCompressionRequests&&(n?this.compression.reallocateSimple(n):n=this.compression.simple(i,r),s.compressedValue&&this.compression.releaseSimpleCompressed(s.compressedValue),s.compressedValue=n,this.isSimple()?this.simpleCompressedValue=n:(this.compressedValue||(this.compressedValue=new CompressedValue(this.indexer,this.pathId,this.dataElementId),this.simpleCompressedValue=0),this.compressedValue.updateSimpleElement(e,t,i,r,n)))}function internalSubTreeRemoveSimpleElement(e,t){e=this.indexer.qcm.diffPathId(e,this.pathId);var i,r;if(void 0!==(i=this.elements.get(e))&&void 0!==(r=i.get(t))&&(r.compressedValue&&this.compression.releaseSimpleCompressed(r.compressedValue),this.numElements--,1===i.size?this.elements.delete(e):i.delete(t),this.monitors.size>this.numCompressionRequests&&this.monitors.forEach(function(i,r){"boolean"!=typeof i&&i.removeSimpleElement(e,t)}),this.numCompressionRequests))if(this.isEmpty())this.compressedValue?(this.compressedValue.destroy(),this.compressedValue=void 0):this.simpleCompressedValue=0;else if(this.isSimple()){this.compressedValue&&(this.compressedValue.destroy(),this.compressedValue=void 0);var n=this.elements.get(this.indexer.getRootPathId()),o=this;n.forEach(function(e,t){o.simpleCompressedValue=e.compressedValue})}else this.compressedValue.removeSimpleElement(e,t)}function internalSubTreeCompleteUpdate(e){if(void 0!==e){var t=this.monitors.get(e);if(void 0===t)return;"boolean"==typeof t?this.compressedValue&&(this.numFullCompressionRequests>0&&!this.compressedValue.hasFullCompression()?this.compressedValue.requestFullCompression():this.compressedValue.completeUpdate()):t.completeUpdate()}else this.numCompressionRequests&&this.compressedValue&&(this.numFullCompressionRequests>0&&!this.compressedValue.hasFullCompression()?this.compressedValue.requestFullCompression():this.compressedValue.completeUpdate()),this.monitors.size>this.numCompressionRequests&&this.monitors.forEach(function(e,t){"boolean"!=typeof e&&e.completeUpdate()})}function internalSubTreeGetCompression(){return void 0===this.compressedValue?[this.simpleCompressedValue,this.simpleCompressedValue]:this.compressedValue.getCompression()}function internalSubTreeGetFullCompression(){return void 0===this.compressedValue?this.simpleCompressedValue:this.compressedValue.getFullCompression()}function internalSubTreeSetFullCompression(e){if(this.monitors.get(e)===!1&&(this.monitors.set(e,!0),!(++this.numFullCompressionRequests>1)))return this.compressedValue&&this.compressedValue.requestFullCompression(),this.getCompression()}function internalSubTreeUnsetFullCompression(e){this.monitors.get(e)===!0&&(this.monitors.set(e,!1),--this.numFullCompressionRequests>0||this.compressedValue&&this.compressedValue.deactivateFullCompression())}function MinMaxHeap(e){this.comparator=e,this.comparatorInfo=void 0,this.heap=[void 0]}function minMaxHeapSetComparatorInfo(e){this.comparatorInfo=e}function minMaxHeapGetComparatorInfo(){return this.comparatorInfo}function minMaxHeapClear(){this.heap=[void 0]}function minMaxHeapIsEmpty(){return 1===this.heap.length}function minMaxHeapGetSize(){return this.heap.length-1}function minMaxHeapGetMin(){return this.heap[1]}function minMaxHeapGetMax(){switch(this.heap.length){case 1:return;case 2:return this.heap[1];case 3:return this.heap[2];default:return this.compare(2,3)>0?this.heap[2]:this.heap[3]}}function minMaxHeapCompare(e,t){return this.comparator(this.heap[e],this.heap[t],this.comparatorInfo)}function minMaxHeapSwap(e,t){var i=this.heap[e];this.heap[e]=this.heap[t],this.heap[t]=i}function minMaxHeapAdd(e){this.assignPos(this.heap.length,e),this.bubbleUp(e,this.heap.length-1)}function minMaxHeapRemovePos(e){var t=this.popLastPos();e<this.heap.length&&(this.assignPos(e,t),this.trickleDown(e))}function minMaxHeapBubbleUp(e,t){var i=t>>1;MinMaxHeap.isOnMinLevel(t)?i>0&&this.compare(t,i)>0?(this.swap(t,i),this.bubbleUpMax(i)):this.bubbleUpMin(t):i>0&&this.compare(t,i)<0?(this.swap(t,i),this.bubbleUpMin(i)):this.bubbleUpMax(t)}function minMaxHeapIsOnMinLevel(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e-=e>>1&1431655765,e=(e>>2&858993459)+(858993459&e),e=(e>>4)+e&252645135,e+=e>>8,e+=e>>16,1==(1&e)}function minMaxHeapBubbleUpMin(e){var t=e>>2;t>0&&this.compare(e,t)<0&&(this.swap(e,t),this.bubbleUpMin(t))}function minMaxHeapBubbleUpMax(e){var t=e>>2;t>0&&this.compare(e,t)>0&&(this.swap(e,t),this.bubbleUpMax(t))}function minMaxHeapAssignPos(e,t){this.heap[e]=t}function minMaxHeapPopLastPos(){return this.heap.pop()}function minMaxHeapPopMin(){if(this.heap.length>2){var e=this.heap[1];return this.assignPos(1,this.popLastPos()),this.trickleDownMin(1),e}return 2===this.heap.length?this.popLastPos():void 0}function minMaxHeapPopMax(){if(this.heap.length>=4){var e=this.getMaxIndex([2,3]);if(4===this.heap.length&&3===e)return this.popLastPos();var t=this.heap[e];return this.assignPos(e,this.popLastPos()),this.trickleDownMax(e),t}return this.heap.length>=2?this.popLastPos():void 0}function minMaxHeapTrickleDown(e){MinMaxHeap.isOnMinLevel(e)?this.trickleDownMin(e):this.trickleDownMax(e)}function minMaxHeapTrickleDownMin(e){var t=e>>1,i=e>>2;if(i>1&&this.compare(e,i)<0)return this.swap(e,i),void this.bubbleUpMin(i);for(t>1&&this.compare(e,t)>0&&(this.swap(e,t),this.bubbleUpMax(t));2*e<this.heap.length;){var r=this.getMinIndex([2*e,2*e+1,4*e,4*e+1,4*e+2,4*e+3]);if(this.compare(r,e)>=0)break;if(this.swap(r,e),!(r>=4*e))break;var n=r>>1;this.compare(r,n)>0&&this.swap(r,n),e=r}}function minMaxHeapTrickleDownMax(e){var t=e>>1,i=e>>2;if(i>1&&this.compare(e,i)>0)return this.swap(e,i),void this.bubbleUpMax(i);for(t>1&&this.compare(e,t)<0&&(this.swap(e,t),this.bubbleUpMin(t));2*e<this.heap.length;){var r=this.getMaxIndex([2*e,2*e+1,4*e,4*e+1,4*e+2,4*e+3]);if(this.compare(r,e)<=0)break;if(this.swap(r,e),!(r>=4*e))break;var n=r>>1;this.compare(r,n)<0&&this.swap(r,n),e=r}}function minMaxHeapGetMinIndex(e){for(var t=e[0]<this.heap.length?e[0]:void 0,i=1;i!==e.length&&e[i]<this.heap.length;i++)this.compare(e[i],t)<0&&(t=e[i]);return t}function minMaxHeapGetMaxIndex(e){for(var t=e[0]<this.heap.length?e[0]:void 0,i=1;i!==e.length&&e[i]<this.heap.length;i++)this.compare(e[i],t)>0&&(t=e[i]);return t}function minMaxHeapVerify(){for(var e=1;e!==this.heap.length;e++){var t=e>>1,i=t>>1;MinMaxHeap.isOnMinLevel(e)?(t>0&&this.compare(e,t)>0&&(console.log("error 1",e),MinMaxHeap.errorCount++),i>0&&this.compare(e,i)<0&&(console.log("error 2",e),MinMaxHeap.errorCount++)):(t>0&&this.compare(e,t)<0&&(console.log("error 3",e),MinMaxHeap.errorCount++),i>0&&this.compare(e,i)>0&&(console.log("error 4",e),MinMaxHeap.errorCount++))}}function minMaxHeapAddArray(e,t){var i,r=this.heap.length,n=e.length;if(1===t||!t&&r<n/20)for(this.heap=this.heap.concat(e),i=this.heap.length-1;i>=1;i--)this.trickleDown(i);else for(i=0;i!==n;i++)this.add(e[i])}function minMaxHeapGetFirstElement(){return 1}function minMaxHeapGetLastElement(){return this.heap.length-1}function minMaxHeapInitWithSortedArray(e,t,i,r){void 0===i&&(i=0),void 0===r&&(r=e.length-1);var n,o=1,s=t||void 0===t,a=1,d=2;for(this.heap=[void 0];i<=r;)s?(n=e[i++],void 0!==n&&this.assignPos(o,n)):(n=e[r--],void 0!==n&&this.assignPos(o,n)),void 0!==n&&(o++,o===d&&(s=!s,a*=2,d+=a))}function sMMHeapDump(){function e(t,i){if(i>1){var r=e(t,i>>1);return i%2===0?r+r:r+r+t}return 1===i?t:""}function t(t){var i=u-t.length;return e(" ",i>>1)+t+e(" ",i+1>>1)}for(var i,r,n,o=Math.pow(2,Math.floor(Math.log(this.heap.length-1)/Math.log(2))),s=0,a=1,d=0,u=0,h=[],l=1;l!==this.heap.length;l++)"dataElementId"in this.heap[l]?h[l]=void 0===this.heap[l].sortValues?this.heap[l].dataElementId:this.heap[l].dataElementId+":"+this.heap[l].sortValues.map(function(e){return e.value}).toString():h[l]=JSON.stringify(this.heap[l]),h[l].length>u&&(u=h[l].length);for(i=o*(u+1)-1,n=e(" ",Math.floor(i/2)),l=1;l!==this.heap.length;l++)n+=t(h[l]),d++,d===a||l===this.heap.length-1?(console.log(n),s++,a*=2,d=0,i=Math.floor(i/2)-1,r=e(" ",i-1),n=e(" ",Math.floor(i/2))):n+=r}function minMaxHeapDumpHorizontal(e,t,i){void 0===e&&(e="    "),void 0===t&&(t=1),void 0===i&&(i="");var r=t>=this.heap.length?void 0:"dataElementId"in this.heap[t]?void 0===this.heap[t].sortValues?this.heap[t].dataElementId:this.heap[t].dataElementId+":"+this.heap[t].sortValues.map(function(e){return e.value}).toString():JSON.stringify(this.heap[t]);return t>=this.heap.length?"":this.dumpHorizontal(e,2*t+1,i+e)+i+r+" ["+t+(MinMaxHeap.isOnMinLevel(t)?",min]":",max]")+"\n"+this.dumpHorizontal(e,2*t,i+e)}function RangeKey(e,t){this.MinMaxHeap(this.comparator),this.minOpen=!!e,this.maxOpen=!!t,this.typeCount=0,this.otherTypeCount=0,this.keyList={},this.keys=this.heap}function rangeKeyIsNonRangeType(e){return"attributeValue"==e||"defun"==e||"functionApplication"==e||"variableIndex"==e||"builtInFunction"==e||"negation"==e||"areaReference"==e||"pointerReference"==e}function rangeKeyAdd(e,t,i){var r;if(0==this.otherTypeCount)if(this.typeCount||(this.type=e,this.nonRangeType=this.isNonRangeType(e)),e==this.type)this.keyList[t]&&this.remove(t),this.typeCount++,this.MinMaxHeap_add(new RangeKeyValue(t,i));else{this.clear(),this.types=[void 0];for(var n=1;n<this.keys.length;++n)this.types.push(this.type);this.otherTypeCount=1,(r=this.keyList[t])?(this.typeCount--,this.types[r]=e,this.keys[r].key=i):(this.keyList[t]=this.keys.length,this.types.push(e),this.keys.push(new RangeKeyValue(t,i)))}else e==this.type?this.typeCount++:this.otherTypeCount++,(r=this.keyList[t])?(this.keys[r].key=i,this.type==this.types[r]?this.typeCount--:this.otherTypeCount--,this.types[r]=e,this.typeCount||this.setType(),this.otherTypeCount||this.activate()):(this.keyList[t]=this.keys.length,this.keys.push(new RangeKeyValue(t,i)),this.types.push(e))}function rangeKeyAddFromRangeKey(e){var t;if(void 0!==(t=e.getType()))for(var i=1,r=e.keys.length;i<r;++i)this.add(t,e.keys[i].id,e.keys[i].key);else for(var i=1,r=e.keys.length;i<r;++i)this.add(e.types[i],e.keys[i].id,e.keys[i].key)}function rangeKeyRemove(e){var t;if(void 0!==(t=this.keyList[e]))if(this.otherTypeCount){delete this.keyList[e],this.types[t]==this.type?this.typeCount--:this.otherTypeCount--;var i;t!=(i=this.keys.length-1)&&(this.keys[t]=this.keys[i],this.types[t]=this.types[i]),this.keys.pop(),this.types.pop(),this.setType(),this.otherTypeCount||this.activate()}else this.removePos(t),this.typeCount--}function rangeKeyRemoveByRangeKey(e){for(var t=1,i=e.keys.length;t<i;++t)this.remove(e.keys[t].id)}function rangeKeySetMinOpen(e){this.minOpen=!!e}function rangeKeySetMaxOpen(e){this.maxOpen=!!e}function rangeKeyGetMinOpen(){return this.minOpen}function rangeKeyGetMaxOpen(){return this.maxOpen}function rangeKeySetType(){if(!this.typeCount&&this.otherTypeCount){this.type=this.types[1],this.nonRangeType=this.isNonRangeType(this.type),this.typeCount=1,this.otherTypeCount=0;for(var e=2;e<this.types.length;++e)this.types[e]==this.type?this.typeCount++:this.otherTypeCount++}}function rangeKeyActivate(){delete this.types;for(var e=1,t=this.keys.length;e<t;++e)this.MinMaxHeap_add(this.keys[e]);this.keys=this.heap}function rangeKeyIsActive(){return!(this.otherTypeCount||this.nonRangeType&&this.typeCount)}function rangeKeyGetMinKey(){if(this.isActive()&&this.typeCount)return this.getMin().key}function rangeKeyGetMaxKey(){if(this.isActive()&&this.typeCount)return this.getMax().key}function rangeKeyGetMinMax(){if(this.isActive()&&!this.isEmpty()){var e=this.getMinKey(),t=this.getMaxKey();return e==t?e:[e,t]}}function rangeKeyIsEmpty(){return 1===this.keys.length}function rangeKeyGetEntries(){return this.keys}function rangeKeyGetTypes(){return this.types}function rangeKeyGetType(){return this.otherTypeCount||!this.typeCount?"range":this.type}function rangeKeyGetKeyUpdate(e){var t=[];if(e)for(var i=1,r=this.keys.length;i<r;++i)t.push(this.keys[i].id);else for(var i=1,r=this.keys.length;i<r;++i)t.push(this.keys[i].id,this.keys[i].key)}function rangeKeySimpleCopy(){return new ConstRangeKey(this)}function rangeKeySwap(e,t){this.keyList[this.heap[e].id]=t,this.keyList[this.heap[t].id]=e;var i=this.heap[e];this.heap[e]=this.heap[t],this.heap[t]=i}function rangeKeyAssignPos(e,t){var i;(i=this.heap[e])&&delete this.keyList[i.id],this.keyList[t.id]=e,this.heap[e]=t}function rangeKeyPopLastPos(){var e=this.heap.pop();return delete this.keyList[e.id],e}function rangeKeyIntersectsWith(e){if(this.isEmpty()||e.isEmpty()||!this.isActive()||!e.isActive()||this.getType()!=e.getType())return!1;var t=this.getMinKey(),i=e.getMaxKey();if(i==t)return!this.minOpen&&!e.getMaxOpen();if(i<t)return!1;var r=this.getMaxKey(),n=e.getMinKey();return r==n?!e.getMinOpen()&&!this.maxOpen:!(r<n)}function rangeKeyValueInRange(e,t){if(this.isEmpty()||!this.isActive()||this.getType()!=e)return!1;var i=this.getMinKey(),r=this.getMaxKey();return!(t<i||t==i&&this.minOpen)&&!(t>r||t==r&&this.maxOpen)}function RangeKeyValue(e,t){this.id=e,this.key=t}function ConstRangeKey(e,t,i,r,n,o){e?(this.active=e.isActive(),this.type=e.type,this.empty=e.isEmpty(),this.minKey=e.getMinKey(),this.maxKey=e.getMaxKey(),this.minOpen=e.getMinOpen(),this.maxOpen=e.getMaxOpen()):void 0===t?(this.empty=!0,this.active=!0):(this.active=!0,this.type=t,this.empty=!1,this.minKey=i,this.maxKey=r,this.minOpen=n,this.maxOpen=o)}function constRangeKeyIsActive(){return this.active}function constRangeKeyIsEmpty(){return this.empty}function constRangeKeyGetMinKey(){return this.minKey}function constRangeKeyGetMaxKey(){return this.maxKey}function constRangeKeyGetMinOpen(){return this.minOpen}function constRangeKeyGetMaxOpen(){return this.maxOpen}function constRangeKeyGetType(){return this.type}function constRangeKeySimpleCopy(){return this}function constRangeKeyIntersectsWith(e){if(this.isEmpty()||e.isEmpty()||!this.isActive()||!e.isActive()||this.type!=e.getType())return!1;var t=this.minKey,i=e.getMaxKey();if(i==t)return!this.minOpen&&!e.getMaxOpen();if(i<t)return!1;var r=this.maxKey,n=e.getMinKey();return r==n?!e.getMinOpen()&&!this.maxOpen:!(r<n)}function constRangeKeyValueInRange(e,t){if(this.isEmpty()||!this.isActive()||this.type!=e)return!1;var i=this.minKey,r=this.maxKey;return!(t<i||t==i&&this.minOpen)&&!(t>r||t==r&&this.maxOpen)}function DebugInternalTo(e){this.qcm=e,this.rootPathId=this.qcm.getRootPathId(),this.root=[]}function debugInternalToGetElementPathId(e){var t=this.qcm.diffPathId(e,this.rootPathId);return void 0===t&&(t=this.qcm.getRootPathId()),t}function debugInternalToClear(){this.setDataElementTable(void 0,void 0),this.clearValue()}function debugInternalToSetDataElementTable(e,t){void 0===t&&(t=this.qcm.getRootPathId()),this.dataElements==e&&this.rootPathId==t||(this.clearValue(),this.dataElements=e,e?this.nodes={}:this.nodes=void 0,this.rootPathId=t)}function debugInternalToAddValue(e,t,i,r){var n;if(n="object"==typeof e?e.isEmpty()?"r()":e.isActive()?"r(<"+e.getType()+">:"+e.getMinKey()+", <"+e.getType()+">:"+e.getMaxKey()+")":new DebugRangeObj:"projector"==t?"<"+t+">:_":"variableIndex"==t?"<"+t+">:$"+e:"negation"==t?new DebugNegationObj:"functionApplication"==t?new DebugFuncAppObj:"defun"==t?new DebugDefunObj:t?"<"+t+">:"+e:"<"+typeof e+">:"+e,!i&&this.dataElements&&this.clear(),!this.dataElements)return void(this.root=n);var o;if(this.nodes[i]&&(o=this.nodes[i][r])){if("negation"==t){if(o.nodeObj instanceof DebugNegationObj)return;if(o.nodeObj instanceof Array){for(var s in o.nodeObj)n[s]=o.nodeObj[s];return o.nodeObj=n,void this.insertUnderDominating(i,r,n)}}return o.numSubNodes&&this.removeDominatedNodes(i,r,o),void(o.nodeObj=n)}this.createNewEntry(i,r,n)}function debugInternalToGetDominatingNode(e,t){var i,r,n,o=this.dataElements.getEntry(e),s=this.getElementPathId(o.pathId);return o.parent&&(n=this.dataElements.getPathId(o.parent)),(r=s==t)?e=o.parent&&n>=this.rootPathId?o.parent:0:t=this.qcm.getPrefix(t),this.nodes[e]&&(i=this.nodes[e][t])?(i.nodeObj&&"object"==typeof i.nodeObj&&r===(i.nodeObj instanceof Array||i.nodeObj instanceof DebugNegationObj||i.nodeObj instanceof DebugRangeObj)||(i.numSubNodes&&this.removeDominatedNodes(e,t,i),i.nodeObj=r?[]:{}),i):this.createNewEntry(e,t,r?[]:{})}function debugInternalToCreateNewEntry(e,t,i){this.nodes[e]||(this.nodes[e]={count:0});var r=this.nodes[e][t]={numSubNodes:0};if(this.nodes[e].count++,i instanceof DebugNegationObj||i instanceof DebugRangeObj||i instanceof DebugFuncAppObj||i instanceof DebugDefunObj)for(var n in i)r.numSubNodes++;return e?(r.nodeObj=i,this.insertUnderDominating(e,t,i),r):(r.nodeObj=this.root=i,r)}function debugInternalToInsertUnderDominating(e,t,i){var r=this.getDominatingNode(e,t);if(r){var n=r.nodeObj;if("object"==typeof n&&(n instanceof Array||n instanceof DebugNegationObj||n instanceof DebugRangeObj))void 0===n[e]&&r.numSubNodes++,n[e]=i;else{var o=this.qcm.getLastPathAttr(t);void 0===n[o]&&r.numSubNodes++,n[o]=i}}}function debugInternalToRemoveDominatedNodes(e,t,i){if(i.numSubNodes){if(i.nodeObj instanceof Array||i.nodeObj instanceof DebugNegationObj||i.nodeObj instanceof DebugRangeObj){for(var r in i.nodeObj){var n=this.nodes[r][t];n.numSubNodes&&this.removeDominatedNodes(r,t,n),delete this.nodes[r]}i.nodeObj=[]}else{for(var o in i.nodeObj){var s=this.qcm.getPathId(t,o),n=this.nodes[e][s];n.numSubNodes&&this.removeDominatedNodes(e,s,n),--this.nodes[e].count||delete this.nodes[e]}i.nodeObj={}}i.numSubNodes=0}}function debugInternalToRemoveValue(e,t){if(!this.dataElements)return void(this.root=[]);var i;if(this.nodes[e]&&(i=this.nodes[e][t])){if(i.nodeObj instanceof DebugNegationObj||i.nodeObj instanceof DebugRangeObj){if(i.numSubNodes){var r=[];for(var n in i.nodeObj)r[n]=i.nodeObj[n];i.nodeObj=r,this.insertUnderDominating(e,t,r)}}else i.numSubNodes&&this.removeDominatedNodes(e,t,i);var o=this.dataElements.getEntry(e),s=this.getElementPathId(o.pathId),a=s==t,d=a?o.parent?o.parent:0:e,u=a?t:this.qcm.getPrefix(t),h=this.nodes[d][u],l=a?e:this.qcm.getLastPathAttr(t);delete h.nodeObj[l],!--h.numSubNodes&&d&&this.removeValue(d,u),delete this.nodes[e][t],--this.nodes[e].count||delete this.nodes[e]}}function debugInternalToClearValue(e,t){this.nodes&&(this.nodes={}),this.root=[]}function debugInternalToGetDescStr(e){var t;if(void 0===e&&(e=this.root),"object"==typeof e){if(e instanceof Array||e instanceof DebugNegationObj||e instanceof DebugRangeObj){t=e instanceof DebugNegationObj?"n(":e instanceof DebugRangeObj?"r-(":"o(";var i=!0;for(var r in e)i?(t+=r+": "+this.getDescStr(e[r]),i=!1):t+=", "+r+": "+this.getDescStr(e[r]);t+=")"}else if(e instanceof DebugFuncAppObj||e instanceof DebugDefunObj){t=e instanceof DebugDefunObj?"defun[":"[",t+="f"in e?this.getDescStr(e.f):"--";for(var n=1;n in e;++n)t+=", "+this.getDescStr(e[n]);t+="]"}else{t="{";var i=!0;for(var o in e)i?(t+=" "+o+": "+this.getDescStr(e[o]),i=!1):t+=", "+o+": "+this.getDescStr(e[o]);t+=" }"}return t}return e}function DebugNegationObj(){}function DebugFuncAppObj(){}function DebugDefunObj(){}function DebugRangeObj(){}function DiscreteSubIndex(){this.values=new Map,this.lookups=new Map}function discreteSubIndexAddToHalfSubIndex(e,t,i,r,n){if(i===t)return{};if(void 0!==i){var o=r.get(i);o.delete(e),0==o.size&&r.delete(i)}var s;if(r.has(t)?s=r.get(t):(s=new Map,r.set(t,s)),s.set(e,!0),0==n.size)return{};var a;n.has(t)&&(a=[],n.get(t).forEach(function(e,t){a.push(t)}));var d;return void 0!==i&&n.has(i)&&(d=[],n.get(i).forEach(function(e,t){d.push(t)})),{added:a,removed:d}}function discreteSubIndexAddValue(e,t,i){return this.addToHalfSubIndex(e,t,i,this.values,this.lookups)}function discreteSubIndexAddLookup(e,t,i){return this.addToHalfSubIndex(e,t,i,this.lookups,this.values);
}function discreteSubIndexRemoveFromHalfSubIndex(e,t,i,r){var n=i.get(t);if(n.delete(e),0==n.size&&delete i.delete(t),0==r.size)return[];if(!r.has(t))return[];var o=[];return r.get(t).forEach(function(e,t){o.push(t)}),o}function discreteSubIndexRemoveValue(e,t){return this.removeFromHalfSubIndex(e,t,this.values,this.lookups)}function discreteSubIndexClearValues(){this.values=new Map}function discreteSubIndexRemoveLookup(e,t){return this.removeFromHalfSubIndex(e,t,this.lookups,this.values)}function discreteSubIndexGetMatches(e,t){if(void 0===t)return[];if(!this.values.has(t))return[];var i=[];return this.values.get(t).forEach(function(e,t){i.push(t)}),i}function discreteSubIndexSupportsIntervals(){return!1}function discreteSubIndexHasRangeValues(){return!1}function discreteSubIndexHasNoLookups(){return 0==this.lookups.size}function discreteSubIndexGetAllValues(){return this.values}function discreteSubIndexGetAllLookups(){return this.lookups}function calcIntervalDiff(e,t,i,r,n,o,s,a,d){var u,h,l=d(t,n);if(l<0)return[!0,{lowKey:e,lowOpen:i,highKey:t,highOpen:r},!1,{lowKey:n,lowOpen:s,highKey:o,highOpen:a}];if(0==l){var c=d(e,t),p=d(n,o);return[!0,c||!i&&!r&&s?{lowKey:e,lowOpen:i,highKey:t,highOpen:r||!s}:void 0,!1,p||!a&&!s&&r?{lowKey:n,lowOpen:s||!r,highKey:o,highOpen:a}:void 0]}if((u=d(e,o))>0)return[!1,{lowKey:n,lowOpen:s,highKey:o,highOpen:a},!0,{lowKey:e,lowOpen:i,highKey:t,highOpen:r}];if(0==u){var c=d(e,t),p=d(n,o);return[!1,p||!s&&!a&&i?{lowKey:n,lowOpen:s,highKey:o,highOpen:a||!i}:void 0,!0,c||!i&&!r&&a?{lowKey:e,lowOpen:i||!a,highKey:t,highOpen:r}:void 0]}var f=d(e,n);h=f<0?[!0,{lowKey:e,lowOpen:i,highKey:n,highOpen:!s}]:0==f?i==s?[void 0,void 0]:[!i,{lowKey:e,lowOpen:!1,highKey:e,highOpen:!1}]:[!1,{lowKey:n,lowOpen:s,highKey:e,highOpen:!i}];var v=d(t,o);return v>0?h.push(!0,{lowKey:o,lowOpen:!a,highKey:t,highOpen:r}):0==v?r!==a?h.push(!r,{lowKey:t,lowOpen:!1,highKey:t,highOpen:!1}):h.push(void 0,void 0):h.push(!1,{lowKey:t,lowOpen:!r,highKey:o,highOpen:a}),h}function calcDegenerateIntervalDiff(e,t,i){var r=i(e,t);return 0==r?[void 0,void 0,void 0,void 0]:r<0?[!0,{lowKey:e,highKey:e,lowOpen:!1,highOpen:!1},!1,{lowKey:t,highKey:t,lowOpen:!1,highOpen:!1}]:[!1,{lowKey:t,highKey:t,lowOpen:!1,highOpen:!1},!0,{lowKey:e,highKey:e,lowOpen:!1,highOpen:!1}]}function mergeIntervalIntoSequence(e,t){if(t=t.concat(),void 0===e)return[t];var i,r;for(r=e.length-1;r>=0;--r){var n=e[r];if(n[1]<t[0])break;n[0]>t[1]||(void 0===i&&(i=r+1),n[1]>t[1]&&(t[1]=n[1]),n[0]<t[0]&&(t[0]=n[0]))}return void 0!==i?e.splice(r+1,i-r-1,t):e.push(t),e}function IntervalTree(e,t){this.RedBlackTree(e),this.storageAllocate=void 0!==e||t?this.nonIntStorageAllocate:this.intStorageAllocate,this.minimumKeyValue=-(1/0),this.maximumKeyValue=1/0,this.entireDomainIntervals=this.storageAllocate(),debugAllIntervalTrees&&debugAllIntervalTrees.push(this)}function intervalTreeIsEmpty(){return!(this.entireDomainIntervals.size>0)&&this.RedBlackTree_isEmpty()}function intervalTreeIntStorageAllocate(){return new IntIdStorage}function intervalTreeNonIntStorageAllocate(){return new IdStorage}function intervalTreeInsertInterval(e,t,i,r,n){var o=0===this.compare(t,i);if(!o||!r&&!n&&0!==this.compare(t,this.maximumKeyValue)){if(0!==this.compare(t,this.minimumKeyValue)){var s=this.insertKey(t);r||(o?(void 0===s.degenerate&&(s.degenerate=this.storageAllocate()),s.degenerate.set(e,!0)):(void 0===s.lowEnd&&(s.lowEnd=this.storageAllocate()),s.lowEnd.set(e,!0)))}if(!o){if(0!==this.compare(i,this.maximumKeyValue)){var s=this.insertKey(i);n||(void 0===s.highEnd&&(s.highEnd=this.storageAllocate()),s.highEnd.set(e,!0))}this.addInterval(e,t,i,this.minimumKeyValue,this.maximumKeyValue,this.root)}}}function intervalTreeInsertPoint(e,t){this.insertInterval(e,t,t,!1,!1)}function intervalTreeInsertKey(e){var t=this.BinaryTree_insertKey(e);return void 0!==t.value?(t.refCount++,t):(t.parent?t==t.parent.left?(t.value=t.parent.value.leftLeaf,delete t.parent.value.leftLeaf):(t.value=t.parent.value.rightLeaf,delete t.parent.value.rightLeaf):t.value=new ValueObj(this),t.value.leftLeaf=new ValueObj(this),t.value.rightLeaf=new ValueObj(this),t.refCount=1,this.fixAfterInsertion(t),t)}function intervalTreeAddInterval(e,t,i,r,n,o){var s=this.compare(n,i);if(s<=0&&this.compare(t,r)<=0)return 0===this.compare(t,this.minimumKeyValue)&&0===this.compare(i,this.maximumKeyValue)?void this.entireDomainIntervals.set(e,!0):void(0===s?o.value.end.set(e,!0):o.value.dontEnd.set(e,!0));var a=this.compare(o.key,i);this.compare(t,o.key)<0&&(void 0===o.left?0===a?o.value.leftLeaf.end.set(e,!0):o.value.leftLeaf.dontEnd.set(e,!0):this.addInterval(e,t,i,r,o.key,o.left)),a<0&&(void 0===o.right?0===s?o.value.rightLeaf.end.set(e,!0):o.value.rightLeaf.dontEnd.set(e,!0):this.addInterval(e,t,i,o.key,n,o.right))}function intervalTreeRemoveInterval(e,t,i,r,n){if(0===this.compare(t,this.minimumKeyValue)&&0===this.compare(i,this.maximumKeyValue))return void this.entireDomainIntervals.delete(e);var o=0===this.compare(t,i);if(o){if(r||n||0===this.compare(t,this.minimumKeyValue))return}else if(this.eraseInterval(e,t,i,this.minimumKeyValue,this.maximumKeyValue,this.root),0!==this.compare(t,this.minimumKeyValue)){var s=this.RedBlackTree_find(t);--s.refCount?r||s.lowEnd.delete(e):this.removeNode(s)}if(0!==this.compare(i,this.maximumKeyValue)){var a=this.RedBlackTree_find(i);--a.refCount?n||(o?a.degenerate.delete(e):a.highEnd.delete(e)):this.removeNode(a)}}function intervalTreeRemovePoint(e,t){this.removeInterval(e,t,t,!1,!1)}function intervalTreeRemoveNode(e){var t,i=this.BinaryTree_removeNode(e);if(i.left)t=i.left.value;else if(i.right)t=i.right.value;else{if(!i.parent)return;t=this.compare(i.key,i.parent.key)<0?i.parent.value.leftLeaf=new ValueObj(this):i.parent.value.rightLeaf=new ValueObj(this)}if(i.value.end.forEach(function(e,i){t.end.set(i,!0)}),i.value.dontEnd.forEach(function(e,i){t.dontEnd.set(i,!0)}),e!=i&&(i.right||(i.value.rightLeaf.end.forEach(function(e,i){t.end.set(i,!0)}),i.value.rightLeaf.dontEnd.forEach(function(e,i){t.dontEnd.set(i,!0)})),t.dontEnd.forEach(function(r,n){for(var o=i.parent;o!=e;o=o.parent){var s=o.right?o.right.value:o.value.rightLeaf;if(s.end.has(n)){o.value.end.set(n,!0),s.end.delete(n),t.dontEnd.delete(n);break}if(!s.dontEnd.has(n)){o!=i.parent&&(o.left.value.dontEnd.set(n,!0),t.dontEnd.delete(n));break}if(s.dontEnd.delete(n),o.parent==e){o.value.dontEnd.set(n,!0),t.dontEnd.delete(n);break}}})),i!=e||!e.right&&e.left){var r=i!=e?i.value.leftLeaf.end:e.value.rightLeaf.end;r.forEach(function(t,i){for(var r=e.prev.value.rightLeaf,n=e;;){if(r.dontEnd.has(i)){r.dontEnd.delete(i),r.end.set(i,!0);break}n=n.prev,r=n.value}})}this.fixAfterRemoval(i)}function intervalTreeEraseInterval(e,t,i,r,n,o){var s=this.compare(n,i);if(this.compare(t,r)<=0&&s<=0)return void(0===s?o.value.end.delete(e):o.value.dontEnd.delete(e));var a=this.compare(o.key,i);this.compare(t,o.key)<0&&(void 0===o.left?0===a?o.value.leftLeaf.end.delete(e):o.value.leftLeaf.dontEnd.delete(e):this.eraseInterval(e,t,i,r,o.key,o.left)),a<0&&(void 0===o.right?0===s?o.value.rightLeaf.end.delete(e):o.value.rightLeaf.dontEnd.delete(e):this.eraseInterval(e,t,i,o.key,n,o.right))}function intervalTreeCopySplicedToRemovedNode(e,t){t.key=e.key,void 0!==e.degenerate?t.degenerate=e.degenerate:void 0!==t.degenerate&&(t.degenerate=void 0),void 0!==e.lowEnd?t.lowEnd=e.lowEnd:void 0!==t.lowEnd&&(t.lowEnd=void 0),void 0!==e.highEnd?t.highEnd=e.highEnd:void 0!==t.highEnd&&(t.highEnd=void 0),t.refCount=e.refCount}function intervalTreeRotateRight(e){var t=e.left;this.RedBlackTree_rotateRight(e);var i=void 0!==t.left?t.left.value:t.value.leftLeaf,r=void 0!==e.left?e.left.value:t.value.rightLeaf,n=void 0!==e.right?e.right.value:e.value.rightLeaf,o=e.value,s=e.value=new ValueObj(this);void 0===e.left&&(e.value.leftLeaf=r,delete t.value.rightLeaf),void 0===e.right&&(e.value.rightLeaf=o.rightLeaf),r.dontEnd.forEach(function(e,t){n.end.has(t)?(s.end.set(t,!0),r.dontEnd.delete(t),n.end.delete(t)):n.dontEnd.has(t)&&(s.dontEnd.set(t,!0),r.dontEnd.delete(t),n.dontEnd.delete(t))});var a=t.value;a.end.forEach(function(e,t){i.dontEnd.set(t,!0),r.end.set(t,!0)}),a.dontEnd.forEach(function(e,t){i.dontEnd.set(t,!0),r.dontEnd.set(t,!0)}),a.dontEnd=o.dontEnd,a.end=o.end}function intervalTreeRotateLeft(e){var t=e.right;this.RedBlackTree_rotateLeft(e);var i=void 0!==e.left?e.left.value:e.value.leftLeaf,r=void 0!==e.right?e.right.value:t.value.leftLeaf,n=void 0!==t.right?t.right.value:t.value.rightLeaf,o=e.value,s=e.value=new ValueObj(this);void 0===e.right&&(e.value.rightLeaf=r,delete t.value.leftLeaf),void 0===e.left&&(e.value.leftLeaf=o.leftLeaf),i.dontEnd.forEach(function(e,t){r.end.has(t)?(s.end.set(t,!0),i.dontEnd.delete(t),r.end.delete(t)):r.dontEnd.has(t)&&(s.dontEnd.set(t,!0),i.dontEnd.delete(t),r.dontEnd.delete(t))});var a=t.value;a.end.forEach(function(e,t){r.dontEnd.set(t,!0),n.end.set(t,!0)}),a.dontEnd.forEach(function(e,t){r.dontEnd.set(t,!0),n.dontEnd.set(t,!0)}),a.dontEnd=o.dontEnd,a.end=o.end}function intervalTreeFind(e){var t=[];return this.entireDomainIntervals.forEach(function(e,i){t.push(i)}),this.root?this.findKeyUnder(this.root,this.root.value,e,!1,t):t}function intervalTreeFindKeyUnder(e,t,i,r,n){for(;;){if(t.dontEnd.size>0&&t.dontEnd.pushTo(n),!r&&t.end.size>0&&t.end.pushTo(n),void 0===e)return n;var o;r?(t=void 0===e.right?e.value.rightLeaf:e.right.value,e=e.right):(o=this.compare(i,e.key),0===o&&(void 0!==e.lowEnd&&e.lowEnd.size>0&&e.lowEnd.pushTo(n),void 0!==e.highEnd&&e.highEnd.size>0&&e.highEnd.pushTo(n),void 0!==e.degenerate&&e.degenerate.size>0&&e.degenerate.pushTo(n)),o<=0?(t=void 0===e.left?e.value.leftLeaf:e.left.value,e=e.left,r=0===o):(t=void 0===e.right?e.value.rightLeaf:e.right.value,e=e.right))}return n}function intervalTreeFindIntersections(e,t,i,r){var n=this.compare(e,t);if(0===n)return i||r?[]:this.find(e);var o=[];return this.entireDomainIntervals.forEach(function(e,t){o.push(t)}),this.root?n>0?this.findIntersectionsUnder(this.root,this.root.value,t,e,i,r,this.minimumKeyValue,this.maximumKeyValue,o):this.findIntersectionsUnder(this.root,this.root.value,e,t,i,r,this.minimumKeyValue,this.maximumKeyValue,o):o}function intervalTreeFindIntersectionsUnder(e,t,i,r,n,o,s,a,d){if(t.end.forEach(function(e,t){d.push(t)}),this.compare(a,r)>=0&&t.dontEnd.forEach(function(e,t){d.push(t)}),!e)return d;var u=this.compare(i,e.key);n||0!==u||void 0===e.highEnd||e.highEnd.forEach(function(e,t){d.push(t)}),u<0&&(t=void 0===e.left?e.value.leftLeaf:e.left.value,this.findIntersectionsUnder(e.left,t,i,r,n,o,s,e.key,d));var h=this.compare(r,e.key);return o||0!==h||void 0===e.lowEnd||e.lowEnd.forEach(function(e,t){d.push(t)}),h>0&&(t=void 0===e.right?e.value.rightLeaf:e.right.value,this.findIntersectionsUnder(e.right,t,i,r,n,o,e.key,a,d)),void 0!==e.degenerate&&(u<0||!n&&0===u)&&(h>0||!o&&0===h)&&e.degenerate.forEach(function(e,t){d.push(t)}),d}function intervalTreeFindContained(e,t,i,r){var n=this.compare(e,t);if(0===n&&(i||r))return[];if(n>0){var o=e;e=t,t=o}var s=[];return 0===this.compare(e,this.minimumKeyValue)&&0===this.compare(t,this.maximumKeyValue)&&this.entireDomainIntervals.forEach(function(e,t){s.push(t)}),this.root?(this.findContainedUnder(this.root,this.root.value,e,t,i,r,-(1/0),1/0,s),s):s}function intervalTreeFindContainedUnder(e,t,i,r,n,o,s,a,d,u){if(e){var h,l=this.compare(i,e.key),c=this.compare(r,e.key);0===c&&o&&void 0!==e.highEnd&&(u||(u=this.storageAllocate()),e.highEnd.forEach(function(e,t){u.set(t,!0)})),l<=0&&(h=void 0===e.left?e.value.leftLeaf:e.left.value,u=this.findContainedUnder(e.left,h,i,r,n,o,s,e.key,d,u),e.degenerate&&(l<0||!n)&&(c>0||0===c&&!o)&&e.degenerate.forEach(function(e,t){d.push(t)})),0===l&&n&&void 0!==e.lowEnd&&(u||(u=this.storageAllocate()),e.lowEnd.forEach(function(e,t){u.set(t,!0)})),c>0&&(h=void 0===e.right?e.value.rightLeaf:e.right.value,u=this.findContainedUnder(e.right,h,i,r,n,o,e.key,a,d,u))}var p=this.compare(i,s),f=this.compare(r,a);if(p<=0&&f>=0)void 0!==u?t.end.forEach(function(e,t){u.has(t)||d.push(t)}):t.end.forEach(function(e,t){d.push(t)});else{if(f<0)return;u||(u=this.storageAllocate()),t.dontEnd.forEach(function(e,t){u.set(t,!0)})}return u}function intervalTreeFindWithUpperBound(e,t,i,r,n,o){if(this.compare(n,this.maximumKeyValue)>=0)return this.findIntersections(e,t,i,r);if(void 0===this.root)return[];var s=this.compare(e,t);if(s>0){var a=e;e=t,t=a,s=-s}var d=this.compare(t,n);if(d>=0){if(d>0&&(t=n,(s=this.compare(e,t))>0))return[];o&&(r=!0)}if(0===s&&(i||r))return[];var u=[];return this.findWithUpperBoundUnder(this.root,this.root.value,e,t,i,r,!s,n,o,this.minimumKeyValue,this.maximumKeyValue,u),u}function intervalTreeFindWithUpperBoundUnder(e,t,i,r,n,o,s,a,d,u,h,l,c){var p=this.compare(h,a),f=this.compare(u,r);if(e){var v,g=this.compare(r,e.key),m=this.compare(i,e.key),y=this.compare(e.key,a);(g>0||p>0&&y<=0)&&(v=void 0===e.right?e.value.rightLeaf:e.right.value,c=this.findWithUpperBoundUnder(e.right,v,i,r,n,o,s,a,d,e.key,h,l,c)),void 0!==e.degenerate&&(m<0||!n&&0===m)&&(g>0||!o&&0===g)&&e.degenerate.forEach(function(e,t){l.push(t)}),void 0!==e.highEnd&&d&&0===y&&(void 0===c&&(c=this.storageAllocate()),e.highEnd.forEach(function(e,t){c.set(t,!0)})),o||void 0===e.lowEnd||0!==g||(void 0!==c?e.lowEnd.forEach(function(e,t){c.has(t)||l.push(t)}):e.lowEnd.forEach(function(e,t){l.push(t)})),!n&&e.highEnd&&0===m&&e.highEnd.forEach(function(e,t){l.push(t)}),(y>0||f<0&&(m<0||s&&0===m))&&(v=void 0===e.left?e.value.leftLeaf:e.left.value,c=this.findWithUpperBoundUnder(e.left,v,i,r,n,o,s,a,d,u,e.key,l,c))}if(p>0)f>=0&&(c||(c=this.storageAllocate()),t.end.forEach(function(e,t){c.set(t,!0)}),t.dontEnd.forEach(function(e,t){c.set(t,!0)}));else{var I=this.compare(h,r);I<0?t.end.forEach(function(e,t){l.push(t)}):((!s||I>0)&&(p<0||!c?t.end.forEach(function(e,t){l.push(t)}):t.end.forEach(function(e,t){c.has(t)||l.push(t)})),p<0&&(void 0!==c?t.dontEnd.forEach(function(e,t){c.has(t)||l.push(t)}):t.dontEnd.forEach(function(e,t){l.push(t)})))}return c}function intervalTreeFindWithLowerBound(e,t,i,r,n,o){if(this.compare(n,this.minimumKeyValue)<=0)return this.findIntersections(e,t,i,r);if(void 0===this.root)return[];var s=this.compare(e,t);if(s>0){var a=e;e=t,t=a,s=-s}var d=this.compare(e,n);if(d<=0){if(d<0&&(e=n,(s=this.compare(e,t))>0))return[];o&&(i=!0)}if(0===s&&(i||r))return[];var u=[];return this.findWithLowerBoundUnder(this.root,this.root.value,e,t,i,r,!s,n,o,this.minimumKeyValue,this.maximumKeyValue,u),u}function intervalTreeFindWithLowerBoundUnder(e,t,i,r,n,o,s,a,d,u,h,l,c){var p=this.compare(u,a),f=this.compare(h,i);if(e){var v,g=this.compare(e.key,a),m=this.compare(i,e.key),y=this.compare(r,e.key);(s&&m<=0||m<0||p<0&&g>=0)&&(v=void 0===e.left?e.value.leftLeaf:e.left.value,c=this.findWithLowerBoundUnder(e.left,v,i,r,n,o,s,a,d,u,e.key,l,c)),void 0!==e.degenerate&&(m<0||!n&&0===m)&&(y>0||!o&&0===y)&&e.degenerate.forEach(function(e,t){l.push(t)}),void 0!==e.lowEnd&&d&&0===g&&(void 0===c&&(c=this.storageAllocate()),e.lowEnd.forEach(function(e,t){c.set(t,!0)})),n||void 0===e.highEnd||0!==m||(void 0!==c?e.highEnd.forEach(function(e,t){c.has(t)||l.push(t)}):e.highEnd.forEach(function(e,t){l.push(t)})),!o&&e.lowEnd&&0===y&&e.lowEnd.forEach(function(e,t){l.push(t)}),(g<0||(s&&f>=0||f>0)&&y>0)&&(v=void 0===e.right?e.value.rightLeaf:e.right.value,c=this.findWithLowerBoundUnder(e.right,v,i,r,n,o,s,a,d,e.key,h,l,c))}return p<0?(c||(c=this.storageAllocate()),t.dontEnd.forEach(function(e,t){c.set(t,!0)}),n||0!==f||t.end.forEach(function(e,t){c.set(t,!0)})):((!s||f>0)&&(c?t.end.forEach(function(e,t){c.has(t)||l.push(t)}):t.end.forEach(function(e,t){l.push(t)})),this.compare(h,r)>=0&&(c?t.dontEnd.forEach(function(e,t){c.has(t)||l.push(t)}):t.dontEnd.forEach(function(e,t){l.push(t)}))),c}function intervalTreeImportFromDegenerateTree(e){if(e.root){this.root=e.root,e.root=void 0,this.first=e.first,e.first=void 0,this.last=e.last,e.last=void 0;for(var t=this.first;t;t=t.next)t.refCount=t.value.size,t.degenerate=t.value,t.value=new ValueObj(this),t.left||(t.value.leftLeaf=new ValueObj(this)),t.right||(t.value.rightLeaf=new ValueObj(this))}}function ValueObj(e){this.end=e.storageAllocate(),this.dontEnd=e.storageAllocate(),this.leftLeaf=void 0,this.rightLeaf=void 0}function HalfLinearSubIndex(e){this.treeIsDegenerate=!0,this.tree=void 0,this.compareFunc=e?e:IntervalTree.prototype.compare}function halfLinearSubIndexClear(){this.treeIsDegenerate=!0,this.tree=void 0}function halfLinearSubIndexIsEmpty(){return void 0===this.tree||this.tree.isEmpty()}function halfLinearSubIndexAddInterval(e,t,i,r,n,o,s,a,d){var u;r=!!r,n=!!n,void 0===i?(i=t,u=!0):u=!this.compareFunc(t,i);var h;if(void 0!==o){a=!!a,d=!!d;var l=void 0===s||0==this.compareFunc(o,s);l?(this.tree.removePoint(e,o),s=o):this.tree.removeInterval(e,o,s,a,d),h=u&&l?this.calcDegenerateDiff(t,o):this.calcDiff(t,i,r,n,o,s,a,d),h.push({lowKey:o,highKey:s,lowOpen:a,highOpen:d})}else{var c={lowKey:t,highKey:i,lowOpen:r,highOpen:n};h=[!0,c]}if(this.treeIsDegenerate===!0)if(void 0===this.tree){var p=this.compareFunc===IntervalTree.prototype.compare?void 0:this.compareFunc;u===!0?this.tree=new DegenerateIntervalTree(p):(this.tree=new IntervalTree(p),this.treeIsDegenerate=!1)}else u===!1&&this.convertDegnerateTree();return u?this.tree.insertPoint(e,t):this.tree.insertInterval(e,t,i,r,n),h}function halfLinearSubIndexLoadDegenerateIntervals(e){var t=this.compareFunc===IntervalTree.prototype.compare?void 0:this.compareFunc;this.tree=new DegenerateIntervalTree(t);e.forEach(function(e,t){e.forEach(function(e,i){this.tree.insertPoint(i,t)})})}function halfLinearSubIndexRemoveInterval(e,t,i,r,n){void 0===i||this.treeIsDegenerate?this.tree.removePoint(e,t):this.tree.removeInterval(e,t,i,r,n)}function halfLinearSubIndexCalcDiff(e,t,i,r,n,o,s,a){return calcIntervalDiff(e,t,i,r,n,o,s,a,this.compareFunc)}function halfLinearSubIndexCalcDegenerateDiff(e,t){return calcDegenerateIntervalDiff(e,t,this.compareFunc)}function halfLinearSubIndexConvertDegnerateTree(){var e=this.tree,t=this.compareFunc===IntervalTree.prototype.compare?void 0:this.compareFunc;this.tree=new IntervalTree(t),this.treeIsDegenerate=!1,e&&this.tree.importFromDegenerateTree(e)}function halfLinearSubIndexFindIntersections(e,t,i,r){return this.tree.findIntersections(e,t,i,r)}function halfLinearSubIndexFindWithUpperBound(e,t,i,r,n,o){return this.tree.findWithUpperBound(e,t,i,r,n,o)}function halfLinearSubIndexFindWithLowerBound(e,t,i,r,n,o){return this.tree.findWithLowerBound(e,t,i,r,n,o)}function LinearSubIndex(e){this.values=new HalfLinearSubIndex(e),this.lookups=new HalfLinearSubIndex(e)}function linearSubIndexAddToHalfSubIndex(e,t,i,r,n,o,s,a,d,u,h){var l=u.addInterval(e,t,r,o,a,i,n,s,d);if(h.isEmpty())return{added:[],removed:[]};if(void 0===r&&(r=t),2==l.length)return{added:h.findIntersections(t,r,o,a),removed:[]};var c={},p=l[4];if(interval=l[1]){var f,v;l[0]?(f=p.lowKey,v=!p.lowOpen):(f=t,v=!o);var g=h.findWithUpperBound(interval.lowKey,interval.highKey,interval.lowOpen,interval.highOpen,f,v);l[0]?c.added=g:c.removed=g}if(interval=l[3]){var m,y;l[2]?(m=p.highKey,y=!p.highOpen):(m=r,y=!a);var I=h.findWithLowerBound(interval.lowKey,interval.highKey,interval.lowOpen,interval.highOpen,m,y);l[2]?c.added?c.added=cconcat(c.added,I):c.added=I:c.removed?c.removed=cconcat(c.removed,I):c.removed=I}return c}function linearSubIndexAddValue(e,t,i,r,n,o,s,a,d){return this.addToHalfSubIndex(e,t,i,r,n,o,s,a,d,this.values,this.lookups)}function linearSubIndexAddLookup(e,t,i,r,n,o,s,a,d){return this.addToHalfSubIndex(e,t,i,r,n,o,s,a,d,this.lookups,this.values)}function linearSubIndexRemoveValue(e,t,i,r,n){return this.values.removeInterval(e,t,i,r,n),this.lookups.isEmpty()?[]:void 0===i?this.lookups.findIntersections(t,t,!1,!1):this.lookups.findIntersections(t,i,r,n)}function linearSubIndexClearValues(){this.values.clear()}function linearSubIndexRemoveLookup(e,t,i,r,n){return this.lookups.removeInterval(e,t,i,r,n),this.values.isEmpty()?[]:void 0===i?this.values.findIntersections(t,t,!1,!1):this.values.findIntersections(t,i,r,n)}function linearSubIndexGetMatches(e,t,i,r,n){return this.values.isEmpty()?[]:this.values.findIntersections(t,i,r,n)}function linearSubIndexHasRangeValues(){return!this.values.treeIsDegenerate}function linearSubIndexSupportsIntervals(){return!0}function linearSubIndexHasNoLookups(){return this.lookups.isEmpty()}function linearSubIndexLoadFromDiscrete(e){this.values.loadDegenerateIntervals(e.getAllValues()),this.lookups.loadDegenerateIntervals(e.getAllLookups())}function InternalQCMIndexer(e){this.qcm=e,this.id=internalQCMIndexerNextId++,this.rootPathNodeId=this.qcm.getRootPathId(),this.pathNodesById={},this.numPathNodes=0,this.dataElements=this.createDataElements()}function internalQCMIndexerCreateDataElements(){return new DataElements(this)}function internalQCMIndexerDestroy(){this.qcm.removeIndexerFromQueues(this.id)}function internalQCMIndexerIsUnindexedType(e){return"attributeValue"==e||"functionApplication"==e||"defun"==e||"negation"==e||"range"==e}function internalQCMIndexerIsElementReferenceType(e){return"areaReference"==e||"pointerReference"==e}function internalQCMIndexerIsOperatorType(e){return"negation"==e||"range"==e}function internalQCMIndexerIsRangeKey(e){return e instanceof RangeKey||e instanceof ConstRangeKey}function internalQCMIndexerGetId(){return this.id}function internalQCMIndexerGetRootPathId(){return this.rootPathNodeId}function internalQCMIndexerAddPath(e){var t;if(!(t=this.pathNodesById[e])){var i=this.qcm.getPrefix(e);i&&!this.pathNodesById[i]&&this.addPath(i),t=this.createPathNode(e),t.parent?(t.parent.children||(t.parent.children={}),t.parent.children[t.parentAttr]=t):this.paths=t}return t}function internalQCMIndexerCreatePathNode(e){if(this.pathNodesById[e])return this.pathNodesById[e];var t,i=this.qcm.getPrefix(e);i&&(this.qcm.allocatePathIdByPathId(e),(t=this.pathNodesById[i])||(t=this.addPath(i)));var r={indexer:this,pathId:e,parent:t,parentAttr:t?this.qcm.getLastPathAttr(e):void 0,children:void 0,tracingChildren:void 0,numTracingChildren:0,keepActive:0,deactivateBlocked:!1,nodes:new IntHashMap,hasDataElements:!1,notifyWithElements:void 0,operandCount:0,queryMatchList:void 0,addedNodes:void 0,removedNodes:void 0,removedSubTrees:void 0,queryCalcs:void 0,queryValueIds:void 0,nonIndexedQueryCalcs:void 0,keyUpdateQueryCalcs:void 0,currentlyUpdatedQueryCalc:void 0,needTracing:0,trace:!1,subTree:0,needIndex:0,alphabeticRanges:!1,subIndexes:void 0,keyUpdateQueue:void 0,prevKeys:void 0,subTreeMonitors:void 0,numSubTreeMonitors:0,parentSubTreeCount:0,subTreeRootUpdateIds:void 0,subTreeMonitorUpdateIds:void 0,scheduled:!1};return this.pathNodesById[r.pathId]=r,this.numPathNodes++,this.dataElements.updateNumPathNodes(this.numPathNodes),r}function internalQCMIndexerClearPathNode(e){e.children=void 0,e.tracingChildren=void 0,e.numTracingChildren=0,this.removeAllNodesOnPathNode(e),e.keepActive=0,e.deactivateBlocked=!1,e.hasDataElements=!1,e.notifyWithElements=void 0,e.operandCount=0,e.queryMatchList=void 0,e.addedNodes=void 0,e.removedNodes=void 0,e.removedSubTrees=void 0,e.queryCalcs=void 0,e.queryValueIds=void 0,e.nonIndexedQueryCalcs=void 0,e.keyUpdateQueryCalcs=void 0,e.currentlyUpdatedQueryCalc=void 0,e.needTracing=0,e.trace=!1,e.subTree=0,e.needIndex=0,e.alphabeticRanges=!1,e.subIndexes=void 0,e.keyUpdateQueue=void 0,e.prevKeys=void 0,e.subTreeMonitors=void 0,e.numSubTreeMonitors=0,e.parentSubTreeCount=0,e.subTreeRootUpdateIds=void 0,e.subTreeMonitorUpdateIds=void 0,e.scheduled=!1}function internalQCMIndexerKeepPathNodeActive(e){e.keepActive++}function internalQCMIndexerReleaseKeepPathNodeActive(e){if(0!==e.keepActive&&0===--e.keepActive){if(e.trace||e.subTree)return void(e.deactivateBlocked=!1);e.deactivateBlocked&&(e.deactivateBlocked=!1,this.pathNodeDeactivated(e),this.notifyPathDeactivated(e))}}function internalQCMIndexerRemovePathNode(e){if(void 0!==e.children)for(var t in e.children)this.removePathNode(e.children[t]);this.removeAllNodesOnPathNode(e),delete this.pathNodesById[e.pathId],this.numPathNodes--,this.dataElements.updateNumPathNodes(this.numPathNodes);var i=e.parent;return i?(this.qcm.releasePathId(e.pathId),delete i.children[e.parentAttr],void(isEmptyObj(i.children)&&(i.children=void 0))):void(this.paths=void 0)}function internalQCMIndexerClearAllDataNodes(e,t,i){e.parent||(t=!0),e.currentlyUpdatedQueryCalc=0;for(var r in e.children)this.clearAllDataNodes(e.children[r],t,!0);if(e.queryMatchList=new IntHashMap,void 0!==e.queryCalcs&&e.queryCalcs.size>0){if(void 0!==e.prevKeys){var n=e.prevKeys;e.nodes.forEach(function(e,t){n.has(t)||n.set(t,e)})}else e.prevKeys=e.nodes;e.scheduled||this.qcm.schedulePathNode(e),e.queryCalcs.forEach(function(t,i){e.currentlyUpdatedQueryCalc=-i,t.removeAllIndexerMatches(),e.currentlyUpdatedQueryCalc=void 0})}if(e.addedNodes=void 0,e.removedNodes=void 0,e.currentlyUpdatedQueryCalc=void 0,t||this.removeAllNodesOnPathNode(e),e.nodes=new IntHashMap,e.hasDataElements&&this.notifyPathHasNoDataElements(e.pathId),e.subIndexes)for(var o in e.subIndexes){var s=e.subIndexes[o];s.hasNoLookups()?delete e.subIndexes[o]:s.clearValues()}e.keyUpdateQueue=void 0,e.subTree&&(i&&(e.parentSubTreeCount=0),e.parentSubTreeCount>0?e.subTree=1:(e.subTree=0,this.deactivateSubTreeMonitoringOnPath(e)),e.subTreeRootUpdateIds={},e.subTreeMonitorUpdateIds={}),e.parent||(this.dataElements=this.createDataElements())}function internalQCMIndexerClear(){void 0!==this.paths&&this.clearAllDataNodes(this.paths)}function internalQCMIndexerIncPathNodeTracing(e){var t;return e.needTracing>0?void e.needTracing++:(void 0!==(t=e.parent)&&this.incPathNodeTracing(e.parent),e.needTracing=1,e.trace?void this.qcm.descheduleTraceDeactivation(e):(t&&(t.tracingChildren?t.numTracingChildren++:(t.tracingChildren={},t.numTracingChildren=1),t.tracingChildren[e.parentAttr]=e),e.trace=!0,void(e.subTree?this.pathNodeTracingActivated(e):(this.pathNodeActivated(e),this.notifyPathActivated(e)))))}function internalQCMIndexerDecPathNodeTracing(e){var t;--e.needTracing>0||(this.qcm.scheduleTraceDeactivation(e),void 0!==(t=e.parent)&&this.decPathNodeTracing(e.parent))}function internalQCMIndexerRemovePathNodeTracing(e){if(e.trace&&!(e.needTracing>0)){if(e.numTracingChildren>0){for(var t in e.tracingChildren)this.removePathNodeTracing(e.tracingChildren[t]);if(e.numTracingChildren>0)return}e.trace=!1;var i;if(void 0!==(i=e.parent)&&(delete i.tracingChildren[e.parentAttr],i.numTracingChildren--),e.subTree)this.pathNodeTracingDeactivated(e);else{if(e.keepActive)return void(e.deactivateBlocked=!0);this.pathNodeDeactivated(e),this.notifyPathDeactivated(e)}}}function internalQCMIndexerIsPathActive(e){if(!(e in this.pathNodesById))return!1;var t=this.pathNodesById[e];return t.trace||!!t.subTree}function internalQCMIndexerIncPathNodeIndexing(e){return e.needIndex>0?void e.needIndex++:(e.needIndex=1,void 0!==e.subIndexes?void this.qcm.scheduleIndexDestroy(e):(e.subIndexes={},void this.loadDataIntoIndexes(e)))}function internalQCMIndexerDecPathNodeIndexing(e){--e.needIndex>0||this.qcm.scheduleIndexDestroy(e)}function internalQCMIndexerSetAlphabeticRanges(e){if(!e.alphabeticRanges&&(e.alphabeticRanges=!0,void 0!==this.subIndexes))for(var t in this.alphabeticTypes){var i=e.subIndexes[t];if(i&&!i.supportsIntervals()){var r=e.subIndexes[t]=new LinearSubIndex(LinearSubIndex.stringCompare);r.loadFromDiscrete(i)}}}function internalQCMIndexerLoadDataIntoIndexes(e){var t,i,r=this;e.nodes.forEach(function(n,o){if(r.isActive(e,o,n)&&void 0!==n.type&&void 0!==n.key){if(t!=n.type){if(t=n.type,!(i=r.getSubIndex(e,t,!0)))return}else if(void 0===i)return;var s,a=n.key;if(s="object"==typeof a?i.addValue(o,a.getMinKey(),void 0,a.getMaxKey(),void 0,a.getMinOpen(),void 0,a.getMaxOpen(),void 0):i.addValue(o,a),!i.hasNoLookups()){var d=s.added;if(void 0!==d&&0!=d.length){for(var u=0,h=d.length;u<h;++u)r.updateQueryMatchList(e,d[u],o,1);e.scheduled||this.qcm.schedulePathNode(e)}}}})}function internalQCMIndexerDestroyIndexAtNode(e){e.needIndex>0||void 0!==e.subIndexes&&(e.alphabeticRanges=!1,e.subIndexes=void 0)}function internalQCMIndexerExpectAdditionalDataElementNum(e){this.dataElements.expectAdditionalDataElementNum(e)}function internalQCMIndexerExpectNodeNum(e,t){void 0!==e&&e.nodes.expectSize(t)}function internalQCMIndexerExpectAdditionalNodeNum(e,t){void 0!==e&&e.nodes.expectSize(e.nodes.size+t)}function internalQCMIndexerAddNonDataElementNode(e,t){if(!e.nodes.has(t)){var i=this.dataElements.incRef(t),r=this.newElementNode();if(e.nodes.set(t,r),i.children&&i.children.has(e.pathId)){var n=i.children.get(e.pathId);void 0===e.operandCount?e.operandCount=n.ids.size:e.operandCount+=n.ids.size}void 0!==e.parent&&e.parent.subTree&&this.setNewNodeSubTreeRoots(e,r,t,t),this.queueAddedNode(t,e)}}function internalQCMIndexerAddNonDataElementNodes(e,t){var i=void 0!==e.parent&&!!e.parent.subTree,r=e.nodes;r.expectSize(r.size+t.length);for(var n=0,o=t.length;n<o;++n){var s=t[n];if(void 0!==s&&!r.has(s)){this.dataElements.incRef(s);var a=this.newElementNode();r.set(s,a),i&&this.setNewNodeSubTreeRoots(e,a,s,s)}}this.queueAddedNodes(t,e)}function internalQCMIndexerAddDataElementNode(e,t,i,r,n,o){if(e.nodes.has(t))return void 0!==r&&this.setBaseIdentityForExistingNode(t,r),e.nodes.get(t);this.dataElements.addNewDataElement(e.pathId,t,i,r,n,o);var s=this.newElementNode();return e.nodes.set(t,s),void 0!==i&&e.nodes.has(i)&&(void 0===e.operandCount?e.operandCount=1:e.operandCount++,"object"==typeof e.nodes.get(i).key&&(s.rangeNodeId=i)),this.setNewNodeSubTreeRoots(e,s,t,i),this.queueAddedNode(t,e),s}function internalQCMIndexerNewElementNode(){return new IndexerElementNode}function IndexerElementNode(){this.type=void 0,this.key=void 0}function internalQCMIndexerRemoveNode(e,t){var i=e.nodes.get(t);if(i){if(this.inSubTree(i)&&(this.removeSubTreeNode(i,e,t),e.numSubTreeMonitors>0&&t in e.subTreeRootUpdateIds&&delete e.subTreeRootUpdateIds[t]),e.operandCount){var r=this.dataElements.getParentId(t);void 0!==r&&e.nodes.has(r)&&e.operandCount--;e.operandCount-=this.numOperandDataElements(t,e.pathId)}this.queueRemovedNode(t,e,i),e.nodes.delete(t),this.removeKeysOfRemovedNodes(e,t,i)}}function internalQCMIndexerRemoveNodes(e,t){var i=!!e.subTree;e.nodes.suspendMinFill();for(var r=0,n=t.length;r<n;++r){var o=t[r];if(void 0!==o){var s=e.nodes.get(o);if(void 0!==s){if(i&&this.inSubTree(s)&&(this.removeSubTreeNode(s,e,o),e.numSubTreeMonitors>0&&o in e.subTreeRootUpdateIds&&delete e.subTreeRootUpdateIds[o]),e.operandCount){var a=this.dataElements.getParentId(dataElementId);void 0!==a&&e.nodes.has(a)&&e.operandCount--;e.operandCount-=this.numOperandDataElements(dataElementId,e.pathId)}this.queueRemovedNode(o,e,s),e.nodes.delete(o),this.removeKeysOfRemovedNodes(e,o,s)}}}e.nodes.resetMinFill()}function internalQCMIndexerQueueAddedNode(e,t){if(void 0!==t.removedSubTrees&&t.removedSubTrees.size&&t.removedSubTrees.has(e)){var i=t.removedSubTrees.get(e);this.registerSubTreeRetrievalOnNode(t,e,void 0,void 0,i),t.removedSubTrees.delete(e)}return void 0!==t.removedNodes&&t.removedNodes.has(e)?void t.removedNodes.delete(e):void(void 0!==t.nonIndexedQueryCalcs&&0!==t.nonIndexedQueryCalcs.size&&(void 0===t.addedNodes&&(t.addedNodes=new Map),t.addedNodes.set(e,!0),t.scheduled||this.qcm.schedulePathNode(t)))}function internalQCMIndexerQueueAddedNodes(e,t){var i;if(void 0!==t.removedSubTrees&&0!==t.removedSubTrees.size)for(var r=0,n=e.length;r<n;++r){var o=e[r];if(void 0!==o&&t.removedSubTrees.has(o)){var s=t.removedSubTrees.get(o);this.registerSubTreeRetrievalOnNode(t,o,void 0,void 0,s),delete t.removedSubTrees.delete(o)}}if(void 0!==t.removedNodes){i=[];for(var r=0,n=e.length;r<n;++r){var o=e[r];void 0!==o&&(t.removedNodes.has(o)||i.push(o),t.removedNodes.delete(o))}}else i=e;if(void 0!==t.nonIndexedQueryCalcs&&0!==t.nonIndexedQueryCalcs.size&&0!==i.length){void 0===t.addedNodes&&(t.addedNodes=new Map);for(var r=0,n=i.length;r<n;++r){var o=i[r];void 0!==o&&t.addedNodes.set(o,!0)}
t.scheduled||this.qcm.schedulePathNode(t)}}function internalQCMIndexerQueueRemovedNode(e,t,i){return this.dataElements.releaseDataElement(e),void 0!==t.addedNodes&&t.addedNodes.has(e)?void t.addedNodes.delete(e):(i.subTree&&(t.removedSubTrees||(t.removedSubTrees={}),t.removedSubTrees[e]=i.subTree),void(void 0!==t.nonIndexedQueryCalcs&&0!==t.nonIndexedQueryCalcs.size&&(void 0===t.removedNodes&&(t.removedNodes=new Map),t.removedNodes.set(e,!0),t.scheduled||this.qcm.schedulePathNode(t))))}function internalQCMIndexerRemoveAllNodesOnPathNode(e){var t=this.dataElements;e.nodes.forEach(function(e,i){t.releaseDataElement(i)}),e.nodes=new IntHashMap}function internalQCMIndexerGetDataNodesAtPath(e){var t=this.pathNodesById[e];return t?t.nodes:new IntHashMap}function internalQCMIndexerGetPrevKeysAtPath(e){var t=this.pathNodesById[e];if(t)return t.prevKeys}function internalQCMIndexerFilterDataNodesAtPath(e,t,i,r){var n=this.pathNodesById[e];if(!n)return[];var o=[],s=n.nodes,a=i?void 0:n.addedNodes,d=r?void 0:n.removedNodes;if(void 0===d&&void 0===a)for(var u=0,h=t.length;u<h;++u){var l=t[u];void 0!==l&&s.has(l)&&o.push(l)}else if(void 0!==d&&void 0===a)for(var u=0,h=t.length;u<h;++u){var l=t[u];void 0!==l&&(s.has(l)||d.has(l))&&o.push(l)}else if(void 0===d&&void 0!==a)for(var u=0,h=t.length;u<h;++u){var l=t[u];void 0!==l&&s.has(l)&&!a.has(l)&&o.push(l)}else for(var u=0,h=t.length;u<h;++u){var l=t[u];void 0!==l&&(s.has(l)&&!a.has(l)||d.has(l))&&o.push(l)}return o}function internalQCMIndexerFilterDataNodesAtPathWithDiff(e,t,i,r){var n=this.pathNodesById[e];if(!n)return[];var o=[],s=[],a=n.nodes,d=i?void 0:n.addedNodes,u=r?void 0:n.removedNodes;if(void 0===u&&void 0===d)for(var h=0,l=t.length;h<l;++h){var c=t[h];void 0!==c&&(a.has(c)?o.push(c):s.push(c))}else if(void 0!==u&&void 0===d)for(var h=0,l=t.length;h<l;++h){var c=t[h];void 0!==c&&(a.has(c)||u.has(c)?o.push(c):s.push(c))}else if(void 0===u&&void 0!==d)for(var h=0,l=t.length;h<l;++h){var c=t[h];void 0!==c&&(a.has(c)&&!d.has(c)?o.push(c):s.push(c))}else for(var h=0,l=t.length;h<l;++h){var c=t[h];void 0!==c&&(a.has(c)&&!d.has(c)||u.has(c)?o.push(c):s.push(c))}return{matches:o,removed:s}}function internalQCMIndexerFilterDataNodesAtPathPositions(e,t){var i=this.pathNodesById[e];if(!i)return[];var r=[],n=i.nodes;if(void 0===i.removedNodes&&void 0===i.addedNodes)for(var o=0,s=t.length;o<s;++o){var a=t[o];void 0!==a&&n.has(a)&&r.push(o)}else if(void 0!==i.removedNodes&&void 0===i.addedNodes)for(var o=0,s=t.length;o<s;++o){var a=t[o];void 0!==a&&(n.has(a)||i.removedNodes.has(a))&&r.push(o)}else if(void 0===i.removedNodes&&void 0!==i.addedNodes)for(var o=0,s=t.length;o<s;++o){var a=t[o];void 0!==a&&n.has(a)&&!i.addedNodes.has(a)&&r.push(o)}else for(var o=0,s=t.length;o<s;++o){var a=t[o];void 0!==a&&(n.has(a)&&!i.addedNodes.has(a)||i.removedNodes.has(a))&&r.push(o)}return r}function internalQCMIndexerGetDataElements(){return this.dataElements}function internalQCMIndexerGetDirectChildDataElements(e,t){return this.dataElements.getDirectChildDataElements(e,t)}function internalQCMIndexerGetDirectChildDataElementsAsObj(e,t){return this.dataElements.getDirectChildDataElementsAsObj(e,t)}function internalQCMIndexerHasDirectChildDataElements(e,t){return this.dataElements.hasDirectChildDataElements(e,t)}function internalQCMIndexerGetAllDominatedDataElements(e,t){return this.dataElements.getAllDominatedDataElements(e,t)}function internalQCMIndexerGetOperandDataElements(e,t){return this.dataElements.getDirectChildDataElementsAsObj(e,t)}function internalQCMIndexerGetAllDirectOperands(e,t){if(this.pathHasOperands(t)){for(var i=[],r=0,n=e.length;r<n;++r){var o=e[r],s=this.dataElements.getDirectChildDataElements(o,t);void 0!==s&&(i[r]=s)}if(0!=i.length)return i}}function internalQCMIndexerGetAllDirectOperandsFlat(e,t){if(this.pathHasOperands(t)){for(var i=[],r=0,n=e.length;r<n;++r){var o=e[r];if(void 0!==o){var s=this.dataElements.getDirectChildDataElementsAsObj(o,t);void 0!==s&&s.forEach(function(e,t){i.push(t)})}}if(0!=i.length)return i}}function internalQCMIndexerNumOperandDataElements(e,t){return this.dataElements.getNumDirectChildDataElements(e,t)}function internalQCMIndexerIsNonEmptyOperator(e,t){return this.dataElements.hasDirectChildDataElements(e,t)}function internalQCMIndexerIsOperand(e,t){var i=this.pathNodesById[t];if(!i.operandCount)return!1;var r=this.dataElements.getEntry(e);return r.pathId==t&&void 0!==r.parent&&i.nodes.has(r.parent)}function internalQCMIndexerIsActive(e,t,i){if(this.isRangeKey(i.key)){if(!i.key.isActive())return!1;if(i.key.isEmpty()&&this.numOperandDataElements(t,e.pathId)>0)return!1}if(!i.rangeNodeId)return!0;var r=e.nodes.get(i.rangeNodeId).key;return r.isEmpty()||!r.isActive()}function internalQCMIndexerDeactivateNode(e,t,i,r,n){if(e.nodes.has(t)){var o=e.nodes.get(t);if(this.isRangeKey(o.key)&&o.key.isEmpty()&&e.operandCount){var s;if(s=this.getOperandDataElements(t,e.pathId)){var a=this;return void s.forEach(function(t,i){var r=e.nodes.get(i);void 0!==r&&a.deactivateNode(e,i,r.type,r.key,r.hasAttrs)})}}void 0!==e.addedNodes&&e.addedNodes.has(t)?e.addedNodes.delete(t):void 0!==e.nonIndexedQueryCalcs&&e.nonIndexedQueryCalcs.size>0&&(void 0===e.removedNodes&&(e.removedNodes=new Map),e.removedNodes.set(t,!0)),void 0!==e.keyUpdateQueryCalcs&&e.keyUpdateQueryCalcs.size>0&&this.preservePreviousKey(e,t,i,r,n),void 0!==e.subIndexes&&void 0!==i&&this.removeFromSubIndex(e,t,i,r),this.inSubTree(o)&&this.removeSubTreeNode(o,e,t)}}function internalQCMIndexerActivateNode(e,t,i){if(this.isRangeKey(i.key)&&i.key.isEmpty()&&e.operandCount){var r;if(r=this.getOperandDataElements(t,e.pathId)){var n=this;return void r.forEach(function(t,i){var r=e.nodes.get(i);void 0!==r&&n.activateNode(e,i,r)})}}if(void 0!==e.removedNodes&&e.removedNodes.has(t)?e.removedNodes.delete(t):void 0!==e.nonIndexedQueryCalcs&&e.nonIndexedQueryCalcs.size>0&&(void 0===e.addedNodes&&(e.addedNodes=new Map),e.addedNodes.set(t,!0)),void 0!==e.subIndexes&&void 0!==i.type&&this.addToSubIndex(e,t,i.type,i.type,void 0),e.subTree||void 0!==e.parent&&e.parent.subTree){var o=this.dataElements.getEntry(t),s=o.pathId===e.pathId?o.parent:t;this.setNewNodeSubTreeRoots(e,i,t,s),this.inSubTree(i)&&this.updateSubTrees(e.pathId,t,i)}}function internalQCMIndexerDeactivateRangeNode(e,t,i,r,n,o){i.type=i.key.getType(),this.deactivateNode(e,t,r,n,o);var s;if(e.operandCount&&(s=this.getOperandDataElements(t,e.pathId))){var a=this;s.forEach(function(t,i){var r=e.nodes.get(i);void 0!==r&&a.activateNode(e,i,r)}),e.subTree&&this.inSubTree(i)&&this.extendSubTreesToOperandChildren(e,i,t)}}function internalQCMIndexerActivateRangeNode(e,t,i){i.type=i.key.getType(),this.activateNode(e,t,i);var r;if(e.operandCount&&(r=this.getOperandDataElements(t,e.pathId))){var n=this;r.forEach(function(t,i){var r=e.nodes.get(i);void 0!==r&&(e.subTree&&n.clearSubTrees(e,i,r),n.deactivateNode(e,i,r.type,r.key,r.hasAttrs))})}}function internalQCMIndexerGetChildPaths(e){var t=this.pathNodesById[e];if(void 0!==t){var i={};for(var r in t.children)i.push({childPathId:t.children[r].pathId,attr:r});return i}}function internalQCMIndexerPathHasOperands(e){var t=this.pathNodesById[e];return void 0!==t&&t.operandCount>0}function internalQCMIndexerPathHasDataElements(e){var t=this.pathNodesById[e];return void 0!==t&&t.hasDataElements}function internalQCMIndexerRaiseToOperator(e,t){var i=this.pathNodesById[t];if(void 0===i||!i.operandCount)return e;for(var r=this.dataElements.getParentId(e);void 0!==r&&i.nodes.has(r);)e=r,r=this.dataElements.getParentId(e);return e}function internalQCMIndexerRaiseElementsToDirectOperators(e,t){var i=this.pathNodesById[t];if(void 0!==i&&i.operandCount){for(var r=[],n=[],o=0,s=e.length;o<s;++o){var a=this.dataElements.getParentId(elementId[o]);void 0!==a&&i.nodes.has(a)&&(r.push(o),n.push(operatorid))}return 0==r.length?void 0:{pos:r,operators:n}}}function internalQCMIndexerRaiseElementsToOperators(e,t){var i=this.pathNodesById[t];if(void 0===i||!i.operandCount)return e;for(var r=[],n=new Map,o=0,s=e.length;o<s;++o){for(var a=e[o],d=a,u=this.dataElements.getParentId(d);void 0!==u&&i.nodes.has(u);)d=u,u=this.dataElements.getParentId(d);if(d!==a){if(n.has(d))continue;n.set(d,!0)}r.push(d)}return r}function internalQCMIndexerRaiseToAllOperators(e,t){var i=this.pathNodesById[t];if(void 0!==i&&i.operandCount){for(var r=[],n=this.dataElements.getParentId(e);void 0!==n&&i.nodes.has(n);)r.push(n),n=this.dataElements.getParentId(n);return 0===r.length?void 0:r}}function internalQCMIndexerRaiseToPath(e,t){return this.dataElements.raiseToPath(e,t)}function internalQCMIndexerRaiseAllToPath(e,t,i){return this.hasLowerDataElements(i,t)?this.dataElements.raiseAllToPath(e,t):e}function internalQCMIndexerGetChildDataElements(e,t,i,r){var n;if(r){var o=this.pathNodesById[e];if(!o||0==o.nodes.size)return[];n=o.nodes}var s=this.dataElements.getChildDataElements(e,t,i);if(!r)return s;for(var a=[],d=0,u=s.length;d<u;++d){var h=s[d];n.has(h)&&a.push(h)}return a}function internalQCMIndexerGetDominatedNodes(e,t,i){return this.getChildDataElements(e,t,i,!0)}function internalQCMIndexerGetAllDirectChildren(e,t,i){var r=this.pathNodesById[t];if(void 0!==r)return r.hasDataElements?this.getAllDirectChildrenWithDataElements(e,r,i,!1):this.getAllDirectChildrenNoDataElements(e,r,i,!1)}function internalQCMIndexerGetAllDirectChildrenFlat(e,t,i){var r=this.pathNodesById[t];if(void 0!==r)return r.hasDataElements?this.getAllDirectChildrenWithDataElements(e,r,i,!0):this.getAllDirectChildrenNoDataElements(e,r,i,!0)}function internalQCMIndexerGetAllDirectChildrenNoDataElements(e,t,i,r){var n=t.nodes,o=t.removedNodes,s=i||void 0===o?0:o.size,a=t.addedNodes,d=i||void 0===a?0:a.size;if(n.size+s-d!==0){var u=[];if(0===s&&0===d)if(r)for(var h=0,l=e.length;h<l;++h){var c=e[h];void 0!==c&&n.has(c)&&u.push(c)}else for(var h=0,l=e.length;h<l;++h){var c=e[h];void 0!==c&&n.has(c)&&(u[h]=c)}else for(var h=0,l=e.length;h<l;++h){var c=e[h];void 0!==c&&(s>0&&o.has(c)||n.has(c)&&(0===d||!a.has(c)))&&(r?u.push(c):u[h]=c)}if(0!==u.length)return r?u:{hasDataElements:!1,childIds:u}}}function internalQCMIndexerGetAllDirectChildrenWithDataElements(e,t,i,r){var n=t.nodes,o=t.removedNodes,s=i||void 0===o?0:o.size,a=t.addedNodes,d=i||void 0===a?0:a.size;if(n.size+s-d!==0){for(var u=[],h=0,l=e.length;h<l;++h){var c=e[h];if(void 0!==c)if(s>0&&o.has(c)||n.has(c)&&(0===d||!a.has(c)))r?u.push(c):u[h]=[c];else{var p=this.dataElements.getDirectChildDataElements(c,t.pathId);if(void 0!==p&&d>0){for(var f=0,v=0,g=p.length;v<g;++v)a.has(p[v])||(f!==v&&(p[f]=p[v]),f++);f<p.length&&(p.length=f)}void 0!==p&&p.length>0&&(r?u=cconcat(u,p):u[h]=p)}}if(0!=u.length)return r?u:{hasDataElements:!0,childIds:u}}}function internalQCMIndexerHasLowerDataElements(e,t){if(e==t)return!1;var i=this.pathNodesById[e];if(void 0===i)return!1;for(;i.pathId!=t;){if(i.hasDataElements)return!0;if(i=i.parent,void 0===i)return!1}return!1}function internalQCMIndexerLowerDataElementsTo(e,t){return this.dataElements.lowerDataElementsTo(e,t)}function internalQCMIndexerGetParentDataElement(e){return this.dataElements.getParentId(e)}function internalQCMIndexerGetDataElementPathId(e){return this.dataElements.getPathId(e)}function internalQCMIndexerFilterDataElementsUnderPathId(e,t){return this.dataElements.filterDataElementsUnderPathId(e,t)}function internalQCMIndexerGetPrevKey(e,t){return void 0!==e.prevKeys&&e.prevKeys.has(t)?e.prevKeys.get(t):e.nodes.get(t)}function internalQCMIndexerGetKnownKey(e,t){if(void 0===e.addedNodes||!e.addedNodes.has(t))return void 0!==e.prevKeys&&e.prevKeys.has(t)?e.prevKeys.get(t):e.nodes.get(t)}function internalQCMIndexerGetNodeValues(e,t){var i={keys:[],types:[],hasAttrs:[]},r=this.pathNodesById[e];if(void 0===r)return i;for(var n=r.nodes,o=0,s=t.length;o<s;++o){var a=t[o];if(void 0!==a&&n.has(a)){var d=n.get(a);i.keys[o]=d.key,i.types[o]=d.type,i.hasAttrs[o]=d.hasAttrs}}return i}function internalQCMIndexerGetKnownNodeValues(e,t){var i=this.pathNodesById[e];if(void 0===i)return{keys:[],types:[],hasAttrs:[]};if(void 0===i.addedNodes&&void 0===i.prevKeys)return this.getNodeValues(e,t);var r,n,o={keys:[],types:[],hasAttrs:[]},s=i.nodes,a=i.addedNodes,d=i.prevKeys;if(void 0===a){for(var u=0,h=t.length;u<h;++u)if(void 0!==(n=t[u])){if(d.has(n))r=d.get(n);else{if(!s.has(n))continue;r=s.get(n)}o.keys[u]=r.key,o.types[u]=r.type,o.hasAttrs[u]=r.hasAttrs}}else if(void 0===d)for(var u=0,h=t.length;u<h;++u)void 0!==(n=t[u])&&!a.has(n)&&s.has(n)&&(r=s.get(n),o.keys[u]=r.key,o.types[u]=r.type,o.hasAttrs[u]=r.hasAttrs);else for(var u=0,h=t.length;u<h;++u)if(void 0!==(n=t[u])&&!a.has(n)){if(d.has(n))r=d.get(n);else{if(!s.has(n))continue;r=s.get(n)}o.keys[u]=r.key,o.types[u]=r.type,o.hasAttrs[u]=r.hasAttrs}return o}function internalQCMIndexerGetNodeNonAttrs(e,t){var i=[],r=this.pathNodesById[e];if(void 0===r)return i;for(var n=0,o=t.length;n<o;++n){var s=t[n];if(void 0!==s){var a=r.nodes.get(s);void 0!==a.nonAttrs&&(i[n]=a.nonAttrs)}}return i}function internalQCMIndexerUpdateEpilogForPathNode(e){if(debugStartTimer("query","path node update epilog"),void 0!==e.addedNodes&&(this.addMatchesToNoIndexQueries(e,e.addedNodes),e.addedNodes=void 0),this.updateQueryMatches(e),void 0!==e.removedNodes&&(this.removeMatchesFromNoIndexQueries(e,e.removedNodes),e.removedNodes=void 0),void 0!==e.removedSubTrees){for(var t in e.removedSubTrees)e.removedSubTrees[t].destroy();e.removedSubTrees=void 0}this.forwardKeyUpdates(e),e.subTree&&this.subTreeUpdateEpilog(e),e.prevKeys=void 0,debugStopTimer("path node update epilog")}function internalQCMIndexerSubTreeUpdateEpilog(e){if(e.subTreeRootUpdateIds||e.subTreeMonitorUpdateIds){var t;if(e.subTreeMonitorUpdateIds){for(var i in e.subTreeMonitorUpdateIds){var r=[];t||(t={});for(var n in e.subTreeMonitorUpdateIds[i]){if(!(n in t)){t[n]=!0;var o=e.nodes.get(n);o&&o.subTree&&o.subTree.completeUpdate(i)}r.push(n)}var s=e.subTreeMonitors[i];s.subTreeUpdate(e.pathId,r,i)}e.subTreeMonitorUpdateIds={}}for(var a=e.subTreeRootUpdateIds?Object.keys(e.subTreeRootUpdateIds):[],d=0,u=a.length;d<u;++d){var n=a[d];if(!(t&&n in t)){var o=e.nodes.get(n);o&&o.subTree&&o.subTree.completeUpdate()}}for(var i in e.subTreeMonitors){var s=e.subTreeMonitors[i];s.subTreeUpdate(e.pathId,a,i)}e.subTreeRootUpdateIds={}}}function internalQCMIndexerGetMatchPoints(e,t){for(var i=[],r=this.pathNodesById[t],n=e.getId();r;)r.hasDataElements&&i.push(r.pathId),r.notifyWithElements||(r.notifyWithElements={}),r.notifyWithElements[n]=e,r=r.parent;return i}function internalQCMIndexerNotifyPathHasDataElements(e){var t=this.pathNodesById[e];if(!t.hasDataElements&&(t.hasDataElements=!0,void 0!==t.notifyWithElements))for(var i in t.notifyWithElements)t.notifyWithElements[i].addToMatchPoints(e,this)}function internalQCMIndexerNotifyPathHasNoDataElements(e){var t=this.pathNodesById[e];if(void 0!==t&&t.hasDataElements&&(t.hasDataElements=!1,void 0!==t.notifyWithElements))for(var i in t.notifyWithElements)t.notifyWithElements[i].removeFromMatchPoints(e,this)}function internalQCMIndexerRemoveMatchPointsNotifications(e,t){if(e.notifyWithElements)for(;e&&e.notifyWithElements[t];)delete e.notifyWithElements[t],e=e.parent}function internalQCMIndexerSetKeyValue(e,t,i,r,n){this.updateKeyOnNode(e,t,i,r,n)}function internalQCMIndexerPushOnKeyUpdateQueue(e,t,i,r,n,o){var s;(s=e.keyUpdateQueue)||(s=e.keyUpdateQueue={elementIds:[],types:[],keys:[],prevTypes:[],prevKeys:[]}),s.elementIds.push(t),s.types.push(i),s.keys.push(r),s.prevTypes.push(n),s.prevKeys.push(o),e.scheduled||this.qcm.schedulePathNode(e)}function internalQCMIndexerPreservePreviousKey(e,t,i,r,n){if(void 0===e.prevKeys)e.prevKeys=new Map;else if(e.prevKeys.has(t))return;"object"==typeof r&&(r=r.simpleCopy()),e.prevKeys.set(t,{type:i,key:r,hasAttrs:n})}function internalQCMIndexerGetPrevKeyObj(e){return void 0===e.prevKeys&&(e.prevKeys=new Map),e.prevKeys}function internalQCMIndexerRemoveKeysOfRemovedNodes(e,t,i){var r=this.isActive(e,t,i);if(i.rangeNodeId){var n="object"==typeof i.key?i.key.getKeyUpdate(!0):[t];this.removeKeysFromRangeNode(e,i.rangeNodeId,i.type,n)}r&&this.removeKeyFromNode(e,t,i.type,i.key,i.hasAttrs,!0)}function internalQCMIndexerUpdateKeyOnNode(e,t,i,r,n){return"attribute"==i?(this.updateHasAttrOnNode(e,t,r),void(!n&&void 0!==e.keyUpdateQueryCalcs&&e.keyUpdateQueryCalcs.size>0&&this.pushOnKeyUpdateQueue(e,t,"attribute",r))):"nonAttribute"==i?(this.updateNonAttrOnNode(e,t,r),void(!n&&void 0!==e.keyUpdateQueryCalcs&&e.keyUpdateQueryCalcs.size>0&&this.pushOnKeyUpdateQueue(e,t,"nonAttribute",r))):t<0?void this.removeKeyFromNode(e,-t,i,r,void 0,!1):void this.addKeyToNode(e,t,i,r,n)}function internalQCMIndexerAddKeyToNode(e,t,i,r,n){if("range"==i)return void this.setNodeAsRangeNode(e,t,r);if(void 0===i)return void this.removeKeyFromNode(e,t,i,r,void 0,!1);if("object"==typeof r){if(r instanceof RegExp)return;return void this.addKeysToRangeNode(e,t,i,r,!1)}if(e.nodes.has(t)){var o=e.nodes.get(t);if(i!=o.type||r!=o.key){!n&&void 0!==e.keyUpdateQueryCalcs&&e.keyUpdateQueryCalcs.size>0&&this.preservePreviousKey(e,t,o.type,o.key,o.hasAttrs);var s=o.type,a=o.key;o.type=i,o.key=r,o.rangeNodeId&&(this.addKeysToRangeNode(e,o.rangeNodeId,i,[t,r],!0),!this.isActive(e,t,o))||(!n&&void 0!==e.keyUpdateQueryCalcs&&e.keyUpdateQueryCalcs.size>0&&this.pushOnKeyUpdateQueue(e,t,i,r,s,a),void 0!==e.subIndexes&&(i!==s&&s?(this.removeFromSubIndex(e,t,s,a),this.addToSubIndex(e,t,i,r,void 0)):this.addToSubIndex(e,t,i,r,a)),this.inSubTree(o)&&(this.isOperatorType(i)&&!this.isOperatorType(s)&&this.extendSubTreesToOperandChildren(e,o,t),this.updateSubTrees(e.pathId,t,o)))}}}function internalQCMIndexerRemoveKeyFromNode(e,t,i,r,n,o){if(!o){if("object"==typeof r)return void this.removeKeysFromRangeNode(e,t,i,r);var s=e.nodes.get(t);if(void 0===s.key)return;if(r=s.key,i=s.type,n=s.hasAttrs,"object"==typeof r)return void this.removeKeysFromRangeNode(e,t,i,r);var a=this.isActive(e,t,s);if(s.key=void 0,s.type=void 0,a&&this.inSubTree(s)&&this.updateSubTrees(e.pathId,t,s),s.rangeNodeId)return this.removeKeysFromRangeNode(e,s.rangeNodeId,i,[t]),void(a&&this.deactivateNode(e,t,i,r,n))}void 0!==e.keyUpdateQueryCalcs&&e.keyUpdateQueryCalcs.size>0&&this.preservePreviousKey(e,t,i,r,n),void 0!==e.subIndexes&&void 0!==r&&this.removeFromSubIndex(e,t,i,r)}function internalQCMIndexerSetNodeAsRangeNode(e,t,i){if(e.nodes.has(t)){var r=e.nodes.get(t);if(void 0===i&&(i=[!1,!1]),this.isRangeKey(r.key)){if(r.key.getMinOpen()==i[0]&&r.key.getMaxOpen()==i[1])return;var n,o;return r.key.isActive()&&(n=r.key.simpleCopy(),o=r.type),r.key.setMinOpen(i[0]),r.key.setMaxOpen(i[1]),void(!r.key.isEmpty()&&this.isActive(e,t,r)&&this.refreshRangeNodeAfterUpdate(e,t,r,!0,o,n,r.hasAttrs))}void 0!==r.key&&this.removeKeyFromNode(e,t,r.type,r.key,r.hasAttrs,!1),r.key=new RangeKey(i[0],i[1]),r.type="range";var s;e.operandCount&&(s=this.getOperandDataElements(t,e.pathId))&&this.addOperandsToRange(e,t,r,s)}}function internalQCMIndexerAddOperandsToRange(e,t,i,r){var n=[],o=void 0,s=[],a=this;if(r.forEach(function(i,r){var d=e.nodes.get(r);if(d&&(s.push(r,d),d.rangeNodeId=t,void 0!==d.type))if(a.isRangeKey(d.key)){if(d.key.isEmpty())return;a.addKeysToRangeNode(e,t,d.type,d.key,!0)}else void 0!==o&&d.type==o||(n.length&&(a.addKeysToRangeNode(e,t,o,n,!0),n.length=0),o=d.type),n.push(r,d.key)}),this.addKeysToRangeNode(e,t,o,n,!0),i.key.isActive())for(var d=0,u=s.length;d<u;d+=2)this.deactivateNode(e,s[d],s[d+1].type,s[d+1].key,s[d+1].hasAttrs)}function internalQCMIndexerAddKeysToRangeNode(e,t,i,r,n){var o,s,a;if(o=e.nodes.get(t)){var d=o.type,u=o.key;"object"!=typeof o.key?(void 0!==o.key&&this.removeKeyFromNode(e,t,o.type,o.key,o.hasAttrs,!1),o.key=new RangeKey,o.type="range"):(o.key.isActive()&&!o.key.isEmpty()?u=o.key.simpleCopy():(d=void 0,u=void 0),n||o.key.getType()==i||(o.rangeNodeId&&this.removeKeysFromRangeNode(e,o.rangeNodeId,i,r),o.key=new RangeKey,o.type="range")),o.rangeNodeId&&this.addKeysToRangeNode(e,o.rangeNodeId,i,r,!0);var h=this.isActive(e,t,o);if(isArray(r)){if(0==r.length)return;for(s=0,a=r.length;s<a;s+=2)o.key.add(i,r[s],r[s+1])}else if(n){if(r.isEmpty())return;o.key.addFromRangeKey(r)}else if(o.key.isEmpty()||this.removeKeysFromRangeNode(e,t,o.type,o.key),o.key.setMinOpen(r.getMinOpen()),o.key.setMaxOpen(r.getMaxOpen()),r.isEmpty())return;this.refreshRangeNodeAfterUpdate(e,t,o,h,d,u,o.hasAttrs)}}function internalQCMIndexerRemoveKeysFromRangeNode(e,t,i,r){var n=e.nodes.get(t);if(n&&"object"==typeof n.key){var o=this.isActive(e,t,n);o&&void 0!==e.keyUpdateQueryCalcs&&e.keyUpdateQueryCalcs.size>0&&this.preservePreviousKey(e,t,n.type,n.key,n.hasAttrs),n.rangeNodeId&&this.removeKeysFromRangeNode(e,n.rangeNodeId,i,r);var s,a;if(o&&(a=n.type,s=n.key.simpleCopy()),isArray(r))for(var d=0,u=r.length;d<u;++d)n.key.remove(r[d]);else n.key.removeByRangeKey(r);this.refreshRangeNodeAfterUpdate(e,t,n,o,a,s,n.hasAttrs)}}function internalQCMIndexerRefreshRangeNodeAfterUpdate(e,t,i,r,n,o,s){r&&void 0!==o&&void 0!==e.keyUpdateQueryCalcs&&e.keyUpdateQueryCalcs.size>0&&this.preservePreviousKey(e,t,n,o,s);var a=this.isActive(e,t,i);if(!r){if(!a)return;return void this.activateRangeNode(e,t,i)}return this.isActive(e,t,i)?(void 0!==e.keyUpdateQueryCalcs&&e.keyUpdateQueryCalcs.size>0&&this.pushOnKeyUpdateQueue(e,t,i.key.getType(),i.key.simpleCopy(),n,o),i.type=i.key.getType(),void 0===e.subIndexes&&!e.subTree||n==i.type&&"object"==typeof o&&o.getMinKey()==i.key.getMinKey()&&o.getMaxKey()==i.key.getMaxKey()&&o.getMinOpen()==i.key.getMinOpen()&&o.getMaxOpen()==i.key.getMaxOpen()||(this.inSubTree(i)&&this.updateSubTrees(e.pathId,t,i),void 0!==e.subIndexes&&(void 0!==n&&n!==i.type&&(this.removeFromSubIndex(e,t,n,o),this.addToSubIndex(e,t,i.type,i.key,void 0)),void 0!==i.type&&this.addToSubIndex(e,t,i.type,i.key,o))),!0):void this.deactivateRangeNode(e,t,i,n,o,s)}function internalQCMIndexerUpdateHasAttrOnNode(e,t,i){var r=e.nodes.get(t);if(r){if(i===!1){if(!r.hasAttrs)return;if(r.hasAttrs=!1,e.subTree&&this.inSubTree(r)){for(var n in e.children)void 0!==r.nonAttrs&&r.nonAttrs.has(n)||this.detachSubTreesFromChild(e.children[n],t,r);this.inSubTreeWithAttrDeactivated(e,t)}return void(void 0!==e.keyUpdateQueryCalcs&&e.keyUpdateQueryCalcs.size>0&&this.preservePreviousKey(e,t,r.type,r.key,!0))}if(!r.hasAttrs){if(r.hasAttrs=!0,e.subTree&&this.inSubTree(r)){for(var n in e.children)void 0!==r.nonAttrs&&r.nonAttrs.has(n)||this.extendSubTreesToChild(e.children[n],t,r);this.inSubTreeWithAttrActivated(e,t)}void 0!==e.keyUpdateQueryCalcs&&e.keyUpdateQueryCalcs.size>0&&this.preservePreviousKey(e,t,r.type,r.key,!1)}}}function internalQCMIndexerUpdateNonAttrOnNode(e,t,i){var r;if(t<0)return t=-t,void(void 0!==(r=e.nodes.get(t))&&void 0!==r.nonAttrs&&r.nonAttrs.has(i)&&(1==r.nonAttrs.size?r.nonAttrs=void 0:r.nonAttrs.delete(i),i in e.children&&this.extendSubTreesToChild(e.children[i],t,r)));if(r=e.nodes.get(t)){if(void 0===i){if(void 0===r.nonAttrs)return;if(e.subTree&&this.inSubTree(r)){r.nonAttrs.forEach(function(i,n){n in e.children&&this.extendSubTreesToChild(e.children[n],t,r)})}return void(r.nonAttrs=void 0)}if(void 0===r.nonAttrs)r.nonAttrs=new Map,r.nonAttrs.set(i,!0);else{if(r.nonAttrs.has(i))return;r.nonAttrs.set(i,!0)}e.subTree&&this.inSubTree(r)&&i in e.children&&this.detachSubTreesFromChild(e.children[i],t,r)}}function internalQCMIndexerHasAttrs(e){return!!e.hasAttrs}function internalQCMIndexerUpdateQueryMatches(e){void 0!==e.queryMatchList&&e.queryMatchList.forEach(function(t,i){e.queryCalcs.get(i).updateMatchCount(t)}),e.queryMatchList=new IntHashMap}function internalQCMIndexerForwardKeyUpdates(e){var t;void 0!==(t=e.keyUpdateQueue)&&0!=t.elementIds.length&&(void 0!==e.keyUpdateQueryCalcs&&e.keyUpdateQueryCalcs.size>0&&e.keyUpdateQueryCalcs.forEach(function(e,i){e.updateKeys(t.elementIds,t.types,t.keys,t.prevTypes,t.prevKeys)}),e.keyUpdateQueue=void 0)}function internalQCMIndexerHasRangeValues(e,t){var i=this.pathNodesById[e],r=this.getSubIndex(i,t,!1);return!!r&&r.hasRangeValues()}function internalQCMIndexerGetSubIndex(e,t,i){"strMatch"==t&&(t="string");var r=e.subIndexes?e.subIndexes[t]:void 0;if(r||!i)return r;if(this.discreteSubIndexTypes(e,t))return e.subIndexes[t]=new DiscreteSubIndex;if(!this.isUnindexedType(t))return r=e.subIndexes[t]=new LinearSubIndex(t in this.alphabeticTypes?LinearSubIndex.stringCompare:void 0)}function internalQCMIndexerDiscreteSubIndexTypes(e,t){return"boolean"==t||this.isElementReferenceType(t)||!e.alphabeticRanges&&t in this.alphabeticTypes}function internalQCMIndexerAddToSubIndex(e,t,i,r,n){var o,s,a;if(o=this.getSubIndex(e,i,!0)){var d,u,h,l,c;if(void 0!==n&&("object"==typeof r?(u=n.getMinKey(),h=n.getMaxKey(),l=n.getMinOpen(),c=n.getMaxOpen()):u=n),"object"==typeof r){if(!o.supportsIntervals()){var p=e.subIndexes[i]=new LinearSubIndex(LinearSubIndex.stringCompare);p.loadFromDiscrete(o)}d=o.addValue(t,r.getMinKey(),u,r.getMaxKey(),h,r.getMinOpen(),l,r.getMaxOpen(),c)}else d=o.addValue(t,r,u,void 0,h,void 0,l,void 0,c);var f;if(void 0!==(f=d.added)&&0!=f.length){for(s=0,a=f.length;s<a;++s)this.updateQueryMatchList(e,f[s],t,1);e.scheduled||this.qcm.schedulePathNode(e)}var v;if(void 0!==(v=d.removed)&&0!=v.length){for(s=0,a=v.length;s<a;++s)this.updateQueryMatchList(e,v[s],t,-1);e.scheduled||this.qcm.schedulePathNode(e)}}}function internalQCMIndexerRemoveFromSubIndex(e,t,i,r){var n;if(n=this.getSubIndex(e,i)){var o="object"==typeof r?n.removeValue(t,r.getMinKey(),r.getMaxKey(),r.getMinOpen(),r.getMaxOpen()):n.removeValue(t,r);if(void 0!==o&&0!=o.length){for(var s=0,a=o.length;s<a;++s)this.updateQueryMatchList(e,o[s],t,-1);e.scheduled||this.qcm.schedulePathNode(e)}}}function internalQCMIndexerUpdateQueryMatchList(e,t,i,r){var n,o=e.queryValueIds[t];void 0===(n=e.queryMatchList.get(o))&&(n=new IntHashMap,e.queryMatchList.set(o,n)),n.has(i)?n.set(i,n.get(i)+r):n.set(i,r)}function internalQCMIndexerAddQueryCalcToPathNode(e){debugStartTimer("query","adding query calc to path node");var t=!e.noPathNodeTracing,i=this.shouldIndexForQueryCalc(e),r=e.pathId,n=this.addPath(r);t&&this.incPathNodeTracing(n),i&&this.incPathNodeIndexing(n);var o=e.getId(),s=void 0!==n.queryCalcs&&n.queryCalcs.has(o);return s||(void 0===n.queryCalcs&&(n.queryCalcs=new IntHashMap),n.queryCalcs.set(o,e),e.setMatchPoints&&e.setMatchPoints(this.getMatchPoints(e,r))),e.isSelection()?(n.queryValueIds||(n.queryValueIds={}),void 0!==n.nonIndexedQueryCalcs&&n.nonIndexedQueryCalcs.has(o)&&n.nonIndexedQueryCalcs.delete(o),n.queryMatchList||(n.queryMatchList=new IntHashMap)):(void 0===n.nonIndexedQueryCalcs&&(n.nonIndexedQueryCalcs=new IntHashMap),n.nonIndexedQueryCalcs.set(o,e)),debugStopTimer("adding query calc to path node"),n}function internalQCMIndexerShouldIndexForQueryCalc(e){return!e.doNotIndex&&!e.noPathNodeTracing&&!!e.isSelection&&e.isSelection()}function internalQCMIndexerNeedKeyUpdateForQuery(e){var t=this.pathNodesById[e.pathId],i=e.getId();void 0===t.keyUpdateQueryCalcs&&(t.keyUpdateQueryCalcs=new IntHashMap),t.keyUpdateQueryCalcs.set(i,e)}function internalQCMIndexerStopKeyUpdateForQuery(e){var t=this.pathNodesById[e.pathId],i=e.getId();void 0!==t.keyUpdateQueryCalcs&&(t.keyUpdateQueryCalcs.delete(i),0===t.keyUpdateQueryCalcs.size&&(t.keyUpdateQueryCalcs=void 0))}function internalQCMIndexerUpdateSimpleQuery(e,t,i,r,n){var o=e.pathId,s=this.pathNodesById[o],a=e.getId();t in s.queryValueIds||(s.queryValueIds[t]=a);var d,u,h,l,c,p="object"==typeof r;if(void 0!==n&&("object"==typeof n?(u=n.getMinKey(),h=n.getMaxKey(),l=n.getMinOpen(),c=n.getMaxOpen()):u=n),d=this.getSubIndex(s,i,!0)){p&&d&&!d.supportsIntervals()&&(this.setAlphabeticRanges(s),d=this.getSubIndex(s,i,!0));var f=p?d.addLookup(t,r.getMinKey(),u,r.getMaxKey(),h,r.getMinOpen(),l,r.getMaxOpen(),c):d.addLookup(t,r,u,void 0,h,void 0,l,void 0,c);f&&(void 0!==f.removed&&f.removed.length&&e.removeMatches(f.removed,this),void 0!==f.added&&f.added.length&&e.addMatches(f.added,this))}}function internalQCMIndexerGetSimpleQueryValueMatches(e,t,i,r){var n=e.pathId,o=this.pathNodesById[n],s=this.getSubIndex(o,i,!1);return s?"object"==typeof r?s.getMatches(t,r.getMinKey(),r.getMaxKey(),r.getMinOpen(),r.getMaxOpen()):s.getMatches(t,r,r,!1,!1):[]}function internalQCMIndexerGetSimpleQueryQueuedUpdates(e){var t=this.pathNodesById[e.pathId],i=e.getId();return t.queryMatchList.get(i)}function internalQCMIndexerRemoveQueryCalcFromPathNode(e){var t=e.pathId,i=this.pathNodesById[t];if(i){var r=e.getId();if(void 0!==i.queryCalcs&&i.queryCalcs.has(r)){this.removeMatchPointsNotifications(i,r),i.queryCalcs.delete(r),this.stopKeyUpdateForQuery(e),void 0!==i.nonIndexedQueryCalcs&&i.nonIndexedQueryCalcs.has(r)?i.nonIndexedQueryCalcs.delete(r):this.unregisterQuery(i,e);var n=!e.noPathNodeTracing,o=this.shouldIndexForQueryCalc(e);o&&this.decPathNodeIndexing(i),n&&this.decPathNodeTracing(i)}}}function internalQCMIndexerUnregisterQuery(e,t){if(!t.doNotIndex){for(var i=t.getDisjointValueIds(),r=0,n=i.length;r<n;++r){var o,s,a,d,u=i[r],h=this.getSubIndex(e,u.type,!1);"object"==typeof u.key?(o=u.key.getMinKey(),s=u.key.getMaxKey(),a=u.key.getMinOpen(),d=u.key.getMaxOpen()):o=u.key,h&&h.removeLookup(u.id,o,s,a,d),delete e.queryValueIds[u.id]}var l=t.getId();e.queryMatchList.delete(l)}}function internalQCMIndexerUnregisterQueryValue(e,t,i,r){var n=this.pathNodesById[e.pathId],o=this.getSubIndex(n,i,!1);if(o){var s,a,d,u;"object"==typeof r?(s=r.getMinKey(),a=r.getMaxKey(),d=r.getMinOpen(),u=r.getMaxOpen()):s=r;var h=o.removeLookup(t,s,a,d,u);e.removeMatches(h)}delete n.queryValueIds[t]}function internalQCMIndexerAddMatchesToNoIndexQueries(e,t){if(void 0!==e.nonIndexedQueryCalcs&&0!==e.nonIndexedQueryCalcs.size){var i=e.nonIndexedQueryCalcs,r=[];if(t.forEach(function(e,t){r.push(t)}),r.length){var n=this;i.forEach(function(t,i){e.currentlyUpdatedQueryCalc=i,t.addMatches(r,n),e.currentlyUpdatedQueryCalc=void 0})}}}function internalQCMIndexerFilterNodesJustBeingAdded(e,t){for(var i=this.pathNodesById[e],r=[],n=0,o=t.length;n<o;++n){var s=t[n];i.addedNodes.has(s)&&r.push(s)}return r}function internalQCMIndexerRemoveMatchesFromNoIndexQueries(e,t){if(void 0!==e.nonIndexedQueryCalcs&&0!==e.nonIndexedQueryCalcs.size){var i=e.nonIndexedQueryCalcs,r=[];if(t.forEach(function(e,t){r.push(t)}),r.length){var n=this;i.forEach(function(t,i){e.currentlyUpdatedQueryCalc=-i,t.removeMatches(r,n),e.currentlyUpdatedQueryCalc=void 0})}}}function internalQCMIndexerFilterNodesJustBeingRemoved(e,t){for(var i=this.pathNodesById[e],r=[],n=0,o=t.length;n<o;++n){var s=t[n];i.removedNodes.has(s)&&r.push(s)}return r}function internalQCMIndexerGetAllMatches(e){var t=this.pathNodesById[e],i=[];if(void 0===t)return i;if(void 0!==t.removedNodes&&t.removedNodes.forEach(function(e,t){i.push(t)}),t.operandCount>0){var r=this;void 0!==t.addedNodes?t.nodes.forEach(function(e,n){!t.addedNodes.has(n)&&r.isActive(t,n,e)&&i.push(n)}):t.nodes.forEach(function(e,n){r.isActive(t,n,e)&&i.push(n)})}else void 0!==t.addedNodes?t.nodes.forEach(function(e,r){t.addedNodes.has(r)||i.push(r)}):t.nodes.forEach(function(e,t){i.push(t)});return i}function internalQCMIndexerGetAllMatchesAsObj(e){var t=this.pathNodesById[e];if(void 0===t.removedNodes&&void 0===t.addedNodes)return t.nodes;var i=new IntHashMap(t.nodes.size+(t.removedNodes?t.removedNodes.size:0));return void 0!==t.removedNodes&&t.removedNodes.forEach(function(e,t){i.set(t,!0)}),void 0!==t.addedNodes?t.nodes.forEach(function(e,r){t.addedNodes.has(r)||i.set(r,!0)}):t.nodes.forEach(function(e,t){i.set(t,!0)}),i}function internalQCMIndexerPathHasAdditionsPending(e,t){var i=this.pathNodesById[e];if(void 0===i||void 0===i.addedNodes||0===i.addedNodes.size)return!1;var r=i.nonIndexedQueryCalcs?i.nonIndexedQueryCalcs.getPos(t):void 0;if(void 0===r)return!1;if(void 0===i.currentlyUpdatedQueryCalc)return!0;var n=i.currentlyUpdatedQueryCalc;return i.nonIndexedQueryCalcs.getPos(n)<r}function internalQCMIndexerPathHasRemovalsPending(e,t){var i=this.pathNodesById[e];if(void 0===i)return!1;var r=i.nonIndexedQueryCalcs?i.nonIndexedQueryCalcs.getPos(t):void 0;
if(void 0===r)return!1;if(0===i.currentlyUpdatedQueryCalc)return!0;var n=void 0!==i.removedNodes&&i.removedNodes.size>0;if(i.currentlyUpdatedQueryCalc>0||void 0===i.currentlyUpdatedQueryCalc)return n;var o=-i.currentlyUpdatedQueryCalc;return n?i.nonIndexedQueryCalcs.getPos(o)<r:i.queryCalcs.getPos(o)<i.queryCalcs.getPos(t)}function internalQCMIndexerIsSubTreeRoot(e){return!!e.subTree}function internalQCMIndexerInSubTree(e){return!!e.subTree||e.numSubTreeRoots>0}function internalQCMIndexerInSubTreeOnlyAsRoot(e){return e.subTree&&e.numSubTreeRoots<=1}function internalQCMIndexerAddToSubTreeRootUpdates(e,t){e.scheduled||this.qcm.schedulePathNode(e),e.subTreeRootUpdateIds[t]=!0}function internalQCMIndexerAddToSubTreeMonitorUpdates(e,t,i){e.scheduled||this.qcm.schedulePathNode(e);var r;(r=e.subTreeMonitorUpdateIds[i])||(r=e.subTreeMonitorUpdateIds[i]={}),r[t]=!0}function internalQCMIndexerAddSubTreeMonitor(e,t){var i=this.pathNodesById[e],r=++globalSubTreeMonitorId,n=i.subTreeMonitors;return void 0===n&&(n=i.subTreeMonitors={},i.numSubTreeMonitors=0,i.subTreeRootUpdateIds={},i.subTreeMonitorUpdateIds={}),i.numSubTreeMonitors++,n[r]=t,this.increaseSubTreeModeCount(i),r}function internalQCMIndexerRemoveSubTreeMonitor(e,t){var i=this.pathNodesById[e],r=i.subTreeMonitors;if(void 0!==r){var n;void 0!==(n=r[t])&&(this.decreaseSubTreeModeCount(i),delete r[t],0===--i.numSubTreeMonitors?(i.subTreeMonitors=void 0,i.subTreeRootUpdateIds=void 0,i.subTreeMonitorUpdateIds=void 0):t in i.subTreeMonitorUpdateIds&&delete i.subTreeMonitorUpdateIds[t])}}function internalQCMIndexerRegisterCompressionOnNode(e,t,i){this.registerSubTreeRetrievalOnNode(e,t,i,void 0)}function internalQCMIndexerRegisterCompressionOnNodes(e,t,i){for(var r=0,n=t.length;r<n;++r)this.registerCompressionOnNode(e,t[r],i)}function internalQCMIndexerUnregisterCompressionOnNode(e,t,i){this.unregisterSubTreeRetrievalOnNode(e,t,i);var r=this.pathNodesById[e],n=r.nodes.get(t);void 0!==n&&n.simpleCompressedValue&&!this.inSubTree(n)&&(this.qcm.compression.releaseSimpleCompressed(n.simpleCompressedValue),delete n.simpleCompressedValue)}function internalQCMIndexerRegisterSubTreeRetrievalOnNode(e,t,i,r,n){var o=this.pathNodesById[e],s=o.nodes.get(t);if(void 0!==s){if(!s.subTree&&n)for(var a in n)this.addToSubTreeMonitorUpdates(o,t,a);else this.addToSubTreeMonitorUpdates(o,t,i);if(s.numSubTreeRequests)return s.numSubTreeRequests++,void s.subTree.addMonitor(i,r);if(s.numSubTreeRequests=1,n?s.subTree=n:s.subTree=new InternalSubTree(this,e,t,i,r),void 0!==s.key&&this.setTerminalValueOnSubTree(s,e,t,s),s.subTreeRoots?(s.subTreeRoots[e]||s.numSubTreeRoots++,s.subTreeRoots[e]=t):(s.numSubTreeRoots=0,this.inSubTreeActivated(o,t)),s.hasAttrs||this.isOperatorType(s.type)){var d={};d[o.pathId]=t,this.addSubTreeRootsToChildren(o,t,d,!0)}}}function internalQCMIndexerUnRegisterSubTreeRetrievalOnNode(e,t,i){var r=this.pathNodesById[e],n=r.nodes.get(t);if(void 0!==n){if(this.addToSubTreeMonitorUpdates(r,t,i),--n.numSubTreeRequests>0)return void n.subTree.removeMonitor(i);if(n.hasAttrs||this.isOperatorType(n.type)){var o={};o[e]=t,this.removeSubTreeRootsFromChildren(r,t,o,!1)}n.subTree.destroy(),n.subTree=void 0,n.numSubTreeRoots>0&&(delete n.subTreeRoots[e],n.numSubTreeRoots--),0==n.numSubTreeRoots&&this.inSubTreeDeactivated(r,t,!0)}}function internalQCMIndexerSetNewNodeSubTreeRoots(e,t,i,r){var n,o;if(void 0!==r&&i!==r&&(n=e.nodes.get(r))){if(!this.inSubTree(n)||this.isRangeKey(n.key)&&n.key.isActive())return;o=e.pathId}else{if(!(e.parent&&e.parent.subTree&&r&&(n=e.parent.nodes.get(r))&&this.inSubTree(n))||void 0!==n.nonAttrs&&n.nonAttrs.has(e.parentAttr))return;o=e.parent.pathId}if(t.subTreeRoots={},n.numSubTreeRoots){t.numSubTreeRoots=n.numSubTreeRoots,this.addParentSubTreeCount(e,t.numSubTreeRoots);for(var s in n.subTreeRoots)t.subTreeRoots[s]=n.subTreeRoots[s]}else n.subTree&&(t.numSubTreeRoots=1,this.addParentSubTreeCount(e,1),t.subTreeRoots[o]=r)}function internalQCMIndexerExtendSubTreesToChild(e,t,i){if(this.inSubTree(i)){var r;i.numSubTreeRoots>0?r=i.subTreeRoots:(r={},r[pathNode.parent.pathId]=t),this.addSubTreeRootsToChild(e,t,r,!1)}}function internalQCMIndexerExtendSubTreesToOperandChildren(e,t,i){var r;t.numSubTreeRoots>0?r=t.subTreeRoots:(r={},r[e.pathId]=i),this.addSubTreeRootsToChildren(e,i,r,!1)}function internalQCMIndexerAddSubTreeRootsToChildren(e,t,i,r){var n=e.nodes.get(t);if(void 0!==n)if(this.isOperatorType(n.type)){if(!e.operandCount)return;var o=this.getOperandDataElements(t,e.pathId);if(o){var s=this;o.forEach(function(t,n){s.addParentSubTreeRoots(e,n,i,r)})}}else if(n.hasAttrs)if(void 0!==n.nonAttrs)for(var a in e.children)n.nonAttrs.has(a)||this.addSubTreeRootsToChild(e.children[a],t,i,r);else for(var a in e.children)this.addSubTreeRootsToChild(e.children[a],t,i,r)}function internalQCMIndexerAddSubTreeRootsToChild(e,t,i,r){var n=Object.keys(i).length;if(e.nodes.has(t))this.addParentSubTreeCount(e,n),this.addParentSubTreeRoots(e,t,i,r);else{var o=this.getDirectChildDataElementsAsObj(t,e.pathId);if(o){this.addParentSubTreeCount(e,n*o.size);var s=this;o.forEach(function(t,n){s.addParentSubTreeRoots(e,n,i,r)})}}}function internalQCMIndexerAddParentSubTreeRoots(e,t,i,r){var n=e.nodes.get(t);if(n){var o;this.inSubTree(n)?n.numSubTreeRoots?o=n.subTreeRoots:(o=n.subTreeRoots={},n.numSubTreeRoots=1,o[e.pathId]=t):(this.inSubTreeActivated(e,t),o=n.subTreeRoots={},n.numSubTreeRoots=0);for(var s in i){if(o[s])return;o[s]=i[s],2==++n.numSubTreeRoots&&n.subTree&&this.inSubTreeOnlyAsRootDeactivated(e,t)}void 0!==n.key&&this.setTerminalValueOnSubTrees(e.pathId,t,n,i,r),this.addSubTreeRootsToChildren(e,t,i,r)}}function internalQCMIndexerAddParentSubTreeCount(e,t){t&&(e.parentSubTreeCount?e.parentSubTreeCount+=t:(e.parentSubTreeCount=t,this.increaseSubTreeModeCount(e)))}function internalQCMIndexerIncreaseSubTreeModeCount(e){return e.subTree?void e.subTree++:(e.subTree=1,void this.activateSubTreeMonitoringOnPath(e))}function InternalQCMIndexerActivateSubTreeMonitoringOnPath(e){e.trace?this.subTreeMonitoringActivated(e):(this.pathNodeActivated(e),this.notifyPathActivated(e))}function internalQCMIndexerRemoveSubTreeNode(e,t,i){var r=e.numSubTreeRoots?e.numSubTreeRoots:e.subTree?1:0;if(r){this.removeFromSubTreeRoots(t.pathId,i,e);var n={};n[t.pathId]=i,this.removeSubTreeRootsFromChildren(t,i,n,!1),this.clearSubTrees(t,i,e)}}function InternalQCMIndexerRemoveFromSubTreeRoots(e,t,i){if(i.numSubTreeRoots){for(var r in i.subTreeRoots){var n=i.subTreeRoots[r];if(r!=e||n!=t){var o=this.pathNodesById[r],s=o.nodes.get(n);s.subTree.removeSimpleElement(e,t),this.addToSubTreeRootUpdates(o,n)}}}}function internalQCMIndexerClearSubTrees(e,t,i){if(this.inSubTree(i)){this.inSubTreeOnlyAsRoot(i);if(delete i.subTreeRoots,i.numSubTreeRoots){var r=i.numSubTreeRoots;i.subTree&&r--,this.removeParentSubTreeCount(e,r),i.numSubTreeRoots=0}if(i.numSubTreeRequests>0){if(void 0!==e.subTreeRootUpdateIds&&t in e.subTreeRootUpdateIds&&delete e.subTreeRootUpdateIds[t],void 0!==e.subTreeMonitorUpdateIds)for(var n in i.subTree.getMonitorIds())n in e.subTreeMonitorUpdateIds&&delete e.subTreeMonitorUpdateIds[n][t];i.subTree.clear(),i.subTree=void 0,this.addToSubTreeRootUpdates(e,t)}i.simpleCompressedValue&&(this.qcm.compression.releaseSimpleCompressed(i.simpleCompressedValue),delete i.simpleCompressedValue),i.numSubTreeRequests=0}}function internalQCMIndexerDetachSubTreesFromChild(e,t,i){if(this.inSubTree(i)){var r;i.subTreeRoots?r=i.subTreeRoots:(r={},r[e.parent.pathId]=t),this.removeSubTreeRootsFromChild(e,t,r,!0)}}function internalQCMIndexerRemoveSubTreeRootsFromChildren(e,t,i,r){var n=e.nodes.get(t);if(void 0!==n)if(e.operandCount){var o;if(o=this.getOperandDataElements(t,e.pathId)){var s=this;o.forEach(function(t,n){s.removeParentSubTreeRoots(e,n,i,r)})}}else if(n.hasAttrs)if(void 0!==n.nonAttrs)for(var a in e.children)n.nonAttrs.has(a)||this.removeSubTreeRootsFromChild(e.children[a],t,i,r);else for(var a in e.children)this.removeSubTreeRootsFromChild(e.children[a],t,i,r)}function internalQCMIndexerRemoveSubTreeRootsFromChild(e,t,i,r){if(e.nodes.has(t))this.removeParentSubTreeRoots(e,t,i,r);else{var n=this.getDirectChildDataElementsAsObj(t,e.pathId);if(n){var o=this;n.forEach(function(t,n){o.removeParentSubTreeRoots(e,n,i,r)})}}}function internalQCMIndexerRemoveParentSubTreeRoots(e,t,i,r){var n=e.nodes.get(t);if(n){var o;if(o=n.subTreeRoots){this.removeSubTreeRootsFromChildren(e,t,i,r),void 0===n.key&&(r=!1);var s=0;for(var a in i)if(o[a]){if(r){var d=this.pathNodesById[a],u=o[a],h=d.nodes.get(u);h.subTree.removeSimpleElement(e.pathId,t),this.addToSubTreeRootUpdates(d,u)}delete o[a],1==--n.numSubTreeRoots&&n.subTree&&this.inSubTreeOnlyAsRootActivated(e,t),s++}this.removeParentSubTreeCount(e,s),this.inSubTree(n)||(n.simpleCompressedValue&&(this.qcm.compression.releaseSimpleCompressed(n.simpleCompressedValue),delete n.simpleCompressedValue),this.inSubTreeDeactivated(e,t,!1))}}}function internalQCMIndexerRemoveParentSubTreeCount(e,t){t&&0==(e.parentSubTreeCount-=t)&&this.decreaseSubTreeModeCount(e)}function internalQCMIndexerDecreaseSubTreeModeCount(e){assert(e.subTree>0),e.subTree--,e.subTree>0||this.deactivateSubTreeMonitoringOnPath(e)}function InternalQCMIndexerDeactivateSubTreeMonitoringOnPath(e){if(e.trace)this.subTreeMonitoringDeactivated(e);else{if(e.keepActive)return void(e.deactivateBlocked=!0);this.pathNodeDeactivated(e),this.notifyPathDeactivated(e)}}function internalQCMIndexerSetTerminalValueOnSubTrees(e,t,i,r,n){if(void 0===r){var o=this.pathNodesById[e];return n||this.addToSubTreeRootUpdates(o,t),void(void 0===i.key?i.subTree.removeSimpleElement(e,t):this.setTerminalValueOnSubTree(i,e,t,i))}for(var s in r){var a=this.pathNodesById[s],d=r[s],u=a.nodes.get(d);n||this.addToSubTreeRootUpdates(a,d),void 0!==i.key?this.setTerminalValueOnSubTree(u,e,t,i):u.subTree.removeSimpleElement(e,t)}}function internalQCMIndexerSetTerminalValueOnSubTree(e,t,i,r){var n=e.subTree.updateSimpleElement(t,i,r.type,r.key,r.simpleCompressedValue);n&&!r.simpleCompressedValue&&(this.qcm.compression.reallocateSimple(n),r.simpleCompressedValue=n)}function internalQCMIndexerUpdateSubTrees(e,t,i){i.simpleCompressedValue&&(this.qcm.compression.releaseSimpleCompressed(i.simpleCompressedValue),i.simpleCompressedValue=void 0),this.setTerminalValueOnSubTrees(e,t,i,i.subTreeRoots,!1)}function internalQCMIndexerGetCompression(e,t){var i;if(void 0!==(i=this.pathNodesById[e])){var r;if(void 0!==(r=i.nodes.get(t))&&void 0!==r.subTree)return r.subTree.getCompression()}}function internalQCMIndexerGetFullCompression(e,t){var i;if(void 0!==(i=this.pathNodesById[e])){var r;if(void 0!==(r=i.nodes.get(t))&&void 0!==r.subTree)return r.subTree.getFullCompression()}}function internalQCMIndexerSetFullCompression(e,t,i){var r;if(void 0!==(r=this.pathNodesById[e])){var n;if(void 0!==(n=r.nodes.get(t))&&void 0!==n.subTree)return n.subTree.setFullCompression(i)}}function internalQCMIndexerUnsetFullCompression(e,t,i){var r;if(void 0!==(r=this.pathNodesById[e])){var n;void 0!==(n=r.nodes.get(t))&&void 0!==n.subTree&&n.subTree.unsetFullCompression(i)}}function internalQCMIndexerRegisterPathActiveNotifications(e,t){var i=t.getId();this.pathActiveNotify||(this.pathActiveNotify={});var r=this.pathActiveNotify[e];r?i in r.toNotify||r.numToNotify++:r=this.pathActiveNotify[e]={numToNotify:1,toNotify:{}},r.toNotify[i]=t}function internalQCMIndexerUnregisterPathActiveNotifications(e,t){var i;this.pathActiveNotify&&(i=this.pathActiveNotify[e])&&t in i.toNotify&&(--i.numToNotify?delete i.toNotify[t]:delete this.pathActiveNotify[e])}function internalQCMIndexerNotifyPathActivated(e){var t,i=e.pathId;if(this.pathActiveNotify&&(t=this.pathActiveNotify[i]))for(var r in t.toNotify)t.toNotify[r].pathActivated(i)}function internalQCMIndexerNotifyPathDeactivated(e){var t,i=e.pathId;if(this.pathActiveNotify&&(t=this.pathActiveNotify[i]))for(var r in t.toNotify)t.toNotify[r].pathDeactivated(i)}function internalQCMIndexerDebugGetDataUnder(e,t){var i=new DebugInternalTo(this.qcm);if(i.setDataElementTable(this.getDataElements(),t),void 0==t&&(t=this.rootPathNodeId),void 0===e){var r=this.pathNodesById[t];if(!r)return i;e=[],r.nodes.forEach(function(t,i){e.push(i)})}for(var n=0,o=e.length;n<o;++n){var s=e[n];this.debugAddDataFromPathNode(this.pathNodesById[t],s,i,t)}return i}function internalQCMIndexerDebugAddDataFromPathNode(e,t,i,r){var n=e.nodes.get(t);if(void 0===n||this.isOperatorType(n.type)){var o=this.dataElements.getEntry(t);if(!o||!o.children||!o.children.has(e.pathId))return;var s=this;if(o.children.get(e.pathId).ids.forEach(function(t,n){s.debugAddDataFromPathNode(e,n,i,r)}),void 0===n)return}void 0!==n.key&&i.addValue(n.key,n.type,t,this.qcm.diffPathId(e.pathId,r));for(var a in e.children)this.debugAddDataFromPathNode(e.children[a],t,i,r)}function FuncResult(e){this.id=InternalQCM.newId(),this.qcm=e,this.composedFuncs={},this.numComposedFuncs=0,this.composedActive={},this.composedActiveNum=0,this.composedSupportMultiProjNum=0,this.composedQueryResultNum=0,this.composedMatchTransparentNum=0,this.composedOrderStar=void 0,this.composedSelectingNum=0,void 0!==this.DebugTracing&&this.DebugTracing(0,debugTracingFuncResult)}function funcResultDestroy(){if(this.destroyed=!0,this.dataObjs){for(var e=0,t=this.dataObjs.length;e<t;++e)this.dataObjs[e]&&this.dataObjs[e].removeComposedFunc(this.getId(),e);this.dataObjs=void 0}else this.dataObj&&(this.dataObj.removeComposedFunc(this.getId()),this.dataObj=void 0)}function funcResultGetId(){return this.id}function functionResultHasNonQueryActiveComposed(){return this.composedQueryResultNum<this.composedActiveNum}function functionResultGetNumComposedFuncs(){return this.numComposedFuncs}function functionResultGetComposedSelectingNum(){return this.composedSelectingNum}function funcResultSetData(e,t){var i=this.dataObjs?this.dataObjs[t]:this.dataObj;if(i!=e){this.doDebugging&&(this.debugMessage("setting new data under result ",this.debugPrintDesc()+":"),this.debugMessage("     was ",i?i.debugPrintDesc():"<undefined>"),this.debugMessage("     is now ",e?e.debugPrintDesc():"<undefined>"));var r;this.isOrderStar()&&void 0!==i&&(r=i.getDominatedComparison()),this.aboutToSetData(e,t),i&&this.id in i.composedActive&&i.removeComposedFunc(this.getId(),t,!0),e&&e.addComposedFunc(this,t);var n=!i||!e||i.getDominatedIndexer()!=e.getDominatedIndexer()||i.getDominatedProjPathId()!=e.getDominatedProjPathId()||e.getDominatedProjPathNum()>1;if(this.isActiveStar()&&this.removeDataObjMatches(e,n,t),i&&(i.completeActiveComposedFuncRemoval(this,t),i.completeComposedSelectingNumUpdate()),this.dataObjs?this.dataObjs[t]=e:this.dataObj=e,this.isActiveStar()&&(n&&this.refreshIndexerAndPaths(e),this.addDataObjMatches(i,n,t),this.isOrderStar()&&(void 0===this.dataObjs||this.isContentDataObj(t)))){var o=e.getDominatedComparison();r===o||void 0!==r&&void 0!==o&&r.compResult===o.compResult||this.refreshOrdering()}}}function funcResultAboutToSetData(e,t){}function funcResultAddDataObjMatches(e,t,i){var r=void 0===this.dataObjs?this.dataObj:this.dataObjs[i];if(void 0!==r)if(t)this.addMatches(r.getDominatedMatches(),r);else{for(var n=r.getDominatedMatches(),o=e.getDominatedMatchesAsObj(),s=[],a=0,d=n.length;a<d;++a){var u=n[a];o.has(u)||s.push(u)}this.addMatches(s,r)}}function funcResultRemoveDataObjMatches(e,t,i){var r=void 0===this.dataObjs?this.dataObj:this.dataObjs[i];if(void 0!==r)if(t||void 0===e)this.removeMatches(r.getDominatedMatches(),r);else{for(var n=r.getDominatedMatches(),o=e.getDominatedMatchesAsObj(),s=[],a=0,d=n.length;a<d;++a){var u=n[a];o.has(u)||s.push(u)}this.removeMatches(s,r)}}function funcResultRemoveRestrictionsFromNoSelection(e,t){if(0!=this.composedQueryResultNum||0!=this.composedMatchTransparentNum)for(var i in this.composedActive){var r=this.composedActive[i];r instanceof InternalQueryResult?r.removePrefixResultRestrictions(e,t,1):r.isMatchTransparent()&&r.removeRestrictionsFromNoSelection(e,t)}}function funcResultSetTerminalData(e,t){if(this!=e){if(!this.dataObjs||void 0!==t){var i=this.dataObjs?this.dataObjs[t]:this.dataObj;return void 0===i?void this.setData(e,t):void(i.isTerminalResult()?i.isReplaceableTerminalResult()&&this.setData(e,t):i.setTerminalData(e))}for(var r=0,n=this.dataObjs.length;r<n;++r)this.setTerminalData(e,r)}}function funcResultAddComposedFunc(e,t){if(e){var i=e.getId();i in this.composedFuncs||(this.composedFuncs[i]=e,this.numComposedFuncs++,e.isActiveStar()&&this.addActiveComposedFunc(e,!1,t))}}function funcResultAttachActiveComposedFunc(e,t){var i=e.getId();if(!(i in this.composedActive)&&this.composedAdditionInProgress!==e){var r=this.isActiveStar();if(this.aboutToAttachActiveComposed(),this.composedAdditionInProgress=e,this.composedActiveNum++,e.supportsMultiProj()&&this.composedSupportMultiProjNum++,e instanceof InternalQueryResult?this.composedQueryResultNum++:e.isMatchTransparent()&&this.composedMatchTransparentNum++,e===this.composedRemovalInProgress&&(this.composedRemovalInProgress=void 0),void 0!==this.dataObjs)for(var n=0,o=this.dataObjs.length;n<o;++n){var s=this.dataObjs[n];!s||r&&s.composedRemovalInProgress!=this||s.attachActiveComposedFunc(this,n)}else void 0===this.dataObj||r&&this.dataObj.composedRemovalInProgress!=this||this.dataObj.attachActiveComposedFunc(this);if(e.isContentDataObj(t)){var a=e.getComposedSelectingNum();this.updateComposedSelectingNum(a,!0)}}}function funcResultCompleteActiveComposedFuncAddition(e,t,i){var r=e.getId();if(!(r in this.composedActive)){this.composedAdditionInProgress===e&&(this.composedAdditionInProgress=void 0);var n=this.wasActiveStarBeforeRecomposition();if(this.activeStarPending=!n&&!this.isTerminalResult(),this.aboutToAddActiveComposed(e,n),this.composedActive[r]=e,this.dataObjs)for(var o=0,s=this.dataObjs.length;o<s;++o){var a=this.dataObjs[o];void 0===a||n&&a.composedAdditionInProgress!=this||a.completeActiveComposedFuncAddition(this,!n,o)}else void 0===this.dataObj||n&&this.dataObj.composedAdditionInProgress!=this||this.dataObj.completeActiveComposedFuncAddition(this,!n);if(this.activeStarPending){if(e.isContentDataObj(i)&&this.completeComposedSelectingNumUpdate(),this.activeStarPending=void 0,this.becameActiveStar(),this.isOrder())if(this.dataObjs){var a=this.getContentDataObj();a&&a.addOrderStarFunc(this)}else this.dataObj&&this.dataObj.addOrderStarFunc(this)}else t&&(e.isContentDataObj(i)&&this.completeComposedSelectingNumUpdate(),e.refreshIndexerAndPaths(this),e instanceof InternalQueryResult&&0==this.getDomMatchCount()||e.addMatches(this.getDominatedMatches(),this,this.getDomMatchCount()));e.isContentDataObj(i)&&e.isOrderStar()&&this.addOrderStarFunc(e)}}function funcResultAddActiveComposedFunc(e,t,i){this.attachActiveComposedFunc(e,i),this.completeActiveComposedFuncAddition(e,t,i)}function funcResultAboutToAttachActiveComposed(){}function funcResultAboutToAddActiveComposed(){}function funcResultBecameActiveStar(){}function funcResultRemoveComposedFunc(e,t,i){e in this.composedFuncs&&(e in this.composedActive&&this.removeActiveComposedFunc(e,t,i),delete this.composedFuncs[e],this.numComposedFuncs--)}function funcResultDetachActiveComposedFunc(e,t){if(e in this.composedActive){var i=this.composedActive[e];if(delete this.composedActive[e],this.composedActiveNum--,i.supportsMultiProj()&&this.composedSupportMultiProjNum--,i instanceof InternalQueryResult?this.composedQueryResultNum--:i.isMatchTransparent()&&this.composedMatchTransparentNum--,i.isContentDataObj(t)&&this.updateComposedSelectingNum(-1*i.getComposedSelectingNum(),!0),!this.isActiveStar())if(this.dataObjs)for(var r=0,n=this.dataObjs.length;r<n;++r)this.dataObjs[r]&&this.dataObjs[r].detachActiveComposedFunc(this.getId(),r);else this.dataObj&&this.dataObj.detachActiveComposedFunc(this.getId());return this.composedRemovalInProgress=i,i}}function funcResultCompleteActiveComposedFuncRemoval(e,t){this.composedRemovalInProgress===e&&(this.composedRemovalInProgress=void 0,this.completeComposedSelectingNumUpdate(),this.activeComposedFuncRemoved(e),e.isContentDataObj(t)&&this.removeOrderStarFunc(e.getId()),this.isActiveStar()||this.deactivated())}function funcResultRemoveActiveComposedFunc(e,t,i){var r;r=void 0===this.composedRemovalInProgress||this.composedRemovalInProgress.getId()!==e?this.detachActiveComposedFunc(e,t):this.composedRemovalInProgress,void 0!==r&&(i||this.completeActiveComposedFuncRemoval(r,t))}function funcResultActiveComposedFuncRemoved(e){}function funcResultActivated(){if(!(this.composedActiveNum>0))if(this.dataObjs)for(var e=0,t=this.dataObjs.length;e<t;++e)this.dataObjs[e]&&this.dataObjs[e].addActiveComposedFunc(this,!0,e);else this.dataObj&&this.dataObj.addActiveComposedFunc(this,!0)}function funcResultDeactivated(){if(!(this.composedActiveNum>0))if(this.dataObjs)for(var e=0,t=this.dataObjs.length;e<t;++e)this.dataObjs[e]&&this.dataObjs[e].removeActiveComposedFunc(this.getId(),e);else this.dataObj&&this.dataObj.removeActiveComposedFunc(this.getId())}function functionResultUpdateComposedSelectingNum(e,t){if(0!==e&&(this.composedSelectingNum+=e,!this.activeStarPending)){var i=this.getContentDataObj();void 0!==i&&i.updateComposedSelectingNum(e,t)}}function functionResultCompleteComposedSelectingNumUpdate(){var e=this.getContentDataObj();void 0!==e&&e.completeComposedSelectingNumUpdate()}function funcResultIsActiveStar(){return!this.activeStarPending&&(this.composedActiveNum>0||void 0!==this.composedRemovalInProgress||this.isActive())}function funcResultWasActiveStarBeforeRecomposition(){return this.composedActiveNum>1||void 0!==this.composedRemovalInProgress||this.isActive()}function funcResultSupportsMultiProj(){return!1}function funcResultIsMatchTransparent(){return!1}function funcResultIsTerminalResult(){return!1}function funcResultGetFirstResult(){return void 0!==this.dataObjs?void 0===this.dataObjs[0]?this:this.dataObjs[0].getFirstResult():void 0===this.dataObj?this:this.dataObj.getFirstResult()}function funcResultGetDominatedProjMappings(){var e=this.getDominatedProjPathId();if(void 0!==e){var t=new Map;return t.set(0,[this.qcm.getRootPathId(),e]),t}}function funcResultGetDominatedIdentification(){return this.dataObjs?this.dataObjs[0]?this.dataObjs[0].getDominatedIdentification():void 0:this.dataObj?this.dataObj.getDominatedIdentification():void 0}function funcResultGetDominatedComparison(){return this.dataObjs?this.dataObjs[0]?this.dataObjs[0].getDominatedComparison():void 0:this.dataObj?this.dataObj.getDominatedComparison():void 0}function funcResultGetDifference(e,t,i){var r=this.getDominatedMatchesAsObj(),n=e.getDominatedMatchesAsObj();n.forEach(function(e,t){r.has(t)||i.push(t)}),r.forEach(function(e,i){n.has(i)||t.push(i)})}function funcResultIncreaseMatchCount(e,t,i){}function funcResultDecreaseMatchCount(e,t,i){}function funcResultIsOrder(){return!1}function funcResultIsOrderStar(){return this.isOrder()&&this.isActiveStar()||void 0!==this.composedOrderStar&&this.composedOrderStar.size>0}function funcResultGetContentDataObj(){return void 0!==this.dataObj?this.dataObj:void 0!==this.dataObjs?this.dataObjs[0]:void 0}function funcResultIsContentDataObj(e){return!e}function funcResultAddOrderStarFunc(e){var t=this.isOrderStar();if(void 0===this.composedOrderStar&&(this.composedOrderStar=new Map),this.composedOrderStar.set(e.getId(),e),!t){if(this.dataObjs){var i=this.getContentDataObj();i&&i.addOrderStarFunc(this)}else this.dataObj?this.dataObj.addOrderStarFunc(this):void 0!==this.orderService&&this.orderService.addOrderStarFunc(this);this instanceof CompResult&&this.comparisonActivated()}}function funcResultRemoveOrderStarFunc(e){if(void 0!==this.composedOrderStar&&this.composedOrderStar.has(e)&&(this.composedOrderStar.delete(e),!this.isOrderStar()))if(this instanceof CompResult&&this.comparisonDeactivated(),this.dataObjs){var t=this.getContentDataObj();t&&t.removeOrderStarFunc(this.id)}else this.dataObj?this.dataObj.removeOrderStarFunc(this.id):void 0!==this.orderService&&this.orderService.removeOrderStarFunc(this.id)}function funcResultRefreshOrdering(){void 0!==this.composedOrderStar&&this.composedOrderStar.forEach(function(e,t){e.refreshOrdering()})}function funcResultForwardResultIndexerAddMatches(e){for(var t in this.composedActive){var i=this.composedActive[t];i instanceof InternalQueryResult||i.addMatches(e,this)}}function funcResultForwardResultIndexerRemoveMatches(e){for(var t in this.composedActive){var i=this.composedActive[t];i instanceof InternalQueryResult||i.removeMatches(e,this)}}function funcResultDebugPrintDesc(){return""+this.getId()+"<"+this.constructor.name+">"}function debugInitFuncResultTracing(){debugTracingFuncResult=!0,void 0===globalDebugTracingLog&&initializeDebugTracingLog();for(var e in debugAllQueryResults){var t=debugAllQueryResults[e];t.doDebugging=!0,t.query instanceof Query&&(t.query.doDebugging=!0)}}function IdentityMonitor(e,t,i){this.owner=e,this.indexer=t,this.pathId=i,this.compression=t.qcm.compression,this.numMonitored=0,this.monitorId=void 0}function identityMonitorDestroy(){var e=this.owner.getMonitoredElements();this.releaseIdentity(e),void 0!==this.monitorId&&(this.indexer.removeSubTreeMonitor(this.pathId,this.monitorId),this.monitorId=void 0)}function identityMonitorReplaceSource(e,t){if(this.numMonitored>0){for(var i=e.addSubTreeMonitor(t,this),r=this.owner.getMonitoredElements(),n=this.indexer.getDataNodesAtPath(this.pathId),o=0,s=r.length;o<s;++o){var a=r[o],d=n.get(a);d.hasAttrs===!0&&(e.registerCompressionOnNode(t,a,i),this.indexer.unregisterCompressionOnNode(this.pathId,a,this.monitorId))}this.indexer.removeSubTreeMonitor(this.pathId,this.monitorId),this.monitorId=i}this.indexer=e,this.pathId=t}function identityMonitorRequestIdentity(e){for(var t=this.indexer.getDataNodesAtPath(this.pathId),i=[],r=0,n=e.length;r<n;++r){var o=e[r],s=t.get(o);if(s.hasAttrs!==!0){var a;a=void 0===s.type||void 0===s.key?void 0:this.compression.simple(s.type,s.key),i.push(a)}else void 0===this.monitorId&&(this.monitorId=this.indexer.addSubTreeMonitor(this.pathId,this)),this.indexer.registerCompressionOnNode(this.pathId,o,this.monitorId),i.push(void 0),this.numMonitored++}return i}function identityMonitorReleaseIdentity(e){for(var t=this.indexer.getKnownNodeValues(this.pathId,e),i=0,r=e.length;i<r;++i){var n=e[i];if(t.hasAttrs[i]===!0)this.indexer.unregisterCompressionOnNode(this.pathId,n,this.monitorId),this.numMonitored--;else{var o=t.types[i],s=t.keys[i];void 0!==o&&void 0!==s&&this.compression.releaseSimple(o,s)}}}function identityMonitorReleaseAllIdentities(){var e=this.owner.getMonitoredElements();this.releaseIdentity(e)}function identityMonitorUpdateKeys(e,t,i,r,n,o){if(0!==o.length){for(var s=[],a=[],d=new Map,u=this.indexer.getDataNodesAtPath(this.pathId),h=this.indexer.pathNodesById[this.pathId],l=0,c=o.length;l<c;++l){var p=o[l],f=e[p],v=u.get(f);if(v.hasAttrs!==!0){if(!d.has(f)){d.set(f,!0);var g=this.compression.simple(v.type,v.key);s.push(f),a.push(g);var m=this.indexer.getPrevKey(h,f);void 0!==m&&(m.hasAttrs===!0?(this.indexer.unregisterCompressionOnNode(this.pathId,f,this.monitorId),this.numMonitored--):void 0!==m.type&&void 0!==m.key&&this.compression.releaseSimple(m.type,m.key))}}else{if(d.has(f))continue;d.set(f,!0);var m=this.indexer.getPrevKey(h,f);if(m&&m.hasAttrs===!0)continue;var m=this.indexer.getPrevKey(h,f);m&&void 0!==m.type&&void 0!==m.key&&this.compression.releaseSimple(m.type,m.key),void 0===this.monitorId&&(this.monitorId=this.indexer.addSubTreeMonitor(this.pathId,this)),this.indexer.registerCompressionOnNode(this.pathId,f,this.monitorId),this.numMonitored++}}this.owner.updateCompressedValues(s,a)}}function identityMonitorSubTreeUpdate(e,t,i){if(e==this.pathId&&i==this.monitorId&&0!=this.numMonitored){t=this.owner.filterMonitoredElements(t);for(var r=[],n=[],o=0,s=t.length;o<s;++o){var a=t[o],d=this.indexer.getCompression(this.pathId,a);void 0===d[1]&&(d=this.indexer.setFullCompression(this.pathId,a,this.monitorId)),r.push(a),n.push(d[1])}this.owner.updateCompressedValues(r,n)}}function IdentityResult(e,t,i,r,n){this.dataObjs=[void 0,void 0],this.identifiedDataObj=void 0,this.identificationObj=void 0,this.identificationRoot=void 0,this.FuncResult(e),this.identifyAtIdentifiedPathOnly=n,void 0!==i&&(this.identity=i),this.identificationId=void 0!==r?r:IdentityResult.newId(),this.pathId=void 0,this.doNotIndex=!0,this.matchPoints=new Map,this.lowestMatchPoint=void 0,this.needToRaiseMatches=!1,this.raisedIdentified=void 0,this.monitor=void 0,this.suspendedNewMatches=void 0,t&&this.setIdentifiedData(t),void 0!==debugAllIdentityResults&&(debugAllIdentityResults[this.id]=this)}function identityResultDestroy(){this.monitor&&this.monitor.destroy(),void 0!==this.sourceIndexer&&this.sourceIndexer.removeQueryCalcFromPathNode(this),this.identityIndexer.unregisterIdentification(this.identificationId,this),this.FuncResult_destroy(),void 0!==debugAllIdentityResults&&delete debugAllIdentityResults[this.id]}function identityResultIsMatchTransparent(){return!0}function identityResultGetIdentificationId(){return this.identificationId}function identityResultGetIdentifiedPathId(){return this.identifiedPathId}function identityResultIsActive(){return void 0!==this.identityIndexer&&this.identityIndexer.hasIdentificationRequests(this.identificationId)}function identityResultSetIdentifiedData(e){if(this.identifiedDataObj!=e){if(this.identifiedDataObj===this.identificationObj&&(this.identificationRoot&&!this.identificationRoot.isTerminalResult()&&this.identificationRoot.setData(void 0),this.identificationRoot=void 0),this.identifiedDataObj=e,this.identificationObj&&this.identificationRoot&&!this.identificationRoot.isTerminalResult()&&(this.suspendedNewMatches=[],this.identificationRoot.setData(e)),this.FuncResult_setData(e,0),void 0!==this.suspendedNewMatches){var t=this.suspendedNewMatches;this.suspendedNewMatches=void 0,void 0!==t[1]&&this.addMatches(t[1],this.dataObjs[1]),void 0!==t[0]&&this.addMatches(t[0],this.dataObjs[0])}this.isActiveStar()||this.refreshIdentifiedIndexerAndPaths()}}function identityResultSetIdentificationData(e){this.identificationObj!=e&&(this.identificationObj=e,void 0===this.identificationRoot||this.identificationRoot.isTerminalResult()||this.identificationRoot.setData(void 0),void 0!==e&&this.identificationObj!=this.identifiedDataObj?this.identificationRoot=e.getFirstResult():this.identificationRoot=void 0,this.FuncResult_setData(e,1),this.identificationObj&&this.identificationRoot&&!this.identificationRoot.isTerminalResult()&&this.identificationRoot.setData(this.identifiedDataObj))}function identityResultSetData(e){this.setIdentifiedData(e)}function identityResultSetTerminalData(e){void 0===this.identifiedDataObj||this.identifiedDataObj.isReplaceableTerminalResult()?this.setIdentifiedData(e):this.identifiedDataObj.isTerminalResult()||this.identifiedDataObj.setTerminalData(e)}function identityResultGetContentDataObj(e){return this.identifiedDataObj}function identityResultIsContentDataObj(e){return 0==e}function identityResultRefreshIndexerAndPaths(e){e==this.identifiedDataObj&&this.refreshIdentifiedIndexerAndPaths(),e==this.identificationObj&&this.refreshIdentificationIndexerAndPaths()}function identityResultRefreshIdentifiedIndexerAndPaths(){var e=this.identifiedDataObj?this.identifiedDataObj.getDominatedIndexer():void 0,t=this.identifiedDataObj?this.identifiedDataObj.getDominatedProjPathId():void 0;if((this.identityIndexer!=e||this.identifiedPathId!=t||this.activeStarPending)&&(this.identityIndexer!=e&&(this.identityIndexer&&this.identityIndexer.unregisterIdentification(this.identificationId,this),e&&e.registerIdentification(this.identificationId,this)),this.identityIndexer=e,this.identifiedPathId=t,this.composedActiveNum>0))for(var i in this.composedActive)this.composedActive[i].refreshIndexerAndPaths(this)}function identityResultRefreshIdentificationIndexerAndPaths(){var e=this.identificationObj?this.identificationObj.getDominatedIndexer():void 0,t=this.identificationObj?this.identificationObj.getDominatedProjPathId():void 0;
this.sourceIndexer==e&&this.pathId==t||(this.sourceIndexer&&(this.monitor&&(this.monitor.destroy(),this.monitor=void 0),this.sourceIndexer.removeQueryCalcFromPathNode(this)),this.sourceIndexer=e,this.pathId=t,void 0!==this.sourceIndexer&&(e.addQueryCalcToPathNode(this),void 0===this.identity&&(this.sourceIndexer.needKeyUpdateForQuery(this),this.monitor=new IdentityMonitor(this,this.sourceIndexer,this.pathId))))}function identityResultReplaceIndexerAndPaths(e,t,i,r){r==this.identifiedDataObj&&this.replaceIdentifiedIndexerAndPaths(e,t,i),r==this.identificationObj&&this.replaceIdentificationIndexerAndPaths()}function identityResultReplaceIdentifiedIndexerAndPaths(e,t,i){var r=this.identifiedDataObj?this.identifiedDataObj.getDominatedIndexer():void 0,n=this.identifiedDataObj?this.identifiedDataObj.getDominatedProjPathId():void 0,o=this.identityIndexer;if(this.identityIndexer=r,this.identifiedPathId=n,this.identityIndexer!=o){this.identityIndexer&&this.identityIndexer.registerIdentification(this.identificationId,this);var s=o.getAllIdentities(this.identificationId);if(void 0!==s&&s.size>0){var a=[],d=[];s.forEach(function(e,t){a.push(t),d.push(e)}),this.identityIndexer.addIdentities(a,d,this.identificationId)}}if(this.composedActiveNum>0)for(var u in this.composedActive)this.composedActive[u].replaceIndexerAndPaths(e,t,i,this);o&&o!=this.identityIndexer&&o.unregisterIdentification(this.identificationId,this)}function identityResultReplaceIdentificationIndexerAndPaths(){var e=this.identificationObj?this.identificationObj.getDominatedIndexer():void 0,t=this.identificationObj?this.identificationObj.getDominatedProjPathId():void 0;this.sourceIndexer==e&&this.pathId==t||(this.monitor&&this.monitor.replaceSource(e,t),void 0!==this.sourceIndexer&&this.sourceIndexer.removeQueryCalcFromPathNode(this),this.sourceIndexer=e,this.pathId=t,void 0!==this.sourceIndexer&&void 0!==t&&(e.addQueryCalcToPathNode(this),void 0===this.identity&&this.sourceIndexer.needKeyUpdateForQuery(this)))}function identityResultIncreaseMatchCount(e,t,i){if(i===this.identifiedDataObj&&!(0===e||this.identifiedDataObj.getDomMatchCount()-e>0))for(var r in this.composedActive){var n=this.composedActive[r];n.increaseMatchCount(1,t,this)}}function identityResultDecreaseMatchCount(e,t,i){if(i===this.identifiedDataObj&&!(0===e||this.identifiedDataObj.getDomMatchCount()>0))for(var r in this.composedActive){var n=this.composedActive[r];n.decreaseMatchCount(1,t,this)}}function identityResultAddDataObjMatches(e,t,i){var r;(r=this.dataObjs[i])&&(r==this.identificationObj||0!=r.getDomMatchCount()||this.hasNonQueryActiveComposed())&&this.FuncResult_addDataObjMatches(e,t,i)}function identityResultRemoveDataObjMatches(e,t,i){var r;(r=this.dataObjs[i])&&(t||(r==this.identificationObj||0!=r.getDomMatchCount()||this.hasNonQueryActiveComposed())&&this.FuncResult_removeDataObjMatches(e,t,i))}function identityResultAddMatches(e,t){if(0!=e.length){if(t==this.identificationObj){if(this.suspendedNewMatches)return void(this.suspendedNewMatches[1]=e);this.needToRaiseMatches?this.addMatchesWithRaising(e,t):this.addMatchesWithoutRaising(e,t)}if(t==this.identifiedDataObj&&this.composedActiveNum>0){var i=0==this.getDomMatchCount();if(i&&!this.hasNonQueryActiveComposed())return;if(this.suspendedNewMatches)return void(this.suspendedNewMatches[0]=e);for(var r in this.composedActive){var n=this.composedActive[r];i&&n instanceof InternalQueryResult||n.addMatches(e,this)}}}}function identityResultAddMatchesWithoutRaising(e,t){var i,r=[],n=[];if(void 0===this.identity)for(var o=this.monitor.requestIdentity(e),s=0,a=e.length;s<a;++s){var d=e[s];if(void 0!=(i=this.getIdentifiedId(d))){var u=o[s];void 0!==u&&(r.push(i),n.push(-u))}}else for(var s=0,a=e.length;s<a;++s){var d=e[s];void 0!=(i=this.getIdentifiedId(d))&&(r.push(i),n.push(this.identity))}this.identityIndexer.addIdentities(r,n,this.identificationId,t==this.identifiedDataObj)}function identityResultAddMatchesWithRaising(e,t){var i,r=[],n=[];if(void 0===this.identity)for(var o=this.monitor.requestIdentity(e),s=0,a=e.length;s<a;++s){var d=e[s];if(void 0!=(i=this.getIdentifiedId(d))){var u=o[s];if(void 0!==u&&(r.push(i),n.push(-u)),d==i)i in this.raisedIdentified&&delete this.raisedIdentified[i];else if(i in this.raisedIdentified[i]){var h=this.raisedIdentified[i];d in h.matches||h.numMatches++,h.matches[d]=u}else{var h=this.raisedIdentified[i]={numMatches:1,matches:{}};h.matches[d]=u}}}else for(var s=0,a=e.length;s<a;++s){var d=e[s];void 0!=(i=this.getIdentifiedId(d))&&(d==i?i in this.raisedIdentified?delete this.raisedIdentified[i]:(r.push(i),n.push(this.identity)):i in this.raisedIdentified?this.identified[i]++:(this.identified[i]=1,r.push(i),n.push(this.identity)))}this.identityIndexer.addIdentities(r,n,this.identificationId,t==this.identifiedDataObj)}function identityResultGetIdentifiedId(e){var t=this.identityIndexer.getDataElements();if(!this.needToRaiseMatches)return!t.hasEntry(e)||this.identifyAtIdentifiedPathOnly&&t.getPathId(e)!=this.identifiedPathId?void 0:e;if(this.identityIndexer!=this.sourceIndexer)for(var i=this.sourceIndexer.getDataElements();!t.hasEntry(e);)if(void 0===(e=i.getParentId(e)))return;return this.identifyAtIdentifiedPathOnly?t.raiseExactlyToPath(e,this.identifiedPathId):t.raiseToPath(e,this.identifiedPathId)}function identityResultRemoveMatches(e,t){if(0!=e.length){if(t==this.identifiedDataObj&&this.composedActiveNum>0){var i=0==this.getDomMatchCount();if(i&&!this.hasNonQueryActiveComposed())return;for(var r in this.composedActive){var n=this.composedActive[r];i&&n instanceof InternalQueryResult||n.removeMatches(e,this)}}if(t==this.identificationObj){for(var o,s=[],a=0,d=e.length;a<d;++a){var u=e[a];if(void 0!=(o=this.getIdentifiedId(u)))if(u!=o)if(this.identity)--this.raisedIdentified[o]||(delete this.raisedIdentified[o],s.push(o));else{var h=this.raisedIdentified[o];--h.numMatches?delete h.matches[u]:(delete this.raisedIdentified[o],s.push(o))}else s.push(o)}this.identityIndexer.removeIdentities(s,this.identificationId,t==this.identifiedDataObj),void 0===this.identity&&this.monitor.releaseIdentity(e)}}}function identityResultRemoveAllMatches(e){if(e==this.identificationObj&&(this.raisedIdentified&&(this.raisedIdentified={}),this.identityIndexer.removeAllIdentities(this.identificationId),void 0===this.identity&&this.monitor.releaseAllIdentities()),e==this.identifiedDataObj&&this.composedActiveNum>0)for(var t in this.composedActive)this.composedActive[t].removeAllMatches(this)}function identityResultAddProjMatches(e,t){var i=void 0!==this.identifiedDataObj&&t==this.identifiedDataObj.getId()?this.identifiedDataObj:this.identificationObj;this.addMatches(e,i)}function identityResultRemoveProjMatches(e,t){var i=void 0!==this.identifiedDataObj&&t==this.identifiedDataObj.getId()?this.identifiedDataObj:this.identificationObj;this.removeMatches(e,i)}function identityResultGetMonitoredElements(){return this.identificationObj?this.identificationObj.getDominatedMatches():[]}function identityResultFilterMonitoredElements(e){return this.identificationObj?this.identificationObj.filterDominatedMatches(e):[]}function identityResultUpdateKeys(e,t,i,r,n){if(this.monitor){var o=this.identificationObj.filterDominatedMatchPositions(e);this.monitor.updateKeys(e,t,i,r,n,o)}}function identityResultUpdateCompressedValues(e,t){for(var i,r=[],n=[],o=0,s=e.length;o<s;++o){var a=e[o];void 0!=(i=this.getIdentifiedId(a))&&(r.push(i),n.push(-t[o]))}this.identityIndexer.addIdentities(r,n,this.identificationId)}function identityResultGetDominatedIndexer(){if(void 0!==this.identifiedDataObj)return this.identifiedDataObj.getDominatedIndexer()}function identityResultGetDominatedProjPathId(){if(void 0!==this.identifiedDataObj)return this.identifiedDataObj.getDominatedProjPathId()}function identityResultGetDominatedProjPathNum(){if(void 0!==this.identifiedDataObj)return this.identifiedDataObj.getDominatedProjPathNum()}function identityResultGetDominatedProjMappings(){if(void 0!==this.identifiedDataObj)return this.FuncResult_getDominatedProjMappings()}function identityResultGetTerminalProjMatches(e){return void 0===this.identifiedDataObj?[]:this.identifiedDataObj.getDominatedMatches()}function identityResultFilterTerminalProjMatches(e,t){return void 0===this.identifiedDataObj?[]:this.identifiedDataObj.filterDominatedMatches(t)}function identityResultGetDomMatchCount(){return this.identifiedDataObj?0==this.identifiedDataObj.getDomMatchCount()?0:1:0}function identityResultGetDominatedMatches(){return void 0===this.identifiedDataObj?[]:this.identifiedDataObj.getDominatedMatches()}function identityResultGetDominatedMatchesAsObj(){return void 0===this.identifiedDataObj?new Map:this.identifiedDataObj.getDominatedMatchesAsObj()}function identityResultFilterDominatedMatches(e){return void 0===this.identifiedDataObj?[]:this.identifiedDataObj.filterDominatedMatches(e)}function identityResultFilterDominatedMatchPositions(e){return void 0===this.identifiedDataObj?[]:this.identifiedDataObj.filterDominatedMatchPositions(e)}function identityResultGetDominatedIdentification(){return this.identificationId}function identityResultGetDominatedComparison(){if(void 0!==this.identifiedDataObj)return this.identifiedDataObj.getDominatedComparison()}function identityResultIsSelection(){return!0}function identityResultRemoveAllIndexerMatches(){}function identityResultSetMatchPoints(e){this.matchPoints=new Map;for(var t=0,i=e.length;t<i;++t)this.matchPoints.set(e[t],!0);this.lowestMatchPoint=e[0],this.calcNeedToRaiseMatches()}function identityResultAddToMatchPoints(e){this.matchPoints.set(e,!0),e>this.lowestMatchPoint&&(this.lowestMatchPoint=e,this.needToRaiseMatches||this.calcNeedToRaiseMatches())}function identityResultRemoveFromMatchPoints(e){if(this.matchPoints.delete(e),this.lowestMatchPoint==e){this.lowestMatchPoint=0;var t=this;this.matchPoints.forEach(function(e,i){i>t.lowestMatchPoint&&(t.lowestMatchPoint=i)}),this.needToRaiseMatches&&this.calcNeedToRaiseMatches()}}function identityResultCalcNeedToRaiseMatches(){return this.needToRaiseMatches=this.lowestMatchPoint!==this.qcm.getRootPathId()&&(this.sourceIndexer!=this.identityIndexer||this.lowestMatchPoint>this.identifiedPathId),this.needToRaiseMatches!=!this.raisedIdentified&&(this.raisedIdentified=this.needToRaiseMatches?{}:void 0),this.needToRaiseMatches}function IdentityIndexer(e){this.InternalQCMIndexer(e),this.additionalIdentityResults={},this.additionalIdentities=new Map,this.identityUpdates=new Map,this.identityUpdatesScheduled=!1}function identityIndexerDestroy(){this.InternalQCMIndexer_destroy()}function identityIndexerPathNodeActivated(){}function identityIndexerPathNodeDeactivated(){}function identityIndexerGetIdentity(e,t){var i;return void 0!==e&&void 0!==(i=this.getAdditionalIdentity(e,t))?i:this.dataElements.getBaseIdentity(t)}function identityIndexerGetIdentities(e,t){var i,r=[];if(e&&void 0!==(i=this.additionalIdentities.get(e))){for(var n=0,o=t.length;n<o;++n){var s=t[n];if(void 0!==s){var a=i.get(s);void 0===a?r.push(this.dataElements.getBaseIdentity(s)):r.push(a)}else r.push(void 0)}return r}return this.dataElements.getBaseIdentities(t)}function identityIndexerGetBaseIdentity(e){return this.dataElements.getBaseIdentity(e)}function identityIndexerGetAdditionalIdentity(e,t){var i;if(void 0!==(i=this.additionalIdentities.get(e)))return i.get(t)}function identityIndexerGetAllIdentities(e){return this.additionalIdentities.get(e)}function identityIndexerAssignDefaultBaseIdentity(e){this.dataElements.assignDefaultBaseIdentity(e)}function identityIndexerSetBaseIdentityForExistingNode(e,t){this.dataElements.setBaseIdentityForExistingNode(e,t)}function identityIndexerScheduleIdentityUpdate(){this.identityUpdatesScheduled||this.qcm.scheduleIdentityUpdate(this)}function identityIndexerNotifyBaseIdentities(){var e=this.dataElements.createBaseIdentityNotifications();if(void 0!==e){var t=this;e.forEach(function(e,i){var r;if(void 0!=(r=t.createDefaultAdditionalNotifications(e)))for(var n=0,o=r.length;n<o;++n){var s=r[n];t.notifyOfAddedIdentities(s.elementIds,i,s.identities,s.identificationId)}t.notifyOfAddedIdentities(e.elementIds,i,e.identities,0),t.dataElements.setNotifiedBaseIdentities(e.elementIds,e.identities)}),this.dataElements.hasPendingBaseIdentities()&&this.notifyBaseIdentities()}}function identityIndexerCreateDefaultAdditionalNotifications(e){if(0!=this.additionalIdentities.size){var t=[];return this.additionalIdentities.forEach(function(i,r){for(var n=[],o=[],s=0,a=e.elementIds.length;s<a;++s){var d=e.elementIds[s];i.has(d)||(n.push(d),o.push(e.identities[s]))}n.length>0&&t.push({identificationId:r,elementIds:n,identities:o})}),t}}function identityIndexerNotifyOfAddedIdentities(e,t,i,r,n){if(void 0!==this.requiresTargetIdentification&&this.requiresTargetIdentification(t,r)&&this.updateTargetIdentities(e,i,r),!n){var o=this.pathNodesById[t];if(0!=o.mappedIdentifications.size&&o.mappedIdentifications.has(r)){var s=o.mappedIdentifications.get(r),a=this;s.forEach(function(t,n){var o=a.identityUpdates.get(n).indexer;o.updateSourceIdentity(a,e,i,r)})}}}function identityIndexerQueueRemoveAllIdentities(e){void 0===this.pendingRemoveAll&&(this.pendingRemoveAll=new Map),this.pendingRemoveAll.set(e,!0),this.identityUpdatesScheduled||this.qcm.scheduleIdentityUpdate(this)}function identityIndexerNotifyRemoveAllIdentities(e,t){if(void 0!==this.pendingRemoveAll&&this.pendingRemoveAll.has(e)){this.pendingRemoveAll.delete(e);var i=this.additionalIdentities.get(e);if(void 0!==i){var r;if(t){r=new Map;for(var n=0,o=t.length;n<o;++n)r.set(t[n])}var s=[],a=[],d=this;if(i.forEach(function(e,t){void 0!==r&&r.has(t)||d.dataElements.hasEntry(t)&&(s.push(t),a.push(d.dataElements.getBaseIdentity(t)))}),s.length>0){var u=this.getIdentifiedPathId(e);this.notifyOfAddedIdentities(s,u,a,e)}this.additionalIdentities.set(e,new Map)}}}function identityIndexerUpdatePendingIdentities(){if(this.notifyBaseIdentities(),void 0!==this.pendingRemoveAll){var e=this;this.pendingRemoveAll.forEach(function(t,i){e.notifyRemoveAllIdentities(i)}),this.pendingRemoveAll=void 0}}function identityIndexerRegisterIdentification(e,t){var i=this.additionalIdentityResults[e];return i?i.requestNum>0:(this.additionalIdentityResults[e]={requestNum:0,identityResult:t},this.additionalIdentities.has(e)||this.additionalIdentities.set(e,new Map),!1)}function identityIndexerUnregisterIdentification(e){var t=this.additionalIdentityResults[e];if(t)if(0==t.requestNum)delete this.additionalIdentityResults[e],this.additionalIdentities.delete(e);else{var i=[],r=this.additionalIdentities.get(e);r.size>0&&(r.forEach(function(e,t){i.push(t)}),this.removeIdentities(i,e)),t.identityResult=void 0,this.additionalIdentities.set(e,new Map)}}function identityIndexerRequestIdentification(e){var t=this.additionalIdentityResults[e];t?1==++t.requestNum&&t.identityResult.activated():(this.additionalIdentityResults[e]={requestNum:1,identityResult:void 0},this.additionalIdentities.has(e)||this.additionalIdentities.set(e,new Map))}function identityIndexerReleaseIdentification(e){var t=this.additionalIdentityResults[e];t&&0==--t.requestNum&&(t.identityResult?t.identityResult.deactivated():(this.additionalIdentities.delete(e),delete this.additionalIdentityResults[e]))}function identityIndexerHasIdentificationRequests(e){return e in this.additionalIdentityResults&&this.additionalIdentityResults[e].requestNum>0}function identityIndexerGetIdentifiedPathId(e){var t=this.additionalIdentityResults[e].identityResult;if(void 0!==t)return t.getIdentifiedPathId()}function identityIndexerNotificationRequired(e,t){if(void 0!==this.requiresTargetIdentification&&this.requiresTargetIdentification(e,t))return!0;var i=this.pathNodesById[e];return t?i.mappedIdentifications.size>0&&i.mappedIdentifications.has(t):i.mappedIdentifications.size>0}function identityIndexerAddMappedIdentification(e,t,i){var r;e.mappedIdentifications.has(i)?r=e.mappedIdentifications.get(i):(r=new Map,e.mappedIdentifications.set(i,r));var n,o=t.getId();if(r.size>0&&r.has(o))n=r.get(o);else if(n={numTracing:0,numMonitors:0},r.set(o,n),this.identityUpdates.has(o)){var s=this.identityUpdates.get(o);s.refCount++}else{var s={indexer:t,refCount:1};this.identityUpdates.set(o,s)}return n}function identityIndexerRemoveMappedIdentification(e,t,i,r){var n=e.mappedIdentifications.get(i),o=t.getId(),s=n.get(o);if(r?s.numTracing--:s.numMonitors--,0==s.numTracing&&0==s.numMonitors){var s=this.identityUpdates.get(o);0==--s.refCount&&this.identityUpdates.delete(o),1==n.size?e.mappedIdentifications.delete(i):delete n.delete(o)}}function identityIndexerAddTracingIdentification(e,t,i,r){var n=this.pathNodesById[e];void 0!==n&&this.addTracingIdentificationToPath(n,t,i,r)}function identityIndexerAddTracingIdentificationToPath(e,t,i,r){void 0===i&&(i=0),e.parent&&!r&&this.addTracingIdentificationToPath(e.parent,t,i,!1);var n=this.addMappedIdentification(e,t,i);n.numTracing++}function identityIndexerRemoveTracingIdentification(e,t,i,r){var n=this.pathNodesById[e];void 0!==n&&this.removeTracingIdentificationFromPath(n,t,i,r)}function identityIndexerRemoveTracingIdentificationFromPath(e,t,i,r){void 0===i&&(i=0),this.removeMappedIdentification(e,t,i,!0),e.parent&&!r&&this.removeTracingIdentificationFromPath(e.parent,t,i,!1)}function identityIndexerAddMonitoringIdentification(e,t,i){var r=this.pathNodesById[e];void 0!==r&&this.addMonitoringIdentificationToPath(r,t,i)}function identityIndexerAddMonitoringIdentificationToPath(e,t,i){void 0===i&&(i=0);var r=this.addMappedIdentification(e,t,i);r.numMonitors++;for(var n in e.children)this.addMonitoringIdentificationToPath(e.children[n],t,i)}function identityIndexerRemoveMonitoringIdentification(e,t,i){var r=this.pathNodesById[e];void 0!==r&&this.removeMonitoringIdentificationFromPath(r,t,i)}function identityIndexerRemoveMonitoringIdentificationFromPath(e,t,i){void 0===i&&(i=0),this.removeMappedIdentification(e,t,i,!1);for(var r in e.children)this.removeMonitoringIdentificationFromPath(e.children[r],t,i)}function identityIndexerInitMappedIdentifications(e){e.mappedIdentifications=new Map;var t=e.parent;t&&0!=t.mappedIdentifications.size&&t.mappedIdentifications.forEach(function(t,i){var r;t.forEach(function(t,n){var o=t.numMonitors;0!=o&&(r||(r=new Map,e.mappedIdentifications.set(i,r)),r.set(n,{numTracing:0,numMonitors:o}))})})}function identityIndexerAddIdentities(e,t,i,r){var n=this.getIdentifiedPathId(i),o=this.additionalIdentities.get(i);this.notifyOfAddedIdentities(e,n,t,i,r),void 0!==this.pendingRemoveAll&&this.pendingRemoveAll.has(i)&&this.notifyRemoveAllIdentities(i,e);for(var s=0,a=e.length;s<a;++s)o.set(e[s],t[s])}function identityIndexerRemoveIdentities(e,t,i){if(void 0===this.pendingRemoveAll||!this.pendingRemoveAll.has(t)){var r=this.getIdentifiedPathId(t);if(!i&&this.notificationRequired(r,t)){for(var n=this.pathNodesById[r],o=[],s=[],a=0,d=e.length;a<d;++a){var u=e[a];n.nodes.has(u)&&(o.push(u),s.push(this.getBaseIdentity(u)))}this.notifyOfAddedIdentities(o,r,s,t)}for(var h=this.additionalIdentities.get(t),a=0,d=e.length;a<d;++a){var u=e[a];h.has(u)&&h.delete(u)}}}function identityIndexerRemoveAllIdentities(e){var t=this.getIdentifiedPathId(e);return this.notificationRequired(t,e)?void this.queueRemoveAllIdentities(e):void this.additionalIdentities.set(e,new Map)}function identityIndexerCreatePathNode(e){if(e in this.pathNodesById)return this.pathNodesById[e];var t=this.InternalQCMIndexer_createPathNode(e);return this.initMappedIdentifications(t),t}function ResultToMerge(e,t,i,r,n,o,s,a){this.FuncResult(e),this.targetIndexer=t,this.minTargetPathId=i,this.qcm.allocatePathIdByPathId(i),this.priority=r,this.sourceIdentificationId=n,this.targetIdentificationId=o,this.underIdentity=!!s,this.identityOnly=!!a,this.mappings=new Map,this.projId=void 0,this.pendingAddMatches=void 0,this.targetIndexer.registerPathActiveNotifications(this.minTargetPathId,this)}function resultToMergeDestroy(){this.targetIndexer.unregisterPathActiveNotifications(this.minTargetPathId,this.getId()),this.removeMapping(),this.qcm.releasePathId(this.minTargetPathId),this.FuncResult_destroy()}function resultToMergeSupportsMultiProj(){return!0}function resultToMergeIsActive(){return this.targetIndexer.isPathActive(this.minTargetPathId)}function resultToMergeRefreshIndexerAndPaths(){if(void 0!==this.sourceIndexer||void 0!==this.dataObj){var e=this.sourceIndexer;this.sourceIndexer=this.dataObj?this.dataObj.getDominatedIndexer():void 0;var t=this.targetIndexer.getRegisteredFuncProjections(this.getId()),i=this.dataObj?this.dataObj.getDominatedProjMappings():void 0;if(e){if(e==this.sourceIndexer&&i){if(t){var r=this;t.forEach(function(e,t){i.has(t)||r.removeMapping(t)})}}else this.removeMapping();this.projId=void 0}this.sourceIndexer&&i&&this.refreshProjMappings(i)}}function resultToMergeReplaceIndexerAndPaths(e,t,i){var r=this.dataObj.getDominatedProjMappings();if(void 0!==r){var n=this;r.forEach(function(e,t){e=n.prefixMinTargetPath(e,t),r.set(t,e)});var o=this.dataObj.getDominatedIndexer();if(!this.targetIndexer.replaceFuncSource(this,r,e,t,o,this.sourceIdentificationId))return void this.refreshIndexerAndPaths();this.removeProjMappingArray(void 0),this.projId=void 0;var s;r.forEach(function(e,t){n.mappings.set(t,e),void 0!==s?n.projId=void 0:n.projId=t})}}function resultToMergeRefreshProjMappings(e){var t;void 0==this.sourceIdentificationId?t=this.dataObj.getDominatedIdentification():0!=this.sourceIdentificationId&&(t=this.sourceIdentificationId),this.projId=void 0;var i,r=this;e.forEach(function(e,n){r.mappings.has(n)&&r.removeProjMappingArray(n),e=r.prefixMinTargetPath(e,n),r.targetIndexer.addMapping(r,n,r.sourceIndexer,e,r.priority,t,r.targetIdentificationId,r.underIdentity,r.identityOnly),e&&(r.mappings.set(n,e),void 0!==i?r.projId=void 0:r.projId=n)})}function resultToMergePrefixMinTargetPath(e){if(void 0!==e){for(var t=[],i=0,r=e.length;i<r;i+=2)t.push(this.qcm.allocateConcatPathId(this.minTargetPathId,e[i]),e[i+1]);return t}}function resultToMergeRemoveMapping(e){void 0===e?(this.targetIndexer.removeMapping(this),this.removeProjMappingArray()):(this.targetIndexer.removeMapping(this,e),this.removeProjMappingArray(e))}function resultToMergeRemoveProjMappingArray(e){if(void 0===e){var t=this;this.mappings.forEach(function(e,i){t.removeProjMappingArray(i)})}else{var i=this.mappings.get(e);if(void 0===i)return;for(var r=0,n=i.length;r<n;r+=2)this.qcm.releasePathId(i[r]);if(this.mappings.delete(e),1==this.mappings.size){var t=this;this.mappings.forEach(function(e,i){t.projId=e})}else 0==this.mappings.size&&(this.projId=void 0)}}function resultToMergeAddDataObjMatches(e,t){if(t){var i=this;this.mappings.forEach(function(e,t){i.targetIndexer.addProjMatches(i.dataObj.getDominatedMatches(t),i.getId(),t)})}else{for(var r=this.dataObj.getDominatedMatches(),n=e.getDominatedMatchesAsObj(),o=[],s=0,a=r.length;s<a;++s){var d=r[s];n.has(d)||o.push(d)}this.targetIndexer.addProjMatches(o,this.getId(),this.projId)}}function resultToMergeRemoveDataObjMatches(e,t){if(t){var i=this;this.mappings.forEach(function(e,t){i.targetIndexer.removeProjMatches(i.dataObj.getDominatedMatches(t),i.getId(),t)})}else{for(var r=this.dataObj.getDominatedMatches(),n=e.getDominatedMatchesAsObj(),o=[],s=0,a=r.length;s<a;++s){var d=r[s];n.has(d)||o.push(d)}this.targetIndexer.removeProjMatches(o,this.getId(),this.projId)}}function resultToMergeAddMatches(e){return void 0!==this.pendingAddMatches?void this.pendingAddMatches.push({elementIds:e,projId:this.projId}):void this.targetIndexer.addProjMatches(e,this.getId(),this.projId)}function resultToMergeRemoveMatches(e){this.targetIndexer.removeProjMatches(e,this.getId(),this.projId)}function resultToMergeRemoveAllMatches(e){this.removeMatches(this.dataObj.getDominatedMatches())}function resultToMergeAddProjMatches(e,t,i){return void 0!==this.pendingAddMatches?void this.pendingAddMatches.push({elementIds:e,projId:i}):void this.targetIndexer.addProjMatches(e,this.getId(),i)}function resultToMergeRemoveProjMatches(e,t,i){this.targetIndexer.removeProjMatches(e,this.getId(),i)}function resultToMergeGetTerminalProjMatches(e){return void 0===this.dataObj?[]:this.dataObj.getTerminalProjMatches(e)}function resultToMergeFilterTerminalProjMatches(e,t){return void 0===this.dataObj?[]:this.dataObj.filterTerminalProjMatches(e,t)}function resultToMergePathActivated(e){this.activated()}function resultToMergeActivated(){this.pendingAddMatches=[],this.FuncResult_activated(),void 0===this.sourceIndexer&&this.refreshIndexerAndPaths();for(var e=0,t=this.pendingAddMatches.length;e<t;++e){var i=this.pendingAddMatches[e];this.targetIndexer.addProjMatches(i.elementIds,this.getId(),void 0===i.projId?this.projId:i.projId)}this.pendingAddMatches=void 0}function resultToMergePathDeactivated(e){this.deactivated()}function resultToMergeDeactivated(){this.FuncResult_deactivated(),void 0!==this.sourceIndexer&&(this.sourceIndexer=void 0,this.removeMapping(),this.refreshIndexerAndPaths())}function SourceNodes(){this.nodes=new Map}function sourceNodesHasNode(e){return this.nodes.has(e)}function sourceNodesGetCount(e){return this.nodes.get(e)}function sourceNodesNumNodes(){return this.nodes.size}function sourceNodesIncNode(e){return this.nodes.has(e)?(this.nodes.set(e,this.nodes.get(e)+1),!1):(this.nodes.set(e,1),!0)}function sourceNodesDecNode(e){var t=this.nodes.get(e)-1;return 0==t?this.nodes.delete(e):this.nodes.set(e,t),t}function sourceNodesClear(){this.nodes.clear()}function sourceNodesGetAllSourceNodes(){var e=[];return this.nodes.forEach(function(t,i){e.push(i)}),e}function sourceNodesFilterSourceNodes(e){var t=[];if(0==this.nodes.size)return t;for(var i=0,r=e.length;i<r;++i){var n=e[i];this.nodes.has(n)&&t.push(n)}return t}function IdentitySourceNodes(e,t,i){this.sourceIndexer=e,this.sourceIdentificationId=t,this.identityNodes=new Map,this.byIdentities=new Map}function identitySourceNodesGetSourceIdentity(e){return this.sourceIndexer.getIdentity(this.sourceIdentificationId,e)}function identitySourceNodesAssignDataElementId(e){return e>0?e:InternalQCMIndexer.getNextDataElementId()}function identitySourceNodesIncNode(e){var t,i,r=this.getSourceIdentity(e);if(this.byIdentities.has(r)){t=this.byIdentities.get(r);var n=this.identityNodes.get(t);n.count++,i=!1}else t=this.assignDataElementId(r),this.byIdentities.set(r,t),this.identityNodes.set(t,{identity:r,count:1}),i=!0;return{idNodeId:t,identity:r,isNew:i}}function identitySourceNodesDecNode(e){var t=this.getSourceIdentity(e),i=this.byIdentities.get(t),r=this.identityNodes.get(i);return 0===--r.count&&(this.identityNodes.delete(i),this.byIdentities.delete(t)),{idNodeId:i,identity:t,count:r.count}}function identitySourceNodesIncRaised(e){if(void 0===this.raised&&(this.raised=new Map),this.raised.has(e)){var t=this.raised.get(e)+1;return this.raised.set(e,t),t}return this.raised.set(e,1),1}function identitySourceNodesDecRaised(e){var t=this.raised.get(e)-1;return 0==t?this.raised.delete(e):this.raised.set(e,t),t}function identitySourceNodesGetRaisedCount(e){return void 0===this.raised?0:this.raised.has(e)?this.raised.get(e):0}function identitySourceNodesNumRaised(){return void 0===this.raised?0:this.raised.size}function identitySourceNodesClear(){this.identityNodes.clear(),this.byIdentities.clear(),void 0!==this.raised&&this.raised.clear()}function identitySourceNodesGetAllSourceNodes(){var e=[];return this.identityNodes.forEach(function(t,i){e.push(i)}),e}function identitySourceNodesGetIdentityNodeId(e){var t=this.getSourceIdentity(e);if(void 0!==t)return this.byIdentities.get(t)}function identitySourceNodesGetIdNodeIdentity(e){var t=this.identityNodes.get(e);if(void 0!==t)return t.identity}function identitySourceNodesGetIdNodeIdentities(e){for(var t=[],i=0,r=e.length;i<r;++i){var n=this.identityNodes.get(e[i]);void 0!==n&&(t[i]=n.identity)}return t}function identitySourceNodesReplaceSourceIdentification(e,t){this.sourceIndexer=e,this.sourceIdentificationId=t}function identitySourceNodesUpdateIdentity(e,t,i){var r={added:[],removed:[]},n=this.getSourceIdentity(e);if(n==i)return r;var o=this.byIdentities.get(n),s=this.identityNodes.get(o);if(s.count-=t,s.count<=0&&(this.identityNodes.delete(o),this.byIdentities.delete(n),r.removed.push(o)),this.byIdentities.has(i)){o=this.byIdentities.get(i);var a=this.identityNodes.get(o);a.count+=t}else o=this.assignDataElementId(i),this.byIdentities.set(i,o),this.identityNodes.set(o,{identity:i,count:t}),r.added.push({idNodeId:o});return r}function DominatedIdentitySourceNodes(e,t,i){this.sourceIndexer=e,this.sourceIdentificationId=t,this.prefixSourcePathId=e.qcm.getPrefix(i),this.identityNodes=new Map,this.byIdentities=new Map}function dominatedIdentitySourceNodesGetSourceIdentity(e){return this.sourceIndexer.getIdentity(this.sourceIdentificationId,e)}function dominatedIdentitySourceNodesAssignDataElementId(e,t){return e>0&&e===t?e:InternalQCMIndexer.getNextDataElementId()}function dominatedIdentitySourceNodesIncNode(e){var t,i=this.sourceIndexer.raiseToPath(e,this.prefixSourcePathId),r=this.getSourceIdentity(e);return i!==e?(t=this.getSourceIdentity(i),this.incParent(i)):t=r,this.incNodeWithParent(e,i,r,t,1)}function dominatedIdentitySourceNodesIncNodeWithParent(e,t,i,r,n){var o,s,a;if(this.byIdentities.has(i)?a=this.byIdentities.get(i):(a={idNodeId:void 0,parentIdentities:void 0},this.byIdentities.set(i,a),s=!0),i==r?void 0!==a.idNodeId?(o=a.idNodeId,s=!1):(o=a.idNodeId=this.assignDataElementId(i,r),s=!0):(void 0===a.parentIdentities?a.parentIdentities=new Map:a.parentIdentities.has(r)&&(o=a.parentIdentities.get(r),s=!1),s!==!1&&(s=!0,o=this.assignDataElementId(i,r),a.parentIdentities.set(r,o))),s)this.identityNodes.set(o,{identity:i,parentIdentity:r,count:n});else{var d=this.identityNodes.get(o);d.count+=n}return{idNodeId:o,parentId:t,identity:i,parentIdentity:r,isNew:s}}function dominatedIdentitySourceNodesDecNode(e,t){void 0===t&&(t=1);var i,r=this.sourceIndexer.raiseToPath(e,this.prefixSourcePathId),n=this.getSourceIdentity(e);return r!==e?(i=this.getSourceIdentity(r),this.decParent(r)):i=n,this.decNodeWithParent(e,r,n,i,1)}function dominatedIdentitySourceNodesDecNodeWithParent(e,t,i,r,n){var o,s=this.byIdentities.get(i);o=i==r?s.idNodeId:s.parentIdentities.get(r);var a=this.identityNodes.get(o);return a.count-=n,0==a.count&&(this.identityNodes.delete(o),i==r?void 0===s.parentIdentities||0==s.parentIdentities.size?this.byIdentities.delete(i):s.idNodeId=void 0:1==s.parentIdentities.size&&void 0===s.idNodeId?this.byIdentities.delete(i):s.parentIdentities.delete(r)),{idNodeId:o,parentId:t,identity:i,parentIdentity:r,count:a.count}}function dominatedIdentitySourceNodesIncRaised(e){if(void 0===this.raised&&(this.raised=new Map),this.raised.has(e)){var t=this.raised.get(e)+1;return this.raised.set(e,t),t}return this.raised.set(e,1),1}function dominatedIdentitySourceNodesDecRaised(e){var t=this.raised.get(e)-1;return 0==t?this.raised.delete(e):this.raised.set(e,t),t}function dominatedIdentitySourceNodesGetRaisedCount(e){return void 0===this.raised?0:this.raised.has(e)?this.raised.get(e):0}function dominatedIdentitySourceNodesNumRaised(){return void 0===this.raised?0:this.raised.size}function dominatedIdentitySourceNodesIncParent(e){if(void 0===this.parents&&(this.parents=new Map),this.parents.has(e)){var t=this.parents.get(e)+1;return this.parents.set(e,t),t}return this.parents.set(e,1),1}function dominatedIdentitySourceNodesDecParent(e){var t=this.parents.get(e)-1;return 0==t?this.parents.delete(e):this.parents.set(e,t),t}function dominatedIdentitySourceNodesGetParentCount(e){return void 0===this.parents?0:this.parents.has(e)?this.parents.get(e):0}function dominatedIdentitySourceNodesNumParents(){return void 0===this.parents?0:this.parents.size}function dominatedIdentitySourceNodesClear(){this.identityNodes.clear(),this.byIdentities.clear(),void 0!==this.raised&&this.raised.clear(),void 0!==this.parents&&this.parents.clear()}function dominatedIdentitySourceNodesReplaceSourceIdentification(e,t){
this.sourceIndexer=e,this.sourceIdentificationId=t}function dominatedIdentitySourceNodesGetAllSourceNodes(){var e=[];return this.identityNodes.forEach(function(t,i){e.push(i)}),e}function dominatedIdentitySourceNodesGetIdentityNodeId(e){var t=this.sourceIndexer.raiseToPath(e,this.prefixSourcePathId),i=this.getSourceIdentity(e),r=t==e?i:this.getSourceIdentity(t),n=this.byIdentities.get(i);if(void 0!==n){if(i==r)return n.idNodeId;if(void 0!=n.parentIdentities)return n.parentIdentities.get(r)}}function dominatedIdentitySourceNodesGetIdNodeIdentity(e){var t=this.identityNodes.get(e);if(void 0!==t)return t.identity}function dominatedIdentitySourceNodesGetParentIdentity(e){var t=this.identityNodes.get(e);if(void 0!==t)return t.parentIdentity}function dominatedIdentitySourceNodesUpdateIdentity(e,t,i){var r={added:[],removed:[]},n=this.sourceIndexer.raiseToPath(e,this.prefixSourcePathId),o=this.getSourceIdentity(e),s=n==e?o:this.getSourceIdentity(n),a=this.decNodeWithParent(e,n,o,s,t);0==a.count&&r.removed.push(a.idNodeId);var d=a.parentId==e?i:a.parentIdentity,u=this.incNodeWithParent(e,a.parentId,i,d,t);return u.isNew&&r.added.push({idNodeId:u.idNodeid,parentIdentity:u.parentIdentity}),r}function dominatedIdentitySourceNodesUpdateParentIdentity(e,t,i,r){for(var n={added:[],removed:[]},o=0,s=e.length;o<s;++o){var a=e[o],d=this.decNode(a,t[o]);0==d.count&&n.removed.push(d.idNodeId);var u=this.incNodeWithParent(a,d.parentId,d.identity,r,t[o]);u.isNew&&n.added.push({idNodeId:u.idNodeid,parentIdentity:r})}return n}function MappedDataElements(e){this.rootPathId=e,this.pathIdPos=new Map,this.pathIds=[],this.pathIdCount=[],this.sourceIds=new Map}function mappedDataElementsIsEmpty(){return 0==this.sourceIds.size}function mappedDataElementsAssignPathPos(e){for(var t=0,i=this.pathIdCount.length;t<i;++t)if(0===this.pathIdCount[t])return this.pathIdPos.set(e,t),this.pathIds[t]=e,t;return this.pathIdCount.push(0),this.pathIdPos.set(e,i),this.pathIds[i]=e,i}function mappedDataElementsAddTargetId(e,t,i,r){var n;if(this.sourceIds.has(e)?n=this.sourceIds.get(e):(n={undominated:void 0,byDominating:void 0},this.sourceIds.set(e,n)),!i)return void 0!==n.undominated?n.undominated:n.undominated=InternalQCMIndexer.getNextDataElementId();var o;o=this.pathIdPos.has(t)?this.pathIdPos.get(t):this.assignPathPos(t);var s;void 0===n.byDominating?(n.byDominating=new Map,s=[],n.byDominating.set(i,s)):n.byDominating.has(i)?s=n.byDominating.get(i):(s=[],n.byDominating.set(i,s));var a=s[o];return void 0===a&&this.pathIdCount[o]++,r?(s[o]=i,i):void 0!==a&&a!==i?a:(a=InternalQCMIndexer.getNextDataElementId(),s[o]=a,a)}function mappedDataElementsRemoveTargetId(e,t,i){if(!this.sourceIds.has(e))return!this.isEmpty();var r=this.sourceIds.get(e);if(!i)return void 0===r.undominated||(r.undominated=void 0,void 0!==r.byDominating&&r.byDominating.size>0||(this.sourceIds.delete(e),!this.isEmpty()));if(void 0===r.byDominating||!r.byDominating.has(i))return!0;var n=this.pathIdPos.get(t);if(void 0===n)return!0;var o=r.byDominating.get(i);if(void 0===o[n])return!0;if(0==--this.pathIdCount[n]&&(this.pathIdPos.delete(t),this.pathIds[n]=void 0),n===o.length-1){for(var s=n-1;s>=0;--s)if(void 0!==o[s])return o.length=s+1,!0;return r.byDominating.size>1?(r.byDominating.delete(i),!0):(this.sourceIds.delete(e),!this.isEmpty())}return o[n]=void 0,!0}function mappedDataElementsGetTargetIdsAtPath(e,t){if(0===this.sourceIds.size)return[];if(!sourceIds.has(e))return[];var i=[],r=this.sourceIds.get(e);if(t===this.rootPathId&&void 0!==r.undominated&&i.push(r.undominated),void 0===r.byDominating||0===r.byDominating.size)return i;var n=this.pathIdPos.get(t);return void 0===n?i:(r.byDominating.forEach(function(e,t){var r=e[n];void 0!==r&&i.push(r)}),i)}function mappedDataElementsGetAllTargetIdsAtPath(e,t,i,r){if(0===this.sourceIds.size)return[];var n=this.pathIdPos.get(t);if(void 0===n&&t!==this.rootPathId||0===this.sourceIds.size){if(!i)return[];if(r)return e;for(var o=new Array(e.length),s=0,a=e.length;s<a;++s)o[s]=[e[s]];return o}for(var o=[],s=0,a=e.length;s<a;++s){var d=e[s];if(void 0!==d)if(this.sourceIds.has(d)){var u=this.sourceIds.get(d),h=r?o:[],l=!1;void 0!==u.undominated&&t===this.rootPathId&&(h.push(u.undominated),l=!0),void 0!==u.byDominating&&u.byDominating.forEach(function(e,t){var i=e[n];void 0!==i&&(h.push(i),l=!0)}),!l&&i&&h.push(d),r||o.push(h)}else i?o.push(r?d:[d]):r||o.push([]);else r?i&&o.push(void 0):o.push([])}return o}function mappedDataElementsGetTargetId(e,t,i){if(0!==this.sourceIds.size&&sourceIds.has(e)){var r=this.sourceIds.get(e);if(!i)return r.undominated;if(void 0!==r.byDominating&&0!==r.byDominating.size){var n=this.pathIdPos.get(t);if(void 0!==n){var o=r.byDominating.get(i);return o[n]}}}}function mappedDataElementsGetAllocatedTargetIds(e){if(0===this.sourceIds.size)return[];if(!sourceIds.has(e))return[];var t=[],i=this.sourceIds.get(e);return void 0!==i.undominated&&t.push(i.undominated),void 0===i.byDominating||0===i.byDominating.size?t:(i.byDominating.forEach(function(e,i){for(var r=0,n=e.length;r<n;++r){var o=e[r];void 0!==o&&o!==i&&t.push(o)}}),t)}function CompCalc(e,t,i,r,n){this.qcm=e,this.id=InternalQCM.newId(),this.qcmKey=n,this.comparison=t,this.indexer=i,this.prefixProjPathId=r,this.results=new Map,this.activeResults=new Map,this.comparison.addCompCalc(this)}function compCalcDestroy(){void 0!==this.comparison&&this.comparison.removeCompCalc(this.getId())}function compCalcGetId(){return this.id}function compCalcGetQCMKey(e){return this.qcmKey}function compCalcAddCompResult(e){this.results.set(e.getId(),e),e.isOrderStar()&&this.resultActivated(e)}function compCalcRemoveCompResult(e){var t=e.getId();return this.activeResults.has(t)&&this.resultDeactivated(e),this.results.delete(t),this.results.size>0}function compCalcRefreshOrdering(){this.activeResults.forEach(function(e,t){e.compCalcRefreshed()})}function compCalcIsActive(){return this.activeResults.size>0}function compCalcResultActivated(e){var t=this.isActive();this.activeResults.set(e.getId(),e),!t&&this.isActive()&&this.activated()}function compCalcResultDeactivated(e){var t=e.getId(),i=this.isActive();this.activeResults.delete(t),i&&!this.isActive()&&this.deactivated()}function compCalcActivated(){assert(!1,"need to define function in derived class")}function compCalcDeactivated(){assert(!1,"need to define function in derived class")}function compCalcNeedToSuspendOrderingUponAddition(){return!0}function CompCalcKeys(e,t){this.defaultKey=t,this.useMinKey=!!e,this.keys=new IntHashMap,this.altKeys=void 0}function compCalcKeysNoSeqKeys(){return!0}function compCalcKeysGetKey(e){return this.keys.get(e)}function compCalcKeysGetCompKey(e){var t=this.keys.get(e);return void 0===t?this.defaultKey:t}function compCalcKeysExpectAdditionalNum(e){this.keys.expectSize(this.keys.size+e)}function compCalcKeysAddKey(e,t){if(void 0===this.keys.get(e))return void this.keys.set(e,t);var i,r=this.keys.get(e);this.useMinKey&&t<r||!this.useMinKey&&t>r?(i=r,this.keys.set(e,t)):i=t,void 0===this.altKeys&&(this.altKeys=new IntHashMap);var n=this.altKeys.get(e);return void 0===n?n=this.altKeys.set(e,[i]):n.push(i),t!==r?r:void 0}function compCalcKeysRemoveKey(e,t){var i;if(this.keys.get(e)===t)if(void 0!==this.altKeys&&void 0!==(i=this.altKeys.get(e))){var r=i.length;if(1==r)this.keys.set(e,i[0]),this.altKeys.delete(e);else{var n=i[0],o=0;if(this.useMinKey)for(var s=1;s<r;++s){var a=i[s];a<=n&&(n=a,o=s)}else for(var s=1;s<r;++s){var a=i[s];a>=n&&(n=a,o=s)}this.keys.set(e,n),o<r-1&&(i[o]=i[r-1]),i.length--}}else this.keys.delete(e);else{i=this.altKeys.get(e);var r=i.length;if(1==r)this.altKeys.delete(e);else for(var s=0;s<r;++s)if(i[s]===t){s<r-1&&(i[s]=i[r-1]),i.length--;break}}}function compCalcKeysRemoveAllKeysEqualTo(e){var t=[],i=this;return this.key.forEach(function(r,n){i.removeAllMatchingKeys(n,function(t){return t===e})&&t.push(n)}),t}function compCalcKeysRemoveAllMatchingKeys(e,t,i){var r=this.keys.get(e);if(void 0===r)return!1;var n=!1;if(t(r)){n=!0,void 0===i&&(i=this.useMinKey?function(e,t){return e<t}:function(e,t){return e>t});var o,s,a,d;if(void 0!==this.altKeys&&void 0!==(a=this.altKeys.get(e))){d=a.length;for(var u=0;u<d;++u){var h=a[u];h===key?(u<d-1&&(a[u]=a[d-1]),a.length--,d--,u--):i(h,o)&&(o=h,s=u)}}0===d&&this.altKeys.delete(e),void 0===o?this.keys.delete(e):(this.keys.set(e,o),1==d?this.altKeys.delete(e):(s<d-1&&(a[s]=a[d-1]),a.length--))}else{var a;if(void 0===this.altKeys||void 0===(a=this.altKeys.get(e)))return!1;for(var u=0,l=a.length;u<l;++u){var h=a[u];t(h)&&(n=!0,u<l-1&&(a[u]=a[l-1]),a.length--,l--,u--)}}return n}function compCalcKeysClear(){this.keys=new IntHashMap,this.altKeys=void 0}function compCalcKeysClearKeysById(e){this.keys.delete(e),void 0!==this.altKeys&&(this.altKeys.delete(e),0===this.altKeys.size&&(this.altKeys=void 0))}function compCalcKeysClearKeysByRefList(e){var t=this;this.keys.forEach(function(i,r){e.has(r)||(void 0!==t.altKeys&&t.altKeys.delete(r),t.keys.delete(r))})}function compCalcKeysTranslateKeys(e,t){void 0===t&&(t=this.useMinKey?function(e,t){return e<t}:function(e,t){return e>t}),void 0!==this.defaultKey&&(this.defaultKey=e(this.defaultKey)),this.translateAltKeys(e,t);var i=this;this.keys.forEach(function(r,n){var o,s=void 0!==i.altKeys?i.altKeys.get(n):void 0,a=void 0;void 0!==s&&(o=s.length,a=s[o-1]);var d=e(r);void 0===d?void 0!==a?(i.keys.set(n,a),1==o?i.altKeys.delete(n):s.length--):i.keys.delete(n):void 0!==a&&t(d,a)?(i.keys.set(n,a),s[o-1]=d):i.keys.set(n,d)})}function compCalcKeysTranslateAltKeys(e,t){if(void 0!==this.altKeys){void 0===t&&(t=this.useMinKey?function(e,t){return e<t}:function(e,t){return e>t});var i=this;this.altKeys.forEach(function(r,n){for(var o,s,a=r.length,d=0;d<a;++d){var u=e(r[d]);void 0===u?(d<a-1&&(r[d]=r[a-1]),r.length--,d--,a--):(r[d]=u,(0==d||t(u,o))&&(o=u,s=d))}if(0==a)i.altKeys.delete(n);else if(s!==a-1){var h=r[d];r[d]=r[a-1],r[a-1]=h}})}}function compCalcKeysSetUseMinKey(e,t){if(e=!!e,!t&&e!=this.useMinKey&&(this.useMinKey=e,void 0!==this.altKeys)){var i=this;this.altKeys.forEach(function(e,t){var r=i.keys.get(t);if(i.useMinKey)for(var n=0,o=e.length;n<o;++n){var s=e[n];s<r&&(e[n]=r,r=s)}else for(var n=0,o=e.length;n<o;++n){var s=e[n];s>r&&(e[n]=r,r=s)}i.keys.set(t,r)})}}function CompCalcSeqKeys(e,t,i,r){void 0!==r?(this.CompCalcKeys(r.useMinKey,r.defaultKey),this.keys=r.keys,this.altKeys=r.altKeys):this.CompCalcKeys(e,t),this.seqCompare=i}function compCalcSeqKeysNoSeqKeys(){return void 0===this.seqCompare}function compCalcSeqKeysSetSeqCompare(e){this.seqCompare=e}function compCalcSeqKeysGetCompKey(e){var t=this.keys.get(e);return void 0===t?this.defaultKey:void 0!==this.seqCompare&&t instanceof Array?t[0]:t}function compCalcSeqKeysAddSeqKey(e,t){if(!this.keys.has(e))return void this.keys.set(e,t);var i,r=this.keys.get(e);this.seqCompare(t,r)<0?(i=r,this.keys.set(e,t)):i=t,void 0===this.altKeys&&(this.altKeys=new IntHashMap);var n=this.altKeys.get(e);void 0===n?(n=[i],this.altKeys.set(e,n)):n.push(i)}function compCalcSeqKeysRemoveSeqKey(e,t){var i;if(0==this.seqCompare(this.keys.get(e),t))if(void 0!==this.altKeys&&void 0!==(i=this.altKeys.get(e))){var r=i.length;if(1==r)this.keys.set(e,i[0]),this.altKeys.delete(e);else{for(var n=i[0],o=0,s=1;s<r;++s){var a=i[s];this.seqCompare(a,n)<=0&&(n=a,o=s)}this.keys.set(e,n),o<r-1&&(i[o]=i[r-1]),i.length--}}else this.keys.delete(e);else{i=this.altKeys.get(e);var r=i.length;if(1==r)this.altKeys.delete(e);else for(var s=0;s<r;++s)if(0==this.seqCompare(i[s],t)){s<r-1&&(i[s]=i[r-1]),i.length--;break}}}function compCalcSeqKeysConvertToSeqKeys(e,t){var i=this.keys.get(e);if(void 0!==i&&(this.keys.set(e,t(i)),void 0!==this.altKeys)){var r=this.altKeys.get(e);if(void 0!==r)for(var n=0,o=r.length;n<o;++n)r[n]=t(r[n])}}function CompValueQueryCalc(e,t,i,r,n,o,s){this.id=InternalQCM.newId(),this.owner=e,this.resultIds=void 0===t?[]:[t],this.pathId=r,this.indexer=i,this.doNotIndex=!0,this.prefixProjPathId=n,this.needKeyUpdates=o,this.needMatchUpdates=s,this.matchPoints=void 0,this.pathNode=this.indexer.addQueryCalcToPathNode(this),this.setNeedKeyUpdates(o)}function compValueQueryCalcIsSelection(){return!this.needMatchUpdates}function compValueQueryCalcDestroy(){this.indexer.removeQueryCalcFromPathNode(this)}function compValueQueryCalcGetId(){return this.id}function compValueQueryCalcNeedToRaiseMatches(){return void 0!==this.matchPoints&&this.matchPoints.size>0}function compValueQueryCalcSetNeedKeyUpdates(e){e!==this.needKeyUpdates&&(this.needKeyUpdates=e,e?this.indexer.needKeyUpdateForQuery(this):this.indexer.stopKeyUpdateForQuery(this))}function compValueQueryCalcAddResultId(e){if(void 0!==e){for(var t=0,i=this.resultIds.length;t<i;++t)if(this.resultIds[t]==e)return;this.resultIds.push(e)}}function compValueQueryCalcRemoveResultId(e){for(var t=0,i=this.resultIds.length;t<i;++t)if(this.resultIds[t]==e){t<i-1&&(this.resultIds[t]=this.resultIds[i-1]),this.resultIds.length--;break}}function compValueQueryCalcGetResultIds(){return this.resultIds}function compValueQueryCalcSetMatchPoints(e){for(var t=0,i=e.length;t<i;++t){var r=e[t];if(r<=this.prefixProjPathId)break;void 0===this.matchPoints&&(this.matchPoints=new Map),this.matchPoints.set(r,!0)}}function compValueQueryCalcAddToMatchPoints(e){e<=this.prefixProjPathId||(void 0===this.matchPoints&&(this.matchPoints=new Map),this.matchPoints.set(e,!0))}function compValueQueryCalcRemoveFromMatchPoints(e){e<=this.prefixProjPathId||void 0===this.matchPoints||this.matchPoints.delete(e)}function compValueQueryCalcAddMatches(e,t){this.owner.addProjPathMatches(e)}function compValueQueryCalcGetAllMatches(){if(this.needMatchUpdates)return this.indexer.getAllMatches(this.pathId)}function compValueQueryCalcRemoveMatches(e,t){this.owner.removeProjPathMatches(e)}function compValueQueryCalcRemoveAllIndexerMatches(){this.needMatchUpdates&&this.owner.removeProjPathMatches(this.indexer.getAllMatches(this.pathId))}function compValueQueryCalcUpdateKeys(e,t,i,r,n){this.owner.updateKeys(this,e,t,i,r,n)}function compValueQueryCalcGetProjKey(e){var t=this.pathNode.nodes.get(e);return void 0===t?void 0:t.key}function compValueQueryCalcGetKnownKey(e){var t=this.indexer.getKnownKey(this.pathNode,e);return void 0===t?void 0:t.key}function PartitionCompResult(e,t,i,r){this.FuncResult(e),this.dataObjs=[],this.compCalc=t,this.argNumByResultId=new Map,this.dataResult=void 0,this.activationPending=!1,this.setDataResult(i,r)}function partitionCompResultDestroy(){if(void 0!==this.dataObjs)for(var e=0,t=this.dataObjs.length;e<t;++e)if(this.dataObjs[e]){var i=this.dataObjs[e];this.setData(void 0,e),i.setData(void 0)}void 0!==this.dataResult&&this.dataResult.destroy(),this.FuncResult_destroy()}function partitionCompResultSetDataResult(e,t){var i;if(void 0===e||void 0===t){if(void 0===this.dataResult)return;i=void 0}else{if(void 0!==this.dataResult&&e==this.dataResult.getDominatedIndexer()&&t==this.dataResult.getDominatedProjPathId())return;i=new DataResult(this.qcm,e,t,void 0,!1)}for(var r=0,n=this.dataObjs.length;r<n;++r)this.dataObjs[r]&&this.dataObjs[r].setData(i);void 0!==this.dataResult&&this.dataResult.destroy(),this.dataResult=i}function partitionCompResultAddQueryResult(e){if(!this.argNumByResultId.has(e.getId())){var t=this.dataObjs.length;this.argNumByResultId.set(e.getId(),t),this.setData(e,t),void 0!==this.dataResult&&e.setData(this.dataResult)}}function partitionCompResultRemoveQueryResult(e){var t=e.getId();if(this.argNumByResultId.has(t)){var i=this.argNumByResultId.get(t),r=this.dataObjs.length-1;this.setData(void 0,i),e.setData(void 0),i!=r&&(this.dataObjs[i]=this.dataObjs[r],this.argNumByResultId.set(this.dataObjs[i].getId(),i)),this.dataObjs.length--,this.argNumByResultId.delete(t)}}function partitionCompResultSupportsMultiProj(){return!1}function partitionCompResultIsActive(){return this.compCalc.isActive()}function partitionCompResultActivated(){this.activationPending=!0,this.FuncResult_activated(),this.activationPending=!1}function partitionCompResultDeactivated(){this.FuncResult_deactivated()}function partitionCompResultRefreshIndexerAndPaths(e){void 0!==e&&(this.activationPending||this.compCalc.removeAllMatches(e),this.compCalc.refreshProjectedKeyPath(e))}function partitionCompResultReplaceIndexerAndPaths(e,t,i,r){this.compCalc.refreshProjectedKeyPath(r)}function partitionCompResultAboutToSetData(e,t){}function partitionCompResultRemoveDataObjMatches(e,t,i){}function partitionCompResultAddDataObjMatches(e,t,i){}function partitionCompResultAddMatches(e,t){this.compCalc.addMatches(e,t)}function partitionCompResultRemoveMatches(e,t){this.compCalc.removeMatches(e,t)}function partitionCompResultRemoveAllMatches(e){this.compCalc.removeAllMatches(e)}function partitionCompResultAddProjMatches(e,t,i){this.addProjMatches(e,t,i)}function partitionCompResultRemoveProjMatches(e,t,i){this.removeProjMatches(e,t,i)}function PartitionCompCalc(e,t,i,r,n){this.compProjPathId=void 0,this.valueQueryCalc=void 0,this.valueAscending=void 0,this.queryToResult=new Map,this.queryResults=new Map,this.gapOrderKey=void 0,this.funcResult=new PartitionCompResult(e,this,i,r),this.partitionRemovedElements=void 0,this.removedElements=void 0,this.removalQueued=!1,this.CompCalc(e,t,i,r,n)}function partitionCompCalcDestroy(){this.removalQueued=!1,this.funcResult.destroy(),this.valueQueryCalc&&this.valueQueryCalc.destroy(),this.queryResults.forEach(function(e,t){e.result.destroy(),e.valueQueryCalc&&e.valueQueryCalc.destroy()}),this.queryResults.clear(),this.queryToResult.clear(),this.CompCalc_destroy()}function partitionCompCalcNumPartitions(){return this.queryResults.size}function partitionCompCalcNeedToSuspendOrderingUponAddition(){return void 0!==this.compProjPathId&&this.compProjPathId===this.prefixProjPathId}function partitionCompCalcActivated(){void 0!==this.funcResult&&this.funcResult.activated()}function partitionCompCalcDeactivated(){void 0!==this.funcResult&&this.funcResult.deactivated()}function partitionCompCalcUpdateQueryData(){var e;e=void 0===this.indexer||void 0===this.prefixProjPathId||void 0===this.comparison?void 0:this.qcm.allocateConcatPathId(this.prefixProjPathId,this.comparison.projPathId),void 0!==this.compProjPathId&&this.qcm.releasePathId(this.compProjPathId),this.compProjPathId=e,this.funcResult.setDataResult(this.indexer,this.compProjPathId);var t=this.valueQueryCalc?this.valueQueryCalc.getId():void 0;this.updateValueQueryCalc(void 0),this.valueQueryCalc.needMatchUpdates&&t!=this.valueQueryCalc.getId()&&this.addProjPathMatches(this.valueQueryCalc.getAllMatches())}function partitionCompCalcUpdatePartition(e,t,i){for(var r=[],n=0,o=!1,s=[],a=0,d=e.length;a<d;++a){a==t&&(void 0!==this.gapOrderKey&&(r[this.gapOrderKey]=n),this.gapOrderKey!==n&&(o=!0),this.gapOrderKey=n,n++);var u=this.addQueryResult(e[a],n,r,s);u.changedOrderKey&&(o=!0),n=u.orderKey}t>=e.length&&(void 0!==this.gapOrderKey&&(r[this.gapOrderKey]=n),this.gapOrderKey!==n&&(o=!0),this.gapOrderKey=n);var h=this;this.queryResults.forEach(function(e,t){e.updated?e.updated=!1:(o=!0,h.removeQueryResult(e))}),this.valueAscending=i,this.updateFirstKeyAfterPartitionUpdate(o,r),this.updateSecondKeyAfterPartitionUpdate(),this.updateQueryData();for(var a=0,d=s.length;a<d;++a)this.funcResult.addQueryResult(s[a].result);this.refreshOrdering()}function partitionCompCalcAddQueryResult(e,t,i,r){var n=!1,o=e.getId();if(this.queryToResult.has(o)){var s=this.queryToResult.get(o),a=this.queryResults.get(s);a.updated=!0,a.orderKey>=t?t=i[a.orderKey]=a.orderKey:(n=!0,i[a.orderKey]=t,a.orderKey=t)}else{var a={result:new InternalQueryResult(this.qcm),orderKey:t,updated:!0};a.result.setQuery(e),r.push(a),this.queryResults.set(a.result.getId(),a),this.queryToResult.set(o,a.result.getId())}return t++,{orderKey:t,changedOrderKey:n}}function partitionCompCalcRemoveQueryResult(e){var t=e.result;this.queryToResult.delete(t.query.getId()),this.funcResult.removeQueryResult(t);var i=t.getId();e.valueQueryCalc?e.valueQueryCalc.destroy():this.valueQueryCalc.removeResultId(i),this.queryResults.delete(i),t.destroy()}function partitionCompCalcUpdateValueQueryCalc(e){if(void 0===e)return void(this.valueQueryCalc=this.replaceValueQueryCalc(this.valueQueryCalc,void 0,this.indexer,this.compProjPathId,0==this.numPartitions()&&void 0!==this.valueAscending));var t=e.getId(),i=this.queryResults.get(t),r=e.getDominatedIndexer(),n=e.getDominatedProjPathId();r==this.indexer&&n==this.compProjPathId?(void 0!==i.valueQueryCalc&&(i.valueQueryCalc.destroy(),i.valueQueryCalc=void 0),this.valueQueryCalc=this.replaceValueQueryCalc(this.valueQueryCalc,t,this.indexer,this.compProjPathId,!1)):i.valueQueryCalc=this.replaceValueQueryCalc(i.valueQueryCalc,t,r,n,!1)}function partitionCompCalcReplaceValueQueryCalc(e,t,i,r,n){if(void 0===i||void 0===r)return void(void 0!==e&&e.destroy());var o=void 0!==this.valueAscending&&(void 0!==t||0==this.numPartitions()||void 0!==e&&e.getResultIds().length>0);if(void 0!==e&&e.indexer==i&&e.pathId==r&&e.prefixProjPathId==this.prefixProjPathId&&e.needMatchUpdates==n)return e.setNeedKeyUpdates(o),void 0!==t&&e.addResultId(t),e;var s=new CompValueQueryCalc(this,t,i,r,this.prefixProjPathId,o,n);return void 0!==e&&e.destroy(),s}function partitionCompCalcUpdateFirstKeyAfterPartitionUpdate(e,t){if(0==this.numPartitions())return void(void 0!==this.firstKey&&(this.firstKey=void 0,this.secondKey=void 0));if(void 0===this.firstKey)this.firstKey=new CompCalcKeys(!0,this.gapOrderKey);else if(e&&(this.firstKey.translateKeys(function(e){return t[e]}),this.secondKey)){this.secondKey.clearKeysByRefList(this.firstKey.keys);var i=function(e){if(!(e instanceof Array))return e;var i=t[e[1]];if(void 0!==i)return[e[0],i]},r=this.valueAscending?function(e,t){return e instanceof Array?e[1]<t[1]||e[1]==t[1]&&e[0]<t[0]:e<t}:function(e,t){return e instanceof Array?e[1]<t[1]||e[1]==t[1]&&e[0]>t[0]:e>t};this.secondKey.translateKeys(i,r)}}function partitionCompCalcSecondKeySeqAscending(e,t){var i=e[1],r=t[1];return i==r?(i=e[0],r=t[0],i<r?-1:i===r?0:1):i<r?-1:1}function partitionCompCalcSecondKeySeqDescending(e,t){var i=e[1],r=t[1];return i==r?(i=e[0],r=t[0],i>r?-1:i===r?0:1):i<r?-1:1}function partitionCompCalcUpdateSecondKeyAfterPartitionUpdate(){if(void 0===this.valueAscending)return void(this.secondKey=void 0);var e=this.valueAscending?this.secondKeySeqAscending:this.secondKeySeqDescending;if(void 0!==this.secondKey)return 0==this.numPartitions()?(this.valueQueryCalc&&this.valueQueryCalc.pathId!=this.compProjPathId&&this.secondKey.clear(),void this.secondKey.setUseMinKey(this.valueAscending,!1)):(this.secondKey.setUseMinKey(this.valueAscending,!0),void(this.numPartitions()>1&&(this.secondKey instanceof CompCalcSeqKeys||(this.secondKey=new CompCalcSeqKeys(void 0,void 0,e,this.secondKey)),this.secondKey.setSeqCompare(e))));this.numPartitions()<=1?this.secondKey=new CompCalcKeys(this.valueAscending,void 0):this.secondKey=new CompCalcSeqKeys(this.valueAscending,void 0,e);var t=this;this.queryResults.forEach(function(e,i){if(e.result.isActiveStar()){var r=e.result.getDominatedMatches();t.addSecondKeyOfMatches(r,e)}})}function partitionCompCalcRefreshProjectedKeyPath(e){this.updateValueQueryCalc(e)}function partitionCompCalcAddMatches(e,t){this.addMatchesByResultId(e,t.getId())}function partitionCompCalcRemoveMatches(e,t){this.queueRemovedElements(e,t.getId())}function partitionCompCalcRemoveAllMatches(e){var t=e.getDominatedMatches();this.queueRemovedElements(t,e.getId())}function partitionCompCalcAddProjMatches(e,t,i){this.addMatchesByResultId(e,t)}function partitionCompCalcRemoveProjMatches(e,t,i){this.queueRemovedElements(e,t)}function partitionCompCalcUpdateKeys(e,t,i,r,n,o){var s,a=e.needToRaiseMatches();a&&(s=this.indexer.getDataElements());var d=e.getResultIds();if(0==d.length)for(var u=0,h=t.length;u<h;++u)this.updatePartitionKey(t[u],r[u],o[u],void 0,s);else for(var u=0,h=d.length;u<h;++u)for(var l=this.queryResults.get(d[u]),c=l.orderKey,p=l.result.filterDominatedMatchPositions(t),f=0,v=p.length;f<v;++f){var g=p[f];this.updatePartitionKey(t[g],r[g],o[g],c,s)}}function partitionCompCalcAddProjPathMatches(e){e=this.removeAddedFromQueuedRemoved(e);var t,i=this.valueQueryCalc,r=i.needToRaiseMatches();r&&(t=this.indexer.getDataElements()),this.secondKey.expectAdditionalNum(e.length);for(var n=0,o=e.length;n<o;++n){var s=e[n];void 0!==t&&(s=t.raiseToPath(s,this.prefixProjPathId));var a=this.convertSecondKey(i.getProjKey(s));this.secondKey.addKey(s,a)}0!==e.length&&this.refreshOrdering()}function partitionCompCalcRemoveProjPathMatches(e){this.queueRemovedElements(e)}function partitionCompCalcRemoveQueuedProjPathMatches(){if(void 0!==this.removedElements&&0!==this.removedElements.size){var e,t=this.valueQueryCalc,i=t.needToRaiseMatches();i&&(e=this.indexer.getDataElements());var r=this;this.removedElements.forEach(function(t,i){void 0!==e&&(i=e.raiseToPath(i,r.prefixProjPathId)),r.secondKey.removeKey(i,t)}),this.removedElements.size>0&&this.refreshOrdering()}}function partitionCompCalcQueueRemovedElements(e,t){var i,r;if(void 0===t)i=void 0!==this.removedElements?this.removedElements:this.removedElements=new IntHashMap,r=this.valueQueryCalc;else if(void 0===this.partitionRemovedElements&&(this.partitionRemovedElements=new IntHashMap),this.partitionRemovedElements.has(t)?i=this.partitionRemovedElements.get(t):(i=new IntHashMap,this.partitionRemovedElements.set(t,i)),void 0!==this.secondKey){var n=this.queryResults.get(t);r=void 0!==n.valueQueryCalc?n.valueQueryCalc:this.valueQueryCalc}if(i.expectSize(i.size+e.length),void 0!==r)for(var o=0,s=e.length;o<s;++o){var a=e[o],d=this.convertSecondKey(r.getKnownKey(a));i.set(a,d)}else for(var o=0,s=e.length;o<s;++o)i.set(e[o],void 0);this.qcm.scheduleCompCalc(this)}function partitionCompCalcRemoveAddedFromQueuedRemoved(e,t){var i;if(void 0===t?i=this.removedElements:void 0!==this.partitionRemovedElements&&(i=this.partitionRemovedElements.get(t)),void 0===i||0===i.size)return e;for(var r,n=0,o=e.length;n<o;++n){var s=e[n];void 0!==i.delete(s)?void 0===r&&(r=e.slice(0,n)):void 0!==r&&r.push(s)}return void 0===r?e:r}function partitionCompCalcApplyQueuedRemovals(){if(void 0!==this.removedElements&&(this.removeQueuedProjPathMatches(),this.removedElements=void 0),this.partitionRemovedElements){var e=this,t=!1;this.partitionRemovedElements.forEach(function(i,r){i.size>0&&(t=!0),e.removeMatchesByResultId(i,r)}),this.partitionRemovedElements=void 0,t&&this.refreshOrdering()}}function partitionCompCalcAddMatchesByResultId(e,t){if(0!=e.length){e=this.removeAddedFromQueuedRemoved(e,t);var i,r=this.queryResults.get(t),n=void 0!==r.valueQueryCalc?r.valueQueryCalc:this.valueQueryCalc,o=r.orderKey,s=n.needToRaiseMatches();s&&(i=this.indexer.getDataElements()),this.firstKey.expectAdditionalNum(e.length);for(var a=0,d=e.length;a<d;++a){var u=e[a],h=void 0!==i?i.raiseToPath(u,this.prefixProjPathId):u,l=this.firstKey.addKey(h,o);void 0!==this.secondKey&&this.addSecondKey(h,u,n,o,l)}this.refreshOrdering()}}function partitionCompCalcAddSecondKeyOfMatches(e,t){var i,r=void 0!==t.valueQueryCalc?t.valueQueryCalc:this.valueQueryCalc,n=t.orderKey,o=r.needToRaiseMatches();o&&(i=this.indexer.getDataElements());for(var s=0,a=e.length;s<a;++s){var d=e[s],u=void 0!==i?i.raiseToPath(d,this.prefixProjPathId):d,h=this.firstKey.getKey(u);h===n&&(h=void 0),this.addSecondKey(u,d,r,n,h)}}function partitionCompCalcAddSecondKey(e,t,i,r,n){var o=this.convertSecondKey(i.getProjKey(t)),s=this.secondKey.getKey(e);s instanceof Array?this.secondKey.addSeqKey(e,[o,r]):void 0!==n?(void 0!==s&&this.secondKey.convertToSeqKeys(e,function(e){return[e,n]}),this.secondKey.addSeqKey(e,[o,r])):this.secondKey.addKey(e,o)}function partitionCompCalcConvertSecondKey(e){return"object"==typeof e&&(e=this.valueAscending?e.getMinKey():e.getMaxKey()),"string"==typeof e&&(e=e.toLocaleLowerCase()),e}function partitionCompCalcRemoveMatchesByResultId(e,t){if(0!=e.length){var i,r=this.queryResults.get(t),n=void 0!==r.valueQueryCalc?r.valueQueryCalc:this.valueQueryCalc,o=r.orderKey,s=n.needToRaiseMatches();s&&(i=this.indexer.getDataElements());var a=this;e.forEach(function(e,t){var r=void 0!==i?i.raiseToPath(t,a.prefixProjPathId):t;a.firstKey.removeKey(r,o),void 0!==a.secondKey&&a.removeSecondKey(r,t,o,e)})}}function partitionCompCalcRemoveSecondKey(e,t,i,r){var n=this.secondKey.getKey(e);n instanceof Array?this.secondKey.removeSeqKey(e,[r,i]):this.secondKey.removeKey(e,r)}function partitionCompCalcUpdatePartitionKey(e,t,i,r,n){void 0!==n&&(e=n.raiseToPath(e,this.prefixProjPathId)),i=this.convertSecondKey(i),t=this.convertSecondKey(t),void 0!==r&&this.secondKey.getKey(e)instanceof Array?(this.secondKey.addSeqKey(e,[t,r]),this.secondKey.removeSeqKey(e,[i,r])):(this.secondKey.addKey(e,t),this.secondKey.removeKey(e,i))}function partitionCompCalcGetCompareFunc(){var e=this.valueAscending?function(e,t){return typeof e!=typeof t?typeof e<typeof t?-1:1:e<t?-1:e>t?1:0}:function(e,t){return typeof e!=typeof t?typeof e<typeof t?1:-1:e<t?1:e>t?-1:0};if(this.firstKey&&!this.secondKey){var t=this.firstKey;return function(e,i){return t.getCompKey(e)-t.getCompKey(i)}}if(!this.firstKey&&this.secondKey){var i=this.secondKey;return function(t,r){var n=i.getCompKey(t),o=i.getCompKey(r);return e(n,o)}}if(this.firstKey&&this.secondKey){var t=this.firstKey,i=this.secondKey;return function(r,n){var o=t.getCompKey(r)-t.getCompKey(n);if(0!==o)return o;var s=i.getCompKey(r),a=i.getCompKey(n);return e(s,a)}}return function(e,t){return 0}}function partitionCompCalcGetRaisingFunc(){return dataElements=this.indexer.getDataElements(),function(e){return dataElements.raiseToPath(e,this.prefixProjPathId)}}function Comparison(e){this.qcm=e,this.id=InternalQCM.newId(),this.compResultNum=0,this.compCalcs=new Map,this.pendingDestroy=void 0}function comparisonDestroy(){return!(this.compCalcs.size>0||this.compResultNum>0)||(this.pendingDestroy=!0,!1)}function comparisonGetId(){return this.id}function comparisonAllocate(){this.compResultNum++}function comparisonRelease(){this.compResultNum--,this.pendingDestroy&&0==this.compResultNum&&0==this.compCalcs.size&&this.destroy()}function comparisonNewCompCalc(e,t,i){assert(!1,"need to define function in derived class")}function comparisonAddCompCalc(e){this.compCalcs.set(e.getId(),e)}function comparisonRemoveCompCalc(e){this.compCalcs.has(e)&&(this.compCalcs.delete(e),this.pendingDestroy&&0==this.compCalcs.size&&0==this.compResultNum&&this.destroy())}function PartitionComparison(e){this.Comparison(e),this.projPathId=void 0,this.queries=void 0,this.gapPos=void 0,this.partitionAscending=void 0,this.valueAscending=void 0}function partitionComparisonDestroy(){!this.Comparison_destroy()}function partitionComparisonSetPartition(e,t,i,r,n){if(this.projPathId=e,this.queries=t?t:[],this.gapPos=i,this.partitionAscending=!!r,this.valueAscending=n,this.compCalcs.size>0){var t=this.getQueries(),i=this.getGapPos();this.compCalcs.forEach(function(e,r){e.updatePartition(t,i,n)})}}function partitionComparisonNewCompCalc(e,t,i){return new PartitionCompCalc(this.qcm,this,e,t,i)}function partitionComparisonAddCompCalc(e){this.Comparison_addCompCalc(e),void 0!==this.queries&&e.updatePartition(this.getQueries(),this.getGapPos(),this.valueAscending)}function partitionComparisonRemoveCompCalc(e){this.Comparison_removeCompCalc(e)}function partitionComparisonGetGapPos(){var e=this.queries.length;if(void 0===this.gapPos)return e;var t=this.gapPos>e?e:this.gapPos;return this.partitionAscending?t:e-t}function partitionComparisonGetQueries(){return this.partitionAscending?this.queries:this.queries.concat().reverse()}function CompResult(e){this.FuncResult(e),void 0!==debugAllCompResults&&(debugAllCompResults[this.id]=this),this.comparison=void 0,this.compCalc=void 0}function compResultDestroy(){this.FuncResult_destroy(),this.comparison&&this.comparison.release(),this.compCalc&&this.qcm.releaseCompCalc(this,this.compCalc),void 0!==debugAllCompResults&&delete debugAllCompResults[this.id]}function compResultIsMatchTransparent(){
return!0}function compResultSetComparison(e){this.comparison!=e&&(void 0!==this.comparison&&this.comparison.release(),void 0!==e&&e.allocate(),this.comparison=e,this.resetCompCalc()&&this.refreshOrdering())}function compResultResetCompCalc(){var e,t=this.dataObj,i=t?t.getDominatedIndexer():void 0;return e=void 0!==i&&void 0!==this.comparison&&this.isActiveStar()&&this.isOrderStar()?this.qcm.getCompCalc(this,this.comparison,i,t.getDominatedProjPathId()):void 0,this.compCalc!==e&&(void 0!==this.compCalc&&this.qcm.releaseCompCalc(this,this.compCalc),this.compCalc=e,!0)}function compResultCompCalcRefreshed(){this.refreshOrdering()}function compResultComparisonActivated(){this.resetCompCalc(),this.compCalc&&this.compCalc.resultActivated(this)}function compResultComparisonDeactivated(){this.compCalc&&this.compCalc.resultDeactivated(this),this.resetCompCalc()}function compResultIsActive(){return this.isOrderStar()}function compResultRefreshIndexerAndPaths(e){var t=this.resetCompCalc();if(this.composedActiveNum>0)for(var i in this.composedActive)this.composedActive[i].refreshIndexerAndPaths(this);t&&this.refreshOrdering()}function compResultReplaceIndexerAndPaths(e,t,i,r){this.resetCompCalc();if(this.composedActiveNum>0)for(var n in this.composedActive)this.composedActive[n].replaceIndexerAndPaths(e,t,i,this)}function compResultIncreaseMatchCount(e,t,i){if(!(0===e||this.dataObj.getDomMatchCount()-e>0))for(var r in this.composedActive){var n=this.composedActive[r];n.increaseMatchCount(1,t,this)}}function compResultDecreaseMatchCount(e,t,i){if(!(0===e||this.dataObj.getDomMatchCount()>0))for(var r in this.composedActive){var n=this.composedActive[r];n.decreaseMatchCount(1,t,this)}}function compResultAddDataObjMatches(e,t){void 0!==this.dataObj&&(0!=this.dataObj.getDomMatchCount()||this.hasNonQueryActiveComposed())&&this.FuncResult_addDataObjMatches(e,t)}function compResultRemoveDataObjMatches(e,t){void 0!==this.dataObj&&(0!=this.dataObj.getDomMatchCount()||this.hasNonQueryActiveComposed())&&this.FuncResult_removeDataObjMatches(e,t)}function compResultAddMatches(e,t){void 0!==this.compCalc&&this.compCalc.needToSuspendOrderingUponAddition()&&this.refreshOrdering();var i=0==this.getDomMatchCount();if(!i||this.hasNonQueryActiveComposed())for(var r in this.composedActive){var n=this.composedActive[r];i&&n instanceof InternalQueryResult||n.addMatches(e,this)}}function compResultRemoveMatches(e,t){var i=0==this.getDomMatchCount();if(!i||this.hasNonQueryActiveComposed())for(var r in this.composedActive){var n=this.composedActive[r];i&&n instanceof InternalQueryResult||n.removeMatches(e,this)}}function compResultRemoveAllMatches(e){if(0!=this.composedActiveNum)for(var t in this.composedActive)this.composedActive[t].removeAllMatches(this)}function compResultAddProjMatches(e,t,i){this.addMatches(matches,this.dataObj)}function compResultRemoveProjMatches(e,t,i){this.removeMatches(matches,this.dataObj)}function compResultGetDominatedIndexer(){return void 0===this.dataObj?void 0:this.dataObj.getDominatedIndexer()}function compResultGetDominatedProjPathId(){return void 0===this.dataObj?void 0:this.dataObj.getDominatedProjPathId()}function compResultGetDominatedProjPathNum(){return void 0===this.dataObj?void 0:this.dataObj.getDominatedProjPathNum()}function compResultGetDominatedProjMappings(){return void 0===this.dataObj?void 0:this.dataObj.getDominatedProjMappings()}function compResultGetTerminalProjMatches(e){return void 0===this.dataObj?[]:this.dataObj.getDominatedMatches()}function compResultFilterTerminalProjMatches(e,t){return void 0===this.dataObj?[]:this.dataObj.filterDominatedMatches(t)}function compResultGetDomMatchCount(){return void 0===this.dataObj?0:0==this.dataObj.getDomMatchCount()?0:1}function compResultGetDominatedMatches(){return void 0===this.dataObj?[]:this.dataObj.getDominatedMatches()}function compResultGetDominatedMatchesAsObj(){return void 0===this.dataObj?new Map:this.dataObj.getDominatedMatchesAsObj()}function compResultFilterDominatedMatches(e){return void 0===this.dataObj?[]:this.dataObj.filterDominatedMatches(e)}function compResultFilterDominatedMatchPositions(e){return void 0===this.dataObj?[]:this.dataObj.filterDominatedMatchPositions(e)}function compResultGetDominatedIdentification(){if(void 0!==this.dataObj)return this.dataObj.getDominatedIdentification()}function compResultGetDominatedComparison(){return new CompInfo(this)}function CompInfo(e){this.compResult=e,this.domCompInfo=this.compResult.dataObj?this.compResult.dataObj.getDominatedComparison():void 0,this.needToRaise=!1,this.translations=void 0}function compInfoSetNeedToRaise(){this.needToRaise=!0}function compInfoUnshiftTranslation(e){void 0===this.translations?this.translations=[e]:this.translations.unshift(e)}function compInfoGetCompareFunc(){var e;if(void 0!==this.domCompInfo&&(e=this.domCompInfo.getCompareFunc()),void 0===this.compResult.compCalc)return void 0!==e?e:function(e,t){return e-t};var t,i=this.compResult.compCalc.getCompareFunc();t=void 0===this.domCompInfo?function(e,t){var r=i(e,t);return 0===r?e-t:r}:function(t,r){var n=i(t,r);return 0===n?e(t,r):n};var r;if(this.needToRaise){var n=this.compResult.compCalc.getRaisingFunc();r=function(e,i){var e=n(e),i=n(i);return t(e,i)}}else r=t;if(void 0===this.translations)return r;if(1==this.translations.length){var o=this.translations[0];return function(e,t){return e=o.get(e),t=o.get(t),r(e,t)}}var s=this.translations.length,a=this.translations;return function(e,t){for(var i=0;i<s;++i){var n=a[i];e=n.get(e),t=n.get(t)}return r(e,t)}}function MergeGroup(e,t,i,r,n,o,s,a,d,u,h){this.targetIndexer=e,this.qcm=this.targetIndexer.qcm,this.groupId=MergeGroup.nextGroupId++,this.description=t,this.priority=d,this.prefixGroup=r,this.isMaxGroup=n,this.isIdentityGroup=o,this.nextGroups=n?void 0:[],this.groupSequence=void 0,this.sourceIdentificationId=u,this.targetIdentificationId=h,this.mappings=new Map,this.projNum=0,this.sourceIndexer=i,this.sourcePathId=s,this.sourceNodes=void 0,this.targetPathNode=e.addPath(a),this.obligatoryDataElements=!1,this.initGroup()}function mergeGroupMakeGroupDesc(e,t,i,r,n,o,s,a,d){var u=n+(r?"id":"")+":"+o+":"+(i?"t":"f");return u+=t?":"+t.groupId:":"+e.id+":"+s+":"+(void 0===a?"":a)+":"+(void 0===d?"":d)}function mergeGroupInitGroup(){if(void 0!==this.sourceIdentificationId&&this.sourceIndexer.requestIdentification(this.sourceIdentificationId),void 0!==this.targetIdentificationId&&this.targetIndexer.requestIdentification(this.targetIdentificationId),this.isMaxGroup){var e=this;for(this.groupSequence=[e];void 0!==e.prefixGroup;)e=e.prefixGroup,this.groupSequence.push(e)}if(this.isIdentityGroup?this.isDominated()?this.sourceNodes=new DominatedIdentitySourceNodes(this.sourceIndexer,this.sourceIdentificationId,this.sourcePathId):this.sourceNodes=new IdentitySourceNodes(this.sourceIndexer,this.sourceIdentificationId):this.sourceNodes=new SourceNodes,void 0!==this.prefixGroup&&this.prefixGroup.nextGroups.push(this),this.addMappingGroupToPath(this.targetPathNode,!0),!this.isIdentityGroup&&this.targetPathNode.mappingGroups){var t=this;this.targetPathNode.mappingGroups.forEach(function(e,i){if(i!=t.groupId){var r=t.targetIndexer.groupById[i];r.isIdentityGroup||r.prefixGroup==t.prefixGroup&&r.priority==t.priority&&(r.obligatoryDataElements=!0,t.obligatoryDataElements=!0)}})}this.isMaxGroup&&!this.isIdentityGroup&&this.addGroupToTracingExtensionChildPaths(this.targetPathNode),this.isIdentityGroup?this.targetIndexer.addIdentityGroupByIdentification(this):this.targetIndexer.addGroupToGroupBySourceIdentification(this)}function mergeGroupDestroy(){if(this.isMaxGroup&&!this.isIdentityGroup&&this.removeGroupFromExtensionChildPaths(this.targetPathNode),this.removeMappingGroupFromPath(this.targetPathNode),this.obligatoryDataElements){var e,t=this;this.targetPathNode.mappingGroups.forEach(function(i,r){var n=t.targetIndexer.groupById[r];n.isIdentityGroup||n.prefixGroup==t.prefixGroup&&n.priority==t.priority&&(e=void 0===e&&n)}),e&&(e.obligatoryDataElements=!1)}if(this.prefixGroup)for(var i=0,r=this.prefixGroup.nextGroups.length;i<r;++i)if(this.prefixGroup.nextGroups[i]==this){this.prefixGroup.nextGroups.splice(i,1);break}this.isIdentityGroup?this.targetIndexer.removeIdentityGroupByIdentification(this):this.targetIndexer.removeGroupFromGroupBySourceIdentification(this),void 0!==this.sourceIdentificationId&&this.sourceIndexer.releaseIdentification(this.sourceIdentificationId),void 0!==this.targetIdentificationId&&this.targetIndexer.releaseIdentification(this.targetIdentificationId)}function mergeGroupChangeGroupSource(e,t,i){this.description=MergeGroup.makeGroupDesc(t,this.prefixGroup,this.isMaxGroup,this.isIdentityGroup,e,this.targetPathNode.pathId,this.priority,i,this.targetIdentificationId);var r=this.sourceIndexer!=t||this.sourceIdentificationId!=i;r&&(this.isIdentityGroup?this.targetIndexer.removeIdentityGroupByIdentification(this):this.targetIndexer.removeGroupFromGroupBySourceIdentification(this),this.targetIndexer.changeUnmappedByIdentification(this,this.sourceIdentificationId,i),void 0!==this.sourceIdentificationId&&this.sourceIndexer.releaseIdentification(this.sourceIdentificationId),this.sourceIdentificationId=i,void 0!==i&&t.requestIdentification(i),void 0!==this.sourceNodes.replaceSourceIdentification&&this.sourceNodes.replaceSourceIdentification(t,i)),this.sourceIndexer=t,this.sourcePathId=e,r&&(this.isIdentityGroup?this.targetIndexer.addIdentityGroupByIdentification(this):this.targetIndexer.addGroupToGroupBySourceIdentification(this)),this.isMaxGroup&&this.replaceMappingQueryCalcSource(this.targetPathNode,e,!0)}function mergeGroupGetMaxGroups(){if(this.isMaxGroup)return[this];for(var e=[],t=0,i=this.nextGroups.length;t<i;++t){var r=this.nextGroups[t];r.isMaxGroup?e.push(r):e=0==e.length?r.getMaxGroups():cconcat(e,r.getMaxGroups())}return e}function mergeGroupGetSingleProj(){if(!(this.projNum>1)){var e={};return this.mappings.forEach(function(t,i){e.resultId=i,e.funcResult=t.funcResult,t.projections.forEach(function(t,i){e.projId=i})}),e}}function mergeGroupIsDominated(){var e=this.qcm.getRootPathId();return this.sourcePathId!=e&&this.targetPathNode.pathId!=e}function mergeGroupHasIdentityPrefixGroup(){for(var e=this.prefixGroup;e;e=e.prefixGroup)if(e.isIdentityGroup)return!0;return!1}function mergeGroupAddMapping(e,t){var i,r=e.getId();if(this.isIdentityGroup||1!=this.projNum||this.refCountExistingProjMatches(),this.mappings.has(r)){if(i=this.mappings.get(r),i.projections.has(t))return}else i={funcResult:e,projections:new Map},this.mappings.set(r,i),void 0!==this.targetPathNode&&void 0!==this.targetPathNode.composedOrderStar&&this.targetPathNode.composedOrderStar.forEach(function(t,i){e.addOrderStarFunc(t)});i.projections.set(t,!0),this.projNum++}function mergeGroupRemoveMapping(e,t){var i=this.mappings.get(e);if(void 0!==i&&i.projections.has(t))return this.projNum--,1==i.projections.size?(this.mappings.delete(e),void 0!==this.targetPathNode&&void 0!==this.targetPathNode.composedOrderStar&&this.targetPathNode.composedOrderStar.forEach(function(e,t){i.funcResult.removeOrderStarFunc(t)})):i.projections.delete(t),this.isIdentityGroup||1!=this.projNum||this.clearRefCountOfRemainingProjMatches(),0===this.mappings.size}function mergeGroupAddMappingGroupToPath(e,t){var i;if(e.mappingGroups?i=e.mappingGroups.get(this.groupId):e.mappingGroups=new Map,!i){var r=this.targetIdentificationId;!this.prefixGroup&&e.parent&&e==this.targetPathNode&&(e.parent.dominatedMinGroups++,void 0===e.parent.nonTerminals&&this.targetIndexer.initNonTerminals(e),void 0!==r&&e.parent.nonTerminals.addAdditionalIdentification(r)),this.priority>e.maxGroupPriority&&(e.maxGroupPriority=this.priority),this.priority<e.minGroupPriority&&(e.minGroupPriority=this.priority,e.minGroupPriority<e.maxGroupPriority&&void 0===e.nonTerminals&&this.targetIndexer.initNonTerminals(e)),void 0!==r&&(void 0!==e.nonTerminals&&e.nonTerminals.addAdditionalIdentification(r),e.dataElementOperators&&e.dataElementOperators.addAdditionalIdentification(r)),void 0!==e.unmappedNodes&&e.unmappedNodes.getNum()>0&&this.addToUnmappedByIdentification(e,this),this.addAllOrderStarFuncsFromPath(e)}if(!this.isMaxGroup)return e.mappingGroups.set(this.groupId,!0),!0;var n;if(i){if(e.trace==i instanceof MappingQueryCalc)return i;if(!e.trace){var n=i.sourcePathId;return i.destroy(),i={sourcePathId:n,isExtension:!t},e.mappingGroups.set(this.groupId,i),i}n=i.sourcePathId}var o;return n||(t?n=this.sourcePathId:(o=this.targetPathNode.pathId,n=this.qcm.allocateConcatPathId(this.sourcePathId,this.qcm.diffPathId(e.pathId,o)))),e.trace?(i=new MappingQueryCalc(this.targetIndexer,this.sourceIndexer,e,n,this.groupId,this.sourceIdentificationId,!t,!this.isIdentityGroup),e.mappingGroups.set(this.groupId,i),o&&this.qcm.releasePathId(n),i):(i={sourcePathId:n,isExtension:!t},e.mappingGroups.set(this.groupId,i),i)}function mergeGroupAddGroupToTracingExtensionChildPaths(e){if(e.numTracingChildren)for(var t in e.tracingChildren){var i=e.tracingChildren[t];i.nonExtensionPath||(this.addMappingGroupToPath(i,!1),this.addGroupToTracingExtensionChildPaths(i))}}function mergeGroupReplaceMappingQueryCalcSource(e,t,i){if(this.isMaxGroup){var r=e.mappingGroups.get(this.groupId);if(void 0!==r&&r instanceof MappingQueryCalc&&(r.destroy(),e.mappingGroups.set(this.groupId,new MappingQueryCalc(this.targetIndexer,this.sourceIndexer,e,t,this.groupId,this.sourceIdentificationId,!i,!this.isIdentityGroup)),e.numTracingChildren))for(var n in e.tracingChildren){var o=e.tracingChildren[n];if(!o.nonExtensionPath){var s=this.qcm.allocatePathId(t,n);this.replaceMappingQueryCalcSource(o,s,!1),this.qcm.releasePathId(s)}}}}function mergeGroupRemoveMappingGroupFromPath(e){if(e.mappingGroups){var t=e.mappingGroups.get(this.groupId);if(t){var i=this.targetIdentificationId;if(void 0===this.prefixGroup&&e.parent&&e==this.targetPathNode&&(0==--e.parent.dominatedMinGroups?this.targetIndexer.destroyNonTerminals(e):void 0!==i&&e.parent.nonTerminals.removeAdditionalIdentification(i)),this.priority==e.minGroupPriority||this.priority==e.maxGroupPriority){e.minGroupPriority=1/0,e.maxGroupPriority=1/0;var r=this;e.mappingGroups.forEach(function(t,i){if(i!==r.groupId){var n=r.targetIndexer.groupById[i];n.priority<e.minGroupPriority&&(e.minGroupPriority=n.priority),n.priority>e.maxGroupPriority&&(e.maxGroupPriority=n.priority)}}),this.targetIndexer.destroyNonTerminals(e)}void 0!==i&&(void 0!==e.nonTerminals&&e.nonTerminals.removeAdditionalIdentification(i),void 0!==e.dataElementOperators&&e.dataElementOperators.removeAdditionalIdentification(i)),void 0!==e.unmappedNodes&&e.unmappedNodes.getNum()>0&&this.removeFromUnmappedByIdentification(e,this),this.removeAllOrderStarFuncsFromPath(e),e.mappingGroups.delete(this.groupId),t!==!0&&t instanceof MappingQueryCalc&&t.destroy()}}}function mergeGroupRemoveGroupFromExtensionChildPaths(e){for(var t in e.children){var i=e.children[t];0!==i.mappingGroups.size&&i.mappingGroups.has(this.groupId)&&(this.removeGroupFromExtensionChildPaths(i),this.removeMappingGroupFromPath(i))}}function mergeGroupGetSourceIdentity(e){return this.isIdentityGroup?this.sourceNodes.getIdNodeIdentity(e):this.sourceIndexer.getIdentity(this.sourceIdentificationId,e)}function mergeGroupGetSourceIdentities(e){return this.isIdentityGroup?this.sourceNodes.getIdNodeIdentities(e):this.sourceIndexer.getIdentities(this.sourceIdentificationId,e)}function mergeGroupGetIdentitiesOfSourceDataElements(e,t){if(this.hasSourceDataElements(e)){var i,r=this.getSourcePathId(e);if(i=r===this.sourcePathId&&void 0!==this.prefixGroup?this.prefixGroup.sourcePathId:this.qcm.getPrefix(r),void 0===i)return this.getSourceIdentities(t);var n=this.sourceIndexer.filterDataElementsUnderPathId(t,i),o=n.length;if(0!==o){var s=this.getSourceIdentities(n);return alignArrays(t,n,s)}}}function mergeGroupGetSourceKeysByIdentity(e){for(var t=[],i=[],r=0,n=e.length;r<n;++r){var o=e[r];if("number"!=typeof o||o>0)t.push("attributeValue");else{var s=this.qcm.compression.getSimpleValue(-o);void 0===s?t.push("attributeValue"):(t.push(s.type),i[r]=s.roundedValue)}}return{types:t,keys:i}}function mergeGroupGetSourceValues(e,t){var i=this.getSourcePathId(e);return this.sourceIndexer.getNodeValues(i,t)}function mergeGroupGetSourceNonAttrs(e,t){var i=this.getSourcePathId(e);return this.sourceIndexer.getNodeNonAttrs(i,t)}function mergeGroupHasSourceDataElements(e){var t,i=this.getSourcePathId(e);return t=i===this.sourcePathId&&void 0!==this.prefixGroup?this.prefixGroup.sourcePathId:this.qcm.getPrefix(i),this.sourceIndexer.hasLowerDataElements(i,t)}function mergeGroupHasSourceOperands(e){var t=this.getSourcePathId(e);return this.sourceIndexer.pathHasOperands(t)}function mergeGroupGetSourcePathId(e){return this.isMaxGroup?e.mappingGroups.get(this.groupId).sourcePathId:this.sourcePathId}function mergeGroupGetSourceChildPaths(e,t){var i=this.getSourcePathId(e),r=[];if(t)for(var n=this.sourceIndexer.getChildPaths(i),o=0,s=n.length;o<s;++o){var a=n[o],d=this.qcm.getPathId(e.pathId,a.attr);r.push({sourcePathId:a.childPathId,targetPathId:d,attr:a.attr})}else{var u=e.tracingChildren;for(var h in u)r.push({sourcePathId:this.qcm.getPathId(i,h),targetPathId:e.tracingChildren[h].pathId,attr:h})}return r}function mergeGroupGetSourceChildren(e,t,i){var r=this.getSourcePathId(t),n=this.getSourceChildPaths(t,i),o=[],s=this.sourceIndexer.getAllDirectOperands(e,r);void 0!==s&&o.push({sourcePathId:r,targetPathId:t.pathId,attr:void 0,hasDataElements:!0,sourceChildIds:s});for(var a=0,d=n.length;a<d;++a){var u=n[a],h=this.sourceIndexer.getAllDirectChildren(e,u.sourcePathId);void 0!==h&&(u.hasDataElements=h.hasDataElements,u.sourceChildIds=h.childIds,o.push(u))}return o}function mergeGroupGetAllSourceNodes(){if(this.isIdentityGroup)return this.sourceNodes.getAllSourceNodes();if(this.projNum>1)return this.sourceNodes.getAllSourceNodes();var e=this.getSingleProj();if(!this.targetIndexer.projAlreadyAddedMatches(e.resultId,e.projId))return[];var t=e.funcResult.getTerminalProjMatches(e.projId);if(this.isMaxGroup)return t;var i=this.targetIndexer.getProjMaxGroup(e.resultId,e.projId),r=i.sourcePathId,n=this.sourceIndexer.hasLowerDataElements(r,this.sourcePathId);if(!n)return t;for(var o=[],s=new Map,a=0,d=t.length;a<d;++a){var u=t[a],h=this.raiseToGroup(u);if(h==u)o.push();else{if(s.size>0&&s.has(h))continue;s.set(h,!0),o.push(h)}}return o}function mergeGroupGetSourceNodesDominatedBy(e,t){this.sourceIndexer.hasLowerDataElements(t,this.sourcePathId)&&(e=this.sourceIndexer.getChildDataElements(this.sourcePathId,e,t),e=this.sourceIndexer.raiseElementsToOperators(e));var i;if(this.projNum>1){i=[];for(var r=0,n=e.length;r<n;++r){var o=e[r];this.sourceNodes.hasNode(o)&&i.push(o)}return i}var s=this.getSingleProj();if(i=s.funcResult.filterTerminalProjMatches(s.projId,e),0===i.length)return i;if(this.isMaxGroup)return i;var a=this.targetIndexer.getProjMaxGroup(s.resultId,s.projId);if(!this.sourceIndexer.hasLowerDataElements(a.sourcePathId,this.sourcePathId))return i;for(var d=a.prefixGroup;void 0!==d;){for(var r=0,n=e.length;r<n;++r){var o=e[r];d.sourceNodes.hasNode(o)&&i.push(o)}if(d==this)break;d=d.prefixGroup}return i}function mergeGroupGetMaxSourceNodes(e){this.isIdentityGroup&&(e=this.getSourceNodesOfIdentities(e));for(var t=this.getMaxGroups(),i=[],r=0,n=t.length;r<n;++r){var o=t[r],s=o.getSourceNodesDominatedBy(e);i.push({group:o,maxSourceIds:s})}return i}function mergeGroupFilterOutOperators(e){if(!this.sourceIndexer.pathHasOperands(this.sourcePathId))return e;for(var t=[],i=0,r=e.length;i<r;++i){var n=e[i];this.sourceIndexer.getOperandDataElements(n,this.sourcePathId)||t.push(n)}return t}function mergeGroupFilterDominatedByProj(e,t){var i,r=this.sourceIndexer.hasLowerDataElements(t,this.sourcePathId);if(r){i=new Array(e.length);for(var n=0,o=e.length;n<o;++n)i[n]=this.raiseToGroup(e[n])}else i=e;if(this.sourceIndexer.pathHasOperands(this.sourcePathId)){for(var s=new Array(e[n]),n=0,o=i.length;n<o;++n)s[n]=this.sourceIndexer.raiseToOperator(i[n],this.sourcePathId);i=s}var a;if(this.projNum>1){a=[];for(var n=0,o=i.length;n<o;++n)this.sourceNodes.hasNode(i[n])&&a.push(e[n]);return a}var d=this.getSingleProj();if(!this.targetIndexer.projAlreadyAddedMatches(d.resultId,d.projId))return[];if(a=d.funcResult.filterTerminalProjMatches(d.projId,i),i==e)return a;for(var u=0,h=a.length,n=0,o=i.length;n<o&&!(i[n]==a[u]&&(a[u]=e[n],u++,u>=h));++n);return a}function mergeGroupSourcePathHasOperands(){return this.sourceIndexer.pathHasOperands(this.sourcePathId)}function mergeGroupGetAllDominatingOperators(e){return this.sourceIndexer.raiseToAllOperators(e)}function mergeGroupGetDirectDominatingOperators(e){return this.sourceIndexer.raiseElementsToDirectOperators(e,this.sourcePathId)}function mergeGroupGetDominatingSourceNodes(e,t){var i,r;if(e===this.targetPathNode){if(void 0===this.prefixGroup)return;i=this.sourcePathId,r=this.prefixGroup.sourcePathId}else i=this.getSourcePathId(e),r=this.qcm.getPrefix(i);return this.sourceIndexer.raiseAllToPath(t,r,i)}function mergeGroupGetRefCount(e,t){if(this.isIdentityGroup)return this.getIdGroupRefCount(e,t);var i;if(this.projNum>1){i=new Array(e.length);for(var r=0,n=e.length;r<n;++r)i[r]=this.sourceNodes.getCount(e[r]);return i}if(t){if(i=new Array(e.length),this.isMaxGroup||0==this.sourceNodes.numNodes()){for(var r=0,n=e.length;r<n;++r)i[r]=1;return i}for(var r=0,n=e.length;r<n;++r){var o=this.sourceNodes.getCount(e[r]);i[r]=void 0===o?1:o}return i}if(!this.isMaxGroup){i=this.nextGroups[0].getRefCount(e);for(var r=0,n=i.length;r<n;++r)i[r]>1&&(i[r]=1);if(0==this.this.sourceNodes.numNodes())return i;for(var r=0,n=e.length;r<n;++r)0==i[r]?i[r]=this.sourceNodes.getCount(e[r]):this.sourceIndexer.getDataElementPathId(e[r])>this.sourcePathId&&(i[r]=0);return i}var s=this.getSingleProj();if(i=new Array(e.length),!this.targetIndexer.projAlreadyAddedMatches(s.resultId,s.projId)){for(var r=0,n=e.length;r<n;++r)i[r]=0;return i}for(var a=s.funcResult.filterTerminalProjMatches(s.projId,e),d=0,u=a.length,r=0,n=e.length;r<n;++r)d>=u?i[r]=0:a[d]==e[r]?(i[r]=1,d++):i[r]=0;return i}function mergeGroupGetIdGroupRefCount(e,t){if(!this.isIdentityGroup)return this.getRefCount(e,t);if(!this.isMaxGroup){for(var i=this.nextGroups[0].getRefCount(e),r=0,n=i.length;r<n;++r)i[r]>1&&(i[r]=1);for(var r=1,n=this.nextGroups.length;r<n;++r)for(var o=this.nextGroups[1].getRefCount(e),s=0,a=o.length;s<a;++s)o[s]>0&&i[s]++;if(0==this.sourceNodes.numRaised())return i;for(var r=0,n=e.length;r<n;++r){var d=e[r];if(0==i[r]){var u=this.sourceNodes.getRaisedCount(e);u>0&&(i[r]=u)}else this.sourceIndexer.isOperand(d,this.sourcePathId)&&(i[r]=0)}return i}if(1===this.projNum&&t){for(var i=new Array(e.length),r=0,n=i.length;r<n;++r)i[r]=1;return i}for(var i=new Array(e.length),r=0,n=i.length;r<n;++r)i[r]=0;var h=this;return this.mappings.forEach(function(t,r){t.projections.forEach(function(n,o){if(h.targetIndexer.projAlreadyAddedMatches(r,o))for(var s=t.funcResult.filterTerminalProjMatches(o,e),a=0,d=s.length,u=0,l=e.length;u<l&&!(s[a]==e[u]&&(i[u]++,++a>=d));++u);})}),i}function mergeGroupRaiseToGroup(e){return this.sourceIndexer.raiseToPath(e,this.sourcePathId)}function mergeGroupAddSourceElements(e,t,i,r){if(this.isIdentityGroup)return this.addIdentityElements(e,r);if(this.isMaxGroup)return this.addSourceElementsToMax(e,t,i);if(!this.prefixGroup&&!this.targetPathNode.parent&&!this.sourceIndexer.pathHasOperands(this.sourcePathId))return this.addSourceElementsAtRootTarget(e,r);for(var n=this.sourceIndexer.hasLowerDataElements(r.sourcePathId,this.sourcePathId),o=[],s=[],a=0,d=e.length;a<d;++a){var u=e[a];if(void 0!==u){var h=o[a]=n?this.raiseToGroup(u):u;this.projNum>1||h!=u?this.sourceNodes.incNode(h)&&(s[a]=h):s[a]=h}}if(this.sourceIndexer.pathHasOperands(this.sourcePathId)&&(s=this.incOperatorRefCount(s)),void 0!==this.prefixGroup){var l=this.prefixGroup.addSourceElements(s,t,i,this);return l.unshift(o),l}var c=this.addSourceParents(s);return c?[o,c]:[o,s]}function mergeGroupAddIdentityElements(e,t){var i=!this.isMaxGroup&&this.sourceIndexer.pathHasOperands(this.sourcePathId),r=this.targetPathNode.parent;void 0===r||r.childrenByIdentity||(r.childrenByIdentity=new ChildrenByIdentity);for(var n=this.isDominated(),o=[],s=void 0===r&&this.isMaxGroup?void 0:[],a=0,d=e.length;a<d;++a){var u=e[a];if(void 0!==u){if(i){var h=this.sourceIndexer.raiseToOperator(u,this.sourcePathId);h!==u&&(this.sourceNodes.incRaised(h),u=h)}var l=this.sourceNodes.incNode(u),c=l.idNodeId;if(this.isMaxGroup?l.isNew&&o.push(c):o[a]=c,l.isNew)if(void 0!==r){var p=n?c:0;this.isMaxGroup?s.push(p):s[a]=p;var f=n?l.parentIdentity:this.sourceNodes.getSourceIdentity(0);r.childrenByIdentity.addChild(f,p,c,this.groupId)}else void 0!==s&&(s[a]=c)}}return s?[o,s]:[o]}function mergeGroupAddSourceElementsToMax(e,t,i){var r;if(1==this.projNum)r=e;else{r=[];for(var n=0,o=e.length;n<o;++n){var s=e[n];this.sourceNodes.incNode(s)&&r.push(s)}}if(this.prefixGroup){var a=this.prefixGroup.addSourceElements(r,t,i,this);return a.unshift(r),a}var d=this.addSourceParents(r);return void 0===d?[r]:[r,d]}function mergeGroupAddSourceElementsAtRootTarget(e,t){var i=this.sourceIndexer.hasLowerDataElements(t.sourcePathId,this.sourcePathId);if(!i){if(this.projNum>1){for(var r=[],n=0,o=e.length;n<o;++n){var s=e[n];void 0!==s&&this.sourceNodes.incNode(s)&&(r[n]=s)}return[e,r]}return[e]}for(var a=[],r=[],n=0,o=e.length;n<o;++n){var s=e[n];if(void 0!==s){var d=a[n]=this.raiseToGroup(s);this.projNum>1||d!=s?this.sourceNodes.incNode(d)&&(r[n]=d):r[n]=d}}return[a,r]}function mergeGroupAddSourceParents(e,t){var i=this.targetPathNode.parent;if(void 0!==i){var r=this.qcm.getPrefix(this.sourcePathId),n=new Array(e.length);if(void 0==r){if(this.isMaxGroup)for(var o=0,s=e.length;o<s;++o)n[o]=0;else for(var o=0,s=e.length;o<s;++o)void 0!==e[o]&&(n[o]=0);return n}for(var a=this.sourceIndexer.hasLowerDataElements(this.sourcePathId,r),o=0,s=e.length;o<s;++o){var d=e[o];if(void 0!==d){var u=n[o]=a?this.raiseToGroup(d):d,h=this.getSourceIdentity(u);t||this.addToIdentifiedChildren(d,u,h)}}return n}}function mergeGroupIncOperatorRefCount(e){if(!this.sourceIndexer.pathHasOperands(this.sourcePathId))return e;for(var t=[],i=0,r=e.length;i<r;++i){var n=e[i];if(void 0!==n){t[i]=n;var o=this.sourceIndexer.raiseToAllOperators(n);if(void 0!==o)for(var s,a=0,d=o.length;a<d&&(s=o[a],this.sourceNodes.incNode(s));++a)t[i]=s}}return t}function mergeGroupRefCountExistingProjMatches(){var e=this.getSingleProj();if(this.targetIndexer.projAlreadyAddedMatches(e.resultId,e.projId)){var t=e.funcResult.getTerminalProjMatches(e.projId),i=!1;if(!this.isMaxGroup){var r=this.targetIndexer.getProjMaxGroup(e.resultId,e.projId);i=this.sourceIndexer.hasLowerDataElements(r.sourcePathId,this.sourcePathId)}if(i)for(var n=0,o=t.length;n<o;++n){var s=t[n],a=this.raiseToGroup(s);s==a&&this.sourceNodes.incNode(s)}else for(var n=0,o=t.length;n<o;++n)this.sourceNodes.incNode(t[n])}}function mergeGroupClearRefCountOfRemainingProjMatches(){var e=this.getSingleProj();if(this.targetIndexer.projAlreadyAddedMatches(e.resultId,e.projId)){var t=e.funcResult.getTerminalProjMatches(e.projId),i=!1;if(!this.isMaxGroup){var r=this.targetIndexer.getProjMaxGroup(e.resultId,e.projId);i=this.sourceIndexer.hasLowerDataElements(r.sourcePathId,this.sourcePathId)}if(i)for(var n=0,o=t.length;n<o;++n){var s=t[n],a=this.raiseToGroup(s);s==a&&this.sourceNodes.decNode(s)}else this.sourceNodes.clear()}}function mergeGroupGetSourceElements(e,t,i,r){var n;if(this.isIdentityGroup){if(n=e,void 0===this.targetPathNode.parent||this.targetPathNode===t)return[n];if(this.isDominated())return[n,n];for(var o=new Array(n.length),s=0,a=o.length;s<a;++s)o[s]=0;return[n,o]}var d=void 0!==r&&this.sourceIndexer.hasLowerDataElements(r.sourcePathId,this.sourcePathId);if(d){n=new Array(e.length);for(var s=0,a=e.length;s<a;++s)n[s]=this.raiseToGroup(e[s])}else n=e;if(void 0===this.prefixGroup){if(this.targetPathNode==t)return[n];var u=this.addSourceParents(n,!0);return void 0===u?[n]:[n,u]}if(this.targetPathNode==t||i&&this.prefixGroup.targetPathNode==t)return[n];var h=this.prefixGroup.getSourceElements(n,t,i,this);return h.unshift(n),h}function mergeGroupRemoveSourceElements(e,t,i,r){if(this.isIdentityGroup)return this.removeIdentityElements(e,r);if(this.isMaxGroup)return this.removeSourceElementsFromMax(e,t,i);var n=this.sourceIndexer.hasLowerDataElements(r.sourcePathId,this.sourcePathId),o=[];if(1!=this.projNum||n)for(var s=0,a=e.length;s<a;++s){var d=e[s];if(void 0!==d){var u=n?this.raiseToGroup(d):d;this.projNum>1||u!=d?0==this.sourceNodes.decNode(u)&&(o[s]=u):o[s]=u}}else o=this.sourceIndexer.pathHasOperands(this.sourcePathId)?[].concat(e):e;var h;if(this.sourceIndexer.pathHasOperands(this.sourcePathId)?h=this.decOperatorRefCount(o):toProagate=o,void 0!==this.prefixGroup){var l=this.prefixGroup.removeSourceElements(h,t,i,this);return l.unshift(o),l}return this.removeSourceParents(h),[o]}function mergeGroupRemoveIdentityElements(e,t){for(var i=this.sourceIndexer.pathHasOperands(this.sourcePathId),r=this.targetPathNode.parent,n=this.isDominated(),o=[],s=0,a=e.length;s<a;++s){var d=e[s];if(void 0!==d){if(i){var u=this.sourceIndexer.raiseToOperator(sourceElementId,this.sourcePathId);u!==d&&(this.sourceNodes.decRaised(u),d=u)}var h=this.sourceNodes.decNode(d),l=h.idNodeId;if(0==h.count&&(this.isMaxGroup?o.push(l):o[s]=l),!(h.count>0||void 0===r)){var c=n?l:0;n?h.parentIdentity:this.sourceNodes.getSourceIdentity(0);r.childrenByIdentity.removeChild(c,l,this.groupId)}}}return[o]}function mergeGroupRemoveSourceElementsFromMax(e,t,i){var r;if(1==this.projNum)r=e;else{r=[];for(var n=0,o=e.length;n<o;++n){var s=e[n];0==this.sourceNodes.decNode(s)&&r.push(s)}}if(this.prefixGroup){var a=this.prefixGroup.removeSourceElements(r,t,i,this);return a.unshift(r),a}return this.removeSourceParents(r),[r]}function mergeGroupDecOperatorRefCount(e){if(!this.sourceIndexer.pathHasOperands(this.sourcePathId))return e;for(var t=[],i=0,r=e.length;i<r;++i){var n=e[i];if(void 0!==n){var o=this.sourceIndexer.raiseToAllOperators(n);if(void 0!==o){for(var s,a=0,d=o.length;a<d;++a){if(s=o[a],this.sourceNodes.decNode(s)>0){s=void 0;break}e[i]=s}void 0!==s&&(t[i]=s)}else t[i]=n}}return t}function mergeGroupRemoveSourceParents(e){var t=this.targetPathNode.parent;if(void 0!==t){var i=this.qcm.getPrefix(this.sourcePathId);if(void 0!=i){var r=this.sourceIndexer.hasLowerDataElements(this.sourcePathId,i);if(r)for(var n=0,o=e.length;n<o;++n){var s=e[n];if(void 0!==s){var a=this.raiseToGroup(s);this.removeFromIdentifiedChildren(s,a)}}else for(var n=0,o=e.length;n<o;++n){var s=e[n];void 0!==s&&this.removeFromIdentifiedChildren(s,s)}}}}function mergeGroupClearAllSourceElements(){if(void 0!==this.nextGroups)for(var e=0,t=this.nextGroups;e<t;++e)this.nextGroups[e].clearAllSourceElements();this.sourceNodes.clear();var i;void 0===this.prefixGroup&&void 0!==(i=this.targetPathNode.parent)&&i.childrenByIdentity&&i.childrenByIdentity.removeGroup(this.groupId)}function mergeGroupAddToIdentifiedChildren(e,t,i){var r=this.targetPathNode.parent;void 0===r.childrenByIdentity&&(r.childrenByIdentity=new ChildrenByIdentity),r.childrenByIdentity.addChild(i,t,e,this.groupId)}function mergeGroupRemoveFromIdentifiedChildren(e,t){var i=this.targetPathNode.parent;i.childrenByIdentity.removeChild(t,e,this.groupId)}function mergeGroupGetParentIdentity(e){return this.sourceNodes.getParentIdentity(e)}function mergeGroupUpdateIdentity(e,t){for(var i=this.getRefCount(e),r=[],n=[],o=0,s=e.length;o<s;++o){var a=i[o];if(0!=a){var d=this.sourceNodes.updateIdentity(e[o],a,t[o]);d.added.length>0&&(r=cconcat(r,d.added)),d.removed.length>0&&(n=cconcat(n,d.removed))}}if(!this.isDominated()||0==this.sourceNodes.numParents())return{added:r,removed:n};for(var o=0,s=e.length;o<s;++o)if(!(i[o]>0)){var u=e[o];if(0!=this.sourceNodes.getParentCount(u)){var h=this.sourceIndexer.getDirectChildDataElements(u,this.sourcePathId),l=this.getRefCount(h),d=this.sourceNodes.updateParentIdentity(h,l,u,t[o]);
d.added.length>0&&(r=cconcat(r,d.added)),d.removed.length>0&&(n=cconcat(n,d.removed))}}return{added:r,removed:n}}function mergeGroupGetSourceNodesOfIdentities(e){assert(!1,"still needs to be implemented")}function mergeGroupGetDominatedComparison(){var e,t=this.getSingleProj();return void 0!==t&&(e=t.funcResult.getDominatedComparison()),this.isIdentityGroup?new MergeGroupCompInfo(this,e):e}function mergeGroupAddOrderStarFunc(e){this.mappings.forEach(function(t,i){t.funcResult.addOrderStarFunc(e)})}function mergeGroupRemoveOrderStarFunc(e){this.mappings.forEach(function(t,i){t.funcResult.removeOrderStarFunc(e)})}function mergeGroupAddAllOrderStarFuncsFromPath(e){if(void 0!==this.mappings&&0!==this.mappings.size){var t=this.mappings;void 0!==e.composedOrderStar&&e.composedOrderStar.forEach(function(e,i){t.forEach(function(t,i){t.funcResult.addOrderStarFunc(e)})})}}function mergeGroupRemoveAllOrderStarFuncsFromPath(e){if(void 0!==this.mappings&&0!==this.mappings.size){var t=this.mappings;void 0!==e.composedOrderStar&&e.composedOrderStar.forEach(function(e,i){t.forEach(function(e,t){e.funcResult.removeOrderStarFunc(i)})})}}function mergeGroupHasSourceIdTranslation(){return void 0!==this.sourceDataElements&&!this.sourceDataElements.isEmpty()}function mergeGroupGetAllTargetIdsAtPath(e,t,i,r){if(void 0===this.sourceDataElements||this.sourceDataElements.isEmpty()){if(!i)return[];if(r)return e;for(var n=new Array(e.length),o=0,s=e.length;o<s;++o)n[o]=[e[o]];return n}return this.sourceDataElements.getAllTargetIdsAtPath(e,t,i,r)}function mergeGroupGetTargetId(e,t,i){if(void 0!==this.sourceDataElements&&!this.sourceDataElements.isEmpty())return this.sourceDataElements.getTargetId(e,t,i)}function mergeGroupTranslateSourceIds(e,t,i,r){void 0===this.sourceDataElements&&(this.sourceDataElements=new MappedDataElements(this.qcm.getRootPathId()));var n=this.sourceDataElements,o=[];if(void 0===i)for(var s=0,a=t.length;s<a;++s)o.push(n.addTargetId(t[s],e,void 0,!1));else for(var s=0,a=t.length;s<a;++s)o.push(n.addTargetId(t[s],e,i[s],r));return o}function MergeGroupCompInfo(e,t){this.CompInfo(e),this.domCompInfo=t}function mergeGroupCompInfoGetCompareFunc(){var e,t=this.compResult,i=t.targetIndexer.dataElements,r=t.qcm.compression;return void 0!==this.domCompInfo&&(e=this.domCompInfo.getCompareFunc()),function(t,n){var o=i.getBaseIdentity(t),s=i.getBaseIdentity(n);if(o==s)return t-n;if(void 0===o)return-1;if(void 0===s)return 1;if(o*s<=0)return o-s;if(o>0){var a=0;return void 0!==e&&(a=e(t,n)),0===a?t-n:a}if(o==s)return t-n;var d=r.getSimpleValue(-o),u=r.getSimpleValue(-s);return d===u?t-n:void 0===d?-1:void 0===u?1:d.type!=u.type?d.type<u.type?-1:1:"range"==d.type?0:d.roundedValue==u.roundedValue?0:d.roundedValue<u.roundedValue?-1:1}}function MappingQueryCalc(e,t,i,r,n,o,s,a){this.id=InternalQCM.newId(),this.doNotIndex=!0,this.sourceIndexer=t,this.targetIndexer=e,this.sourceIndexer.qcm.allocatePathIdByPathId(r),this.pathId=r,this.sourcePathId=r,this.groupId=n,this.sourceIdentificationId=o,this.targetPathNode=i,this.isExtension=s,this.sourceIndexer.addQueryCalcToPathNode(this),a&&this.sourceIndexer.needKeyUpdateForQuery(this),this.sourceIndexer.addTracingIdentification(this.pathId,this.targetIndexer,this.sourceIdentificationId,this.isExtension)}function mappingQueryCalcIsExplicitPath(){return this.isExtension}function mappingQueryCalcDestroy(){this.sourceIndexer.removeTracingIdentification(this.pathId,this.targetIndexer,this.sourceIdentificationId,this.isExtension),this.sourceIndexer.removeQueryCalcFromPathNode(this),this.targetIndexer.qcm.releasePathId(this.pathId)}function mappingQueryCalcGetId(){return this.id}function mappingQueryCalcGetSourcePathId(){return this.pathId}function mappingQueryCalcIsSelection(){return!this.isExtension}function mappingQueryCalcAddMatches(e){this.isExtension&&this.targetIndexer.addExtensionMatches(e,this)}function mappingQueryCalcRemoveMatches(e){this.isExtension&&this.targetIndexer.removeExtensionMatches(e,this)}function mappingQueryCalcRemoveAllIndexerMatches(){this.isExtension&&this.removeMatches(this.sourceIndexer.getAllMatches(this.pathId))}function mappingQueryCalcUpdateKeys(e,t,i,r,n){this.targetIndexer.updateKeys(this,e,t,i,r,n)}function mappingQueryCalcSetMatchPoints(e){this.matchPoints=new Map;for(var t=0,i=e.length;t<i;++t)this.matchPoints.set(e[t],!0);this.lowestMatchPoint=e[0]}function mappingQueryCalcAddToMatchPoints(e){this.matchPoints.set(e,!0),e>this.lowestMatchPoint&&(this.lowestMatchPoint=e)}function mappingQueryCalcRemoveFromMatchPoints(e){if(this.matchPoints.delete(e),this.lowestMatchPoint==e){this.lowestMatchPoint=0;var t=this;this.matchPoints.forEach(function(e,i){i>t.lowestMatchPoint&&(t.lowestMatchPoint=i)})}}function mappingQueryCalcAddPathNodeDependencies(e){this.targetPathNode.cm.register(["mappingQueryCalc",this.id],e,"synthetic")}function mappingQueryCalcQueueRemovalOfPathNodeDependency(){this.targetPathNode.cm.unregister(["mappingQueryCalc",this.id])}function MappingMonitor(e,t,i){this.sourceIndexer=t.sourceIndexer,this.targetIndexer=e,this.groupId=t.groupId,this.sourceIdentificationId=t.sourceIdenitifcationId,this.sourcePathId=i,this.monitored={},this.numMonitored=0,this.updates=[],this.registrationInProgress=!1,this.monitorId=this.sourceIndexer.addSubTreeMonitor(i,this),this.sourceIndexer.addMonitoringIdentification(this.sourcePathId,this.targetIndexer,this.sourceIdentificationId)}function mappingMonitorDestroy(){this.sourceIndexer.removeMonitoringIdentification(this.sourcePathId,this.targetIndexer,this.sourceIdentificationId),this.sourceIndexer.removeSubTreeMonitor(this.sourcePathId,this.monitorId)}function mappingMonitorRegisterOn(e,t){return this.monitored[e]?void(this.monitored[e]+=t):(this.numMonitored++,this.monitored[e]=t,this.registrationInProgress=!0,this.sourceIndexer.registerSubTreeRetrievalOnNode(this.sourcePathId,e,this.monitorId,this),void(this.registrationInProgress=!1))}function mappingMonitorUnregisterFrom(e,t){e in this.monitored&&(t&&(this.monitored[e]-=t)>0||(this.sourceIndexer.unregisterSubTreeRetrievalOnNode(this.sourcePathId,e,this.monitorId),delete this.monitored[e],this.numMonitored--))}function mappingMonitorGetNumMonitored(){return this.numMonitored}function mappingMonitorUpdateSimpleElement(e,t,i,r){this.registrationInProgress||this.updates.push({sourcePathId:e,elementId:t,type:i,key:r})}function mappingMonitorRemoveSimpleElement(e,t){this.updates.push({sourcePathId:e,elementId:t,type:void 0})}function mappingMonitorCompleteUpdate(){}function mappingMonitorSubTreeUpdate(e,t,i){this.targetIndexer.mappingMonitorUpdate(this.updates),this.updates=[]}function PathNonTerminals(e,t){this.indexer=e,this.atRootPath=t,this.numNonTerminals=0,this.nonTerminalsByIdentity=t?new NonTerminalsByIdentityAtRoot:new NonTerminalsByIdentity,this.nonTerminalsByAdditionalIdentity=void 0}function pathNonTerminalsGetNum(){return this.numNonTerminals}function pathNonTerminalsAddAdditionalIdentification(e){void 0==this.nonTerminalsByAdditionalIdentity&&(this.nonTerminalsByAdditionalIdentity=new Map);var t;this.nonTerminalsByAdditionalIdentity.has(e)?(this.nonTerminalsByAdditionalIdentity[e].incGroups(),t=this.nonTerminalsByAdditionalIdentity.get(e)):(t=this.atRootPath?new NonTerminalsByIdentityAtRoot:new NonTerminalsByIdentity,this.nonTerminalsByAdditionalIdentity.set(e,t),t.initAdditionalIdentities(this,e))}function pathNonTerminalsRemoveAdditionalIdentification(e){if(void 0!=this.nonTerminalsByAdditionalIdentity&&this.nonTerminalsByAdditionalIdentity.has(e)){var t=this.nonTerminalsByAdditionalIdentity.get(e);t.decGroups()>0||(1==this.nonTerminalsByAdditionalIdentity.size?this.nonTerminalsByAdditionalIdentity=void 0:this.nonTerminalsByAdditionalIdentity.delete(e))}}function pathNonTerminalsGetAdditionalIdentities(e){var t;if(void 0!==(t=this.nonTerminalsByAdditionalIdentity)){var i=[],r=this;return t.forEach(function(t,n){i.push({identity:r.indexer.getIdentity(n,e),identification:n})}),i}}function pathNonTerminalsGetAdditionalIdentifications(){return this.nonTerminalsByAdditionalIdentity}function pathNonTerminalsAddNonTerminal(e,t,i){void 0===e&&(e=0),this.numNonTerminals++;var r=this.getAdditionalIdentities(t);if(r)for(var n=this.nonTerminalsByAdditionalIdentity,o=0,s=r.length;o<s;++o){var a=r[o].identification,d=r[o].identity;n.get(a).addNonTerminal(t,d,e)}return this.nonTerminalsByIdentity.addNonTerminal(t,i,e),r}function pathNonTerminalsRemoveNonTerminal(e,t,i){this.numNonTerminals--;var r=this.getAdditionalIdentities(t);if(r)for(var n=this.nonTerminalsByAdditionalIdentity,o=0,s=r.length;o<s;++o){var a=r[o].identification,d=r[o].identity;n.get(a).removeNonTerminal(t,d,e)}return this.nonTerminalsByIdentity.removeNonTerminal(t,i,e),r}function pathNonTerminalsUpdateIdentity(e,t,i,r,n){var o;if(void 0===n)o=this.nonTerminalsByIdentity;else if(!this.nonTerminalsByAdditionalIdentity||(o=this.nonTerminalsByAdditionalIdentity,!get(n)))return;o.removeNonTerminal(e,i,t)&&o.addNonTerminal(e,r,t)}function pathNonTerminalsGetNonTerminals(e,t,i){if(0!=this.numNonTerminals){var r;return void 0===i?this.nonTerminalsByIdentity.getNonTerminals(t,e):this.nonTerminalsByAdditionalIdentity&&(r=this.nonTerminalsByAdditionalIdentity.get(i))?r.getNonTerminals(t,e):void 0}}function pathNonTerminalsGetAllNonTerminals(e,t,i){if(0==this.numNonTerminals)return[];var r=void 0===i?this.nonTerminalsByIdentity:this.nonTerminalsByAdditionalIdentity.get(i);if(void 0===r)return[];var n=[];if(void 0===e){for(var o=[0],s=0,a=t.length;s<a;++s){var d=t[s];if(void 0!==d){var u=r.getNonTerminals(d,o);void 0!==u&&u.length>0&&(n[s]=u)}}return n}for(var s=0,a=t.length;s<a;++s){var d=t[s];if(void 0!==d){var o=e[s];if(void 0!==o){var u=r.getNonTerminals(d,[o]);void 0!==u&&u.length>0&&(n[s]=u)}}}return u}function NonTerminalsByIdentity(){this.groupNum=1,this.identities=new Map}function nonTerminalsByIdentityIncGroups(){return++this.groupNum}function nonTerminalsByIdentityDecGroups(){return--this.groupNum}function nonTerminalsByIdentityAddNonTerminal(e,t,i){var r,n;if(this.identities.has(t)?n=this.identities.get(t):(n=new Map,this.identities.set(t,n)),n.has(i)){if(r=n.get(i),r.has(e))return}else r=new Map,n.set(i,r);r.set(e,!0)}function nonTerminalsByIdentityRemoveNonTerminal(e,t,i){var r,n;return!!this.identities.has(t)&&(n=this.identities.get(t),!!n.has(i)&&(r=n.get(i),!!r.has(e)&&(1===r.size?1==n.size?this.identities.delete(t):n.delete(i):r.delete(e),!0)))}function nonTerminalsByIdentityInitAdditionalIdentities(e,t){if(0!=e.numNonTerminals){var i=e.indexer,r=e.nonTerminalsByIdentity.identities,n=this;r.forEach(function(e,r){e.forEach(function(e,r){e.forEach(function(e,o){n.addNonTerminal(o,i.getIdentity(t,o),r)})})})}}function nonTerminalsByIdentityGetNonTerminals(e,t){var i=this.identities.get(e);if(void 0!==i){var r=[];if(void 0===t)for(var n in i.dominating){var o=i.dominating[n];o.forEach(function(e,t){r.push(t)})}else for(var s=0,a=t.length;s<a;++s){var o=i.dominating[t[s]];o&&o.forEach(function(e,t){r.push(t)})}return r.length?r:void 0}}function NonTerminalsByIdentityAtRoot(){this.groupNum=1,this.identities=new Map}function nonTerminalsByIdentityAtRootIncGroups(){return++this.groupNum}function nonTerminalsByIdentityAtRootDecGroups(){return--this.groupNum}function nonTerminalsByIdentityAddNonTerminalAtRoot(e,t){var i;if(this.identities.has(t)){if(i=this.identities.get(t),i.has(e))return}else i=new Map,this.identities.set(t,i);i.set(e,!0)}function nonTerminalsByIdentityAtRootRemoveNonTerminal(e,t){var i;return!!this.identities.has(t)&&(i=this.identities.get(t),!!i.has(e)&&(1===i.size?this.identities.delete(t):i.delete(e),!0))}function nonTerminalsByIdentityAtRootInitAdditionalIdentities(e,t){var i=e.indexer,r=e.nonTerminalsByIdentity.identities,n=this;r.forEach(function(e,r){e.forEach(function(e,r){n.addNonTerminal(r,i.getIdentity(t,r))})})}function nonTerminalsByIdentityAtRootGetNonTerminals(e){var t=this.identities.get(e);if(void 0!==t&&0!=t.size){var i=[];return t.forEach(function(e,t){i.push(t)}),i}}function ChildrenByIdentity(){this.identities={},this.children={},this.numChildren=0,this.parents={}}function childrenByIdentityAddChild(e,t,i,r){var n;(n=this.children[i])||(n=this.children[i]={numIdentities:0,identitiesByGroup:{}},this.numChildren++),r in n.identitiesByGroup||n.numIdentities++,n.identitiesByGroup[r]=e;var o;(o=this.identities[e])||(o=this.identities[e]=new ChildrenByIdentityEntry),o.addChild(i,r);var s;(s=this.parents[t])||(s=this.parents[t]={sameId:0,children:{},childNum:0}),t==i?s.sameId++:i in s.children?s.children[i]++:(s.children[i]=1,s.childNum++)}function childrenByIdentityRemoveChild(e,t,i){var r=this.children[t];if(r){var n=r.identitiesByGroup[i];if(void 0!==n){var o=this.identities[n];o.removeChild(t,i),0==o.groupNum&&delete this.identities[n],--r.numIdentities?r.identitiesByGroup[i]:(delete this.children[t],this.numChildren--);var s=this.parents[e];e==t?--s.sameId||s.childNum||delete this.parents[e]:--s.children[t]||(--s.childNum||s.sameId?delete s.children[t]:delete this.parents[e])}}}function childrenByIdentityRemoveGroup(e){var t=[];for(var i in this.children){var r=this.children[i];e in r.identitiesByGroup&&(1===r.numIdentities?(delete this.children[i],this.numChildren--):(delete r.identitiesByGroup[e],r.numIdentities--),t.push(i))}if(0==this.numChildren)return this.identities={},void(this.parents={});for(var n=new Map,o=0,s=t.length;o<s;++o)n.set(t[o],!0);for(var a in this.parents){var d=this.parents[a];if(n.has(a))0==--d.sameId&&0==d.childNum&&delete this.parents[a];else if(d.childNum>0)for(var u in d.children)n.has(u)&&(--d.children[u]>0||(0==--d.childNum?(0==d.sameId&&delete this.parents[a],d.children={}):delete d.children[u]))}for(var h in this.identities){var r=this.identities[h];0==r.removeGroup(e)&&delete this.identities[h]}}function childrenByIdentityUpdateIdentity(e,t,i,r,n){var o=this.parents[e];if(!o)return[];var s=[];if(o.sameId>0&&this.updateChildIdentity(e,t,i,r,n,s),o.childNum)for(var a in o.children)this.updateChildIdentity(a,t,i,r,n,s);return s}function childrenByIdentityUpdateChildIdentity(e,t,i,r,n,o){var s=this.children[e];if(s){var a;for(var d in s.identitiesByGroup){var u=i[d];if(u.sourceIndexer==r&&u.sourceIdentificationId==n){a=s.identitiesByGroup[d],s.identitiesByGroup[d]=t;var h=this.identities[a];h.removeChild(e,d),0==h.groupNum&&delete this.identities[a],(h=this.identities[t])||(h=this.identities[t]=new ChildrenByIdentityEntry),h.addChild(e,d),o.push({childId:e,groupId:d,oldIdentity:a})}}}}function childrenByIdentityGetChildren(e){return this.identities[e]}function ChildrenByIdentityEntry(){this.groupNum=0,this.groups={}}function childrenByIdentityEntryAddChild(e,t){var i;(i=this.groups[t])?e in i.nodes||(i.nodes[e]=!0,i.nodeNum++):(i=this.groups[t]={nodeNum:1,nodes:{}},this.groupNum++,i.nodes[e]=!0)}function childrenByIdentityEntryRemoveChild(e,t){var i=this.groups[t];i&&e in i.nodes&&(--i.nodeNum?delete i.nodes[e]:(this.groupNum--,delete this.groups[t]))}function childrenByIdentityEntryRemoveGroup(e){return e in this.groups?(delete this.groups[e],--this.groupNum):this.groupNum}function UnmappedByIdentity(){this.identities={}}function unmappedByIdentityAddUnmapped(e,t,i,r){void 0===e&&(e=0);var n;(n=this.identities[t])||(n=this.identities[t]={dominatingNum:0,dominating:{}});var o;(o=n.dominating[e])||(o=n.dominating[e]=new UnmappedByIdentityEntry,n.dominatingNum++),o.addUnmapped(i,r)}function unmappedByIdentityGetUnmapped(e,t){var i;if(i=this.identities[e])return i.dominating[t]}function unmappedByIdentityRemoveUnmapped(e,t,i,r){var n;(n=this.identities[i])&&(dominatingEntry,(dominatingEntry=n.dominating[r])&&0===dominatingEntry.removeUnmapped(e,t)&&(--n.dominatingNum?delete n.dominating[r]:delete this.identities[i]))}function unmappedByIdentityUpdateIdentity(e,t,i,r,n){var o=this.identities[r];if(o)for(var s,a=0,d=t.length;a<d;++a){var u,h=t[a];(u=o.dominating[h])&&u.removeUnmapped(e,i)!==!1&&(0==u.getGroupNum()&&(--o.dominatingNum?delete o.dominating[h]:delete this.identities[r]),s||(s=n in this.identities?this.identities[n]:this.identities[n]={dominatingNum:0,dominating:{}}),(u=s.dominating[h])||(u=s.dominating[h]=new UnmappedByIdentityEntry,s.dominatingNum++),u.addUnmapped(e,i))}}function UnmappedByIdentityEntry(){this.groupNum=0,this.groups={}}function unmappedByIdentityEntryAddUnmapped(e,t){var i;if(i=this.groups[t]){if(e in i.nodes)return;i.nodeNum++}else i=this.groups[t]={nodeNum:1,nodes:{}},this.groupNum++;i.nodes[e]=!0}function unmappedByIdentityEntryRemoveUnmapped(e,t){var i;return!!((i=this.groups[t])&&e in i.nodes)&&(--i.nodeNum?delete i.nodes[e]:(delete this.groups[t],this.groupNum--),this.groupNum)}function unmappedByIdentityEntryGetGroupNum(){return this.groupNum}function UnmappedNodes(){this.bySourceId={},this.sourceIdNum=0,this.byDominating={},this.byIdentity=new UnmappedByIdentity}function unmappedNodesIsUnmapped(e,t){return e in this.bySourceId&&t in this.bySourceId[e].groups}function unmappedNodesUnmappedNum(){return this.sourceIdNum}function unmappedNodesGetDominating(e,t){var i;if(i=this.bySourceId[e]){var r;if(r=i.groups[t])return r.dominating}}function unmappedNodesGetGroups(e){var t=this.bySourceId[e];return t?t.groups:void 0}function unmappedNodesGetByIdentity(e,t){return void 0===t&&(t=0),this.byIdentity.getUnmapped(e,t)}function unmappedNodesAddNode(e,t,i,r,n){void 0===i&&(i=0);var o;(o=this.bySourceId[e])||(o=this.bySourceId[e]={groupNum:0,groups:{}},this.sourceIdNum++);var s;(s=o.groups[t])||(s=o.groups[t]={dominatingNum:0,dominating:{},identity:n},o.groupNum++),i in s.dominating||(s.dominating[i]=!0,s.dominatingNum++);var a;(a=this.byDominating[i])||(a=this.byDominating[i]=new SourceNodesByPriority),a.addNode(e,t,r),this.byIdentity.addUnmapped(i,n,e,t)}function unmappedNodesGetByDominating(e){return void 0===e?this.byDominating[0]:this.byDominating[e]}function unmappedNodesGetAllDominatingIds(){var e=[];for(var t in this.byDominating)e.push(t);return e}function unmappedNodesHasUnmapped(e){return void 0===e?this.sourceIdNum>0:e in this.byDominating}function unmappedNodesGetHighestPriority(e){void 0===e&&(e=0);var t;if(t=this.byDominating[e]){var i=t.getHighestPriority();t.isEmpty()&&delete this.byDominating[e];for(var r in i)for(var n in i[r].nodes)this.removeFromBySource(n,r,e);return i}}function unmappedNodesRemoveByDominating(e){void 0===e&&(e=0);var t=this.byDominating[domiantingId];if(t){for(var i=0,r=t.byPriority.length;i<r;++r){var n=t.byPriority[i].groups;for(var o in n){var s=n[o];for(var a in s.nodes)this.removeFromBySource(a,o,e)}}delete this.byDominating[domiantingId]}}function unmappedNodesRemoveSingleEntry(e,t,i,r){void 0===e&&(e=0);var n=this.byDominating[domiantingId];n&&(n.removeNode(t,i,r)||delete this.byDominating[domiantingId],this.removeFromBySource(t,i,e))}function unmappedNodesRemoveFromBySource(e,t,i){void 0===i&&(i=0);var r;if(r=this.bySourceId[e]){var n;(n=r.groups[t])&&(this.byIdentity.removeUnmapped(e,t,n.identity,i),i in n.dominating&&(--n.dominatingNum?delete n.dominating[i]:--r.groupNum?delete r.groups[t]:(delete this.bySourceId[e],this.sourceIdNum--)))}}function unmappedNodesRemoveBySource(e,t,i){var r;if(r=this.bySourceId[e]){var n;if(n=r.groups[t]){for(var o in n.dominating)this.byIdentity.removeUnmapped(e,t,n.identity,o),0==this.byDominating[o].removeNode(e,t,i)&&delete this.byDominating[o];return--r.groupNum?delete r.groups[t]:(delete this.bySourceId[e],this.sourceIdNum--),{identity:n.identity,dominatingIds:Object.keys(n.dominating)}}}}function unmappedNodesUpdateIdentity(e,t,i,r,n){var o;if(o=this.bySourceId[e]){var s,a=[];for(var d in o.groups){var u=i[d];if(u.sourceIndexer==r&&u.sourceIdentificationId==n){var h=o.groups[d];s=h.identity,h.identity=t;var l=Object.keys(h.dominating);this.byIdentity.updateIdentity(e,l,d,s,t),a.push({groupId:d,oldIdentity:s,dominatingIds:l})}}return a}}function UnmappedNodesAtRoot(){this.bySourceId={},this.sourceIdNum=0,this.byPriority=new SourceNodesByPriority,this.byIdentity=new UnmappedByIdentity}function unmappedNodesAtRootIsUnmapped(e,t){return e in this.bySourceId&&t in this.bySourceId[e].groups}function unmappedNodesAtRootUnmappedNum(){return this.sourceIdNum}function unmappedNodesAtRootAddNode(e,t,i,r){var n;(n=this.bySourceId[e])?t in n.groups||(n.groups[t]=r,n.groupNum++):(n=this.bySourceId[e]={groupNum:1,groups:{}},this.sourceIdNum++,n.groups[t]=r),this.byPriority.addNode(e,t,i),this.byIdentity.addUnmapped(0,r,e,t)}function unmappedNodesAtRootGetByDominating(){return this.byPriority}function unmappedNodesAtRootGetGroups(e){var t=this.bySourceId[e];return t?t.groups:void 0}function unmappedNodesAtRootGetByIdentity(e){return this.byIdentity.getUnmapped(e,0)}function unmappedNodesAtRootHasUnmapped(){return this.sourceIdNum>0}function unmappedNodesAtRootGetHighestPriority(e){var t=this.byPriority.getHighestPriority();if(t){for(var i in t)for(var r in t[i].nodes)this.removeFromBySource(r,i);return t}}function unmappedNodesAtRootRemoveFromBySource(e,t){var i;(i=this.bySourceId[e])&&t in i.groups&&(this.byIdentity.removeUnmapped(e,t,i.groups[t],0),--i.groupNum?delete i.groups[t]:(delete this.bySourceId[e],this.sourceIdNum--))}function unmappedNodesAtRootRemoveBySource(e,t,i){var r;if((r=this.bySourceId[e])&&t in r.groups){var n=r.groups[t];return this.byIdentity.removeUnmapped(e,t,n,0),this.byPriority.removeNode(e,t,i),--r.groupNum?delete r.groups[t]:(delete this.bySourceId[e],this.sourceIdNum--),{identity:n,dominatingIds:[0]}}}function unmappedNodesAtRootUpdateIdentity(e,t,i,r,n){var o;if(o=this.bySourceId[e]){var s,a=[];for(var d in o.groups){var u=i[d];u.sourceIndexer==r&&u.sourceIdentificationId==n&&(s=o.groups[d],o.groups[d]=t,this.byIdentity.updateIdentity(e,[0],d,s,t),a.push({groupId:d,oldIdentity:s}))}return a}}function SourceNodesByPriority(){this.sourceNodes={},this.byPriority=[]}function sourceNodesByPriorityAddNode(e,t,i){var r;if(!(r=this.sourceNodes[i])){r=this.sourceNodes[i]={priority:i,groupNum:0,groups:{}};var n;for(n=0,l=this.byPriority.length;n<l&&!(this.byPriority[n].priority<i);++n);this.byPriority.splice(n,0,r)}var o;(o=r.groups[t])?e in o.nodes||(o.nodes[e]=!0,o.nodeNum++):(o=r.groups[t]={nodeNum:1,nodes:{}},r.groupNum++,o.nodes[e]=!0)}function sourceNodesByPriorityRemoveNode(e,t,i){var r,n;if(!((r=this.sourceNodes[i])&&(n=r.groups[t])&&e in n.nodes))return this.byPriority.length;if(--n.nodeNum)delete n.nodes[e];else if(--r.groupNum)delete r.groups[t];else{for(var o=0,s=this.byPriority.length;o<s;++o)if(this.byPriority[o]==r){this.byPriority.splice(o,1);break}delete this.sourceNodes[i]}return this.byPriority.length}function sourceNodesByPriorityGetHighestPriority(){if(0!==this.byPriority.length){var e=this.byPriority[0];return delete this.sourceNodes[e.priority],this.byPriority.splice(0,1),e.groups}}function sourceNodesByPriorityIsEmpty(){return 0==this.byPriority.length}function MergeIndexer(e){this.IdentityIndexer(e),this.nonExtensionPathIds={},this.mappings=new Map,this.numProjs=0,this.groupIdByDesc={},this.groupById={},this.identityGroupByIdentification=new Map,this.groupBySourceIdentification=new Map,this.identifiedByTarget=new Map,void 0!==debugAllMergeIndexers&&(debugAllMergeIndexers[this.id]=this)}function mergeIndexerCreateDataElements(){return new MergeDataElements(this)}function mergeIndexerDestroy(){for(var e in this.groupById)this.destroyGroup(this.groupById[e]);this.IdentityIndexer_destroy(),void 0!==debugAllMergeIndexers&&delete debugAllMergeIndexers[this.id]}function mergeIndexerCreatePathNode(e){if(void 0===e)return void assert(!1,"creating path with an undefined path ID");if(e in this.pathNodesById)return this.pathNodesById[e];var t=this.IdentityIndexer_createPathNode(e);return t.mappingGroups=new Map,t.dominatedMinGroups=0,t.minGroupPriority=1/0,t.maxGroupPriority=-(1/0),t.unmappedNodes=void 0,t.nonTerminals=void 0,t.childrenByIdentity=void 0,t.numOperators=0,t.operators=void 0,t.dataElementOperators=void 0,e==this.qcm.getRootPathId()&&(t.priority=-(1/0)),t.dominatedPriorities=new Map,t}function mergeIndexerNewDataElementEntry(e,t,i,r){return{pathId:e,parent:t,identity:void 0,groupId:i,sourceId:r,refCount:1,children:void 0}}function mergeIndexerAddPath(e){if(e in this.nonExtensionPathIds&&!(e in this.pathNodesById)){var t=this.IdentityIndexer_addPath(e);return t.nonExtensionPath=!0,t}return this.IdentityIndexer_addPath(e)}function mergeIndexerAddNonExtensionPathId(e,t){var i=this.qcm.allocatePathIdFromPath(e,t);i in this.nonExtensionPathIds?this.qcm.releasePathId(i):this.nonExtensionPathIds[i]=!0}function mergeIndexerAddMapping(e,t,i,r,n,o,s,a,d){var u=e.getId(),h=!r||!r.length;if(!h&&a&&(r.length>2||!d)){var l=this.qcm.getPrefix(r[0]);r.unshift(l,r[1])}var c;if(this.mappings.has(u))c=this.mappings.get(u);else{if(h)return;c=new Map,this.mappings.set(u,c)}var p;if(c.size>0&&c.has(t)){p=c.get(t);for(var f=p.groups,v=0,g=f.length;v<g;++v)f[v].removeMapping(u,t)&&this.destroyGroup(f[v]);if(h)return 1==c.size?this.mappings.delete(u):c.delete(t),void this.numProjs--}else{if(h)return;p={groups:void 0,matchesAdded:!1},c.set(t,p),this.numProjs++}for(var m,v=0,g=r.length;v<g;v+=2){var y=r[v+1],I=r[v];m=this.addMappingToGroup(e,t,i,m,v==g-2,a&&0==v,y,I,n,o,s)}p.groups=m.groupSequence}function mergeIndexerRemoveMapping(e,t){var i=e.getId();if(this.mappings.has(i))if(void 0===t){var r=this;this.mappings.get(i).forEach(function(t,i){r.addMapping(e,i)})}else this.addMapping(e,t)}function mergeIndexerRemoveAllMappings(){for(var e in this.groupById)this.destroyGroup(this.groupById[e]);this.mappings=new Map,this.numProjs=0}function mergeIndexerReplaceFuncSource(e,t,i,r,n,o){var s=e.getId(),a=this.mappings.get(s);if(void 0===a)return!1;var d,u=new Map,h=!1,l=!1,c=void 0,p=!1,f=this,v=!1;if(a.forEach(function(e,t){if(!v){var s=e.groups;e.matchesAdded&&(p=!0);for(var a=0,g=s.length;a<g;++a){var m=s[a];if(m.mappings.size>1)return void(v=!0);var y=m.sourcePathId,I=f.qcm.getPathSuffix(y,i),b=f.qcm.allocateConcatPathId(r,I);f.qcm.releasePathId(b);var C=MergeGroup.makeGroupDesc(n,m.prefixGroup,m.isMaxGroup,m.isIdentityGroup,b,m.targetPathNode.pathId,m.priority,o,m.targetIdentificationId);if(C!==m.description&&C in f.groupIdByDesc)return void(v=!0);u.set(m.groupId,{description:C,sourcePathId:b}),m.isIdentityGroup&&(h=!0,m.isMaxGroup&&(l=!0)),void 0!==m.targetIdentificationId&&(c=m.targetIdentificationId),d=m.priority}}}),v)return!1;a.forEach(function(e,t){for(var i=e.groups,r=0,n=i.length;r<n;++r)i[r].removeMapping(s,t);a.delete(t),f.numProjs--}),u.forEach(function(e,t){var i=f.groupById[t];delete f.groupIdByDesc[i.description],f.groupIdByDesc[e.description]=i.groupId,i.changeGroupSource(e.sourcePathId,n,o)});var f=this;return t.forEach(function(t,i){f.addMapping(e,i,n,t,d,o,c,h,l)}),p&&(a=this.mappings.get(s),a.forEach(function(e,t){e.matchesAdded=!0})),!0}function mergeIndexerGetRegisteredFuncProjections(e){if(this.mappings.has(e))return this.mappings.get(e)}function mergeIndexerGetProjEntry(e,t){var i=this.mappings.get(e);if(void 0!==i)return i.get(t)}function mergeIndexerGetProjGroupSequence(e,t){var i=this.mappings.get(e);if(void 0!==i){var r=i.get(t);if(void 0!==r)return r.groups}}function mergeIndexerGetProjMaxGroup(e,t){var i=this.mappings.get(e);if(void 0!==i){var r=i.get(t);if(void 0!==r)return r.groups[0]}}function mergeIndexerProjAlreadyAddedMatches(e,t){var i=this.mappings.get(e);if(void 0===i)return!1;var r=i.get(t);return void 0!==r&&r.matchesAdded}function mergeIndexerIsSingleMappingResult(){return 1==this.mappings.size}function mergeIndexerAddMappingToGroup(e,t,i,r,n,o,s,a,d,u,h){var l=MergeGroup.makeGroupDesc(i,r,n,o,s,a,d,u,h),c=this.createGroup(l,i,r,n,o,s,a,d,u,h);return c.addMapping(e,t),c}function mergeIndexerCreateGroup(e,t,i,r,n,o,s,a,d,u){if(e in this.groupIdByDesc)return this.groupById[this.groupIdByDesc[e]];var h=new MergeGroup(this,e,t,i,r,n,o,s,a,d,u);return this.groupIdByDesc[e]=h.groupId,this.groupById[h.groupId]=h,h}function mergeIndexerDestroyGroup(e){delete this.groupIdByDesc[e.description],delete this.groupById[e.groupId],e.destroy()}function mergeIndexerAddIdentityGroupByIdentification(e){void 0===this.identityGroupByIdentification&&(this.identityGroupByIdentification=new Map);var t=e.sourceIdentificationId;void 0===t&&(t=0);var i;this.identityGroupByIdentification.has(t)?i=this.identityGroupByIdentification.get(t):(i=new Map,this.identityGroupByIdentification.set(t,i)),i.set(e.groupId,e)}function mergeIndexerRemoveIdentityGroupByIdentification(e){var t=e.sourceIdentificationId;void 0===t&&(t=0);var i=this.identityGroupByIdentification.get(t);void 0!==i&&(i.delete(e.groupId),0==i.size&&this.identityGroupByIdentification.delete(t))}function mergeIndexerPathNodeActivated(e){e.trace&&this.pathNodeTracingActivated(e),e.subTree&&this.subTreeMonitoringActivated(e)}function mergeIndexerPathNodeTracingActivated(e){if(e.mappingGroups.size>0){var t=this;e.mappingGroups.forEach(function(i,r){var n=t.groupById[r];if(n.isMaxGroup){if(e!=n.targetPathNode)return;n.addMappingGroupToPath(e,!0)}t.mergeNonMonitoredAtExplicit(n,e)})}var i;if(!e.nonExtensionPath&&(i=e.parent)&&i.mappingGroups.size>0){var t=this;i.mappingGroups.forEach(function(i,r){if(i!==!0){var n=t.groupById[r];if(!n.isIdentityGroup){var o=n.addMappingGroupToPath(e,!1);t.mergeNonMonitoredAtExtension(n,o.sourcePathId,e)}}})}e.subTree&&this.removeMappingMonitorAtTracePath(e)}function mergeIndexerMergeNonMonitoredAtExplicit(e,t){var i=e.getAllSourceNodes(),r=e.getSourceElements(i,t.parent,!1);if(void 0!==t.parent){void 0===e.prefixGroup?r[1]=this.getDominatingByGroup(e,r[1]):r[1]=this.getAllDominatingByMerged(e,t.parent,r[1]);var n=this.filterSourceByMonitoredDominating(r[0],r[1],t.parent,!1);r[0]=n.sourceIds,r[1]=n.allDominatingIds}this.addMergedNodes(e,t,r[0],r[1])}function mergeIndexerMergeNonMonitoredAtExtension(e,t,i){var r=e.getAllSourceNodes(),n=e.sourceIndexer.getDominatedNodes(t,r,e.sourcePathId);this.mergeAtExtensionPath(e,i,n,!0,!1)}function mergeIndexerPathNodeDeactivated(e){if(!this.isPathActive(e.pathId)){var t=this.destroyPathNodeMapping(e);if(0==t.length&&void 0===e.children){var i=e.parent;return this.removePathNode(e),void(void 0===i||void 0!==i.children||this.isPathActive(i.pathId)||this.pathNodeDeactivated(i))}if(this.numTranslatingGroups(e)>0){var r=[];e.nodes.forEach(function(e,t){r.push(t)}),this.removeDataElementIdsFromGroup(r,e)}this.clearPathNode(e);for(var n=0,o=t.length;n<o;++n){var s=this.groupById[t[n]];void 0===s.prefixGroup&&s.clearAllSourceElements()}}}function mergeIndexerDestroyPathNodeMapping(e){var t=[];return e.mappingGroups.forEach(function(i,r){return i===!0?void t.push(r):(e.mappingGroups.set(r,{sourcePathId:i.sourcePathId,isExtension:i.isExtension}),i.isExtension||t.push(r),void(void 0!==i.destroy&&i.destroy()))}),t}function mergeIndexerClearPathNode(e){e.unmappedNodes=void 0,e.nonTerminals=void 0,e.childrenByIdentity=void 0,e.numOperators=0,e.operators=void 0,e.dataElementOperators=void 0,e.dominatedPriorities=new Map,e.pathId==this.qcm.getRootPathId()&&(e.priority=-(1/0)),this.InternalQCMIndexer_clearPathNode(e)}function mergeIndexerPathNodeTracingDeactivated(e){0!==e.mappingGroups.size&&(this.destroyPathNodeMapping(e),this.removeNonMonitoredNodes(e),e.subTree&&this.addMappingMonitorAtNoTracePath(e))}function mergeIndexerRemoveNonMonitoredNodes(e){if(void 0!==pathNode.unmappedNodes&&pathNode.unmappedNodes.getNum()>0)if(void 0===e.parent)pathNode.unmappedNodes=void 0;else{var t=pathNode.unmappedNodes.getAllDominatingIds();t=this.filterMonitoredDominating(t,pathNode.parent,!1),this.removeUnmappedNodesByDominating(pathNode,t)}var i=[];if(e.subTree){var r=this;e.nodes.forEach(function(e,t){r.inSubTree(e)||i.push(t)})}else e.nodes.forEach(function(e,t){i.push(t)});this.removeTargetNodes(e,i)}function mergeIndexerSubTreeMonitoringActivated(e){}function mergeIndexerSubTreeMonitoringDeactivated(e){}function mergeIndexerInSubTreeActivated(e,t){var i=this.dataElements.getEntry(t),r=i.groupId,n=void 0===i.sourceId?t:i.sourceId;
if(void 0!==r){var o=this.groupById[r],s=e.nodes.get(t),a=!!s.hasAttrs;if(o.isMaxGroup&&!o.isIdentityGroup&&a){var d=o.getSourceNonAttrs(e,[n]);if(void 0!==d&&void 0!==d[0]){this.setKeyValue(e,t,"nonAttribute",void 0);var u=this;d[0].forEach(function(i,r){u.setKeyValue(e,t,"nonAttribute",r)})}}if(this.addMappingMonitorForMappedNode(e,o,n,t,s,a),o.isMaxGroup){var h=this.getDominatingId(t,e.pathId),l=o.getSourceIdentity(n);if(!o.isIdentityGroup){var c=this.isSingleMappingResult()?[h]:[[h]];this.mergeChildrenUnderMerged(o,e,[n],c,!0)}if(void 0!==e.nonTerminals&&a){var p=e.nonTerminals.getAdditionalIdentities(t);this.mergeUnderNode(h,e,t,l,!1,p)}else if(this.isOperatorType(s.type)&&h!=t){var p=e.dataElementOperators.getAdditionalIdentities(t);this.mergeUnderNode(h,e,t,l,!0,p)}}}}function mergeIndexerInSubTreeOnlyAsRootActivated(e,t){var i=this.dataElements.getEntry(t),r=this.groupById[i.groupId],n=void 0===i.sourceId?t:i.sourceId;if(r.isMaxGroup&&!r.isIdentityGroup&&r.targetPathNode==e){var o=e.nodes.get(t);this.addMappingMonitorForMappedNode(e,r,n,t,o,!!o.hasAttrs)}}function mergeIndexerInSubTreeWithAttrActivated(e,t){if(e.trace){var i=this.dataElements.getEntry(t);if(void 0!==i.groupId){var r=this.groupById[i.groupId],n=void 0===i.sourceId?t:i.sourceId,o=e.nodes.get(t);this.addMappingMonitorForMappedNode(e,r,n,t,o,!0)}}}function mergeIndexerInSubTreeDeactivated(e,t,i){var r=this.dataElements.getEntry(t),n=this.groupById[r.groupId],o=void 0===r.sourceId?t:r.sourceId,s=e.nodes.get(t);if(this.removeMappingMonitorForMappedNode(e,n,o,t,s,s.hasAttrs,i,e.trace),this.removeMappingMonitorUnderNonTerminal(e,t,s),!e.trace){this.removeTargetNodes(e,[t]);var a=this.getDominatingId(t,e.pathId);t!=a&&this.hasDirectChildDataElements(a,e.pathId)||this.removeUnmappedNodesByDominating(e,[a])}}function mergeIndexerInSubTreeOnlyAsRootDeactivated(e,t){var i=this.dataElements.getEntry(t),r=this.groupById[i.groupId],n=void 0===i.sourceId?t:i.sourceId;if(r.isMaxGroup&&!grouoEntry.isIdentityGroup&&r.targetPathNode!=e){var o=e.nodes.get(t);this.removeMappingMonitorForMappedNode(e,r,n,t,o,o.hasAttrs,!0,e.trace)}}function mergeIndexerInSubTreeWithAttrDeactivated(e,t){if(e.trace){var i=this.dataElements.getEntry(t),r=this.groupById[i.groupId],n=void 0===i.sourceId?t:i.sourceId,o=e.nodes.get(t);this.removeMappingMonitorForMappedNode(e,r,n,t,o,!0,this.inSubTreeOnlyAsRoot(o),e.trace)}}function mergeIndexerAddMappingMonitorForMappedNode(e,t,i,r,n,o){if(!t.isIdentityGroup&&(!e.trace||o)){var s;(s=e.mappingGroups.get(t.groupId))!==!0&&(s.isExtension&&!this.inSubTreeOnlyAsRoot(n)||this.addMappingMonitor(t,e,i,1))}}function mergeIndexerAddMappingMonitorUnderNonTerminals(e,t,i,r){if(t.subTree&&e.isMaxGroup&&!e.isIdentityGroup)for(var n=0,o=r.length;n<o;++n){var s=i[n];if(void 0!==s){var a=r[n];if(void 0!==a&&0!==a.length){for(var d=0,u=0,h=a.length;u<h;++u)this.inSubTree(t.nodes.get(a[u]))&&d++;0!==d&&this.addMappingMonitor(e,t,s,d)}}}}function mergeIndexerRemoveMappingMonitorForMappedNode(e,t,i,r,n,o,s,a){if(!t.isIdentityGroup&&(!a||o)){var d;(d=e.mappingGroups.get(t.groupId))!==!0&&(d.isExtension&&!s||this.removeMappingMonitor(t,e,i,1))}}function mergeIndexerAddMappingMonitorAtNoTracePath(e){var t=this;e.nodes.forEach(function(i,r){if(t.inSubTree(i)&&!i.hasAttrs){var n=t.dataElements.getEntry(r),o=n.groupId,s=void 0===n.sourceId?r:n.sourceId;t.addMappingMonitorForMappedNode(e,t.groupById[o],s,r,i,!1)}})}function mergeIndexerRemoveMappingMonitorAtTracePath(e){var t=this;e.nodes.forEach(function(i,r){if(t.inSubTree(i)&&!i.hasAttrs){var n=t.dataElements.getEntry(r),o=t.groupById[n.groupId],s=void 0===n.sourceId?r:n.sourceId,a=t.inSubTreeOnlyAsRoot(i);t.removeMappingMonitorForMappedNode(e,o,s,r,i,!1,a,!1)}})}function mergeIndexerRemoveUnmappedMappingMonitorByDominating(e,t,i,r){if(t.isMaxGroup&&!t.isIdentityGroup&&this.hasMappingMonitor(t,e)&&void 0!==e.nonTerminals&&0!=e.nonTerminals.getNum())for(var n in r){var o=t.getSourceIdentity(n),s=e.nonTerminals.getNonTerminals([i],o,t.targetIdentificationId);if(s&&0!=s.length){for(var a=0,d=0,u=s.length;d<u;++d)this.inSubTree(e.nodes.get(s[d]))&&a++;a>0&&this.removeMappingMonitor(t,e,n,a)}}}function mergeIndexerRemoveMappingMonitorUnderNonTerminal(e,t,i){var r=this.isNonTerminalOperator(e,t);if((r||this.isNonTerminal(e,t,i))&&e.unmappedNodes&&e.unmappedNodes.getNum()){var n=this.getDominatingId(t,e.pathId);if((!r||n!=t)&&e.unmappedNodes.getByDominating(n)){var o=this.dataElements.getBaseIdentity(t),s=r?e.dataElementOperators:e.nonTerminals,a=s.getAdditionalIdentities(t);this.removeUnmappedMappingMonitor(e,n,o,a)}}}function mergeIndexerRemoveUnmappedMappingMonitor(e,t,i,r){if(r)for(var n=0,o=r.length;n<o;++n){var s=r[n].identity,a=r[n].identification;this.removeUnmappedMappingMonitorByIdentity(e,t,s,a)}this.removeUnmappedMappingMonitorByIdentity(e,t,i,void 0)}function mergeIndexerRemoveUnmappedMappingMonitorByIdentity(e,t,i,r){if(e.unmappedNodes){void 0===t&&(t=0);var n=e.unmappedNodes.getByIdentity(i,t);if(n)for(var o in n.groups){var s=this.groupById[o];if(s.isMaxGroup&&!s.isIdentityGroup&&s.targetIdentificationId==r)for(var a in n.groups[o].nodes)this.removeMappingMonitor(s,e,a,1)}}}function mergeIndexerAddMappingMonitor(e,t,i,r){if(!e.isIdentityGroup){e.subTreeMonitors||(e.subTreeMonitors={},e.sourcePathMapping={});var n=e.subTreeMonitors[t.pathId];if(!n){var o=t.pathId,s=this.getSourcePathId(e,o);e.subTreeMonitors[o]=new MappingMonitor(this,e,s),e.sourcePathMapping[s]=o}n.registerOn(i,r)}}function mergeIndexerRemoveMappingMonitor(e,t,i,r){if(!e.isIdentityGroup){var n;e.subTreeMonitors&&(n=e.subTreeMonitors[t.pathId])&&(n.unregisterFrom(i,r),0==n.getNumMonitored()&&(n.destroy(),delete e.subTreeMonitors[t.pathId]))}}function mergeIndexerHasMappingMonitor(e,t){return void 0!==e.subTreeMonitors&&t.pathId in e.subTreeMonitors}function mergeIndexerGetMonitoredTargetPath(e,t){var i,r;if(t==e.sourcePathId)return e.targetPathNode;if(i=e.sourcePathMapping[t])r=this.pathNodesById[i];else{var n=this.qcm.diffPathId(t,e.sourcePathId);if(i=this.qcm.allocateConcatPathId(e.targetPathNode.pathId,n),e.sourcePathMapping[t]=i,(r=this.pathNodesById[i])||(r=this.addPath(i)),r.nonExtensionPath)return;e.addMappingGroupToPath(r,!1),this.qcm.releasePathId(i)}return r}function mergeIndexerMappingMonitorUpdate(e,t){for(var i,r,n=this.groupById[e],o=0,s=t.length;o<s;++o){var a=t[o];i!=a.sourcePathId&&(i=a.sourcePathId,r=this.getMonitoredTargetPath(n,i)),void 0!==r&&(r==n.targetPathNode?this.setKeyValue(r,a.elementId,a.type,a.key):void 0!==a.type?this.mergeAtExtensionPath(n,r,[a.elementId],!1,!0):this.removeAtExtensionPath(n,i,r,[a.elementId]))}}function mergeIndexerAddProjMatches(e,t,i){var r=this.getProjEntry(t,i);if(void 0!==r){r.matchesAdded=!0;var n=r.groups,o=this.mergeAtMaximalPath(n,e,t,i),s=o[0],a=o[1],d=n[0];void 0===a||d.isIdentityGroup||this.mergeChildrenUnderMerged(d,d.targetPathNode,s,a)}}function mergeIndexerAddExtensionMatches(e,t){var i=this.groupById[t.groupId],r=t.getSourcePathId(),n=t.targetPathNode,o=i.getSourceNodesDominatedBy(e,r);0!==o.length&&this.mergeAtExtensionPath(i,n,o,!0,void 0)}function mergeIndexerRemoveProjMatches(e,t,i){var r=this.getProjGroupSequence(t,i);this.removeAtMaximalPath(r,e,t,i)}function mergeIndexerRemoveExtensionMatches(e,t){var i=this.groupById[t.groupId],r=t.getSourcePathId(),n=t.targetPathNode;this.removeAtExtensionPath(i,r,n,e)}function mergeIndexerMergeAtMaximalPath(e,t,i,r){var n=e[0].addSourceElements(t,i,r),o=e.length-1;void 0!==e[o].targetPathNode.parent&&(n[o+1]=this.getDominatingByGroup(e[o],n[o+1]));var s=e.length==n.length;return[n[0],this.mergeDominationSequence(e,n,s)]}function mergeIndexerMergeDominationSequence(e,t,i){for(var r,n=t.length-(i?1:2),o=t[n+1],s=!1,a=n;a>=0;a--){var d=e[a].targetPathNode,u=t[a];if(s){if(void 0!==r&&r!==!0&&r.length<u.size){for(var h=[],l=0,c=r.length;l<c;++l)h.push(u[r[l]]);u=h}}else if(!d.trace){var p=d.parent;if(void 0!==o&&void 0!==p){var f=this.filterSourceByMonitoredDominating(u,o,p,!0,a>0);o=f.allDominatingIds,u=f.sourceIds,r=f.filteredPos}else o=[],u=[],r=[];s=!0}t[a]=u,o=this.addMergedNodes(e[a],d,u,o)}return o}function mergeIndexerMergeAtExtensionPath(e,t,i,r,n){var o,s=t.parent,a=e.getDominatingSourceNodes(t,i);if(o=r||s===e.targetPathNode?this.getAllDominatingByMerged(e,s,a):this.mergeAtExtensionPath(e,s,a,!1,n),t.trace||(n=!0),void 0===n)return this.addMergedNodes(e,t,i,o);var d=this.filterSourceByMonitoredDominating(i,o,s,n);return this.addMergedNodes(e,t,d.sourceIds,d.allDominatingIds)}function mergeIndexerAddMergedNodes(e,t,i,r){return e.isMaxGroup||(r=this.addMergedOperatorNodes(e,t,i,r)),this.addMergedNodesWithoutRaising(e,t,i,r)}function mergeIndexerAddMergedOperatorNodes(e,t,i,r){if(e.isMaxGroup||!e.sourcePathHasOperands())return r;var n=e.getDirectDominatingOperators(i);if(void 0===n)return r;for(var o=[],s=[],a=[],d=0,u=n.pos.length;d<u;++d){var h=n.pos[d];void 0!==r[h]&&(o.push(h),s.push(n.operators[d]),a.push(r[h]))}if(0==o.length)return r;a=this.addMergedOperatorNodes(e,t,s,a);for(var l=this.addMergedNodesWithoutRaising(e,t,s,a),c=[].concat(r),d=0,u=o.length;d<u;++d){var h=o[d];c[h]=l[h]}return c}function mergeIndexerAddMergedNodesWithoutRaising(e,t,i,r){var n;return n=1!=this.numProjs||e.hasIdentityPrefixGroup()?this.isSingleMappingResult()?this.addMergedNodesWithSingleResult(e,t,i,r):t.minGroupPriority==t.maxGroupPriority?this.addMergedNodesWithoutConflicts(e,t,i,r):this.addMergedNodesWithConflicts(e,t,i,r):this.addMergedNodesWithSingleProj(e,t,i,r),void 0===t.parent&&t.priority===-(1/0)&&t.nodes.size>0&&(t.priority=e.priority),n}function mergeIndexerAddMergedNodesWithSingleProj(e,t,i,r){if(void 0===r||e.isIdentityGroup)return this.addNodesAndValues(e,t,i,i,r,!0),i;if(!e.hasSourceDataElements(t))return this.addNodesAndValues(e,t,i,i,r,!1),i;for(var n={d:[],nd:[]},o={d:[],nd:[]},s=0,a=i.length;s<a;++s){var d=i[s],u=r[s];void 0!==d&&void 0!==u&&(d===u?(n.nd.push(d),o.nd.push(u)):(n.d.push(d),o.d.push(u)))}return n.d.length>0&&this.addNodesAndValues(e,t,n.d,n.d,o.d,!0),n.nd.length>0&&this.addNodesAndValues(e,t,n.nd,n.nd,o.nd,!1),i}function mergeIndexerAddMergedNodesWithSingleResult(e,t,i,r){var n;if(e.obligatoryDataElements)return n=e.translateSourceIds(t.pathId,i,r,!1),this.addNodesAndValues(e,t,i,n,r,!0),n;if(void 0===r)return this.addMergedNodesWithSingleProj(e,t,i,r);for(var o=(e.hasSourceOperands(t),{dnt:[],ndnt:[],dt:[],ndt:[]}),s={dnt:[],ndnt:[],dt:[],ndt:[]},a={dnt:[],ndnt:[],dt:[],ndt:[]},n=new Array(i.length),d=0,u=i.length;d<u;++d){var h=i[d];if(void 0!==h){var l=r[d];void 0!==l&&(h!==l?l<h?(o.dnt.push(h),s.dnt.push(h),a.dnt.push(l),n[d]=h):this.dataElements.getSourceId(l)!==h?(o.dt.push(h),a.dt.push(l)):(o.ndt.push(h),s.ndt.push(l),a.ndt.push(l),n[d]=l):(o.ndnt.push(h),s.ndnt.push(h),a.ndnt.push(l),n[d]=h))}}return o.dt.length>0&&(s.dt=e.translateSourceIds(t.pathId,o.dt,a.dt,!1),this.addNodesAndValues(e,t,o.dt,s.dt,a.dt,!0),alignArrays(i,o.dt,a.dt,n)),o.ndt.length>0&&(e.translateSourceIds(t.pathId,o.ndt,a.ndt,!1),this.addNodesAndValues(e,t,o.ndt,s.ndt,a.ndt,!1)),o.dnt.length>0&&this.addNodesAndValues(e,t,o.dnt,s.dnt,a.dnt,!0),o.ndnt.length>0&&this.addNodesAndValues(e,t,o.ndnt,s.ndnt,a.ndnt,!1),n}function mergeIndexerAddMergedNodesWithoutConflicts(e,t,i,r){if(void 0===r){var n=this.addMergedNodesWithSingleProj(e,t,i,r);return this.convertToMultiResultFormat(n)}for(var o=[],s=[],a=0,d=i.length;a<d;++a){var u=i[a],h=r[a];if(void 0!==u&&void 0!==h&&0!==h.length)for(var l=0,c=h.length;l<c;++l)o.push(u),s.push(h[l])}for(var n=this.addMergedNodesWithSingleResult(e,t,o,s),p=new Array(i.length),f=0,a=0,d=i.length;a<d;++a){var u=i[a],h=r[a],v=p[a]=[];if(void 0!==u&&void 0!==h&&0!==h.length)for(var l=0,c=h.length;l<c;++l)v.push(n[f]),f++}return p}function mergeIndexerAddMergedNodesWithConflicts(e,t,i,r){var n=e.priority;if(void 0===r)return this.addMergedNodesUndominatedWithConflicts(e,t,i);for(var o,s,a={map:[],unmap:[]},d={map:[],unmap:[]},u=[],h=t.dominatedPriorities,l=0,c=!1,p=0,f=i.length;p<f;++p){var v=i[p];if(void 0!==v){var g=r[p];if(void 0!==g&&0!==g.length)for(var m=0,y=g.length;m<y;++m,++l){l!==p&&(c=!0);var I,b=g[m];if(h.size>0&&h.has(b))I=h.get(b);else if(t.nodes.has(b))if(void 0!==t.operators&&t.operators.has(b))I=-(1/0);else{var C=this.dataElements.getGroupId(b);s!==C&&(o=this.groupById[C]),I=o.priority}else I=-(1/0);I>n?(d.unmap[l]=v,a.unmap[l]=b):(d.map[l]=v,a.map[l]=b,I<n&&I>-(1/0)&&u.push(b))}}}u.length>0&&this.makeNodesUnderDominatingUnmapped(t,u);var S;d.map.length>0&&(S=this.addMergedNodesWithSingleResult(e,t,d.map,a.map));var R;return d.unmap.length>0&&(R=this.mergeNodesAsUnmapped(e,t,d.unmap,a.unmap)),S=mergeArraysOfArrays(S,R),void 0===S?[]:c?this.unflattenTargetArray(i,r,S):S}function mergeIndexerAddMergedNodesUndominatedWithConflicts(e,t,i){var r=e.priority;if(t.priority>r)return this.mergeNodesAsUnmapped(e,t,i);if(t.priority<r){var n=[];t.nodes.forEach(function(e,t){n.push(t)}),this.makeNodesUnmapped(t,n,void 0)}var n=this.addMergedNodesWithSingleResult(e,t,i,void 0);return t.priority=r,this.convertToMultiResultFormat(n)}function mergeIndexerConvertToMultiResultFormat(e){for(var t=0,i=e.length;t<i;++t){var r=tagetIds[t];void 0===r?e[t]=[]:e[t]=[r]}return e}function mergeIndexerUnflattenTargetArray(e,t,i){for(var r=[],n=0,o=0,s=e.length;o<s;++o){var a=e[o];if(void 0!==a){var d=t[o];if(void 0!==d&&0!==d.length)for(var u=0,h=d.length;u<h;++u,++n){var l=i[n];if(void 0!==l&&0!==l.length){var c=r[o];void 0===c?r[o]=l:r[o]=cconcat(c,l)}}}}return r}function mergeIndexerAddNodesAndValues(e,t,i,r,n,o){(e.isIdentityGroup||void 0===n)&&(o=!0);var s;o&&(s=e.getSourceIdentities(i));var a=e.isIdentityGroup?e.getSourceKeysByIdentity(s):e.getSourceValues(t,i);this.addNodeEntries(e,t,i,r,n,s),this.setNodeValues(e,t,r,a,n,s)}function mergeIndexerAddNodeEntries(e,t,i,r,n,o){var s=e.groupId,a=e.priority;if(this.expectAdditionalNodeNum(t,r.length),void 0===n){this.expectAdditionalDataElementNum(r.length);for(var d=0,u=r.length;d<u;++d){var h=r[d];void 0!==h&&this.addDataElementNode(t,h,void 0,o[d],s,i[d])}}else if(t.parent)if(void 0===o)this.addNonDataElementNodes(t,r);else for(var d=0,u=r.length;d<u;++d){var h=r[d];if(void 0!==h){var l=n[d];if(l===h)this.addNonDataElementNode(t,h);else{if(void 0===l)continue;this.addDataElementNode(t,h,l,o[d],s,i[d]),void 0!==l&&t.dominatedPriorities.set(l,a)}}}else{this.expectAdditionalDataElementNum(r.length);for(var d=0,u=r.length;d<u;++d){var h=r[d];if(void 0!==h){var l=n[d];void 0!==l&&this.addDataElementNode(t,h,l===h?void 0:l,o[d],s,i[d])}}}}function mergeIndexerSetNodeValues(e,t,i,r,n,o){for(var s,a=void 0!==t.nonTerminals,d=0,u=i.length;d<u;++d){var h=i[d];if(void 0!==h&&(void 0===n||void 0!==n[d])){(s=e.isIdentityGroup||r.hasAttrs[d])&&this.setKeyValue(t,h,"attribute",!0),this.setKeyValue(t,h,r.types[d],r.keys[d],!0);var l=!s&&this.isOperatorType(r.types[d]);if(l||s&&a){var c=void 0===n?void 0:n[d],p=o?o[d]:this.dataElements.getBaseIdentity(h);l?this.addNonTerminalOperator(t,c,h,p):this.addNonTerminal(t,c,h,p)}}}}function mergeIndexerUpdateKeys(e,t,i,r){var n=e.targetPathNode,o=e.groupId,s=this.groupById[o],a=this.getAllTargetNodes(s,n,t);if(this.isSingleMappingResult())for(var d=0,u=t.length;d<u;++d)this.setKeyValue(n,a[d],i[d],r[d]);else for(var d=0,u=t.length;d<u;++d){var h=a[d];if(void 0!==h&&h.length>0)for(var l=0,c=h.length;l<c;++l)this.setKeyValue(n,h[l],i[d],r[d])}}function mergeIndexerMergeChildrenUnderMerged(e,t,i,r,n){if(!e.isIdentityGroup&&r&&0!=r.length){if(void 0===n)for(n=!1;t.subTree;){var o=this.filterSourceByMonitoredDominating(i,r,t,n);if(this.mergeChildrenUnderMerged(e,t,o.sourceIds,o.allDominatingIds,n),!(n=!n))return}var s=e.getSourceChildren(i,t,n);if(void 0!==s&&0!=s.length)for(var a=0,d=s.length;a<d;++a){var u=s[a],h=this.pathNodesById[u.targetPathId];void 0===h&&(h=this.getMonitoredTargetPath(e,u.targetPathId));var l,c,p=u.sourceChildIds;if(u.hasDataElements){c=[],l=[];for(var f=0,v=p.length;f<v;++f){var g=p[f];if(void 0!==g)for(var m=0,y=g.length;m<y;++m)l.push(g[m]),c.push(r[f])}}else c=r,l=p;var I=this.addMergedNodes(e,h,l,c);this.mergeChildrenUnderMerged(e,h,l,I,n)}}}function mergeIndexerMergeChildNode(e,t,i,r){t.isMaxGroup?i!=t.targetPathNode?this.mergeChildrenUnderMerged(t,i,[e],[r]):this.mergeExplicitChildNode(e,t,i,r):this.mergeChildOfNonMaxGroup(e,t,i,r,!1)}function mergeIndexerMergeChildOfNonMaxGroup(e,t,i,r,n){for(var o=t.getMaxSourceNodes([e]),s=0,a=o.length;s<a;++s)for(var d=o[s],u=d.group,h=d.maxSourceIds,l=0,c=h.length;l<c;++l)this.mergeExplicitChildNode(h[l],u,i,r,n)}function mergeIndexerMergeExplicitChildNode(e,t,i,r,n){var o=t.groupSequence,s=t.getSourceElements([e],i,n);s.push(r);var a=this.mergeDominationSequence(o,s,!1),d=s[0];void 0!==a&&this.mergeChildrenUnderMerged(t,t.targetPathNode,d,a)}function mergeIndexerRemoveAtMaximalPath(e,t,i,r){for(var n=e[0].removeSourceElements(t,i,r),o=void 0,s=n.length-1;s>=0;--s){var a=e[s],d=a.targetPathNode,u=n[s],h=[];if(o&&o.length>0)for(var l=0,c=u.length;l<c;++l){var p=u[l];void 0!==p&&void 0===o[l]&&h.push(p)}else h=u;this.removeSourceNodes(a,d,h),o=n[s]}}function mergeIndexerRemoveAtExtensionPath(e,t,i,r){r=e.filterDominatedByProj(r,t),0!=r.length&&this.removeSourceNodes(e,i,r)}function mergeIndexerRemoveSourceNodes(e,t,i){this.removeTargetNodesBySource(e,t,i),this.removeUnmappedNodesBySource(e,t,i)}function mergeIndexerGetDominatingByGroup(e,t){var i=e.targetPathNode.parent;if(void 0!==i){var r=e.targetIdentificationId,n=new Array(t.length);if(e.isIdentityGroup&&e.isDominated())for(var o=0,s=t.length;o<s;++o){var a=t[o];if(void 0!==a){var d=e.getParentIdentity(a),u=i.nonTerminals.getNonTerminals(void 0,d,r);n[o]=void 0===u?[]:u}}else for(var o=0,s=t.length;o<s;++o){var a=t[o];if(void 0!==a){var d=e.getSourceIdentity(a),u=i.nonTerminals.getNonTerminals(void 0,d,r);n=void 0===u?[]:u}}return n}}function mergeIndexerGetAllDominatingByMerged(e,t,i){if(1==this.numProjs)return i;var r=this.getAllTargetNodes(e,t,i);if(this.isSingleMappingResult()||void 0===t.unmappedNodes||0==t.unmappedNodes.unmappedNum()||void 0===t.nonTerminals||0==t.nonTerminals.getNum())return r;for(var n=void 0===t.parent,o=0,s=i.length;o<s;++o){var a,d=i[o];if(n){if(!t.unmappedNodes.isUnmapped(d))continue}else{var u=t.unmappedNodes.getDominating(d,e.groupId);if(void 0===u)continue;a=Object.keys(u)}var h=e.getSourceIdentity(d),l=t.nonTerminals.getNonTerminals(a,h,e.targetIdentificationId);l&&(r[o].length?r[o]=cconcat(r[o],l):r[o]=l)}return r}function mergeIndexerFilterSourceByMonitoredDominating(e,t,i,r,n){if(!i.subTree)return r?{sourceIds:[],allDominatingIds:[],filteredPos:[]}:{sourceIds:e,allDominatingIds:t,filteredPos:!0};var o,s=i.nodes,a=[],d=[];if(n&&(o=[]),r=!!r,this.isSingleMappingResult()){for(var u=0,h=t.length;u<h;++u){var l=t[u];void 0!==l&&s.has(l)&&r===this.inSubTree(s.get(l))&&(a.push(l),d.push(e[u]),void 0!==o&&o.push(u))}return{sourceIds:d,allDominatingIds:a,filteredPos:o}}for(var u=0,h=t.length;u<h;++u){var c=t[u];if(void 0!==c){for(var p=[],f=0,v=c.length;f<v;++f){var l=c[f];s.has(l)&&r===this.inSubTree(s.get(l))&&p.push(l)}p.length>0&&(a.push(p),d.push(e[u]),void 0!==o&&o.push(u))}}return{sourceIds:d,allDominatingIds:a,filteredPos:o}}function mergeIndexerFilterMonitoredDominating(e,t,i){if(!t.subTree)return i?[]:e;var r=t.nodes,n=[];i=!!i;for(var o=0,s=e.length;o<s;++o){var a=allDominatingIds[o];a&&r.has(a)&&i===this.inSubTree(r.get(a))&&n.push(a)}return n}function mergeIndexerGetDominatingUnderIdentityNode(e,t){var i,r=e.prefixGroup,n=r.targetPathNode,o=n.parent;if(!n.nonTerminals)return[];if(void 0!==o){var s=r.isDominated()?r.getParentSourceId(t):0;if(!o.nonTerminals)return[];var a=e.getSourceIdentity(s);i=o.nonTerminals.getNonTerminals(void 0,a,e.targetIdentificationId)}var d=e.getSourceIdentity(t);return n.nonTerminals.getNonTerminals(i,d,e.targetIdentificationId)}function mergeIndexerInitNonTerminals(e){if(void 0===e.nonTerminals&&!(0==e.dominatedMinGroups&&e.maxGroupPriority<=e.minGroupPriority)){var t=e.nonTerminals=new PathNonTerminals(this,!!e.parent),i=e.pathId,r=this;e.nodes.forEach(function(e,n){if(e.hasAttrs){r.addToIdentifiedByTarget(n,i);var o=r.dataElements.getEntry(n),s=o.pathId===i?o.parent:n;t.addNonTerminal(s,n,void 0===o.identity?n:o.identity)}})}}function mergeIndexerDestroyNonTerminals(e){void 0!==e.nonTerminals&&(e.dominatedMinGroups>0||e.maxGroupPriority>e.minGroupPriority||(e.nonTerminals=void 0))}function mergeIndexerAddNonTerminal(e,t,i,r){this.addToIdentifiedByTarget(i,e.pathId);var n=e.nonTerminals.addNonTerminal(t,i,r);this.mergeUnderNode(t,e,i,r,!1,n)}function mergeIndexerRemoveNonTerminals(e,t){if(void 0!==e.nonTerminals&&0!=e.nonTerminals.getNum())for(var i=void 0!==e.unmappedNodes&&e.unmappedNodes.unmappedNum()>0,r=0,n=t.length;r<n;++r){var o=t[r];if(void 0!==o){var s=e.nodes.get(o);if(this.isNonTerminal(e,o,s)){this.removeFromIdentifiedByTarget(o,e.pathId);var a=this.dataElements.getEntry(o),d=void 0===a.identity?o:a.identity,u=a.pathId==e.pathId?a.parent:o,h=e.nonTerminals.removeNonTerminal(u,o,d);i&&this.inSubTree(s)&&this.removeUnmappedMappingMonitor(e,u,d,h)}}}}function mergeIndexerIsNonTerminal(e,t,i){return this.hasAttrs(i)}function mergeIndexerGetSimpleValueByIdentity(e){if(!("number"!=typeof e||e>0))return this.qcm.compression.getSimpleValue(-e)}function mergeIndexerGetSourcePathId(e,t){var i;return(i=this.pathNodesById[t].mappingGroups.get(e))!==!0?i.sourcePathId:this.groupById[e].sourcePathId}function mergeIndexerGetDominatingId(e,t){var i=this.dataElements.getEntry(e);return i.pathId==t?i.parent:e}function mergeIndexerGetAllTargetNodes(e,t,i,r){var n=e.hasSourceIdTranslation(),o=[];if(1==this.numProjs||this.isSingleMappingResult())return n?e.getAllTargetIdsAtPath(i,t.pathId,!0,!0):i;o=e.getAllTargetIdsAtPath(i,t.pathId,!1,r);for(var s=t.nodes,a=(e.groupId,0),d=i.length;a<d;++a){var u=i[a];s.has(u)&&(r?o.push(u):o[a].push(u))}return o}function mergeIndexerGetTargetNodeWithDominating(e,t,i,r){var n=t.nodes;if(n.has(i)){if(i==r)return i;var o=this.dataElements.getEntry(i);if(o.pathId==t.pathId&&o.parent==r)return i}if(e.hasSourceIdTranslation())return e.getTargetId(i,t.pathId,r)}function mergeIndexerRemoveDataElementIdsFromGroup(e,t){if(0!=this.numTranslatingGroups(t))for(var i,r,n,o=(t.nodes,t.hasDataElements),s=0,a=e.length;s<a;++s){var d=e[s];if(void 0!==d){var u=this.dataElements.getEntry(d);if(void 0!==u.sourceId&&u.sourceId!=d)if(u.groupId!==i&&(i=u.groupId,r=this.groupById[i],n=r.sourceDataElements),o){var h=u.pathId==t.pathId?u.parent:d;n.removeTargetId(u.sourceId,t.pathId,h)||(r.sourceDataElements=void 0)}else n.removeTargetId(u.sourceId,t.pathId,d)||(r.sourceDataElements=void 0)}}}function mergeIndexerNumTranslatingGroups(e){var t=0,i=this;return e.mappingGroups.forEach(function(e,r){var n=i.groupById[r];void 0===n.sourceDataElements||n.sourceDataElements.isEmpty()||t++}),t}function mergeIndexerGetSourceChildrenOfNonMax(e,t){var i=t.nextGroups;if(void 0===i)return[];var r=[e];t.isIdentityGroup&&(r=this.getSourceNodesOfIdentities(r)),r=t.filterOutOperators(r);for(var n=[],o=0,s=i.length;o<s;++o){var a=i[o],d=a.getSourceNodesDominatedBy(r,t.sourcePathId);d.length>0&&n.push({groupEntry:a,sourceIds:d})}return n}function mergeIndexerMergeNodesAsUnmapped(e,t,i,r){var n=e.getSourceIdentities(i);this.addUnmappedNodes(e,t,i,r,n);var o;void 0!==t.dataElementOperators&&(s=this.mergeUnmappedUnderOperators(e,t,i,r,n));var s;return void 0===t.nonTerminals?o?o:[]:(s=t.nonTerminals.getAllNonTerminals(r,n,e.targetIdentificationId),void 0===s||0===s.length?o?o:[]:(this.addMappingMonitorUnderNonTerminals(e,t,i,s),void 0===o||0===o.length?s:mergeArraysOfArrays(o,s)))}function mergeINdexerMergeUnmappedUnderOperators(e,t,i,r,n){if(void 0===t.dataElementOperators)return[];var o=t.dataElementOperators.getAllNonTerminals(r,n,e.targetIdentificationId);return void 0===o||0===o.length?[]:(this.addMappingMonitorUnderNonTerminals(e,t,i,o),this.addMergedNodes(e,t,i,o))}function mergeIndexerMakeNodesUnmapped(e,t,i){if(e.mappingGroups.size<=2){for(var r,n=new Array(t.length),o=0,s=t.length;o<s;++o){var a=t[o];if(void 0!==a){var d=this.dataElements.getEntry(a);void 0===r&&(r=this.groupById[d.groupId]),n[o]=void 0===d.sourceId?a:d.sourceId}}if(this.removeTargetNodes(t,e),void 0!==r){var u=r.getSourceIdentities(n);this.addUnmappedNodes(r,e,n,i,u)}}else{for(var h,l,c=new Map,o=0,s=t.length;o<s;++o){var a=t[o];if(void 0!==a){var d=this.dataElements.getEntry(a);d.groupId!==h&&(h=d.groupId,c.has(h)?l=c.get(h):(l={sourceIds:[],dominatingIds:i?[]:void 0,groupEntry:this.groupById[h]},c.set(h,l))),l.sourceIds.push(void 0===d.sourceId?a:d.sourceId),void 0!==i&&l.dominatingIds.push(i[o])}}this.removeTargetNodes(t,e);var p=this;c.forEach(function(t,i){var r=t.groupEntry,o=r.getSourceIdentities(n);p.addUnmappedNodes(r,e,t.sourceIds,t.dominatingIds,o)})}}function mergeIndexerMakeNodesUnderDominatingUnmapped(e,t){for(var i=[],r=[],n=e.nodes,o=e.pathId,s=0,a=t.length;s<a;++s){var d=t[s];if(void 0!==d)if(n.has(d))r.push(d),i.push(d);else for(var u=this.getDirectChildDataElements(d,o),h=0,l=u.length;h<l;++h)r.push(d),i.push(u[h])}this.makeNodesUnmapped(e,i,r)}function mergeIndexerAddUnmappedNodes(e,t,i,r,n){t.unmappedNodes||(t.unmappedNodes=new UnmappedNodes);var o=t.unmappedNodes;0==o.unmappedNum()&&this.addToUnmappedByIdentification(t);for(var n=e.getSourceIdentities(i),s=e.groupId,a=e.priority,d=0,u=i.length;d<u;++d){var h=i[d];if(void 0!==h){var l=void 0===r?void 0:r[d];o.addNode(h,s,l,a,n[d])}}}function mergeIndexerRemoveDominatedTargetNodeBySource(e,t,i,r){var n=this.getTargetNodeWithDominating(t,i,e,r);return void 0!==n&&(this.removeTargetNodes(i,[n]),i.unmappedNodes&&i.unmappedNodes.unmappedNum()>0&&this.makeUnmappedIntoMapped(i,n,r),!0)}function mergeIndexerRemoveTargetNodesBySource(e,t,i){var r=this.getAllTargetNodes(e,t,i,!0);if(this.isSingleMappingResult())return void this.removeTargetNodes(t,r);var n=!!t.unmappedNodes&&t.unmappedNodes.unmappedNum()>0;if(n){var o,s=this.qcm.getPrefix(t.pathId);if(void 0!==s&&(o=this.raiseAllToPath(r,s,t.pathId)),this.removeTargetNodes(t,r),void 0===o)this.makeUnmappedIntoMapped(t,void 0,void 0);else for(var a=0,d=r.length;a<d;++a)this.makeUnmappedIntoMapped(t,r[a],o[a])}else this.removeTargetNodes(t,r)}function mergeIndexerMakeUnmappedIntoMapped(e,t,i){if(e.unmappedNodes.hasUnmapped(i)&&!(void 0===i&&0==e.nodes.size||t!=i&&this.dataElements.hasDirectChildDataElements(i,e.pathId))){var r=e.unmappedNodes.getHighestPriority(i);if(r)for(var n in r){var o=this.groupById[n];for(var s in r[n].nodes)this.mergeChildNode(s,o,e,[i])}}}function mergeIndexerRemoveTargetNodes(e,t){this.removeChildrenUnderMappedNodes(e,t),this.removeMappedNodeEntries(e,t)}function mergeIndexerRemoveChildrenUnderMappedNodes(e,t){var i=this.getAllDirectOperandsFlat(t,e.pathId);void 0!==i&&(this.removeTargetNodes(e,i),this.removeUnmappedNodesByDominating(e,t));for(var r in e.children){var n=e.children[r],o=this.getAllDirectChildrenFlat(t,n.pathId,!0);void 0!==o&&(this.removeTargetNodes(n,o),this.removeUnmappedNodesByDominating(n,t))}}function mergeIndexerRemoveMappedNodeEntries(e,t){if(this.removeDataElementIdsFromGroup(t,e),this.removeNonTerminals(e,t),this.removeNonTerminalOperators(e,t),this.removeNodes(e,t),void 0===e.parent&&0==e.nodes.size&&(e.priority=-(1/0)),void 0!==e.dominatedPriorities&&0!=e.dominatedPriorities.size)for(var i=0,r=t.length;i<r;++i){var n=t[i];if(void 0!==n){var o=this.dataElements.getEntry(n);if(o.pathId==e.pathId){var s=o.parent;void 0===s||this.hasDirectChildDataElements(s,e.pathId)||e.dominatedPriorities.delete(s)}}}}function mergeIndexerRemoveUnmappedNodesBySource(e,t,i){if(void 0!==t.unmappedNodes&&0!=t.unmappedNodes.getNum())for(var r=0,n=i.length;r<n;++r){var o=i[r],s=t.unmappedNodes.removeBySource(o,e.groupId,e.priority);if(void 0!==s&&(this.removeChildrenOfUnmappedUnderAll(t,e,o,s.dominatingIds,s.identity),this.removeMappingMonitor(e,t,o,void 0),0==t.unmappedNodes.getNum())){this.removeFromUnmappedByIdentification(t);break}}}function mergeIndexerRemoveUnmappedNodesByDominating(e,t){var i;if(void 0!==e.unmappedNodes&&0!=e.unmappedNodes.getNum())for(var r=0,n=t.length;r<n;++r){var o=t[r];if(void 0!==o&&e.unmappedNodes.hasUnmapped(o)&&(i=e.unmappedNodes.getByDominating(o))&&(e.unmappedNodes.removeByDominating(o),0==e.unmappedNodes.getNum()&&(this.removeFromUnmappedByIdentification(e),r=n-1),e.subTree))for(var s=0,a=i.byPriority;s<a;++s){var d=i.byPriority[s];for(var u in d.groups){var h=d.groups[u].nodes,l=this.groupById[u];this.removeUnmappedMappingMonitorByDominating(e,l,o,h)}}}}function mergeIndexerRemoveChildrenOfUnmappedByIdentity(e,t,i,r,n,o){if(void 0!==e.unmappedNodes){var s=e.unmappedNodes.getByIdentity(r,i);if(s)for(var a in s.groups){var d=this.groupById[a];if(d.targetIdentificationId==n||o&&d.targetIdentificationId in o)for(var u in s.groups[a].nodes)this.removeChildrenOfUnmapped(e,d,u,[t])}}}function mergeIndexerRemoveChildrenOfUnmappedUnderAll(e,t,i,r,n){var o=e.nonTerminals.getNonTerminals(r,n,t.targetIdentificationId);o&&this.removeChildrenOfUnmapped(e,t,i,o)}function mergeIndexerRemoveChildrenOfUnmapped(e,t,i,r){t.isMaxGroup?this.removeChildrenOfUnmappedAtMax(e,t,i,r):this.removeChildrenOfUnmappedAtNonMax(e,t,i,r)}function mergeIndexerRemoveChildrenOfUnmappedAtNonMax(e,t,i,r){var n=this.getSourceChildrenOfNonMax(i,t);if(n.length)for(var o=0,s=n.length;o<s;++o)for(var a=n[o],d=a.groupEntry,u=d.targetPathNode,h=0,l=a.sourceIds.length;h<l;++h)for(var c=a.sourceIds[h],p=0,f=r.length;p<f;++p){r[p];this.removeDominatedTargetNodeBySource(c,d,u,r[p])}}function mergeIndexerRemoveChildrenOfUnmappedAtMax(e,t,i,r){for(var n,o=!1,s=!1,a=0,d=r.length;a<d;++a){var u=r[a];if(e.subTree&&this.inSubTree(e.nodes.get(u))){if(void 0===s&&(s=t.getSourceChildren([i],e,!0),!s.length))return;n=s,this.removeMappingMonitor(t,e,i,1)}else{if(void 0===o&&(o=t.getSourceChildren(i,e,!1),!e.subTree))return;if(0==o.length)continue;n=o}for(var h=0,l=n.length;h<l;++h)for(var c=n[h],e=this.pathNodesById[c.targetPathId],p=0,f=c.sourceChildIds.length;p<f;++p){var v=c.sourceChildIds[p];this.removeDominatedTargetNodeBySource(v,t,e,u)}}}function mergeIndexerRemoveUnmappedOperandsByIdentity(e,t,i,r,n,o){if(void 0!==e.unmappedNodes){var s=e.unmappedNodes.getByIdentity(r,i);if(s){var a=this.inSubTree(e.nodes.get(t));for(var d in s.groups){var u=this.groupById[d];if(u.targetIdentificationId==n||o&&u.targetIdentificationId in o)for(var h in s.groups[d].nodes)this.removeDominatedTargetNodeBySource(h,u,e,t)||e.unmappedNodes.removeSingleEntry(t,h,u.groupId,u.priority),a&&u.isMaxGroup&&this.removeMappingMonitor(u,e,h,1)}}}}function mergeIndexerMergeUnderNode(e,t,i,r,n,o){if(e||(e=0),o)for(var s=0,a=o.length;s<a;++s){var d=o[s];this.mergeUnderIdentity(e,t,i,n,d.identity,d.identificationId)}this.mergeUnderIdentity(e,t,i,n,r,void 0)}function mergeIndexerMergeUnderIdentity(e,t,i,r,n,o){r?this.mergeOperandsUnderIdentity(e,t,i,n,o):this.mergeChildrenUnderIdentity(e,t,i,n,o)}function mergeIndexerMergeOperandsUnderIdentity(e,t,i,r,n){var o;if(t.unmappedNodes&&(o=t.unmappedNodes.getByIdentity(r,e)))for(var s in o.groups){var a=this.groupById[s];if(n==a.targetIdentificationId){var d=!!t.subTree&&a.isMaxGroup&&this.inSubTree(t.nodes.get(i)),u=o.groups[s].nodes;for(var h in u)this.mergeChildNode(h,a,t,[i]),d&&this.addMappingMonitor(a,t,h,1)}}}function mergeIndexerMergeChildrenUnderIdentity(e,t,i,r,n){this.mergeChildrenFromMinSourcePath(t,i,r,n),this.mergeChildrenOfMatchingUnmapped(e,t,i,r,n)}function mergeIndexerMergeChildrenFromMinSourcePath(e,t,i,r){var n,o=this.inSubTree(e.nodes.get(t));if(e.childrenByIdentity&&(n=e.childrenByIdentity.getChildren(i)))for(var s in n.groups){var a=this.groupById[s];if(a.targetIdentificationId==r&&(a.targetPathNode.trace||o))for(var d in n.groups[s].nodes)this.mergeChildNode(d,a,a.targetPathNode,[t])}}function mergeIndexerMergeChildrenOfMatchingUnmapped(e,t,i,r,n){var o;if(t.unmappedNodes&&(o=t.unmappedNodes.getByIdentity(r,e)))for(var s in o.groups){
var a=this.groupById[s];if(a.targetIdentificationId==n)for(var d in o.groups[s].nodes)this.mergeChildrenOfUnmapped(a,t,d,[i])}}function mergeIndexerMergeChildrenOfUnmapped(e,t,i,r){if(!e.isMaxGroup)return void this.mergeChildOfNonMaxGroup(i,e,t,r,!0);if(t.subTree){for(var n=t.nodes,o=0,s=0,a=r.length;s<a;++s)this.inSubTree(n.get(r[s]))&&o++;o>0&&this.addMappingMonitor(e,t,i,o)}this.mergeChildrenUnderMerged(e,t,[i],[r])}function mergeIndexerIsNonTerminalOperator(e,t){return void 0!==e.operators&&e.operators.size>0&&e.operators.has(t)}function mergeIndexerAddNonTerminalOperator(e,t,i,r){if(void 0===e.operators)e.operators=new Map;else if(e.operators.has(i))return;e.operators.set(i,!0),i!=t&&this.addDataElementOperator(e,t,i,r)}function mergeIndexerRemoveNonTerminalOperators(e,t){if(void 0!==e.operators&&0!=e.operators.size)for(var i=e.operators,r=void 0!==e.dataElementOperators&&e.dataElementOperators.getNum()>0,n=0,o=t.length;n<o;++n){var s=t[n];if(void 0!==s&&i.has(s)){if(r){var a=this.dataElements.getEntry(s);a.pathId==e.pathId&&this.removeDataElementOperator(e,a.parent,s)}i.delete(s)}}}function mergeIndexerAddDataElementOperator(e,t,i,r){if(this.addToIdentifiedByTarget(i,e.pathId),!e.dataElementOperators){e.dataElementOperators=new PathNonTerminals(this,!e.parent);var n=this;e.mappingGroups.forEach(function(t,i){var r=n.groupById[i].targetIdentificationId;void 0!==r&&e.dataElementOperators.addAdditionalIdentification(r)})}var o=e.dataElementOperators.addNonTerminal(t,i,r);this.mergeUnderNode(t,e,i,r,!0,o)}function mergeIndexerRemoveDataElementOperator(e,t,i){this.removeFromIdentifiedByTarget(i,e.pathId);var r=this.dataElements.getBaseIdentity(i),n=e.dataElementOperators.removeNonTerminal(t,i,r);if(0==e.dataElementOperators.getNum()&&(e.dataElementOperators=void 0),e.unmappedNodes&&e.unmappedNodes.unmappedNum()){var o=e.nodes.get(i);this.inSubTree(o)&&this.removeUnmappedMappingMonitor(e,t,r,n)}}function mergeIndexerAddGroupToGroupBySourceIdentification(e){void 0===this.groupBySourceIdentification&&(this.groupBySourceIdentification=new Map);var t=e.sourceIdentificationId;void 0===t&&(t=0);var i;this.groupBySourceIdentification.has(t)?i=this.groupBySourceIdentification.get(t):(i=new Map,this.groupBySourceIdentification.set(t,i)),i.set(e.groupId,e)}function mergeIndexerRemoveGroupFromGroupBySourceIdentification(e){var t=e.sourceIdentificationId;void 0===t&&(t=0);var i=this.groupBySourceIdentification.get(t);void 0!==i&&(i.delete(e.groupId),0==i.size&&this.groupBySourceIdentification.delete(t))}function mergeIndexerAddToUnmappedByIdentification(e,t){void 0===this.unmappedByIdentification&&(this.unmappedByIdentification=new Map);var i=e.pathId;if(void 0!==t){var r=t.sourceIdentificationId;void 0===r&&(r=0);var n;return this.unmappedByIdentification.has(r)?n=this.unmappedByIdentification.get(r):(n=new Map,this.unmappedByIdentification.set(r,n)),void(n.has(i)?n.set(i,n.get(i)+1):n.set(i,1))}var o=this;pathNode.mappingGroups.forEach(function(t,i){o.addToUnmappedByIdentification(e,o.groupById[i])})}function mergeIndexerRemoveFromUnmappedByIdentification(e,t){var i=e.pathId;if(void 0!==t){var r=t.sourceIdentificationId;void 0===r&&(r=0);var n=this.unmappedByIdentification.get(r),o=n.get(i)-1;return void(0==o?1==n.size?this.unmappedByIdentification.delete(r):n.delete(i):n.set(i,o))}var s=this;pathNode.mappingGroups.forEach(function(t,i){s.removeFromUnmappedByIdentification(e,s.groupById[i])})}function mergeIndexerChangeUnmappedByIdentification(e,t,i){if(t!==i&&void 0!==this.unmappedByIdentification&&this.unmappedByIdentification.has(t)){var r,n=this.unmappedByIdentification.get(t);n.forEach(function(t,o){var s=this.pathNodesById[o];s.mappingGroups.has(e.groupId)&&(0==--t?n.delete(o):n.set(o,t),void 0===r&&(this.unmappedByIdentification.has(i)?r=this.unmappedByIdentification.get(i):(r=new Map,this.unmappedByIdentification.get(i,r))),r.has(o)?r.set(o,r.get(o)+1):r.set(o,1))}),0==n.size&&this.unmappedByIdentification.delete(t)}}function mergeIndexerUpdateSourceIdentity(e,t,i,r){this.updateMappedTargetIdentity(e,t,i,r),this.updateIdentityNodeIdentity(e,t,i,r),this.updateUnmappedSourceIdentity(e,t,i,r),this.updateUndominatedSourceIdentity(e,t,i,r)}function mergeIndexerUpdateMappedTargetIdentity(e,t,i,r){for(var n,o,s=!1,a=0,d=t.length;a<d;++a){var u=t[a];if(this.dataElements.hasEntry(u)){var h=i[a],l=this.dataElements.getEntry(u),c=void 0===l.identity?u:l.identity;c!=h&&(n!==l.groupId&&(n=l.groupId,o=this.groupById[n],s=e!=o.sourceIndexer||r!=o.sourceIdentificationId),s||this.setBaseIdentityForExistingNode(u,h))}}this.updateMappedIdTargetIdentity(e,t,i,r)}function mergeIndexerUpdateMappedIdTargetIdentity(e,t,i,r){var n=[];if(void 0!==this.groupBySourceIdentification&&this.groupBySourceIdentification.has(r)){var o=this.groupBySourceIdentification.get(r);if(o.forEach(function(t,i){void 0!==t.sourceDataElements&&t.sourceIndexer==e&&n.push(t)}),0!=n.length)for(var s=0,a=n.length;s<a;++s)for(var d=n[s],u=0,h=t.length;u<h;++u)for(var l=t[u],c=d.sourceDataElements.getAllocatedTargetIds(l),p=i[u],f=0,v=c.length;f<v;++f)this.setBaseIdentityForExistingNode(c[f],p)}}function mergeIndexerUpdateIdentityNodeIdentity(e,t,i,r){if(void 0!==this.identityGroupByIdentification&&this.identityGroupByIdentification.has(r)){var n=this.identityGroupByIdentification.get(r),o=this;n.forEach(function(r,n){if(r.sourceIndexer===e){var s=r.updateIdentity(t,i),a=r.targetPathNode;if(s.added&&s.added.length>0)if(void 0===a.parent)for(var d=0,u=s.added.length;d<u;++d){var h=s.added[d].idNodeId;o.mergeChildNode(h,r,a,1==o.mappings.size?void 0:[void 0])}else if(a.parent.nonTerminals.getNum()>0)for(var l=a.parent,d=0,u=s.added.length;d<u;++d){var c=s.added[d];dominatingNodeIds=l.nonTerminals.getNonTerminals(void 0,c.parentIdentity,r.targetIdentificationId),o.mergeChildNode(c.idNodeId,r,a,dominatingNodeIds)}s.removed&&s.removed.length>0&&o.removeSourceNodes(r,a,s.removed)}})}}function mergeIndexerUpdateUnmappedSourceIdentity(e,t,i,r){if(void 0!==this.unmappedByIdentification&&this.unmappedByIdentification.has(r)){var n=this.unmappedByIdentification.get(r),o=this;n.forEach(function(n,s){for(var a=o.pathNodesById[s],d=!!a.nonTerminals&&a.nonTerminals.getNum()>0,u=!!a.dataElementOperators,h=0,l=t.length;h<l;++h)o.updateUnmappedSourceIdentityAtPath(a,e,t[h],i[h],r,d,u)})}}function mergeIndexerUpdateUnmappedSourceIdentityAtPath(e,t,i,r,n,o,s){var a=e.unmappedNodes.updateIdentity(i,r,this.groupById,t,n);if(void 0!==a&&0!=a.length&&(o||s))for(var d=0,u=a.length;d<u;++d){var h=a[d],l=this.groupById[h.groupId];if(o){this.removeChildrenOfUnmappedUnderAll(pathNode,l,i,h.dominatingIds,h.oldIdentity);var c=pathNode.nonTerminals.getNonTerminals(h.dominatingIds,r,l.targetIdentificationId);this.mergeChildrenOfUnmapped(l,pathNode,i,c)}s&&this.remergeAsOperandAfterIdentityChange(pathNode,i,h.dominatingIds,h.oldIdentity,r,l)}}function mergeIndexerRemergeAsOperandAfterIdentityChange(e,t,i,r,n,o){if(e.dataElementOperators){for(var s=e.dataElementOperators.getNonTerminals(i,r,o.targetIdentificationId),a=0,d=s.length;a<d;++a)this.removeDominatedTargetNodeBySource(t,o,e,s[a])||e.unmappedNodes.removeSingleEntry(s[a],t,o.groupId,o.priority);if(e.subTree&&o.isMaxGroup){for(var u=0,a=0,d=s.length;a<d;++a)this.inSubTree(e.nodes.get(s[a]))&&u++;u&&this.removeMappingMonitor(o,e,t,u)}var h=e.dataElementOperators.getNonTerminals(i,n,o.targetIdentificationId);this.mergeChildNode(t,o,e,h),this.addMappingMonitorUnderNonTerminals(o,e,[t],[h])}}function mergeIndexerUpdateUndominatedSourceIdentity(e,t,i,r){var n=[],o=[];void 0!==this.identityGroupByIdentification&&this.identityGroupByIdentification.has(r)&&o.push(this.identityGroupByIdentification.get(r)),void 0!==this.groupBySourceIdentification&&this.groupBySourceIdentification.has(r)&&o.push(this.groupBySourceIdentification.get(r));for(var s=0;s<o.length;++s)o[s].forEach(function(t,i){void 0===t.prefixGroup&&t.sourceIndexer===e&&t.sourceIdentificationId===r&&void 0!==t.targetPathNode.parent&&void 0!==t.targetPathNode.parent.childrenByIdentity&&n.push(t.targetPathNode.parent)});for(var s=0,a=n.length;s<a;++s)this.updateUndominatedSourceIdentityAtPath(n[s],e,t,i,r)}function mergeIndexerUpdateUndominatedSourceIdentityAtPath(e,t,i,r,n){for(var o=0,s=i.length;o<s;++o){var a=i[o],d=r[o],u=e.childrenByIdentity.updateIdentity(a,d,this.groupById,t,n);if(0==u.length)return;for(var h={},l=0,c=u.length;l<c;++l){var p,f=u[l],v=this.groupById[f.groupId];f.groupId in h?p=h[f.groupId]:void 0!==v.prefixGroup?(p=this.getDominatingUnderIdentityNode(v,a),v.prefixGroup.isDominated()||(h[f.groupId]=p)):p=h[f.groupId]=e.nonTerminals.getNonTerminals(void 0,d,v.targetIdentificationId),this.removeSourceNodes(v,v.targetPathNode,[f.childId]),void 0!==p&&p.length&&this.mergeChildNode(f.childId,v,v.targetPathNode,p)}}}function mergeIndexerAddToIdentifiedByTarget(e,t){var i;this.identifiedByTarget.has(e)?i=this.identifiedByTarget.get(e):(i=new Map,this.identifiedByTarget.set(e,i)),i.set(t,!0)}function mergeIndexerRemoveFromIdentifiedByTarget(e,t){var i;(i=this.identifiedByTarget.get(e))&&i.has(t)&&(1==i.size?this.identifiedByTarget.delete(e):i.delete(t))}function mergeIndexerRequiresTargetIdentification(e,t){return this.identifiedByTarget.size>0}function mergeIndexerUpdateTargetIdentities(e,t,i){if(0!=this.identifiedByTarget.size)for(var r=0,n=e.length;r<n;++r){var o=e[r];this.identifiedByTarget.has(o)&&this.updateTargetIdentity(o,t[r],i)}}function mergeIndexerUpdateTargetIdentity(e,t,i){var r=this.identifiedByTarget.get(e);if(void 0!==r){var n=this;r.forEach(function(r,o){var s,a=n.pathNodesById[o];if(void 0===i||void 0!==a.nonTerminals&&(s=a.nonTerminals.getAdditionalIdentifications())&&s.has(i)){var d=n.isNonTerminalOperator(e);if(!d||a.dataElementOperators){var u=n.getDominatingId(e,o),h=this.getIdentity(e,i);d?(a.dataElementOperators.updateIdentity(e,u,h,t,i),n.removeUnmappedOperandsByIdentity(a,e,u,h,i,additional)):(a.nonTerminals.updateIdentity(e,u,h,t,i),n.removeChildrenOfUnmappedByIdentity(a,e,u,h,i,additional)),n.mergeUnderIdentity(u,a,e,d,t,i)}}})}}function mergeIndexerGetDominatedComparisonAtPath(e){var t=this.pathNodesById[e];if(void 0!==t){var i=t.mappingGroups;if(void 0!==i&&0!==i.size){var r=[];i.forEach(function(e,t){r.push(t)}),r.sort();for(var n=0,o=r.length;n<o;++n){var s=this.groupById[r[n]],a=s.getDominatedComparison();if(void 0===a)return;if(!s.isIdentityGroup)var d=this.getElementTranslation();return void 0!==d&&a.unshiftTranslation(d),a}}}}function mergeIndexerAddOrderStarFuncAtPath(e,t){var i=this.pathNodesById[t];if(void 0!==i&&(void 0===i.composedOrderStar&&(i.composedOrderStar=new Map),!i.composedOrderStar.has(e.getId()))){i.composedOrderStar.set(e.getId(),e);var r=i.mappingGroups;if(void 0!==r&&0!==r.size){var n=this;r.forEach(function(t,i){var r=n.groupById[i];void 0!==r&&r.addOrderStarFunc(e)})}}}function mergeIndexerRemoveOrderStarFuncAtPath(e,t){var i=this.pathNodesById[t];if(void 0!==i&&void 0!==i.composedOrderStar&&i.composedOrderStar.has(e)){i.composedOrderStar.delete(e);var r=i.mappingGroups;if(void 0!==r&&0!==r.size){var n=this;r.forEach(function(t,i){var r=n.groupById[i];void 0!==r&&r.removeOrderStarFunc(e)})}}}function mergeIndexerGetElementTranslation(){var e=!1;for(var t in this.groupById){var i=this.groupById[t];if(void 0!==i.sourceDataElements){e=!0;break}}return e?new MergeIndexerElementIdTranslation(this):void 0}function MergeIndexerElementIdTranslation(e){this.mergeIndexer=e,this.dataElements=e.dataElements}function mergeIndexerElementIdTranslationGet(e){var t=this.dataElements.getEntry(e);return void 0===t||void 0===t.sourceId?e:t.sourceId}function QueryResultQueryCalc(e){this.id=InternalQCM.newId(),this.result=e,this.pathId=e.qcm.getRootPathId(),this.result.resultIndexer&&this.result.resultIndexer.addQueryCalcToPathNode(this)}function queryResultQueryCalcDestroy(){this.result.resultIndexer&&this.result.resultIndexer.removeQueryCalcFromPathNode(this)}function queryResultQueryCalcGetId(){return this.id}function queryResultQueryCalcIsSelection(){return!1}function queryResultQueryCalcAddMatches(e){this.result.forwardResultIndexerAddMatches(e)}function queryResultQueryCalcRemoveMatches(e){this.result.forwardResultIndexerRemoveMatches(e)}function queryResultQueryCalcRemoveAllIndexerMatches(){var e=this.result.resultIndexer.getAllMatches(this.pathId);this.removeMatches(e)}function InternalQueryResult(e,t){this.FuncResult(e),void 0!==debugAllQueryResults&&(debugAllQueryResults[this.id]=this),this.isPureProjection=!1,this.assumeNonZeroDomMatchCount=!!t,this.matchCount=0,this.projMatchCount=0}function internalQueryResultDestroy(){this.FuncResult_destroy(),this.resultIndexer&&this.destroyResultIndexer(),this.rootQueryCalc&&this.qcm.releaseRootQueryCalc(this,this.rootQueryCalc),void 0!==debugAllQueryResults&&delete debugAllQueryResults[this.id],this.doDebugging&&this.debugMessage("destroying query result ",this.getId())}function internalQueryResultGetIndexer(){return this.getIndexerByRoot(this.rootQueryCalc)}function internalQueryResultGetIndexerByRoot(e){return e?e.getIndexer():this.dataObj?this.dataObj.getDominatedIndexer():void 0}function internalQueryResultGetPrefixProjPathId(){return this.rootQueryCalc?this.rootQueryCalc.prefixProjPathId:this.qcm.getRootPathId()}function internalQueryResultGetProjectionPathId(){if(this.rootQueryCalc)return this.rootQueryCalc.getProjectionPathId()}function internalQueryResultHasMultipleProjPaths(){return!!this.rootQueryCalc&&this.rootQueryCalc.hasMultipleProjPaths()}function internalQueryResultHasNoSelectionOnIndexer(){return 0==this.matchCount&&this.isPureProjection}function internalQueryResultGetComposedSelectingNum(){return!this.isPureProjection||this.assumeNonZeroDomMatchCount||this.resultIndexer?1:this.composedSelectingNum}function internalQueryResultGetDominatedIndexer(){return this.resultIndexer?this.resultIndexer:this.getIndexer()}function internalQueryResultGetDominatedProjPathId(){return this.resultIndexer?this.qcm.getRootPathId():this.getProjectionPathId()}function internalQueryResultGetDominatedProjPathNum(){return!this.resultIndexer&&this.rootQueryCalc&&this.rootQueryCalc.isProjection()?this.rootQueryCalc.getTerminalGeneratingProjNum():1}function internalQueryResultGetDominatedProjMappings(){if(this.rootQueryCalc){if(this.resultIndexer){var e=new Map;return e.set(0,[this.qcm.getRootPathId(),this.qcm.getRootPathId()]),e}return this.rootQueryCalc.getGeneratingProjMappings()}}function internalQueryResultGetTerminalProjMatches(e){return void 0===this.rootQueryCalc?[]:0==e?this.getSelectionMatches():this.rootQueryCalc.getTerminalProjMatches(this.getId(),e)}function internalQueryResultFilterTerminalProjMatches(e,t){return void 0===this.rootQueryCalc?[]:0==e?this.filterSelectionMatches(t):this.rootQueryCalc.filterTerminalProjMatches(this.getId(),e,t)}function internalQueryResultGetDominatedIdentification(){if(!this.resultIndexer)return this.dataObj?this.dataObj.getDominatedIdentification():void 0}function internalQueryResultGetDominatedComparison(){if(void 0!==this.dataObj){var e=this.dataObj.getDominatedComparison();if(void 0!==e){if(void 0!==this.rootQueryCalc&&this.rootQueryCalc.needToLower()&&e.setNeedToRaise(),!this.resultIndexer)return e;var t=this.resultIndexer.getElementTranslation();return void 0!==t&&e.unshiftTranslation(t),e}}}function internalQueryResultDominatedCount(){return this.matchCount+this.projMatchCount}function internalQueryResultCalcIsActive(){return void 0!==this.query&&void 0!==this.dataObj&&void 0!==this.dataObj.getDominatedIndexer()&&this.composedActiveNum>0&&(this.composedActiveNum>this.composedQueryResultNum||this.query.isProjection()||this.composedQueryResultNum>1)}function internalQueryResultIsActive(){return!!this.dominatedCount()&&!this.pendingRootRefresh}function internalQueryResultRestrictsProjection(){return 0!=this.matchCount||!this.isActive()}function internalQueryResultSetQuery(e){if(this.query!=e&&(this.query=e,this.dataObj&&this.resetRootQueryCalc(!0,!1))){var t=this.rootQueryCalc?this.rootQueryCalc.getGeneratingProjMappings():void 0;if(void 0===t){if(this.refreshMatchCount(!1),this.resetProjProperties(),this.resultIndexer)return void this.setMappingsOnResultIndexer();for(var i in this.composedActive)this.composedActive[i].refreshIndexerAndPaths(this)}else this.updateTerminalProjs(pathMappings),this.addRootQueryCalcMatches(!0);this.pendingAddMatches&&(this.pendingAddMatches=void 0)}}function internalQueryResultResetRootQueryCalc(e,t){var i;if(this.query&&this.dataObj&&this.isActiveStar()){this.pendingRootRefresh=!0;var r=this.dataObj;i=this.qcm.getRootQueryCalc(this,this.query,r.getDominatedIndexer(),r.getDominatedProjPathId()),this.pendingRootRefresh=void 0}else i=void 0;return this.rootQueryCalc!==i&&(this.query&&this.query.unlockActive("InternalQueryResult"),this.rootQueryCalc&&e&&this.clearRootQueryCalcMatches(),this.rootQueryCalc&&this.qcm.releaseRootQueryCalc(this,this.rootQueryCalc),this.rootQueryCalc=i,t&&this.resetProjProperties(),!0)}function internalQueryResultClearRootQueryCalcMatches(){if(this.rootQueryCalc&&this.rootQueryCalc.isSelection()){var e=this.rootQueryCalc.geMatches();this.removeMatches(e,this,1)}else if(this.isActive()&&(!this.hasNoSelectionOnIndexer()||this.hasNonQueryActiveComposed()))for(var t=this.getTerminalGeneratingProjs(),i=0,r=t.length;i<r;++i)this.removeAllTerminalProjMatches(t[i]);this.matches=void 0}function internalQueryResultResetProjProperties(){this.refreshIsPureProjection(),this.rootQueryCalc&&this.rootQueryCalc.isProjection()&&this.requiresExplicitProjMatches()&&this.rootQueryCalc.initExplicitProjMatches(this.getId()),this.refreshProjMustGenerateMatches()}function internalQueryResultRefreshProjProperties(){if(this.refreshIsPureProjection(),void 0!==this.rootQueryCalc&&this.rootQueryCalc.isProjection()){var e=this.requiresExplicitProjMatches();e?(this.rootQueryCalc.setExplicitProjMatches(this.getId()),this.refreshProjMustGenerateMatches()):(this.refreshProjMustGenerateMatches(),this.rootQueryCalc.releaseExplicitProjMatches(this.getId()))}}function internalQueryResultRequiresExplicitProjMatches(e){return void 0===e&&(e=this.rootQueryCalc),!(void 0===e||!e.isProjection())&&(!!e.hasMultipleProjPaths()||!e.isTrivialProjection()&&(!(this.isPureProjection&&!this.restrictsProjection())&&(!!this.resultIndexer||this.useResultIndexer()||this.hasNonQueryActiveComposed())))}function internalQueryResultProjMustGenerateMatches(){return!this.restrictsProjection()&&!!(this.hasNonQueryActiveComposed()||this.resultIndexer||this.useResultIndexer())}function internalQueryResultRefreshProjMustGenerateMatches(){void 0!==this.rootQueryCalc&&this.rootQueryCalc.isProjection()&&this.rootQueryCalc.refreshProjMustGenerateMatches(this.getId(),this.projMustGenerateMatches())}function internalQueryResultRefreshIndexerAndPaths(){if(this.resetRootQueryCalc(!1,!1)){if(this.matches=void 0,this.refreshMatchCount(!1),this.resetProjProperties(),this.resultIndexer){if(this.resultIndexer.clear(),!this.setMappingsOnResultIndexer())return}else for(var e in this.composedActive)this.composedActive[e].refreshIndexerAndPaths(this);this.isActiveStar()&&this.addRootQueryCalcMatches(!1)}}function internalQueryResultRefreshMatchCount(e){var t=this.isActive(),i=this.calcIsActive();if(t&&!i&&this.isActiveStar()&&void 0===this.resultIndexer&&this.addPartialMatchesToComposed(),this.matchCount=0,this.projMatchCount=0,this.calcIsActive()){this.query.isProjection()?this.projMatchCount=1:this.matchCount=1;for(var r=this;(r=r.dataObj)&&(this.matchCount+=r.getDomMatchCount(),r instanceof InternalQueryResult&&!r.isActive());)r.dominating=this;this.dominating=void 0}else{this.dominating=void 0;for(var n in this.composedActive){var o=this.composedActive[n];o.isActive()?this.dominating=o:o.isActiveStar()?this.dominating=o.dominating:this.dominating=o}for(var r=this;(r=r.dataObj)&&r instanceof InternalQueryResult&&!r.isActive();)r.dominating=this.dominating}this.matchCount>1?void 0===this.matches&&(this.matches=new IntHashMapUint(this.matchCount)):this.matches=void 0,e&&(this.refreshProjProperties(),t||!this.isActive()||this.resultIndexer||this.updateMatchesAfterActiveStarBecameActive())}function internalQueryResultSetMatchCount(e){var t=0===e!=(0===this.matchCount);this.matchCount=e,t&&this.refreshProjProperties()}function internalQueryResultSetMappingsOnResultIndexer(){if(!this.resultIndexer)return!0;if(this.resultIndexer.removeAllMappings(),void 0===this.rootQueryCalc)return!1;var e=this.rootQueryCalc.getGeneratingProjMappings();if(void 0===e)return!1;var t=this.getIndexer(),i=this;return e.forEach(function(e,r){i.resultIndexer.addMapping(i,r,t,e,0)}),!0}function internalQueryResultAddRootQueryCalcMatches(e){if(this.rootQueryCalc){if(this.rootQueryCalc.isSelection()){var t=this.getMatchesFromSource(this.rootQueryCalc);return void this.addMatches(t,this.rootQueryCalc,1)}(0==this.matchCount||e)&&this.setProjMatches()}}function internalQueryResultAddReplacedRootQueryCalcMatches(e,t){if(void 0!==this.rootQueryCalc&&this.rootQueryCalc.isSelection()){var i=this.isActive()?this:this.dominating;if(void 0!==i&&void 0!==i.matches)for(var r=e.getAllMatchesAsObj(t),n=this.getMatchesFromSource(this.rootQueryCalc),o=0,s=n.length;o<s;++o){var a=n[o];r.has(a)||i.matches.inc(a,1)}}}function internalQueryResultRemoveReplacedRootQueryCalcMatches(){var e=this.rootQueryCalc.getIndexer(),t=this.rootQueryCalc.prefixProjPathId,i=e.getAllMatchesAsObj(t),r=this;this.matches.forEach(function(e,t){i.has(t)||r.matches.delete(t)})}function internalQueryResultAboutToAttachActiveComposed(e){void 0===this.query||this.isActiveStar()||(this.query.lockActive("InternalQueryResult"),this.qcm.executeScheduled(void 0,!0),this.refreshIsPureProjection())}function internalQueryResultAboutToAddActiveComposed(e,t){this.activeStarPending!==!0&&(void 0!==this.composedRemovalInProgress&&(this.composedActive[this.composedRemovalInProgress.getId()]=this.composedRemovalInProgress),!this.isActive()&&this.calcIsActive()&&this.refreshMatchCount(t),!this.resultIndexer&&this.useResultIndexer()?this.insertResultIndexer():!this.resultIndexer||e instanceof InternalQueryResult||this.composedQueryResultNum+1!=this.composedActiveNum?e instanceof InternalQueryResult||!t||this.refreshProjProperties():this.resultIndexerQueryCalc=new QueryResultQueryCalc(this),void 0!==this.composedRemovalInProgress&&delete this.composedActive[this.composedRemovalInProgress.getId()])}function internalQueryResultActiveComposedFuncRemoved(e){this.calcIsActive()||this.refreshMatchCount(!0),this.resultIndexer&&(this.useResultIndexer()?e instanceof InternalQueryResult||this.composedQueryResultNum!=this.composedActiveNum||void 0===this.resultIndexerQueryCalc||(this.resultIndexerQueryCalc.destroy(),this.resultIndexerQueryCalc=void 0):this.removeResultIndexer())}function internalQueryResultDeactivated(){this.resetRootQueryCalc(!1,!1),this.matchCount=0,this.projMatchCount=0,this.FuncResult_deactivated()}function internalQueryResultBecameActiveStar(){if(this.query&&this.dataObj){this.resetRootQueryCalc(!1,!1),this.refreshMatchCount(!1),this.resetProjProperties(),this.useResultIndexer()&&this.createResultIndexer();for(var e in this.composedActive)this.composedActive[e].refreshIndexerAndPaths(this);var t=this.setMappingsOnResultIndexer(),i=!1;if(this.pendingAddMatches){for(var r=0,n=this.pendingAddMatches.length;r<n;++r){var o=this.pendingAddMatches[r];this.addMatches(o.elementIds,o.source,o.matchCount),o.source==this.rootQueryCalc&&(i=!0)}this.pendingAddMatches=void 0}t&&!i&&this.addRootQueryCalcMatches(!1)}}function internalQueryResultUpdateMatchesAfterActiveStarBecameActive(){this.addDominatedMatchesWithoutForwarding(this),this.removePartialMatchesFromComposed()}function internalQueryResultAddDominatedMatchesWithoutForwarding(e,t){if(!(this.matchCount<=1))for(;e;e=e.dataObj){var i=e==this?1:e.getDomMatchCount();if(0==i)break;var r;if(e!=this||!this.rootQueryCalc||this.rootQueryCalc.isSelection()){if(r=this.getMatchesFromSource(e==this?this.rootQueryCalc:e),this.matches.expectSize(r.length),void 0!==t)for(var n=0,o=r.length;n<o;++n){var s=r[n];this.matches.inc(s,i)===this.matchCount&&t.push(s)}else for(var n=0,o=r.length;n<o;++n)this.matches.inc(r[n],i);if(e!=this&&(e.isActive()||!(e instanceof InternalQueryResult)))break}}}function internalQueryResultRemovePartialMatchesFromComposed(){if(!(this.matchCount<=1)){for(var e=[],t=this.matchCount,i=1;i<t;++i)e[i]=[];this.matches.forEach(function(i,r){i!=t&&e[i].push(r)});for(var i=1;i<t;++i)if(0!=e[i].length)for(var r in this.composedActive)this.composedActive[r].removeMatches(e[i],this,i)}}function internalQueryResultAddPartialMatchesToComposed(){if(!(this.matchCount<=1||void 0===this.matches||0==this.composedActiveNum)){for(var e=[],t=this.matchCount,i=1;i<t;++i)e[i]=[];this.matches.forEach(function(i,r){i!=t&&e[i].push(r)});for(var i=1;i<t;++i)if(0!=e[i].length)for(var r in this.composedActive)this.composedActive[r].addMatches(e[i],this,i)}}function internalQueryResultReplaceIndexerAndPaths(e,t,i,r){this.pendingIndexerReplace=!0;var n,o;if(i===-1&&void 0!==this.rootQueryCalc&&(n=this.rootQueryCalc.getIndexer(),o=this.rootQueryCalc.getProjectionPathId()),this.resetRootQueryCalc(!1,!0),i===-1?this.addReplacedRootQueryCalcMatches(n,o):this.isActive()&&this.matchCount>1&&(void 0===i?(this.matches=new IntHashMapUint(this.matchCount),this.addDominatedMatchesWithoutForwarding(this)):1===i&&this.removeReplacedRootQueryCalcMatches()),this.requiresExplicitProjMatches()&&this.setProjMatches(),this.resultIndexer){var s=this.rootQueryCalc.getGeneratingProjMappings();if(void 0===s)return;this.resultIndexer.replaceFuncSource(this,s,e,t,this.dataObj.getDominatedIndexer())}else for(var a in this.composedActive)this.composedActive[a].replaceIndexerAndPaths(e,t,i,this);this.pendingIndexerReplace=void 0}function internalQueryResultAddCountsUnderRemovedIndexer(e,t){if(0!=t){if(!this.isActive())return void(this.dominating&&this.dominating.addCountsUnderRemovedIndexer(e,t));if(this.matchCount+=t,this.matchCount>1&&(void 0===this.matches?(this.matches=new IntHashMapUint(this.matchCount),this.addDominatedMatchesWithoutForwarding(this)):this.addDominatedMatchesWithoutForwarding(e)),this.refreshProjProperties(),!this.resultIndexer&&this.composedQueryResultNum){if(this.rootQueryCalc&&!this.rootQueryCalc.isSelection()){if(this.matchCount>t||!this.isPureProjection)return;t=1}var i=this.getDominatedMatches();for(var r in this.composedActive){var n=this.composedActive[r];n.increaseMatchCount(t,i,this)}}}}function internalQueryResultRemoveNonResultIndexerMatches(e,t){if(0!=t){if(!this.matchCount)return void(this.dominating&&this.dominating.removeNonResultIndexerMatches(e,t));if(this.setMatchCount(this.matchCount-t),this.matchCount<=1&&(this.matches=void 0),void 0!==this.matches){var i=this;void 0===e||0==e.size?this.matches=new IntHashMapUint(this.matchCount):0==t?this.matches.forEach(function(t,r){e.has(r)||i.matches.delete(r)}):this.matches.forEach(function(r,n){e.has(n)?i.matches.dec(n,t):i.matches.delete(n)})}if(!this.resultIndexer&&this.composedQueryResultNum){if(this.rootQueryCalc&&!this.rootQueryCalc.isSelection()){if(this.matchCount>0||!this.isPureProjection)return;t=1}var r=this.getDominatedMatches();for(var n in this.composedActive){var o=this.composedActive[n];o instanceof InternalQueryResult&&o.decreaseMatchCount(t,r,this,!1)}}}}function internalQueryResultAboutToSetData(e){this.isActiveStar()&&(this.qcm.executeScheduled(void 0,!0),this.isActive()?this.pendingSetData=!0:this.dominating&&this.dominating.aboutToSetData(e))}function internalQueryResultSetDataCompleted(){this.isActive()?(this.pendingSetData=void 0,this.pendingAddMatches=void 0):this.dominating&&this.dominating.setDataCompleted()}function internalQueryResultRemoveDataObjMatches(e,t){if(!t){if(!this.dataObj||!e)return void this.setDataCompleted();var i=this.isActive()?this:this.dominating;i&&(i===this&&(this.resultIndexer?this.useResultIndexer(e)||this.removeResultIndexer():this.useResultIndexer(e)&&this.insertResultIndexer()),0==this.dataObj.getDomMatchCount()?i.reduceMatchesByInsertedQueries(e,this.dataObj):0==e.getDomMatchCount()?i.removeRestrictionsOfRemovedQueries(e,this.dataObj):i.replaceDataObjMatches(this.dataObj,e),this.setDataCompleted())}}function internalQueryResultAddDataObjMatches(e,t){if(!t)return void this.setDataCompleted();var i=this.isActive()?this:this.dominating;if(i){i.pendingSetData&&(i.pendingSetData=void 0);var r=this.dataObj.getDomMatchCount();if(r>0&&i.addMatches(i.getMatchesFromSource(this.dataObj),this.dataObj,r),i.pendingAddMatches){for(var n=0,o=i.pendingAddMatches.length;n<o;++n){var s=i.pendingAddMatches[n];i.addMatches(s.elementIds,s.source,s.matchCount)}i.pendingAddMatches=void 0}}}function internalQueryResultReplaceDataObjMatches(e,t){var i;if(!this.isPureProjection||0!=e.getDomMatchCount()||0!=t.getDomMatchCount()){for(i=t;i;i=i.dataObj){if(i==e)return void this.reduceMatchesByInsertedQueries(t,e);if(!(i instanceof InternalQueryResult&&void 0!==i.rootQueryCalc&&i.rootQueryCalc.isSelection()))break}var r=!1;for(i=e;i;i=i.dataObj){if(i==t){r=!0;break}if(!(i instanceof InternalQueryResult)||void 0===i.rootQueryCalc||!i.rootQueryCalc.isSelection()||i.isActive())break}this.propagateMatchCountDiff(e,t);var n=this.decreaseCountOfReplacedData(e,t,r),o=this.increaseCountOfNewData(t,n,r),s=[];n.forEach(function(e,t){s.push(t)}),this.pushRemovedMatches(s,this,this.matchCount),this.pushNewMatches(o,this,this.matchCount)}}function internalQueryResultPropagateMatchCountDiff(e,t){var i=!this.resultIndexer&&this.rootQueryCalc&&(this.rootQueryCalc.isSelection()||this.isPureProjection);if(i){var r=this.getMatchCountDiff(t,e);if(0!=r){if(this.isPureProjection)if(this.matchCount>0&&this.matchCount+r==0)r=-1;else{if(0!=this.matchCount)return;r=1}var n=this.getDominatedMatches();for(var o in this.composedActive){var s=this.composedActive[o];r>0?s.increaseMatchCount(r,n,this):s.decreaseMatchCount(-r,n,this,!1)}}}}function internalQueryResultDecreaseMatchCount(e,t,i,r){if(0!=e)if(this.isActive()){var n=!this.resultIndexer&&this.rootQueryCalc&&(this.rootQueryCalc.isSelection()||this.isPureProjection&&this.matchCount==e);if(this.setMatchCount(this.matchCount-e),n){var o,s=t.length,a=void 0!==this.rootQueryCalc&&this.rootQueryCalc.isProjection();if(a){var d=this.rootQueryCalc.getSingleGeneratingProj();o=d.getExplicitProjMatches(this.getId())}if(this.matches)if(this.matchCount<=1&&!r){if(!a||void 0===o){o=[];for(var u=0,h=t.length;u<h;++u){var l=t[u],c=this.matches.get(l)-e;c==this.matchCount&&o.push(l)}a&&(o=this.rootQueryCalc.lowerProjMatches(o))}}else{o=[];for(var u=0,h=t.length;u<h;++u){var l=t[u];this.matches.dec(l,e)==this.matchCount&&o.push(l)}}else void 0===o&&(o=this.rootQueryCalc.lowerProjMatches(t));for(var p in this.composedActive){var f=this.composedActive[p];f.decreaseMatchCount(e,o,this,!1)}t.length>s&&(t.length=s)}else if(this.matchCount>1||this.matches&&r)for(var u=0,h=t.length;u<h;++u)this.matches.dec(t[u],e);this.matchCount<=1&&!r&&(this.matches=void 0)}else if(this.dominating)return this.dominating.decreaseMatchCount(e,t,i,!1)}function internalQueryResultGetMatchCountDiff(e,t){for(var i=0,r=e;r&&(i+=r.getDomMatchCount(),r instanceof InternalQueryResult&&!r.isActive());)r=r.dataObj;for(var r=t;r&&(i-=r.getDomMatchCount(),r instanceof InternalQueryResult&&!r.isActive());)r=r.dataObj;return i}function internalQueryResultDecreaseCountOfReplacedData(e,t,i){var r=e,n=new Map;if(void 0===this.matches){for(var o=this.rootQueryCalc.isSelection()?this.rootQueryCalc.getMatches():this.dataObj.getDominatedMatches(),s=0,a=o.length;s<a;++s)n.set(o[s],!0);return this.setMatchCount(this.matchCount-r.getDomMatchCount()),n}var d=i?-this.getMatchCountDiff(t,e):void 0;if(0===d)return n;var u=r.getDomMatchCount();if(void 0!==d&&(u>=d?(u=d,d=0):d-=u),u>0){for(var o=r.getDominatedMatches(),s=0,a=o.length;s<a;++s){var h=o[s];this.matches.dec(h,u)+u===this.matchCount&&n.set(h,!0);
}this.setMatchCount(this.matchCount-u)}for(;0!==d&&r&&!r.isActive()&&r instanceof InternalQueryResult&&(r=r.dataObj,r!==t);){var o=r.getDominatedMatches(),u=r.getDomMatchCount();if(void 0!==d&&(u>=d?(u=d,d=0):d-=u),0==u)break;for(var s=0,a=o.length;s<a;++s)this.matches.dec(o[s],u);this.setMatchCount(this.matchCount-u)}return n}function internalQueryResultIncreaseCountOfNewData(e,t,i){var r=0;if(!i){for(var n=e;n&&(r+=n.getDomMatchCount(),n instanceof InternalQueryResult&&!n.isActive());)n=n.dataObj;if(this.matchCount+=r,this.requiresExplicitProjMatches()&&!this.rootQueryCalc.hasExplicitProjMatches()){var o=this.dataObj.getDominatedMatches();o=this.rootQueryCalc.lowerProjMatches(o),this.rootQueryCalc.initExplicitProjMatches(this.getId(),o),this.refreshProjProperties()}}n=e;var s=[];if(!(0!=r||0!=this.matchCount&&this.matches)){for(var o=this.matchCount>0?this.getMatchesFromSource(this.rootQueryCalc):e.getDominatedMatches(),a=0,d=o.length;a<d;++a){var u=o[a];t.has(u)||s.push(u)}return this.matches=void 0,t.clear(),s}if(0==r){var h=this;return this.matches.forEach(function(e,i){e!=h.matchCount||t.has(i)||s.push(i)}),this.matchCount<=1&&(this.matches=void 0),t.clear(),s}if(this.matchCount<=1){this.matches=void 0;var o=this.getMatchesFromSource(n);if(0==t.size)s=o;else if(i){for(var a=0,d=o.length;a<d;++a){var u=o[a];t.has(u)||s.push(u)}t.clear()}else for(var a=0,d=o.length;a<d;++a){var u=o[a];t.has(u)?t.delete(u):s.push(u)}return s}if(void 0===this.matches)if(this.matchCount>r){this.matches=new IntHashMapUint(this.matchCount,o.length);for(var o=this.rootQueryCalc.isSelection()?this.getMatchesFromSource(this.rootQueryCalc):this.getMatchesFromSource(this.dataObj),a=0,d=o.length;a<d;++a)this.matches.set(o[a],1)}else this.matches=new IntHashMapUint(this.matchCount);for(;n;){var l=n.getDomMatchCount();if(0==l)break;var o=this.getMatchesFromSource(n);this.matches.expectSize(o.length);for(var a=0,d=o.length;a<d;++a){var u=o[a],c=this.matches.inc(u,l);c==this.matchCount&&(0!==t.size&&t.has(u)?i||t.delete(u):s.push(u))}if(!(n instanceof InternalQueryResult)||n.isActive())break;n=n.dataObj}return i&&t.clear(),s}function internalQueryResultGetMatchesFromSource(e){if(void 0===e)return[];var t;if(void 0!==this.pendingAddMatches&&this.pendingAddMatches.length>0)for(var i=0,r=this.pendingAddMatches.length;i<r;++i)if(this.pendingAddMatches[i].source==e){var n=this.pendingAddMatches[i].elementIds;t=t?cconcat(t,n):n,this.pendingAddMatches.splice(i,1),r--,i--}return void 0!==t?t:e==this.rootQueryCalc?this.rootQueryCalc.getMatches():e.getDominatedMatches()}function internalQueryResultGetMatchesFromSourceAsObj(e){var t=this.getMatchesFromSource(e);if(void 0!==t){for(var i=new Map,r=0,n=t.length;r<n;++r)i.set(t[r],1);return i}return new Map}function internalQueryResultGetChainMatchCountDiff(e,t){var i=e instanceof InternalQueryResult?e.getAccumulatedMatchCount():e.getDomMatchCount(),r=t instanceof InternalQueryResult?t.getAccumulatedMatchCount():t.getDomMatchCount();return i-r}function internalQueryResultGetAccumulatedMatchCount(){for(var e=0,t=this;t;){var i=t.getDomMatchCount();if(0==i||!(t instanceof InternalQueryResult)||t.isActive())return e+i;e++,t=t.dataObj}return e}function internalQueryResultGetChainMatches(e,t){if(!(e instanceof InternalQueryResult)||e.isActive())return{fullMatches:this.getMatchesFromSource(e),matchCount:e.getDomMatchCount()};for(var i=new Map,r=[],n=0,o=e;o;){var s=o.getDomMatchCount(),a=void 0;if(o==t||0==s){i.size>0&&(1==n?(i.forEach(function(e,t){r.push(t)}),i.clear()):i.forEach(function(e,t){e<n||(r.push(t),i.delete(t))}));break}if(!(o instanceof InternalQueryResult)||o.isActive()){if(n+=s,a=this.getMatchesFromSource(o),0==i.size)if(s<n)for(var d=0,u=a.length;d<u;++d)i.set(a[d],s);else r=a;else for(var d=0,u=a.length;d<u;++d){var h=a[d];if(i.has(h)){var l=i.get(h)+s;l==n?(r.push(h),i.delete(h)):i.set(h,l)}else i.set(h,s)}break}if(0==i.size){n+=s,a=this.getMatchesFromSource(o);for(var d=0,u=a.length;d<u;++d)i.set(a[d],s)}else{n+=s,a=this.getMatchesFromSource(o);for(var d=0,u=a.length;d<u;++d){var h=a[d];i.has(h)?i.set(h,i.get(h)+s):i.set(h,s)}}o=o.dataObj}return{fullMatches:r,partialMatchObj:i,matchCount:n}}function internalQueryResultReduceMatchesByInsertedQueries(e,t){if(!this.isActive()){var i=this.dominating;return void(i&&i.reduceMatchesByInsertedQueries(e,t))}var r=this.getChainMatchCountDiff(e,t);if(0!==r){var n=this.getChainMatches(e,t);if(this.addPrefixResultRestrictions(t,n.fullMatches,n.matchCount,void 0,r),void 0!==n.partialMatchObj){var o=this;n.partialMatchObj.forEach(function(e,t){o.matches.inc(t,e)})}}}function internalQueryResultAddPrefixResultRestrictions(e,t,i,r,n){if(!this.resultIndexer&&this.hasNoSelectionOnIndexer())return void this.addPrefixRestrictionsToNoSelection(t,r,n);if(void 0===r){r=new Uint31HashSet(t.length);for(var o=0,s=t.length;o<s;++o)r.set(t[o])}var a=[],d=i-n;if(void 0===this.matches){var u;if(u=this.rootQueryCalc?this.rootQueryCalc.isSelection()?this.rootQueryCalc.getMatches():0==e.getDomMatchCount()&&1==this.matchCount?this.dataObj.getDominatedMatches():e.getDominatedMatches():[],this.matchCount+n>1&&(this.matches=new IntHashMapUint(this.matchCount+n,u.length)),1==this.matchCount&&n>0)if(d>0)for(var o=0,s=u.length;o<s;++o){var h=u[o];r.has(h)?this.matches.set(h,1):a.push(h)}else for(var o=0,s=u.length;o<s;++o){var h=u[o];this.matches.set(h,1),r.has(h)||a.push(h)}else for(var o=0,s=u.length;o<s;++o){var h=u[o];r.has(h)||a.push(h)}}else{var l=this;d==l.matchCount?this.matches.forEach(function(e,t){r.has(t)||(a.push(t),l.matches.delete(t))}):0===d?this.matches.forEach(function(e,t){r.has(t)||e==l.matchCount&&a.push(t)}):this.matches.forEach(function(e,t){r.has(t)||(e==l.matchCount&&a.push(t),l.matches.set(t,e-d))})}this.pushRemovedMatches(a,this.dataObj,this.matchCount),this.increaseMatchCount(n,t,this)}function internalQueryResultAddPrefixRestrictionsToNoSelection(e,t,i){if(0!=i){var r=e.length;e=this.rootQueryCalc.lowerProjMatches(e);var n=!1;if(void 0===t){t=new Uint31HashSet(e.length);for(var o=0,s=e.length;o<s;++o)t.set(e[o])}else if(e.length>r){for(var o=r,s=e.length;o<s;++o)t.set(e[o]);n=!0}if(this.hasNonQueryActiveComposed()){for(var a=this.rootQueryCalc.getSingleGeneratingProj(),d=a.getProjMatches(this.getId()),u=[],o=0,s=d.length;o<s;++o){var h=d[o];t.has(h)||u.push(h)}for(var l in this.composedActive){var c=this.composedActive[l];c instanceof InternalQueryResult||c.removeMatches(u,this)}}for(var l in this.composedActive){var c=this.composedActive[l];if(c instanceof InternalQueryResult){var p=c.isActive()?c:c.dominating;p&&p.addPrefixResultRestrictions(this,e,1,t,1)}}if(this.matchCount=i,this.requiresExplicitProjMatches()&&(this.rootQueryCalc.initExplicitProjMatches(this.getId(),e),this.refreshProjProperties()),this.matchCount>1){this.matches=new IntHashMapUint(this.matchCount,e.length);for(var o=0,s=e.length;o<s;++o)this.matches.set(e[o],i)}if(n)for(var o=r,s=e.length;o<s;++o)t.delete(e[o]);e.length=r}}function internalQueryResultIncreaseMatchCount(e,t,i){if(0!=e){if(!this.isActive())return void(this.dominating&&this.dominating.increaseMatchCount(e,t,i));var r=!this.resultIndexer&&this.rootQueryCalc&&(this.rootQueryCalc.isSelection()||this.isPureProjection&&0==this.matchCount);if(this.setMatchCount(this.matchCount+e),r){var n=[];if(void 0===this.matches)this.matchCount<=1?n=t:(this.matches=new IntHashMapUint(this.matchCount),this.addDominatedMatchesWithoutForwarding(this,n));else{this.matches.expectSize(t.length);for(var o=0,s=t.length;o<s;++o){var a=t[o];if(this.matches.has(a)){var d=this.matches.get(a)+e;this.matches.set(a,d),d===this.matchCount&&n.push(a)}else this.matches.set(a,e)}}for(var u in this.composedActive){var h=this.composedActive[u];h.increaseMatchCount(e,n,this)}}else if(this.matchCount>1)if(void 0===this.matches)this.matches=new IntHashMapUint(this.matchCount),this.addDominatedMatchesWithoutForwarding(this);else for(var o=0,s=t.length;o<s;++o)this.matches.inc(t[o],e)}}function internalQueryResultRemoveRestrictionsOfRemovedQueries(e,t){var i=this.getChainMatchCountDiff(t,e),r=this.getChainMatches(t,e);if(void 0!==r.partialMatchObj){var n=this;r.partialMatchObj.forEach(function(e,t){var i=n.matches.get(t)-e;0==i?n.matches.delete(t):n.matches.set(t,i)})}this.removePrefixResultRestrictions(r.fullMatches,void 0,i)}function internalQueryResultRemovePrefixResultRestrictions(e,t,i){if(!this.isActive())return void(void 0!==this.dominating&&this.dominating.removePrefixResultRestrictions(e,t,i));var r=this.matchCount-i;if(!this.resultIndexer&&0==r&&this.isPureProjection){if(this.hasNonQueryActiveComposed()&&void 0===t){t=new Uint31HashSet;for(var n=0,o=e.length;n<o;++n)t.set(e[n])}if(this.removeRestrictionsFromNoSelection(e,t),!this.hasNonQueryActiveComposed())return}else{var s=0!=r;this.decreaseMatchCount(i,e,this,s)}if(void 0===t){t=new Uint31HashSet(e.length);for(var n=0,o=e.length;n<o;++n)t.set(e[n],1)}var a=[];if(void 0!==this.matches){var d=this.matchCount;this.matches.forEach(function(e,i){e==d&&(t.has(i)||a.push(i))})}else{var u=this.rootQueryCalc.indexer,h=u.getAllMatches(this.rootQueryCalc.prefixProjPathId);if(void 0!==h)for(var n=0,o=h.length;n<o;++n){var l=h[n];t.has(l)||a.push(l)}}this.matchCount<=1&&(this.matches=void 0),this.pushNewMatches(a,this,this.matchCount)}function internalQueryResultRemoveRestrictionsFromNoSelection(e,t){if(this.setMatchCount(0),this.matches=void 0,0!=this.composedQueryResultNum||0!=this.composedMatchTransparentNum){var i=e.length;e=this.rootQueryCalc.lowerProjMatches(e);var r=!1;if(void 0===t){t=new Uint31HashSet(e.length);for(var n=0,o=e.length;n<o;++n)t.set(e[n])}else if(e.length>i){for(var n=i,o=e.length;n<o;++n)t.set(e[n]);r=!0}if(this.FuncResult_removeRestrictionsFromNoSelection(e,t),r)for(var n=i,o=e.length;n<o;++n)t.delete(e[n]);e.length=i}}function internalQueryResultGetTerminalGeneratingProjs(){return this.rootQueryCalc?this.rootQueryCalc.getTerminalGeneratingProjs():[]}function internalQueryResultUpdateTerminalProjs(e){this.isActive();this.refreshMatchCount(this.isActiveStar()),this.resetProjProperties();var t=this.useResultIndexer(),i=!!this.resultIndexer;if(t&&!i)this.insertResultIndexer();else if(!t&&i)this.removeResultIndexer();else{if(void 0===e||0==e.size)return;if(this.resultIndexer){var r=this.getIndexer(),n=this;e.forEach(function(e,t){n.resultIndexer.addMapping(n,t,r,e,0)})}else for(var o in this.composedActive)this.composedActive[o].refreshIndexerAndPaths(this)}}function internalQueryResultRefreshIsPureProjection(){var e=void 0!==this.query&&this.query.isPureProjection();e!==this.isPureProjection&&(this.isPureProjection=e,this.isActiveStar()&&void 0!==this.dataObj&&(e?this.assumeNonZeroDomMatchCount||this.resultIndexer||this.dataObj.updateComposedSelectingNum(this.composedSelectingNum-1):this.assumeNonZeroDomMatchCount||this.resultIndexer||this.dataObj.updateComposedSelectingNum(1-this.composedSelectingNum)))}function internalQueryResultUpdateComposedSelectingNum(e,t){if(this.composedSelectingNum+=e,!this.isPureProjection||this.assumeNonZeroDomMatchCount||this.resultIndexer||this.activeStarPending||void 0===this.dataObj||this.dataObj.updateComposedSelectingNum(e,t),!t){var i=this.useResultIndexer(),r=!!this.resultIndexer;i&&!r?this.insertResultIndexer():!i&&r&&this.removeResultIndexer()}}function internalQueryResultCompleteComposedSelectingNumUpdate(){!this.isPureProjection||this.assumeNonZeroDomMatchCount||this.resultIndexer||this.activeStarPending||void 0===this.dataObj||this.dataObj.completeComposedSelectingNumUpdate();var e=this.useResultIndexer(),t=!!this.resultIndexer;e&&!t?this.insertResultIndexer():!e&&t&&this.removeResultIndexer()}function internalQueryResultGetMatches(){return this.isActive()?this.getDominatedMatches():[]}function internalQueryResultGetSelectionMatches(){if(!this.rootQueryCalc||!this.isActive())return[];if(this.matchCount){if(1==this.matchCount)return this.rootQueryCalc.isSelection()?this.rootQueryCalc.getMatches():this.dataObj.getDominatedMatches();var e=[],t=this.matchCount;return this.matches.forEach(function(i,r){i==t&&e.push(r)}),e}return this.rootQueryCalc.isSelection()?this.rootQueryCalc.getMatches():this.rootQueryCalc.getDomain()}function internalQueryResultGetSelectionMatchesAsObj(){if(!this.rootQueryCalc||!this.isActive())return new Map;if(this.matchCount){if(1==this.matchCount)return this.rootQueryCalc.isSelection()?this.rootQueryCalc.getMatchesAsObj():this.dataObj.getDominatedMatchesAsObj();var e=new Map,t=this.matchCount;return this.matches.forEach(function(i,r){i==t&&e.set(r,1)}),e}return this.rootQueryCalc.isSelection()?this.rootQueryCalc.getMatchesAsObj():this.rootQueryCalc.getDomainAsObj()}function internalQueryResultFilterSelectionMatches(e){if(!this.rootQueryCalc||!this.isActive())return[];if(0==this.matchCount)return this.rootQueryCalc.isSelection()?this.rootQueryCalc.filterMatches(e):e;if(1==this.matchCount)return this.rootQueryCalc.isSelection()?this.rootQueryCalc.filterMatches(e):this.dataObj.filterDominatedMatches(e);for(var t=[],i=0,r=e.length;i<r;++i){var n=e[i];this.matches.get(n)==this.matchCount&&t.push(n)}return t}function internalQueryResultFilterSelectionMatchPositions(e){if(!this.rootQueryCalc||!this.isActive())return[];if(0==this.matchCount){if(this.rootQueryCalc.isSelection())return this.rootQueryCalc.filterMatchPositions(e);for(var t=new Array(e.length),i=0,r=e.length;i<r;++i)t[i]=i;return t}if(1==this.matchCount)return this.rootQueryCalc.isSelection()?this.rootQueryCalc.filterMatchPositions(e):this.dataObj.filterDominatedMatchPositions(e);for(var t=[],i=0,r=e.length;i<r;++i){var n=e[i];this.matches.get(n)==this.matchCount&&t.push(i)}return t}function internalQueryResultGetDominatedMatches(e){if(!this.rootQueryCalc)return[];if(this.resultIndexer){if(this.resultIndexer.paths){var t=[];return this.resultIndexer.paths.nodes.forEach(function(e,i){t.push(i)}),t}return[]}if(this.rootQueryCalc.isSelection())return this.isActive()?this.getSelectionMatches():this.rootQueryCalc.getMatches();var i=this.rootQueryCalc.getSingleGeneratingProj(e);if(i){var r=i.getProjMatches(this.getId());return void 0===r?[]:r}}function internalQueryResultGetDominatedMatchesAsObj(e){if(!this.rootQueryCalc)return new Map;if(this.resultIndexer)return this.resultIndexer.paths?this.resultIndexer.paths.nodes:new Map;if(this.rootQueryCalc.isSelection())return this.isActive()?this.getSelectionMatchesAsObj():this.rootQueryCalc.getMatchesAsObj();var t=this.rootQueryCalc.getSingleGeneratingProj(e);if(t){if(this.rootQueryCalc.hasExplicitProjMatches(this.getId())||this.projMustGenerateMatches()){var i=t.getProjMatchesAsObj(this.getId());return i?i:new Map}i=new Map;for(var r=this.getDominatedMatches(e),n=0,o=r.length;n<o;++n)i.set(r[n],1);return i}}function internalQueryResultFilterDominatedMatches(e){if(!this.rootQueryCalc)return[];if(this.rootQueryCalc.isSelection())return this.filterSelectionMatches(e);var t;if(this.resultIndexer)t=this.resultIndexer.paths?this.resultIndexer.paths.nodes:void 0;else{var i=this.rootQueryCalc.getSingleGeneratingProj();t=i.getProjMatchesAsObj(this.getId())}if(!t)return[];for(var r=[],n=0,o=e.length;n<o;++n){var s=e[n];t.has(s)&&r.push(s)}return r}function internalQueryResultFilterDominatedMatchPositions(e){if(!this.rootQueryCalc)return[];if(this.rootQueryCalc.isSelection())return this.filterSelectionMatchPositions(e);var t;if(this.resultIndexer)t=this.resultIndexer.paths?this.resultIndexer.paths.nodes:void 0;else{var i=this.rootQueryCalc.getSingleGeneratingProj();t=i.getProjMatchesAsObj(this.getId())}if(!t)return[];for(var r=[],n=0,o=e.length;n<o;++n){var s=e[n];t.has(s)&&r.push(n)}return r}function internalQueryResultGetDomMatchCount(){return this.resultIndexer?0:this.matchCount?this.query&&this.query.isProjection()?1:this.matchCount:this.isPureProjection?0:1}function internalQueryResultAddMatches(e,t,i){var r;if(e.length&&0!=i){if(!this.isActiveStar()||this.pendingSetData||this.pendingRootRefresh)return void 0===this.pendingAddMatches&&(this.pendingAddMatches=[]),void this.pendingAddMatches.push({elementIds:e.slice(0),source:t,matchCount:i});if(this.isActive()||this.dominating)if(void 0===i&&(i=1),this.matchCount<=1)this.pushNewMatches(e,t,i);else if(this.matchCount===i){r=e.length,this.matches?this.matches.expectSize(r):this.matches=new IntHashMapUint(this.matchCount,r);for(var n=0;n<r;++n){var o=e[n];this.matches.set(o,i)}this.pushNewMatches(e,t,this.matchCount)}else{var s=this.matchCount,a=[];r=e.length,this.matches?this.matches.expectSize(r):this.matches=new IntHashMapUint(this.matchCount,r);for(var n=0;n<r;++n){var o=e[n];this.matches.inc(o,i)==s&&a.push(o)}this.pushNewMatches(a,t,this.matchCount)}}}function internalQueryResultPushNewMatches(e,t,i){if(e.length){if(this.rootQueryCalc&&!this.rootQueryCalc.isSelection())return void this.rootQueryCalc.addProjMatches(e,this.getId());if(this.resultIndexer)return void this.resultIndexer.addProjMatches(e,this.getId(),0);if(this.dominating)return t==this.rootQueryCalc&&(t=this),void this.dominating.addMatches(e,t,i);for(var r in this.composedActive)this.composedActive[r].addMatches(e,this,this.matchCount)}}function internalQueryResultRemoveMatches(e,t,i){if(e.length&&0!=i){void 0===i&&(i=1);var r;if(this.matchCount>1){var n=this.matchCount,o=e.length;r=[],this.matches.suspendMinFill();for(var s=0;s<o;++s){var a=e[s],d=this.matches.dec(a,i);d+i===n&&r.push(a)}this.matches.resetMinFill()}else r=e;this.pushRemovedMatches(r,t,this.matchCount?this.matchCount:i)}}function internalQueryResultRemoveAllMatches(e){var t=e.getDomMatchCount();0!==t&&this.removeMatches(e.getDominatedMatches(),e,t)}function internalQueryResultPushRemovedMatches(e,t,i){if(e.length){if(this.rootQueryCalc&&!this.rootQueryCalc.isSelection())return void this.rootQueryCalc.removeProjMatches(e,this.getId());if(this.resultIndexer)return void this.resultIndexer.removeProjMatches(e,this.getId(),0);if(this.dominating)return t==this.rootQueryCalc&&(t=this),void this.dominating.removeMatches(e,t,i);for(var r in this.composedActive)this.composedActive[r].removeMatches(e,this,this.matchCount)}}function internalQueryResultSetProjMatches(){this.rootQueryCalc.setProjMatches(this.getId()),this.rootQueryCalc.refreshProjMustGenerateMatches(this.getId(),this.projMustGenerateMatches())}function internalQueryResultAddTerminalProjMatches(e,t){if(!this.pendingIndexerReplace&&void 0!==t&&t.length)if(this.resultIndexer)this.resultIndexer.addProjMatches(t,this.getId(),e.getId());else if(this.rootQueryCalc.getTerminalGeneratingProjNum()>1)for(var i in this.composedActive)this.composedActive[i].addProjMatches(t,this.getId(),e.getId());else{var r=this.hasNoSelectionOnIndexer();for(var i in this.composedActive){var n=this.composedActive[i];r&&n instanceof InternalQueryResult||n.addMatches(t,this)}}}function internalQueryResultRemoveTerminalProjMatches(e,t){if(!this.pendingIndexerReplace&&void 0!==t&&t.length)if(this.resultIndexer)this.resultIndexer.removeProjMatches(t,this.getId(),e.getId());else if(this.rootQueryCalc.getTerminalGeneratingProjNum()>1)for(var i in this.composedActive)this.composedActive[i].removeProjMatches(t,this.getId(),e.getId());else{var r=this.hasNoSelectionOnIndexer();for(var i in this.composedActive){var n=this.composedActive[i];r&&n instanceof InternalQueryResult||n.removeMatches(t,this)}}}function internalQueryResultRemoveAllTerminalProjMatches(e){var t;if(this.resultIndexer)t=e.getProjMatches(this.getId()),this.resultIndexer.removeProjMatches(t,this.getId(),e.getId());else{var t,i=this.hasNoSelectionOnIndexer()||0==this.composedQueryResultNum;if(i)for(var r in this.composedActive){var n=this.composedActive[r];n instanceof InternalQueryResult||n.removeAllMatches(this)}else for(var r in this.composedActive){var n=this.composedActive[r];n instanceof InternalQueryResult?n.removeAllMatches(this):(t||(t=e.getProjMatches(this.getId())),n.removeMatches(t,this))}}}function internalQueryResultUseResultIndexer(e){if(!this.rootQueryCalc||!this.rootQueryCalc.isCompiled()||!this.calcIsActive())return!1;if(this.isPureProjection&&!this.assumeNonZeroDomMatchCount){if(void 0===e&&0==this.matchCount)return!1;if(void 0!==e&&0==e.getDomMatchCount())return!1}return this.rootQueryCalc.getTerminalGeneratingProjNum()>1&&this.composedActiveNum>this.composedSupportMultiProjNum||0!=useResultIndexers&&this.composedSelectingNum>this.maxDirectComposedNum}function internalQueryResultInsertResultIndexer(){if(!this.resultIndexer){if(this.doDebugging&&this.debugMessage("inserting result indexer at query result ",this.getId()),this.qcm.indexerIsScheduled(this.getIndexer()))return void this.insertResultIndexerWithRefresh();var e=this.getDomMatchCount();if(this.resultIndexer=new MergeIndexer(this.qcm),this.setMappingsOnResultIndexer())if(this.rootQueryCalc.isSelection())this.resultIndexer.addProjMatches(this.getSelectionMatches(),this.getId(),0);else for(var t=this.rootQueryCalc.getTerminalGeneratingProjs(),i=0,r=t.length;i<r;++i){var n=t[i],o=n.getProjMatches(this.getId());void 0!==o&&this.resultIndexer.addProjMatches(o,this.getId(),n.getId())}this.composedQueryResultNum<this.composedActiveNum&&(this.resultIndexerQueryCalc=new QueryResultQueryCalc(this));var s=this.rootQueryCalc?this.getProjectionPathId():this.qcm.getRootPathId(),a=this.qcm.getRootPathId(),d=void 0!==this.resultIndexer.paths?this.resultIndexer.paths.nodes:void 0;for(var u in this.composedActive){var h=this.composedActive[u];h instanceof InternalQueryResult?h.removeNonResultIndexerMatches(d,e):h.decreaseMatchCount(e,d,this),h.replaceIndexerAndPaths(s,a,1,this)}this.refreshProjProperties(),this.isPureProjection&&!this.assumeNonZeroDomMatchCount&&this.dataObj.updateComposedSelectingNum(1-this.composedSelectingNum,!0)}}function internalQueryResultInsertResultIndexerWithRefresh(){if(!this.resultIndexer){var e=this.getDominatedMatches();for(var t in this.composedActive)this.composedActive[t].removeMatches(e,this,this.matchCount);this.createResultIndexer();for(var t in this.composedActive)this.composedActive[t].refreshIndexerAndPaths(this);if(this.setMappingsOnResultIndexer()){if(this.rootQueryCalc.isSelection())this.resultIndexer.addProjMatches(this.getSelectionMatches(),this.getId(),0);else for(var i=this.rootQueryCalc.getTerminalGeneratingProjs(),r=0,n=i.length;r<n;++r){var o=i[r];this.resultIndexer.addProjMatches(o.getProjMatches(this.getId()),this.getId(),o.getId())}this.isPureProjection&&!this.assumeNonZeroDomMatchCount&&this.dataObj.updateComposedSelectingNum(1-this.composedSelectingNum,!0)}}}function internalQueryResultCreateResultIndexer(){void 0===this.resultIndexer&&(this.resultIndexer=new MergeIndexer(this.qcm),this.refreshProjProperties()),this.composedQueryResultNum<this.composedActiveNum&&void 0===this.resultIndexerQueryCalc&&(this.resultIndexerQueryCalc=new QueryResultQueryCalc(this))}function internalQueryResultRemoveResultIndexer(){if(this.resultIndexer){if(this.doDebugging&&this.debugMessage("removing result indexer at query result ",this.getId()),this.qcm.indexerIsScheduled(this.getIndexer())||this.qcm.indexerIsScheduled(this.resultIndexer))return void this.removeResultIndexerWithRefresh();var e=this.qcm.getRootPathId(),t=this.rootQueryCalc?this.getProjectionPathId():this.qcm.getRootPathId(),i=this.resultIndexer;this.resultIndexer=void 0;var r=this.getAccumulatedMatchCount();if(r>0)for(var n in this.composedActive){var o=this.composedActive[n];o instanceof InternalQueryResult?o.addCountsUnderRemovedIndexer(this,r):o.increaseMatchCount(r,i.paths.nodes,this)}for(var n in this.composedActive){var o=this.composedActive[n];o.replaceIndexerAndPaths(e,t,r?-1:0,this)}this.resultIndexer=i,this.destroyResultIndexer()}}function internalQueryResultRemoveResultIndexerWithRefresh(){if(this.resultIndexer){this.resultIndexer.clear(),this.destroyResultIndexer();for(var e in this.composedActive)this.composedActive[e].refreshIndexerAndPaths(this);var t=this.getDominatedMatches();for(var e in this.composedActive)this.composedActive[e].addMatches(t,this,this.matchCount)}}function internalQueryResultDestroyResultIndexer(){if(void 0!==this.resultIndexer){if(void 0!==this.resultIndexerQueryCalc&&(this.resultIndexerQueryCalc.destroy(),this.resultIndexerQueryCalc=void 0),void 0!==this.rootQueryCalc){var e=this.rootQueryCalc.getGeneratingProjMappings();if(void 0!==e){var t=this;e.forEach(function(e,i){t.resultIndexer.removeMapping(t,i)})}}this.resultIndexer.destroy(),this.resultIndexer=void 0,this.destroyed||(this.refreshProjProperties(),this.dataObj&&this.isPureProjection&&!this.assumeNonZeroDomMatchCount&&this.dataObj.updateComposedSelectingNum(this.composedSelectingNum-1,!0))}}function internalQueryResultDebugGetQueryResult(){var e=this.getDominatedMatches(),t=this.getDominatedIndexer(),i=this.getDominatedProjPathId();return t&&e&&0!=e.length?t.debugGetDataUnder(e,i):new DebugInternalTo(this.qcm)}function internalQueryResultDebugGetQueryInput(){if(this.dataObj)return this.dataObj.debugGetQueryResult();if(!this.rootQueryCalc)return new DebugInternalTo(this.qcm);var e=this.rootQueryCalc.indexer,t=this.rootQueryCalc.prefixProjPathId;return e?e.debugGetDataUnder(void 0,t):new DebugInternalTo(this.qcm)}function internalQueryResultDebugPrintQuery(){return void 0===this.query||void 0===this.query.indexer?"<undefined>":this.query.debugGetQueryDesc()}function internalQueryResultDebugPrintDesc(){return""+this.getId()+"<"+this.constructor.name+">: "+this.debugPrintQuery()}function DataResult(e,t,i,r,n){this.FuncResult(e),this.indexer=t,this.pathId=i,this.qcm.allocatePathIdByPathId(i),this.identificationId=r,this.isReplaceable=!!n,this.registeredToIndexer=!1}function dataResultDestroy(){this.qcm.releasePathId(this.pathId),this.registeredToIndexer&&this.indexer.removeQueryCalcFromPathNode(this)}function dataResultIsActive(){return!1}function dataResultIsTerminalResult(){return!0}function dataResultIsReplaceableTerminalResult(){return this.isReplaceable}function dataResultAboutToAddActiveComposed(){this.composedQueryResultNum<this.composedActiveNum&&!this.registeredToIndexer&&(this.registeredToIndexer=!0,this.indexer.addQueryCalcToPathNode(this))}function dataResultBecameActiveStar(){if(this.composedQueryResultNum!=this.composedActiveNum){var e=this.getDominatedMatches();for(var t in this.composedActive){var i=this.composedActive[t];i instanceof InternalQueryResult||i.addMatches(e,this)}}}function dataResultActiveComposedFuncRemoved(){this.composedQueryResultNum==this.composedActiveNum&&this.registeredToIndexer&&(this.registeredToIndexer=!1,this.indexer.removeQueryCalcFromPathNode(this))}function dataResultGetDominatedIndexer(){return this.indexer}function dataResultGetDominatedProjPathId(){return this.pathId}function dataResultGetDominatedProjPathNum(){return 1}function dataResultGetDominatedProjMappings(){var e=new Map;return e.set(0,[this.qcm.getRootPathId(),this.pathId]),e}function dataResultGetTerminalProjMatches(e){return this.indexer.getAllMatches(this.pathId)}function dataResultFilterTerminalProjMatches(e,t){return this.indexer.filterDataNodesAtPath(this.pathId,t)}function dataResultGetDomMatchCount(){return 0}function dataResultGetDominatedMatches(){return this.indexer.getAllMatches(this.pathId)}function dataResultGetDominatedMatchesAsObj(){return this.indexer.getDataNodesAtPath(this.pathId)}function dataResultFilterDominatedMatches(e){var t=[],i=this.indexer.getDataNodesAtPath(this.pathId);if(void 0===i)return t;for(var r=0,n=e.length;r<n;++r){var o=e[r];i.has(o)&&t.push(o)}return t}function dataResultFilterDominatedMatchPositions(e){var t=[],i=this.indexer.getDataNodesAtPath(this.pathId);if(void 0===i)return t;for(var r=0,n=e.length;r<n;++r)i.has(e[r])&&t.push(r);return t}function dataResultGetDominatedIdentification(){return this.identificationId}function dataResultGetDominatedComparison(){if(this.indexer&&void 0!==this.indexer.getDominatedComparisonAtPath)return this.indexer.getDominatedComparisonAtPath(this.pathId)}function dataResultAddOrderStarFunc(e){var t=this.isOrderStar();this.FuncResult_addOrderStarFunc(e),t||void 0!==this.indexer&&void 0!==this.indexer.addOrderStarFuncAtPath&&this.indexer.addOrderStarFuncAtPath(this,this.pathId)}function dataResultRemoveOrderStarFunc(e){var t=this.isOrderStar();this.FuncResult_removeOrderStarFunc(e),t&&!this.isOrderStar()&&void 0!==this.indexer&&void 0!==this.indexer.removeOrderStarFuncAtPath&&this.indexer.removeOrderStarFuncAtPath(this.id,this.pathId)}function dataResultIsSelection(){return!1}function dataResultAddMatches(e,t){for(var i in this.composedActive){var r=this.composedActive[i];r instanceof InternalQueryResult||r.addMatches(e,this)}}function dataResultRemoveMatches(e,t){for(var i in this.composedActive){var r=this.composedActive[i];r instanceof InternalQueryResult||r.removeMatches(e,this)}}function dataResultRemoveAllIndexerMatches(){for(var e in this.composedActive){var t=this.composedActive[e];t instanceof InternalQueryResult||t.removeAllMatches(this)}}function QueryCalc(e){this.id=InternalQCM.newId(),this.rootQueryCalc=e}function queryCalcDestroy(){this.destroyed=!0,this.parent&&this.parent.removeSubNode(this.id);for(var e in this.subNodes)this.subNodes[e].detachFromParent();this.rootQueryCalc&&this.matchParent==this.rootQueryCalc&&this.rootQueryCalc.detachFromQueryCalc()}function queryCalcGetId(){return this.id}function queryCalcAssignAsRoot(){this.matchParent!=this.rootQueryCalc&&(this.parent&&(this.parent.removeSubNode(this.id),this.detachFromParent()),this.matchParent=this.rootQueryCalc,this.rootQueryCalc.assignQueryCalc(this))}function queryCalcRemoveTheRoot(){this.matchParent==this.rootQueryCalc&&delete this.matchParent}function queryCalcIsRoot(){return this.matchParent==this.rootQueryCalc}function queryCalcAddSubNode(e){if(e){var t=e.getId();if(this.subNodes){if(t in this.subNodes)return}else this.subNodes={},this.subNodeNum=0;this.subNodeNum++,this.subNodes[t]=e,e.parent&&e.parent!=this&&e.parent.removeSubNode(t),e.parent=this,e.matchParent=this,this.addUpdatedSubNode(t,!0)}}function queryCalcRemoveSubNode(e){if(this.subNodes&&e in this.subNodes){var t=this.subNodes[e];delete this.subNodes[e],this.subNodeNum--;var i=!1;if(this.updatedSubNodes&&e in this.updatedSubNodes){var i=this.updatedSubNodes[e];delete this.updatedSubNodes[e]}i||this.clearSubNode&&this.clearSubNode(t),t.parent==this&&delete t.parent}}function queryCalcAddUpdatedSubNode(e,t){this.updatedSubNodes||(this.updatedSubNodes={}),this.updatedSubNodes[e]||(this.updatedSubNodes[e]=!!t),this.parent&&this.parent.addUpdatedSubNode(this.id)}function queryCalcDetachFromParent(){this.parent&&(this.parent=void 0,this.matchParent=void 0,this.clearParent&&this.clearParent())}function queryCalcIsGeneratingProjectionTerminal(){return!0}function InternalQueryCalc(e){this.QueryCalc(e),this.indexer=e.getIndexer(),this.matchPoints=new Map}function internalQueryCalcDestroy(){this.QueryCalc_destroy(),this.pathId&&this.indexer.qcm.releasePathId(this.pathId)}function internalQueryCalcDetachFromIndexer(){this.indexer.removeQueryCalcFromPathNode(this)}function internalQueryCalcIsSelection(){return"simple"==this.nodeType&&"projector"!=this.valueType}function internalQueryCalcIsProjection(){return!!this.projSubNodeNum||"projector"==this.valueType}function internalQueryCalcIsUnion(){return!1}function internalQueryCalcIsNegation(){return!1}function internalQueryCalcSubProjMustAddMatches(){return!!this.parent&&this.parent.subProjMustAddMatches()}function internalQueryCalcShouldAddMatches(){return(this.mustAddMatches||!this.isProjection())&&(!this.isSelectionProjection()||this.matchParent.mustAddMatches)}function internalQueryCalcIsSelectionProjection(){return!!this.parent&&this.parent.isUnion()&&!!this.parent.isProjection()&&!this.isProjection()}function internalQueryCalcAddsProjMatchesToSubNodes(){return void 0!==this.matchParent&&this.matchParent!=this.rootQueryCalc&&this.matchParent.addsProjMatchesToSubNodes()}function internalQueryCalcLowerThanQueryPrefixFullMatches(){var e=this.rootQueryCalc.prefixProjPathId,t=!1;
return this.matchPoints.forEach(function(i,r){r>e&&(t=!0)}),t}function internalQueryCalcGetFullCountMatchPoints(){return this.matchPoints}function internalQueryCalcClearParent(e){this.destroyed||this.suspendProjection()}function internalQueryCalcClearSubNode(e){this.destroyed||this.updateQueryAfterNodeRemoval(e)}function internalQueryCalcUnsetMustAddMatches(){this.mustAddMatches&&(this.mustAddMatches=!1,this.unsetSubProjsMustAddMatches&&!this.subProjMustAddMatches()&&this.unsetSubProjsMustAddMatches())}function internalQueryCalcUnsetSelectionProjection(){this.projMatches&&(this.projMatches=void 0),this.rootQueryCalc.removeGeneratingProj(this)}function internalQueryCalcSetSelectionProjection(){this.rootQueryCalc.addSelectionGeneratingProj(this)}function internalQueryCalcRefreshQuery(){debugStartTimer("query","query calc refresh"),this.refreshQueryStructure(),this.refreshMatchPoints(),this.rootQueryCalc.queryStructureRefreshed(),this.refreshMatches(),debugStopTimer("query calc refresh")}function internalQueryCalcSetMustAddMatches(){return!this.mustAddMatches&&(this.mustAddMatches=!0,this.setSubProjsMustAddMatches&&this.setSubProjsMustAddMatches(),!0)}function internalQueryCalcSetRootAsMatchParent(){if(this.matchParent!=this.rootQueryCalc){this.matchParent=this.rootQueryCalc,this.suspendProjection();var e=this.getMatches();e.length>0&&this.matchParent.addMatches(e,this)}}function internalQueryCalcIsSuspended(){return!!this.suspendedMatches}function internalQueryCalcIsSuspendedProjection(){return!!this.projectionSuspended}function internalQueryCalcSuspend(){this.isSuspended()||(this.isSuspendedProjection()||this.suspendProjection(),this.setSuspendedMode(),this.suspendSelection())}function internalQueryCalcSuspendProjection(){this.isSuspendedProjection()||(this.suspendProjMatches(),this.projectionSuspended=!0,this.setSuspendedProjectionMode())}function internalQueryCalcUnsuspend(){this.isSuspendedProjection()&&(this.isSuspended()&&(this.setSelectionMode(),this.shouldAddMatches()?(this.matchParent.addMatches(this.calcNewFullMatchesAfterSuspension(),this),this.matchParent.removeMatches(this.calcRemovedSuspendedMatches(),this)):this.calcNewFullMatchesAfterSuspension(),this.suspendedMatches=void 0),this.setProjectionMode(),(this.isProjection()||this.isSelectionProjection())&&this.setProjMatches(),this.projectionSuspended=void 0)}function internalQueryCalcGetFullMatchCount(){return 1}function internalQueryCalcRefreshProjMustGenerateMatches(e,t){if(0!=this.projSubNodeNum)for(var i in this.projSubNodes)this.projSubNodes[i].refreshProjMustGenerateMatches(e,t)}function internalQueryCalcSetProjMatches(e,t){if(void 0!==e&&this.isProjection()&&this.projMatches&&this.projMatches.has(e)&&!this.isSuspendedProjection()&&this.suspendProjMatches(e),void 0===t&&(t=this.getMatches()),void 0===e){var i=this.rootQueryCalc.getQueryResults(),r=this;return void i.forEach(function(e,i){r.setProjMatches(i,t)})}var n=this.projMatches?this.projMatches.get(e):void 0,o=this.initEmptyProjMatches(e),s=this.matchParent.filterProjMatches(t,e);s=this.isProjection()?this.lowerProjMatchesAndAdd(s,e):this.calcNewSelectionProjMatches(s,e);var a,d=new Uint31HashSet;if(void 0==n){for(var u=0,h=s.length;u<h;++u)o.set(s[u],1);a=s}else{a=[];for(var u=0,h=s.length;u<h;++u){var l=s[u];o.set(l,1),n.has(l)?d.set(l):a.push(l)}}var c=[];if(n&&n.forEach(function(e,t){d.has(t)||c.push(t)}),this.projSubNodeNum)for(var p in this.projSubNodes)a.length&&this.projSubNodes[p].addProjMatches(a,e),c.length&&this.projSubNodes[p].removeProjMatches(c,e);else{var f=this.rootQueryCalc.getQueryResults().get(e);a.length&&f.addTerminalProjMatches(this,a),a.length&&f.removeTerminalProjMatches(this,c)}}function internalQueryCalcAddSelectionProjMatches(e,t){if(this.isGeneratingProjection()){var e=this.calcNewSelectionProjMatches(e,t),i=this.rootQueryCalc.getQueryResults();i.get(t).addTerminalProjMatches(this,e)}}function internalQueryCalcCalcNewSelectionProjMatches(e,t){if(!this.isGeneratingProjection())return[];var i,r=this.getProjMatchesEntry(t);if(this.lowerThanQueryPrefixFullMatches())for(var n=this.indexer.getDataElements(),o=this.rootQueryCalc.prefixProjPathId,s=0,a=e.length;s<a;++s){var d=e[s];d=n.raiseToPath(d,o),r.has(d)?r.set(d,r.get(d)+1):(r.set(d,1),i.push(d))}else{i=e;for(var s=0,a=e.length;s<a;++s)r.set(e[s],1)}return i}function internalQueryCalcAddProjMatchesDoNothing(){}function internalQueryCalcRemoveSelectionProjMatches(e,t){if(this.isGeneratingProjection()){var i=this.getProjMatchesEntry(t),r=[];if(this.lowerThanQueryPrefixFullMatches())for(var n=this.indexer.getDataElements(),o=this.rootQueryCalc.prefixProjPathId,s=0,a=e.length;s<a;++s){var d=e[s];d=n.raiseToPath(d,o);var u=i.get(d)-1;0==u?(i.delete(d),r.push(d)):i.set(d,u)}else for(var s=0,a=e.length;s<a;++s){var d=e[s];i.has(d)&&(i.delete(d),r.push(d))}var h=this.rootQueryCalc.getQueryResults();h.get(t).removeTerminalProjMatches(this,r)}}function internalQueryCalcRemoveProjMatchesDoNothing(){}function internalQueryCalcLowerToProjMatchPoints(e,t){if(!t)return e;if(0==t.size)return e;var i=[];return t.forEach(function(e,t){i.push(t)}),e=this.indexer.getDataElements().lowerDataElementsTo(e,i)}function internalQueryCalcInitEmptyProjMatches(e){if(e){this.projMatches||(this.projMatches=new Map);var t=new Uint31HashSet;return this.projMatches.set(e,t),t}if(this.projMatches=new Map,this.rootQueryCalc){var i=this;this.rootQueryCalc.getQueryResults().forEach(function(e,t){i.projMatches.set(t,new Uint31HashSet)})}}function internalQueryCalcMakeEmptyProjMatchArrays(){var e={};return void 0!==this.projMatches&&this.projMatches.forEach(function(t,i){e[i]=[]}),e}function internalQueryCalcRemoveResultProjMatches(e){if(void 0!==this.projMatches&&this.projMatches.has(e)&&(this.projMatches.delete(e),this.projSubNodeNum))for(var t in this.projSubNodes)this.projSubNodes[t].removeResultProjMatches(e)}function internalQueryCalcInitExplicitProjMatches(e){if(this.projSubNodeNum)for(var t in this.projSubNodes)this.projSubNodes[t].setExplicitProjMatches(e)}function internalQueryCalcSetExplicitProjMatches(e){if(this.projSubNodeNum)for(var t in this.projSubNodes)this.projSubNodes[t].setExplicitProjMatches(e)}function internalQueryCalcReleaseExplicitProjMatches(e){if(1===this.projSubNodeNum)for(var t in this.projSubNodes)this.projSubNodes[t].releaseExplicitProjMatches(e)}function internalQueryCalcGetMatches(){var e=[];return this.matches.forEach(function(t,i){e.push(i)}),e}function internalQueryCalcGetMatchesAsObj(){return this.matches}function internalQueryCalcGetFullyRaisedMatches(){if(!this.lowerThanQueryPrefixFullMatches())return this.getMatches();var e=[],t=this.indexer.getDataElements(),i=this.rootQueryCalc.prefixProjPathId;return this.matches.forEach(function(r,n){t.getPathId(n)<=i&&e.push(n)}),e}function internalQueryCalcGetFullyRaisedMatchesAsObj(){if(!this.lowerThanQueryPrefixFullMatches())return this.getMatchesAsObj();var e=new Map,t=this.indexer.getDataElements(),i=this.rootQueryCalc.prefixProjPathId;return this.matches.forEach(function(r,n){t.getPathId(n)<=i&&e.set(n,1)}),e}function internalQueryCalcGetProjMatches(e){var t;if(this.projMatches&&(t=this.projMatches.get(e))){var i=[];return t.forEach(function(e,t){i.push(t)}),i}}function internalQueryCalcGetProjMatchesAsObj(e){if(this.projMatches)return this.projMatches.get(e)}function internalQueryCalcGetProjMatchesEntry(e){this.projMatches||(this.projMatches=new Map);var t;return void 0===(t=this.projMatches.get(e))&&(t=new Uint31HashSet,this.projMatches.set(e,t)),t}function internalQueryCalcFilterMatches(e){for(var t=[],i=0,r=e.length;i<r;++i){var n=e[i];this.matches.has(n)&&t.push(n)}return t}function internalQueryCalcFilterMatchPositions(e){for(var t=[],i=0,r=e.length;i<r;++i){var n=e[i];this.matches.has(n)&&t.push(i)}return t}function internalQueryCalcFilterProjMatches(e,t){var i;if(this.projMatches&&(i=this.projMatches.get(e))){for(var r=[],n=0,o=t.length;n<o;++n){var s=t[n];i.has(s)&&r.push(s)}return r}}function PairwiseDisjoint(e,t){this.RedBlackTree(t),this.startFollowedByStart=0,this.generateDisjointIntervals=!!e}function pairwiseDisjointIsDisjoint(){return 0==this.startFollowedByStart}function pairwiseDisjointIsDisjointInterval(e,t,i){if(this.isDisjoint())return!0;var r=this.find(t);return this.isDisjointId(e,r,i)}function pairwiseDisjointIsDisjointId(e,t,i){if(this.isDisjoint())return!0;if(this.generateDisjointIntervals)return i?0==t.value.startCountOpen&&t.value.openEndIds[0]==e:0==t.value.startCountClosed&&t.value.closedEndIds[0]==e}function pairwiseDisjointIsDisjointEnd(e,t){return t?e.value.endOpen>0&&0==e.value.startCountOpen:0==e.value.startCountClosed}function pairwiseDisjointGetIntervalNode(e){var t=this.insertKey(e);if(void 0!==t.value)return t;if(!this.generateDisjointIntervals)return t.value={endOpen:0,startClosed:0,endClosed:0,startOpen:0},t;var i=t.prev?t.prev.value.startCountClosed+t.prev.value.startOpen:0;return t.value={endOpen:0,startClosed:0,endClosed:0,startOpen:0,startCountOpen:i,startCountClosed:i},t}function pairwiseDisjointIsDisjointValue(e){var t=this.find(e);return void 0===t||(0==this.compare(t.key,e)?0==t.value.startCountOpen&&0==t.value.startClosed:0==t.value.startCountOpen&&0==t.value.endOpen)}function pairwiseDisjointIsDisjointRange(e,t,i,r){var n=0==this.compare(e,i);if(n)return!(!t&&!r)||this.isDisjointValue(e);var o=this.find(e);if(void 0===o)return!0;var s=this.compare(e,o.key),a=o.value;if(0!=s){if(0!=a.startCountOpen||0!=a.endOpen)return!1;var d=this.compare(i,o.key);return d<0||0==d&&(r||0==a.startClosed)}if(!t&&(0!=a.startCountOpen||0!=a.startClosed||0!=a.startOpen))return!1;if(t&&(0!=a.startCountClosed||0!=a.startOpen))return!1;if(void 0===o.next)return!0;var u=this.compare(i,o.next.key);return!(u>0)&&(u<0||(r||0==o.next.value.startClosed))}function pairwiseDisjointGetCoveringIntervalId(e,t,i,r){if(void 0!==this.root){var n=0==this.compare(e,i);if(!n||!t&&!r){var o=this.find(i);if(void 0!==o){var s,a=this.compare(i,o.key);if(0==a){if(s=this.findCoveringDisjointInterval(o,r),void 0!==s)return s.id;if(n)return;if(!r&&o.value.endOpen>0)return o.value.openEndIds[0]}if(void 0===o.prev)return;var d=o.prev.value;if(d.startOpen>0||d.startCountClosed>0)return s=this.findCoveringDisjointInterval(o,!0),void 0===s?void 0:s.id;o=o.prev}else o=this.last;if(!n){var u=this.compare(e,o.key);if(!(u>0)){var h=o.value;if(u<0)return h.endClosed>0?h.closedEndIds[0]:h.openEndIds[0];if(!t&&0!=h.endClosed)return o.value.closedEndIds[0]}}}}}function pairwiseDisjointAddInterval(e,t,i,r,n){var o=0==this.compare(e,i);if(!o||!t&&!r){var s=this.getIntervalNode(e),a=o?s:this.getIntervalNode(i);if(this.updateStart(s,t,!0),this.updateEnd(a,r,!0),this.generateDisjointIntervals){var d=[];this.extendStartCount(s,t,a,r,d);var u=a.value;if(r?void 0===u.openEndIds?u.openEndIds=[n]:this.isJustRestoredDisjointEnd(a,r)?(d.push(u.openEndIds[0]),u.openEndIds.splice(0,0,n)):u.openEndIds.push(n):void 0===u.closedEndIds?u.closedEndIds=[n]:this.isJustRestoredDisjointEnd(a,r)?(d.push(u.closedEndIds[0]),u.closedEndIds.splice(0,0,n)):u.closedEndIds.push(n),!(this.isDisjoint()||0==d.length&&this.isDisjointId(n,a,r)))return{removedIntervals:d,coveringInterval:this.findCoveringDisjointInterval(a,r)}}}}function pairwiseDisjointRemoveInterval(e,t,i,r,n){var o=0==this.compare(e,i);if(!o||!t&&!r){var s;this.generateDisjointIntervals&&!this.isDisjoint()&&(s={restoredIntervals:[]});var a=this.find(e),d=o?a:this.find(i);if(s&&this.isDisjointId(n,d,r)&&(s.modifiedInterval={id:n}),this.updateStart(a,t,!1),this.updateEnd(d,r,!1),this.generateDisjointIntervals){var u=[],h=[];this.reduceStartCount(a,t,d,r,u,h);for(var l=r?d.value.openEndIds:d.value.closedEndIds,c=0,p=l.length;c<p;++c)if(l[c]==n){if(l.splice(c,1),0==c&&p>1&&(r&&0==d.value.startCountOpen||!r&&0==d.value.startCountClosed)){var f=this.findDisjointIntervalStart(d,r);u.push({id:l[0],startValue:f.startValue,startOpen:f.startOpen,endValue:d.key,endOpen:r})}break}s&&(s.restoredIntervals=u,void 0===s.modifiedInterval&&h.length>0&&(s.modifiedInterval=this.findCoveringDisjointInterval(d,r)),0==s.restoredIntervals.length&&void 0!==s.modifiedInterval&&s.modifiedInterval.id==n&&(s=void 0))}if(d!=a){var i=d.value;0==i.endOpen&&0==i.startClosed&&0==i.endClosed&&0==i.startOpen&&this.removeNode(d)}var e=a.value;return 0==e.endOpen&&0==e.startClosed&&0==e.endClosed&&0==e.startOpen&&this.removeNode(a),s}}function pairwiseDisjointModifyInterval(e,t,i,r,n,o,s,a,d){var u=this.removeInterval(n,o,s,a,d);this.justNowRestored=u?u.restoredIntervals:void 0;var h=this.addInterval(e,t,i,r,d);if(this.justNowRestored=void 0,void 0===u){if(void 0===h)return;return h.coveringInterval.id!=d&&h.removedIntervals.push(d),h}if(void 0===h)return u.modifiedInterval&&u.modifiedInterval.id==d&&(u.modifiedInterval=void 0),u.coveringInterval={id:d,startValue:e,startOpen:t,endValue:i,endOpen:r},u;u.modifiedInterval&&u.modifiedInterval.id==h.coveringInterval.id?u.modifiedInterval=void 0:u.modifiedInterval&&u.modifiedInterval.id==d&&h.removedIntervals.push(d);var l=u.restoredIntervals;if(l&&l.length&&h.coveringInterval)for(var c=0,p=l.length;c<p;++c)if(l[c].id==h.coveringInterval.id){l.splice(c,1);break}var f=h.removedIntervals;if(!f||!f.length)return u.coveringInterval=h.coveringInterval,u;if(u.modifiedInterval)for(var v=u.modifiedInterval.id,c=0,p=f.length;c<p;++c)if(f[c]==v){u.modifiedInterval=void 0;break}if(l&&l.length){for(var g=new Map,m=[],c=0,p=l.length;c<p;++c)g.set(l[c].id,l[c]);for(var c=0,p=f.length;c<p;++c){var y=f[c];g.has(y)?g.delete(y):m.push(y)}h.removedIntervals=m,u.restoredIntervals=[],g.forEach(function(e,t){u.restoredIntervals.push(e)})}return{coveringInterval:h.coveringInterval,removedIntervals:h.removedIntervals,modifiedInterval:u.modifiedInterval,restoredIntervals:u.restoredIntervals}}function pairwiseDisjointExtendStartCount(e,t,i,r,n){if(e!=i){t||this.increaseStartCount(e,!1,n);for(var o=e.next;o!=i;)this.increaseStartCount(o,!0,n),this.increaseStartCount(o,!1,n),o=o.next;r||this.increaseStartCount(o,!0,n)}}function pairwiseDisjointReduceStartCount(e,t,i,r,n,o){if(e!=i){t||this.decreaseStartCount(e,!1,n,o);for(var s=e.next;s!=i;)this.decreaseStartCount(s,!0,n,o),this.decreaseStartCount(s,!1,n,o),s=s.next;r||this.decreaseStartCount(s,!0,n,o)}}function pairwiseDisjointIncreaseStartCount(e,t,i){var r=e.value;t?1==++r.startCountOpen&&r.endOpen>0&&i.push(r.openEndIds[0]):1==++r.startCountClosed&&r.endClosed>0&&i.push(r.closedEndIds[0])}function pairwiseDisjointDecreaseStartCount(e,t,i,r){var n=e.value;if(t){if(0==--n.startCountOpen){if(n.endOpen>0){var o=r.length?r[r.length-1]:this.findDisjointIntervalStart(e,!0);i.push({id:n.openEndIds[0],startValue:o.startValue,startOpen:o.startOpen,endValue:e.key,endOpen:!0})}n.startClosed>0&&r.push({startValue:e.key,startOpen:!1})}}else if(0==--n.startCountClosed){if(n.endClosed>0){var o=r.length?r[r.length-1]:this.findDisjointIntervalStart(e,!1);i.push({id:n.closedEndIds[0],startValue:o.startValue,startOpen:o.startOpen,endValue:e.key,endOpen:!1})}n.startOpen>0&&r.push({startValue:e.key,startOpen:!0})}}function pairwiseDisjointFindDisjointIntervalStart(e,t){if(0==e.value.startCountOpen){if(!t)return e.value.startClosed>0?{startValue:e.key,startOpen:!1}:void 0;if(0==e.value.endOpen)return}for(e=e.prev;;e=e.prev){var i=e.value;if(i.startOpen>0&&0==i.startCountClosed)return{startValue:e.key,startOpen:!0};if(i.startClosed>0&&0==i.startCountOpen)return{startValue:e.key,startOpen:!1}}}function pairwiseDisjointFindCoveringDisjointInterval(e,t){var i=this.findDisjointIntervalStart(e,t);if(i){var r=e.value;if(t&&0==r.startCountOpen)return i.id=r.openEndIds[0],i.endValue=e.key,i.endOpen=!0,i;if(0==r.startCountClosed)return i.id=r.closedEndIds[0],i.endValue=e.key,i.endOpen=!1,i;for(;e;){if(e=e.next,r=e.value,0==r.startCountOpen)return i.id=r.openEndIds[0],i.endValue=e.key,i.endOpen=!0,i;if(0==r.startCountClosed)return i.id=r.closedEndIds[0],i.endValue=e.key,i.endOpen=!1,i}}}function pairwiseDisjointIsJustRestoredDisjointEnd(e,t){if(!this.justNowRestored||0==this.justNowRestored.length)return!1;if(!this.isDisjointEnd(e,t))return!1;var i=e.value,r=t?i.openEndIds:i.closedEndIds;if(void 0===r||0==r.length)return!1;for(var n=r[0],o=0,s=this.justNowRestored.length;o<s;++o)if(this.justNowRestored[o].id==n)return!0;return!1}function pairwiseDisjointUpdateStart(e,t,i){var r=e.value,n=i?1:-1;t?(i||r.startOpen--,0==r.startOpen?0==r.endClosed&&(r.startClosed>0||0==r.endOpen&&this.endsWithStart(e.prev))?this.startFollowedByStart+=n:this.startsWithStart(e.next)&&(this.startFollowedByStart+=n):this.startFollowedByStart+=n,i&&r.startOpen++):(i||r.startClosed--,0==r.startClosed?0==r.endOpen&&this.endsWithStart(e.prev)?this.startFollowedByStart+=n:0==r.endClosed&&(r.startOpen>0||this.startsWithStart(e.next))&&(this.startFollowedByStart+=n):this.startFollowedByStart+=n,i&&r.startClosed++)}function pairwiseDisjointUpdateEnd(e,t,i){var r=e.value,n=i?1:-1;t?(i||r.endOpen--,0==r.endOpen&&this.endsWithStart(e.prev)&&(r.startClosed>0||0==r.endClosed&&(r.startOpen>0||this.startsWithStart(e.next)))&&(this.startFollowedByStart-=n),i&&r.endOpen++):(i||r.endClosed--,0==r.endClosed&&(r.startClosed>0?(r.startOpen>0||this.startsWithStart(e.next))&&(this.startFollowedByStart-=n):r.startOpen>0?0==r.endOpen&&this.endsWithStart(e.prev)&&(this.startFollowedByStart-=n):0==r.endOpen&&this.endsWithStart(e.prev)&&this.startsWithStart(e.next)&&(this.startFollowedByStart-=n)),i&&r.endClosed++)}function pairwiseDisjointStartsWithStart(e){if(void 0===e)return!1;var t=e.value;return void 0!==t&&(!(t.endOpen>0)&&(t.startClosed>0||!(t.endClosed>0)&&(t.startOpen>0||this.startsWithStart(e.next))))}function pairwiseDisjointEndsWithStart(e){if(void 0===e)return!1;var t=e.value;return void 0!==t&&(t.startOpen>0||!(t.endClosed>0)&&(t.startClosed>0||!(t.endOpen>0)&&this.endsWithStart(e.prev)))}function SimpleQueryCalc(e,t){this.InternalQueryCalc(e),this.matches=void 0,this.pathId=t,this.indexer.qcm.allocatePathIdByPathId(t),this.uniqueValueIds=new Map,this.values=new Map,this.disjoint=new Map,this.changedValues={},this.addedMatches=[],this.removedMatches=[]}function simpleQueryCalcDestroy(){this.InternalQueryCalc_destroy(),this.detachFromIndexer()}function simpleQueryCalcIsSelection(){return!0}function simpleQueryCalcIsProjection(){return!1}function simpleQueryCalcIsGeneratingProjection(){return this.isSelectionProjection()&&!this.matchParent.mustAddMatches}function simpleQueryCalcAddValue(e,t,i){this.changedValues||(this.changedValues={}),this.changedValues[e]={type:t,key:i},this.parent&&this.parent.addUpdatedSubNode(this.getId(),!1)}function simpleQueryCalcRemoveValue(e){this.changedValues||(this.changedValues={}),this.changedValues[e]=!1,this.parent&&this.parent.addUpdatedSubNode(this.getId(),!1)}function simpleQueryCalcGetValueType(e){return this.values.get(e)}function simpleQueryCalcGetDisjointValueIds(){var e=[];return this.disjoint.forEach(function(t,i){t.valueIds.forEach(function(t,r){e.push({id:r,type:i,key:t})})}),e}function simpleQueryCalcNewUniqueValueId(){return queryNextUniqueValueId++}function simpleQueryCalcSetMatchPoints(e){for(var t=0,i=e.length;t<i;++t){var r=e[t];this.matchPoints.set(r,1),this.matchParent.addToMatchPoints(r,this)}}function simpleQueryCalcAddToMatchPoints(e){this.matchPoints.set(e,1),this.matchParent.addToMatchPoints(e,this)}function simpleQueryCalcRemoveFromMatchPoints(e){this.matchPoints.delete(e),this.matchParent.removeFromMatchPoints(e,this)}function simpleQueryCalcRefreshQueryStructure(){}function simpleQueryCalcUnsetSelectionProjection(){void 0!==this.becameSelectionProjection&&(this.becameSelectionProjection=void 0),void 0===this.matches||this.matchCountRequired()||(this.matches=void 0),this.InternalQueryCalc_unsetSelectionProjection()}function simpleQueryCalcSetSelectionProjection(){this.becameSelectionProjection=!0,this.InternalQueryCalc_unsetSelectionProjection()}function simpleQueryCalcRefreshMatchPoints(){this.matchPoints.has(this.indexer.qcm.getRootPathId())||this.indexer.addQueryCalcToPathNode(this)}function simpleQueryCalcRefreshMatches(){this.becameSelectionProjection&&(void 0===this.matches&&this.createMatchTable(),this.becameSelectionProjection=void 0);for(var e=this.alignChangedValues(),t=0,i=e.length;t<i;++t){var r,n=e[t];void 0!==n.newUniqueValueId?(r=n.newUniqueValueId,this.uniqueValueIds.set(n.valueId,r)):r=n.uniqueValueId;var o=n.newValue;if(o){var s=void 0;this.values.has(r)&&(s=this.values.get(r),s.type!=o.type&&this.removeValueByType(r,s.type,s.key)),this.addValueByType(r,o.type,o.key,s&&s.type==o.type?s.key:void 0),this.values.set(r,o)}else if(void 0!==n.valueId)this.uniqueValueIds.delete(n.valueId);else{var a=this.values.get(r);void 0!==a&&this.removeValueByType(r,a.type,a.key),this.values.delete(r)}}this.updateQueuedMatches()}function simpleQueryCalcAddValueByType(e,t,i,r){if(void 0!==t){var n;if(this.disjoint.has(t)?n=this.disjoint.get(t):(n={valueIds:new Map},this.disjoint.set(t,n)),void 0===n.pairwiseDisjoint){var o=n.valueIds.size;if(n.valueIds.has(e)||o++,1==o)return n.valueIds.set(e,i),void this.indexer.updateSimpleQuery(this,e,t,i,r)}void 0==this.matches&&this.indexer.hasRangeValues(this.pathId,t)&&this.createMatchTable();var s=this.updateKeyInPairwiseDisjoint(t,n,e,i,r);return void 0===s?(n.valueIds.set(e,i),void this.indexer.updateSimpleQuery(this,e,t,i,r)):void this.updateDisjointIntervalModifications(n,t,s)}}function simpleQueryCalcUpdateKeyInPairwiseDisjoint(e,t,i,r,n){var o,s,a,d;if("object"==typeof r?(o=r.getMinKey(),s=r.getMinOpen(),a=r.getMaxKey(),d=r.getMaxOpen()):(o=a=r,s=d=!1),void 0!==t.pairwiseDisjoint&&void 0!==n){var u,h,l,c;return"object"==typeof n?(u=n.getMinKey(),h=n.getMinOpen(),l=n.getMaxKey(),c=n.getMaxOpen()):(u=l=n,h=c=!1),t.pairwiseDisjoint.modifyInterval(o,s,a,d,u,h,l,c,i)}return void 0===t.pairwiseDisjoint&&(t.pairwiseDisjoint=new PairwiseDisjoint(!0,e in this.indexer.alphabeticTypes?LinearSubIndex.stringCompare:void 0),t.valueIds.forEach(function(e,i){"object"==typeof e?t.pairwiseDisjoint.addInterval(e.getMinKey(),e.getMinOpen(),e.getMaxKey(),e.getMaxOpen(),i):t.pairwiseDisjoint.addInterval(e,!1,e,!1,i)})),t.pairwiseDisjoint.addInterval(o,s,a,d,i)}function simpleQueryCalcUpdateDisjointIntervalModifications(e,t,i){if(i.removedIntervals&&i.removedIntervals.length)for(var r=0,n=i.removedIntervals.length;r<n;++r){var o=i.removedIntervals[r];this.indexer.unregisterQueryValue(this,o,t,e.valueIds.get(o)),e.valueIds.delete(o)}if(void 0!==i.coveringInterval){var s=i.coveringInterval;this.addDisjointIntervalToQuery(e,s.id,t,s.startValue,s.endValue,s.startOpen,s.endOpen)}if(i.restoredIntervals)for(var a=i.restoredIntervals,r=0,n=a.length;r<n;++r){var s=a[r];this.addDisjointIntervalToQuery(e,s.id,t,s.startValue,s.endValue,s.startOpen,s.endOpen)}if(i.modifiedInterval){var s=i.modifiedInterval;this.addDisjointIntervalToQuery(e,s.id,t,s.startValue,s.endValue,s.startOpen,s.endOpen)}}function simpleQueryCalcAddDisjointIntervalToQuery(e,t,i,r,n,o,s){var a;a=r==n?r:new ConstRangeKey(void 0,i,r,n,o,s);var d=e.valueIds.has(t)?e.valueIds.get(t):void 0;a!==d&&(e.valueIds.set(t,a),this.indexer.updateSimpleQuery(this,t,i,a,d))}function simpleQueryCalcRemoveValueByType(e,t,i){if(void 0!==t){var r=this.disjoint.get(t);if(void 0!==r){if(void 0===r.pairwiseDisjoint)r.valueIds.delete(e),this.indexer.unregisterQueryValue(this,e,t,i);else{var n;if(n="object"==typeof i?r.pairwiseDisjoint.removeInterval(i.getMinKey(),i.getMinOpen(),i.getMaxKey(),i.getMaxOpen(),e):r.pairwiseDisjoint.removeInterval(i,!1,i,!1,e),void 0===n){var o=r.valueIds.get(e);r.valueIds.delete(e),this.indexer.unregisterQueryValue(this,e,t,o)}else this.updateDisjointIntervalModifications(r,t,n)}0==r.valueIds.size&&this.disjoint.delete(t)}}}function simpleQueryCalcAlignChangedValues(){var e=this.prepareValueChangeAlignment();this.findFreeOverlappingUniqueIds(e);var t=[];e.freeUniqueIds.forEach(function(e,i){t.push(i)});for(var i=0,r=e.reassign.length;i<r;++i){var n=e.reassign[i];void 0===n.newUniqueValueId&&(t.length>0?(n.newUniqueValueId=t[t.length-1],t.length--):n.newUniqueValueId=this.newUniqueValueId())}if(t.length>0)for(var i=0,r=t.length;i<r;++i)e.changes.push({uniqueValueId:t[i],newValue:!1});return e.changes}function simpleQueryCalcPrepareValueChangeAlignment(){var e=[],t=[],i=new Map;for(var r in this.changedValues){var n=this.changedValues[r],o=this.uniqueValueIds.has(r)?this.uniqueValueIds.get(r):void 0,s={valueId:r,uniqueValueId:o,newValue:n};if(e.push(s),void 0!==o)if(n===!1)i.set(o,!0);else{var a=this.values.get(o);this.valuesOverlap(n,a)||(i.set(o,!0),t.push(s))}else t.push(s)}return this.changedValues={},{changes:e,reassign:t,freeUniqueIds:i}}function simpleQueryCalcFindFreeOverlappingUniqueIds(e){for(var t,i,r=e.reassign,n=e.freeUniqueIds,o=0,s=r.length;o<s;++o){var a=r[o],d=a.newValue;if(d.type!=t&&(i=this.disjoint.has(d.type)?this.disjoint.get(d.type):void 0,t=d.type),void 0!==i){var u=i.pairwiseDisjoint;if(void 0===u){var h=this;i.valueIds.forEach(function(e,t){h.valuesOverlap(d,e)&&n.has(t)&&(a.newUniqueValueId=t,n.delete(t))})}else{var l;l="object"==typeof d.key?u.getCoveringIntervalId(d.key.getMinKey(),d.key.getMinOpen(),d.key.getMaxKey(),d.key.getMaxOpen()):u.getCoveringIntervalId(d.key,!1,d.key,!1),void 0!==l&&n.has(l)&&(a.newUniqueValueId=l,n.delete(l))}}}}function simpleQueryCalcValuesOverlap(e,t){return e.type==t.type&&("object"==typeof e.key?"object"==typeof t.key?e.key.intersectsWith(t.key):e.key.valueInRange(t.key):"object"==typeof t.key?t.key.valueInRange(e.key):e.key==t.key)}function simpleQueryCalcSuspendProjMatches(){}function simpleQueryCalcSetSelectionMode(){}function simpleQueryCalcSetProjectionMode(){}function simpleQueryCalcSetSuspendedProjectionMode(){}function simpleQueryCalcCreateMatchTable(){if(void 0===this.matches){this.updateQueuedMatches(),this.matches=new Map;var e=this;this.disjoint.forEach(function(t,i){t.valueIds.forEach(function(t,r){for(var n=e.indexer.getSimpleQueryValueMatches(e,r,i,t),o=0,s=n.length;o<s;++o){var a=n[o];e.matches.has(a)?e.matches.set(a,e.matches.get(a)+1):e.matches.set(a,1)}})});var t=this.indexer.getSimpleQueryQueuedUpdates(this);void 0!==t&&t.forEach(function(t,i){if(0!=t)if(t<0)e.matches.has(i)?e.matches.set(i,e.matches.get(i)-t):e.matches.set(i,-t);else{var r=e.matches.get(i)-t;0==r?e.matches.delete(i):e.matches.set(i,r)}})}}function simpleQueryCalcMatchCountRequired(){if(this.isSelectionProjection())return!0;if(this.values.size<=1)return!1;var e=!1,t=this.pathId;return this.disjoint.forEach(function(i,r){i.valueIds.pairwiseDisjoint&&this.indexer.hasRangeValues(t,r)&&(e=!0)}),e}function simpleQueryCalcAddMatches(e){0!=e.length&&this.addedMatches.push(e)}function simpleQueryCalcRemoveMatches(e){0!=e.length&&this.removedMatches.push(e)}function simpleQueryCalcUpdateMatchCount(e){if(void 0!==e){var t=[],i=[];if(void 0===this.matches){if(!this.matchCountRequired())return e.forEach(function(e,r){e<0?i.push(r):e>0&&t.push(r)}),void this.propagateMatchUpdates(t,i);this.createMatchTable()}var r=this;e.forEach(function(e,n){if(r.matches.has(n)){var o=r.matches.get(n)+e;0==o?(r.matches.delete(n),i.push(n)):r.matches.set(n,o)}else r.matches.set(n,e),t.push(n)}),this.propagateMatchUpdates(t,i)}}function simpleQueryCalcUpdateQueuedMatches(){for(var e=[],t=[],i=this.addedMatches.length,r=0;r<i;++r){var n=this.addedMatches[r];if(void 0===this.matches)e=0==e.length?n:cconcat(e,n);else for(var o=0,s=n.length;o<s;++o){var a=n[o];this.matches.has(a)?this.matches.set(a,this.matches.get(a)+1):(this.matches.set(a,1),e.push(a))}}i>0&&(this.addedMatches=[]),i=this.removedMatches.length;for(var r=0;r<i;++r){var d=this.removedMatches[r];if(void 0===this.matches)t=0==t.length?d:cconcat(t,d);else for(var u=0,h=d.length;u<h;++u){var a=d[u],l=this.matches.get(a)-1;0==l?(this.matches.delete(a),t.push(a)):this.matches.set(a,l)}}i>0&&(this.removedMatches=[]),this.propagateMatchUpdates(e,t)}function simpleQueryCalcRemoveAllIndexerMatches(){var e=this.getMatches();void 0!==this.matches&&this.matches.clear(),this.propagateMatchUpdates([],e)}function simpleQueryCalcPropagateMatchUpdates(e,t){this.isGeneratingProjection()?this.isSuspendedProjection()?this.unsuspend():(t.length&&this.removeOldSelectionProjMatches(t),e.length&&this.addNewSelectionProjMatches(e)):(t.length&&this.matchParent.removeMatches(t,this),e.length&&this.matchParent.addMatches(e,this))}function simpleQueryCalcGetMatches(){if(void 0!==this.matches)return this.InternalQueryCalc_getMatches();var e=this.indexer.getSimpleQueryQueuedUpdates(this);e&&0==e.size&&(e=void 0);var t=[],i=this;return this.disjoint.forEach(function(r,n){r.valueIds.forEach(function(r,o){var s=i.indexer.getSimpleQueryValueMatches(i,o,n,r);if(void 0===e)t=0==t.length?s:cconcat(t,s);else for(var a=0,d=s.length;a<d;++a){var u=s[a];e.has(u)&&0!=e.get(u)||t.push(u)}})}),void 0!==e&&e.forEach(function(e,i){e<0&&t.push(i)}),t}function simpleQueryCalcGetMatchesAsObj(){if(void 0!==this.matches)return this.matches;var e=this.indexer.getSimpleQueryQueuedUpdates(this);e&&0==e.size&&(e=void 0);var t=new Map,i=this;return this.disjoint.forEach(function(r,n){r.valueIds.forEach(function(r,o){var s=i.indexer.getSimpleQueryValueMatches(i,o,n,r);if(void 0===e)for(var a=0,d=s.length;a<d;++a)t.set(s[a],1);else for(var a=0,d=s.length;a<d;++a){var u=s[a];e.has(u)&&0!=e.get(u)||t.set(u,1)}})}),void 0!==e&&e.forEach(function(e,i){e<0&&t.set(i,1)}),t}function simpleQueryCalcGetFullyRaisedMatches(){if(!this.lowerThanQueryPrefixFullMatches())return this.getMatches();for(var e=this.getMatches(),t=[],i=this.indexer.getDataElements(),r=this.rootQueryCalc.prefixProjPathId,n=0,o=e.length;n<o;++n){var s=e[n];i.getPathId(s)<=r&&t.push(s)}return t}function simpleQueryCalcGetFullyRaisedMatchesAsObj(){if(!this.lowerThanQueryPrefixFullMatches())return this.getMatchesAsObj();for(var e=this.getMatches(),t=new Map,i=this.indexer.getDataElements(),r=this.rootQueryCalc.prefixProjPathId,n=0,o=e.length;n<o;++n){var s=e[n];i.getPathId(s)<=r&&t.set(s,1)}return t}function simpleQueryCalcFilterMatches(e){if(void 0!==this.matches)return this.InternalQueryCalc_filterMatches(e);for(var t=this.getMatchesAsObj(),i=[],r=0,n=e.length;r<n;++r){var o=e[r];t.has(o)&&i.push(o)}return i}function simpleQueryCalcFilterMatchPositions(e){if(void 0!==this.matches)return this.InternalQueryCalc_filterMatchPositions(e);for(var t=this.getMatchesAsObj(),i=[],r=0,n=e.length;r<n;++r){var o=e[r];t.has(o)&&i.push(r)}return i}function simpleQueryCalcAddProjMatches(e,t){if(!this.isSuspendedProjection()){for(var i=[],r=0,n=e.length;r<n;++r){var o=e[r];this.matches.has(o)&&i.push(o)}this.addSelectionProjMatches(i,t)}}function simpleQueryCalcAddNewSelectionProjMatches(e){var t=this;this.rootQueryCalc.getQueryResults().forEach(function(i,r){var n=t.matchParent.filterProjMatches(e,r);t.addSelectionProjMatches(n,r)})}function simpleQueryCalcRemoveProjMatches(e,t){if(!this.isSuspendedProjection()){for(var i=[],r=0,n=e.length;r<n;++r){var o=e[r];this.matches.has(o)&&i.push(o)}this.removeSelectionProjMatches(i,t)}}function simpleQueryCalcRemoveOldSelectionProjMatches(e){var t=this;this.rootQueryCalc.getQueryResults().forEach(function(i,r){var n=t.matchParent.filterProjMatches(e,r);t.removeSelectionProjMatches(n,r)})}function ProjectionQueryCalc(e,t){this.InternalQueryCalc(e),this.projMatches=void 0,this.pathId=t,this.indexer.qcm.allocatePathIdByPathId(t),this.mustGenerateMatches=void 0,this.initialRefreshCompleted=!1,this.registeredToIndexerForMatches=!1,this.doNotIndex=!0}function projectionQueryCalcDestroy(){this.rootQueryCalc.removeGeneratingProj(this),this.detachFromIndexer(),this.InternalQueryCalc_destroy()}function projectionQueryCalcIsSelection(){return!this.registeredToIndexerForMatches}function projectionQueryCalcIsProjection(){return!0}function projectionQueryCalcIsGeneratingProjection(){return!0}function projectionQueryCalcIsTrivialProj(){return this.pathId==this.rootQueryCalc.prefixProjPathId}function projectionQueryCalcIsPureProj(){
return this.rootQueryCalc.isPureProjection()}function projectionQueryCalcHasExplicitProjMatches(e){return void 0!==this.projMatches&&this.projMatches.has(e)}function projectionQueryCalcNeedsToRegisterToIndexerForMatches(){return void 0!==this.projMatches&&this.projMatches.size>0||this.mustAddMatches||void 0!==this.mustGenerateMatches&&this.mustGenerateMatches.size>0}function projectionQueryCalcRegisterToIndexer(){var e=this.needsToRegisterToIndexerForMatches();this.registeredToIndexerForMatches!==e&&(this.registeredToIndexerForMatches=e,this.indexer.addQueryCalcToPathNode(this))}function projectionQueryCalcRefreshMustGenerateMatches(){if(this.matchParent!=this.rootQueryCalc&&this.matchParent.addsProjMatchesToSubNodes()){if(void 0===this.mustGenerateMatches)return;return this.mustGenerateMatches=void 0,void this.registerToIndexer()}if(void 0===this.mustGenerateMatches){this.mustGenerateMatches=new Map;var e=this.rootQueryCalc.getQueryResults(),t=this;e.forEach(function(e,i){e.projMustGenerateMatches()&&t.mustGenerateMatches.set(i,!0)}),this.mustGenerateMatches.size>0&&this.registerToIndexer()}}function projectionQueryCalcRefreshProjMustGenerateMatches(e,t){void 0!==this.mustGenerateMatches&&(t?this.mustGenerateMatches.has(e)||(this.mustGenerateMatches.set(e,!0),this.registerToIndexer()):this.mustGenerateMatches.has(e)&&(this.mustGenerateMatches.delete(e),this.registerToIndexer()))}function projectionQueryCalcRemoveResultProjMatches(e){void 0!==this.mustGenerateMatches&&this.mustGenerateMatches.has(e)&&this.mustGenerateMatches.delete(e),this.InternalQueryCalc_removeResultProjMatches(e),this.registerToIndexer()}function projectionQueryCalcSetMatchPoints(e){this.matchPoints=new Map;for(var t=0,i=e.length;t<i;++t){var r=e[t];this.matchPoints.set(r,1),this.matchParent.addToMatchPoints(r,this)}}function projectionQueryCalcAddToMatchPoints(e){this.matchPoints.set(e,1),this.matchParent.addToMatchPoints(e,this)}function projectionQueryCalcRemoveFromMatchPoints(e){this.matchPoints.delete(e),this.matchParent.removeFromMatchPoints(e,this)}function projectionQueryCalcRefreshQueryStructure(){this.initialRefreshCompleted||this.rootQueryCalc.addSimpleGeneratingProj(this)}function projectionQueryCalcRefreshMatchPoints(){this.indexer.addQueryCalcToPathNode(this)}function projectionQueryCalcRefreshMatches(){this.refreshMustGenerateMatches(),this.initialRefreshCompleted||this.checkRequiredExplicitProjMatches(),this.unsuspend(),this.initialRefreshCompleted=!0}function projectionQueryCalcSuspendProjMatches(){if(!this.isTrivialProj()&&this.initialRefreshCompleted){var e=this.rootQueryCalc.getQueryResults(),t=this;e.forEach(function(e,i){if(void 0===t.projMatches||!t.projMatches.has(i)){t.registerToIndexer();for(var r=t.getProjMatches(i),n=t.getProjMatchesEntry(i),o=0,s=r.length;o<s;++o)n.set(r[o],1)}})}}function projectionQueryCalcSetSelectionMode(){}function projectionQueryCalcSetProjectionMode(){}function projectionQueryCalcSetSuspendedProjectionMode(){}function projectionQueryCalcAddMatches(e,t){if(0!=e.length){this.mustAddMatches&&(this.projectionSuspended=!0,this.matchParent.addMatches(e,this),this.projectionSuspended=void 0);var i=this.rootQueryCalc.getQueryResults();if(void 0!==this.projMatches&&this.projMatches.size>0){var r=this;this.projMatches.forEach(function(t,n){for(var o=r.matchParent.filterProjMatches(e,n),s=[],a=0,d=o.length;a<d;++a){var u=o[a];t.set(u,1),s.push(u)}s.length&&i.get(n).addTerminalProjMatches(r,s)})}this.addMatchesToMustGenerateMatches(e)}}function projectionQueryCalcAddMatchesToMustGenerateMatches(e){if(void 0!==this.mustGenerateMatches&&0!=this.mustGenerateMatches.size){var t=this.rootQueryCalc.getQueryResults(),i=this;this.mustGenerateMatches.forEach(function(r,n){var o=t.get(n);return o.projMustGenerateMatches()?void(void 0!==i.projMatches&&i.projMatches.has(n)||o.addTerminalProjMatches(i,e)):(i.mustGenerateMatches.delete(n),void i.registerToIndexer())})}}function projectionQueryCalcRemoveMatches(e){this.mustAddMatches&&(this.projectionSuspended=!0,this.matchParent.removeMatches(e,this),this.projectionSuspended=void 0);var t=this.rootQueryCalc.getQueryResults();if(void 0!==this.projMatches&&this.projMatches.size>0){var i=this;this.projMatches.forEach(function(r,n){for(var o=[],s=0,a=e.length;s<a;++s){var d=e[s];r.has(d)&&(r.delete(d),o.push(d))}o.length&&t.get(n).removeTerminalProjMatches(i,o)})}this.removeMatchesFromMustGenerateMatches(e)}function projectionQueryCalcRemoveMatchesFromMustGenerateMatches(e){if(void 0!==this.mustGenerateMatches&&0!=this.mustGenerateMatches.size){var t=this.rootQueryCalc.getQueryResults(),i=this;this.mustGenerateMatches.forEach(function(r,n){var o=t.get(n);return o.projMustGenerateMatches()?void(void 0!==i.projMatches&&i.projMatches.has(n)||o.removeTerminalProjMatches(i,e)):(i.mustGenerateMatches.delete(n),void i.registerToIndexer())})}}function projectionQueryCalcRemoveAllIndexerMatches(){this.removeMatches(this.indexer.getAllMatches(this.pathId))}function projectionQueryCalcAddProjMatches(e,t){if(!this.isSuspendedProjection()&&0!=e.length){if(this.hasExplicitProjMatches(t)){var i=this.getProjMatchesEntry(t);e=this.indexer.filterDataNodesAtPath(this.pathId,e);for(var r=0,n=e.length;r<n;++r){var o=e[r];i.set(o,1)}}else void 0!==this.mustGenerateMatches&&this.mustGenerateMatches.has(t)&&(e=this.indexer.filterDataNodesAtPath(this.pathId,e));var s=this.rootQueryCalc.getQueryResults().get(t);s.addTerminalProjMatches(this,e)}}function projectionQueryCalcRemoveProjMatches(e,t){if(!this.isSuspendedProjection()&&0!=e.length){var i;if(this.hasExplicitProjMatches(t)){var r=this.getProjMatchesEntry(t);i=[];for(var n=0,o=e.length;n<o;++n){var s=e[n];r.has(s)&&(r.delete(s),i.push(s))}if(0==i.length)return}else i=e;var a=this.rootQueryCalc.getQueryResults().get(t);a.removeTerminalProjMatches(this,i)}}function projectionQueryCalcSetProjMatches(e){var t,i=this.rootQueryCalc.getQueryResults();void 0===e?(t=[],i.forEach(function(e,i){t.push(i)})):t=[e];for(var r,n=0;n<t.length;++n){e=t[n];var o=this.projMatches?this.projMatches.get(e):void 0,s=i.get(e);void 0===o&&s.requiresExplicitProjMatches(this.rootQueryCalc)&&(o=new Map);var a;void 0!==o&&(a=this.initEmptyProjMatches(e),this.registerToIndexer());var d=this.matchParent.getProjMatches(e);void 0!==d&&void 0!==o&&(d=this.indexer.filterDataNodesAtPath(this.pathId,d)),void 0==d&&(r||(r=this.indexer.getAllMatches(this.pathId)),d=r);var u,h;if(void 0!==o)if(void 0===a&&(a=this.initEmptyProjMatches(e)),0==o.size){for(var l=0,c=d.length;l<c;++l)a.set(d[l],1);u=d}else{u=[];for(var l=0,c=d.length;l<c;++l){var p=d[l];a.set(p,1),o.has(p)?o.delete(p):u.push(p)}h=[],o.forEach(function(e,t){h.push(t)})}else u=d;u.length&&s.addTerminalProjMatches(this,u),void 0!==h&&h.length&&s.removeTerminalProjMatches(this,h)}}function projectionQueryCalcCheckRequiredExplicitProjMatches(){var e=this.rootQueryCalc.getQueryResults();if(0!==e.size){var t=this;e.forEach(function(e,i){e.requiresExplicitProjMatches(t.rootQueryCalc)&&t.initEmptyProjMatches(i)})}}function projectionQueryCalcInitExplicitProjMatches(e,t){var i=this.initEmptyProjMatches(e);if(this.registerToIndexer(),void 0!==t){t=this.indexer.filterDataNodesAtPath(this.pathId,t),i.expectSize(t.length);for(var r=0,n=t.length;r<n;++r)i.set(t[r],1)}}function projectionQueryCalcSetExplicitProjMatches(e){if(!this.isTrivialProj()&&!this.hasExplicitProjMatches(e)){var t=this.initEmptyProjMatches(e);if(this.registerToIndexer(),this.initialRefreshCompleted){var i,r=this.matchParent.getProjMatches(e);if(void 0!==r){var n=this.indexer.filterDataNodesAtPathWithDiff(this.pathId,r);r=n.matches,i=n.removed}else r=this.indexer.getAllMatches(this.pathId);if(void 0!==r)for(var o=0,s=r.length;o<s;++o)t.set(r[o],1);if(void 0!==i&&0!=i.length&&(void 0===this.mustGenerateMatches||!this.mustGenerateMatches.has(e))){var a=this.rootQueryCalc.getQueryResults().get(e);a.removeTerminalProjMatches(this,i)}}}}function projectionQueryCalcReleaseExplicitProjMatches(e){if(!this.isTrivialProj()&&this.hasExplicitProjMatches(e)){var t,i=this.matchParent.getProjMatches(e);if(void 0!==i)for(var r=this.getProjMatchesEntry(e),t=[],n=0,o=i.length;n<o;++n){var s=i[n];r.has(s)||t.push(s)}if(this.projMatches.delete(e),this.registerToIndexer(),void 0!==t&&0!=t.length&&(void 0===this.mustGenerateMatches||!this.mustGenerateMatches.has(e))){var a=this.rootQueryCalc.getQueryResults().get(e);a.addTerminalProjMatches(this,t)}}}function projectionQueryCalcGetMatches(){return this.indexer.getAllMatches(this.pathId)}function projectionQueryCalcGetMatchesAsObj(){return this.indexer.getAllMatchesAsObj(this.pathId)}function projectionQueryCalcGetFullyRaisedMatches(){var e=this.indexer.getAllMatches(this.pathId);if(!this.lowerThanQueryPrefixFullMatches())return e;for(var t=[],i=this.indexer.getDataElements(),r=this.rootQueryCalc.prefixProjPathId,n=0,o=e.length;n<o;++n){var s=e[n];i.getPathId(s)<=r&&t.push(s)}return t}function projectionQueryCalcGetFullyRaisedMatchesAsObj(){if(!this.lowerThanQueryPrefixFullMatches())return this.getMatchesAsObj();for(var e=this.indexer.getAllMatches(this.pathId),t=new Map,i=this.indexer.getDataElements(),r=this.rootQueryCalc.prefixProjPathId,n=0,o=e.length;n<o;++n){var s=e[n];i.getPathId(s)<=r&&t.set(s,!0)}return t}function projectionQueryCalcFilterMatches(e){return this.indexer.filterDataNodesAtPath(this.pathId,e)}function projectionQueryCalcFilterMatchPositions(e){return this.indexer.filterDataNodesAtPathPositions(this.pathId,e)}function projectionQueryCalcGetProjMatches(e){var t=this.InternalQueryCalc_getProjMatches(e);if(void 0!==t)return t;var t=this.matchParent.getProjMatches(e);return void 0!==t?(void 0!==this.mustGenerateMatches&&this.mustGenerateMatches.has(e)&&(t=this.indexer.filterDataNodesAtPath(this.pathId,t)),t):this.indexer.getAllMatches(this.pathId)}function projectionQueryCalcGetProjMatchesAsObj(e){var t=this.InternalQueryCalc_getProjMatchesAsObj(e);if(void 0!==t)return t;var t;if(void 0!==this.mustGenerateMatches&&this.mustGenerateMatches.has(e)){if(t=this.matchParent.getProjMatches(e),void 0!==t){t=this.indexer.filterDataNodesAtPath(this.pathId,t);for(var i=new Map,r=0,n=t.length;r<n;++r)i.set(t[r],!0);return i}}else if(t=this.matchParent.getProjMatchesAsObj(e),void 0!==t)return t;return this.indexer.getAllMatchesAsObj(this.pathId)}function internalQueryCalcGetExplicitProjMatches(e){return this.InternalQueryCalc_getProjMatches(e)}function projectionQueryCalcFilterProjMatches(e,t){var i=this.InternalQueryCalc_filterProjMatches(e,t);return void 0!==i?i:(i=this.matchParent.filterProjMatches(e,t),i===e?this.indexer.filterDataNodesAtPath(this.pathId,e):i)}function UnionQueryCalc(e){this.InternalQueryCalc(e),this.matches=new IntHashMapUint(0)}function unionQueryCalcDestroy(){this.InternalQueryCalc_destroy()}function unionQueryCalcSplice(){var e,t,i=this.getId();for(t in this.subNodes)e=this.subNodes[t];e||this.destroy(),e.matchParent=this.matchParent,e.parent=this.parent,this.matchParent==this.rootQueryCalc?this.rootQueryCalc.queryCalc=e:(delete this.matchParent.subNodes[i],this.matchParent.subNodes[t]=e,this.matchParent.projSubNodes[i]&&(delete this.matchParent.projSubNodes[i],this.matchParent.projSubNodes[t]=e)),this.destroy()}function unionQueryCalcIsProjection(){return!!this.projSubNodeNum}function unionQueryCalcIsUnion(){return!0}function unionQueryCalcShouldAddMatches(){return!this.isProjection()||this.mustAddMatches}function unionQueryCalcIsGeneratingProjection(){return!1}function unionQueryCalcIsSelectionProjection(){return!1}function unionQueryCalcAddToMatchPoints(e,t){if(this.matchPoints.has(e)){var i=this.matchPoints.get(e)+1;this.matchPoints.set(e,i)}else this.matchPoints.set(e,1),this.matchParent.addToMatchPoints(e,this)}function unionQueryCalcRemoveFromMatchPoints(e,t){var i=this.matchPoints.get(e)-1;0===i?(this.matchPoints.delete(e),this.matchParent.removeFromMatchPoints(e,this)):this.matchPoints.set(e,i)}function unionQueryCalcUpdateQueryAfterNodeRemoval(e){var t=this.isProjection()&&this.subProjMustAddMatches(),i=e.getId(),r=!(i in this.subNodes),n=this.projSubNodeNum&&i in this.projSubNodes;if(n&&(delete this.projSubNodes[i],this.projSubNodeNum--,0==this.projSubNodeNum&&(this.matchParent.updateQueryAfterNodeRemoval(this),!t)))for(var o in this.subNodes)o!=i&&this.subNodes[o].unsetSelectionProjection();this.updateMatchingAfterRemoval(e,n,r,t)}function unionQueryCalcUpdateMatchingAfterRemoval(e,t,i,r){if(i){var n=this;e.getFullCountMatchPoints().forEach(function(t,i){n.removeFromMatchPoints(i,e)}),(!t&&!this.isProjection()||r)&&this.removeMatches(e.getMatches(),e)}if(t&&!this.isProjection()&&!r)for(var o in this.subNodes)this.addMatches(this.subNodes[o].getMatches(),this.subNodes[o])}function unionQueryCalcUnsetSubProjsMustAddMatches(){this.matches=new IntHashMapUint(this.subNodeNum);for(var e in this.subNodes)this.subNodes[e].unsetMustAddMatches()}function unionQueryCalcRefreshQueryStructure(){var e=this.projSubNodeNum?this.projSubNodeNum:0;for(var t in this.updatedSubNodes){var i=this.updatedSubNodes[t],r=this.subNodes[t],n=r.isProjection();r.refreshQueryStructure(),!i&&n||!r.isProjection()||(this.projSubNodes||(this.projSubNodes={}),this.projSubNodes[t]=r,this.projSubNodeNum?this.projSubNodeNum++:this.projSubNodeNum=1)}if(this.isProjection()&&!e&&!this.mustAddMatches){this.justBecameProjection=!0;for(var t in this.subNodes){var o=this.subNodes[t];o.isProjection()||(this.updatedSubNodes[t]&&o.suspendProjection(),o.setSelectionProjection())}}}function unionQueryCalcSetSubProjsMustAddMatches(){for(var e in this.subNodes){var t=this.subNodes[e];t.isProjection()?t.setMustAddMatches():t.unsetSelectionProjection()}this.justStartedAddingMatches=!0,this.justBecameProjection&&delete this.justBecameProjection}function unionQueryCalcRefreshMatchPoints(){for(var e in this.updatedSubNodes){var t=this.subNodes[e];if(this.updatedSubNodes[e]){var i=this;t.getFullCountMatchPoints().forEach(function(e,r){i.addToMatchPoints(r,t)})}t.refreshMatchPoints()}}function unionQueryCalcRefreshMatches(){if(this.justBecameProjection){this.matches=new IntHashMapUint(this.subNodeNum);for(var e in this.subNodes)e in this.updatedSubNodes?this.subNodes[e].refreshMatches():this.subNodes[e].setProjMatches()}else if(this.justStartedAddingMatches){this.matches.adjustByteNumber(this.subNodeNum);for(var e in this.subNodes)i=this.subNodes[e],this.addMatches(i.getMatches(),i),i.refreshMatches()}else{this.matches.adjustByteNumber(this.subNodeNum);var t=!this.isProjection()||this.mustAddMatches;for(var e in this.updatedSubNodes){var i=this.subNodes[e];t&&this.updatedSubNodes[e]&&this.addMatches(i.getMatches(),i),i.refreshMatches()}}this.unsuspend(),this.updatedSubNodes=void 0,this.justBecameProjection&&(this.justBecameProjection=void 0),this.justStartedAddingMatches&&(this.justStartedAddingMatches=void 0)}function unionQueryCalcSuspendProjMatches(){}function unionQueryCalcSetSelectionMode(){}function unionQueryCalcSetProjectionMode(){}function unionQueryCalcSetSuspendedProjectionMode(){}function unionQueryCalcAddMatches(e,t){var i=e.length;if(0!=i){for(var r=[],n=0,o=e.length;n<o;++n){var s=e[n];this.matches.has(s)?this.matches.set(s,this.matches.get(s)+1):(this.matches.set(s,1),r.push(s))}r.length&&this.matchParent.addMatches(r,this)}}function unionQueryCalcRemoveMatches(e,t){for(var i=[],r=0,n=e.length;r<n;++r){var o=e[r],s=this.matches.get(o)-1;0==s?(i.push(o),this.matches.delete(o)):this.matches.set(o,s)}i.length&&this.matchParent.removeMatches(i,this)}function unionQueryCalcSetProjMatches(e){if(this.isProjection())if(this.mustAddMatches)for(var t in this.projSubNodes)this.projSubNodes[t].setProjMatches(e);else for(var t in this.subNodes)this.projSubNodes[t].setProjMatches(e)}function unionQueryCalcAddProjMatches(e,t){if(this.mustAddMatches)for(var i in this.projSubNodes)this.projSubNodes[i].addProjMatches(e,t);else for(var i in this.subNodes)this.projSubNodes[i].addProjMatches(e,t)}function unionQueryCalcRemoveProjMatches(e,t){if(this.mustAddMatches)for(var i in this.projSubNodes)this.projSubNodes[i].removeProjMatches(e,t);else for(var i in this.subNodes)this.projSubNodes[i].removeProjMatches(e,t)}function unionQueryCalcGetProjMatches(e){return this.matchParent.getProjMatches(e)}function unionQueryCalcFilterProjMatches(e,t){return this.matchParent.filterProjMatches(e,t)}function NegationQueryCalc(e,t){this.InternalQueryCalc(e),this.matches=void 0,this.pathId=t,this.indexer.qcm.allocatePathIdByPathId(t),this.numLowerMatchPoints=0,this.initialUpdate=!0,this.pendingUpdates=void 0}function negationQueryCalcDestroy(){this.detachFromIndexer(),this.InternalQueryCalc_destroy()}function negationQueryCalcMaxMatchCount(){return 2*this.subNodeNum+1}function negationQueryCalcIsSelection(){return!1}function negationQueryCalcIsProjection(){return!!this.projSubNodeNum}function negationQueryCalcIsNegation(){return!0}function negationQueryCalcIsGeneratingProjection(){return this.isSelectionProjection()&&!this.matchParent.mustAddMatches}function negationQueryCalcSetMatchPoints(e){for(var t=0,i=e.length;t<i;++t){var r=e[t];this.matchPoints.set(r,1),this.matchParent&&this.matchParent.addToMatchPoints(r,this)}}function negationQueryCalcAddToMatchPoints(e,t){if(t==this.indexer)return this.matchPoints.set(e,1),void this.matchParent.addToMatchPoints(e,this);if(!(e<=this.pathId)){var i=t.isProjection();i&&!this.mustAddMatches||this.numLowerMatchPoints++,i&&(this.projMatchPoints||(this.projMatchPoints=new Map),this.projMatchPoints.has(e)?(count=this.projMatchPoints.get(e)+1,this.projMatchPoints.set(e,count)):this.projMatchPoints.set(e,1))}}function negationQueryCalcRemoveFromMatchPoints(e,t){if(t==this.indexer)return this.matchPoints.delete(e),void this.matchParent.removeFromMatchPoints(e,this);if(!(e<=this.pathId)){var i=t.isProjection();if(i&&!this.mustAddMatches||this.numLowerMatchPoints--,i){var r=this.projMatchPoints.get(e)-1;0===r?this.projMatchPoints.delete(e):this.projMatchPoints.set(e,r)}}}function negationQueryCalcUpdateQueryAfterNodeRemoval(e){var t=this.isProjection()&&this.subProjMustAddMatches(),i=e.getId(),r=!(i in this.subNodes),n=void 0!==this.projSubNodes&&i in this.projSubNodes;n&&(delete this.projSubNodes[i],this.projSubNodeNum--,0==this.projSubNodeNum&&(this.matchParent.updateQueryAfterNodeRemoval(this),this.isGeneratingProjection()&&this.rootQueryCalc.addSelectionGeneratingProj(this))),this.updateMatchingAfterRemoval(e,n,r,t)}function negationQueryCalcUnsetSubProjsMustAddMatches(){void 0!==this.projMatchPoints&&(this.numLowerMatchPoints-=this.projMatchPoints.size),this.clearProjSelectionMatches();for(var e in this.projSubNodes)this.projSubNodes[e].unsetMustAddMatches()}function negationQueryCalcUpdateMatchingAfterRemoval(e,t,i,r){t?this.isProjection()?r&&this.removeMatches(e.getMatches(),e,!0):this.resetProjMatchesAfterNodeRemoval(r):this.removeMatches(e.getMatches(),e),this.updateMatchPointsAfterRemoval(e,t,i,r),i||this.addMatches(e.getMatches(),e),this.unsuspend()}function negationQueryCalcUpdateMatchPointsAfterRemoval(e,t,i,r){if(this.numLowerMatchPoints||void 0!==this.projMatchPoints&&this.projMatchPoints.size>0){var n=this;e.getFullCountMatchPoints().forEach(function(e,o){if(!(o<=n.negated)){if(!i||t&&!r||n.numLowerMatchPoints--,t){var s=n.projMatchPoints.get(o)-1;0===s?n.projMatchPoints.delete(o):n.projMatchPoints.set(o,s)}i||r||n.numLowerMatchPoints++}})}}function negationQueryCalcRefreshQueryStructure(){var e=this.projSubNodeNum?this.projSubNodeNum:0;for(var t in this.updatedSubNodes){var i=this.updatedSubNodes[t],r=this.subNodes[t],n=r.isProjection();r.refreshQueryStructure(),!i&&n||!r.isProjection()||(this.projSubNodes||(this.projSubNodes={}),this.projSubNodes[t]=r,this.projSubNodeNum?this.projSubNodeNum++:this.projSubNodeNum=1,i||(this.selectionBecameProjection||(this.selectionBecameProjection={}),this.selectionBecameProjection[t]=!0))}this.projSubNodeNum>0&&0==e&&this.rootQueryCalc.removeGeneratingProj(this),this.parent&&this.parent.subProjMustAddMatches()&&this.setMustAddMatches()}function negationQueryCalcSetSubProjsMustAddMatches(){this.projMatchPoints=new Map;for(var e in this.projSubNodes)this.projSubNodes[e].setMustAddMatches(),this.addUpdatedSubNode(e,!0)}function negationQueryCalcRefreshMatchPoints(){this.initialUpdate=!this.matchPoints.has(this.indexer.qcm.getRootPathId()),this.initialUpdate&&this.indexer.addQueryCalcToPathNode(this);var e=this;for(var t in this.updatedSubNodes){var i=this.subNodes[t];if(this.updatedSubNodes[t])i.getFullCountMatchPoints().forEach(function(t,r){r<=e.pathId||e.addToMatchPoints(r,i)});else if(this.selectionBecameProjection&&this.selectionBecameProjection[t]){var r=0;i.getFullCountMatchPoints().forEach(function(t,n){n<=e.pathId||(r++,e.addToMatchPoints(n,i))}),this.numLowerMatchPoints-=r}i.refreshMatchPoints()}}function negationQueryCalcRefreshMatches(){if(this.initialUpdate)this.initialRefreshMatches();else{if(this.subNodeNum>0)if(void 0===this.matches){var e=this.indexer.getAllMatches(this.pathId);this.matches=new IntHashMapUint(this.maxMatchCount(),e.length);for(var t=0,i=e.length;t<i;++t)this.matches.set(e[t],1)}else this.matches.adjustByteNumber(this.maxMatchCount());if(this.selectionBecameProjection){this.suspend();for(var r in this.selectionBecameProjection){var n=this.subNodes[r];this.removeMatches(n.getMatches(),n,!1)}}this.isProjection()&&this.mustAddMatches&&this.initProjSelectionMatches();for(var r in this.updatedSubNodes){var n=this.subNodes[r];!this.updatedSubNodes[r]||this.projSubMatches&&r in this.projSubNodes&&!subProjMustAddMatches||(this.suspend(),this.addMatches(n.getMatches(),n)),n.refreshMatches()}0==this.subNodeNum&&void 0!==this.matches&&(this.matches=void 0)}this.unsuspend(),this.updatedSubNodes=void 0,this.initialUpdate=void 0,this.selectionBecameProjection&&(this.selectionBecameProjection=void 0)}function negationQueryCalcInitialRefreshMatches(){this.subNodeNum>0&&(this.matches=new IntHashMapUint(this.maxMatchCount()));var e=this.isProjection()&&this.mustAddMatches;e&&this.initProjSelectionMatches();for(var t in this.subNodes)if(!(this.projSubNodes&&t in this.projSubNodes)){var i=this.subNodes[t];this.addMatches(i.getMatches(),i),i.refreshMatches()}if(e)for(var t in this.projSubNodes){var i=this.subNodes[t];this.addMatches(i.getMatches(),i),i.refreshMatches()}else{var r=this.indexer.getAllMatches(this.pathId);this.addMatches(r,this.indexer)}}function negationQueryCalcSuspendSelection(){if(this.suspendedMatches=new Map,!this.initialUpdate)if(void 0!==this.matches){var e=this;this.matches.forEach(function(t,i){1==t&&e.suspendedMatches.set(i,!0)})}else for(var t=this.indexer.getAllMatches(this.pathId),i=0,r=t.length;i<r;++i)this.suspendedMatches.set(t[i],1)}function negationQueryCalcSuspendProjMatches(e){if(void 0!==this.projMatchPoints&&0!==!this.projMatchPoints.size&&this.projMatches){var t=this.indexer.getDataElements(),i=[];this.projMatchPoints.forEach(function(e,t){i.push(t)});var r;e?r=[e]:(r=[],this.rootQueryCalc.getQueryResults().forEach(function(e,t){r.push(t)}));for(var n=0,o=r.length;n<o;++n){var e=r[n],s=this.projMatches.get(e);if(void 0!==s){var a=[];s.forEach(function(e,t){a.push(t)});var d=a.length;a=t.lowerDataElementsTo(a,i);for(var u=d,h=a.length;u<h;++u)s.set(a[u],1)}}}}function negationQueryCalcCalcNewFullMatchesAfterSuspension(){if(this.shouldAddMatches()){if(0==this.suspendedMatches.size)return this.getMatches();if(void 0===this.matches){for(var e=this.indexer.getAllMatches(this.pathId),t=[],i=0,r=e.length;i<r;++i){var n=e[i];this.suspendedMatches.has(n)&&1==this.suspendedMatches.has(n)||t.push(n)}return t}var t=[],o=this;return this.matches.forEach(function(e,i){1!=e||o.suspendedMatches.has(i)&&1==o.suspendedMatches.has(i)||t.push(i)}),t}}function negationQueryCalcCalcRemovedSuspendedMatches(){if(0==this.suspendedMatches.size)return[];var e=[];if(void 0===this.matches){var t=[];this.suspendedMatches.forEach(function(e,i){1==e&&t.push(i)});var i=this.indexer.filterDataNodesAtPathWithDiff(this.pathId,t);return i.removed}var r=this;return this.suspendedMatches.forEach(function(t,i){1==t&&1!=r.matches.get(i)&&e.push(i)}),e}function negationQueryCalcSetSelectionMode(){}function negationQueryCalcSetProjectionMode(){}function negationQueryCalcSetSuspendedMode(){}function negationQueryCalcSetSuspendedProjectionMode(){}function negationQueryCalcInitProjSelectionMatches(){this.projSelectionMatches||(this.projSelectionMatches=new Map,this.initialUpdate||(this.suspend(),void 0!==this.matches&&this.matches.forEach(function(e,t){if(e%2!==0){var i=e-1;0==i?this.matches.delete(t):this.matches.set(t,i)}})))}function negationQueryCalcClearProjSelectionMatches(){if(this.projSelectionMatches){delete this.projSelectionMatches;for(var e=this.indexer.getAllMatches(this.pathId),t=[],i=0,r=e.length;i<r;++i){var n=e[i];if(this.matches.has(n)){var o=this.matches.get(n);if(o%2!==0)continue;this.matches.set(n,o+1)}else this.matches.set(n,1),t.push(n)}this.isSuspended()||(this.isProjection()?(this.disableProjUpdateAndAddMatchesToParent(t),this.isSuspendedProjection()||this.addNewMatchesToProjMatches(t)):this.shouldAddMatches()&&this.matchParent.addMatches(t,this))}}function negationQueryCalcAddMatches(e,t){if(0!=e.length)return void 0!==this.pendingUpdates?void this.pendingUpdates.push({elementIds:e,source:t,isAdd:!0}):void(t==this.indexer?this.addIndexerMatches(e):t.isProjection()?this.addProjSelectionMatches(e):this.addSelectionMatches(e))}function negationQueryCalcRemoveMatches(e,t,i,r){if(t==this.indexer)this.removeIndexerMatches(e);else{if(!r&&(void 0!==this.pendingUpdates||(!this.isProjection()||!this.mustAddMatches)&&this.indexer.pathHasRemovalsPending(this.pathId,this.id)))return void 0===this.pendingUpdates&&(this.pendingUpdates=[]),void this.pendingUpdates.push({elementIds:e,source:t,isProjection:i,isAdd:!1});void 0===i&&(i=t.isProjection()),i?this.removeProjSelectionMatches(e):this.removeSelectionMatches(e)}}function negationQueryCalcAddIndexerMatches(e){if(!(0==e.length||this.isProjection()&&this.mustAddMatches)){if(void 0===this.matches)return void this.matchParent.addMatches(e,this);this.matches.expectSize(e.length);for(var t=[],i=0,r=e.length;i<r;++i){var n=e[i];if(this.matches.has(n)){var o=this.matches.get(n);o%2==0&&this.matches.set(n,o+1)}else this.matches.set(n,1),t.push(n)}0==t.length||this.isSuspended()||(this.isProjection()||this.isSelectionProjection()?(this.shouldAddMatches()&&this.disableProjUpdateAndAddMatchesToParent(t),this.isSuspendedProjection()||this.addNewMatchesToProjMatches(t)):this.matchParent.addMatches(t,this))}}function negationQueryCalcRemoveIndexerMatches(e){if(!(0==e.length||this.isProjection()&&this.mustAddMatches)){if(void 0===this.matches)return void(this.isSuspended()||this.matchParent.removeMatches(e,this));for(var t=[],i=0,r=e.length;i<r;++i){var n=e[i];0==this.matches.dec(n,1)&&t.push(n)}0==t.length||this.isSuspended()||(this.isProjection()||this.isSelectionProjection()?(this.shouldAddMatches()&&this.disableProjUpdateAndRemoveMatchesFromParent(t),this.isSuspendedProjection()||this.removeOldMatchesFromProjMatches(t)):this.matchParent.removeMatches(t,this)),void 0!==this.pendingUpdates&&this.applyPendingUpdates()}}function negationQueryCalcApplyPendingUpdates(){if(void 0!==this.pendingUpdates){var e=this.pendingUpdates;this.pendingUpdates=void 0;for(var t=0,i=e.length;t<i;++t){var r=e[t];r.isAdd?this.addMatches(r.elementIds,r.source):this.removeMatches(r.elementIds,r.source,r.isProjection,!0)}}}function negationQueryCalcRemoveAllIndexerMatches(){if(!this.isProjection()||!this.mustAddMatches)if(void 0!==this.matches){var e=[],t=this;if(this.matches.forEach(function(i,r){i%2==1&&(0==--i?(t.matches.delete(r),e.push(r)):t.matches.set(r,i))}),0===e.length||this.isSuspended())return void(void 0!==this.pendingUpdates&&this.applyPendingUpdates());this.isProjection()||this.isSelectionProjection()?(this.shouldAddMatches()&&this.disableProjUpdateAndRemoveMatchesFromParent(e),this.isSuspendedProjection()||this.removeOldMatchesFromProjMatches(e)):this.matchParent.removeMatches(e,this),void 0!==this.pendingUpdates&&this.applyPendingUpdates()}else if(!this.isSuspended()){var i=this.indexer.getAllMatches(this.pathId);this.matchParent.removeMatches(i,this)}}function negationQueryCalcAddSelectionMatches(e){var t=[];if(this.matches.expectSize(e.length),this.numLowerMatchPoints)for(var i=this.indexer.getDataElements(),r=0,n=e.length;r<n;++r){var o=i.raiseToPath(e[r],this.pathId);if(this.matches.has(o)){var s=this.matches.get(o)+2;this.matches.set(o,s),3==s&&t.push(o)}else this.matches.set(o,2)}else for(var r=0,n=e.length;r<n;++r){var o=e[r];if(this.matches.has(o)){var s=this.matches.get(o)+2;this.matches.set(o,s),3==s&&t.push(o)}else this.matches.set(o,2)}0==t.length||this.isSuspended()||(this.isProjection()||this.isSelectionProjection()?(this.shouldAddMatches()&&this.disableProjUpdateAndRemoveMatchesFromParent(t),this.isSuspendedProjection()||this.removeOldMatchesFromProjMatches(t)):this.matchParent.removeMatches(t,this))}function negationQueryCalcRemoveSelectionMatches(e){var t=[];if(this.numLowerMatchPoints)for(var i=this.indexer.getDataElements(),r=0,n=e.length;r<n;++r){var o=i.raiseToPath(e[r],this.pathId);1==this.matches.dec(o,2)&&t.push(o)}else for(var r=0,n=e.length;r<n;++r){var o=e[r];1==this.matches.dec(o,2)&&t.push(o)}0==t.length||this.isSuspended()||(this.isProjection()||this.isSelectionProjection()?(this.shouldAddMatches()&&this.disableProjUpdateAndAddMatchesToParent(t),this.isSuspendedProjection()||this.addNewMatchesToProjMatches(t)):this.matchParent.addMatches(t,this))}function negationQueryCalcAddProjSelectionMatches(e){if(this.mustAddMatches){this.matches.expectSize(e.length);var t=[];if(this.numLowerMatchPoints)for(var i=this.indexer.getDataElements(),r=0,n=e.length;r<n;++r){var o=i.raiseToPath(e[r],this.pathId);this.projSelectionMatches.has(o)?this.projSelectionMatches.set(o,this.projSelectionMatches.get(o)+1):(this.projSelectionMatches.set(o,1),this.matches.has(o)?this.matches.set(o,this.matches.get(o)+1):(this.matches.set(o,1),t.push(o)))}else for(var r=0,n=e.length;r<n;++r){var o=e[r];this.projSelectionMatches.has(o)?this.projSelectionMatches.set(o,this.projSelectionMatches.get(o)+1):(this.projSelectionMatches.set(o,1),this.matches.has(o)?this.matches.set(o,this.matches.get(o)+1):(this.matches.set(o,1),t.push(o)))}0==t.length||this.isSuspended()||(this.shouldAddMatches()&&this.disableProjUpdateAndAddMatchesToParent(t),this.isSuspendedProjection()||this.addNewMatchesToProjMatches(t))}}function negationQueryCalcRemoveProjSelectionMatches(e){if(this.mustAddMatches){var t=[];if(this.numLowerMatchPoints)for(var i=this.indexer.getDataElements(),r=0,n=e.length;r<n;++r){var o=i.raiseToPath(e[r],this.pathId),s=this.projSelectionMatches.get(o)-1;if(0==s){this.projSelectionMatches.delete(o);var a=this.matches.get(o)-1;0==a?(this.matches.delete(o),t.push(o)):this.matches.set(o,a)}else this.projSelectionMatches.set(o,s)}else for(var r=0,n=e.length;r<n;++r){var o=e[r],s=this.projSelectionMatches.get(o)-1;if(0==s){this.projSelectionMatches.delete(o);var a=this.matches.get(o)-1;0==a?(this.matches.delete(o),t.push(o)):this.matches.set(o,a)}else this.projSelectionMatches.set(o,s)}0==t.length||this.isSuspended()||(this.shouldAddMatches()&&this.disableProjUpdateAndRemoveMatchesFromParent(t),this.isSuspendedProjection()||this.removeOldMatchesFromProjMatches(t))}}function negationQueryCalcDisableProjUpdateAndAddMatchesToParent(e){0!=e.length&&(this.isSuspendedProjection()?this.matchParent.addMatches(e,this):(this.projectionSuspended=!0,this.matchParent.addMatches(e,this),this.projectionSuspended=void 0))}function negationQueryCalcDisableProjUpdateAndRemoveMatchesFromParent(e){e.length&&(this.isSuspendedProjection()?this.matchParent.removeMatches(e,this):(this.projectionSuspended=!0,this.matchParent.removeMatches(e,this),this.projectionSuspended=void 0))}function negationQueryCalcAddProjMatches(e,t){if(!this.isSuspendedProjection()){
for(var i=[],r=0,n=e.length;r<n;++r){var o=e[r];1==this.matches.get(o)&&i.push(o)}if(this.isProjection()){i=this.lowerProjMatchesAndAdd(i,t);for(var s in this.projSubNodes)this.projSubNodes[s].addProjMatches(i,t)}else this.addSelectionProjMatches(i,t)}}function negationQueryCalcRemoveProjMatches(e,t){if(!this.isSuspendedProjection()){for(var i=[],r=0,n=e.length;r<n;++r){var o=e[r];1==this.matches.get(o)&&i.push(o)}this.isProjection()?this.lowerAndRemoveProjMatches(i,t):this.removeSelectionProjMatches(i,t)}}function negationQueryCalcAddNewMatchesToProjMatches(e){var t=this;this.rootQueryCalc.getQueryResults().forEach(function(i,r){var n=t.matchParent.filterProjMatches(e,r);if(t.isProjection()){n=t.lowerProjMatchesAndAdd(n,r);for(var o in t.projSubNodes)t.projSubNodes[o].addProjMatches(n,r)}else t.addSelectionProjMatches(n,r)})}function negationQueryCalcLowerProjMatchesAndAdd(e,t){for(var i=this.getProjMatchesEntry(t),r=0,n=e.length;r<n;++r)i.set(e[r],1);return void 0===this.projMatchPoints||0===this.projMatchPoints.size?e:this.lowerToProjMatchPoints(e,this.projMatchPoints)}function negationQueryCalcRemoveOldMatchesFromProjMatches(e){var t=this;this.rootQueryCalc.getQueryResults().forEach(function(i,r){var n=t.matchParent.filterProjMatches(e,r);t.isProjection()?t.lowerAndRemoveProjMatches(n,r):t.removeSelectionProjMatches(n,r)})}function negationQueryCalcLowerAndRemoveProjMatches(e,t){var i=this.getProjMatchesEntry(t),r=e.length;if(void 0===this.projMatchPoints||0===this.projMatchPoints.size)for(var n=0,o=e.length;n<o;++n)i.delete(e[n]);else{for(var n=0,o=e.length;n<o;++n)i.delete(e[n]);var s=[];this.projMatchPoints.forEach(function(e,t){s.push(t)});var a=this.indexer.getDataElements();e=a.lowerDataElementsTo(e,s)}for(var d in this.projSubNodes)this.projSubNodes[d].removeProjMatches(e,t);e.length=r}function negationQueryCalcResetProjMatchesAfterNodeRemoval(e){this.isGeneratingProjection()?(this.initEmptyProjMatches(),this.suspendProjection()):this.projMatches=void 0,e&&this.clearProjSelectionMatches()}function negationQueryCalcGetMatches(){var e=[];return this.suspendedMatches?(this.suspendedMatches.forEach(function(t,i){e.push(i)}),e):void 0===this.matches?this.initialUpdate?[]:this.indexer.getAllMatches(this.pathId):(this.matches.forEach(function(t,i){1==t&&e.push(i)}),e)}function negationQueryCalcGetMatchesAsObj(){if(this.suspendedMatches)return this.suspendedMatches;if(void 0===this.matches)return this.initialUpdate?new Map:this.indexer.getAllMatchesAsObj(this.pathId);var e=new Map;return this.matches.forEach(function(t,i){1==t&&e.set(i,1)}),e}function negationQueryCalcGetFullyRaisedMatches(){if(!this.lowerThanQueryPrefixFullMatches())return this.getMatches();var e=[],t=this.indexer.getDataElements(),i=this.rootQueryCalc.prefixProjPathId;if(this.suspendedMatches)this.suspendedMatches.forEach(function(r,n){t.getPathId(n)<=i&&e.push(n)});else if(void 0===this.matches){if(this.initialUpdate)return[];for(var r=this.indexer.getAllMatches(this.pathId),n=0,o=r.length;n<o;++n){var s=r[n];t.getPathId(s)<=i&&e.push(s)}}else this.matches.forEach(function(r,n){1==r&&t.getPathId(n)<=i&&e.push(n)});return e}function negationQueryCalcGetFullyRaisedMatchesAsObj(){if(!this.lowerThanQueryPrefixFullMatches())return this.getMatches();var e=new Map,t=this.indexer.getDataElements(),i=this.rootQueryCalc.prefixProjPathId;if(this.suspendedMatches)this.suspendedMatches.forEach(function(r,n){t.getPathId(n)<=i&&e.set(n,1)});else if(void 0===this.matches){if(this.initialUpdate)return new Map;for(var r=this.indexer.getAllMatches(this.pathId),n=0,o=r.length;n<o;++n){var s=r[n];t.getPathId(s)<=i&&e.set(s,1)}}else this.matches.forEach(function(r,n){1==r&&t.getPathId(n)<=i&&e.set(n,1)});return e}function negationQueryCalcFilterMatches(e){var t=[];if(this.suspendedMatches)for(var i=0,r=e.length;i<r;++i){var n=e[i];this.suspendedMatches.has(n)&&t.push(n)}else{if(void 0===this.matches)return this.initialUpdate?[]:this.indexer.filterDataNodesAtPath(this.pathId,e);for(var i=0,r=e.length;i<r;++i){var n=e[i];1==this.matches.get(n)&&t.push(n)}}return t}function negationQueryCalcFilterMatchPositions(e){var t=[];if(this.suspendedMatches)for(var i=0,r=e.length;i<r;++i){var n=e[i];this.suspendedMatches.has(n)&&t.push(i)}else{if(void 0===this.matches)return this.initialUpdate?[]:this.indexer.filterDataNodesAtPathPositions(this.pathId,e);for(var i=0,r=e.length;i<r;++i){var n=e[i];1==this.matches.get(n)&&t.push(i)}}return t}function negationQueryCalcGetProjMatches(e){var t;if(this.projMatches&&(t=this.projMatches.get(e))){var i=[];return t.forEach(function(e,t){i.push(t)}),void 0===this.projMatchPoints||0===this.projMatchPoints.size?i:this.lowerToProjMatchPoints(i,this.projMatchPoints)}}function negationQueryCalcFilterProjMatches(e,t){var i,r=[];if(!this.projMatches||!(i=this.projMatches.get(t)))return r;if(void 0===this.projMatchPoints||0===this.projMatchPoints.size||this.isSuspendedProjection())for(var n=0,o=e.length;n<o;++n){var s=e[n];i.has(s)&&r.push(s)}else for(var a=this.indexer.getDataElements(),n=0,o=e.length;n<o;++n){var s=e[n];if(i.has(s))r.push(s);else for(var d,u=s;this.projMatchPoints.has((d=a.getEntry(s)).pathId);)if(i.has(s=d.parent)){r.push(u);break}}return r}function TrueQueryCalc(e,t,i){this.NegationQueryCalc(e,t);var r=new SimpleQueryCalc(e,t);r.addValue(i,"boolean",!1),this.addSubNode(r)}function trueQueryCalcDestroy(){var e;for(var t in this.subNodes)e=this.subNodes[t];this.NegationQueryCalc_destroy(),e.destroy()}function IntersectionQueryCalc(e){this.InternalQueryCalc(e),this.matches=new IntHashMapUint(0)}function intersectionQueryCalcDestroy(){this.rootQueryCalc&&this.isGeneratingProjection()&&this.rootQueryCalc.removeGeneratingProj(this),this.InternalQueryCalc_destroy()}function intersectionQueryCalcIsProjection(){return!!this.projSubNodeNum}function intersectionQueryCalcSubProjMustAddMatches(){return this.projSubNodeNum>1||!!this.parent&&this.parent.subProjMustAddMatches()}function intersectionQueryCalcIsGeneratingProjection(){return this.projSubNodeNum>=2||this.isSelectionProjection()&&!this.matchParent.mustAddMatches}function intersectionQueryCalcIsGeneratingProjectionTerminal(){return this.isSelectionProjection()&&!this.matchParent.mustAddMatches}function intersectionQueryCalcAddsProjMatchesToSubNodes(){return this.subNodeNum>=2||void 0!==this.matchParent&&this.matchParent!=this.rootQueryCalc&&this.matchParent.addsProjMatchesToSubNodes()}function intersectionQueryCalcCalcMaxMatchPointCount(){return!this.projSubNodeNum||this.subProjMustAddMatches()?this.subNodeNum:this.subNodeNum-this.projSubNodeNum}function intersectionQueryCalcCalcRaisingRequired(){if(this.matchPoints.size<=1)return!1;var e=this.calcMaxMatchPointCount(),t=!1,i=this;return this.isProjection()&&e<this.subNodeNum?this.matchPoints.forEach(function(r,n){(!i.projMatchPoints.has(n)||r<e)&&(t=!0)}):this.matchPoints.forEach(function(i,r){i<e&&(t=!0)}),t}function intersectionQueryCalcCalcLoweringRequired(){if(!this.isProjection()||void 0===this.projMatchPoints)return!1;var e=this.calcMaxMatchPointCount(),t=!1;return this.projMatchPoints.forEach(function(i,r){i!=e&&(t=!0)}),t}function intersectionQueryCalcCalcMaxCountIsFullMatch(){if(!this.isProjection())return!0;var e=this.getFullMatchCount();if(e==this.subNodeNum)return!0;var t=!0,i=this;return this.matchPoints.forEach(function(r,n){r!=e||i.projMatchPoints.has(n)||(t=!1)}),t}function intersectionQueryCalcLowerThanQueryPrefixFullMatches(){var e=this.getFullMatchCount(),t=this.rootQueryCalc.prefixProjPathId,i=!1;return this.matchPoints.forEach(function(r,n){n>t&&r>=e&&(i=!0)}),i}function intersectionQueryCalcGetFullCountMatchPoints(){var e=this.getFullMatchCount(),t=new Map;return this.matchPoints.forEach(function(i,r){i==e&&t.set(r,!0)}),t}function intersectionQueryCalcTopMatchPointUpdatedForAll(){if(void 0===this.subNodeNum||void 0===this.matchPoints)return!1;var e=this.indexer.qcm.getRootPathId();return this.matchPoints.get(e)==this.subNodeNum||!this.mustAddMatches&&(void 0!==this.projMatchPoints&&void 0!==this.projMatchPoints.get(e)&&this.matchPoints.get(e)+this.projMatchPoints.get(e)==this.subNodeNum)}function intersectionQueryCalcAddToMatchPoints(e,t){if(t.isProjection()&&(this.addToProjMatchPoints(e),!this.subProjMustAddMatches()))return void(this.topMatchPointUpdatedForAll()&&this.setMode());var i;this.matchPoints.has(e)?(i=this.matchPoints.get(e)+1,this.matchPoints.set(e,i)):(i=1,this.matchPoints.set(e,1),this.pureProjMatchPoints&&this.pureProjMatchPoints.has(e)&&this.pureProjMatchPoints.delete(e)),i==this.calcMaxMatchPointCount()&&this.matchParent.addToMatchPoints(e,this),this.topMatchPointUpdatedForAll()&&this.setMode()}function intersectionQueryCalcAddToProjMatchPoints(e){if(this.projMatchPoints)if(this.projMatchPoints.has(e)){var t=this.projMatchPoints.get(e)+1;this.projMatchPoints.set(e,t)}else this.projMatchPoints.set(e,1);else this.projMatchPoints=new Map,this.projMatchPoints.set(e,1);this.matchPoints.has(e)||this.subProjMustAddMatches()||(this.pureProjMatchPoints||(this.pureProjMatchPoints=new Map),this.pureProjMatchPoints.set(e,!0))}function intersectionQueryCalcIncreaseMatchPointCount(e){if(this.matchPoints.has(e)){var t=this.matchPoints.get(e)+1;this.matchPoints.set(e,t)}else this.matchPoints.set(e,1),this.pureProjMatchPoints&&this.pureProjMatchPoints.has(e)&&this.pureProjMatchPoints.delete(e)}function intersectionQueryCalcRemoveFromMatchPoints(e,t){if(!t||!t.isProjection()||(this.decreaseProjMatchPointCount(e),this.subProjMustAddMatches())){var i=this.matchPoints.get(e);this.decreaseMatchPointCount(e),i==this.calcMaxMatchPointCount()&&this.matchParent.removeFromMatchPoints(e,this),1!=i||this.calcRaisingRequired()||this.setMode()}}function intersectionQueryCalcDecreaseProjMatchPointCount(e){var t=this.projMatchPoints.get(e)-1;0===t?(this.projMatchPoints.delete(e),this.pureProjMatchPoints&&this.pureProjMatchPoints.has(e)&&this.pureProjMatchPoints.delete(e),this.calcLoweringRequired()||this.setMode()):this.projMatchPoints.set(e,t)}function intersectionQueryCalcDecreaseMatchPointCount(e){var t=this.matchPoints.get(e)-1;0===t?(this.matchPoints.delete(e),this.projMatchPoints&&this.projMatchPoints.has(e)&&(this.pureProjMatchPoints||(this.pureProjMatchPoints=new Map),this.pureProjMatchPoints.set(e,!0))):this.matchPoints.set(e,t)}function intersectionQueryCalcUpdateQueryAfterNodeRemoval(e){var t=this.isProjection()&&this.subProjMustAddMatches(),i=e.getId(),r=!(i in this.subNodes),n=void 0!==this.projSubNodes&&i in this.projSubNodes;this.suspend(),n&&(delete this.projSubNodes[i],this.projSubNodeNum--,1==this.projSubNodeNum&&this.rootQueryCalc.removeGeneratingProj(this),0==this.projSubNodeNum&&(this.matchParent.updateQueryAfterNodeRemoval(this),this.isGeneratingProjection()&&this.rootQueryCalc.addSelectionGeneratingProj(this))),this.updateMatchingAfterRemoval(e,n,r,t),n&&1==this.projSubNodeNum&&(this.subProjMustAddMatches()||this.unsetSubProjsMustAddMatches()),this.unsuspend()}function intersectionQueryCalcUnsetSubProjsMustAddMatches(){var e;(e=this.isSuspended())||this.suspend();for(var t in this.projSubNodes){var i=this.projSubNodes[t];this.removeSubNodeMatchPoints(i,!1),this.removeMatches(i.getMatches(),i),i.unsetMustAddMatches()}e||this.unsuspend()}function intersectionQueryCalcUpdateMatchingAfterRemoval(e,t,i,r){var n;return t&&!!i!=!!r||(n=e.getMatches()),t?void(i?r?(this.removeSubNodeMatchPoints(e,!0),this.removeMatches(n,e)):this.removeSubNodeMatchPointsAsProj(e):(this.removeSubNodeMatchPointsAsProj(e),r||(this.addSubNodeMatchPoints(e),this.addMatches(n,e)))):(this.removeSubNodeMatchPoints(e,!1),void this.removeMatches(n,e))}function intersectionQueryCalcRemoveSubNodeMatchPoints(e,t){var i=this.getFullCountMatchPoints(),r=this;e.getFullCountMatchPoints().forEach(function(e,i){t&&r.decreaseProjMatchPointCount(i),r.decreaseMatchPointCount(i)}),this.getFullCountMatchPoints().forEach(function(e,t){i.has(t)||r.matchParent.addToMatchPoints(t,r)})}function intersectionQueryCalcRemoveSubNodeMatchPointsAsProj(e){var t=this;e.getFullCountMatchPoints().forEach(function(e,i){t.decreaseProjMatchPointCount(i)})}function intersectionQueryCalcAddSubNodeMatchPoints(e,t){var i=this.getFullCountMatchPoints(),r=this;e.getFullCountMatchPoints().forEach(function(e,t){r.increaseMatchPointCount(t)});var n=this.getFullCountMatchPoints();i.forEach(function(e,t){n.has(t)||r.matchParent.removeFromMatchPoints(t,r)})}function intersectionQueryCalcRefreshQueryStructure(){var e=this.projSubNodeNum?this.projSubNodeNum:0,t=0==this.getFullMatchCount();for(var i in this.updatedSubNodes){var r=this.updatedSubNodes[i],n=this.subNodes[i],o=n.isProjection();n.refreshQueryStructure(),!t&&(r||!o&&n.isProjection())&&this.suspend(),!r&&o||!n.isProjection()||(this.projSubNodes||(this.projSubNodes={}),this.projSubNodes[i]=n,this.projSubNodeNum?this.projSubNodeNum++:(this.projSubNodeNum=1,void 0===this.projMatchPoints&&(this.projMatchPoints=new Map)),r||(this.selectionBecameProjection||(this.selectionBecameProjection={}),this.selectionBecameProjection[i]=!0))}this.parent&&this.parent.subProjMustAddMatches()?this.setMustAddMatches():this.projSubNodeNum>1&&this.setSubProjsMustAddMatches(),this.projSubNodeNum>1&&e<=1?this.rootQueryCalc.addIntersectionGeneratingProj(this):this.projSubNodeNum>0&&0==e&&!this.isGeneratingProjection()&&this.rootQueryCalc.removeGeneratingProj(this)}function intersectionQueryCalcSetSubProjsMustAddMatches(){var e=!1;for(var t in this.projSubNodes)this.projSubNodes[t].setMustAddMatches()?this.selectionBecameProjection&&this.selectionBecameProjection[t]||this.addUpdatedSubNode(t,!0):e=!0;e||(this.projMatchPoints=new Map,this.pureProjMatchPoints=new Map)}function intersectionQueryCalcRefreshMatchPoints(){if(this.isSuspended()){var e=this.getFullCountMatchPoints(),t=this.subProjMustAddMatches();this.subNodeNum+=2;var i=this;for(var r in this.updatedSubNodes){var n=this.subNodes[r];this.updatedSubNodes[r]?n.getFullCountMatchPoints().forEach(function(e,t){i.addToMatchPoints(t,n)}):this.selectionBecameProjection&&this.selectionBecameProjection[r]&&n.getFullCountMatchPoints().forEach(function(e,r){i.addToProjMatchPoints(r),t||i.removeFromMatchPoints(r,void 0)}),n.refreshMatchPoints()}this.subNodeNum-=2;var o=this.getFullCountMatchPoints();o.forEach(function(t,r){e.has(r)||i.matchParent.addToMatchPoints(r,i)}),e.forEach(function(e,t){o.has(t)||i.matchParent.removeFromMatchPoints(t,i)})}else{for(var r in this.updatedSubNodes)this.subNodes[r].refreshMatchPoints();this.setMode()}}function intersectionQueryCalcRefreshMatches(){var e=this.subProjMustAddMatches();if(this.matches.adjustByteNumber(this.subNodeNum),!e&&this.selectionBecameProjection)for(var t in this.selectionBecameProjection){var i=this.subNodes[t];this.removeMatches(i.getMatches(),i)}for(var t in this.updatedSubNodes){var i=this.subNodes[t];!this.updatedSubNodes[t]||void 0!==this.projSubNodes&&t in this.projSubNodes&&!e||this.addMatches(i.getMatches(),i),i.refreshMatches()}this.unsuspend(),this.updatedSubNodes=void 0,this.selectionBecameProjection&&(this.selectionBecameProjection=void 0)}function intersectionQueryCalcSuspendSelection(){if(this.suspendedMatches=this.getMatchesAsObj(),this.raisedMatches){var e=this;this.raisedMatches.forEach(function(t,i){t.forEach(function(t,r){var t=e.matches.get(i)-e.matchPoints.get(r);0==t?e.matches.delete(i):e.matches.set(i,t)})}),this.raisedMatches=new Map}}function intersectionQueryCalcSuspendProjMatches(e){if(this.isProjection()&&void 0!==this.pureProjMatchPoints&&0!==this.pureProjMatchPoints.size&&this.projMatches){if(void 0===e){var t=this;return void this.rootQueryCalc.getQueryResults().forEach(function(e,i){t.suspendProjMatches(i)})}if(this.projMatches.has(e)){var i=[];this.pureProjMatchPoints.forEach(function(e,t){i.push(t)});var r=this.projMatches.get(e),n=[];r.forEach(function(e,t){n.push(t)});var o=n.length;n=this.indexer.getDataElements().lowerDataElementsTo(n,i);for(var s=o,a=n.length;s<a;++s)r.set(n[s],1)}}}function intersectionQueryCalcCalcNewFullMatchesAfterSuspension(){var e=this.getFullMatchCount(),t=this.shouldAddMatches()?[]:void 0,i=this.isProjection(),r=this;if(this.calcRaisingRequired()){var n=this.indexer.getDataElements();this.matches.forEach(function(o,s){if(!r.raisedMatches.has(s))for(;;){o=r.matches.get(s);var a=n.getEntry(s),d=a.pathId;if(o!=r.matchPoints.get(d))break;if(o==e){if(t){r.suspendedMatches.has(s)||t.push(s);break}if(r.projMatchPoints.get(d))break}var u,h=a.parent;if(r.raisedMatches.has(h)?u=r.raisedMatches.get(h):(u=new Map,r.raisedMatches.set(h,u)),u.has(d)){if(i&&r.projMatchPoints.get(d)){var l=u.get(d);l.set(s,!0)}else u.set(d,u.get(d)+1);break}if(i&&r.projMatchPoints.get(d)){var l=new Map;u.set(d,l),l.set(s,!0)}else u.set(d,1);r.matches.has(h)?r.matches.set(h,r.matches.get(h)+1):r.matches.set(h,1),s=h}})}else{if(!t)return;this.matches.forEach(function(i,n){i>=e&&!r.suspendedMatches.has(n)&&t.push(n)})}return t}function intersectionQueryCalcCalcRemovedSuspendedMatches(){var e=this.getFullMatchCount(),t=[],i=this;return this.suspendedMatches.forEach(function(r,n){i.matches.get(n)!=e&&t.push(n)}),t}function intersectionQueryCalcSetMode(){this.setSelectionMode(),this.setProjectionMode()}function intersectionQueryCalcSetSelectionMode(){this.calcRaisingRequired()?(this.raisedMatches||(this.raisedMatches=new Map),this.projSubNodeNum?(this.addMatches=this.addMatchesToProj,this.removeMatches=this.removeMatchesFromProj):(this.addMatches=this.addMatchesWithRaising,this.removeMatches=this.removeMatchesWithRaising)):(this.raisedMatches&&delete this.raisedMatches,this.addMatches=this.addMatchesWithoutRaising,this.removeMatches=this.removeMatchesWithoutRaising)}function intersectionQueryCalcSetProjectionMode(){this.calcLoweringRequired()?(this.addProjMatches=this.addProjMatchesWithLowering,this.removeProjMatches=this.removeProjMatchesWithLowering):this.projSubNodeNum?(this.addProjMatches=this.addProjMatchesWithoutLowering,this.removeProjMatches=this.removeProjMatchesWithoutLowering):(this.addProjMatches=this.addProjMatchesToSelectionProj,this.removeProjMatches=this.removeProjMatchesFromSelectionProj)}function intersectionQueryCalcSetSuspendedMode(){this.addMatches=this.addMatchesToSuspended,this.removeMatches=this.removeMatchesFromSuspended,this.addProjMatches=this.addProjMatchesDoNothing,this.removeProjMatches=this.removeProjMatchesDoNothing}function intersectionQueryCalcSetSuspendedProjectionMode(){this.addProjMatches=this.addProjMatchesDoNothing,this.removeProjMatches=this.removeProjMatchesDoNothing}function intersectionQueryCalcGetFullMatchCount(){var e=this.matchPoints.get(this.indexer.qcm.getRootPathId());return e?e:0}function intersectionQueryCalcAddMatchesWithRaising(e){if(0!=e.length){var t=this.calcNewMatchesWithRaising(e);t.length&&(this.isSelectionProjection()?(this.mustAddMatches&&this.disableProjUpdateAndAddMatchesToParent(t),this.addProjMatchesToAddingSelectionProj(t)):this.matchParent.addMatches(t,this))}}function intersectionQueryCalcCalcNewMatchesWithRaising(e){for(var t,i=e.length,r=[],n=this.getFullMatchCount(),o=this.indexer.getDataElements(),s=0;s<i;++s){var a=e[s];for(t=1;;){this.matches.has(a)?(t+=this.matches.get(a),this.matches.set(a,t)):this.matches.set(a,t);var d=o.getEntry(a),u=d.pathId;if(this.matchPoints.get(u)!=t)break;if(t==n){r.push(a);break}a=d.parent;var h;if(this.raisedMatches.has(a)?h=this.raisedMatches.get(a):(h=new Map,this.raisedMatches.set(a,h)),h.has(u)){h.set(u,h.get(u)+1);break}h.set(u,1)}}return r}function intersectionQueryCalcAddMatchesToProj(e){if(0!=e.length){var t=this.calcNewMatchesInProj(e);t.fullMatches.length&&this.mustAddMatches&&this.disableProjUpdateAndAddMatchesToParent(t.fullMatches),this.isSuspendedProjection()||this.addProjMatchesToAdding(t.fullMatches,t.lowerProjMatches)}}function intersectionQueryCalcCalcNewMatchesInProj(e){var t=e.length,i=[],r=this.makeEmptyProjMatchArrays(),n=[];void 0!==this.projMatches&&this.projMatches.forEach(function(e,t){n.push(t)});for(var o,s=n.length,a=this.getFullMatchCount(),d=this.indexer.getDataElements(),u=0;u<t;++u){var h=e[u];for(o=1;;){this.matches.has(h)?(o+=this.matches.get(h),this.matches.set(h,o)):this.matches.set(h,o);var l=d.getEntry(h),c=l.pathId;if(this.matchPoints.get(c)!=o)break;if(o==a&&this.projMatchPoints.get(c)){i.push(h);break}var p=l.parent;if(this.projMatchPoints.get(c))for(var f=0;f<s;++f){var v=n[f];this.projMatches.get(v).has(p)&&r[v].push(h)}var g;if(this.raisedMatches.has(p)?g=this.raisedMatches.get(p):(g=new Map,this.raisedMatches.set(p,g)),g.has(c)){if(this.projMatchPoints.get(c)){var m=g.get(c);m.set(h,!0)}else g.set(c,g.set(c)+1);break}if(this.projMatchPoints.get(c)){var m=new Map;g.set(c,m),m.set(h,!0)}else g.set(c,1);h=p}}return{fullMatches:i,lowerProjMatches:r}}function intersectionQueryCalcAddMatchesWithoutRaising(e){var t=e.length;if(0!=t){for(var i,r=[],n=this.getFullMatchCount(),o=0;o<t;++o){var s=e[o];this.matches.has(s)?this.matches.set(s,i=this.matches.get(s)+1):this.matches.set(s,i=1),i==n&&r.push(s)}r.length&&(this.shouldAddMatches()&&this.disableProjUpdateAndAddMatchesToParent(r),this.projSubNodeNum?this.addProjMatchesToAdding(r):this.isSelectionProjection()&&this.addProjMatchesToAddingSelectionProj(r))}}function intersectionQueryCalcDisableProjUpdateAndAddMatchesToParent(e){if(0!=e.length)if(this.isSuspendedProjection())this.matchParent.addMatches(e,this);else{var t=this.addProjMatches;this.addProjMatches=this.addProjMatchesDoNothing,this.matchParent.addMatches(e,this),this.addProjMatches=t}}function intersectionQueryCalcAddMatchesToSuspended(e){for(var t=e.length,i=0;i<t;++i){var r=e[i];this.matches.has(r)?this.matches.set(r,this.matches.get(r)+1):this.matches.set(r,1)}}function intersectionQueryCalcAddProjMatchesToAdding(e,t){var i=this.rootQueryCalc.getQueryResults(),r=this;i.forEach(function(i,n){var o=r.matchParent.filterProjMatches(e,n);if(void 0!==t&&n in t&&(o=o.length?o.concat(t[n]):t[n]),void 0!==o&&0!=o.length){if(r.raisedMatches||void 0!==r.pureProjMatchPoints&&r.pureProjMatchPoints.size>0)o=r.lowerProjMatchesAndAdd(o,n);else for(var s=r.getProjMatchesEntry(n),a=0,d=o.length;a<d;++a)s.set(o[a],1);for(var u in r.projSubNodes)r.projSubNodes[u].addProjMatches(o,n)}})}function intersectionQueryCalcLowerProjMatchesAndAdd(e,t){var i=this.getProjMatchesEntry(t),r=e.length;if(this.raisedMatches)for(var n=0;n<r;++n){var o=e[n];if(i.set(o,1),this.raisedMatches.has(o)){var s=this.raisedMatches.get(o),a=this;s.forEach(function(t,i){i in a.projMatchPoints&&t.forEach(function(t,i){e.push(i),r++})})}}else for(var n=0;n<r;++n)i.set(e[n],1);return void 0===this.pureProjMatchPoints||0===this.pureProjMatchPoints.size?e:this.lowerToPureProjMatchPoints(e)}function intersectionQueryCalcLowerToPureProjMatchPoints(e){return void 0===this.pureProjMatchPoints||0===this.pureProjMatchPoints.size?e:this.lowerToProjMatchPoints(e,this.pureProjMatchPoints)}function intersectionQueryCalcAddProjMatchesWithLowering(e,t){for(var i=this.getFullMatchCount(),r=[],n=this.getProjMatchesEntry(t),o=0,s=e.length;o<s;++o){var a=e[o];this.matches.get(a)==i&&(n.has(a)||r.push(a))}r=this.lowerProjMatchesAndAdd(r,t);for(var d in this.projSubNodes)this.projSubNodes[d].addProjMatches(r,t)}function intersectionQueryCalcAddProjMatchesWithoutLowering(e,t){for(var i=this.getFullMatchCount(),r=[],n=this.getProjMatchesEntry(t),o=0,s=e.length;o<s;++o){var a=e[o];this.matches.get(a)!=i||n.has(a)||(n.set(a,1),r.push(a))}for(var d in this.projSubNodes)this.projSubNodes[d].addProjMatches(r,t)}function intersectionQueryCalcAddProjMatchesToAddingSelectionProj(e){if(!this.isSuspendedProjection()&&this.isGeneratingProjection()){var t=this.rootQueryCalc.getQueryResults(),i=this;t.forEach(function(t,r){var n=this.matchParent.filterProjMatches(e,r);i.addSelectionProjMatches(n,r)})}}function intersectionQueryCalcAddProjMatchesToSelectionProj(e,t){if(this.isGeneratingProjection()){for(var i=this.getFullMatchCount(),r=[],n=0,o=e.length;n<o;++n){var s=e[n];this.matches.get(s)==i&&r.push(s)}r=this.addSelectionProjMatches(r,t)}}function intersectionQueryCalcRemoveMatchesWithRaising(e){for(var t,i,r,n=e.length,o=[],s=this.getFullMatchCount(),a=this.indexer.getDataElements(),d=0;d<n;++d)for(r=e[d],i=1;;){t=this.matches.get(r);var u=t-i;0==u?this.matches.delete(r):this.matches.set(r,u);var h,l=a.getEntry(r),c=l.pathId;if(void 0!==(h=this.matchPoints.get(c))&&t!=h)break;if(t==s){o.push(r);break}r=l.parent;var p=this.raisedMatches.get(r),f=p.get(c)-1;if(0!=f){p.set(c,f);break}p.delete(c),0==p.size&&this.raisedMatches.delete(r),i=t}0!=o.length&&(this.isSelectionProjection()?(this.removeMatchesFromRemovingSelectionProj(o),this.mustAddMatches&&this.disableProjUpdateAndRemoveMatchesFromParent(o)):this.matchParent.removeMatches(o,this))}function intersectionQueryCalcRemoveMatchesFromProj(e){for(var t,i,r,n=this.mustAddMatches?[]:void 0,o=[],s=this.getFullMatchCount(),a=this.indexer.getDataElements(),d=0,u=e.length;d<u;++d)for(r=e[d],i=1;;){t=this.matches.get(r);var h=t-i;0==h?this.matches.delete(r):this.matches.set(r,h);var l,c=a.getEntry(r),p=c.pathId;if(void 0!==(l=this.matchPoints.get(p))&&t!=l)break;if(o.push(r),t==s){if(n){n.push(r);break}if(this.projMatchPoints.get(p))break}if(this.projMatchPoints.get(p)){var f=c.parent,v=this.raisedMatches.get(f),g=v.get(p);if(g.delete(r),r=f,0!=g.size)break;v.delete(p),0==v.size&&this.raisedMatches.delete(r)}else{r=c.parent;var v=this.raisedMatches.get(r),m=v.get(p)-1;if(0!=m){v.set(p,m);break}v.delete(p),0==v.size&&this.raisedMatches.delete(r)}i=t}if(o.length&&!this.isSuspendedProjection()){var y=this;this.rootQueryCalc.getQueryResults().forEach(function(e,t){y.removeProjMatches(o,t)})}n&&n.length&&this.parent&&this.disableProjUpdateAndRemoveMatchesFromParent(n)}function intersectionQueryCalcRemoveMatchesWithoutRaising(e){for(var t=e.length,i=[],r=this.getFullMatchCount(),n=0;n<t;++n){var o=e[n],s=this.matches.get(o);s==r&&i.push(o),0==--s?this.matches.delete(o):this.matches.set(o,s)}if(i.length&&(this.shouldAddMatches()&&this.disableProjUpdateAndRemoveMatchesFromParent(i),!this.isSuspendedProjection()))if(this.projSubNodeNum){var a=this;this.rootQueryCalc.getQueryResults().forEach(function(e,t){a.removeProjMatches(i,t)})}else this.isSelectionProjection()&&this.removeMatchesFromRemovingSelectionProj(i)}function intersectionQueryCalcRemoveMatchesFromSuspended(e){for(var t=e.length,i=0;i<t;++i){var r=e[i],n=this.matches.get(r)-1;0==n?this.matches.delete(r):this.matches.set(r,n)}}function intersectionQueryCalcDisableProjUpdateAndRemoveMatchesFromParent(e){if(e.length)if(this.isSuspendedProjection())this.matchParent.removeMatches(e,this);else{var t=this.removeProjMatches;this.removeProjMatches=this.removeProjMatchesDoNothing,this.matchParent.removeMatches(e,this),this.removeProjMatches=t}}function intersectionQueryCalcRemoveProjMatchesWithLowering(e,t){var i,r=e.length;if(void 0===this.raisedMatches)i=e;else for(var i=[],n=0,o=0,s=this.getProjMatchesEntry(t),a=0;a<r;++a){var d=e[a];if(s.has(d))for(s.delete(d),i.push(d),o++;;){if(this.raisedMatches.has(d)){var u=this.raisedMatches.get(d);u.forEach(function(e,t){void 0!==this.projMatchPoints&&this.projMatchPoints.has(t)&&e.forEach(function(e,t){s.delete(t),i.push(t),o++})})}if(++n>=o)break;d=i[n]}}void 0!==this.pureProjMatchPoints&&this.pureProjMatchPoints.size>0&&(i=this.lowerToPureProjMatchPoints(i));for(var h in this.projSubNodes)this.projSubNodes[h].removeProjMatches(i,t);e.length=r}function intersectionQueryCalcRemoveProjMatchesWithoutLowering(e,t){for(var i=e.length,r=[],n=this.getProjMatchesEntry(t),o=0;o<i;++o){var s=e[o];n.has(s)&&(n.delete(s),r.push(s))}for(var a in this.projSubNodes)this.projSubNodes[a].removeProjMatches(r,t)}function intersectionQueryCalcRemoveMatchesFromRemovingSelectionProj(e){if(!this.isSuspendedProjection()&&this.isGeneratingProjection()){var t=this;this.lowerThanQueryPrefixFullMatches()?this.rootQueryCalc.getQueryResults().forEach(function(i,r){var n=t.matchParent.filterProjMatches(e,r);t.removeSelectionProjMatches(n,r)}):this.rootQueryCalc.getQueryResults().forEach(function(i,r){t.removeSelectionProjMatches(e,r)})}}function intersectionQueryCalcRemoveProjMatchesFromSelectionProj(e,t){if(this.isGeneratingProjection())if(this.lowerThanQueryPrefixFullMatches()){for(var i=this.getFullMatchCount(),r=[],n=0,o=e.length;n<o;++n){var s=e[n];this.matches.get(s)==i&&r.push(s)}this.removeSelectionProjMatches(r,t)}else this.removeSelectionProjMatches(e,t)}function intersectionQueryCalcGetMatches(){var e=[];if(this.suspendedMatches)return this.suspendedMatches.forEach(function(t,i){e.push(i)}),e;var t=this.getFullMatchCount(),i=this.calcMaxCountIsFullMatch();if(i)this.matches.forEach(function(i,r){i>=t&&e.push(r)});else{var r=this.indexer.getDataElements(),n=this;this.matches.forEach(function(i,o){i>=t&&n.projMatchPoints.get(r.getPathId(o))&&e.push(o)})}return e}function intersectionQueryCalcGetMatchesAsObj(){if(this.suspendedMatches)return this.suspendedMatches;var e=this.getFullMatchCount(),t=new Map,i=this.calcMaxCountIsFullMatch();if(i)this.matches.forEach(function(i,r){i>=e&&t.set(r,1)});else{var r=this.indexer.getDataElements(),n=this;this.matches.forEach(function(i,o){i>=e&&n.projMatchPoints.get(r.getPathId(o))&&t.set(o,1)})}return t}function intersectionQueryCalcGetFullyRaisedMatches(){if(!this.lowerThanQueryPrefixFullMatches())return this.getMatches();var e=[],t=this.indexer.getDataElements(),i=this.rootQueryCalc.prefixProjPathId;if(this.suspendedMatches)this.suspendedMatches.forEach(function(r,n){t.getPathId(n)<=i&&e.push(n)});else{var r=this.getFullMatchCount();this.matches.forEach(function(n,o){n>=r&&t.getPathId(o)<=i&&e.push(o)})}return e}function intersectionQueryCalcGetFullyRaisedMatchesAsObj(){if(!this.lowerThanQueryPrefixFullMatches())return this.getMatchesAsObj();var e=new Map,t=this.indexer.getDataElements(),i=this.rootQueryCalc.prefixProjPathId;if(this.suspendedMatches)this.suspendedMatches.forEach(function(r,n){t.getPathId(n)<=i&&e.set(n,1)});else{var r=this.getFullMatchCount();this.matches.forEach(function(n,o){n>=r&&t.getPathId(o)<=i&&e.set(o,1)})}return e}function intersectionQueryCalcFilterMatches(e){var t=[];if(this.suspendedMatches)for(var i=0,r=e.length;i<r;++i){var n=e[i];this.suspendedMatches.has(n)&&t.push(n)}else for(var o=this.getFullMatchCount(),i=0,r=e.length;i<r;++i){var n=e[i];this.matches.get(n)>=o&&t.push(n)}return t}function intersectionQueryCalcFilterMatchPositions(e){var t=[];if(this.suspendedMatches)for(var i=0,r=e.length;i<r;++i){var n=e[i];this.suspendedMatches.has(n)&&t.push(i)}else for(var o=this.getFullMatchCount(),i=0,r=e.length;i<r;++i){var n=e[i];this.matches.get(n)>=o&&t.push(i)}return t}function intersectionQueryCalcGetProjMatches(e){var t;if(!this.projMatches||!(t=this.projMatches.get(e)))return this.getFullMatchCount()>0?[]:void 0;var i=[];return t.forEach(function(e,t){i.push(t)}),this.lowerToPureProjMatchPoints(i)}function intersectionQueryCalcFilterProjMatches(e,t){var i,r=[];if(!this.projMatches||!(i=this.projMatches.get(t)))return r;if(void 0===this.pureProjMatchPoints||0===this.pureProjMatchPoints.size||this.isSuspendedProjection())for(var n=0,o=e.length;n<o;++n){var s=e[n];i.has(s)&&r.push(s)}else for(var a=this.indexer.getDataElements(),n=0,o=e.length;n<o;++n){var s=e[n];if(i.has(s))r.push(s);else for(var d,u=s;void 0!==s&&this.pureProjMatchPoints.has((d=a.getEntry(s)).pathId);)if(i.has(s=d.parent)){r.push(u);break}}return r}function RootQueryCalc(){this.id=InternalQCM.newId()}function rootQueryCalcGetId(){return this.id}function InternalRootQueryCalc(e,t,i,r){this.RootQueryCalc(),this.qcmKey=r,this.query=e,this.indexer=t,this.prefixProjPathId=i,this.results=new Map,this.resultNum=0,this.terminalGeneratingProjNum=0,this.query.addRootQueryCalcNode(this),this.projPathId=this.getProjectionPathId()}function internalRootQueryCalcDestroy(){if(this.destroyed=!0,this.query.removeRootQueryCalcNode(this.getId()),this.generatingProjs){var e=this;this.generatingProjs.forEach(function(t,i){
void 0!==t.mappedPathId&&e.indexer.qcm.releasePathId(t.mappedPathId)})}}function internalRootQueryCalcGetQCMKey(){return this.qcmKey}function internalRootQueryCalcGetIndexer(){return this.indexer}function internalRootQueryCalcHasMultipleProjPaths(){return this.terminalGeneratingProjNum>1}function internalRootQueryCalcGetTerminalGeneratingProjNum(){return this.terminalGeneratingProjNum}function internalRootQueryCalcGetProjectionPathId(){if(!this.terminalGeneratingProjNum)return this.prefixProjPathId;if(!(this.terminalGeneratingProjNum>1)){var e;return this.generatingProjs.forEach(function(t,i){e=t.pathId}),e}}function internalRootQueryCalcIsSelection(){return!this.queryCalc||!this.queryCalc.isProjection()}function internalRootQueryCalcIsProjection(){return!!this.queryCalc&&this.queryCalc.isProjection()}function internalRootQueryCalcIsPureProjection(){return void 0!==this.queryCalc&&this.queryCalc instanceof ProjectionQueryCalc}function internalRootQueryCalcIsTrivialProjection(){return this.isPureProjection()&&this.getProjectionPathId()===this.indexer.rootPathNodeId}function internalRootQueryCalcHasExplicitProjMatches(e){var t=this.getTerminalGeneratingProjNum();switch(t){case 0:return!1;case 1:var i=this.getSingleGeneratingProj();return i.hasExplicitProjMatches(e);default:return!0}}function internalRootQueryCalcIsCompiled(){return void 0!==this.queryCalc}function internalRootQueryCalcNeedToLower(){return this.isProjection()&&void 0!==this.lowerMatchPoints&&this.lowerMatchPoints.size>0}function internalRootQueryCalcGetQueryResults(){return this.results}function internalRootQueryCalcGetSingleGeneratingProj(e){if(void 0!==e)return this.generatingProjs.get(e).queryCalc;if(1==this.terminalGeneratingProjNum){if(0==this.generatingProjs.size)return this.queryCalc;var t;return this.generatingProjs.forEach(function(e,i){t=e.queryCalc}),t}}function internalRootQueryCalcAddQueryResult(e){if(e){var t=e.getId();this.results.has(t)||(this.results.set(t,e),this.resultNum++)}}function internalRootQueryCalcRemoveQueryResult(e){if(!e)return!!this.resultNum;var t=e.getId();return this.results.has(t)?(this.queryCalc&&this.isProjection()&&this.queryCalc.removeResultProjMatches(t),this.results.delete(t),!!--this.resultNum):!!this.resultNum}function internalRootQueryCalcNewIntersectionQueryCalc(){return new IntersectionQueryCalc(this)}function internalRootQueryCalcNewUnionQueryCalc(){return new UnionQueryCalc(this)}function internalRootQueryCalcNewNegationQueryCalc(e){e=this.indexer.qcm.allocateConcatPathId(this.prefixProjPathId,e);var t=new NegationQueryCalc(this,e);return this.indexer.qcm.releasePathId(e),t}function internalRootQueryCalcNewSimpleQueryCalc(e){e=this.indexer.qcm.allocateConcatPathId(this.prefixProjPathId,e);var t=new SimpleQueryCalc(this,e);return this.indexer.qcm.releasePathId(e),t}function internalRootQueryCalcNewProjectionQueryCalc(e){e=this.indexer.qcm.allocateConcatPathId(this.prefixProjPathId,e);var t=new ProjectionQueryCalc(this,e);return this.indexer.qcm.releasePathId(e),t}function internalRootQueryCalcNewTrueQueryCalc(e,t){e=this.indexer.qcm.allocateConcatPathId(this.prefixProjPathId,e);var i=new TrueQueryCalc(this,e,t);return this.indexer.qcm.releasePathId(e),i}function internalRootQueryCalcRefreshQuery(){return this.queryCalc?(debugStartTimer("query","query refresh"),this.raisedMatches&&(this.suspendedRaisedMatches=this.raisedMatches),this.queryCalc.refreshQuery(),void 0!==this.suspendedRaisedMatches&&(this.suspendedRaisedMatches=void 0),void debugStopTimer("query refresh")):void this.queryStructureRefreshed()}function internalRootQueryCalcUpdateQueryAfterNodeRemoval(){}function internalRootQueryCalcQueryStructureRefreshed(){this.projPathId=this.getProjectionPathId(),this.notifyModifiedGeneratingProjs()}function internalRootQueryCalcAssignQueryCalc(e){this.queryCalc!=e&&(void 0===e||e.isProjection()||this.addModifiedGeneratingProj(0),this.detachFromQueryCalc(),this.queryCalc=e,this.projPathId=this.getProjectionPathId(),this.queryCalc&&this.initializeMatching())}function internalRootQueryCalcDetachFromQueryCalc(){if(this.queryCalc&&!this.destroyed){var e=this.isSelection();this.resultNum&&e&&this.removeAllSelectionMatches(),this.queryCalc.removeTheRoot(),delete this.queryCalc,e||this.updateQueryAfterNodeRemoval()}}function internalRootQueryCalcAddToMatchPoints(e){e>this.prefixProjPathId&&(void 0===this.lowerMatchPoints&&(this.lowerMatchPoints=new Map),this.lowerMatchPoints.set(e,1),void 0===this.raisedMatches&&(this.raisedMatches=new Map))}function internalRootQueryCalcRemoveFromMatchPoints(e){e>this.prefixProjPathId&&(this.lowerMatchPoints.delete(e),0===this.lowerMatchPoints.size&&(this.raisedMatches=void 0))}function internalRootQueryCalcGetDomain(){return this.indexer.getAllMatches(this.prefixProjPathId)}function internalRootQueryCalcGetDomainAsObj(){return this.indexer.getAllMatchesAsObj(this.prefixProjPathId)}function internalRootQueryCalcGetMatches(){if(this.isProjection())return[];if(void 0===this.lowerMatchPoints||0===this.lowerMatchPoints.size)return this.queryCalc?this.queryCalc.getMatches():[];var e=this.queryCalc?this.queryCalc.getFullyRaisedMatches():[];return this.raisedMatches&&this.raisedMatches.size>0&&(e=e.concat(),this.raisedMatches.forEach(function(t,i){e.push(i)})),e}function internalRootQueryCalcGetMatchesAsObj(){if(this.isProjection())return new Map;if(void 0===this.lowerMatchPoints||0===this.lowerMatchPoints.size)return this.queryCalc?this.queryCalc.getMatchesAsObj():new Map;var e=this.queryCalc?this.queryCalc.getFullyRaisedMatchesAsObj():new Map;if(this.raisedMatches&&this.raisedMatches.size>0){if(e.size>0){var t=e;e=new Map,t.forEach(function(t,i){e.set(i,t)})}else void 0!==this.queryCalc&&(e=new Map);this.raisedMatches.forEach(function(t,i){e.set(i,1)})}return e}function internalRootQueryCalcFilterMatches(e){if(!this.queryCalc)return[];var t=this.queryCalc.filterMatches(e);if(void 0===this.lowerMatchPoints||0===this.lowerMatchPoints.size||!this.raisedMatches||0==this.raisedMatches.size)return t;for(var i=0,r=e.length;i<r;++i){var n=e[i];this.raisedMatches.has(n)&&t.push(n)}return t}function internalRootQueryCalcFilterMatchPositions(e){if(!this.queryCalc)return[];var t=this.queryCalc.filterMatchPositions(e);if(void 0===this.lowerMatchPoints||0===this.lowerMatchPoints.size||!this.raisedMatches||0==this.raisedMatches.size)return t;for(var i=0,r=t[i],n=[],o=0,s=e.length;o<s;++o)if(o==r)n.push(o),r=t[++i];else{var a=e[o];this.raisedMatches.has(a)&&n.push(o)}return n}function internalRootQueryCalcInitializeMatching(){if(void 0!==this.lowerMatchPoints&&(this.lowerMatchPoints=new Map),this.raisedMatches&&delete this.raisedMatches,this.queryCalc){var e=this.queryCalc.getFullCountMatchPoints(),t=this;e.forEach(function(e,i){t.addToMatchPoints(i)})}void 0!==this.lowerMatchPoints&&0!==this.lowerMatchPoints.size&&(this.raisedMatches=new Map),this.queryCalc.setRootAsMatchParent()}function internalRootQueryCalcAddMatches(e){if(!this.destroyed){var t;t=void 0===this.lowerMatchPoints||0===this.lowerMatchPoints.size?e:this.addMatchesToSelectionRoot(e);var i=this;this.results.forEach(function(e,r){i.queuedAllMatchUpdates&&i.queuedAllMatchUpdates.has(r)||e.addMatches(t,i)})}}function internalRootQueryCalcAddMatchesToSelectionRoot(e){var t=[],i=e.length,r=this.indexer.getDataElements(),n=this.prefixProjPathId;this.raisedMatches||(this.raisedMatches=new Map);for(var o=0;o<i;++o){var s,a=s=e[o];a=r.raiseToPath(a,n),a!=s?this.raisedMatches.has(a)?this.raisedMatches.set(a,this.raisedMatches.get(a)+1):(this.raisedMatches.set(a,1),t.push(a)):t.push(a)}return t}function internalRootQueryCalcQueueAddAllMatchesToDominating(e){e&&(this.queuedAllMatchUpdates||(this.queuedAllMatchUpdates=new Map),this.queuedAllMatchUpdates.set(e.getId(),e))}function internalRootQueryCalcAddAllMatchesToQueuedResults(){if(this.queuedAllMatchUpdates&&this.results){if(this.isSelection()){var e,t=this;this.queuedAllMatchUpdates.forEach(function(i,r){t.results.has(r)&&(e||(e=t.getMatches()),i.addMatches(e,t))})}this.queuedAllMatchUpdates=void 0}}function internalRootQueryCalcRemoveMatches(e){if(!this.destroyed){var t;t=this.suspendedRaisedMatches||void 0!==this.lowerMatchPoints&&0!==this.lowerMatchPoints.size&&this.raisedMatches&&0!=this.raisedMatches.size?this.removeMatchesFromSelectionRoot(e):e;var i=this;this.results.forEach(function(e,r){i.queuedAllMatchUpdates&&i.queuedAllMatchUpdates.has(r)||e.removeMatches(t,i)})}}function internalRootQueryCalcRemoveMatchesFromSelectionRoot(e){for(var t=[],i=e.length,r=this.indexer.getDataElements(),n=this.prefixProjPathId,o=this.raisedMatches?this.raisedMatches:this.suspendedRaisedMatches,s=0;s<i;++s){var a,d=a=e[s];d=r.raiseToPath(d,n),d!=a?1==o.get(d)?(o.delete(d),t.push(d)):o.set(d,o.get(d)-1):t.push(d)}return t}function internalRootQueryCalcRemoveAllSelectionMatches(){var e;if(this.isSelection())var t=this;this.results.forEach(function(i,r){void 0===e&&(e=t.getMatches()),i.removeMatches(e,t)}),this.raisedMatches&&(this.raisedMatches=new Map)}function internalRootQueryCalcRefreshProjMustGenerateMatches(e,t){this.queryCalc&&this.queryCalc.refreshProjMustGenerateMatches(e,t)}function internalRootQueryCalcInitExplicitProjMatches(e,t){this.queryCalc&&this.queryCalc.initExplicitProjMatches(e,t)}function internalRootQueryCalcSetExplicitProjMatches(e){this.queryCalc&&this.queryCalc.setExplicitProjMatches(e)}function internalRootQueryCalcReleaseExplicitProjMatches(e){this.queryCalc&&this.queryCalc.releaseExplicitProjMatches(e)}function internalRootQueryCalcGetProjMatches(e){var t=this.results.get(e);if(t.restrictsProjection()){var i=t.getSelectionMatches();return this.queryCalc.lowerToProjMatchPoints(i,this.lowerMatchPoints)}}function internalRootQueryCalcGetProjMatchesAsObj(e){var t=this.results.get(e);if(t.restrictsProjection()){if(void 0===this.lowerMatchPoints||0===this.lowerMatchPoints.size)return t.getSelectionMatchesAsObj();var i=t.getSelectionMatches();this.queryCalc.lowerToProjMatchPoints(i,this.lowerMatchPoints);for(var r=new Map,n=0,o=i.length;n<o;++n)r.set(i[n],!0);return r}}function internalRootQueryCalcFilterProjMatches(e,t){var i=this.results.get(t);if(!i.isActive())return[];if(!i.restrictsProjection())return e;var r=i.getSelectionMatchesAsObj(),n=[];if(void 0===this.lowerMatchPoints||0===this.lowerMatchPoints.size)for(var o=0,s=e.length;o<s;++o){var a=e[o];r.has(a)&&n.push(a)}else for(var d=this.indexer.getDataElements(),u=this.prefixProjPathId,o=0,s=e.length;o<s;++o){var a=e[o],h=a;a=d.raiseToPath(a,u),r.has(a)&&n.push(h)}return n}function internalRootQueryCalcSetProjMatches(e){this.destroyed||this.queryCalc&&this.queryCalc.setProjMatches(e)}function internalRootQueryCalcAddProjMatches(e,t){if(!this.destroyed&&e.length&&this.queryCalc){var i;void 0!==this.lowerMatchPoints&&0!==this.lowerMatchPoints.size&&(i=e.length,e=this.lowerProjMatches(e)),this.queryCalc.addProjMatches(e,t),void 0!==this.lowerMatchPoints&&0!==this.lowerMatchPoints.size&&(e.length=i)}}function internalRootQueryCalcRemoveProjMatches(e,t){if(!this.destroyed&&e.length&&this.queryCalc){var i;void 0!==this.lowerMatchPoints&&0!==this.lowerMatchPoints.size&&(i=e.length,e=this.lowerProjMatches(e)),this.queryCalc.removeProjMatches(e,t),void 0!==this.lowerMatchPoints&&0!==this.lowerMatchPoints.size&&(e.length=i)}}function internalRootQueryCalcLowerProjMatches(e){if(void 0===this.lowerMatchPoints||0===this.lowerMatchPoints.size)return e;var t=[];return this.lowerMatchPoints.forEach(function(e,i){t.push(i)}),this.indexer.lowerDataElementsTo(e,t)}function internalRootQueryCalcLowerProjMatchesAsObj(e){if(void 0===this.lowerMatchPoints||0===this.lowerMatchPoints.size)return e;var t=[];e.forEach(function(e,i){t.push(i)});var i=t.length;t=this.lowerProjMatches(t);for(var r=i,n=t.length;r<n;++r)e.set(t[r],!0);return e}function internalRootQueryCalcRemoveAllTerminalProjMatches(e){this.resultNum&&this.results.forEach(function(t,i){t.removeAllTerminalProjMatches(e)})}function internalRootQueryCalcAddAllTerminalProjMatches(e){var t=this.results.get(e);t&&this.generatingProjs.forEach(function(i,r){var n=i.queryCalc;n&&n.isGeneratingProjectionTerminal()&&t.addTerminalProjMatches(n,n.getProjMatches(e))})}function internalRootQueryCalcCalcGetGeneratingProj(e){this.generatingProjs||(this.generatingProjs=new Map);var t,i=e.getId();return this.generatingProjs.has(i)?t=this.generatingProjs.get(i):(t={queryCalc:e},this.generatingProjs.set(i,t)),t}function internalRootQueryCalcIsTerminalGeneratingProj(e){return!e.children&&(!e.parent||e.pathId>this.prefixProjPathId)}function internalRootQueryCalcAddSimpleGeneratingProj(e){var t,i=e.getId(),r=this.getGeneratingProj(e);r.pathId||(t=this.findGeneratingParent(e,r)),r.pathId=e.pathId,t&&!t.pathId?this.calcIntersectionGeneratingProjPath(r.parent,t)||this.calcMappedPathId(i,r):this.calcMappedPathId(i,r)}function internalRootQueryCalcAddIntersectionGeneratingProj(e){var t=e.getId(),i=this.getGeneratingProj(e);if(!i.children){i.children={};for(var r=[e],n=0;n<r.length;++n){var o,s=r[n],a=s.getId();if(t!=a&&(o=this.generatingProjs.get(a)))this.setGeneratingParent(a,o,!0,t,i);else for(var d in s.projSubNodes)r.push(s.projSubNodes[d])}this.findGeneratingParent(e,i),this.calcIntersectionGeneratingProjPath(t,i)||this.calcMappedPathId(t,i)}}function internalRootQueryCalcAddSelectionGeneratingProj(e){var t=e.getId(),i=this.getGeneratingProj(e);if(i.pathId){if(i.parent){var r=this.generatingProjs.get(i.parent);r.children&&r.children[t]&&(delete r.children[t],r.selections||(r.selections={}),r.selections[t]=!0)}}else this.findGeneratingParent(e,i);i.pathId=this.prefixProjPathId,this.calcMappedPathId(t,i)}function internalRootQueryCalcRemoveGeneratingProj(e){if(!this.destroyed&&this.generatingProjs){var t=e.getId(),i=this.generatingProjs.get(t);if(i){this.isTerminalGeneratingProj(i)&&(this.removeAllTerminalProjMatches(e),this.addModifiedGeneratingProj(t),this.terminalGeneratingProjNum--),i.mappedPathId&&this.indexer.qcm.releasePathId(i.mappedPathId);var r=i.parent?this.generatingProjs.get(i.parent):void 0;if(r&&(i.pathId==this.prefixProjPathId?delete r.selections[t]:delete r.children[t]),i.children)for(var n in i.children){var o=this.generatingProjs.get(n);o.parent=i.parent,r&&(r.children[n]=!0),this.calcMappedPathId(n,o)}if(i.selections)for(var s in i.selections){var a=this.generatingProjs.get(s);(a.parent=i.parent)?(r.selections||(r.selections={}),r.selections[s]=!0):this.calcMappedPathId(s,a)}this.generatingProjs.delete(t)}}}function internalRootQueryCalcFindGeneratingParent(e,t){for(var i,r,n=e.parent;n&&!(r=this.generatingProjs.get(i=n.getId()));n=n.parent);return r?(this.setGeneratingParent(e.getId(),t,e.isProjection(),i,r),r):void(t.parent=void 0)}function internalRootQueryCalcSetGeneratingParent(e,t,i,r,n){if(t.parent!=r){var o=t.parent?this.generatingProjs.get(t.parent):void 0;i?(o&&delete o.children[e],n.children[e]=!0):(o&&delete o.selections[e],n.selections||(n.selections={}),n.selections[e]=!0),t.parent=r}}function internalRootQueryCalcCalcMappedPathId(e,t){if(t.pathId){var i;if(t.parent){if(t.pathId!=this.prefixProjPathId){var r=this.generatingProjs.get(t.parent);if(!r.pathId||!r.mappedPathId)return;var n=this.indexer.qcm.getFirstAttrAfterPrefix(r.pathId,t.pathId);i=this.indexer.qcm.allocatePathId(r.mappedPathId,n)}}else i=this.indexer.qcm.getRootPathId();if(t.mappedPathId&&this.indexer.qcm.releasePathId(t.mappedPathId),t.mappedPathId!=i&&(t.children||(this.addModifiedGeneratingProj(e),t.mappedPathId?i||this.terminalGeneratingProjNum--:this.terminalGeneratingProjNum++),t.mappedPathId=i,t.children))for(var o in t.children)this.calcMappedPathId(o,this.generatingProjs.get(o))}}function internalRootQueryCalcCalcIntersectionGeneratingProjPath(e,t){var i=[];for(var r in t.children){var n=this.generatingProjs.get(r);n.pathId&&i.push(n.pathId)}var o=i.length<2?void 0:this.indexer.qcm.getCommonPrefix(i);if(o==t.pathId)return!1;if(t.pathId=o,!o){if(t.mappedPathId&&(this.indexer.qcm.releasePathId(t.mappedPathId),t.mappedPathId=void 0),t.parent){var s=this.generatingProjs.get(t.parent);this.calcIntersectionGeneratingProjPath(t.parent,s)}return!0}var a=!1;if(t.parent){var s=this.generatingProjs.get(t.parent);s.pathId||(a=this.calcIntersectionGeneratingProjPath(t.parent,s))}return a||this.calcMappedPathId(e,t),!0}function internalRootQueryCalcAddModifiedGeneratingProj(e){this.modifiedGeneratingProjs||(this.modifiedGeneratingProjs=new Map,0!==e&&0==this.terminalGeneratingProjNum&&this.modifiedGeneratingProjs.set(0,!0)),this.modifiedGeneratingProjs.set(e,!0)}function internalRootQueryCalcGeneratingProjMapping(e){if(0==e)return this.isProjection()?void 0:[this.indexer.qcm.getRootPathId(),this.prefixProjPathId];if(this.generatingProjs&&this.generatingProjs.has(e)){var t=this.generatingProjs.get(e);if(t.pathId!=this.prefixProjPathId||!t.parent){var i=t.parent?this.generatingProjMapping(t.parent):[];return i.push(t.mappedPathId),i.push(t.pathId),i}}}function internalRootQueryCalcGetGeneratingProjMappings(){var e=new Map;if(!this.isProjection())return e.set(0,[this.indexer.qcm.getRootPathId(),this.prefixProjPathId]),e;var t=this;return this.generatingProjs.forEach(function(i,r){t.isTerminalGeneratingProj(i)&&e.set(r,t.generatingProjMapping(r))}),e}function internalRootQueryCalcGetTerminalGeneratingProjs(){var e=[];if(this.generatingProjs){var t=this;this.generatingProjs.forEach(function(i,r){t.isTerminalGeneratingProj(i)&&e.push(i.queryCalc)})}return e}function internalRootQueryCalcGetTerminalProjMatches(e,t){if(0===t)return this.getMatches();if(void 0===this.generatingProjs)return[];var i=this.generatingProjs.get(t);return void 0===i?[]:i.queryCalc.getProjMatches(e)}function internalRootQueryCalcFilterTerminalProjMatches(e,t,i){if(0===t)return this.filterMatches(i);if(void 0===this.generatingProjs)return[];var r=this.generatingProjs.get(t);return void 0===r?[]:r.queryCalc.filterProjMatches(i,e)}function internalRootQueryCalcNotifyModifiedGeneratingProjs(){if(!this.modifiedGeneratingProjs)return void this.results.forEach(function(e,t){e.updateTerminalProjs(void 0)});var e=new Map,t=this;this.modifiedGeneratingProjs.forEach(function(i,r){e.set(r,t.generatingProjMapping(r))});var i=!1;if(this.results.forEach(function(t,r){t.updateTerminalProjs(e),t.isActive()&&(i=!0)}),i&&void 0!==this.generatingProjs){var t=this;this.modifiedGeneratingProjs.forEach(function(e,i){var r=t.generatingProjs.get(i);void 0!==r&&t.isTerminalGeneratingProj(r)&&r.queryCalc.suspendProjection()})}this.modifiedGeneratingProjs=void 0}function NegationKey(){this.negated=new Uint31HashSet(8)}function negationKeyAddNegated(e){this.negated.set(e)}function negationKeyRemoveNegated(e){this.negated.delete(e)}function negationKeyNumNegated(){return this.negated.size}function negationKeyIsNegated(e){return this.negated.has(e)}function negationKeyGetNegated(){return this.negated}function negationKeySimpleCopy(){var e=new NegationKey;return e.negated.expectSize(this.negated.size),this.negated.forEach(function(t,i){e.addNegated(i)}),e}function Query(e){this.FuncResult(e),this.rootElementIds=new Map,this.lockedActive=void 0,this.queryTree=new Map,this.numTerminals=0,this.numProjTerminals=0,this.rootQueryCalcs=new Map,this.pendingUpdates=!1}function queryDestroy(){return this.rootQueryCalcs.size>0?void(this.pendingDestroy=!0):(this.destroyed=!0,this.detachFromIndexer(),void this.FuncResult_destroy())}function queryLockActive(e){if(this.lockedActive)return void(this.lockedActive.has(e)||this.lockedActive.set(e,!0));var t=this.isActive();this.lockedActive=new Map,this.lockedActive.set(e,!0),t||this.activated()}function queryUnlockActive(e){if(void 0!==this.lockedActive&&this.lockedActive.has(e)){if(this.lockedActive.size>1)return void this.lockedActive.delete(e);this.lockedActive=void 0,this.isActive()||this.deactivated()}}function queryIsProjection(){return this.numProjTerminals>0}function queryIsPureProjection(){return 1==this.numProjTerminals&&1==this.numTerminals}function querySupportsMultiProj(){return!1}function queryIsActive(){return void 0!==this.lockedActive||this.rootQueryCalcs.size>0}function queryDeactivated(){this.isActiveStar()||(this.detachFromIndexer(),this.FuncResult_deactivated())}function queryRefreshIndexerAndPaths(){var e=this.dataObj?this.dataObj.getDominatedIndexer():void 0,t=this.dataObj?this.dataObj.getDominatedProjPathId():void 0;this.indexer==e&&this.rootPathId==t||(this.detachFromIndexer(),this.indexer=e,this.rootPathId=t,void 0!==this.indexer&&void 0!==this.rootPathId&&(this.monitorId=this.indexer.addSubTreeMonitor(this.rootPathId,this)))}function queryAddDataObjMatches(e,t){if(t)return void this.addMatches(this.dataObj.getDominatedMatches());for(var i=this.dataObj.getDominatedMatches(),r=newDataObj.getDominatedMatchesAsObj(),n=[],o=0,s=i.length;o<s;++o){var a=i[o];r.has(a)||n.push(a)}this.addMatches(n)}function queryRemoveDataObjMatches(e,t){if(t)return void this.removeAllRootElements();for(var i=this.dataObj.getDominatedMatches(),r=e.getDominatedMatchesAsObj(),n=[],o=0,s=i.length;o<s;++o){var a=i[o];r.has(a)||n.push(a)}this.removeMatches(n)}function queryRemoveAllRootElements(){var e=this;this.rootElementIds.forEach(function(t,i){e.indexer.unregisterSubTreeRetrievalOnNode(e.rootPathId,i,e.monitorId)}),this.rootElementIds=new Map}function queryDetachFromIndexer(){void 0!==this.monitorId&&(this.removeAllRootElements(),this.indexer.removeSubTreeMonitor(this.rootPathId,this.monitorId),this.monitorId=void 0)}function queryAddMatches(e){for(var t=0,i=e.length;t<i;++t){var r=e[t];this.rootElementIds.has(r)||this.indexer.isOperand(r,this.rootPathId)||(this.rootElementIds.set(r,!0),this.indexer.registerSubTreeRetrievalOnNode(this.rootPathId,r,this.monitorId,this))}}function queryAddProjMatches(e){this.addMatches(e)}function queryRemoveMatches(e){for(var t=0,i=e.length;t<i;++t){var r=e[t];this.rootElementIds.has(r)&&(this.indexer.unregisterSubTreeRetrievalOnNode(this.rootPathId,r,this.monitorId),this.rootElementIds.delete(r))}}function queryRemoveProjMatches(e){this.removeMatches(e)}function queryNewRootQueryCalc(e,t,i){return new InternalRootQueryCalc(this,e,t,i)}function queryAddRootQueryCalcNode(e){var t=e.getId();if(!this.rootQueryCalcs.has(t)){if(this.pendingUpdates)return void 0===this.pendingAddedRootQueryCalcs&&(this.pendingAddedRootQueryCalcs=new Map),void this.pendingAddedRootQueryCalcs.set(t,e);this.rootQueryCalcs.set(t,e),1==this.rootQueryCalcs.size&&this.activated(),this.generateQueryCalcs(t),e.refreshQuery()}}function queryAddPendingRootQueryCalcs(){if(void 0!==this.pendingAddedRootQueryCalcs){var e=this;this.pendingAddedRootQueryCalcs.forEach(function(t,i){e.rootQueryCalcs.has(i)||(e.rootQueryCalcs.set(i,t),1==e.rootQueryCalcs.size&&e.activated())}),this.generateQueryCalcs(this.pendingAddedRootQueryCalcs),this.pendingAddedRootQueryCalcs=void 0}}function queryRemoveRootQueryCalcNode(e){if(void 0!==this.pendingAddedRootQueryCalcs&&this.pendingAddedRootQueryCalcs.has(e))this.pendingAddedRootQueryCalcs.delete(e);else{if(!this.rootQueryCalcs.has(e))return;this.destroyQueryCalcsForRoot(e),this.rootQueryCalcs.delete(e),0==this.rootQueryCalcs.size&&(this.pendingDestroy?this.destroy():this.isActive()||this.deactivated())}}function queryIsSimpleType(e){return!!e&&"negation"!=e&&"projector"!=e&&"true"!=e}function queryGetParentDataElement(e){if(0!=e){var t=this.indexer.getParentDataElement(e);if(void 0==t)return 0;var i=this.indexer.getDataElementPathId(t);return i>=this.rootPathId?t:this.indexer.getDataElementPathId(e)<=this.rootPathId?0:t}}function queryIsPathPrefixOf(e,t){return this.indexer.qcm.isPrefixOf(e,t)}function queryHasSiblings(e){if(0==e)return!1;var t=this.getParentDataElement(e),i=this.queryTree.get(t);if(!i)return!1;var r=this.getElementPathId(e);return i.childCount.get(r)>1}function queryGetElementPathId(e){if(0==e)return this.indexer.getRootPathId();var t=this.indexer.getDataElementPathId(e),i=this.indexer.qcm.diffPathId(t,this.rootPathId);return void 0===i?this.indexer.getRootPathId():i}function queryGetElementEntry(e){var t=this.queryTree.get(e);if(void 0!==t)return t;if(t={paths:new Map},this.queryTree.set(e,t),0==e)return t;var i=this.getParentDataElement(e);return this.increaseChildCountAndUpdateNegation(i,e),t}function queryRemoveElementEntry(e){var t=this.queryTree.get(e);if(t){if(void 0!==t.queryCalcs&&this.destroyQueryCalcs(t.queryCalcs),t.negationId&&this.updateNegationValue(this.getElementPathId(e),t.negationId,-e),0!=e){var i=this.getParentDataElement(e);this.decreaseChildCount(i,e)}this.queryTree.delete(e)}}function queryIncreaseChildCountAndUpdateNegation(e,t){var i=this.getElementEntry(e),r=this.getElementPathId(t);void 0===i.childCount&&(i.childCount=new IntHashMapUint(void 0,8)),2==i.childCount.inc(r,1)&&(i.paths.size>1||!i.paths.has(r))&&this.repropagateUnder(e,r,i);var n;void 0!==(n=i.paths.get(r))&&"negation"==n.type&&(this.addNegation(e,r,n.key,t),this.queueUpdatePropagation(e,r))}function queryDecreaseChildCount(e,t){var i=this.queryTree.get(e),r=this.getElementPathId(t),n=i.childCount.dec(r,1);0==n&&0==i.childCount.size&&0==i.paths.size?this.removeElementEntry(e):1==n&&i.paths.size>1&&this.repropagateUnder(e,r,i)}function queryGetPathEntry(e,t){var i=this.getElementEntry(e),r=i.paths.get(t);if(void 0!==r)return r;if(0!=e&&1==i.paths.size&&!i.negationId){var n=this;i.paths.forEach(function(t,i){void 0!==t.dominated&&t.dominated.forEach(function(t,r){n.removePropagation(e,i,r),n.queueUpdatePropagation(e,i,r)})})}return r={},i.paths.set(t,r),r}function queryQueueUpdatePropagation(e,t,i){this.queuedByPathId||(this.queuedByPathId=new Map);var r,n=e?this.getElementPathId(e):-1,o=!0;this.queuedByPathId.has(n)?r=this.queuedByPathId.get(n):(r=new Map,this.queuedByPathId.set(n,r),o=!1);var s;if(r.has(e)?s=r.get(e):(s=new Map,r.set(e,s),o=!1),o||(this.propagationHeap||(this.propagationHeap=new Heap(function(e,t){return t.pathId===e.pathId?t.elementId-e.elementId:t.pathId-e.pathId})),this.propagationHeap.addSingle({pathId:n,elementId:e})),void 0===i)s.set(t,!0);else{var a;if((a=s.get(t))===!0)return;void 0===a&&(a=new Map,s.set(t,a)),a.set(i,!0)}}function queryAddUpdate(e,t,i,r){var n,o,s,a=this.getPathEntry(e,t);void 0!==i?(void 0!==a.type&&(a=this.removeUpdate(e,t,void 0,!0)),void 0===a.dominated?(a.numSimpleValues=0,a.dominated=new Map):s=a.dominated.get(i),void 0!==s&&s!==!0&&(n=s.type,o=s.key),1==r?(this.isSimpleType(n)&&a.numSimpleValues--,a.dominated.set(i,!0)):(a.numSimpleValues+=(this.isSimpleType(r.type)?1:0)-(this.isSimpleType(n)?1:0),void 0!==s&&s!==!0||(s={},a.dominated.set(i,s)),s.type=r.type,s.key="object"==typeof r.key?r.key.simpleCopy():r.key)):(void 0!==a.dominated?a=this.removeUpdate(e,t,void 0,!0):(n=a.type,o=a.key),void 0===n&&this.numTerminals++,n!==r.type&&("projector"==n&&"projector"!=r.type?this.numProjTerminals--:"projector"!=n&&"projector"==r.type&&this.numProjTerminals++),a.type=r.type,a.key="object"==typeof r.key?r.key.simpleCopy():r.key),this.clearQueryCalcsAfterValueChange(a,i,s,n,o),this.queueUpdatePropagation(e,t,i)}function queryRemoveUpdate(e,t,i,r){var n=this.queryTree.get(e);if(void 0!==n){var o=n.paths.get(t);if(void 0!==o){var s=0!=e&&!n.negationId;if("negation"==o.type)return this.removeNegationUpdate(e,n,t,o,i,r);if(void 0!==i)return this.removeDominatedUpdate(e,n,t,o,i,r);if(void 0!==o.dominated){var a=this;return o.dominated.forEach(function(i,s){o=a.removeDominatedUpdate(e,n,t,o,s,r)}),o}return void 0===o.type?o:(this.numTerminals--,"projector"==o.type&&this.numProjTerminals--,!s||1!=n.paths.size&&this.hasSiblings(e)||this.removePropagation(e,t),this.removePathEntry(e,n,t,o,r))}}}function queryRemoveNegationUpdate(e,t,i,r,n,o){var s=0!=e&&!t.negationId,a=r.key;if(void 0!==n)return this.removeNegation(e,i,a,n,r.queryCalcs),!s||1!=t.paths.size&&this.hasSiblings(e)||this.propagateUpdate(e,i),r;var d=this;return a.getNegated().forEach(function(t,n){d.removeNegation(e,i,a,n,r.queryCalcs)}),!s||1!=t.paths.size&&this.hasSiblings(e)||this.removePropagation(e,i),this.removePathEntry(e,t,i,r,o)}function queryRemoveDominatedUpdate(e,t,i,r,n,o){var s;return void 0===r.dominated||void 0===(s=r.dominated.get(n))?r:(0==e||t.negationId||1!=t.paths.size&&(1!=r.dominated.size||this.hasSiblings(e))||this.removePropagation(e,i,n),this.isSimpleType(s.type)&&r.numSimpleValues--,r.dominated.delete(n),this.removeDominatedEntryQueryCalcs(r,n,s,s.type),r.dominated.size>0?r:this.removePathEntry(e,t,i,r,o))}function queryRemovePathEntry(e,t,i,r,n){if(this.removePathEntryQueryCalcs(r),n)return r={},t.paths.set(i,r),r;if(t.paths.delete(i),0===t.paths.size)t.childCount&&0!==t.childCount.size||this.removeElementEntry(e);else if(1==t.paths.size&&!t.negationId){var o=this;t.paths.forEach(function(t,i){void 0!==t.dominated&&(o.removePropagation(e,i),o.queueUpdatePropagation(e,i))})}}function queryRemovePropagation(e,t,i){if(0!=e){var r=this.getParentDataElement(e),n=!i||this.queryTree.get(e).paths.size>1?e:i,o=this.hasSiblings(e)?this.getElementPathId(e):t;this.removeUpdate(r,o,n)}}function queryRepropagateUnder(e,t,i){var r=this;i.paths.forEach(function(i,n){r.isPathPrefixOf(n,t)&&("type"in i||void 0!==i.dominated&&i.dominated.forEach(function(t,i){r.queueUpdateSourceForPropagation(e,n,i),r.removeUpdate(e,n,i)}))})}function queryQueueUpdateSourceForPropagation(e,t,i){for(var r;e!=(r=this.getParentDataElement(i));i=r);var n=this.queryTree.get(i);if(n){var o=this;n.paths.forEach(function(e,r){o.isPathPrefixOf(r,t)&&o.queueUpdatePropagation(i,r)})}}function queryPropagateUpdate(e,t,i){var r=this.queryTree.get(e);if(void 0!==r&&!r.negationId){var n=this.getParentDataElement(e),o=r.paths.get(t);if(void 0!==o){var s=this.hasSiblings(e),a=s?this.getElementPathId(e):t;if(i){var d=void 0===o.dominated?void 0:o.dominated.get(i);if(void 0===d)return;var u=d;a!==t&&(u=!0);var h=r.paths.size>1?e:i;h!=i&&(u=!0),this.addUpdate(n,a,h,u)}else if(void 0!==o.dominated)if(r.paths.size>1)this.addUpdate(n,a,e,!0);else{var l=this;o.dominated.forEach(function(e,t){l.addUpdate(n,a,t,!!s||e)})}else if(o.type){var d=!(a==t&&(!s||this.isSimpleType(o.type)))||o;this.addUpdate(n,a,e,d)}}}}function queryPropagateQueuedPropagations(){if(this.propagationHeap){for(var e,t,i;e=this.propagationHeap.pop();){t!==e.pathId&&(i=this.queuedByPathId.get(e.pathId));var r=e.elementId,n=i.get(r),o=this;n.forEach(function(e,t){e===!0?(0!=r&&o.propagateUpdate(r,t),o.updatePathEntryQueryCalcs(r,t)):e.forEach(function(e,i){0!=r&&o.propagateUpdate(r,t,i),o.updateDominatedEntryQueryCalcs(r,t,i)})}),this.updateElementEntryQueryCalcs(r,n)}this.queuedByPathId=new Map}}function queryRemoveDominated(e){for(var t=this.indexer.getAllDominatedDataElements(e),i=0,r=t.length;i<r;++i){var n=t[i],o=this.queryTree.get(n);if(o&&(!o.childCount||0===o.childCount.size)){var s=this;o.paths.forEach(function(e,t){s.removeUpdate(n,t,void 0,!1)})}}}function queryUpdateSimpleElement(e,t,i,r){return this.pendingUpdates=!0,"negation"==i?void this.updateNegationValue(e,t):("boolean"==i&&r===!0&&(i="true"),void this.addUpdate(t,e,void 0,{type:i,key:r}))}function queryRemoveSimpleElement(e,t){this.pendingUpdates=!0,this.removeUpdate(t,e,void 0,!1)}function queryCompleteUpdate(){}function querySubTreeUpdate(e,t,i){this.refreshQuery()}function queryRefreshQuery(){this.pendingUpdates&&(this.doDebugging&&this.debugMessage("refreshing ",this.debugPrintQueryAndResults()),this.propagateQueuedPropagations(),this.addPendingRootQueryCalcs(),this.pendingUpdates=!1,this.rootQueryCalcs.forEach(function(e,t){e.refreshQuery()}))}function queryGetNegatedIds(e,t){var i=[],r=this.indexer.getOperandDataElements(e,t);if(void 0!==r){var n=this;r.forEach(function(e,t){n.queryTree.has(t)&&i.push(t)})}return i}function queryUpdateNegationValue(e,t,i){var r=this.getPathEntry(t,e);"negation"!=r.type&&((r.dominated||r.type)&&(r=this.removeUpdate(t,e,void 0,!0)),r.type="negation",r.key=new NegationKey,this.numTerminals++,0!=t&&this.queueUpdatePropagation(t,e));var n=r.key,o=r.queryCalcs;
if(void 0==i)for(var s=this.getNegatedIds(t,e),a=0,d=s.length;a<d;++a)this.addNegation(t,e,n,s[a]);else i<0?n.isNegated(-i)&&this.removeNegation(t,e,n,-i,o):n.isNegated(i)||this.addNegation(t,e,n,i);this.queueUpdatePropagation(t,e)}function queryAddNegation(e,t,i,r){var n=this.getElementEntry(r);if(n.negationId){if(n.negationId==e)return;var o=this.getPathEntry(n.negationId,t);o.key.removeNegated(e),0==o.key.numNegated()&&this.numTerminals++}else if(n.paths.size>0){var s=this;n.paths.forEach(function(e,t){s.removePropagation(r,t)})}0==i.numNegated()&&this.numTerminals--,n.negationId=e,i.addNegated(r)}function queryRemoveNegation(e,t,i,r,n){var o=this.getElementEntry(r);o.negationId=void 0,i.removeNegated(r),0==i.numNegated()&&this.numTerminals++,void 0!==n&&this.removeSubQueryCalcs(n,this.getQueryCalcsForElement(r))}function queryCreateAllQueryCalcs(e){var t=new Map;return this.rootQueryCalcs.forEach(function(i,r){var n=e(i);t.set(r,n)}),t}function queryCreateNewQueryCalcs(e,t,i){void 0===e&&(e=new Map);var r=this;return t.forEach(function(t,n){var o=r.rootQueryCalcs.get(n),s=i(o);e.set(n,s)}),e}function queryAddValueToSimpleQueryCalc(e,t,i,r,n,o){void 0===e&&(e=new Map);var s=this;return t.forEach(function(t,a){var d=s.rootQueryCalcs.get(a),u=e.get(a);void 0===u&&(u=d.newSimpleQueryCalc(i),e.set(a,u)),u.addValue(r,n,o)}),e}function queryDestroyQueryCalc(e,t){if(void 0!==e){var i=e.get(t);void 0!==i&&i.destroy(),e.delete(t)}}function queryDestroyQueryCalcs(e){e.forEach(function(e,t){e.destroy()})}function queryRemoveSubQueryCalcs(e,t){void 0!==e&&void 0!==t&&e.forEach(function(e,i){e.removeSubNode(t.get(i).getId())})}function queryGetQueryCalcsForElement(e){var t=this.queryTree.get(e);if(t){if(t.queryCalcs)return t.queryCalcs;if(0!==t.paths.size){var i;if(t.paths.forEach(function(e,t){i=e}),i.queryCalcs)return i.queryCalcs;if(i.unionQueryCalcs)return i.unionQueryCalcs;if(i.simpleQueryCalcs)return i.simpleQueryCalcs;if(t.negationId){if(void 0!==i.dominated&&1==i.dominated.size){var r;return i.dominated.forEach(function(e,t){r=e}),r.queryCalcs}for(var n=this.getParentDataElement(e);n;n=this.getParentDataElement(n)){var o=this.queryTree.get(n);if(void 0===(i=o.paths.get(pathId)))return;var r;if(!i.dominated||!(r=i.dominated.get(e)))return;if(r.queryCalcs)return r.queryCalcs;if(i.simpleQueryCalcs)return i.simpleQueryCalcs}}else;}}}function queryGetQueryCalcsForPath(e,t){var i=this.queryTree.get(e);if(i){var r=i.paths.get(t);if(r)return this.getQueryCalcsForPathEntry(t,r)}}function queryGetQueryCalcsForPathEntry(e,t){if(void 0!==t.queryCalcs)return t.queryCalcs;if(void 0!==t.unionQueryCalcs)return t.unionQueryCalcs;if(void 0!==t.simpleQueryCalcs)return t.simpleQueryCalcs;var i,r=this;return t.dominated.forEach(function(t,n){i=1==t?r.getQueryCalcsForPath(n,e):t.queryCalcs}),i}function queryUpdateElementEntryQueryCalcs(e,t,i){if(0!=this.rootQueryCalcs.size){var r=this.queryTree.get(e);if(r){var n=r.paths.size>1&&(0==e||void 0!==r.negationId||this.hasSiblings(e));if(!n)return void this.removeAllElementEntryQueryCalcs(e,r);var o=new Map,s=this;void 0!==t?t.forEach(function(e,t){var i=r.paths.get(t),n=void 0===i?void 0:s.getQueryCalcsForPathEntry(t,i);void 0!==n&&o.set(t,n)}):r.paths.forEach(function(e,t){o.set(t,s.getQueryCalcsForPathEntry(t,e))});var a=r.queryCalcs;if(a&&!i)o.forEach(function(e,t){a.forEach(function(t,i){t.addSubNode(e.get(i))})});else{var d=function(t){var i=t.newIntersectionQueryCalc(),r=t.getId();return o.forEach(function(e,t){i.addSubNode(e.get(r))}),0==e&&i.assignAsRoot(),i};void 0===a?r.queryCalcs=this.createAllQueryCalcs(d):void 0!==i&&this.createNewQueryCalcs(a,i,d)}}}}function queryRemoveAllElementEntryQueryCalcs(e,t){if(t.queryCalcs&&(this.destroyQueryCalcs(t.queryCalcs),t.queryCalcs=void 0),0===e){var i,r=this;t.paths.forEach(function(e,t){i=r.getQueryCalcsForPathEntry(t,e),i.forEach(function(e,t){e.assignAsRoot()})})}}function queryUpdatePathEntryQueryCalcs(e,t,i){if(0!==this.rootQueryCalcs.size){var r=this.queryTree.get(e);if(void 0!==r){var n=r.paths.get(t);if(void 0!==n){if(void 0!==n.type){var o=void 0!==r.negationId||this.hasSiblings(e)&&(!this.isSimpleType(n.type)||this.getElementPathId(e)!=t);this.updateTerminalEntryQueryCalcs(e,n,t,void 0,void 0,o,i)}else if(void 0!==n.dominated){var o=void 0!==r.negationId||0==e||this.hasSiblings(e)||r.paths.size>1,s=this;n.dominated.forEach(function(r,a){s.updateTerminalEntryQueryCalcs(e,n,t,a,r,o,i)})}this.updateUnionQueryCalcs(e,r,n,void 0,void 0,i)}}}}function queryUpdateDominatedEntryQueryCalcs(e,t,i){if(0!==this.rootQueryCalcs.size){var r=this.queryTree.get(e);if(void 0!==r){var n=r.paths.get(t);if(void 0!==n&&void 0!==n.dominated){var o=n.dominated.get(i);if(void 0!==o){var s=o!==!0&&(0==e||void 0!==r.negationId||this.hasSiblings(e)||r.paths.size>1);this.updateTerminalEntryQueryCalcs(e,n,t,i,o,s),this.updateUnionQueryCalcs(e,r,n,i,o)}}}}}function queryUpdateTerminalEntryQueryCalcs(e,t,i,r,n,o,s){var a=r?n:t;if(!o||a===!0)return void this.removeAllTerminalEntryQueryCalcs(e,t,i,r,n);if("negation"==a.type)return void this.updateNegationEntryQueryCalcs(a,i,s);var d=this.isSimpleType(a.type),u=r&&d,h=u?t.simpleQueryCalcs:a.queryCalcs;if(d){var l=void 0===r?e:r;if(void 0!==h)return void(void 0!==s?this.addValueToSimpleQueryCalc(h,s,i,l,a.type,a.key):h.forEach(function(e,t){e.addValue(l,a.type,a.key)}));var c=function(e){var t=e.newSimpleQueryCalc(i);return t.addValue(l,a.type,a.key),t}}else if("true"==a.type){var l=void 0===r?e:r;c=function(e){return e.newTrueQueryCalc(i,l)}}else c=function(e){return e.newProjectionQueryCalc(i)};void 0===h?(h=this.createAllQueryCalcs(c),u?t.simpleQueryCalcs=h:a.queryCalcs=h):void 0!==s&&this.createNewQueryCalcs(h,s,c)}function queryRemoveAllTerminalEntryQueryCalcs(e,t,i,r,n){var o=r?n:t,s=this.isSimpleType(o.type),a=r&&s,d=a?t.simpleQueryCalcs:o.queryCalcs;void 0!==d&&(this.destroyQueryCalcs(d),a?t.simpleQueryCalcs=void 0:o.queryCalcs=void 0)}function queryUpdateNegationEntryQueryCalcs(e,t,i){var r=e.queryCalcs;if(!r||i){var n=function(e){return e.newNegationQueryCalc(t)};r?this.createNewQueryCalcs(r,i,n):r=e.queryCalcs=this.createAllQueryCalcs(n)}var o=this;e.key.getNegated().forEach(function(e,t){var n=o.getQueryCalcsForElement(t);void 0!==i?i.forEach(function(e,t){r.get(t).addSubNode(n.get(t))}):r.forEach(function(e,t){e.addSubNode(n.get(t))})})}function queryUpdateUnionQueryCalcs(e,t,i,r,n,o){var s=void 0!==i.dominated&&i.dominated.size>1&&i.dominated.size>i.numSimpleValues&&(0==e||t.paths.size>1);if(!s)return void(i.unionQueryCalcs&&(i.unionQueryCalcs.forEach(function(e,t){e.splice()}),i.unionQueryCalcs=void 0));var a=i.unionQueryCalcs;if(!a||o){var d=function(e){return e.newUnionQueryCalc()};a?o&&this.createNewQueryCalcs(a,o,d):a=i.unionQueryCalcs=this.createAllQueryCalcs(d);var u=this;i.dominated.forEach(function(e,t){u.insertUnderUnionQueryCalcs(i,t,e,o)})}else void 0!==r&&this.insertUnderUnionQueryCalcs(i,r,n,o)}function queryInsertUnderUnionQueryCalcs(e,t,i,r){var n,o=e.unionQueryCalcs;n=i===!0?this.getQueryCalcsForElement(t):i.queryCalcs?i.queryCalcs:e.simpleQueryCalcs,n&&(void 0!==r?r.forEach(function(e,t){o.get(t).addSubNode(n.get(t))}):o.forEach(function(e,t){e.addSubNode(n.get(t))}))}function queryRemovePathEntryQueryCalcs(e){if(0!=this.rootQueryCalcs.size){if(void 0!==e.dominated){var t=this;e.dominated.forEach(function(e,i){e!==!0&&void 0!==e.queryCalcs&&(t.destroyQueryCalcs(e.queryCalcs),e.queryCalcs=void 0)})}void 0!==e.queryCalcs&&(this.destroyQueryCalcs(e.queryCalcs),e.queryCalcs=void 0),void 0!==e.unionQueryCalcs&&(this.destroyQueryCalcs(e.unionQueryCalcs),e.unionQueryCalcs=void 0),void 0!==e.simpleQueryCalcs&&(this.destroyQueryCalcs(e.simpleQueryCalcs),e.simpleQueryCalcs=void 0)}}function queryRemoveDominatedEntryQueryCalcs(e,t,i,r){if(0!=this.rootQueryCalcs.size&&(void 0!==i.queryCalcs?(this.destroyQueryCalcs(i.queryCalcs),i.queryCalcs=void 0):this.isSimpleType(r)&&e.simpleQueryCalcs&&(0==e.numSimpleValues?(this.destroyQueryCalcs(e.simpleQueryCalcs),e.simpleQueryCalcs=void 0):e.simpleQueryCalcs.forEach(function(e,i){e.removeValue(t)})),void 0!==i.unionQueryCalcs)){var n=void 0===i.dominated?0:i.dominated.size;0===n?(this.destroyQueryCalcs(e.unionQueryCalcs),i.unionQueryCalcs=void 0):n==i.numSimpleValues&&(i.unionQueryCalcs.forEach(function(e,t){e.splice()}),i.unionQueryCalcs=void 0)}}function queryClearQueryCalcsAfterValueChange(e,t,i,r,n){if(0!=this.rootQueryCalcs.size&&void 0!=r){var o,s=t?e.dominated.get(t).type:e.type,a=t?i:e;if("negation"==s&&"negation"==r){if(!(o=a.queryCalcs))return;var d=this;return void n.getNegated().forEach(function(e,t){if(!a.key.isNegated(t)){var i=d.getQueryCalcsForElement(t);i&&o.forEach(function(e,t){e.removeSubNode(i.get(t).getId())})}})}(this.isSimpleType(r)!=this.isSimpleType(s)||"negation"==r&&"negation"!=s||"projector"==r&&"projector"!=s)&&(t?this.removeDominatedEntryQueryCalcs(e,t,i,r):this.removePathEntryQueryCalcs(e))}}function queryGenerateQueryCalcs(e){if("object"!=typeof e){var t=new Map;t.set(e,!0),e=t}this.generateQueryCalcsFor(e,0)}function queryGenerateQueryCalcsFor(e,t,i){var r=this.queryTree.get(t);if(r){var n=this;if(void 0===i)r.paths.forEach(function(i,r){n.generateQueryCalcsFor(e,t,r)}),this.updateElementEntryQueryCalcs(t,void 0,e);else{var o=r.paths.get(i);if(void 0!==o.dominated&&o.numSimpleValues<o.dominated.size)o.dominated.forEach(function(t,i){t===!0?n.generateQueryCalcsFor(e,i):"negation"==t.type&&n.generateQueryCalcsForNegated(e,t.key)});else if("negation"==o.type)this.generateQueryCalcsForNegated(e,o.key);else if(this.isSimpleType(o.type)&&void 0===r.negationId&&(!this.hasSiblings(t)||this.getElementPathId(t)==i))return void this.generateQueryCalcsFor(e,this.getParentDataElement(t),i);this.updatePathEntryQueryCalcs(t,i,e)}}}function queryGenerateQueryCalcsForNegated(e,t){var i=this;t.getNegated().forEach(function(t,r){i.generateQueryCalcsFor(e,r)})}function queryDestroyQueryCalcsForRoot(e){this.destroyQueryCalcsFor(e,0)}function queryDestroyQueryCalcsFor(e,t,i){var r;if(r=this.queryTree.get(t)){var n=this;if(void 0===i)return this.destroyQueryCalc(this.getQueryCalcsForElement(t),e),void r.paths.forEach(function(i,r){n.destroyQueryCalcsFor(e,t,r)});var o=r.paths.get(i);if(o.queryCalcs)return this.destroyQueryCalc(o.queryCalcs,e),void("negation"==o.type&&n.destroyQueryCalcForNegated(e,o.key));o.unionQueryCalcs&&(this.destroyQueryCalc(o.unionQueryCalcs,e),this.destroyQueryCalcAtDominatedEntries(e,o)),o.simpleQueryCalcs?this.destroyQueryCalc(o.simpleQueryCalcs,e):void 0!==o.dominated&&1==o.dominated.size&&this.destroyQueryCalcAtDominatedEntries(e,o)}}function queryDestroyQueryCalcAtDominatedEntries(e,t){var i=this;t.dominated.forEach(function(t,r){1==t?i.destroyQueryCalcsFor(e,r):t.queryCalcs&&(i.destroyQueryCalc(t.queryCalcs,e),"negation"==t.type&&i.destroyQueryCalcForNegated(e,t.key))})}function queryDestroyQueryCalcForNegated(e,t){var i=this;t.getNegated().forEach(function(t,r){i.destroyQueryCalcsFor(e,r)})}function queryDebugGetQueryDesc(){if(!this.indexer)return"<undefined>";var e=new DebugInternalTo(this.indexer.qcm);return e.setDataElementTable(this.indexer.getDataElements(),this.rootPathId),this.queryTree.forEach(function(t,i){t.paths.forEach(function(t,r){t.type&&("negation"==t.type?e.addValue(0,t.type,i,r):e.addValue(t.key,t.type,i,r))})}),e.getDescStr()}function queryDebugPrintQueryAndResults(){var e=[];this.rootQueryCalcs.forEach(function(t,i){var r=t.getQueryResults();r.forEach(function(t,i){e.push(i)})});var t;if(e.length>0){t="results: ";for(var i=0,r=e.length;i<r;++i)t+=e[i],i<r-1&&(t+=", ")}else t="<no results registered>";return"query "+this.id+" "+this.debugGetQueryDesc()+" "+t}function IdQueryCalc(e,t){this.InternalQueryCalc(e),this.pathId=e.prefixProjPathId,this.matches=new Map,this.otherQueryIds=new Map,this.updateQueue=[],this.indexer.addQueryCalcToPathNode(this),t&&this.addDataElements(t)}function idQueryCalcDestroy(){this.detachFromIndexer(),this.InternalQueryCalc_destroy()}function idQueryCalcIsProjection(){return!1}function idQueryCalcIsSelection(){return!1}function idQueryCalcAddDataElements(e){this.updateQueue.push({elementIds:e,add:!0})}function idQueryCalcRemoveDataElements(e){this.updateQueue.push({elementIds:e,add:!1})}function idQueryCalcRefreshQuery(){if(0!=this.updateQueue.length){if(1==this.updateQueue.length){var e=this.updateQueue[0];return this.updateQueue=[],void this.refreshQueryAfterSingleUpdate(e)}for(var t=new Map,i=new Map,r=this.indexer.pathHasAdditionsPending(this.pathId,this.id),n=0,o=this.updateQueue.length;n<o;++n){var e=this.updateQueue[n];if(e.add){for(var s=this.indexer.filterDataNodesAtPathWithDiff(this.pathId,e.elementIds,!r,!1),a=0,d=s.matches.length;a<d;++a){var u=s.matches[a];this.matches.has(u)||(this.matches.set(u,1),i.has(u)?i.delete(u):t.set(u,!0))}for(var a=0,d=s.removed.length;a<d;++a){var u=s.removed[a];this.otherQueryIds.has(u)||this.otherQueryIds.set(u,!0)}}else for(var a=0,d=e.elementIds.length;a<d;++a){var u=e.elementIds[a];this.otherQueryIds.has(u)?this.otherQueryIds.delete(u):this.matches.has(u)&&(this.matches.delete(u),t.has(u)?t.delete(u):i.set(u,!0))}}if(this.updateQueue=[],this.matchParent){if(t.size){var h=[];t.forEach(function(e,t){h.push(t)}),this.matchParent&&this.matchParent.addMatches(h,this)}if(i.size){var l=[];i.forEach(function(e,t){l.push(t)}),this.matchParent&&this.matchParent.removeMatches(l,this)}}}}function idQueryCalcRefreshQueryAfterSingleUpdate(e){if(e.add){for(var t=[],i=this.indexer.pathHasAdditionsPending(this.pathId,this.id),r=this.indexer.filterDataNodesAtPathWithDiff(this.pathId,e.elementIds,!i,!1),n=0,o=r.matches.length;n<o;++n){var s=r.matches[n];this.matches.has(s)||(this.matches.set(s,1),t.push(s))}for(var n=0,o=r.removed.length;n<o;++n){var s=r.removed[n];this.otherQueryIds.has(s)||this.otherQueryIds.set(s,!0)}if(0==t.length)return;return void(this.matchParent&&this.matchParent.addMatches(t,this))}for(var a=[],n=0,o=e.elementIds.length;n<o;++n){var s=e.elementIds[n];this.matches.has(s)?(this.matches.delete(s),a.push(s)):this.otherQueryIds.has(s)&&this.otherQueryIds.delete(s)}0!=a.length&&this.matchParent&&this.matchParent.removeMatches(a,this)}function idQueryCalcAddMatches(e,t){if(0!=this.otherQueryIds.size){var i=[];this.otherQueryIds.forEach(function(e,t){i.push(t)});var r=this.indexer.filterNodesJustBeingAdded(this.pathId,i);if(0!=r.length){for(var n=0,o=r.length;n<o;++n){var s=r[n];this.matches.set(s,1),this.otherQueryIds.delete(s)}void 0!==this.matchParent&&this.matchParent.addMatches(r,this)}}}function idQueryCalcRemoveMatches(e,t){if(0!==this.matches.size){var i=[];this.matches.forEach(function(e,t){i.push(t)});var r=this.indexer.filterNodesJustBeingRemoved(this.pathId,i);if(0!=r.length){for(var n=0,o=r.length;n<o;++n){var s=r[n];this.otherQueryIds.set(s,!0),this.matches.delete(s)}void 0!==this.matchParent&&this.matchParent.removeMatches(r,this)}}}function IdQuery(e){this.id=InternalQCM.newId(),this.rootQueryCalcs={},this.numRootQueryCalcs=0,this.matches=new Map}function idQueryDestroy(){if(this.numRootQueryCalcs)return void(this.pendingDestroy=!0)}function idQueryGetId(){return this.id}function idQueryIsActive(){return!0}function idQueryLockActive(){}function idQueryUnlockActive(e){}function idQueryIsProjection(){return!1}function idQueryIsPureProjection(){return!1}function idQueryNewRootQueryCalc(e,t,i){return new InternalRootQueryCalc(this,e,t,i)}function idQueryAddNewRootQueryCalcNode(e){var t=e.getId();if(!this.rootQueryCalcs[t]){this.rootQueryCalcs[t]=e,this.numRootQueryCalcs++;var i=new IdQueryCalc(e);if(i.assignAsRoot(),this.matches.size>0){var r=[];this.matches.forEach(function(e,t){r.push(t)}),i.addDataElements(r)}e.refreshQuery()}}function idQueryRemoveNewRootQueryCalcNode(e){if(e in this.rootQueryCalcs){var t=this.rootQueryCalcs[e],i=t.queryCalc;i.destroy(),delete this.rootQueryCalcs[e],--this.numRootQueryCalcs||this.pendingDestroy&&this.destroy()}}function idQueryRefreshQuery(){for(var e in this.rootQueryCalcs)this.rootQueryCalcs[e].refreshQuery()}function idQueryAddDataElements(e){if(0!=e.length){for(var t=0,i=e.length;t<i;++t){var r=e[t];this.matches.has(r)||this.matches.set(r,1)}for(var n in this.rootQueryCalcs){var o=this.rootQueryCalcs[n].queryCalc;o.addDataElements(e)}}}function idQueryRemoveDataElements(e){if(0!=e.length){for(var t=0,i=e.length;t<i;++t){var r=e[t];this.matches.has(r)&&this.matches.delete(r)}for(var n in this.rootQueryCalcs){var o=this.rootQueryCalcs[n].queryCalc;o.removeDataElements(e)}}}function ElementOrderService(e,t,i){this.orderTree=e,this.elementId=t,this.isBackard=i,this.requirement=void 0,this.numRange=0,this.numOrderedRange=0,this.results=new Map}function elementOrderServiceAddResult(e){var t=e.getId();if(!this.results.has(t)){var i=!1,r=!1;if(void 0!==this.requirement&&(i||r)&&(this.requirement.notifyListeners(),this.requirement.destroy(),this.requirement=void 0),void 0===this.requirement&&(this.requirement=new ElementRequirement(this.elementId,this.isBackward,this.numRange>0,this.numOrderedRange>0,this.orderTree),this.requirement.notifyListeners(),this.results.size>0)){var n=this;this.results.forEach(function(e,t){n.requirement.addListener(e)})}this.results.set(t,e),this.requirement.addListener(e),this.pushInitialValue(e)}}function elementOrderServicePushInitialValue(e){if(e instanceof IndexOrderResult){var t=this.requirement.getOffset();e.updateOffset(this.elementId,t)}}function elementOrderServiceRemoveResult(e){var t=e.getId();if(!this.results.has(t))return this.results.size>0;if(this.results.delete(t),this.requirement.removeListener(e),0==this.results.size)return this.requirement.destroy(),!1;var i=!1,r=!1;if(i||r){this.requirement.notifyListeners(),this.requirement.destroy(),this.requirement=new ElementRequirement(this.elementId,this.isBackward,this.numRange>0,this.numOrderedRange>0,this.orderTree),this.requirement.notifyListeners();var n=this;this.results.forEach(function(e,t){n.requirement.addListener(e)})}return!0}function MinMaxPosHeap(e,t){this.MinMaxHeap(e),this.indexKey=t,this.reverseIndex=new Map}function minMaxPosHeapClear(){this.MinMaxHeap_clear(),this.reverseIndex=new Map}function minMaxPosHeapSwap(e,t){var i,r;void 0!==this.indexKey?(i=this.heap[e][this.indexKey],r=this.heap[t][this.indexKey]):(i=this.heap[e],r=this.heap[t]);var n=this.heap[e];this.heap[e]=this.heap[t],this.heap[t]=n,this.reverseIndex.set(i,t),this.reverseIndex.set(r,e)}function minMaxPosHeapAssignPos(e,t){var i;e<this.heap.length&&(i=this.heap[e]),void 0!==this.indexKey?(void 0!==i&&this.reverseIndex.delete(i[this.indexKey]),this.reverseIndex.set(t[this.indexKey],e)):(void 0!==i&&this.reverseIndex.delete(i),this.reverseIndex.set(t,e)),this.heap[e]=t}function minMaxPosHeapPopLastPos(){return void 0!==this.indexKey?this.reverseIndex.delete(this.heap[this.heap.length-1][this.indexKey]):this.reverseIndex.delete(this.heap[this.heap.length-1]),this.heap.pop()}function minMaxPosHeapAddArray(e,t){if(void 0!==this.indexKey)for(var i=0;i!==e.length;i++)this.reverseIndex.set(e[i][this.indexKey],this.heap.length+i);else for(var i=0;i!==e.length;i++)this.reverseIndex.set(e[i],this.heap.length+i);this.MinMaxHeap_addArray(e,t)}function minMaxPosHeapGetIndex(e){return this.heap[this.reverseIndex.get(e)]}function minMaxPosHeapRemoveIndex(e){this.removePos(this.reverseIndex.get(e))}function minMaxPosHeapGetPositionInHeap(e){return this.reverseIndex.get(e)-1}function minMaxPosHeapInitWithSortedArray(e,t,i,r){if(this.MinMaxHeap_initWithSortedArray(e,t,i,r),this.reverseIndex=new Map,void 0!==this.indexKey)for(var n=1;n!==this.heap.length;n++)this.reverseIndex.set(this.heap[n][this.indexKey],n);else for(var n=1;n!==this.heap.length;n++)this.reverseIndex.set(this.heap[n],n)}function minMaxPosHeapInHeap(e){return this.reverseIndex.has(e)}function minMaxPosHeapUpdate(e){var t;t=void 0!==this.indexKey?this.reverseIndex.get(e[this.indexKey]):this.reverseIndex.get(e),this.removePos(t),this.add(e)}function minMaxPosHeapVerify(){this.MinMaxHeap_verify();var e=this;this.reverseIndex.forEach(function(t,i){t in e.heap?void 0!==e.indexKey?e.heap[t][e.indexKey]!=i&&(console.log("error !=="),MinMaxHeap.errorCount++):e.heap[t]!=i&&(console.log("error !=="),MinMaxHeap.errorCount++):(console.log("error !in"),MinMaxHeap.errorCount++)})}function OrderRequirement(){this.id=++OrderRequirement.nextRequirementId,this.listeners=[]}function orderRequirementAddListener(e){for(var t=0,i=this.listeners.length;t<i;++t)if(e==this.listeners[t])return;this.listeners.push(e)}function orderRequirementRemoveListener(e){for(var t=0,i=this.listeners.length;t<i;++t)if(e==this.listeners[t])return t<i-1&&(this.listeners[t]=this.listeners[i-1]),void this.listeners.length--}function AtomicAbsOrderRequirement(e,t){this.OrderRequirement(),this.offset=e,this.isBackward=t,this.prevElement=void 0,this.element=void 0}function atomicAbsOrderRequirementUpdateElement(e,t,i,r){this.element=e}function atomicAbsOrderRequirementReplacedElement(e,t,i,r,n){this.element=e}function atomicAbsOrderRequirementClearAllElements(){this.element=void 0}function atomicAbsOrderRequirementNotifyListeners(){if(this.prevElement!==this.element){var e;void 0!==this.prevElement&&(e=[this.prevElement]);var t;void 0!==this.element&&(t=[this.element]);for(var i=0,r=this.listeners.length;i<r;++i){var n=this.listeners[i];void 0!==e&&n.removeMatches(e),void 0!==t&&n.addMatches(t)}this.prevElement=this.element}}function BeginAbsOrderRequirement(e,t){this.AtomicAbsOrderRequirement(e,t.isBackward),this.isOrderedRange=t.isOrderedRange,this.rangeRequirement=t,this.isBegin=!0}function beginAbsOrderRequirementGetEnd(){return this.rangeRequirement.endRequirement}function beginAbsOrderRequirementUpdateElement(e,t,i,r){void 0!==t&&(r===!0?void 0!==e&&this.rangeRequirement.addElement(e,this.offset):void 0!==this.element&&this.rangeRequirement.removeElement(this.element,this.offset)),this.element=e}function beginAbsOrderRequirementReplacedElement(e,t,i,r,n){this.isBackward?(this.rangeRequirement.addElements(r,n,this.element),this.rangeRequirement.removeElements(t,i,e)):(this.rangeRequirement.addElements(t,i,this.element),this.rangeRequirement.removeElements(r,n,e)),this.element=e}function beginAbsOrderRequirementClearAllElements(){this.AtomicAbsOrderRequirement_clearAllElements(),this.rangeRequirement.clearAllElements()}function beginAbsOrderRequirementGetForwardRange(){if(!this.isBackward)return[this.offset,this.getEnd().offset];var e=this.rangeRequirement.orderedTree.invertOffset(this.getEnd().offset),t=this.rangeRequirement.orderedTree.invertOffset(this.offset);return[e,t]}function beginAbsOrderRequirementUpdateReorderedRange(e,t){this.rangeRequirement.updateReorderedRange(e,t)}function beginAbsOrderRequirementNotifyListeners(){this.rangeRequirement.notifyListeners()}function EndAbsOrderRequirement(e,t,i){this.AtomicAbsOrderRequirement(e,t.isBackward),this.isOrderedRange=t.isOrderedRange,this.rangeRequirement=t,this.isEnd=!0,i&&(this.isReplacement=!0)}function endAbsOrderRequirementGetBegin(){return this.rangeRequirement.beginRequirement}function endAbsOrderRequirementUpdateElement(e,t,i,r){return void 0===t?void(this.element=e):(r===!0?(void 0!==this.element&&this.rangeRequirement.removeElement(this.element,this.offset),i>this.rangeRequirement.beginRequirement.offset&&this.rangeRequirement.addElement(t,i)):(void 0!==e&&this.rangeRequirement.addElement(e,this.offset),i>this.rangeRequirement.beginRequirement.offset&&this.rangeRequirement.removeElement(t,i)),void(this.element=e))}function endAbsOrderRequirementReplacedElement(e,t,i,r,n){this.isBackward?(this.rangeRequirement.addElements(t,i,this.element),this.rangeRequirement.removeElements(r,n,e)):(this.rangeRequirement.addElements(r,n,this.element),this.rangeRequirement.removeElements(t,i,e)),this.element=e}function endAbsOrderRequirementClearAllElements(){this.AtomicAbsOrderRequirement_clearAllElements()}function endAbsOrderRequirementAddRangeElements(e){this.rangeRequirement.addRangeElements(e)}function endAbsOrderRequirementNotifyListeners(){}function RangeOrderRequirement(e,t,i,r,n,o,s){this.OrderRequirement(),this.orderedTree=e,this.addedMatches=new Map,this.removedMatches=new Map,void 0!==t?this.updateOffsets(t,i,r,n,o,s):(this.isComplement=!!i,this.isOrderedRange=!!s,this.requirement=void 0)}function rangeOrderRequirementDestroy(){void 0!==this.requirement&&this.requirement.destroy()}function rangeOrderRequirementUpdateOffsets(e,t,i,r,n,o){this.isBackward=!t&&i,this.isOrderedRange=o;var s=this.requirement;void 0!==this.requirement&&t===this.isComplement||(this.requirement=t?new ComplementOrderRequirement(this,this.requirement):new SegmentOrderRequirement(this,this.requirement)),this.isComplement=t,this.isComplement?this.requirement.updateOffsets(e,r,n,o):this.requirement.updateOffsets(e,i,r,n,o),s!==this.requirement&&(void 0!==this.orderedRange&&(this.addedRange=this.orderedRange),void 0!==s&&s.destroy())}function rangeOrderRequirementDiffAfterReplacement(e,t){var i=void 0===t?[]:this.orderedTree.getRangeElementsByOffsets(t[0],t[1],this.isBackward);if(void 0===t||void 0==e||e[1]<t[0]||e[0]>t[1])this.setAddedAndRemovedRanges(this.orderedRange,i);else{var r,n;if(t[0]<e[0]?n=i.slice(0,e[0]-t[0]):t[0]>e[0]&&(r=this.isBackward?this.orderedRange.slice(-(t[0]-e[0])):this.orderedRange.slice(0,t[0]-e[0])),t[1]>e[1]){var o=i.slice(e[1]-t[0]+1);n=void 0===n?o:n.concat(o)}else if(t[1]<e[1]){var s=this.isBackward?this.orderedRange.slice(0,-(t[1]-e[0])):this.orderedRange.slice(t[1]-e[0]+1);r=void 0===r?s:r.concat(s)}this.setAddedAndRemovedRanges(r,n)}}function rangeOrderRequirementSetOffsetUpdateDiff(e,t,i,r){var n,o=this.requirement.getLowOffset(),s=this.requirement.getHighOffset();if(e.length&&t&&(n=e,this.isOrderedRange)){this.lowestOffsetChanged=o;var a=this.lowestOffsetChanged+e.length-1;(void 0===this.highestOffsetChanged||this.highestOffsetChanged<a)&&(this.highestOffsetChanged=a)}if(i.length&&r&&(n=void 0===n?i:n.concat(i),this.isOrderedRange)){var d=this.orderedTree.getSize();this.highestOffsetChanged=s>=d?d-1:s;var u=this.highestOffsetChanged-i.length+1;(void 0===this.lowestOffsetChanged||this.lowestOffsetChanged>u)&&(this.lowestOffsetChanged=u)}var h;e.length&&!t&&(h=e),i.length&&!r&&(h=void 0===h?i:h.concat(i)),void 0===h&&void 0===n||(this.orderedRange=void 0),this.isOrderedRange&&(void 0!==this.lowestOffsetChanged&&void 0!==o&&this.lowestOffsetChanged<o&&(this.lowestOffsetChanged=o),void 0!==this.highestOffsetChanged&&void 0!==s&&this.highestOffsetChanged>s&&(this.highestOffsetChanged=s)),this.setAddedAndRemovedRanges(n,h)}function rangeOrderRequirementSetAddedAndremovedRanges(e,t){if(void 0!=e&&0!=e.length||void 0!=t&&0!=t.length){if(void 0!==this.addedRange||void 0!==this.removedRange)this.changeInitialUpdates();else if(0==this.addedMatches.size&&0==this.removedMatches.size)return this.addedRange=e,void(this.removedRange=t);if(void 0!==e)for(var i=0,r=e.length;i<r;++i){var n=e[i];0!==this.removedMatches.size&&this.removedMatches.has(n)?this.removedMatches.delete(n):this.addedMatches.set(n,!0)}if(void 0!==t)for(var i=0,r=t.length;i<r;++i){var n=t[i];0!==this.addedMatches.size&&this.addedMatches.has(n)?this.addedMatches.delete(n):this.removedMatches.set(n,1)}}}function rangeOrderRequirementAddElement(e,t){void 0!==this.orderedRange&&(this.orderedRange=void 0),void 0===this.addedRange&&void 0===this.removedRange||this.changeInitialUpdates(),0!==this.removedMatches.size&&this.removedMatches.has(e)?this.removedMatches.delete(e):(this.addedMatches.set(e,!0),this.isOrderedRange&&((void 0===this.lowestOffsetChanged||t<this.lowestOffsetChanged)&&(this.lowestOffsetChanged=t),this.highestOffsetChanged=1/0))}function rangeOrderRequirementAddElements(e,t,i){void 0!==this.orderedRange&&(this.orderedRange=void 0),void 0===this.addedRange&&void 0===this.removedRange||this.changeInitialUpdates();for(var r=t,n=e.length;r<n;++r){var o=e[r];if(o!==i)if(0!==this.removedMatches.size&&this.removedMatches.has(o)){var s=this.removedMatches.get(o)-1;0===s?this.removedMatches.delete(o):this.removedMatches.set(o,s)}else this.addedMatches.set(o,!0)}}function rangeOrderRequirementRemoveElement(e,t){void 0!==this.orderedRange&&(this.orderedRange=void 0),void 0===this.addedRange&&void 0===this.removedRange||this.changeInitialUpdates(),0!==this.addedMatches.size&&this.addedMatches.has(e)?this.addedMatches.delete(e):(this.removedMatches.set(e,1),this.isOrderedRange&&((void 0===this.lowestOffsetChanged||t<this.lowestOffsetChanged)&&(this.lowestOffsetChanged=t),this.highestOffsetChanged=1/0))}function rangeOrderRequirementRemoveElements(e,t,i){void 0!==this.orderedRange&&(this.orderedRange=void 0),void 0===this.addedRange&&void 0===this.removedRange||this.changeInitialUpdates();for(var r=t,n=e.length;r<n;++r){var o=e[r];if(o!==i)if(0!==this.addedMatches.size&&this.addedMatches.has(o))this.addedMatches.delete(o);else if(this.removedMatches.has(o)){var s=this.removedMatches.get(o)+1;this.removedMatches.set(o,s)}else this.removedMatches.set(o,1)}}function rangeOrderRequirementAddRangeElements(e){this.isOrderedRange&&e.length>0&&(this.lowestOffsetChanged=this.requirement.getLowOffset(),this.highestOffsetChanged=this.lowestOffsetChanged+e.length-1),this.orderedRange=e}function rangeOrderRequirementChangeInitialUpdates(){if(this.addedRange){for(var e=0,t=this.addedRange.length;e<t;++e)this.addedMatches.set(this.addedRange[e],!0);this.addedRange=void 0}if(this.removedRange){for(var e=0,t=this.removedRange.length;e<t;++e)this.removedMatches.set(this.removedRange[e],1);this.removedRange=void 0}}function rangeOrderRequirementGetMatches(){if(void 0===this.requirement)return[];var e=this.requirement.getAllMatches();if(this.addedMatches.size>0){var t=e;e=[];for(var i=0,r=t.length;i<r;++i){var n=t[i];this.addedMatches.has(n)||e.push(n)}}if(this.removedMatches.size>0&&this.removedMatches.forEach(function(t,i){e.push(i)}),void 0!==this.addedRange&&this.addedRange.length>0)for(var t=e,e=[],o=0,s=t.length,a=0,d=this.addedRange.length;s-o>d-a;){var u=t[o];o++,u==this.addedRange[a]?a++:e.push(u)}return void 0!==this.removedRange&&this.removedRange.length>0&&(e=e.concat(this.removedRange)),e}function rangeOrderRequirementGetOrderedMatches(){return void 0!==this.orderedRange?[]:void 0===this.requirement?[]:this.requirement.getAllMatches(!0)}function rangeOrderRequirementFilterMatches(e){if(void 0===this.requirement||0===e.length)return[];var t=this.requirement.getRangeSize();if(0===t)return[];var i,r=[];if(this.addedMatches.size>0)i=this.addedMatches;else if(void 0!==this.addedRange&&this.addedRange.length>0){i=new Map;for(var n=0,o=this.addedRange.length;n<o;++n)i.set(this.addedRange[n])}if(void 0!==i)for(var n=0,o=e.length;n<o;++n){var s=e[n];i.has(s)||r.push(s)}else r=e;var a;if(this.removedMatches.size>0)a=this.removedMatches;else if(void 0!==this.removedRange){a=new Map;for(var n=0,o=this.removedRange.length;n<o;++n)a.set(this.removedRange[n])}var d=[];if(10*r.length<t)for(var u=this.requirement.getForwardRange(),n=0,o=r.length;n<o;++n){var s=r[n];if(void 0!==a&&a.has(s))d.push(s);else{var h=this.orderedTree.findNodeByElement(s);void 0!==h&&h.pos>=u[0]&&h.pos<=u[1]&&d.push(s)}}else{for(var l=this.requirement.getAllMatches(),c=new Map,n=0,o=l.length;n<o;++n)c.set(l[n],!0);for(var n=0,o=r.length;n<o;++n){var s=r[n];void 0!==a&&a.has(s)?d.push(s):c.has(s)&&d.push(s)}}return d}function rangeOrderRequirementUpdateReorderedRange(e,t){(void 0===this.lowestOffsetChanged||e<this.lowestOffsetChanged)&&(this.lowestOffsetChanged=e),(void 0===this.highestOffsetChanged||t>this.highestOffsetChanged)&&(this.highestOffsetChanged=t)}function rangeOrderRequirementNotifyListeners(){var e,t,i=void 0!==this.addedRange||void 0!==this.removedRange;0==this.addedMatches.size&&0==this.removedMatches.size?(e=this.removedRange,this.removedRange=void 0,t=this.addedRange,this.addedRange=void 0):(this.addedMatches.size>0&&(t=[],this.addedMatches.forEach(function(e,i){t.push(i)}),this.addedMatches.clear()),
this.removedMatches.size>0&&(e=[],this.removedMatches.forEach(function(t,i){e.push(i)}),this.removedMatches.clear()));for(var r=0,n=this.listeners.length;r<n;++r){var o=this.listeners[r];e&&e.length>0&&o.removeMatches(e),t&&t.length>0&&o.addMatches(t)}return this.isOrderedRange?void this.notifyListenersOfOrderedRange(i,t,e):void(this.orderedRange=void 0)}function rangeOrderRequirementNotifyListenersOfOrderedRange(e,t,i){var r=(void 0===t?0:t.length)-(void 0===i?0:i.length);if(void 0!==this.lowestOffsetChanged||0!==r){var n=this.orderedTree.getSize(),o=this.requirement.getLowOffset();if(0===n)for(var s=0,a=this.listeners.length;s<a;++s){var d=this.listeners[s];d.updatePos([],0,0,0)}else if(void 0===o||o>=n)for(var s=0,a=this.listeners.length;s<a;++s){var d=this.listeners[s];d.updatePos([],void 0,void 0,n)}else{(void 0===this.lowestOffsetChanged||this.lowestOffsetChanged<o)&&(this.lowestOffsetChanged=o),e||0===r?(void 0===this.highestOffsetChanged||this.highestOffsetChanged>n-1)&&(this.highestOffsetChanged=n-1):this.highestOffsetChanged=Math.min(this.requirement.getHighOffset(),n-1);for(var u=this.isBackward?this.orderedTree.invertOffset(this.highestOffsetChanged):this.lowestOffsetChanged,h=this.isBackward?this.orderedTree.invertOffset(this.lowestOffsetChanged):this.highestOffsetChanged,l=void 0!==this.orderedRange?this.orderedRange:this.orderedTree.getRangeElementsByOffsets(u,h,!1),s=0,a=this.listeners.length;s<a;++s){var d=this.listeners[s];d.updatePos(l,u,h,n)}}this.orderedRange=void 0,this.lowestOffsetChanged=void 0,this.highestOffsetChanged=void 0}}function SegmentOrderRequirement(e,t){this.OrderRequirement(),this.rangeRequirement=e,this.orderedTree=e.orderedTree,this.isBackward=!1,this.isOrderedRange=e.isOrderedRange,this.beginRequirement=void 0,this.endRequirement=void 0,t&&this.initializeAtComplementRange(t)}function segmentOrderRequirementDestroy(){void 0!==this.beginRequirement&&this.orderedTree.removeAbsRequirement(this.beginRequirement)}function segmentOrderRequirementGetLowOffset(){return this.beginRequirement.offset}function segmentOrderRequirementGetHighOffset(){return this.endRequirement.offset}function segmentOrderRequirementGetForwardRange(){return this.beginRequirement.getForwardRange()}function segmentOrderRequirementGetRangeSize(){if(void 0===this.beginRequirement||void 0===this.endRequirement)return 0;var e=this.orderedTree.getSize();return this.beginRequirement.offset>=e?0:this.endRequirement.offset>=e?e-this.beginRequirement.offset:this.endRequirement.offset-this.beginRequirement.offset+1}function segmentOrderRequirementInitializeAtComplementRange(e){this.isBackward=!1;var t=e.getForwardRange();this.registerNewRequirements(t,!0)}function segmentOrderRequirementUpdateOffsets(e,t,i,r){var n=this.rangeRequirement.isOrderedRange;if(e[0]>e[1]&&e.reverse(),i&&e[0]++,r&&e[1]--,e[0]>e[1]&&(e=void 0),void 0===this.beginRequirement)return this.isBackward=!!t,this.isOrderedRange=!!n,void this.registerNewRequirements(e);var o=[this.beginRequirement.offset,this.endRequirement.offset];if(this.isBackward!==!!t&&(o=[Math.max(this.orderedTree.invertOffset(o[1]),0),Math.max(this.orderedTree.invertOffset(o[0]),0)]),void 0===e||e[1]<o[0]||e[0]>o[1]||this.isOrderedRange!==!!n||this.isBackward!==!!t)return void this.replaceRequirements(e,t,n,o);var s=this.orderedTree.moveAbsRequirement(this.beginRequirement,e[0]),a=this.orderedTree.moveAbsRequirement(this.endRequirement,e[1]);this.rangeRequirement.setOffsetUpdateDiff(s,e[0]<o[0],a,e[1]>o[1])}function segmentOrderRequirementReplaceRequirements(e,t,i,r){this.orderedTree.removeAbsRequirement(this.beginRequirement),this.isBackward=!!t,this.isOrderedRange=!!i,this.registerNewRequirements(e),this.rangeRequirement.diffAfterReplacement(e,r)}function segmentOrderRequirementRegisterNewRequirements(e,t){return void 0===e?(this.beginRequirement=void 0,void(this.endRequirement=void 0)):(this.beginRequirement=new BeginAbsOrderRequirement(e[0],this),this.endRequirement=new EndAbsOrderRequirement(e[1],this,t),void this.orderedTree.addAbsRequirement(this.beginRequirement))}function segmentOrderRequirementAddElement(e,t){this.rangeRequirement.addElement(e,t)}function segmentOrderRequirementAddElements(e,t,i){this.rangeRequirement.addElements(e,t,i)}function segmentOrderRequirementRemoveElement(e,t){this.rangeRequirement.removeElement(e,t)}function segmentOrderRequirementRemoveElements(e,t,i){this.rangeRequirement.removeElements(e,t,i)}function segmentOrderRequirementAddRangeElements(e){this.rangeRequirement.addRangeElements(e)}function segmentOrderRequirementClearAllElements(){var e=this.orderedTree.getRangeElementsByOffsets(this.beginRequirement.offset,this.endRequirement.offset,this.isBackward);this.rangeRequirement.setAddedAndRemovedRanges(void 0,e)}function segmentOrderRequirementGetAllMatches(e){var t=this.orderedTree.getSize();if(void 0===this.beginRequirement||this.beginRequirement.offset>=t)return[];if(e&&this.isBackward){var i=this.endRequirement.offset>=t?0:this.orderedTree.invertOffset(this.endRequirement.offset),r=this.orderedTree.invertOffset(this.beginRequirement.offset);return this.orderedTree.getRangeElementsByOffsets(i,r,!1)}return this.orderedTree.getRangeElementsByOffsets(this.beginRequirement.offset,this.endRequirement.offset,this.isBackward)}function segmentOrderRequirementUpdateReorderedRange(e,t){this.isBackward&&(tmp=this.orderedTree.invertOffset(e),e=this.orderedTree.invertOffset(t),t=tmp),e>this.endRequirement.offset||t<this.beginRequirement.offset||(e<this.beginRequirement.offset&&(e=this.beginRequirement.offset),t>this.endRequirement.offset&&(t=this.endRequirement.offset),this.rangeRequirement.updateReorderedRange(e,t))}function segmentOrderRequirementNotifyListeners(){this.rangeRequirement.notifyListeners()}function ComplementOrderRequirement(e,t){this.OrderRequirement(),this.rangeRequirement=e,this.orderedTree=e.orderedTree,this.isOrderedRange=e.isOrderedRange,this.lowOpen=!1,this.highOpen=!1,this.isCrossing=!1,this.lowOffset=void 0,this.highOffset=void 0,this.forwardRequirement=void 0,this.backwardRequirement=void 0,t&&this.initializeAtSegmentRange(t)}function complementOrderRequirementDestroy(){this.forwardRequirement&&this.orderedTree.removeAbsRequirement(this.forwardRequirement),this.backwardRequirement&&this.orderedTree.removeAbsRequirement(this.backwardRequirement),this.orderedTree.removeComplementRequirement(this)}function complementOrderRequirementSetForwardRange(){var e=this.forwardRequirement.offset,t=this.orderedTree.invertOffset(this.backwardRequirement.offset);e<=t?(this.lowOffset=e,this.highOffset=t,this.isCrossing=!1):(this.lowOffset=t,this.highOffset=e,this.isCrossing=!0);var i=this.orderedTree.getSize();this.lowOffset<0?this.lowOffset=0:this.lowOpen&&this.lowOffset++,this.highOffset>=i?this.highOffset=i-1:this.highOpen&&this.highOffset--}function complementOrderRequirementGetForwardRange(){if(!(this.lowOffset>this.highOffset))return[this.lowOffset,this.highOffset]}function complementOrderRequirementGetLowOffset(){if(!(this.lowOffset>this.highOffset))return this.lowOffset}function complementOrderRequirementGetHighOffset(){if(!(this.lowOffset>this.highOffset))return this.highOffset}function complementOrderRequirementIsEmpty(){return 0==this.orderedTree.getSize()||this.lowOffset>this.highOffset}function complementOrderRequirementGetRangeSize(){return this.isEmpty()?0:void 0===this.lowOffset||void 0===this.highOffset?0:this.highOffset-this.lowOffset+1}function complementOrderRequirementInitializeAtSegmentRange(e){var t=e.getLowOffset(),i=e.getHighOffset(),r=e.isBackward,n=this.orderedTree.getSize();if(!(t>=n)){var o=i>=n?0:this.orderedTree.invertOffset(i),s=r?[o,t]:[t,o];this.registerNewRequirements(s,!1,!1,this.isOrderedRange,!0)}}function complementOrderRequirementUpdateOffsets(e,t,i){var r=this.rangeRequirement.isOrderedRange;if(void 0===this.forwardRequirement)return void this.registerNewRequirements(e,t,i,r);if(this.isOrderedRange!==r||this.isCrossing||e[0]>this.orderedTree.invertOffset(e[1]))return void this.replaceRequirements(e,t,i,r,!1);var n=this.orderedTree.invertOffset(e[1]),o=this.orderedTree.invertOffset(this.backwardRequirement.offset);if(n<this.forwardRequirement.offset||o<e[0]||n==this.forwardRequirement.offset&&(i||this.lowOpen)||o==e[0]&&(t||this.highOpen))return void this.replaceRequirements(e,t,i,r,!0);var s=this.lowOpen,a=this.highOpen;this.lowOpen=t,this.highOpen=i;var d=this.moveOffset(e[0],s,t,!1),u=this.moveOffset(e[1],a,i,!0);this.setForwardRange(),this.rangeRequirement.setOffsetUpdateDiff(d.diff,d.diffInNew,u.diff,u.diffInNew)}function complementOrderRequirementRegisterNewRequirements(e,t,i,r,n){this.lowOpen=t,this.highOpen=i,this.isOrderedRange=r,this.forwardRequirement=new ComplementEndOrderRequirement(this,e[0],!1),this.backwardRequirement=new ComplementEndOrderRequirement(this,e[1],!0),this.setForwardRange(),this.orderedTree.addAbsRequirement(this.forwardRequirement),this.orderedTree.addAbsRequirement(this.backwardRequirement),this.orderedTree.addComplementRequirement(this,n)}function complementOrderRequirementReplaceRequirements(e,t,i,r,n){var o=this.getForwardRange();this.orderedTree.removeComplementRequirement(this),this.orderedTree.removeAbsRequirement(this.forwardRequirement),this.orderedTree.removeAbsRequirement(this.backwardRequirement),this.registerNewRequirements(e,t,i,r,!n);var s=this.getForwardRange();this.rangeRequirement.diffAfterReplacement(s,o)}function complementOrderRequirementMoveOffset(e,t,i,r){var n=r?this.backwardRequirement:this.forwardRequirement,o=n.offset;if(e===o)return!!i==!!t?{diff:[],diffInNew:!0}:{diff:[n.element],diffInNew:!i};var s=this.orderedTree.moveAbsRequirement(n,e);return e<o?(forwardDiffInNew=!0,t||s.length--,r?(s.reverse(),i&&s.length--):i&&s.shift(),{diff:s,diffInNew:!0}):(i||s.length--,r?(s.reverse(),t&&s.length--):t&&s.shift(),{diff:s,diffInNew:!1})}function complementOrderRequirementUpdateAddElement(e,t){if(this.isCrossing){var i=this.orderedTree.invertOffset(this.backwardRequirement.offset);i>=this.forwardRequirement.offset?this.setForwardRange():i<=0?(this.lowOffset=0,0==i&&this.lowOpen&&(this.lowOffset=1)):this.lowOffset++}else this.highOffset++;this.lowOffset<=t&&t<=this.highOffset&&this.rangeRequirement.addElement(e,t)}function complementOrderRequirementUpdateRemoveElement(e,t){if(this.lowOffset<=t&&t<=this.highOffset&&this.rangeRequirement.removeElement(e,t),this.isCrossing){var i=this.orderedTree.invertOffset(this.backwardRequirement.offset);i<0?this.lowOffset=0:this.lowOpen?this.lowOffset=i+1:this.lowOffset=i}else this.highOffset--,this.highOffset<=this.lowOffset&&this.setForwardRange()}function complementOrderRequirementAddElement(e,t){this.rangeRequirement.addElement(e,t)}function complementOrderRequirementAddElements(e,t,i){this.rangeRequirement.addElements(e,t,i)}function complementOrderRequirementRemoveElement(e,t){this.rangeRequirement.removeElement(e,t)}function complementOrderRequirementRemoveElements(e,t,i){this.rangeRequirement.removeElements(e,t,i)}function complementOrderRequirementAddRangeElements(e){this.rangeRequirement.addRangeElements(e)}function complementOrderRequirementClearAllElements(){var e=this.getAllMatches();this.rangeRequirement.setAddedAndRemovedRanges(void 0,e)}function complementOrderRequirementGetAllMatches(){var e=this.getForwardRange();return void 0===e?[]:this.orderedTree.getRangeElementsByOffsets(e[0],e[1],!1)}function complementOrderRequirementUpdateReorderedRange(e,t){this.rangeRequirement.updateReorderedRange(e,t)}function complementOrderRequirementNotifyListeners(){this.rangeRequirement.notifyListeners()}function ComplementEndOrderRequirement(e,t,i){this.AtomicAbsOrderRequirement(t,i),this.complementRequirement=e}function complementEndOrderRequirementUpdateElement(e,t,i,r){var n=this.element;this.element=e,void 0!==t&&(r?this.updateElementAdded(n,e,t,i):this.updateElementRemoved(n,e,t,i))}function complementEndOrderRequirementUpdateElementAdded(e,t,i,r){var n=this.complementRequirement.isCrossing;if(n){var o=this.isBackward?this.complementRequirement.getLowOffset():this.complementRequirement.getHighOffset();if(void 0===o)return;var s=this.isBackward?this.lowOpen:this.highOpen;s?t!==i&&this.complementRequirement.removeElement(t,o+(this.isBackward?1:-1)):this.complementRequirement.removeElement(e,o)}else{var s=this.isBackward?this.highOpen:this.lowOpen,a=this.isBackward?this.complementRequirement.highOffset+(s?-1:0):this.complementRequirement.lowOffset+(s?1:0);s?this.complementRequirement.addElement(e,a):t!==i&&this.complementRequirement.addElement(t,a)}}function complementEndOrderRequirementUpdateElementRemoved(e,t,i,r){var n=this.complementRequirement.isCrossing;if(n){var o=this.isBackward?this.complementRequirement.getLowOffset():this.complementRequirement.getHighOffset();if(void 0===o)return;var s=this.isBackward?this.lowOpen:this.highOpen;s?e!==i&&this.complementRequirement.addElement(e,o+(this.isBackward?1:-1)):this.complementRequirement.addElement(t,o)}else{var s=this.isBackward?this.highOpen:this.lowOpen,a=this.isBackward?this.complementRequirement.highOffset+(s?-1:0):this.complementRequirement.lowOffset+(s?1:0);s?this.complementRequirement.removeElement(t,a):e!==i&&this.complementRequirement.removeElement(e,a)}}function complementEndOrderRequirementReplacedElement(e,t,i,r,n){if(!this.complementRequirement.isEmpty()){var o=this.complementRequirement.isCrossing;if(!!this.isBackward==!!o){var s=!this.complementRequirement.lowOpen||this.isBackward&&this.offset>=this.orderedTree.getSize();this.offset==this.complementRequirement.getLowOffset(),this.complementRequirement.addElements(t,i,s?this.element:e),this.complementRequirement.removeElements(r,n,s?e:this.element)}else{var s=!this.complementRequirement.highOpen||!this.isBackward&&this.offset>=this.orderedTree.getSize();this.complementRequirement.addElements(r,n,s?this.element:e),this.complementRequirement.removeElements(t,i,s?e:this.element)}this.element=e}}function complementEndOrderRequirementClearAllElements(){this.element=void 0}function complementEndOrderRequirementNotifyListeners(){}function ElementRequirement(e,t,i,r,n){this.OrderRequirement(),this.orderedTree=n,this.anchor=e,this.isBackward=!!t,this.isEnd=!!i,this.isOrderedRange=!!r,this.elementOffset=void 0,this.notifiedOffset=void 0,i?this.elementRangeRequirement=new ElementRangeRequirement(this):this.elementRangeRequirement=void 0,void 0!==this.orderedTree&&this.orderedTree.addAnchoredRequirement(this)}function elementRequirementDestroy(){void 0!==this.orderedTree&&this.orderedTree.removeAnchoredRequirement(this)}function elementRequirementClearAllElements(){this.suspend()}function elementRequirementSuspend(){this.elementOffset=void 0,void 0!==this.elementRangeRequirement&&this.elementRangeRequirement.suspend()}function elementRequirementSetOffset(e){this.elementOffset=e}function elementRequirementAddRangeElements(e){void 0!==this.elementRangeRequirement&&this.elementRangeRequirement.addRangeElements(e)}function elementRequirementUpdateAddElement(e){this.elementOffset++,void 0!==this.elementRangeRequirement&&this.elementRangeRequirement.updateAddElement(e)}function elementRequirementUpdateRemoveElement(e){this.elementOffset--,void 0!==this.elementRangeRequirement&&this.elementRangeRequirement.updateRemoveElement(e)}function elementRequirementUpdateReorderedRange(e,t){}function elementRequirementNotifyListeners(){if(this.elementOffset!==this.notifiedOffset)for(var e=0,t=this.listeners.length;e<t;++e)this.listeners[e].updateOffset(this.anchor,this.elementOffset);this.notifiedOffset=this.elementOffset,void 0!==this.elementRangeRequirement&&this.elementRangeRequirement.notifyListeners()}function elementRequirementNotifyMatches(e,t,i){for(var r=0,n=this.listeners.length;r<n;++r){var o=this.listeners[r];t&&t.length>0&&o.removeMatches(t),e&&e.length>0&&o.addMatches(e)}this.isOrderedRange&&this.notifyRangeOrder(i)}function elementRequirementNotifyRangeOrder(e){var t=this.orderedTree.getSize(),i=void 0,r=void 0;this.notifiedOffset?(i=this.isBackward?t-this.notifiedOffset-1:0,r=this.isBackward?t-1:this.notifiedOffset,void 0===e&&(e=this.orderedTree.getRangeElementsByOffsets(i,r,!1))):e=[];for(var n=0,o=this.listeners.length;n<o;++n){var s=this.listeners[n];s.updatePos(e,i,r,t)}}function elementRequirementGetForwardRange(){if(this.elementOffset){if(this.isBackward){if(void 0===this.orderedTree)return;var e=this.orderedTree.getSize();return[e-this.elementOffset,e]}return[0,this.elementOffset-1]}}function elementRequirementGetOffset(){return this.notifiedOffset}function ElementRangeRequirement(e){this.requirement=e,this.notifiedMatches=new Map,this.addedMatches=new Map,this.removedMatches=new Map,this.isSuspended=!0,this.orderedRange=void 0}function elementRangeRequirementSuspend(){this.isSuspended=!0,this.addedMatches.clear(),this.removedMatches.clear(),this.orderedRange=void 0}function elementRangeRequirementAddRangeElements(e){this.orderedRange=e,this.isSuspended=!1,this.addedMatches.clear(),this.removedMatches.clear()}function elementRangeRequirementUpdateAddElement(e){this.isSuspended||(void 0!==this.orderedRange&&this.setAddedAndRemovedMatches(),this.removedMatches.size>0&&this.removedMatches.has(e)?this.removedMatches.delete(e):this.addedMatches.set(e,!0))}function elementRangeRequirementUpdateRemoveElement(e){this.isSuspended||(void 0!==this.orderedRange&&this.setAddedAndRemovedMatches(),this.addedMatches.size>0&&this.addedMatches.has(e)?this.addedMatches.delete(e):this.removedMatches.set(e,!0))}function elementRangeRequirementSetAddedAndRemovedMatches(){if(void 0!==this.orderedRange){if(0===this.notifiedMatches.size){for(var e=0,t=this.orderedRange.length;e<t;++e)this.addedMatches.set(this.orderedRange[e],!0);return void(this.orderedRange=void 0)}for(var i=new Map,e=0,t=this.orderedRange.length;e<t;++e){var r=this.orderedRange[e];this.notifiedMatches.has(r)?i.set(r,!0):this.addedMatches.set(r,!0)}var n=this;this.notifiedMatches.forEach(function(e,t){i.has(t)||n.removedMatches.set(t,!0)}),this.orderedRange=void 0}}function elementRangeRequirementNotifyListeners(){if(this.isSuspended){if(0===this.notifiedMatches.size)return;var e=[];return this.notifiedMatches.forEach(function(t,i){e.push(i)}),this.requirement.notifyMatches(void 0,e,void 0),void this.notifiedMatches.clear()}if(void 0!==this.orderedRange){if(0===this.notifiedMatches.size){this.requirement.notifyMatches(this.orderedRange,void 0,this.orderedRange);for(var t=0,i=this.orderedRange.length;t<i;++t)this.notifiedMatches.set(this.orderedRange[t],!0);return void(this.orderedRange=void 0)}for(var r=new Map,n=[],e=[],t=0,i=this.orderedRange.length;t<i;++t){var o=this.orderedRange[t];this.notifiedMatches.has(o)?r.set(o,!0):n.push(o)}var s=this;this.notifiedMatches.forEach(function(t,i){r.has(i)||(e.push(i),s.notifiedMatches.delete(i))}),this.requirement.notifyMatches(n,e,this.orderedRange);for(var t=0,i=n.length;t<i;++t)this.notifiedMatches.set(n[t],!0);return void(this.orderedRange=void 0)}var n=[],e=[],s=this;this.addedMatches.forEach(function(e,t){n.push(t),s.notifiedMatches.set(t,!0)}),this.removedMatches.forEach(function(t,i){e.push(i),s.notifiedMatches.delete(i)}),this.requirement.notifyMatches(n,e,void 0),this.addedMatches.clear(),this.removedMatches.clear()}function PartialOrderTree(e,t){this.RedBlackTree(t),void 0!==t&&this.updateCompareFunc(t),this.uniqueValueAttr=e,this.noHeapNodes=0,this.virtualFirst=void 0,this.virtualLast=void 0,this.queuedForward=[],this.queuedBackward=[],this.nodeBeingRemoved=void 0,this.allRequirements=new RequirementList,this.complementRequirements=new RequirementList,this.orderedRangeRequirements=new RequirementList,this.suspendedRequirements=new Map}function partialOrderTreeGetSize(){return void 0===this.root?0:this.root.getSubTreeSize()}function partialOrderTreeInvertOffset(e){return this.getSize()-e-1}function partialOrderTreeInsertElement(e){var t,i,r,n=0;void 0!==this.virtualFirst&&this.queuedBackward.push(void 0),void 0!==this.virtualLast&&this.queuedForward.push(void 0);for(var i=this.root;i;){if(void 0!==t&&t.subTreeSize++,void 0!==i.heap){if(r=this.compare(e,i.heap.getMin()),r>0){if(i.heap.getSize()>1&&(r=this.compare(e,i.heap.getMax()))<0)return void 0!==i.left&&(n+=i.left.getSubTreeSize()),void this.addInsideHeapNode(i,e,n);if(void 0===i.right)return void 0!==i.left&&(n+=i.left.getSubTreeSize()),void this.suffixToHeapNode(i,e,n)}else if(void 0===i.left)return void this.prefixToHeapNode(i,e,n)}else r=this.compare(e,i.element);t=i,r<0?(i.posTraceForward>0&&this.notifyAbsForward(i,i.posTraceForward,!0,!0,e),void 0!==i.absForward&&this.queuedForward.push(i),void 0!==i.elementForward&&i.elementForward.updateAddElement(e),i=i.left):(void 0!==i.left&&(n+=i.left.getSubTreeSize()),n+=i.getSize(),i.posTraceBackward>0&&this.notifyAbsBackward(i,i.posTraceBackward,!0,!0,e),void 0!==i.absBackward&&this.queuedBackward.push(i),void 0!==i.elementBackward&&i.elementBackward.updateAddElement(e),i=i.right)}r<0?this.addBeforeNode(t,e,n):this.addAfterNode(t,e,n)}function partialOrderTreeAddInsideHeapNode(e,t,i){if(e.posTraceForward>0&&this.notifyAbsForward(e,e.posTraceForward,!0,!0,t),e.posTraceBackward>0&&this.notifyAbsBackward(e,e.posTraceBackward,!0,!0,t),this.isSuspendedRequirementAnchor(t)){var r=[];e=this.splitHeapNodeAroundElement(e,t,r),i+=r[0],this.unsuspendRequirements(t,e,i)}else e.heap.add(t),void 0!==e.subTreeSize&&e.subTreeSize++;this.transferRequirementsAfterInsertion(t,e,i)}function partialOrderTreePrefixToHeapNode(e,t,i){e.posTraceForward>0&&this.notifyAbsForward(e,e.posTraceForward,!0,!0,t),e.posTraceBackward>0&&this.notifyAbsBackward(e,e.posTraceBackward,!0,!0,t);var r=e.prev,n=void 0!==r&&(void 0!==r.absBackward||void 0!==r.relBackward)||void 0===r&&void 0!==this.virtualFirst&&(1==this.virtualFirst.absoluteGap||1==this.virtualFirst.relativeGap),o=this.isSuspendedRequirementAnchor(t);n||o?(e=this.insertNewLeftChild(e,t,!1),o&&this.unsuspendRequirements(t,e,i)):(e.heap.add(t),void 0!==e.subTreeSize&&e.subTreeSize++),this.transferRequirementsAfterInsertion(t,e,i)}function partialOrderTreeSuffixToHeapNode(e,t,i){e.posTraceForward>0&&this.notifyAbsForward(e,e.posTraceForward,!0,!0,t),e.posTraceBackward>0&&this.notifyAbsBackward(e,e.posTraceBackward,!0,!0,t),i+=e.heap.getSize();var r=e.next,n=void 0!==r&&(void 0!==r.absForward||void 0!==r.relForward)||void 0===r&&void 0!==this.virtualLast&&(1==this.virtualLast.absoluteGap||1==this.virtualLast.relativeGap),o=this.isSuspendedRequirementAnchor(t);n||o?(e=this.insertNewRightChild(e,t,!1),o&&this.unsuspendRequirements(t,e,i)):(e.heap.add(t),void 0!==e.subTreeSize&&e.subTreeSize++),this.transferRequirementsAfterInsertion(t,e,i)}function partialOrderTreeAddBeforeNode(e,t,i){var r,n=this.isSuspendedRequirementAnchor(t);r=n||e.noHeapPrev>0||void 0!==e.prev&&e.prev.noHeapNext>0||void 0!==e.absForward||void 0!==e.relForward?this.insertNewLeftChild(e,t,!1):this.insertNewLeftChild(e,t,!0),n&&this.unsuspendRequirements(t,r,i),this.transferRequirementsAfterInsertion(t,r,i)}function partialOrderTreeAddAfterNode(e,t,i){var r,n=this.isSuspendedRequirementAnchor(t);r=n||void 0!==e&&(e.noHeapNext>0||void 0!==e.next&&e.next.noHeapPrev>0||void 0!==e.absBackward||void 0!==e.relBackward)?this.insertNewRightChild(e,t,!1):this.insertNewRightChild(e,t,!0),n&&this.unsuspendRequirements(t,r,i),this.transferRequirementsAfterInsertion(t,r,i)}function partialOrderTreeFindNodeByOffset(e,t,i){return t?this.findNodeByBackwardOffset(e,i):this.findNodeByForwardOffset(e,i)}function partialOrderTreeFindNodeByForwardOffset(e,t){if(!(this.getSize()<=e)){for(var i,r=this.root;r&&(i=void 0!==r.left?r.left.getSubTreeSize():0,e!=i);)if(i>e)r=r.left;else{var n=i;if(void 0!==r.heap&&(n+=r.heap.getSize()-1,e<=n))break;r=r.right,e-=n+1}return void 0!==r.heap&&t&&(r=this.splitHeapNodeAtPos(r,e-i,!1)),r}}function partialOrderTreeFindNodeByBackwardOffset(e,t){if(!(this.getSize()<=e)){for(var i,r=this.root;r&&(i=void 0!==r.right?r.right.getSubTreeSize():0,i!=e);)if(i>e)r=r.right;else{var n=i;if(void 0!==r.heap&&(n+=r.heap.getSize()-1,e<=n))break;r=r.left,e-=n+1}return void 0!==r.heap&&t&&(r=this.splitHeapNodeAtPos(r,e-i,!0)),r}}function partialOrderTreeFindNodeByElement(e,t){for(var i,r=0,n=this.root;n;){if(void 0!==n.heap){if(i=this.compare(e,n.heap.getMin()),0==i)return void 0!==n.left&&(r+=n.left.getSubTreeSize()),{node:t?this.convertMinElementToNode(n):n,pos:r};if(i>0&&n.heap.getSize()>1&&(i=this.compare(e,n.heap.getMax()))<=0){if(void 0!==n.left&&(r+=n.left.getSubTreeSize()),0==i)return t&&(r+=n.getSize()-1,n=this.convertMaxElementToNode(n)),{node:n,pos:r};if(!n.heap.inHeap(void 0===this.uniqueValueAttr?e:e[this.uniqueValueAttr]))return;return t&&(n=this.splitHeapNodeAtElement(n,e),r+=n.prev.getSize()),{node:n,pos:r}}}else if(i=this.compare(e,n.element),0===i)return void 0!==n.left&&(r+=n.left.getSubTreeSize()),{node:n,pos:r};i<0?n=n.left:(r+=void 0!==n.left?n.left.getSubTreeSize()+n.getSize():n.getSize(),n=n.right)}}function partialOrderTreeGetRangeElements(e,t,i){for(var r=[];void 0!==e&&t>0;){if(void 0===e.heap)r.push(e.element),t--;else{t-=e.getSize();for(var n=e.heap.heap,o=1,s=n.length;o<s;++o)r.push(n[o])}e=i?e.prev:e.next}return r}function partialOrderTreeGetRangeElementsByOffsets(e,t,i){var r=this.findNodeByOffset(e,i,!0);return void 0===r?[]:this.getRangeElements(r,t-e+1,i)}function partialOrderTreeInsertNewRootNode(e,t){this.noHeapNodes>0&&(t=!1);var i=this.root=new PartialOrderNode(void 0,void 0,void 0,e,this.uniqueValueAttr,t?this.heapCompare:void 0);return this.first=i,this.last=i,this.fixAfterInsertion(i),i}function partialOrderTreeInsertNewLeftChild(e,t,i){if(void 0===e)return this.insertNewRootNode(t,i);this.noHeapNodes>0&&(i=!1),void 0===e.subTreeSize?e.subTreeSize=1+e.getSize():e.subTreeSize++;var r;if(void 0===e.left)r=e.left=new PartialOrderNode(e,e.prev,e,t,this.uniqueValueAttr,i?this.heapCompare:void 0);else{r=e.prev.right=new PartialOrderNode(e.prev,e.prev,e,t,this.uniqueValueAttr,i?this.heapCompare:void 0),void 0===e.prev.subTreeSize&&(e.prev.subTreeSize=e.prev.getSize());for(var n=e.prev;n!=e;n=n.parent)n.subTreeSize++}return e.prev?e.prev.next=r:this.first=r,e.prev=r,r.prev&&(r.nextTrace=r.prev.nextTrace),r.next&&(r.prevTrace=r.next.prevTrace),void 0!==r.prev&&(r.noHeapNext=r.prev.noHeapNext),void 0!==r.next&&(r.noHeapPrev=r.next.noHeapPrev),this.fixAfterInsertion(r),r}function partialOrderTreeInsertNewRightChild(e,t,i){if(void 0===e)return this.insertNewRootNode(t,i);this.noHeapNodes>0&&(i=!1),void 0===e.subTreeSize?e.subTreeSize=1+e.getSize():e.subTreeSize++;var r;if(void 0===e.right)r=e.right=new PartialOrderNode(e,e,e.next,t,this.uniqueValueAttr,i?this.heapCompare:void 0);else{r=e.next.left=new PartialOrderNode(e.next,e,e.next,t,this.uniqueValueAttr,i?this.heapCompare:void 0),void 0===e.next.subTreeSize&&(e.next.subTreeSize=e.next.getSize());for(var n=e.next;n!=e;n=n.parent)n.subTreeSize++}return e.next?e.next.prev=r:this.last=r,e.next=r,r.prev&&(r.nextTrace=r.prev.nextTrace),r.next&&(r.prevTrace=r.next.prevTrace),void 0!==r.prev&&(r.noHeapNext=r.prev.noHeapNext),void 0!==r.next&&(r.noHeapPrev=r.next.noHeapPrev),this.fixAfterInsertion(r),r}function partialOrderTreeRotateRight(e){var t=e.left;e.left=t.right,void 0!==t.right&&(t.right.parent=e),t.parent=e.parent,void 0===e.parent?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,t.right=e,e.parent=t,t.posTraceForward+=e.posTraceForward,void 0!==e.absForward&&(t.posTraceForward+=e.absForward.length),e.elementForward&&t.posTraceForward++,e.posTraceBackward-=t.posTraceBackward,void 0!==t.absBackward&&(e.posTraceBackward-=t.absBackward.length),t.elementBackward&&e.posTraceBackward--,void 0===t.subTreeSize&&(t.subTreeSize=t.getSize()),t.subTreeSize+=e.getSize()+(void 0===e.right?0:e.right.getSubTreeSize()),void 0===e.left&&void 0===e.right?e.subTreeSize=void 0:e.subTreeSize-=t.getSize()+(void 0===t.left?0:t.left.getSubTreeSize())}function partialOrderTreeRotateLeft(e){var t=e.right;e.right=t.left,void 0!==t.left&&(t.left.parent=e),t.parent=e.parent,void 0===e.parent?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t,t.posTraceBackward+=e.posTraceBackward,void 0!==e.absBackward&&(t.posTraceBackward+=e.absBackward.length),void 0!==t.elementBackward&&t.posTraceBackward++,e.posTraceForward-=t.posTraceForward,void 0!==t.absForward&&(e.posTraceForward-=t.absForward.length),t.elementForward&&e.posTraceForward--,void 0===t.subTreeSize&&(t.subTreeSize=t.getSize()),t.subTreeSize+=e.getSize()+(void 0===e.left?0:e.left.getSubTreeSize()),void 0===e.left&&void 0===e.right?e.subTreeSize=void 0:e.subTreeSize-=t.getSize()+(void 0===t.right?0:t.right.getSubTreeSize())}function partialOrderTreeGetVirtualNode(e){return e?(void 0===this.virtualFirst&&(this.virtualFirst=new VirtualPartialOrderNode(this)),this.virtualFirst):(void 0===this.virtualLast&&(this.virtualLast=new VirtualPartialOrderNode(this)),this.virtualLast)}function partialOrderTreeSplitHeapNodeAtElement(e,t,i,r,n){if(1==e.heap.getSize())return e.convertHeapToElement(),void 0!==n&&(n[0]=0),e;var o,s=void 0===this.uniqueValueAttr?t:t[this.uniqueValueAttr];if(r){var a=[];if(void 0===this.uniqueValueAttr)for(;e.heap.getMax()!=s;)a.push(e.heap.popMax());else for(;e.heap.getMax()[this.uniqueValueAttr]!=s;)a.push(e.heap.popMax());void 0!==n&&(n[0]=e.heap.getSize()-1);var d=new MinMaxPosHeap(this.heapCompare,this.uniqueValueAttr);d.initWithSortedArray(a,!1),this.insertSplitHeapNodeJustAfter(e,void 0,d),o=this.convertMaxElementToNode(e)}else{var u=[];if(void 0===this.uniqueValueAttr)for(;e.heap.getMin()!=s;)u.push(e.heap.popMin());else for(;e.heap.getMin()[this.uniqueValueAttr]!=s;)u.push(e.heap.popMin());void 0!==n&&(n[0]=u.length);var d=new MinMaxPosHeap(this.heapCompare,this.uniqueValueAttr);d.initWithSortedArray(u,!0),this.insertSplitHeapNodeJustBefore(e,void 0,d),o=this.convertMinElementToNode(e)}return i&&this.splitHeapNodeAtPos(e,i-1,r),o}function partialOrderTreeSplitHeapNodeAroundElement(e,t,i){return this.compare(t,e.heap.getMax())>0?(void 0!==i&&(i[0]=e.getSize()),this.insertNewRightChild(e,t,!1)):this.compare(t,e.heap.getMin())<0?(void 0!==i&&(i[0]=0),this.insertNewLeftChild(e,t,!1)):(e.heap.add(t),void 0!==e.subTreeSize&&e.subTreeSize++,this.splitHeapNodeAtElement(e,t,void 0,void 0,i))}function partialOrderTreeSplitHeapNodeAtPos(e,t,i){if(1==e.heap.getSize())return e.convertHeapToElement(),e;void 0===e.subTreeSize&&(e.subTreeSize=e.heap.getSize()),t>e.getSize()/2&&(t=e.getSize()-t-1,i=!i);var r;if(i){if(t>0){for(var n=[],o=0;o<t;++o)n.push(e.heap.popMax());r=new MinMaxPosHeap(this.heapCompare,this.uniqueValueAttr),r.initWithSortedArray(n,!1),this.insertSplitHeapNodeJustAfter(e,void 0,r)}e.element=e.heap.popMax(),r=e.heap,e.heap=void 0,0!=r.getSize()&&this.insertSplitHeapNodeJustBefore(e,void 0,r)}else{if(t>0){for(var s=[],o=0;o<t;++o)s.push(e.heap.popMin());r=new MinMaxPosHeap(this.heapCompare,this.uniqueValueAttr),r.initWithSortedArray(s,!0),this.insertSplitHeapNodeJustBefore(e,void 0,r)}e.element=e.heap.popMin(),r=e.heap,e.heap=void 0,0!=r.getSize()&&this.insertSplitHeapNodeJustAfter(e,void 0,r)}return e}function partialOrderTreeInsertSplitHeapNodeJustBefore(e,t,i){var r,n=void 0===i?1:i.getSize();if(void 0===e.left)e.left=r=new PartialOrderNode(e,e.prev,e,void 0,this.uniqueValueAttr,void 0),void 0===e.subTreeSize&&(e.subTreeSize=e.getSize()+n);else{e.prev.right=r=new PartialOrderNode(e.prev,e.prev,e,void 0,this.uniqueValueAttr,void 0),void 0===e.prev.subTreeSize&&(e.prev.subTreeSize=e.prev.getSize());for(var o=e.prev;o!=e;o=o.parent)o.subTreeSize+=n}return e.prev?e.prev.next=r:this.first=r,e.prev=r,r.nextTrace=e.nextTrace,r.prevTrace=e.prevTrace,r.noHeapPrev=e.noHeapPrev,void 0!==r.prev&&(r.noHeapNext=r.prev.noHeapNext),i?r.heap=i:r.element=t,this.fixAfterInsertion(r),r}function partialOrderTreeInsertSplitHeapNodeJustAfter(e,t,i){var r,n=void 0===i?1:i.getSize();if(void 0===e.right)e.right=r=new PartialOrderNode(e,e,e.next,void 0,this.uniqueValueAttr,void 0),
void 0===e.subTreeSize&&(e.subTreeSize=e.getSize()+n);else{e.next.left=r=new PartialOrderNode(e.next,e,e.next,void 0,this.uniqueValueAttr,void 0),void 0===e.next.subTreeSize&&(e.next.subTreeSize=e.next.getSize());for(var o=e.next;o!=e;o=o.parent)o.subTreeSize+=n}return e.next?e.next.prev=r:this.last=r,e.next=r,r.nextTrace=e.nextTrace,r.prevTrace=e.prevTrace,r.noHeapNext=e.noHeapNext,void 0!==r.next&&(r.noHeapPrev=r.next.noHeapPrev),i?r.heap=i:r.element=t,this.fixAfterInsertion(r),r}function partialOrderTreeConvertMinElementToNode(e){if(e.convertHeapToElement())return e;var t=e.heap.popMin(),i=this.insertSplitHeapNodeJustBefore(e,t);return i}function partialOrderTreeConvertMaxElementToNode(e){if(e.convertHeapToElement())return e;var t=e.heap.popMax(),i=this.insertSplitHeapNodeJustAfter(e,t);return i}function partialOrderTreeConvertHeapNodeToElements(e,t){var i;if(t)for(;e.getSize()>1;){var r=e.heap.popMax(),n=this.insertSplitHeapNodeJustAfter(e,r);void 0===i&&(i=n)}else for(;e.getSize()>1;){var r=e.heap.popMin(),n=this.insertSplitHeapNodeJustBefore(e,r);void 0===i&&(i=n)}return e.convertHeapToElement(),void 0===i&&(i=e),i}function partialOrderTreeRemoveElement(e){for(var t,i=0,r=this.root;r;){if(void 0!==r.heap){if(t=this.compare(e,r.heap.getMin()),0==t||t>0&&r.heap.getSize()>1&&(t=this.compare(e,r.heap.getMax()))<=0)return void 0!==r.left&&(i+=r.left.getSubTreeSize()),void this.removeElementFromHeap(r,e,i)}else if(t=this.compare(e,r.element),0===t)return void 0!==r.left&&(i+=r.left.getSubTreeSize()),void this.removeElementNode(r,e,i);t<0?(r.posTraceForward>0&&this.notifyAbsForward(r,r.posTraceForward,!0,!1,e),void 0!==r.absForward&&this.queuedForward.push(r),void 0!==r.elementForward&&r.elementForward.updateRemoveElement(e),r=r.left):(i+=void 0!==r.left?r.left.getSubTreeSize()+r.getSize():r.getSize(),r.posTraceBackward>0&&this.notifyAbsBackward(r,r.posTraceBackward,!0,!1,e),void 0!==r.absBackward&&this.queuedBackward.push(r),void 0!==r.elementBackward&&r.elementBackward.updateRemoveElement(e),r=r.right)}}function partialOrderTreeRemoveElementFromHeap(e,t,i){e.posTraceForward>0&&this.notifyAbsForward(e,e.posTraceForward,!0,!1,t),e.posTraceBackward>0&&this.notifyAbsBackward(e,e.posTraceBackward,!0,!1,t),this.transferRequirementsAfterRemoval(t,e,i),0===e.subTreeSize&&(e=e.parent);for(var r=e.parent;void 0!==r;r=r.parent)r.subTreeSize--;1==e.heap.getSize()?this.removeNode(e):(void 0!==e.subTreeSize&&e.subTreeSize--,void 0===this.uniqueValueAttr?e.heap.removeIndex(t):e.heap.removeIndex(t[this.uniqueValueAttr]))}function partialOrderTreeRemoveElementNode(e,t,i){this.nodeBeingRemoved=e,e.posTraceForward>0&&this.notifyAbsForward(e,e.posTraceForward,!0,!1,t),e.posTraceBackward>0&&this.notifyAbsBackward(e,e.posTraceBackward,!0,!1,t),void 0!==e.absForward&&this.queuedForward.push(e),void 0!==e.absBackward&&this.queuedBackward.push(e),void 0!==e.elementForward&&(this.removeElementRequirementTracing(e.elementForward,e),this.suspendRequirement(e.elementForward),e.elementForward=void 0),void 0!==e.elementBackward&&(this.removeElementRequirementTracing(e.elementBackward,e),this.suspendRequirement(e.elementBackward),e.elementBackward=void 0),this.transferRequirementsAfterRemoval(t,e,i);for(var r=e.parent;void 0!==r;r=r.parent)r.subTreeSize--;this.removeNode(e),this.nodeBeingRemoved=void 0}function partialOrderTreeRemoveNode(e){var t;if(t=void 0===e.left||void 0===e.right?e:e.next,t!=e){var i=(void 0!==t.absForward?t.absForward.length:0)+(void 0!==t.elementForward?1:0);i>0&&this.removeForwardTraceUpTo(t,i,e);var r=(void 0!==t.absBackward?t.absBackward.length:0)+(void 0!==t.elementBackward?1:0);r>0&&this.removeBackwardTraceUpTo(t,r,e);for(var n=t.getSize(),o=t.parent;o!==e;o=o.parent)o.subTreeSize-=n}t.prev?t.prev.next=t.next:this.first=t.next,t.next?t.next.prev=t.prev:this.last=t.prev;var s=void 0!==t.left?t.left:t.right;void 0!==s&&(s.parent=t.parent),void 0===t.parent?this.root=s:t==t.parent.left?(t.parent.left=s,void 0===s&&void 0===t.parent.right&&(t.parent.subTreeSize=void 0)):(t.parent.right=s,void 0===s&&void 0===t.parent.left&&(t.parent.subTreeSize=void 0)),t!=e&&(e.subTreeSize-=e.getSize(),e.copyContentFromNode(t)),this.fixAfterRemoval(t)}function partialOrderTreeRemoveAllElements(){for(var e=this.getSize(),t=[].concat(this.allRequirements.requirements),i=t.length,r=0;r<i;++r){var n=t[r];if(n.clearAllElements(),void 0!==n.anchor)this.suspendRequirement(n);else if(void 0!==n.offset&&n.offset<e&&!n.isEnd){var o=this.getVirtualNode(n.isBackward);o.addAbsRequirement(n,n.offset+1)}}this.root=void 0,this.first=void 0,this.last=void 0,void 0!==this.virtualFirst&&this.virtualFirst.resetAfterClearElements(),void 0!==this.virtualLast&&this.virtualLast.resetAfterClearElements()}function partialOrderTreeAllowsHeap(e){return 0==this.noHeapNodes&&e!==this.nodeBeingRemoved&&e.allowsHeap()}function partialOrderTreeMergeWithNextNode(e){var t,i;void 0==e.right?(t=e,i=e.next):(t=e.next,i=e);for(var r=t.getSize(),n=t.parent;n!=i;n=n.parent)n.subTreeSize-=r;t.prev?t.prev.next=t.next:this.first=t.next,t.next?t.next.prev=t.prev:this.last=t.prev;var o=void 0!==t.left?t.left:t.right;void 0!==o&&(o.parent=t.parent),void 0===t.parent?this.root=o:(t==t.parent.left?t.parent.left=o:t.parent.right=o,void 0===t.parent.left&&void 0===t.parent.right&&(t.parent.subTreeSize=void 0));var s;if(void 0===t.heap)void 0!==i.heap?(s=i.heap,s.add(t.element)):(s=new MinMaxPosHeap(this.heapCompare,this.uniqueValueAttr),s.add(t.element),s.add(i.element));else if(void 0===i.heap)s=t.heap,s.add(i.element);else{var a;t.getSize()>=i.getSize()?(s=t.heap,a=i.heap):(a=t.heap,s=i.heap);for(var d=1,u=a.heap.length;d<u;++d)s.add(a.heap[d])}i.heap=s,void 0!==i.element&&(i.element=void 0),this.fixAfterRemoval(t),t.subTreeSize=0,t.parent=i}function partialOrderTreeNotifyAbsForward(e,t,i,r,n){e.posTraceForward>0&&this.notifyAbsForward(e.right,e.posTraceForward,!1,r,n),i||(void 0!==e.absForward&&(this.queuedForward.push(e),t-=e.absForward.length),void 0!==e.elementForward&&(r?e.elementForward.updateAddElement(n):e.elementForward.updateRemoveElement(n),t--)),0!=t&&t>e.posTraceForward&&this.notifyAbsForward(e.left,t-e.posTraceForward,!1,r,n)}function partialOrderTreeNotifyAbsBackward(e,t,i,r,n){e.posTraceBackward>0&&this.notifyAbsBackward(e.left,e.posTraceBackward,!1,r,n),i||(void 0!==e.absBackward&&(this.queuedBackward.push(e),t-=e.absBackward.length),void 0!==e.elementBackward&&(r?e.elementBackward.updateAddElement(n):e.elementBackward.updateRemoveElement(n),t--)),0!=t&&t>e.posTraceBackward&&this.notifyAbsBackward(e.right,t-e.posTraceBackward,!1,r,n)}function partialOrderTreeNotifyAddRelForward(e,t,i){if(void 0===e){if(void 0!==this.virtualLast){var r=this.virtualLast.notifyAddRel(t);if(0==r.length)return;this.convertMaxElementToNode(this.last);for(var n=0,o=r.length;n<o;++n){var s=r[n];void 0===this.last.relForward?this.last.relForward=[s]:this.last.relForward.push(s),s.updateElement(this.last.element)}this.virtualLast.isEmpty()&&(this.virtualLast=void 0)}}else{if(void 0!==e.relForward){this.convertMaxElementToNode(e.prev);for(var n=0,o=e.relForward.length;n<o;){var s=e.relForward[n];s.offset<t?n++:(void 0===e.prev.relForward?e.prev.relForward=[s]:e.prev.relForward.push(s),n<o-1&&(e.relForward[n]=e.relForward[o-1]),e.relForward.length--,o--,s.updateElement(e.prev.element),i--)}0==e.relForward.length&&(e.relForward=void 0)}i>0&&this.notifyAddRelForward(e.next,t+e.getSize(),i)}}function partialOrderTreeNotifyAddRelBackward(e,t,i){if(void 0===e){if(void 0!==this.virtualFirst){var r=this.virtualFirst.notifyAddRel(t);if(0==r.length)return;this.convertMinElementToNode(this.first);for(var n=0,o=r.length;n<o;++n){var s=r[n];void 0===this.first.relBackward?this.first.relBackward=[s]:this.first.relBackward.push(s),s.updateElement(this.first.element)}this.virtualFirst.isEmpty()&&(this.virtualFirst=void 0)}}else{if(void 0!==e.relBackward){this.convertMinElementToNode(e.next);for(var n=0,o=e.relBackward.length;n<o;){var s=e.relBackward[n];s.offset<t?n++:(void 0===e.next.relBackward?e.next.relBackward=[s]:e.next.relBackward.push(s),n<o-1&&(e.relBackward[n]=e.relBackward[o-1]),e.relBackward.length--,o--,s.updateElement(e.next.element),i--)}0==e.relBackward.length&&(e.relBackward=void 0)}i>0&&this.notifyAddRelBackward(e.prev,t+e.getSize(),i)}}function partialOrderTreeNotifyRemoveRelForward(e,t,i){if(void 0===e)return void(void 0!==this.virtualLast&&this.virtualLast.notifyRemoveRel(t));if(void 0!==e.relForward){for(var r=0,n=e.relForward.length;r<n;){var o=e.relForward[r];o.offset<t?r++:(o.offset==t?this.suspendRequirement(o):(void 0===e.next?this.getVirtualNode(!1).addRelRequirement(o,1):(this.convertMinElementToNode(e.next),void 0===e.next.relForward?e.next.relForward=[o]:e.next.relForward.push(o)),t>0&&e.nextTrace++,o.updateElement(e.next?e.next.element:void 0)),r<n-1&&(e.relForward[r]=e.relForward[n-1]),e.relForward.length--,n--,t>0&&i--)}0==e.relForward.length&&(e.relForward=void 0)}i>0&&this.notifyRemoveRelForward(e.next,t+e.getSize(),i)}function partialOrderTreeNotifyRemoveRelBackward(e,t,i){if(void 0===e)return void(void 0!==this.virtualFirst&&this.virtualFirst.notifyRemoveRel(t));if(void 0!==e.relBackward){for(var r=0,n=e.relBackward.length;r<n;){var o=e.relBackward[r];o.offset<t?r++:(o.offset==t?this.suspendRequirement(o):(void 0===e.prev?this.getVirtualNode(!0).addRelRequirement(o,1):(this.convertMaxElementToNode(e.prev),void 0===e.prev.relBackward?e.prev.relBackward=[o]:e.prev.relBackward.push(o)),t>0&&e.prevTrace++,o.updateElement(e.prev?e.prev.element:void 0)),r<n-1&&(e.relBackward[r]=e.relBackward[n-1]),e.relBackward.length--,n--,t>0&&i--)}0==e.relBackward.length&&(e.relBackward=void 0)}i>0&&this.notifyRemoveRelBackward(e.prev,t+e.getSize(),i)}function partialOrderTreeNotifyReplaceRelForward(e,t,i,r){if(void 0===e)return void 0!==this.virtualLast&&(r=this.virtualLast.notifyReplaceRel(t,r),this.virtualLast.isEmpty()&&(this.virtualLast=void 0)),r?r:[];if(void 0===r&&(r=[]),void 0!==e.relForward){for(var n=0,o=e.relForward.length;n<o;){var s=e.relForward[n];s.offset<t?n++:(t>0&&i--,s.offset==t&&(n<o-1&&(e.relForward[n]=e.relForward[o-1]),e.relForward.length--,o--,r.push(s)))}0==e.relForward.length&&(e.relForward=void 0)}if(i>0){var a=r.length;r=this.notifyReplaceRelForward(e.next,t+e.getSize(),i,r),e.nextTrace-=r.length-a}return r}function partialOrderTreeNotifyReplaceRelBackward(e,t,i,r){if(void 0===e)return void 0!==this.virtualFirst&&(r=this.virtualFirst.notifyReplaceRel(t,r),this.virtualFirst.isEmpty()&&(this.virtualFirst=void 0)),r?r:[];if(void 0===r&&(r=[]),void 0!==e.relBackward){for(var n=0,o=e.relBackward.length;n<o;){var s=e.relBackward[n];s.offset<t?n++:(t>0&&i--,s.offset==t&&(n<o-1&&(e.relBackward[n]=e.relBackward[o-1]),e.relBackward.length--,o--,r.push(s)))}0==e.relBackward.length&&(e.relBackward=void 0)}if(i>0){var a=r.length;r=this.notifyReplaceRelBackward(e.next,t+e.getSize(),i,r),e.prevTrace-=r.length-a}return r}function partialOrderTreeAddForwardTrace(e,t){void 0!==e.parent&&(e.parent.right==e&&(e.parent.posTraceForward+=t),this.addForwardTrace(e.parent,t))}function partialOrderTreeRemoveForwardTrace(e,t){void 0!==e.parent&&(e.parent.right==e&&(e.parent.posTraceForward-=t),this.removeForwardTrace(e.parent,t))}function partialOrderTreeRemoveForwardTraceUpTo(e,t,i){void 0!==e.parent&&(e.parent.right==e&&(e.parent.posTraceForward-=t),e.parent!==i&&this.removeForwardTraceUpTo(e.parent,t,i))}function partialOrderTreeAddBackwardTrace(e,t){void 0!==e.parent&&(e.parent.left==e&&(e.parent.posTraceBackward+=t),this.addBackwardTrace(e.parent,t))}function partialOrderTreeRemoveBackwardTrace(e,t){void 0!==e.parent&&(e.parent.left==e&&(e.parent.posTraceBackward-=t),this.removeBackwardTrace(e.parent,t))}function partialOrderTreeRemoveBackwardTraceUpTo(e,t,i){void 0!==e.parent&&(e.parent.left==e&&(e.parent.posTraceBackward-=t),e.parent!==i&&this.removeBackwardTraceUpTo(e.parent,t))}function partialOrderTreeTransferRequirementsAfterInsertion(e,t,i){if(0!=this.queuedForward.length&&this.moveForwardRequirementsToPrev(e,i),0!=this.queuedBackward.length){var r=this.invertOffset(i);this.moveBackwardRequirementsToNext(e,r)}t.nextTrace>0&&this.notifyAddRelForward(t.next,1,t.nextTrace),t.prevTrace>0&&this.notifyAddRelBackward(t.prev,1,t.prevTrace),this.notifyComplementRequirementsOfAdd(e,i)}function partialOrderTreeMoveForwardRequirementsToPrev(e,t){var i=this.queuedForward.length;if(0!=i){for(var r=i-1;r>=0;--r){var n=this.queuedForward[r];if(void 0===n){if(void 0!==this.virtualLast){var o=this.virtualLast.notifyAddAbsolute(e,t);if(0==o.length)break;this.convertMaxElementToNode(this.last),void 0===this.last.absForward&&(this.last.absForward=[]);for(var s=0,a=o.length;s<a;++s){var d=o[s];this.last.absForward.push(d),d.updateElement(this.last.element,e,t,!0),d.isOrderedRange&&(d.isEnd?this.last.noHeapNext--:this.last.noHeapNext++)}this.addForwardTrace(this.last,o.length),this.virtualLast.isEmpty()&&(this.virtualLast=void 0)}}else if(void 0!==n.absForward){this.convertMaxElementToNode(n.prev);var u=n.prev;void 0===u.absForward&&(u.absForward=[]);for(var s=0,a=n.absForward.length;s<a;++s){var d=n.absForward[s];u.absForward.push(d),d.updateElement(u.element,e,t,!0),d.isOrderedRange&&(d.isEnd?u.noHeapNext--:u.noHeapNext++)}this.addForwardTrace(u,n.absForward.length),this.removeForwardTrace(n,n.absForward.length),n.absForward=void 0,this.allowsHeap(n)&&(n.next&&void 0!==n.next.heap?this.mergeWithNextNode(n):n.prev&&void 0!==n.prev.heap?this.mergeWithNextNode(n.prev):n.convertElementToHeap(this.uniqueValueAttr,this.heapCompare))}}this.queuedForward=[]}}function partialOrderTreeMoveBackwardRequirementsToNext(e,t){var i=this.queuedBackward.length;if(0!=i){for(var r=i-1;r>=0;--r){var n=this.queuedBackward[r];if(void 0===n){if(void 0!==this.virtualFirst){var o=this.virtualFirst.notifyAddAbsolute(e,t);if(0==o.length)break;this.convertMinElementToNode(this.first),void 0===this.first.absBackward&&(this.first.absBackward=[]);for(var s=0,a=o.length;s<a;++s){var d=o[s];this.first.absBackward.push(d),d.updateElement(this.first.element,e,t,!0),d.isOrderedRange&&(d.isEnd?this.first.noHeapPrev--:this.first.noHeapPrev++)}this.addBackwardTrace(this.first,o.length),this.virtualFirst.isEmpty()&&(this.virtualFirst=void 0)}}else if(void 0!==n.absBackward){this.convertMinElementToNode(n.next);var u=n.next;void 0===u.absBackward&&(u.absBackward=[]);for(var s=0,a=n.absBackward.length;s<a;++s){var d=n.absBackward[s];u.absBackward.push(d),d.updateElement(u.element,e,t,!0),d.isOrderedRange&&(d.isEnd?u.noHeapPrev--:u.noHeapPrev++)}this.addBackwardTrace(u,n.absBackward.length),this.removeBackwardTrace(n,n.absBackward.length),n.absBackward=void 0,this.allowsHeap(n)&&(n.next&&void 0!==n.next.heap?this.mergeWithNextNode(n):n.prev&&void 0!==n.prev.heap?this.mergeWithNextNode(n.prev):n.convertElementToHeap(this.uniqueValueAttr,this.heapCompare))}}this.queuedBackward=[]}}function partialOrderTreeNotifyComplementRequirementsOfAdd(e,t){var i=this.complementRequirements.requirements,r=i.length;if(0!=r)for(var n=0;n<r;++n)i[n].updateAddElement(e,t)}function partialOrderTreeTransferRequirementsAfterRemoval(e,t,i){this.notifyRemoveRelForward(t,0,t.nextTrace),this.notifyRemoveRelBackward(t,0,t.prevTrace),this.moveForwardRequirementsToNext(e,i);var r=this.invertOffset(i);this.moveBackwardRequirementsToPrev(e,r),this.notifyComplementRequirementsOfRemove(e,i)}function partialOrderTreeMoveForwardRequirementsToNext(e,t){void 0!==this.virtualLast&&this.virtualLast.notifyRemoveAbsolute(e,t);for(var i=0,r=this.queuedForward.length;i<r;++i){var n=this.queuedForward[i];if(void 0!==n.absForward){if(void 0===n.next){this.getVirtualNode(!1);for(var o=n.absForward.length-1;o>=0;--o){var s=n.absForward[o];this.virtualLast.addAbsRequirement(s,1),s.updateElement(void 0,e,t,!1),s.isOrderedRange&&(s.isEnd?n.noHeapNext++:n.noHeapNext--)}}else{this.convertMinElementToNode(n.next);var a=n.next;void 0===a.absForward&&(a.absForward=[]);for(var o=0,d=n.absForward.length;o<d;++o){var s=n.absForward[o];a.absForward.push(s),s.updateElement(a.element,e,t,!1),s.isOrderedRange&&(s.isEnd?n.noHeapNext++:n.noHeapNext--)}this.addForwardTrace(a,n.absForward.length)}this.removeForwardTrace(n,n.absForward.length),n.absForward=void 0,this.allowsHeap(n)&&(n.next&&void 0!==n.next.heap?this.mergeWithNextNode(n):n.prev&&void 0!==n.prev.heap?this.mergeWithNextNode(n.prev):n.convertElementToHeap(this.uniqueValueAttr,this.heapCompare))}}this.queuedForward=[]}function partialOrderTreeMoveBackwardRequirementsToPrev(e,t){void 0!==this.virtualFirst&&this.virtualFirst.notifyRemoveAbsolute(e,t);for(var i=0,r=this.queuedBackward.length;i<r;++i){var n=this.queuedBackward[i];if(void 0!==n.absBackward){if(void 0===n.prev){this.getVirtualNode(!0);for(var o=n.absBackward.length-1;o>=0;--o){var s=n.absBackward[o];this.virtualFirst.addAbsRequirement(s,1),s.updateElement(void 0,e,t,!1),s.isOrderedRange&&(s.isEnd?n.noHeapPrev++:n.noHeapPrev--)}}else{this.convertMaxElementToNode(n.prev);var a=n.prev;void 0===a.absBackward&&(a.absBackward=[]);for(var o=0,d=n.absBackward.length;o<d;++o){var s=n.absBackward[o];a.absBackward.push(s),s.updateElement(a.element,e,t,!1),s.isOrderedRange&&(s.isEnd?n.noHeapPrev++:n.noHeapPrev--)}this.addBackwardTrace(a,n.absBackward.length)}this.removeBackwardTrace(n,n.absBackward.length),n.absBackward=void 0,this.allowsHeap(n)&&(n.next&&void 0!==n.next.heap?this.mergeWithNextNode(n):n.prev&&void 0!==n.prev.heap?this.mergeWithNextNode(n.prev):n.convertElementToHeap(this.uniqueValueAttr,this.heapCompare))}}this.queuedBackward=[]}function partialOrderTreeNotifyComplementRequirementsOfRemove(e,t){var i=this.complementRequirements.requirements,r=i.length;if(0!=r)for(var n=0;n<r;++n)i[n].updateRemoveElement(e,t)}function partialOrderTreeRegisterAbsRequirement(e){this.allRequirements.add(e),1==e.isOrderedRange&&e.isBegin&&this.orderedRangeRequirements.add(e)}function partialOrderTreeUnregisterAbsRequirement(e){this.allRequirements.remove(e),1==e.isOrderedRange&&e.isBegin&&this.orderedRangeRequirements.remove(e)}function partialOrderTreeAddAbsRequirement(e){this.registerAbsRequirement(e);var t=e.offset,i=e.isBackward,r=this.getSize();if(r<=t){var n=this.getVirtualNode(i);return n.addAbsRequirement(e,t-r+1),void(e.isEnd&&this.addEndOfAbsRangeRequirement(e,void 0,t-r+1))}var o=this.findNodeByOffset(t,i,!0);i?this.addBackwardTrace(o,1):this.addForwardTrace(o,1),this.addAbsRequirementToNode(e,o),e.updateElement(o.element,void 0),e.isEnd?this.addEndOfAbsRangeRequirement(e,o):e.isBegin&&this.addAbsRequirement(e.getEnd())}function partialOrderTreeAddAbsRequirementToNode(e,t){var i=e.isBackward?t.absBackward:t.absForward;if(void 0===i)return void(e.isBackward?t.absBackward=[e]:t.absForward=[e]);var r;if(e.isBegin&&void 0!==(r=e.getEnd())&&r.offset===e.offset)for(var n=0,o=i.length;n<o;++n)if(i[n].id==r.id)return void i.splice(n,0,e);i.push(e)}function partialOrderTreeAddEndOfAbsRangeRequirement(e,t,i){if(e.isOrderedRange||!e.isReplacement){var r;r=void 0===t?this.getSize()-e.getBegin().offset:e.offset-e.getBegin().offset+1;var n=this.getNewRangeElements(t,r,e.isOrderedRange,e.isBackward,!1,1);e.addRangeElements(e.isBackward?n:n.reverse())}}function partialOrderTreeGetNewRangeElements(e,t,i,r,n,o){var s=[];if(r){for(var a=void 0===e?this.first:e;void 0!==a&&t>0;){if(void 0===a.heap)s.push(a.element),t--,i&&(a.noHeapPrev+=o);else{if(i){a=this.convertHeapNodeToElements(a,!1);continue}t-=a.getSize();for(var d=a.heap.heap,u=1,h=d.length;u<h;++u)s.push(d[u])}a=a.next}i&&void 0!==e&&!n&&(e.noHeapPrev-=o)}else{for(var a=void 0===e?this.last:e;void 0!==a&&t>0;){if(void 0===a.heap)s.push(a.element),t--,i&&(a.noHeapNext+=o);else{if(i){a=this.convertHeapNodeToElements(a,!0);continue}t-=a.getSize();for(var d=a.heap.heap,u=1,h=d.length;u<h;++u)s.push(d[u])}a=a.prev}i&&void 0!==e&&!n&&(e.noHeapNext-=o)}return s}function partialOrderTreeMoveAbsRequirement(e,t){if(t==e.offset)return[];var i=this.getSize();if(e.isEnd&&e.getBegin().offset>=i)return e.offset=t,[];var r,n=e.offset,o=e.isBackward?this.virtualFirst:this.virtualLast;if(e.offset>=i){var s=e.offset-i+1;o.removeAbsRequirement(e,s)}else r=this.findNodeByOffset(e.offset,e.isBackward,!1),e.isBackward?this.removeBackwardTrace(r,1):this.removeForwardTrace(r,1),this.removeAbsRequirementFromNode(e,r);e.offset=t;var a;if(e.offset>=i){void 0===o&&(o=this.getVirtualNode(e.isBackward));var s=e.offset-i+1;o.addAbsRequirement(e,s)}else a=this.findNodeByOffset(e.offset,e.isBackward,!0),e.isBackward?this.addBackwardTrace(a,1):this.addForwardTrace(a,1),this.addAbsRequirementToNode(e,a);if(void 0===r&&void 0===a)return[];if(e.isBegin&&void 0===r&&void 0!==a){var d=e.getEnd(),s=d.offset-i+1;o.addAbsRequirement(d,s),this.registerAbsRequirement(d)}e.updateElement(a?a.element:void 0,void 0);var u=n>t?r:a,h=(n>t?1:-1)*(e.isEnd?-1:1),l=void 0!==u?Math.abs(n-t)+1:i-Math.min(n,t),c=this.getNewRangeElements(u,l,e.isOrderedRange,e.isBackward,!1,h);return e.isEnd&&c.length--,c.reverse(),e.isBegin&&void 0!==u&&c.length--,c}function partialOrderTreeAddAnchoredRequirement(e){this.allRequirements.add(e);var t=e.anchor,i=this.findNodeByElement(t,!0);return void 0===i?void this.suspendRequirement(e):void this.insertAnchoredRequirement(e,i.node,i.pos)}function partialOrderTreeInsertAnchoredRequirement(e,t,i){void 0===e.offset?this.insertElementRequirement(e,t,i):e.isBackward?this.insertRelBackward(e,t):this.insertRelForward(e,t)}function partialOrderTreeInsertElementRequirement(e,t,i){var r;if(e.isBackward?(r=t.elementBackward,t.elementBackward=e):(r=t.elementForward,t.elementForward=e),e.isBackward?e.setOffset(this.invertOffset(i)):e.setOffset(i),r||(e.isBackward?this.addBackwardTrace(t,1):this.addForwardTrace(t,1)),e.isEnd){var n,o=e.isBackward?this.last:this.first;n=this.getNewRangeElements(o,i+1,e.isOrderedRange,!e.isBackward,!0,1),n.pop(),e.isBackward&&n.reverse(),e.addRangeElements(n),e.isOrderedRange&&this.orderedRangeRequirements.add(e)}void 0!==r&&r.isEnd&&r.isOrderedRange&&(this.removeElementRequirementNoHeapCount(r,t),this.orderedRangeRequirements.remove(r))}function partialOrderTreeInsertRelForward(e,t){for(var i=e.offset,r=t;r;){var n=r.getSize();if(i<n)break;r.nextTrace++,i-=n,r=r.next}void 0===r?this.getVirtualNode(!1).addRelRequirement(e,i+1):(r.convertHeapToElement()||(r=this.splitHeapNodeAtPos(r,i,!1)),void 0===r.relForward&&(r.relForward=[]),r.relForward.push(e),e.updateElement(r.element))}function partialOrderTreeInsertRelBackward(e,t){for(var i=e.offset,r=t;r;){var n=r.getSize();if(i<n)break;r.prevTrace++,i-=n,r=r.prev}void 0===r?this.getVirtualNode(!0).addRelRequirement(e,i+1):(r.convertHeapToElement()||(r=this.splitHeapNodeAtPos(r,i,!0)),void 0===r.relBackward&&(r.relBackward=[]),r.relBackward.push(e),e.updateElement(r.element))}function partialOrderTreeAddComplementRequirement(e,t){if(e.isOrderedRange&&(this.incNoHeapNodes(),this.orderedRangeRequirements.add(e)),this.allRequirements.add(e),this.complementRequirements.add(e),!t){var i=e.getForwardRange();if(void 0===i)return void e.addRangeElements([]);for(var r=i[0],n=i[1],o=this.findNodeByForwardOffset(r,!0),s=r,a=[];s<=n;){if(void 0!==o.heap){for(var d=o.heap.heap,u=1,h=d.length;u<h;++u)a.push(d[u]);s+=o.heap.getSize()}else a.push(o.element),s++;o=o.next}e.addRangeElements(a)}}function partialOrderTreeIncNoHeapNodes(){if(this.noHeapNodes>0)return void this.noHeapNodes++;this.noHeapNodes=1;for(var e=this.first;e;e=e.next)void 0===e.heap||e.convertHeapToElement()||(e=this.convertHeapNodeToElements(e,!0))}function partialOrderTreeRemoveAbsRequirement(e){this.unregisterAbsRequirement(e);var t=e.offset,i=e.isBackward,r=this.getSize();if(r<=t){var n=t-r+1;return void(i?(this.virtualFirst.removeAbsRequirement(e,n),this.virtualFirst.isEmpty()&&(this.virtualFirst=void 0)):(this.virtualLast.removeAbsRequirement(e,n),this.virtualLast.isEmpty()&&(this.virtualLast=void 0)))}var o=this.findNodeByOffset(t,i,!0);if(i?this.removeBackwardTrace(o,1):this.removeForwardTrace(o,1),e.isBegin){var s=e.getEnd();if(e.isOrderedRange){var a=s.offset-e.offset;this.removeRangeRequirementNoHeapCount(o,a,i)}this.removeAbsRequirement(s)}this.removeAbsRequirementFromNode(e,o)}function partialOrderTreeRemoveAbsRequirementFromNode(e,t){var i=e.isBackward?t.absBackward:t.absForward;if(1==i.length)e.isBackward?t.absBackward=void 0:t.absForward=void 0;else for(var r=0,n=i.length;r<n;++r)if(i[r].id==e.id){i.splice(r,1);break}}function partialOrderTreeRemoveRangeRequirementNoHeapCount(e,t,i){if(i)for(;void 0!==e&&t>0;)e.noHeapPrev--,e=e.prev,t--;else for(;void 0!==e&&t>0;)e.noHeapNext--,e=e.next,t--}function partialOrderTreeRemoveAnchoredRequirement(e){this.allRequirements.remove(e);var t=e.anchor,i=void 0===this.uniqueValueAttr?t:t[this.uniqueValueAttr];if(this.suspendedRequirements.has(i))return requirementList=this.suspendedRequirements.get(i),void(0==requirementList.remove(e)&&this.suspendedRequirements.delete(i));var r=this.findNodeByElement(t).node;void 0===e.offset?(e.isBackward?r.elementBackward=void 0:r.elementForward=void 0,this.removeElementRequirementTracing(e,r),e.isEnd&&e.isOrderedRange&&this.orderedRangeRequirements.remove(e)):e.isBackward?this.removeRelBackward(e,r):this.removeRelForward(e,r)}function partialOrderTreeRemoveElementRequirementTracing(e,t){e.isBackward?this.removeBackwardTrace(t,1):this.removeForwardTrace(t,1),e.isOrderedRange&&this.removeElementRequirementNoHeapCount(e,t)}function partialOrderTreeRemoveElementRequirementNoHeapCount(e,t){if(e.isEnd&&e.isOrderedRange)if(e.isBackward)for(var i=t;void 0!==i;)i.noHeapNext--,i=i.next;else for(var i=t;void 0!==i;)i.noHeapPrev--,i=i.prev}function partialOrderTreeRemoveRelForward(e,t){for(var i=e.offset,r=t;r;){var n=r.getSize();if(i<n)break;r.nextTrace--,i-=n,r=r.next}if(void 0===r)this.virtualLast.removeRelRequirement(e);else{var o=r.relForward;if(1==o.length)r.relForward=void 0;else for(var s=0,a=o.length;s<a;++s)if(o[s].id==e.id){s<a-1&&(o[s]=o[a-1]),o.length--;break}}}function partialOrderTreeRemoveRelBackward(e,t){for(var i=e.offset,r=t;r;){var n=r.getSize();if(i<n)break;r.prevTrace--,i-=n,r=r.prev}if(void 0===r)this.virtualFirst.removeRelRequirement(e);else{var o=r.relBackward;if(1==o.length)r.relBackward=void 0;else for(var s=0,a=o.length;s<a;++s)if(o[s].id==e.id){s<a-1&&(o[s]=o[a-1]),o.length--;break}}}function partialOrderTreeRemoveComplementRequirement(e){this.allRequirements.remove(e),this.complementRequirements.remove(e),e.isOrderedRange&&(this.decNoHeapNodes(),this.orderedRangeRequirements.remove(e))}function partialOrderTreeDecNoHeapNodes(){0!=this.noHeapNodes&&this.noHeapNodes--}function partialOrderTreeSuspendRequirement(e){var t,i=void 0===this.uniqueValueAttr?e.anchor:e.anchor[this.uniqueValueAttr];this.suspendedRequirements.has(i)?t=this.suspendedRequirements.get(i):(t=new RequirementList,this.suspendedRequirements.set(i,t)),t.add(e)&&e.suspend()}function partialOrderTreeUnsuspendRequirements(e,t,i){var r=void 0===this.uniqueValueAttr?e:e[this.uniqueValueAttr];if(this.suspendedRequirements.has(r)){var n=this.suspendedRequirements.get(r).requirements;this.suspendedRequirements.delete(r);for(var o=0,s=n.length;o<s;++o)this.insertAnchoredRequirement(n[o],t,i)}}function partialOrderTreeIsSuspendedRequirementAnchor(e){var t=void 0===this.uniqueValueAttr?e:e[this.uniqueValueAttr];return this.suspendedRequirements.has(t)}function partialOrderTreeUpdateCompareFunc(e){this.compare=e;var t=this;this.heapCompare=function(e,i){return t.compare(e,i)}}function partialOrderTreeRefreshOrder(){if(!(this.getSize()<=1)){this.requirementsPendingReordering=[];for(var e=this.reorderSubTree(void 0,this.root),t=0,i=this.requirementsPendingReordering.length;t<i;++t)this.addAnchoredRequirement(this.requirementsPendingReordering[t]);this.requirementsPendingReordering=void 0,this.updateOrderedRangesAfterReordering(e)}}function partialOrderTreeUpdateOrderedRangesAfterReordering(e){if(void 0!==e&&0!=e.length&&0!=this.orderedRangeRequirements.getSize())for(var t=0,i=this.orderedRangeRequirements.requirements.length;t<i;++t){var r=this.orderedRangeRequirements.requirements[t],n=r.getForwardRange();if(void 0!==n)for(var o=0,s=e.length;o<s;++o){var a=e[o];if(n[1]<a[0])break;n[0]>a[1]||r.updateReorderedRange(Math.max(n[0],a[0]),Math.min(n[1],a[1]))}}}function partialOrderTreeReorderSubTree(e,t,i,r){var n=void 0===e?0:i+e.getSize();void 0!==t.left?(n+=t.left.getSubTreeSize(),r=this.reorderSubTree(e,t.left,i,r)):void 0!==e&&e.refreshOrder(this.heapCompare),void 0!==t.right?r=this.reorderSubTree(t,t.right,n,r):t.refreshOrder(this.heapCompare);var o,s;if(void 0===e){if(o=this.first,s=0,o===t)return r}else o=e,s=i;var a=t.getSize()+(t.right?t.right.getSubTreeSize():0),d=this.mergeReorderedSubTrees(o,s,t,a);return void 0===d?r:mergeIntervalIntoSequence(r,d)}function partialOrderTreeMergeReorderedSubTrees(e,t,i,r){var n,o=i,s=[],a=0,d=[],u=[],h=void 0===o.heap?o.element:o.heap.getMin(),l=void 0===o.prev.heap?o.prev.element:o.prev.heap.getMax();if(!(this.compare(l,h)<0)){var c=void 0===e.heap?e.element:e.heap.getMax();for(void 0!==o.heap&&(o.origHeapSize=o.heap.getSize());e!==i;){var p=0===r?-1:this.compare(c,h);if(p<0&&a==s.length){if(void 0!==e.heap){if(0!=u.length){for(var f=u.length-1;f>=0;--f)s.push(u[f]);u=[]}t+=e.heap.getSize()}else t++;e=e.next,c=a<s.length?s[a]:void 0===e.heap?e.element:e.heap.getMax()}else{var v=p>0?h:c;if(p>0&&d.push(v),void 0===e.heap)s.push(e.element),n=this.replaceNodeElement(e,t,!1,v,s,a,d,n),e=e.next,t++;else if(u.push(e.heap.popMax()),e.heap.add(v),e.heap.getMax()===v){for(var f=u.length-1;f>=0;--f)s.push(u[f]);u=[],t+=e.heap.getSize(),e=e.next,c=s[a]}else a>=s.length&&(c=e.heap.getMax());if(p>0){if(void 0!==o.heap&&o.heap.popMin(),0==--r)continue;void 0!==o.heap&&0!=o.heap.getSize()||(o=o.next,void 0!==o.heap&&(o.origHeapSize=o.heap.getSize())),h=void 0!==o.heap?o.heap.getMin():o.element}else a++,c=a<s.length?s[a]:void 0===e.heap?e.element:e.heap.getMax()}}return this.mergeReorderedSubTreeTail(s,a,d,e,t,r>0?o:void 0,r,n)}}function partialOrderTreeMergeReorderedSubTreeTail(e,t,i,r,n,o,s,a){if(t==e.length)return a;var d,u=e[t];for(0!==s&&(void 0===o.heap?d=o.element:r==o?(d=o.heap.getMax(),s-=o.heap.getSize()-1):d=o.heap.getMin());t<e.length;){var h,l=0==s?-1:this.compare(u,d);if(l>0){if(r==o){--s>0?(o=o.next,void 0!==o.heap&&(o.origHeapSize=o.heap.getSize()),d=void 0===o.heap?o.element:o.heap.getMin()):o=void 0;continue}h=d,i.push(d),void 0!==o.heap&&o.heap.popMin()}else h=u;if(void 0===r.heap?a=this.replaceNodeElement(r,n,!0,h,e,t,i,a):r.heap.add(h),l>0?--s>0?(void 0===o.heap?(o=o.next,void 0!==o.heap&&(o.origHeapSize=o.heap.getSize())):0==o.heap.getSize()&&(o=o.next,void 0!==o.heap&&(o.origHeapSize=o.heap.getSize())),d=void 0===o.heap?o.element:o.heap.getMin()):o=void 0:(++t,u=e[t]),t==e.length)break;if(void 0===r.heap)n++,r=r.next;else{if(r.origHeapSize>r.heap.getSize())continue;n+=r.origHeapSize,r.origHeapSize=void 0,r=r.next}r==o&&(s-=o.heap.getSize()-1,d=o.heap.getMax())}return a}function partialOrderTreeReplaceNodeElement(e,t,i,r,n,o,s,a){e.element;if(e.element=r,void 0!==e.elementForward){var d=e.elementForward;this.removeElementRequirementTracing(d,e),this.requirementsPendingReordering.push(d),e.elementForward=void 0}if(void 0!==e.elementBackward){var d=e.elementBackward;this.removeElementRequirementTracing(d,e),this.requirementsPendingReordering.push(d),e.elementBackward=void 0}if(e.nextTrace>0){var u=this.notifyReplaceRelForward(e,0,e.nextTrace);if(u)for(var h=0,l=u.length;h<l;++h)this.requirementsPendingReordering.push(u[h])}if(e.prevTrace>0){var u=this.notifyReplaceRelBackward(e,0,e.prevTrace);if(u)for(var h=0,l=u.length;h<l;++h)this.requirementsPendingReordering.push(u[h])}if(void 0!==e.relForward)for(var h=0,l=e.relForward.length;h<l;++h)e.relForward[h].updateElement(r);if(void 0!==e.relBackward)for(var h=0,l=e.relBackward.length;h<l;++h)e.relBackward[h].updateElement(r);var c=0;if(1==i&&(c=s.length-(n.length-o),r!=n[o]&&c--),
void 0!==e.absForward)for(var h=0,l=e.absForward.length;h<l;++h){var d=e.absForward[h];d.replacedElement(r,n,o,s,c)}if(void 0!==e.absBackward)for(var h=0,l=e.absBackward.length;h<l;++h){var d=e.absBackward[h];d.replacedElement(r,n,o,s,c)}return(e.noHeapNext>0||void 0!==e.prev&&e.prev.noHeapNext>0||e.noHeapPrev>0||void 0!==e.next&&e.next.noHeapPrev>0)&&(void 0===a?a=[t,t]:a[1]=t),a}function partialOrderTreeNotifyListeners(){for(var e=this.allRequirements.requirements,t=0,i=e.length;t<i;++t)e[t].notifyListeners()}function PartialOrderNode(e,t,i,r,n,o){this.parent=e,this.left=void 0,this.right=void 0,this.prev=t,this.next=i,void 0!==o?(this.heap=new MinMaxPosHeap(o,n),void 0!==r&&this.heap.add(r)):void 0!==r&&(this.element=r),this.subTreeSize=void 0,this.posTraceForward=0,this.posTraceBackward=0,this.nextTrace=0,this.prevTrace=0,this.noHeapNext=0,this.noHeapPrev=0}function partialOrderNodeGetSize(){return void 0!==this.heap?this.heap.getSize():void 0===this.element?0:1}function partialOrderNodeGetSubTreeSize(){return void 0===this.subTreeSize?this.getSize():this.subTreeSize}function partialOrderNodeAllowsHeap(){return!(void 0!==this.absForward||void 0!==this.absBackward||void 0!==this.relForward||void 0!==this.relBackward||void 0!==this.elementForward||void 0!==this.elementBackward||0!=this.nextTrace||0!=this.prevTrace||void 0!==this.prev&&0!=this.prev.noHeapNext||void 0!==this.next&&0!=this.next.noHeapPrev)}function partialOrderNodeConvertElementToHeap(e,t){this.heap=new MinMaxPosHeap(t,e),void 0!==this.element&&(this.heap.add(this.element),this.element=void 0)}function partialOrderNodeConvertHeapToElement(){if(void 0===this.heap)return!0;var e=this.heap.getSize();return!(e>1)&&(1==e&&(this.element=this.heap.getMin()),this.heap=void 0,!0)}function partialOrderNodeCopyContentFromNode(e){this.element=e.element,this.heap=e.heap,this.absForward=e.absForward,this.relForward=e.relForward,this.absBackward=e.absBackward,this.relBackward=e.relBackward,this.elementForward=e.elementForward,this.elementBackward=e.elementBackward,this.nextTrace=e.nextTrace,this.prevTrace=e.prevTrace,this.noHeapNext=e.noHeapNext,this.noHeapPrev=e.noHeapPrev}function partialOrderNodeRefreshOrder(e){if(void 0!==this.heap){var t=this.heap.heap;this.heap=new MinMaxPosHeap(e,this.heap.indexKey);for(var i=1,r=t.length;i<r;++i)this.heap.add(t[i])}}function VirtualPartialOrderNode(e){this.tree=e,this.absoluteRequirements=void 0,this.absoluteGap=void 0,this.endAbsoluteRequirements=void 0,this.relativeRequirements=void 0,this.relativeGap=void 0}function virtualPartialOrderNodeIsEmpty(){return void 0===this.absoluteGap&&void 0===this.relativeGap}function virtualPartialOrderNodeGetRelNum(){return void 0===this.relativeRequirements?0:this.relativeRequirements.length}function virtualPartialOrderNodeNotifyAddRel(e){if(void 0===this.relativeRequirements)return[];for(var t=0,i=this.relativeRequirements.length,r=[];t<i;){var n=this.relativeRequirements[t];n.requirement.offset<e+n.gap-1?t++:0==--n.gap?(r.push(n.requirement),t<i-1&&(this.relativeRequirements[t]=this.relativeRequirements[i-1]),this.relativeRequirements.length--,i--):n.gap<this.relativeGap&&(this.relativeGap=n.gap)}return 0==this.relativeRequirements.length&&(this.relativeRequirements=void 0,this.relativeGap=void 0),r}function virtualPartialOrderNodeNotifyRemoveRel(e){if(void 0!==this.relativeRequirements){for(var t=0,i=this.relativeRequirements.length,r=1/0;t<i;){var n=this.relativeRequirements[t],o=e+n.gap-1;n.requirement.offset<o?(n.gap<r&&(r=n.gap),t++):n.requirement.offset!=o?(n.gap++,n.gap<r&&(r=n.gap)):(this.tree.suspendRequirement(n.requirement),t<i-1&&(this.relativeRequirements[t]=this.relativeRequirements[i-1]),this.relativeRequirements.length--,i--)}0==this.relativeRequirements.length?(this.relativeRequirements=void 0,this.relativeGap=void 0):this.relativeGap=r}}function virtualPartialOrderNodeNotifyReplaceRel(e,t){if(void 0===t&&(t=[]),void 0===this.relativeRequirements)return t;for(var i=0,r=this.relativeRequirements.length,n=1/0;i<r;){var o=this.relativeRequirements[i],s=e+o.gap-1;o.requirement.offset!=s?(o.gap<n&&(n=o.gap),i++):(t.push(o.requirement),i<r-1&&(this.relativeRequirements[i]=this.relativeRequirements[r-1]),this.relativeRequirements.length--,r--)}return 0==this.relativeRequirements.length?(this.relativeRequirements=void 0,this.relativeGap=void 0):this.relativeGap=n,t}function virtualPartialOrderNodeNotifyAddAbsolute(e,t){if(void 0===this.absoluteGap)return[];var i,r,n=[];if(0==--this.absoluteGap){for(;r=this.absoluteRequirements.getMin();){if(void 0===i)i=r.offset;else if(r.offset!==i){this.absoluteGap=r.offset-i;break}if(this.absoluteRequirements.popMin(),n.push(r),r.isBegin){var o=r.getEnd(),s=o.offset-r.offset;this.addAbsRequirement(o,s),this.tree.registerAbsRequirement(o)}else r.isEnd&&0==this.endAbsoluteRequirements.remove(r)&&(this.endAbsoluteRequirements=void 0)}this.absoluteRequirements.isEmpty()&&(this.absoluteRequirements=void 0,this.absoluteGap=void 0)}if(void 0!==this.endAbsoluteRequirements)for(var a=this.endAbsoluteRequirements.requirements,d=0,u=a.length;d<u;++d)a[d].updateElement(void 0,e,t,!0);return n}function virtualPartialOrderNodeNotifyRemoveAbsolute(e,t){if(void 0!==this.absoluteGap&&(this.absoluteGap++,void 0!==this.endAbsoluteRequirements))for(var i=this.endAbsoluteRequirements.requirements,r=0,n=i.length;r<n;++r)i[r].updateElement(void 0,e,t,!1)}function virtualPartialOrderNodeAddAbsRequirement(e,t){if(void 0===this.absoluteRequirements?(this.absoluteRequirements=new MinMaxPosHeap(function(e,t){return e.offset-t.offset},"id"),this.absoluteGap=t):t<this.absoluteGap&&(this.absoluteGap=t),this.absoluteRequirements.add(e),e.isEnd)void 0===this.endAbsoluteRequirements&&(this.endAbsoluteRequirements=new RequirementList),this.endAbsoluteRequirements.add(e);else if(e.isBegin){var i=e.getEnd();this.absoluteRequirements.inHeap(i.id)&&(this.tree.unregisterAbsRequirement(i),this.endAbsoluteRequirements.remove(i),0==this.endAbsoluteRequirements.requirements.length&&(this.endAbsoluteRequirements=void 0),this.absoluteRequirements.removeIndex(i.id))}}function virtualPartialOrderNodeRemoveAbsRequirement(e,t){if(void 0!==this.absoluteRequirements){if(e.isEnd&&(this.endAbsoluteRequirements.remove(e),0==this.endAbsoluteRequirements.requirements.length&&(this.endAbsoluteRequirements=void 0)),this.absoluteRequirements.removeIndex(e.id),0==this.absoluteRequirements.getSize())return this.absoluteRequirements=void 0,void(this.absoluteGap=void 0);if(this.absoluteGap==t){var i=this.absoluteRequirements.getMin();i.offset!=e.offset&&(this.absoluteGap+=i.offset-e.offset)}}}function virtualPartialOrderNodeAddRelRequirement(e,t){void 0===this.relativeRequirements?(this.relativeRequirements=[],this.relativeGap=t):t<this.relativeGap&&(this.relativeGap=t),this.relativeRequirements.push(e)}function virtualPartialOrderNodeRemoveRelRequirement(e){if(1==this.relativeRequirements.length)return this.relativeRequirements=void 0,void(this.relativeGap=void 0);for(var t,i=0,r=this.relativeRequirements.length;i<r;++i)if(this.relativeRequirements[i].requirement.id==e.id){t=this.relativeRequirements[i].gap,i<r-1&&(this.relativeRequirements[i]=this.relativeRequirements[r-1]),this.relativeRequirements.length--;break}if(t==this.relativeGap){this.relativeGap=1/0;for(var i=0,r=this.relativeRequirements.length;i<r;++i){var n=this.relativeRequirements[i].gap;n<this.relativeGap&&(this.relativeGap=n)}}}function virtualPartialOrderNodeResetAfterClearElements(){if(this.relativeRequirements=void 0,this.relativeGap=void 0,void 0!==this.endAbsoluteRequirements){for(var e=this.endAbsoluteRequirements.requirements,t=0,i=e.length;t<i;++t)this.absoluteRequirements.removeIndex(e[t].id);this.endAbsoluteRequirements=void 0}void 0!==this.absoluteRequirements&&(this.absoluteGap=this.absoluteRequirements.getMin().offset+1)}function RequirementList(){this.requirements=[],this.posById=new Map}function requirementListGetSize(){return this.requirements.length}function requirementListAdd(e){if(this.posById.has(e.id))return!1;var t=this.requirements.length;return this.requirements.push(e),this.posById.set(e.id,t),!0}function requirementListRemove(e){var t=this.posById.get(e.id);if(void 0!==t){this.posById.delete(e.id);var i=this.requirements.length-1;if(t!=i){var r=this.requirements[t]=this.requirements[i];this.posById.set(r.id,t)}return--this.requirements.length}}function printOrderTree(e){for(var t="",i=e.first;i;i=i.next)t+=debugGetOrderTreeNodeStr(i),void 0!==i.next&&(t+=",");return t}function printOrderSubTree(e,t){var i="            ";void 0===t&&(t=""),e.left?printOrderSubTree(e.left,t+i):e.right&&console.log(t+i,".");var r=debugGetShortOrderTreeNodeStr(e);console.log(t,r),e.right?printOrderSubTree(e.right,t+i):e.left&&console.log(t+i,".")}function debugGetOrderTreeNodeStr(e){var t;if(void 0!==e.heap){t="H[";for(var i=1,r=e.heap.heap.length;i<r;++i)t+=e.heap.heap[i],i<r-1&&(t+=",");t+="]"}else t=""+e.element;return t}function debugGetShortOrderTreeNodeStr(e){var t;return void 0!==e.heap?(t="H[",t+=e.heap.getMin(),e.heap.getSize()>1&&(t+="-"+e.heap.getMax()),t+="]"):t=""+e.element,t}function debugCheckCompare(e){if(void 0===e.root)return!0;for(var t=e.first;t.next;t=t.next)if(void 0!==t.element)if(void 0!==t.next.element){if(e.compare(t.element,t.next.element)>=0)return concole.log("tree not sorted by comparison function at",debugGetShortOrderTreeNodeStr(t)),!1}else{if(void 0===t.next.heap)return console.log("next node has no element",debugGetShortOrderTreeNodeStr(t)),!1;var i=t.next.heap.getMin();if(e.compare(t.element,i)>=0)return concole.log("tree not sorted by comparison function at",debugGetShortOrderTreeNodeStr(t)),!1}else{if(void 0===t.heap)return console.log("next node has no element",debugGetShortOrderTreeNodeStr(t)),!1;var r=t.heap.getMax();if(void 0!==t.next.element){if(e.compare(r,t.next.element)>=0)return concole.log("tree not sorted by comparison function at",debugGetShortOrderTreeNodeStr(t)),!1}else{if(void 0===t.next.heap)return console.log("next node has no element",debugGetShortOrderTreeNodeStr(t)),!1;var i=t.next.heap.getMin();if(e.compare(r,i)>=0)return concole.log("tree not sorted by comparison function at",debugGetShortOrderTreeNodeStr(t)),!1}}return!0}function OrderService(e){this.FuncResult(e),this.orderTree=new PartialOrderTree(void 0,void 0),this.rangeRequirements=new Map,this.forwardElementRequirements=new Map,this.backwardElementRequirements=new Map,this.pendingMatchUpdates=void 0}function orderServiceDestroy(e){this.doDebugging&&this.debugMessage("destroying order service ",this.id," over ",this.dataObj?"dataObj "+this.dataObj.getId():"no dataObj "," with ",this.orderTree.getSize()," elements"),this.orderTree=void 0,this.FuncResult_destroy()}function orderServiceIsOrder(){return!0}function orderServiceIsActive(){return!1}function orderServiceGetSetSize(){return void 0===this.orderTree?0:this.orderTree.getSize()}function orderServiceRefreshIndexerAndPaths(e){if(this.removeAllMatches(),this.composedActiveNum>0)for(var t in this.composedActive)this.composedActive[t].refreshIndexerAndPaths(this)}function orderServiceReplaceIndexerAndPaths(e,t,i,r){if(this.composedActiveNum>0)for(var n in this.composedActive)this.composedActive[n].replaceIndexerAndPaths(e,t,i,this)}function orderServiceDeactivated(){this.composedActiveNum>0||(this.orderTree.removeAllElements(),this.FuncResult_deactivated())}function orderServiceBecameActiveStar(){var e=this.dataObj.getDominatedComparison();return void 0===e?void this.unsuspend():void this.suspend()}function orderServiceRefreshOrdering(){this.refreshQueued||this.suspend(),this.FuncResult_refreshOrdering()}function orderServiceIsSuspended(){return void 0!==this.pendingMatchUpdates}function orderServiceSuspend(){void 0===this.pendingMatchUpdates&&(this.pendingMatchUpdates=[]),this.refreshQueued||this.qcm.scheduleOrderService(this)}function orderServiceUnsuspend(){var e=!1;if(!this.destroyed){this.setCompareFunc(),this.orderTree.getSize()>1&&(this.orderTree.refreshOrder(),e=!0),this.doDebugging&&this.debugMessage("refreshing order service ",this.id," over ",this.dataObj?"dataObj "+this.dataObj.getId():"no dataObj "," existing elements: ",this.orderTree.getSize());var t=this.pendingMatchUpdates;if(this.pendingMatchUpdates=void 0,void 0!==t&&t.length>0){e=!0;for(var i=0,r=t.length;i<r;++i){var n=t[i];n.isAdd?this.doAddMatches(n.elementIds,n.source):this.doRemoveMatches(n.elementIds,n.source)}}this.refreshOrderResults()}}function orderServiceAddMatches(e,t){return this.isActiveStar()||this.suspend(),this.isSuspended()?void this.pendingMatchUpdates.push({elementIds:e,source:t,isAdd:!0}):(this.setCompareFunc(),this.doAddMatches(e),void this.refreshOrderResults())}function orderServiceAddProjMatches(e,t,i){this.addMatches(e,this.dataObj)}function orderServiceDoAddMatches(e){this.doDebugging&&this.debugMessage("adding ",e.length," elements to order service ",this.id);for(var t=0,i=e.length;t<i;++t)this.orderTree.insertElement(e[t])}function orderServiceRemoveMatches(e,t){return this.isSuspended()?(this.pendingMatchUpdates.push({elementIds:e,source:t,isAdd:!1}),void this.unsuspend()):(this.doRemoveMatches(e),void this.refreshOrderResults())}function orderServiceRemoveProjMatches(e,t,i){this.removeMatches(e,this.dataObj)}function orderServiceDoRemoveMatches(e){this.doDebugging&&this.debugMessage("removing ",e.length," elements from order service ",this.id);for(var t=0,i=e.length;t<i;++t)this.orderTree.removeElement(e[t])}function orderServiceRemoveAllMatches(e){this.orderTree.removeAllElements(),this.refreshOrderResults()}function orderServiceRefreshOrderResults(){this.orderTree.notifyListeners();for(var e in this.composedActive){var t=this.composedActive[e];t.allNotificationsReceived()}}function orderServiceGetDominatedIndexer(){if(void 0!==this.dataObj)return this.dataObj.getDominatedIndexer()}function orderServiceGetDominatedProjPathId(){if(void 0!==this.dataObj)return this.dataObj.getDominatedProjPathId()}function orderServiceGetDominatedProjPathNum(){if(void 0!==this.dataObj)return this.dataObj.getDominatedProjPathNum()}function orderServiceGetTerminalProjMatches(e){return void 0===this.dataObj?[]:this.dataObj.getDominatedMatches()}function orderServiceFilterTerminalProjMatches(e,t){return void 0===this.dataObj?[]:this.dataObj.filterDominatedMatches(t)}function orderServiceGetDomMatchCount(){return 0}function orderServiceGetDominatedMatches(){assert(!1,"this function should never be called")}function orderServiceGetDominatedMatchesAsObj(){assert(!1,"this function should never be called")}function orderServiceFilterDominatedMatches(e){assert(!1,"this function should never be called")}function orderServiceFilterDominatedMatchPositions(e){assert(!1,"this function should never be called")}function orderServiceGetDominatedIdentification(){if(void 0!==this.dataObj)return this.dataObj.getDominatedIdentification()}function orderServiceAddOrderResult(e){this.addComposedFunc(e)}function orderServiceAboutToAddActiveComposed(e,t){e.registerToOrderService()}function orderServiceRemoveOrderResult(e){return this.removeComposedFunc(e.getId()),0!=this.getNumComposedFuncs()}function orderServiceGetRangeRequirement(e){var t=e.getId();if(this.rangeRequirements.has(t))return this.rangeRequirements.get(t);var i=new RangeOrderRequirement(this.orderTree);return i.addListener(e),this.rangeRequirements.set(t,i),i}function orderServiceRegisterRangeRequirement(e,t,i,r,n,o,s){var a=this.getRangeRequirement(e);a.updateOffsets(t,i,r,n,o,s),a.notifyListeners()}function orderServiceUnregisterRangeRequirement(e){var t=e.getId();if(this.rangeRequirements.has(t)){var i=this.rangeRequirements.get(t);i.destroy(),this.rangeRequirements.delete(t)}}function orderServiceRegisterIndexRequirement(e,t,i){var r=i?this.backwardElementRequirements.get(t):this.forwardElementRequirements.get(t);void 0===r&&(r=new ElementOrderService(this.orderTree,t,i),i?this.backwardElementRequirements.set(t,r):this.forwardElementRequirements.set(t,r)),r.addResult(e)}function orderServiceUnregisterIndexRequirement(e,t,i){var r=i?this.backwardElementRequirements.get(t):this.forwardElementRequirements.get(t);void 0!==r&&(r.removeResult(e)||(i?this.backwardElementRequirements.delete(t):this.forwardElementRequirements.delete(t)))}function orderServiceGetRangeMatches(e){var t=this.rangeRequirements.get(e.getId());return void 0===t?[]:t.getMatches()}function orderServiceGetOrderedRangeMatches(e){var t=this.rangeRequirements.get(e.getId());return void 0===t?[]:t.getOrderedMatches()}function orderServiceFilterRangeMatches(e,t){var i=this.rangeRequirements.get(e.getId());return void 0===i?[]:i.filterMatches(t)}function orderServiceSetCompareFunc(){var e=this.dataObj.getDominatedComparison();void 0===e?this.orderTree.updateCompareFunc(function(e,t){return e-t}):this.orderTree.updateCompareFunc(e.getCompareFunc())}function OrderResult(e){this.FuncResult(e),void 0!==debugAllOrderResults&&(debugAllOrderResults[this.id]=this),this.orderService=void 0,this.orderTracing=void 0}function orderResultDestroy(){this.unregisterFromOrderService(),void 0!==this.orderService&&(this.qcm.releaseOrderService(this),this.orderService=void 0),this.FuncResult_destroy(),void 0!==debugAllOrderResults&&delete debugAllOrderResults[this.id]}function orderResultIsOrder(){return!1}function orderResultIsActive(){return void 0!==this.orderTracing}function orderResultAddOrderTracing(e){if(void 0===this.orderTracing)this.orderTracing=[e],this.setOrderTracing(),this.activated();else{for(var t=0,i=this.orderTracing.length;t<i;++t)if(this.orderTracing[t]===e)return;this.orderTracing.push(e)}}function orderResultRemoveOrderTracing(e){if(void 0!==this.orderTracing)if(this.orderTracing.length>1){for(var t=0,i=this.orderTracing.length;t<i;++t)if(this.orderTracing[t]===e)return t<i-1&&(this.orderTracing[t]=this.orderTracing[i-1]),void this.orderTracing.length--}else this.orderTracing[0]===e&&(this.orderTracing=void 0,this.isActiveStar()&&this.setOrderTracing(),this.deactivated())}function orderResultActivated(){this.composedActiveNum>0||(void 0!==this.dataObj&&this.FuncResult_activated(),this.orderService&&(this.orderService.addActiveComposedFunc(this,!1),this.registerToOrderService()))}function orderResultDeactivated(){this.isActiveStar()||(void 0!==this.dataObj&&this.FuncResult_deactivated(),this.orderService&&(this.unregisterFromOrderService(),this.orderService.removeActiveComposedFunc(this.id)))}function orderResultSetData(e){if(void 0===e){if(void 0===this.orderService)return}else if(void 0!==this.orderService&&e===this.orderService.dataObj)return;this.isActiveStar()&&this.unregisterFromOrderService(),this.qcm.releaseOrderService(this),this.orderService=void 0,void 0!==e&&(this.orderService=this.qcm.getOrderService(this,e),this.orderService.addOrderResult(this),this.isActiveStar()&&this.registerToOrderService())}function orderResultSetTerminalData(e,t){return void 0==this.orderService?void this.setData(e):void this.orderService.setTerminalData(e)}function orderResultRefreshIndexerAndPaths(e){if(this.composedActiveNum>0)for(var t in this.composedActive)this.composedActive[t].refreshIndexerAndPaths(this)}function orderResultReplaceIndexerAndPaths(e,t,i,r){if(this.composedActiveNum>0)for(var n in this.composedActive)this.composedActive[n].replaceIndexerAndPaths(e,t,i,this)}function orderResultBecameActiveStar(){this.orderService&&(this.orderService.addActiveComposedFunc(this,!1),this.registerToOrderService())}function orderResultAddDataObjMatches(e,t){assert(!1,"this function should not be called")}function orderResultRemoveDataObjMatches(e,t){assert(!1,"this function should not be called")}function orderResultAddMatches(e,t){assert(!1,"this function should be implemented in the derived class")}function orderResultRemoveMatches(e,t){assert(!1,"this function should be implemented in the derived class")}function orderResultRemoveAllMatches(e){assert(!1,"this function should be implemented in the derived class")}function orderResultAllNotificationsReceived(){}function orderResultGetDominatedIndexer(){if(void 0!==this.orderService)return this.orderService.getDominatedIndexer()}function orderResultGetDominatedProjPathId(){if(void 0!==this.orderService)return this.orderService.getDominatedProjPathId()}function orderResultGetDominatedProjPathNum(){return 1}function orderResultGetTerminalProjMatches(e){assert(!1,"this function should be defined in the derived class")}function orderResultFilterTerminalProjMatches(e,t){assert(!1,"this function should be defined in the derived class")}function orderResultGetDomMatchCount(){return 1}function orderResultGetDominatedMatches(){assert(!1,"this function should be implemented in the derived class")}function orderResultGetDominatedMatchesAsObj(){assert(!1,"this function should be implemented in the derived class")}function orderResultFilterDominatedMatches(e){assert(!1,"this function should be implemented in the derived class")}function orderResultFilterDominatedMatchPositions(e){assert(!1,"this function should be implemented in the derived class")}function orderResultGetOrderedMatches(){assert(!1,"this function should be implemented in the derived class")}function orderResultGetDominatedIdentification(){if(void 0!==this.orderService)return this.orderService.getDominatedIdentification()}function orderResultGetDominatedComparison(){if(void 0!==this.orderService)return this.orderService.getDominatedComparison()}function RangeOrderResult(e){this.OrderResult(e),this.lowOpen=!1,this.highOpen=!1,this.isComplement=!1,this.isBackward=!1,this.offsets=void 0}function rangeOrderResultUpdateOffsets(e,t,i){this.lowOpen=!!t,this.highOpen=!!i,this.isComplement=e[0]<0&&e[1]>=0||e[0]>=0&&e[1]<0,this.isBackward=!this.isComplement&&e[0]<0,this.isComplement?e[0]<0?this.offsets=[e[1],-(1+e[0])]:this.offsets=[e[0],-(1+e[1])]:this.isBackward?this.offsets=[-(1+e[0]),-(1+e[1])]:this.offsets=e.concat(),this.isActiveStar()&&this.registerToOrderService()}function rangeOrderResultSetOrderTracing(){this.isActiveStar()&&this.registerToOrderService()}function rangeOrderResultRegisterToOrderService(){void 0!==this.orderService&&void 0!==this.offsets&&this.orderService.registerRangeRequirement(this,this.offsets,this.isComplement,this.isBackward,this.lowOpen,this.highOpen,void 0!==this.orderTracing)}function rangeOrderResultUnregisterFromOrderService(){void 0!==this.orderService&&void 0!==this.offsets&&this.orderService.unregisterRangeRequirement(this)}function rangeOrderResultAddMatches(e){if(this.composedActiveNum>0)for(var t in this.composedActive)this.composedActive[t].addMatches(e,this)}function rangeOrderResultRemoveMatches(e){if(this.composedActiveNum>0)for(var t in this.composedActive)this.composedActive[t].removeMatches(e,this)}function rangeOrderResultRemoveAllMatches(){if(this.composedActiveNum>0)for(var e in this.composedActive)this.composedActive[e].removeAllMatches(this)}function rangeOrderResultUpdatePos(e,t,i,r){if(void 0!==this.orderTracing)for(var n=0,o=this.orderTracing.length;n<o;++n)this.orderTracing[n].updatePos(e,t,i,r)}function rangeOrderResultGetTerminalProjMatches(e){return void 0===this.orderService?[]:this.orderService.getRangeMatches(this)}function rangeOrderResultFilterTerminalProjMatches(e,t){return void 0===this.orderService?[]:this.orderService.filterRangeMatches(this,t)}function rangeOrderResultGetDominatedMatches(){return void 0===this.orderService?[]:this.orderService.getRangeMatches(this)}function rangeOrderResultGetDominatedMatchesAsObj(){for(var e=this.getDominatedMatches(),t=new Map,i=0,r=e.length;i<r;++i)t.set(e[i],!0);return t}function rangeOrderResultFilterDominatedMatches(e){var t=this.getDominatedMatchesAsObj(),i=[];if(0==t.size)return i;for(var r=0,n=e.length;r<n;++r){var o=e[r];t.has(o)&&i.push(o)}return i}function rangeOrderResultFilterDominatedMatchPositions(e){for(var t=this.getDominatedMatchesAsObj(),i=[],r=0,n=e.length;r<n;++r)t.has(e[r])&&i.push(r);return i}function rangeOrderResultGetOrderedMatches(){return this.orderService?this.orderService.getOrderedRangeMatches(this):[]}function IndexOrderResult(e){this.OrderResult(e),this.resultIndexer=new IdentityIndexer(e),this.rootPathNode=this.resultIndexer.addPath(this.qcm.getRootPathId()),this.resultIndexerQueryCalc=void 0}function indexOrderResultDestroy(){void 0!==this.resultIndexerQueryCalc&&this.resultIndexerQueryCalc.destroy(),this.resultIndexer.destroy(),this.OrderResult_destroy()}function indexOrderResultDeactivated(){this.resultIndexer.clear(),this.OrderResult_deactivated()}function indexOrderResultAddOrderTracing(e){assert(!1,"no order tracing on index order result")}function indexOrderResultRemoveOrderTracing(e){assert(!1,"no order tracing on index order result")}function indexOrderResultSetOrderedData(e){this.OrderResult_setData(e)}function indexOrderResultSetToIndexData(e){this.OrderResult_FuncResult_setData(e)}function indexOrderResultRefreshIndexerAndPaths(e){}function indexOrderResultReplaceIndexerAndPaths(e,t,i,r){}function indexOrderResultAddDataObjMatches(e,t){}function indexOrderResultRemoveDataObjMatches(e,t){var i=void 0===e?void 0:e.getDominatedMatchesAsObj();if(void 0===i||0===i.size)return void this.removeAllMatches();var r=void 0===this.dataObj?void 0:this.dataObj.getDominatedMatchesAsObj(),n=[];r.forEach(function(e,t){i.has(t)||n.push(t)}),n.length>0&&this.removeMatches(n);var o=[];i.forEach(function(e,t){r.has(t)||o.push(t)}),o.length>0&&this.addMatches(o)}function indexOrderResultAboutToAddActiveComposed(e,t){e instanceof InternalQueryResult||void 0!==this.resultIndexerQueryCalc||(this.resultIndexerQueryCalc=new QueryResultQueryCalc(this))}function indexOrderResultActiveComposedFuncRemoved(e){e instanceof InternalQueryResult||void 0===this.resultIndexerQueryCalc||this.composedQueryResultNum==this.composedActiveNum&&(this.resultIndexerQueryCalc.destroy(),this.resultIndexerQueryCalc=void 0)}function indexOrderResultRegisterToOrderService(){if(void 0!==this.orderService){if(void 0!==this.dataObj)for(var e=this.dataObj.getDominatedMatches(),t=0,i=e.length;t<i;++t)this.orderService.registerIndexRequirement(this,e[t],!1)}}function indexOrderResultUnregisterFromOrderService(){if(void 0!==this.orderService&&void 0!==this.dataObj)for(var e=this.dataObj.getDominatedMatches(),t=0,i=e.length;t<i;++t)this.orderService.unregisterIndexRequirement(this,e[t],!1)}function indexOrderResultUpdateOffset(e,t){var i=this.rootPathNode.nodes;i.has(e)?void 0===t?this.resultIndexer.removeNode(this.rootPathNode,e):this.resultIndexer.setKeyValue(this.rootPathNode,e,"number",t,!1):void 0!==t&&(this.resultIndexer.addDataElementNode(this.rootPathNode,e),this.resultIndexer.setKeyValue(this.rootPathNode,e,"number",t,!0))}function indexOrderResultAddMatches(e){if(void 0!==this.orderService)for(var t=0,i=e.length;t<i;++t)this.orderService.registerIndexRequirement(this,e[t],!1)}function indexOrderResultRemoveMatches(e){if(void 0!==this.orderService)for(var t=this.rootPathNode.nodes,i=0,r=e.length;i<r;++i){var n=e[i];this.orderService.unregisterIndexRequirement(this,n,!1),t.has(n)&&this.resultIndexer.removeNode(this.rootPathNode,n)}}function indexOrderResultRemoveAllMatches(){if(void 0!==this.orderService){for(var e=this.dataObj.getDominatedMatches(),t=0,i=e.length;t<i;++t)this.orderService.unregisterIndexRequirement(this,e[t],!1);this.resultIndexer.clear()}}function indexOrderResultRefreshIndexerAndPaths(e){}function indexOrderResultReplaceIndexerAndPaths(e,t,i,r){}function indexOrderResultGetDominatedIndexer(){return this.resultIndexer}function indexOrderResultGetDominatedProjPathId(){return this.qcm.getRootPathId()}function indexOrderResultGetTerminalProjMatches(e){return 0!==e?[]:this.getDominatedMatches()}function indexOrderResultFilterTerminalProjMatches(e,t){return 0!==e?[]:this.filterDominatedMatches(t)}function indexOrderResultGetDominatedMatches(){return this.resultIndexer.getAllMatches(this.qcm.getRootPathId())}function indexOrderResultGetDominatedMatchesAsObj(e){return this.resultIndexer.getAllMatchesAsObj(this.qcm.getRootPathId())}function indexOrderResultFilterDominatedMatches(e){return this.resultIndexer.filterDataNodesAtPath(this.qcm.getRootPathId(),e)}function indexOrderResultFilterDominatedMatchPositions(e){var t=this.resultIndexer.filterDataNodesAtPathPositions(this.qcm.getRootPathId(),e);return t}function indexOrderResultGetValues(e){return this.resultIndexer.getNodeValues(this.qcm.getRootPathId(),e)}function indexOrderResultGetOrderedMatches(){assert(!1,"ordered matches not supported for the index order result")}function setStrictnessLevel(e){void 0!==e&&(strictnessLevel=e)}function getPathAssociation(e,t){for(var i=t,r=0;r<e.length;r++){if(!("next"in i&&e[r]in i.next))return;i=i.next[e[r]]}return i.value}function addPathAssociation(e,t,i){for(var r=i,n=0;n<e.length;n++)"next"in r||(r.next={}),e[n]in r.next||(r.next[e[n]]={}),r=r.next[e[n]];r.value=t}function atomic(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new JavascriptFunction("atomic",e)}function apply(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new JavascriptFunction("apply",e)}function push(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new JavascriptFunction("push",e)}function erase(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new JavascriptFunction("erase",e)}function o(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new MoonOrderedSet(e)}function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new MoonRange(e,!0,!0)}function Rcc(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new MoonRange(e,!0,!0)}function Rco(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new MoonRange(e,!0,!1)}function Roc(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new MoonRange(e,!1,!0)}function Roo(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new MoonRange(e,!1,!1)}function _r(e,t){return new RangeValue([e,t],e!==-(1/0),t!==1/0)}function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new Negation(e)}function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new MoonSubstringQuery(e)}function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new MoonComparisonFunction(e)}function isSimpleType(e){var t=typeof e;return"number"===t||"string"===t||"boolean"===t||"undefined"===t}function isSimpleValue(e){return e instanceof Array?0===e.length||1===e.length&&isSimpleType(e[0]):isSimpleType(e)}function isEmptyOS(e){return void 0===e||e instanceof Array&&0===e.length}function isFalse(e){return void 0===e||e===!1||e instanceof Array&&isFalseValue(e)}function isTrue(e){return void 0!==e&&e!==!1&&!(e instanceof Array&&isFalseValue(e))}function isFalseValue(e){if(void 0!==e)for(var t=0;t<e.length;t++)if(void 0!==e[t]&&e[t]!==!1)return!1;return!0}function isTrueValue(e){if(void 0!==e)for(var t=0;t<e.length;t++)if(void 0!==e[t]&&e[t]!==!1)return!0;return!1}function isCDLFalse(e){return void 0===e||e===!1||e instanceof MoonOrderedSet&&e.os.every(function(e){return isCDLFalse(e)})}function isCDLTrue(e){return isSimpleType(e)?void 0!==e&&e!==!1:!(e instanceof Array)&&(!(e instanceof MoonOrderedSet)||e.os.some(function(e){return isCDLTrue(e)}))}function boolValue(e){return e?constTrueOS:constFalseOS}function toSimpleValue(e){return e instanceof Array?0!==e.length&&(1===e.length?e[0]:e):e}function shallowCopy(e){if(e instanceof Array)return e.slice(0);if(e instanceof NonAV)return e.copy();if("object"==typeof e){var t={};for(var i in e)t[i]=e[i];return t}return e}function deepCopy(e){if(e instanceof NonAV)return e.copy();if(e instanceof Array){dbglvl++;var t=e.map(deepCopy);return dbglvl--,t}if(e instanceof Object){dbglvl++;var i={};for(var r in e)i[r]=deepCopy(e[r]);return dbglvl--,i}return e}function isAV(e){return e instanceof Object&&!(e instanceof NonAV)}function stripArray(e,t){
void 0===t&&(t=!1);var i=e instanceof Array&&1===e.length?e[0]:e,r=void 0,n=!1;if(i instanceof Array){if(t){for(var o=0;o<i.length;o++){var s=stripArray(i[o],!0);s!==i[o]&&(n=!0,void 0===r&&(r=i.slice(0,o))),n&&(r[o]=s)}return n?r:i}return i}if(!isAV(i))return i;r=void 0;for(var a in i){var d=stripArray(i[a],t);d!==i[a]&&(n=!0,void 0===r&&(r=shallowCopy(i))),n&&(r[a]=d)}return n?r:i}function suppressSet(e){var t=e instanceof Array?e[0]:e;if(!isAV(t))return t;var i=void 0;for(var r in t){var n=t[r],o=suppressSet(n);o!==n&&void 0===i&&(i=shallowCopy(t)),void 0!==o&&void 0!==i&&(i[r]=o)}return void 0!==i?i:t}function interpretedBoolMatch(e,t){var i;if(t instanceof Array){if(e instanceof Array&&!(e.length>0)||!isFalse(e)){for(i=0;i<t.length;i++)if(interpretedBoolMatch(e,t[i]))return!0;return!1}return isFalse(t)}switch(typeof e){case"object":if(e instanceof Array){for(i=0;i!==e.length;i++)if(interpretedBoolMatch(e[i],t))return!0;return 0===e.length&&isFalse(t)}if(e===_)return!isFalse(t);if(e instanceof NonAV){if(e instanceof Negation){for(i=0;i!==e.queries.length;i++)if(interpretedBoolMatch(e.queries[i],t))return!1;return!0}return e.match(t)}if(!(t instanceof Object))return!1;for(var r in e)if(!(r in t&&interpretedBoolMatch(e[r],t[r])))return!1;return!0;case"string":case"number":return e===t||t instanceof RangeValue&&t.match(e);case"boolean":return e?isTrue(t):isFalse(t);default:return!1}}function interpretedQuery(e,t){function i(e,t){var r,n,o,s,a;if(e===_)return{sel:!1,res:t};if(t instanceof Array){if(r=[],0===t.length)e instanceof Array&&!(e.length>0)||!isFalse(e)||(n=!0);else for(a=0;a!==t.length;a++)s=i(e,t[a]),void 0!==s&&(r=r.concat(s.res),n=s.sel);return void 0!==n?{sel:n,res:r}:void 0}switch(typeof e){case"object":if(e instanceof Array){if(0===e.length)return isFalse(t)?{sel:!0,res:t}:void 0;if(1===e.length&&e[0]===_)return{sel:!1,res:t};for(r=[],a=0;a!==e.length;a++)if(o=i(e[a],t),void 0!==o){if(o.sel)return{sel:!0,res:t};r=r.concat(o.res)}return 0!==r.length?{sel:!1,res:r}:void 0}if(e instanceof NonAV){if(e instanceof Negation){var d=interpretedQuery(e.queries,t);if(t instanceof Array){if(d.length===t.length)return{sel:!1,res:[]};for(var a=0,u=0,h=[];a<d.length&&u<t.length;)d[a]===t[u]?a++:h.push(t[u]),u++;for(;u<t.length;)h.push(t[u]),u++;return{sel:!0,res:h}}return isFalse(d)?{sel:!0,res:t}:void 0}return e.match(t)?{sel:!0,res:t}:void 0}if(!(t instanceof Object))return;var l,c={sel:!0,res:t},p=0;for(var f in e){if(!(f in t))return;if(void 0!==e[f]){if(o=i(e[f],t[f]),void 0===o)return;if(!o.sel)if(p++,1===p)c.sel=!1,c.res=o.res,l=f;else if(2===p){var v={};v[l]=c.res,v[f]=o.res,c.res=v}else c.res[f]=o}}return c;case"string":case"number":return e===t||t instanceof RangeValue&&t.match(e)?{sel:!0,res:t}:void 0;case"boolean":return(e?isTrue(t):isFalse(t))?{sel:!0,res:t}:void 0;default:return}}var r;if(t instanceof Array){for(var n=[],o=0;o!==t.length;o++)r=i(e,t[o]),void 0!==r&&(n=n.concat(r.res));return n}return r=i(e,t),void 0===r?void 0:r.res}function interpretedQueryWithIdentifiers(e,t,i,r){var n=[];t instanceof Array||(t=[t]);for(var o=0;o!==t.length;o++){var s=interpretedQuery(e,t[o]);void 0!==s&&(n.push(s),r.push(i[o]))}return n}function nrProjSitesInQuery(e){if(e===_)return 1;if(e instanceof Array)return 1===e.length?nrProjSitesInQuery(e[0]):0;if(!(e instanceof Object)||e instanceof NonAV)return 0;var t=0;for(var i in e)t+=nrProjSitesInQuery(e[i]);return t}function queryIsSelection(e){if(e===_)return!1;if(e instanceof Array)return 1!==e.length||queryIsSelection(e[0]);if(!(e instanceof Object)||e instanceof NonAV)return!0;for(var t in e)if(queryIsSelection(e[t]))return!0;return!1}function extractProjectionPaths(e){var t=[];if(e===_)return[[]];if(e instanceof Array){if(1===e.length)return extractProjectionPaths(e[0])}else if(e instanceof Object&&!(e instanceof NonAV)){for(var i in e){var r=extractProjectionPaths(e[i]);void 0!==r&&(t=t.concat(r.map(function(e){return[i].concat(e)})))}return t}}function vstringify(e){if(e instanceof Projector)return"_";if(e instanceof ChildInfo)return e.toString();if(e instanceof BuiltInFunction)return e.name;if(e instanceof MoonRange)return"r("+e.os.map(vstringify).join(", ")+")";if(e instanceof MoonSubstringQuery)return"s("+e.os.map(vstringify).join(", ")+")";if(e instanceof MoonOrderedSet)return"["+e.os.map(vstringify).join(", ")+"]";if(e instanceof Negation)return"n("+e.queries.map(vstringify).join(", ")+")";if(e instanceof RegExp)return e.toString();if(e instanceof NonAV)return e.stringify();if(e instanceof Array)return"["+e.map(vstringify).join(", ")+"]";if(e instanceof Object){var t="";for(var i in e){var r=jsIdentifierRegExp.test(i)&&"class"!==i?i:JSON.stringify(i);0!==t.length&&(t+=", "),t+=r+": "+vstringify(e[i])}return"{"+t+"}"}return safeJSONStringify(e)}function vstringifyLim(e,t){function i(e){if(e instanceof Array){for(var i="",r="",n=0;n<e.length/2&&i.length+r.length<t;n++)i=0===n?String(vstringify(e[n])):i+", "+vstringify(e[n]),n!==e.length-n-1&&(r=0===n?String(vstringify(e[e.length-n-1])):vstringify(e[e.length-n-1])+", "+r);return 0===e.length?"[]":1===e.length?"["+i+"]":"["+i+", "+r+"]"}return vstringify(e)}var r=i(e);return void 0===r?"undefined":r.length<=t?r:r.slice(0,Math.ceil(t/2))+".."+r.slice(r.length-Math.floor(t/2))}function cstringify(e){if(e instanceof Projector)return"_";if(e instanceof ChildInfo)return e.toString();if(e instanceof BuiltInFunction)return e.name;if(e instanceof MoonOrderedSet)return"["+e.os.map(cstringify).join(", ")+"]";if(e instanceof RegExp)return e.toString();if(e instanceof NonAV)return e.toJSON();if(e instanceof Array)return"["+e.map(cstringify).join(", ")+"]";if(e instanceof Object){var t="";for(var i in e){var r=jsIdentifierRegExp.test(i)&&"class"!==i?i:JSON.stringify(i);0!==t.length&&(t+=", "),t+=r+": "+cstringify(e[i])}return"{"+t+"}"}return safeJSONStringify(e)}function flatcdlify(e){return cdlify(e)}function cdlify(e,t){function i(e){return cdlify(e,n)}void 0===t&&(t=void 0);var r=typeof e;if("number"===r||"string"===r||"boolean"===r)return safeJSONStringify(e);if(e instanceof Projector)return"_";if(e instanceof ChildInfo)return e.toString();if(e instanceof BuiltInFunction)return e.name;if(e instanceof RegExp)return e.toString();var n=void 0===t?void 0:t+"  ";if(e instanceof MoonRange)return"r("+e.os.map(i).join(", ")+")";if(e instanceof MoonOrderedSet)return 1===e.os.length?cdlify(e.os[0]):"o("+e.os.map(i).join(", ")+")";if(e instanceof Negation)return"n("+e.queries.map(i).join(", ")+")";if(e instanceof NonAV)return e.stringify();if(e instanceof Array)return 1===e.length?cdlify(e[0],t):"o("+e.map(i).join(", ")+")";if(e instanceof Unquote)return e.str;if(e instanceof Object){var o="";for(var s in e){var a=jsIdentifierRegExp.test(s)&&"class"!==s?s:JSON.stringify(s);0!==o.length?o+=void 0===n?", ":",\n"+n:void 0!==n&&(o+="\n"+n),o+=a+": "+cdlify(e[s],n)}return void 0===t?"{"+o+"}":"{"+o+"\n"+t+"}"}return safeJSONStringify(e)}function cdlifyLim(e,t){if(e instanceof Projector||e instanceof ChildInfo||e instanceof BuiltInFunction||e instanceof Negation||e instanceof NonAV||e instanceof Unquote||!(e instanceof Object)){var i=cdlify(e);return void 0===i?void 0:i.length<=t?i:i.slice(0,Math.ceil(t/2))+".."+i.slice(i.length-Math.floor(t/2))}if(e instanceof Array){for(var r="",n="",o=0;o<e.length/2&&r.length+n.length<t;o++)r=0===o?cdlifyLim(e[o],t/2):r+", "+cdlifyLim(e[o],t/2),o!==e.length-o-1&&(n=0===o?cdlifyLim(e[e.length-o-1],t/2):cdlifyLim(e[e.length-o-1],t/2)+", "+n);return 0===e.length?"[]":1===e.length?r:o<e.length/2?"o("+r+", ..., "+n+")":"o("+r+", "+n+")"}for(var r="",n="",s=Object.keys(e),o=0;o<s.length/2&&r.length+n.length<t;o++){var a=s[o],d=jsIdentifierRegExp.test(a)&&"class"!==a?a:JSON.stringify(a);0!==o&&(r+=", "),r+=d+": "+cdlifyLim(e[a],t/2),o!==s.length-o-1&&(a=s[s.length-o-1],d=jsIdentifierRegExp.test(a)&&"class"!==a?a:JSON.stringify(a),0!==o&&(n=", "+n),n=d+": "+cdlifyLim(e[a],t/2)+n)}return 0===s.length?"{}":1===s.length?"{"+r+"}":o<s.length/2?"{"+r+", ..., "+n+"}":"{"+r+", "+n+"}"}function cdlCompare(e,t){function i(e){return e instanceof Projector?0:e instanceof BuiltInFunction?1:e instanceof Negation?2:e instanceof RangeValue?3:e instanceof SubStringQuery?4:e instanceof ValueReference||e instanceof Unquote?5:e instanceof Array?6:e instanceof Object?7:8}function r(e,t){if(e.length!==t.length)return e.length-t.length;for(var i=0;i<e.length;i++){var r=cdlCompare(e[i],t[i]);if(0!==r)return r}return 0}function n(e,t){if(e.length!==t.length)return e.length-t.length;var i=e.slice(0).sort(cdlCompare),n=t.slice(0).sort(cdlCompare);return r(i,n)}e=getDeOSedValue(e),t=getDeOSedValue(t);var o=i(e),s=i(t);if(o!==s)return o-s;switch(o){case 0:return 0;case 1:return e.name===t.name?0:e.name<t.name?-1:1;case 2:return n(e.queries,t.queries);case 3:return r([e.closedLower,e.closedUpper,e.min,e.max],[t.closedLower,t.closedUpper,t.min,t.max]);case 4:return n(e.strings,t.strings);case 5:return e.compare(t);case 6:return r(e,t);case 7:var a=Object.keys(e).sort(),d=Object.keys(t).sort(),u=r(a,d);if(0!==u)return u;for(var h=0;h<a.length;h++){var l=a[h];if(u=cdlCompare(e[l],t[l]),0!==u)return u}return 0;case 8:return e===t?0:e<t?-1:1}return 0}function cdlifyNormalized(e){if(e instanceof Projector)return"_";if(e instanceof ChildInfo)return e.toString();if(e instanceof BuiltInFunction)return e.name;if(e instanceof MoonRange){var t=e.os.slice(0).sort(cdlCompare);return"r("+t.map(flatcdlify).join(", ")+")"}if(e instanceof MoonOrderedSet)return 1===e.os.length?cdlify(e.os[0]):"o("+e.os.map(flatcdlify).join(", ")+")";if(e instanceof Negation){var i=e.queries.slice(0).sort(cdlCompare);return"n("+i.map(flatcdlify).join(", ")+")"}if(e instanceof NonAV)return e.stringify();if(e instanceof Array)return 1===e.length?cdlify(e[0]):"o("+e.map(flatcdlify).join(", ")+")";if(e instanceof Unquote)return e.str;if(e instanceof Object){for(var r=Object.keys(e).sort(),n="",o=0;o<r.length;o++){var s=r[o],a=jsIdentifierRegExp.test(s)&&"class"!==s?s:JSON.stringify(s);0!==n.length&&(n+=", "),n+=a+": "+cdlify(e[s])}return"{"+n+"}"}return safeJSONStringify(e)}function isUnmergeable(e){return void 0!==e&&(!(e instanceof Object)||!(e instanceof Array)&&!isAV(e)||e instanceof Array&&(1!==e.length||isUnmergeable(e[0])))}function mergeConst(e,t){if(e instanceof Array){if(0===e.length)return e;if(1!==e.length||void 0===t||t instanceof Array&&1!==t.length)return e}else{if(t instanceof Array&&1!==t.length)return e;if(void 0===e)return t}var i=e instanceof Array?e[0]:e,r=t instanceof Array?t[0]:t;if(!isAV(i)||!isAV(r))return e;var n=!0,o={};for(var s in i)if(n=!1,s in r){var a=mergeConst(i[s],r[s]);void 0!==a&&(o[s]=a)}else o[s]=i[s];if(n)return t;for(var s in r)s in i||(o[s]=r[s]);return e instanceof Array?[o]:o}function mergeCopyValue(e,t,i){var r,n;if(void 0===e)return t;if(void 0===t)return e;if(void 0!==i&&i.push===!0)return t instanceof Array?t.concat(e):[t].concat(e);if(e instanceof Array&&t instanceof Array){if(1!==e.length||1!==t.length)return e;r=e[0],n=t[0]}else if(t instanceof Array){if(1!==t.length)return e;r=e,n=t[0]}else if(e instanceof Array){if(1!==e.length)return e;r=e[0],n=t}else r=e,n=t;if(!isAV(r)||!isAV(n))return e;var o=mergeCopyAV(r,n,i);return o===r?e:[o]}function mergeCopyAV(e,t,i){if(!isAV(e)||!isAV(t)||void 0!==i&&i.atomic===!0)return void 0!==e?e:t;var r={},n=!0,o=!1;for(var s in e)if(n=!1,s in t){var a=void 0===i?void 0:i.popPathElement(s),d=mergeCopyValue(e[s],t[s],a);void 0!==d?(r[s]=d,d!==e[s]&&(o=!0)):o=!0}else r[s]=e[s];if(n)return t;for(var s in t)s in e||(r[s]=t[s],o=!0);return o?r:e}function mergeThroughEmptyOCopyValue(e,t,i){function r(e,t,i){if(!isAV(e)||!isAV(t)||void 0!==i&&i.atomic===!0)return void 0!==e?e:t;var r={},n=!0,o=!1;for(var s in e)if(n=!1,s in t){var a=void 0===i?void 0:i.popPathElement(s),d=mergeThroughEmptyOCopyValue(e[s],t[s],a);void 0!==d?(r[s]=d,d!==e[s]&&(o=!0)):o=!0}else r[s]=e[s];if(n)return t;for(var s in t)s in e||(r[s]=t[s],o=!0);return o?r:e}var n,o;if(void 0===e||e instanceof Array&&0===e.length)return t;if(void 0===t||t instanceof Array&&0===t.length)return e;if(void 0!==i&&i.push===!0)return t instanceof Array?t.concat(e):[t].concat(e);if(e instanceof Array&&t instanceof Array){if(1!==e.length||1!==t.length)return e;n=e[0],o=t[0]}else if(t instanceof Array){if(t.length>1)return e;n=e,o=t[0]}else if(e instanceof Array){if(e.length>1)return e;n=e[0],o=t}else n=e,o=t;if(!isAV(n)||!isAV(o))return e;var s=r(n,o,i);return s===n?e:[s]}function normalizePath(e){return e[0]in{children:1,context:1,content:1,param:1}?e:["context"].concat(e)}function updateNormalizedValue(e,t,i){for(var r,n=e,o=0;o<t.length;o++){if(1!==n.length&&(n[0]={}),"object"!=typeof n[0]||n[0]instanceof NonAV)return void Utilities.error("cannot set "+t.join("."));var s=n[0];r=t[o],void 0===s[r]&&(s[r]=[{}]),n=s[r]}n.length=0,Array.prototype.push.apply(n,i)}function vtd(e,t){if(void 0===t)return new ValueTypeDescription(e,void 0,void 0);if(t instanceof ValueTypeDescription)return new ValueTypeDescription(e,void 0,[t]);if(t instanceof Array)return new ValueTypeDescription(e,void 0,t);var i={};for(var r in t)i[r]=t[r]instanceof ValueTypeDescription?[t[r]]:t[r];return new ValueTypeDescription(e,i,void 0)}function addForeignInterface(e){foreignInterfaceObjects=foreignInterfaceObjects.concat(normalizeObject(e))}function wrapForeignInterface(e){var t=new NativeObjectWrapper;return t.foreignInterfaceConstructor=e,t}function arrayEqual(e,t){if(e.length!==t.length)return!1;for(var i=0;i!==e.length;i++)if(!e[i].isEqual(t[i]))return!1;return!0}function array2Equal(e,t){if(void 0===e||void 0===t)return e===t;if(e.length!==t.length)return!1;for(var i=0;i!==e.length;i++)if(!arrayEqual(e[i],t[i]))return!1;return!0}function assert(e,t){e||Utilities.error("assert failure: "+t)}function assertFalse(e,t){assert(!e,t)}function setUnion(e,t){if(void 0===e)return t;if(void 0===t)return e;var i={};for(var r in e)i[r]=e[r];for(var r in t)r in i||(i[r]=t[r]);return i}function subsetOf(e,t){for(var i=0,r=e.keys();i<r.length;i++){var n=r[i];if(!t.has(n))return!1}return!0}function identicalSets(e,t,i){if(e===t)return!0;if(void 0===e||void 0===t)return!1;for(var r=0,n=e.keys();r<n.length;r++){var o=n[r];if(!t.has(o))return!1;if(void 0!==i&&!i(e.get(o),t.get(o)))return!1}for(var s=0,a=t.keys();s<a.length;s++){var o=a[s];if(!e.has(o))return!1}return!0}function objectEqual(e,t){if(e===t)return!0;var i=typeof e,r=typeof t;if(i!==r)return!1;if("object"!==i)return!1;if(e instanceof NonAV)return e.isEqual(t);if(e instanceof RegExp||t instanceof RegExp)return e instanceof RegExp&&t instanceof RegExp&&e.toString()===t.toString();if(e instanceof Array){if(!(t instanceof Array))return!1;if(e.length!==t.length)return!1;for(var n=0;n!==e.length;n++)if(!objectEqual(e[n],t[n]))return!1}else{if(t instanceof NonAV||t instanceof Array)return!1;if(null===e||null===t)return e===t;for(var o in e)if(!(o in t&&objectEqual(e[o],t[o])))return!1;for(var o in t)if(!(o in e))return!1}return!0}function cdlyEqual(e,t){for(;e instanceof Array&&1===e.length;)e=e[0];for(;t instanceof Array&&1===t.length;)t=t[0];if(e===t)return!0;var i=typeof e,r=typeof t;if(i!==r)return!1;if("object"!==i)return!1;if(e instanceof NonAV)return e.isEqual(t);if(e instanceof RegExp||t instanceof RegExp)return e instanceof RegExp&&t instanceof RegExp&&e.toString()===t.toString();if(e instanceof Array){if(!(t instanceof Array))return!1;if(e.length!==t.length)return!1;for(var n=0;n!==e.length;n++)if(!cdlyEqual(e[n],t[n]))return!1}else{if(t instanceof NonAV||t instanceof Array)return!1;if(null===e||null===t)return e===t;for(var o in e)if(!(o in t&&cdlyEqual(e[o],t[o])))return!1;for(var o in t)if(!(o in e))return!1}return!0}function objectCompatible(e,t){if(e===t)return!0;var i=typeof e,r=typeof t;if(i!==r)return!1;if("object"!==i)return!1;if(e instanceof NonAV)return e.isEqual(t);if(e instanceof RegExp||t instanceof RegExp)return e instanceof RegExp&&t instanceof RegExp&&e.toString()===t.toString();if(e instanceof Array){if(!(t instanceof Array))return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!objectCompatible(e[n],t[n]))return!1}else{if(t instanceof NonAV||t instanceof Array)return!1;if(null===e||null===t)return e===t;for(var o in e)if(o in t&&!objectCompatible(e[o],t[o]))return!1}return!0}function valueEqual(e,t){if(e===t)return!0;if(void 0===e||void 0===t)return!1;if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++){var r=e[i],n=t[i];if(r!==n){var o=typeof r,s=typeof n;if(o!==s)return!1;if("object"!==o)return!1;if(r instanceof NonAV){if(!r.isEqual(n))return!1}else{if(n instanceof NonAV)return!1;for(var a in r)if(!(a in n&&valueEqual(r[a],n[a])))return!1;for(var a in n)if(!(a in r))return!1}}}return!0}function sveq(e,t){if(e instanceof Array){for(var i=0;i<e.length;i++)if(e[i]===t||e[i]instanceof RangeValue&&e[i].match(t))return!0;return!1}return e===t||e instanceof RangeValue&&e.match(t)}function svne(e,t){if(e instanceof Array){for(var i=0;i<e.length;i++)if(e[i]!==t&&!(e[i]instanceof RangeValue&&e[i].match(t)))return!0;return 0===e.length}return e!==t&&!(e instanceof RangeValue&&e.match(t))}function svircc(e,t){var i,r=t instanceof Array&&1===t.length?t[0]:t;if(e instanceof Array){if(1!==e.length)return!1;i=e[0]}else i=e;return i.min<=r&&r<=i.max}function svirco(e,t){var i,r=t instanceof Array&&1===t.length?t[0]:t;if(e instanceof Array){if(1!==e.length)return!1;i=e[0]}else i=e;return i.min<=r&&r<i.max}function sviroc(e,t){var i,r=t instanceof Array&&1===t.length?t[0]:t;if(e instanceof Array){if(1!==e.length)return!1;i=e[0]}else i=e;return i.min<r&&r<=i.max}function sviroo(e,t){var i,r=t instanceof Array&&1===t.length?t[0]:t;if(e instanceof Array){if(1!==e.length)return!1;i=e[0]}else i=e;return i.min<r&&r<i.max}function objectCompare(e,t){var i=typeof e,r=typeof t;if(i!==r)return i<r?-1:1;if("object"!=typeof e)return e===t?0:e<t?-1:1;if(e instanceof Array||t instanceof Array){if(!(e instanceof Array&&t instanceof Array))return e instanceof Array?1:-1;if(e.length!==t.length)return e.length<t.length?-1:1;for(var n=0;n!==e.length;n++){var o=objectCompare(e[n],t[n]);if(0!==o)return o}}else{var s=Object.keys(e),a=Object.keys(t);if(s.length!==a.length)return s.length<a.length?-1:1;s.sort(),a.sort();for(var n=0;n!==s.length;n++)if(s[n]!==a[n])return s[n]<a[n]?-1:1;for(var n=0;n!==s.length;n++){var d=s[n],o=objectCompare(e[d],t[d]);if(0!==o)return o}}return 0}function shallowCopyMinus(e,t){var i={};for(var r in e)r!==t&&(i[r]=e[r]);return i}function shallowCopyMinusTree(e,t){function i(e,t,r){for(var n in e)if(n in t){if(t[n]!==!0){var o=i(e[n],t[n],void 0);void 0!==o&&(void 0===r&&(r={}),r[n]=o)}}else void 0===r&&(r={}),r[n]=e[n];return r}return i(e,t,{})}function safeJSONStringify(e){return e===-(1/0)?"-Infinity":e===1/0?"Infinity":"number"==typeof e&&isNaN(e)?'"NaN"':JSON.stringify(e)}function singleton(e){return e instanceof Array&&1===e.length?e[0]:e}function ensureOS(e){return void 0===e?[]:e instanceof Array?e:[e]}function getDeOSedValue(e){return e instanceof Array?0!==e.length&&(1===e.length?e[0]:e):e}function objMap(e,t){var i={};for(var r in e)i[r]=t(e[r],r);return i}function objFilter(e,t){var i={};for(var r in e)t(e[r],r)&&(i[r]=e[r]);return i}function objValues(e){var t=[];for(var i in e)t.push(e[i]);return t}function levenshtein(e,t,i){function r(e,t,i){var r=e<t?e:t;return r<i?r:i}var n,o,s=new Array,a=e.length,d=t.length;if(e==t)return 0;if(0==e.length)return t.length;if(0==t.length)return e.length;for(n=0;n<=a;n++)s[n]=new Array;for(n=0;n<=a;n++)s[n][0]=n;for(o=0;o<=d;o++)s[0][o]=o;for(n=1;n<=a;n++){var u=e.charAt(n-1),h=e.length+t.length;for(o=1;o<=d;o++){var l=t.charAt(o-1);u===l?s[n][o]=s[n-1][o-1]:u.toLowerCase()===l.toLowerCase()?s[n][o]=r(.1+s[n-1][o-1],1+s[n][o-1],1+s[n-1][o]):o>1&&n>1&&u===t.charAt(o-2)&&l===e.charAt(n-2)?s[n][o]=1+r(s[n-2][o-2],s[n][o-1],s[n-1][o]):s[n][o]=1+r(s[n-1][o-1],s[n][o-1],s[n-1][o]),s[n][o]<h&&(h=s[n][o])}if(h>=i)return h}return s[a][d]}function runtimeValueToCdlExpression(e){if(e instanceof Array)return 1===e.length?runtimeValueToCdlExpression(e[0]):new MoonOrderedSet(e.map(runtimeValueToCdlExpression));if(e===_)return e;if(e instanceof NonAV)return e.toCdl();if(e instanceof Object){var t={};for(var i in e)t[i]=runtimeValueToCdlExpression(e[i]);return t}return e}function deOsedMerge(e,t){if(e=singleton(e),t=singleton(t),"undefined"==typeof e)return t;if("object"!=typeof e||"object"!=typeof t||e instanceof Array||t instanceof Array)return e;var i={};for(var r in e){var n=r in t?deOsedMerge(e[r],t[r]):e[r];void 0===n||n instanceof Array&&0===n.length||(i[r]=n)}for(var r in t)if(!(r in e)){var n=t[r];void 0===n||n instanceof Array&&0===n.length||(i[r]=n)}return i}function groupResultById(e,t,i){if(void 0!==e&&void 0!==e.value&&0!==e.value.length)for(var r=0,n=e.value,o=e.identifiers;r<o.length;){var s=o[r];if(void 0===n[r])for(t.push(void 0),r++;r<o.length&&o[r]===s;)r++;else{for(var a=[];r<o.length&&o[r]===s;)a.push(n[r]),r++;t.push(a)}void 0!==i&&i.push(s)}}function repeatId(e,t,i){for(var r=0;r<i;r++)e.push(t)}function mapByIdentity(e){for(var t=new Map,i=0;i!==e.length;i++)for(var r=e[i].value,n=e[i].identifiers,o=0;o<r.length;o++)t.has(n[o])||t.set(n[o],[]),t.get(n[o]).push(r[o]);return t}function splitByIdentity(e){for(var t=new Map,i=0;i!==e.length;i++)for(var r=e[i].value,n=e[i].identifiers,o=0;o<r.length;o++)t.has(n[o])||t.set(n[o],e.map(function(e){return[]})),t.get(n[o])[i].push(r[o]);return t}function normalizeObject(e){var t;e instanceof Array||(e=[e]),t=[];for(var i=0;i!==e.length;i++)if(e[i]instanceof MoonRange)t.push(new RangeValue(e[i].os,e[i].closedLower,e[i].closedUpper));else if(e[i]instanceof MoonComparisonFunction)t.push(new ComparisonFunctionValue(e[i].elements));else if(e[i]instanceof MoonOrderedSet)t=cconcat(t,e[i].os.map(normalizeObject));else if(e[i]instanceof Array)t=cconcat(t,e[i].map(normalizeObject));else if(e[i]instanceof NonAV)t.push(e[i]);else if(e[i]instanceof Object){var r=void 0;for(var n in e[i]){var o=normalizeObject(e[i][n]);0!==o.length&&(void 0===r&&(r={}),r[n]=o)}void 0!==r&&t.push(r)}else void 0!==e[i]&&t.push(e[i]);return t}function binarySearchMin(e,t,i){for(var r=binarySearch(e,t,i);r>0&&0===i(e[r-1],t);)r--;return r}function binarySearchMax(e,t,i){var r=binarySearch(e,t,i);if(r>=0)for(;r<e.length-1&&0===i(e[r+1],t);)r++;return r}function countObjSize(e,t){if(void 0===e)return 0;if("object"!=typeof e||e instanceof NonAV||e instanceof RegExp)return 1;if(e instanceof Array){if(t){for(var i=0,r=0;r!==e.length;r++)i+=countObjSize(e[r],!0);return i}return e.length}if(t){var n=1;for(var o in e)n*=countObjSize(e[o],!0);return n}return 1}function printObjAsTree(e,t,i){if(void 0===t&&(t=""),void 0===i&&(i=999999),e instanceof Array||e instanceof NonAV)return e.toString()+"\n";if(!(e instanceof Object))return String(e)+"\n";for(var r,n=Object.keys(e).sort(function(e,t){var i=Number(e),r=Number(t);return isNaN(i)||isNaN(r)?isNaN(i)?isNaN(r)?e<t?-1:e===t?0:1:1:-1:i-r}),o="",s=0;s<n.length;s++){var a=n[s],d=e[a],u=s<n.length-1?" ":" ";if(d instanceof Array||d instanceof NonAV)o+=t+u+a+":"+d.toString()+"\n";else if(d instanceof Object){s===n.length-1?r=t+"    ":void 0===r&&(r=t+"|   ");var h=t.length+4;if(h+a.length<i)o+=t+u+a;else{var l=Math.max(25,i-h);o+=t+u+a.slice(0,l)}o+="\n"+printObjAsTree(d,r,i)}else o+=t+u+a+":"+String(d)+"\n"}return o}function extractBaseName(e){var t=e.lastIndexOf("/");t===-1&&(t=e.lastIndexOf("\\")),t!==-1&&(e=e.substr(t+1));var i=e.match(/\.[a-z]+$/);return null!==i&&(e=e.substr(0,e.length-i[0].length)),e}function extractExtension(e){var t=e.lastIndexOf(".");return t===-1?"":e.slice(t+1)}function combineFilePath(e,t){if("/"===t.charAt(0))return"file://"+t;for(var i=e,r=t;"."===r.charAt(0);)if("."===r.charAt(1)&&"/"===r.charAt(2)){var n=i.lastIndexOf("/",i.length-2);r=r.slice(3),i=i.slice(0,n+1)}else{if("/"!==r.charAt(1))break;r=r.slice(2)}return i+r}function removeEmptyOSFromAV(e){if(e instanceof Array)return e.map(removeEmptyOSFromAV);if("object"!=typeof e||null===e||e instanceof NonAV)return e;var t={};for(var i in e){var r=e[i];void 0===r||r instanceof Array&&0===r.length||(t[i]=removeEmptyOSFromAV(r))}return t}function allValuesIdentical(e){for(var t=1;t<e.length;t++)if(e[t]!==e[0])return!1;return!0}function compareSimpleValues(e,t){var i=typeof e,r=typeof t;return i!==r?i<r?-1:i===r?0:1:"number"===i?e-t:e<t?-1:e===t?0:1}function getUniqueValues(e){function t(e){var t=Math.log10(e),i=Math.floor(t),r=(Math.pow(10,i)*(9*i-1)+1)/9+1;return((e-Math.pow(10,i))*Math.ceil(t)+r)/e}for(var i=new Map,r=0,n=0,o=0;o<e.length;o++){var s=e[o],a=i.get(s);i.set(s,void 0===a?1:a+1)}if(!(2*i.size>=e.length||(i.forEach(function(e,t){var i=String(t).length;r+=i+1,n+=i*e}),r+=e.length*(t(i.size)+1),r>=n))){var d=[];return i.forEach(function(e,t){d.push(t)}),d.sort(compareSimpleValues)}}function compressRawData(e,t){for(var i=[],r=0,n=0,o=void 0,s=0;s<e.length;s++){var a=e[s];if(void 0!==a){if(void 0!==t&&(a=binarySearch(t,a,compareSimpleValues)),void 0===o||s-3>r)o=[],i.push({o:s,v:o}),n=s;else if(s-1!==r)for(;s-1!==r;)o.push(null),r++;o[s-n]=a,r=s}}return i}function decompressRawData(e,t){var i=[];if(void 0===t)for(var r=0;r<e.length;r++)for(var n=e[r].o,o=e[r].v,s=0;s<o.length;s++){var a=o[s];void 0!==a&&null!==a&&(i[n+s]=a)}else for(var r=0;r<e.length;r++)for(var n=e[r].o,o=e[r].v,s=0;s<o.length;s++){var a=o[s];void 0!==a&&null!==a&&(i[n+s]=t[a])}return i}function nextTaskId(){return++taskLastId}function initTaskQueue(){globalTaskQueue=new TaskQueue,taskLastId=0,gArgParser.getArg("noYield",!1)&&(globalTaskQueue.iterationTimeout=15e4)}function timedExecutePendingTasks(){return mondriaMutex?void console.log("suppressing re-entrancy"):(mondriaMutex=!0,debugTotalTimeStop("timed-out task delay"),debugObjCache&&resetDebugObjCache(),debugStartTimer("task queue","task queue"),globalTaskQueue.executePendingTasks(!0),debugStopTimer("task queue"),debugTotalTimeStart("timed-out task delay"),void(mondriaMutex=!1))}function yieldToBrowser(){globalTaskQueue.yieldToBrowser||(debugTasks&&console.log("requesting yielding to browser"),globalTaskQueue.yieldToBrowser=!0,globalTaskQueue.clearNextIteration())}function tasksInQueue(){return!globalTaskQueue.pendingTasks.isEmpty()}function scheduleDisplayQueryRecalculation(){nDisplayQueryRecalc>0&&DisplayOffsetSurveyor.pollAllSurveyor(nDisplayQueryRecalc>=maxDisplayQueryRecalc),nDisplayQueryRecalc<maxDisplayQueryRecalc&&(nDisplayQueryRecalc++,setTimeout(scheduleDisplayQueryRecalculation,displayQueryRecalcTime),displayQueryRecalcTime*=displayQueryRecalcTimeFactor)}function forceTaskExecution(){forcedSchedule=!0,globalContentTask.schedule(),globalGeometryTask.schedule(),globalPreWriteNotificationTask.schedule(),globalCommitWritesTask.schedule(),globalDebuggerTask.schedule(),forcedSchedule=!1}function resetBlockTaskLoop(){blockTaskLoop=!1,gContentPositionCycleCount=0,forceTaskExecution()}function resumeTaskProcessing(){possibleLoopDetected=!1,clearAreaCreationState(),resetBlockTaskLoop()}function scheduleContentTask(){globalContentTask.schedule()}function runGeometry(){globalPosConstraintSynchronizer.flushBuffer(),globalPos.reposition(void 0),globalAbsolutePosManager.refreshPos(),globalPos.clearSolutionChanges()}function scheduleGeometryTask(){globalGeometryTask.schedule()}function scheduleTestTask(){globalTestTask.schedule()}function scheduleRemotingTask(){globalRemotingTask.schedule()}function scheduleIndexerGarbageCollectionTask(){globalIndexerGarbageCollectionTask.schedule()}function scheduleEventQueue(){globalNextQueuedEvent.schedule()}function suspendScheduledTasks(){0===gNumberSuspends&&(showRunningDivNow(),globalTaskQueue.suspend(),evaluationQueue.suspend()),gNumberSuspends++}function resumeScheduledTasks(){gNumberSuspends--,0===gNumberSuspends&&(evaluationQueue.resume(),globalTaskQueue.resume(),globalPosConstraintSynchronizer.isEmpty()&&!globalPos.needToRefresh()||(globalGeometryTask.isScheduled=!1,globalGeometryTask.schedule()),evaluationQueue.isEmpty(0)||(globalContentTask.isScheduled=!1,globalContentTask.schedule()))}function breakIntoDebugger(){allAreaMonitor.forceTempUpdate()}function signalRuntimeException(e){console.log("exception:",e),runTests&&endTest(1),allAreaMonitor.forceTempUpdate()}function getNextWatcherId(){return nextWatcherId++}function addPointer(e){gPointerById[e.pointerID]={pointer:e,elementRef:new ElementReference("p"+e.pointerID)}}function removePointer(e){delete gPointerById[e.pointerID]}function getPointerRef(e){return e in gPointerById?gPointerById[e].elementRef:void 0}function queueEvent(e,t,i,r,n,o,s,a,d,u,h){assert(e,"event must be defined"),assert(void 0===t||t instanceof Object&&!(t instanceof Array),"debugging"),assert(void 0===i||i instanceof Array,"debugging"),assert(r instanceof Array,"debugging"),assert(void 0===n||n instanceof MondriaPointer,"debugging"),assert(void 0===s||s instanceof Array||s instanceof FileList,"debugging"),assert(void 0===a||a instanceof Array,"debugging"),debugLogEvent("message")&&console.log("queue event",e.type,cdlify(t)),lastEventType=e.type,globalEventQueue.addEvent(new QueuedEvent(e.timeStamp,e,e.type,"mouseup"===e.type,t,i,r,a,n,s,o,d,u,h))}function queueCancelEventsOfType(e){globalEventQueue.cancelEventsOfType(e)}function clearEventQueue(){globalEventQueue.clear()}function abortMessagePropagation(e,t){globalEventQueue.abortEvent(e,t)&&debugLogEvent("message")&&console.log("event propagation aborted by",e)}function postInputParamChangeEvent(e,t,i){var r={type:["InputChange"],time:[Date.now()]},n=[{recipient:e,relX:0,relY:0}];gDomEvent.recordComment("inputChange"),queueEvent(new ImpersonatedDomEvent("inputchange"),r,void 0,[e],void 0,n,constEmptyOS,void 0,i,t)}function printTiming(){gProfile&&(console.log("\nExpression statistics per template"),console.log(exprStatPerTemplate()),console.log("\nExpression statistics per area"),console.log(exprStatPerArea()),console.log("\nExpression statistics per type"),console.log(exprStatPerType()),console.log("\nExpression statistics per prototype"),console.log(exprStatPerPrototype()),console.log(""),resetExprStat())}function executeNextTestTask(){return"undefined"==typeof gTestRunner&&(gTestRunner=new TestRunner(createTestList())),gTestRunner.execute()}function endTest(e){"undefined"==typeof e&&(e=1),printTiming(),"undefined"!=typeof process?process.exit(e):(runTests=!1,testDurationGuardTime=void 0)}function enqueueImpersonatedMouseEvent(e,t,i,r,n){function o(e,o){void 0===o&&(o=void 0);var s=new ImpersonatedMouseDomEvent(e,o,i,r,t,n);gTestRunner.enqueueDOMEvent(s)}switch(o("MouseMove"),e){case"MouseMove":break;case"MouseDown":o("MouseDown"),o("MouseGestureExpired","Click");break;case"MouseUp":o("MouseUp");break;case"MouseClick":o("MouseDown"),o("MouseUp","Click"),o("MouseGestureExpired","DoubleClick");break;case"MouseClickPlusDown":o("MouseDown"),o("MouseUp","Click"),o("MouseDown"),o("MouseGestureExpired","DoubleClick");break;case"MouseDoubleClick":o("MouseDown"),o("MouseUp","Click"),o("MouseDown"),o("MouseUp","DoubleClick");break;default:Utilities.error("unsupported event: "+e)}}function enqueueImpersonatedDropEvent(e,t,i,r,n){var o=new ImpersonatedDropEvent(e,t,i,r,n);gTestRunner.enqueueDOMEvent(o)}function enqueueImpersonatedKeyEvent(e,t,i,r){var n=new ImpersonatedKeyDomEvent(e,t,i,r);gTestRunner.enqueueDOMEvent(n)}function getClassPath(e){for(var t=[],i="screenArea";0!==e;){var r=gClassPathTree[e],n=gClassNameDebugStrings[r[1]]+":{"+gClassQualifierDebugStrings[r[2]]+"}";""!==gClassPathDebugStrings[r[3]]&&(n+="."+gClassPathDebugStrings[r[3]]),t.push(n),e=r[0]}for(var o=t.length-1;o>=0;o--){var s={};s[t[o]]=i,i=s}return i}function getDeepestDefiningClass(e){if(0!==e)return gClassNameDebugStrings[gClassPathTree[e][1]]}function getLCE(e,t){for(var i=e.getEmbeddingDepth(),r=t.getEmbeddingDepth(),n=Math.min(i,r);i>n;)e=e.embedding,i--;for(;r>n;)t=t.embedding,r--;for(;n>0&&e!==t;)e=e.embedding,t=t.embedding,n--;return e}function getCssLengthInPixels(e,t){
if(e=getDeOSedValue(e),"number"==typeof e)return Math.round(e);if("string"==typeof e){var i=e.match(cssLengthRegEx);if(i){var r=Number(i[1]);switch(i[2]){case"%":return;case"":case"px":return r;case"pt":return;case"pc":return;case"em":return;case"ex":return;case"ch":return;case"in":return;case"cm":return;case"mm":return;default:return}}}}function removeFromPosList(e,t,i){t.splice(e,1);for(var r=e;r<t.length;r++)i[t[r]]=r}function checkAreaCreationCycle(){function e(e,t){for(var i=0,r=0,n=[];i<e.length&&r<t.length;)e[i]===t[r]?(i++,r++):e[i]<t[r]?(n.push("-"+e[i]),i++):(n.push("+"+t[r]),r++);for(;i<e.length;)n.push("-"+e[i]),i++;for(;r<t.length;)n.push("+"+t[r]),r++;return n.join(" ")}var t=Object.keys(allAreaMonitor.allAreas).sort(),i=t.join(",");if(areaChangeCounter!==lastAreaChangeCounter){if(lastAreaChangeCounter=areaChangeCounter,void 0===areaStates&&(areaStates={},areaStateHistory=[]),""!==i&&i in areaStates){console.log("area creation cycle starting at",areaStates[i],"of length",areaStateHistory.length-areaStates[i]);for(var r=areaStates[i];r<areaStateHistory.length;r++){var n=areaStateHistory[r],o=r+1<areaStateHistory.length?areaStateHistory[r+1]:t;console.log("state",r,":",e(n,o))}breakIntoDebugger()}areaStates[i]=areaStateHistory.length,areaStateHistory.push(t)}}function clearAreaCreationState(){void 0!==areaStates&&(areaStates=void 0,areaStateHistory=void 0)}function verifyTypeEquality(e,t,i){e.valueType.isEqual(t.valueType)||Utilities.warnOnce(i+": "+e.idStr()+", "+t.idStr())}function ensureTemplateDependency(e,t,i){e.expressionsHaveBeenCached===!1&&(void 0!==e.parent&&e.parent.expressionsHaveBeenCached===!1&&ensureTemplateDependency(e.parent,t,i),e.walkFunctionNodes(!1,t,i))}function initAreaTemplate(){areaTemplates.push(void 0),_gd()}function getLevelDifference(e,t,i){var r=templateDifferenceMaps[i?0:1],n=r[e];if(void 0!==n){if(t in n)return n[t]}else r[e]=n={};for(var o=0,s=areaTemplates[e],a=areaTemplates[t];s!==a&&void 0!==s;){if(i&&s.embeddingInReferred){s=void 0;break}s=s.parent,o++}return n[t]=void 0===s?void 0:o}function printAppStateChanges(e){function t(e,t){var i=ensureOS(e),r=ensureOS(t),n=i.filter(function(e){return r.every(function(t){return!objectEqual(e,t)})}),o=r.filter(function(e){return i.every(function(t){return!objectEqual(t,e)})});return cdlify({add:o,remove:n})}for(var i={},r=0;r<e.length;r++){var n=e[r],o=n.areaId+"."+n.path.join("."),s=n.value,a=o in i?t(i[o],s):cdlify({init:s});console.log(o,a),i[o]=n.value}}function dataSourceGetSubtractionKey(e,t,i){return void 0!==e&&e.has(i)?e.get(i):t.get(i)}function dsRunCondRemove(){for(var e=0;e<dsRemoveQueue.length;e++){var t=dsRemoveQueue[e];void 0!==t&&t.conditionalDestroy()}assert(dsRemoveQueue.every(function(e){return void 0===e}),"expecting all to have been removed"),dsRemoveQueue=[]}function makeSizeDSFunction(e,t,i){return new SizeDSFunction(e,t,i)}function makeNotDSFunction(e,t,i){return new NotDSFunction(e,t,i)}function makeNotEmptyDSFunction(e,t,i){return new NotEmptyDSFunction(e,t,i)}function makeSumDSFunction(e,t,i){return new SumDSFunction(e,t,i)}function makeMinDSFunction(e,t,i){return new MinDSFunction(e,t,i)}function makeMaxDSFunction(e,t,i){return new MaxDSFunction(e,t,i)}function makeBoolDSFunction(e,t,i){return new BoolDSFunction(e,t,i)}function makeSingleValueDSFunction(e,t,i){return new SingleValueDSFunction(e,t,i)}function makeChangeCountDSFunction(e,t,i){return new ChangeCountDSFunction(e,t,i)}function makeChangeInformerFunction(e,t,i){return new ChangeInformerFunction(e,t,i)}function accuquery(e){function t(e){var i;return i=void 0!==e.function?"SELECT "+e.function.toUpperCase()+"(*)":void 0!==e.projections?"undefined"in e.projections?"SELECT DISTINCT *":"SELECT "+Object.keys(e.projections).join(", "):"SELECT *",void 0!==e.selection&&(i+=" WHERE "+e.selection.join(" AND ")),void 0!==e.sort&&(i+=" ORDER BY "+e.sort),void 0!==e.position&&(i+=" LIMIT "+e.position),void 0!==e.from&&(i+="string"==typeof e.from?" FROM "+e.from:" FROM ("+t(e.from)+")"),i}return t(e.accumulatedQuery())}function debugIterate(e,t){for(var i=e instanceof MoonOrderedSet?e.os:e instanceof Array?e:[e],r=0;r<i.length;r++)t(i[r],r)}function contextTrace(e,t){return void 0!==gDomEvent&&""!==e&&void 0===allAreaMonitor.getAreaById(e)&&console.log("no such area:",e),gContextAttributeTracer.isBeingTraced(e,t)?void console.log("already being traced"):void gContextAttributeTracer.addTraceFor(e,t)}function contextUntrace(e,t){return gContextAttributeTracer.isBeingTraced(e,t)?void gContextAttributeTracer.removeTraceFor(e,t):void console.log("not being traced")}function setDebugBreak(e,t,i){if("string"==typeof e&&void 0===t&&void 0===i){var r=e.split(":");e=r[0]+":"+r[1],t=r[2],i=r[3]}debugIterate(e,function(e,r){e===_&&(e="_"),e in areaDebugBreaks||(areaDebugBreaks[e]={}),debugIterate(t,function(t,r){t===_&&(t="_"),t in areaDebugBreaks[e]||(areaDebugBreaks[e][t]={}),debugIterate(i,function(i,r){i===_&&(i="_"),areaDebugBreaks[e][t][i]=!0})})})}function clearDebugBreak(e,t,i){debugIterate(e,function(e,r){e===_&&(e="_"),e in areaDebugBreaks&&debugIterate(t,function(t,r){t===_&&(t="_"),t in areaDebugBreaks[e]&&debugIterate(i,function(i,r){i===_&&(i="_"),delete areaDebugBreaks[e][t][i]})})})}function shouldDebugBreak(e,t,i){if(!(e in areaDebugBreaks)){if(!("_"in areaDebugBreaks))return!1;e="_"}if(!(t in areaDebugBreaks[e])){if(!("_"in areaDebugBreaks[e]))return!1;t="_"}return i in areaDebugBreaks[e][t]?areaDebugBreaks[e][t][i]:"_"in areaDebugBreaks[e][t]}function setGlobalDefault(e,t,i){if("string"!=typeof e||0===e.length)return void console.log("path must be a non-empty string");if("undefined"==typeof globalDefaultsNodeIndex)return void console.log("application doesn't use global defaults");for(var r=e.split("."),n=[new DataPosition(0,1)],o=globalEvaluationNodes[globalDefaultsNodeIndex],s=new Result(normalizeObject(t)),a=new MergeAttributes("push"===i,"atomic"===i,"erase"===i).extendWithPath(r),d=new PositionChangeTracker,u=r.length-1;u>=0;u--)n=[new DataPosition(0,1,[r[u]],n)];o.write(s,WriteMode.merge,a,n),gGlobalDefaultChangeList=determineWrite(gGlobalDefaultChangeList,s,WriteMode.merge,a,n,d),gGlobalDefaultChangeList[e]=t,evaluationQueue.releaseLatched(),o.isActive()||o.eval()}function getGlobalDefaults(){var e=globalEvaluationNodes[globalDefaultsNodeIndex];console.log(cdlify(e.result.value,""))}function printGlobalDefaultChanges(){console.log(cdlify(gGlobalDefaultChangeList,""))}function areaHierarchy(e){function t(e,t){var i=allAreaMonitor.getAreaById(e.getElement()),r=i.comment.slice(i.comment.lastIndexOf(":")+1),n=allAreaMonitor.getAreaById(t.getElement()),o=n.comment.slice(n.comment.lastIndexOf(":")+1);return r<o?-1:r>o?1:i.areaId<n.areaId?-1:1}void 0===e&&(e=allAreaMonitor.getAreaById("1:1"));var i={},r=areaRelationMonitor.getRelation(e.areaId,"embedded").slice(0);r.sort(t);for(var n=0;n!==r.length;n++){var o=r[n].getElement(),s=allAreaMonitor.getAreaById(o),a=o+"("+s.tAreaId+") "+s.comment;i[a]=areaHierarchy(s)}return i}function sortAreaIds(e){return e.map(function(e){var t=e.split(":");return{t:Number(t[0]),e:Number(t[1]),id:e}}).sort(function(e,t){return e.t!==t.t?e.t-t.t:e.e-t.e}).map(function(e){return e.id})}function printAllDataSourceApplicationTrees(e){function t(r,n){for(var o=0;o<n.length;o++){var s=n[o];if(s&&s instanceof EvaluationFunctionApplication&&("datatable"===s.bif.name||"database"===s.bif.name)&&void 0!==s.result.dataSource&&(i[s.prototype.idStr()+": "+s.prototype.toString()]=s.result.dataSource.dumpApplicationStructure(e)),s instanceof EvaluationApply)void 0!==s.environment&&t(r,s.environment.cache);else if((s instanceof EvaluationMap||s instanceof EvaluationFilter||s instanceof EvaluationMultiQuery)&&void 0!==s.environments)for(var a=0;a<s.environments.length;a++)t(r,s.environments[a].cache)}}var i={};void 0===e&&(e=!0),t("global",globalEvaluationNodes);for(var r=sortAreaIds(Object.keys(allAreaMonitor.allAreas)),n=0;n<r.length;n++){var o=r[n],s=allAreaMonitor.allAreas[o];t(o,s.evaluationNodes[0])}return i}function printAllDataSourceApplications(){for(var e in debugDataSourceObject){var t=debugDataSourceObject[e];if(t instanceof DataSourceComposable){var i=String(t.id)+" "+t.debugInfo()+" ->";t.dataQueryDSMap&&t.dataQueryDSMap.forEach(function(e,t){e.forEach(function(e,t){i+=" query:"+String(e.id)})}),t.functionDSMap&&t.functionDSMap.forEach(function(e,t){i+=" func:"+String(e.id)}),t.orderingDSMap&&t.orderingDSMap.forEach(function(e,t){i+=" ordering:"+String(e.id)}),t.sortDSMap&&t.sortDSMap.forEach(function(e,t){i+=" sort:"+String(e.id)}),t.elementIdQueryDSMap&&t.elementIdQueryDSMap.forEach(function(e,t){i+=" elemId:"+String(e.id)}),t.identityDSMap&&t.identityDSMap.forEach(function(e,t){i+=" id:"+String(e.id)}),t.elementIdTransformationMapDSMap&&t.elementIdTransformationMapDSMap.forEach(function(e,t){i+=" idTransform:"+String(e.id)}),t.mergeUnderIdentityWithPathDSMap&&t.mergeUnderIdentityWithPathDSMap.forEach(function(e,t){i+=" muiwp:"+String(e.id)}),t.dataSourceMultiplexer&&(i+=" multiplex:"+String(t.dataSourceMultiplexer.id)),t.indexQueryDSMap&&t.indexQueryDSMap.forEach(function(e,t){i+=" index:"+String(e.id)}),console.log(i)}}}function Av_(e){for(var t=allAreaMonitor.getAreaById(e),i=t.evaluationNodes[0],r=i.filter(function(e){return e instanceof EvaluationQualifiers}),n={},o=[],s=0;s<r.length;s++)for(var a=r[s],d=0;d<a.qualifiedVariants.length;d++)if(a.qualifiedVariants[d]){var u=a.prototype.qualifiers[d],h="{"+u.map(function(e){var t=getLevelDifference(a.prototype.localToArea,e.localToArea,!0);return 0===t?e.originalAttribute+":"+cdlify(e.originalValue):e.originalAttribute+"/"+t+":"+cdlify(e.originalValue)}).join(", ")+"}";h in n||(n[h]=1,o.push(h))}return o.sort()}function printAllActiveVariants(){for(var e in allAreaMonitor.allAreas){var t=allAreaMonitor.allAreas[e],i=Av_(e);console.log(String(t.template.id)+"\t"+t.areaId+"\t"+i.join("\t"))}}function getATDBIAttr(e,t){return void 0!==e&&"next"in e&&t in e.next?e.next[t]:void 0}function mergeValueOverwrite(e,t){if(e instanceof Array){if(0===e.length)return[];if(1!==e.length||void 0===t||t instanceof Array&&1!==t.length)return e}else if(t instanceof Array&&1!==t.length)return e;var i=e instanceof Array?e[0]:e,r=t instanceof Array?t[0]:t;if(!isAV(i)||!isAV(r))return e;for(var n in i)n in r&&(i[n]=mergeValueCopy(i[n],r[n]));for(var n in r)n in i||(i[n]=r[n]);return e}function mergeValueCopy(e,t){if(e instanceof Array){if(0===e.length)return[];if(1!==e.length||void 0===t||t instanceof Array&&1!==t.length)return e}else if(t instanceof Array&&1!==t.length)return e;var i=e instanceof Array?e[0]:e,r=t instanceof Array?t[0]:t;if(!isAV(i)||!isAV(r))return e;var n=!0,o=!1,s={};for(var a in i)if(n=!1,a in r){var d=mergeValueCopy(i[a],r[a]);void 0!==d?(s[a]=d,d!==i[a]&&(o=!0)):o=!0}else s[a]=i[a];if(n)return t;for(var a in r)a in i||(s[a]=r[a],o=!0);return o?[s]:e}function dsaw_add(e,t,i){t in e?e[t]+=i:e[t]=i}function dsaw_sub(e,t,i){assert(e[t]>=i,"debugging"),e[t]-=i,0===e[t]&&delete e[t]}function getEvaluationNode(e,t){if(void 0!==e){if(0!==e.localToDefun)return t.evaluationNodes[e.localToDefun][e.id];if(!e.localToArea)return void 0===globalEvaluationNodes[e.id]&&buildEvaluationNode(FunctionNode.globalFunctionNodes[e.id],globalEvaluationEnv),globalEvaluationNodes[e.id];for(var i=t;i.template.id!==e.localToArea||i.localToDefun!==e.localToDefun;)i=i.getParent();return void 0===i.evaluationNodes[0][e.id]&&buildEvaluationNode(e,i),i.evaluationNodes[0][e.id]}}function allQualifiersHold(e){for(var t=0;t!==e.length;t++)if(!e[t].holds())return!1;return!0}function compareKeys(e,t,i){for(var r=0;r<i.length;r++){var n=0;if(void 0===e.key[r]||void 0===t.key[r]){if(n=void 0!==e.key[r]?-1:void 0!==t.key[r]?1:0,0!==n)return n}else if(e.key[r].type!==t.key[r].type){if("undefined"===e.key[r].type)return"undefined"===t.key[r].type?0:1;if("undefined"===t.key[r].type)return-1;n=e.key[r].type<t.key[r].type?-1:1}else"number"===e.key[r].type?n=e.key[r].value-t.key[r].value:e.key[r].value!==t.key[r].value&&(n=e.key[r].value<t.key[r].value?-1:1);if(0!==n)return i[r]*n}return i[0]*(e.pos-t.pos)}function mapElementReferenceArrayToObject(e){for(var t={},i=0;i<e.length;i++)t[e[i].element]=e[i];return t}function interpretParseTree(e,t,i){function r(e,t){var i=t[0];return void 0!==i?i.map(function(t,i){return void 0!==t?e(t):void 0}):constEmptyOS}function n(e,t){var i=t[0],r=t[1];return void 0!==i&&void 0!==r?i.map(function(t,i){var n=r[i];return void 0!==t&&void 0!==n?e(t,n):void 0}):constEmptyOS}function o(e,t){for(var i=0,r=[];;){for(var n=!0,o=[],s=0;s<t.length;s++)i<t[s].length&&(n=!1,o.push(t[s][i]));if(n)break;r.push(e(o)),i++}return r}function s(e){for(var t=void 0,i=0;i<e.length;i++)(void 0===t||e[i]<t)&&(t=e[i]);return t}function a(e){for(var t=void 0,i=0;i<e.length;i++)(void 0===t||e[i]>t)&&(t=e[i]);return t}function d(e){for(var t=0,i=0;i<e.length;i++)void 0!==e[i]&&(t+=e[i]);return t}function u(e){for(var t=0,i=0,r=0;r<e.length;r++)void 0!==e[r]&&(t+=e[r],i++);return 0===i?void 0:t/i}var h=void 0===e.arguments?void 0:e.arguments.map(function(e){return interpretParseTree(e,t,i)});switch(e.head){case"+":return void 0===h||2!=h.length?constEmptyOS:n(function(e,t){return e+t},h);case"-":return void 0===h||2!=h.length?constEmptyOS:n(function(e,t){return e-t},h);case"*":return void 0===h||2!=h.length?constEmptyOS:n(function(e,t){return e*t},h);case"/":return void 0===h||2!=h.length?constEmptyOS:n(function(e,t){return 0!==t?e/t:void 0},h);case"%":return void 0===h||2!=h.length?constEmptyOS:n(function(e,t){return 0!==t?e%t:void 0},h);case"^":return void 0===h||2!=h.length?constEmptyOS:n(function(e,t){var i=Math.pow(e,t);return isNaN(i)?void 0:i},h);case"unaryMinus":return void 0===h||1!=h.length?constEmptyOS:r(function(e){return-e},h);case"ln":return void 0===h||1!=h.length?constEmptyOS:r(function(e){return e>0?Math.log(e):void 0},h);case"log10":return void 0===h||1!=h.length?constEmptyOS:r(function(e){return e>0?Math.log(e)/Math.LN10:void 0},h);case"logb":return void 0===h||2!=h.length?constEmptyOS:n(function(e,t){return e>0&&t>0?Math.log(e)/Math.log(t):void 0},h);case"exp":return void 0===h||1!=h.length?constEmptyOS:r(function(e){return Math.exp(e)},h);case"abs":return void 0===h||1!=h.length?constEmptyOS:r(function(e){return Math.abs(e)},h);case"sqrt":return void 0===h||1!=h.length?constEmptyOS:r(function(e){return e>0?Math.sqrt(e):void 0},h);case"second":return void 0===h||1!=h.length?constEmptyOS:r(function(e){var t=new Date(1e3*e).getSeconds();return isNaN(t)?void 0:t},h);case"minute":return void 0===h||1!=h.length?constEmptyOS:r(function(e){var t=new Date(1e3*e).getMinutes();return isNaN(t)?void 0:t},h);case"hour":return void 0===h||1!=h.length?constEmptyOS:r(function(e){var t=new Date(1e3*e).getHours();return isNaN(t)?void 0:t},h);case"dayOfWeek":return void 0===h||1!=h.length?constEmptyOS:r(function(e){var t=new Date(1e3*e).getDay();return isNaN(t)?void 0:t+1},h);case"dayOfMonth":return void 0===h||1!=h.length?constEmptyOS:r(function(e){var t=new Date(1e3*e).getDate();return isNaN(t)?void 0:t},h);case"month":return void 0===h||1!=h.length?constEmptyOS:r(function(e){var t=new Date(1e3*e).getMonth();return isNaN(t)?void 0:t+1},h);case"quarter":return void 0===h||1!=h.length?constEmptyOS:r(function(e){var t=new Date(1e3*e).getMonth();return isNaN(t)?void 0:Math.trunc(t/3)+1},h);case"year":return void 0===h||1!=h.length?constEmptyOS:r(function(e){var t=new Date(1e3*e).getFullYear();return isNaN(t)?void 0:t},h);case"pi":return t.map(function(e){return Math.PI});case"e":return t.map(function(e){return Math.E});case"max":return o(a,h);case"min":return o(s,h);case"sum":return o(d,h);case"avg":return o(u,h);default:if("number"==typeof e.head){var l=e.head;return t.map(function(e){return l})}return"string"==typeof e.head?i(t,e.head):constEmptyOS}}function determineWrite(e,t,i,r,n,o){var s,a=void 0===t.value?constEmptyOS:t.value;if(void 0===e&&(e=[]),void 0===n){if(void 0===o.markShift(0,1/0,a,!1,i))return void Utilities.warn("dead-ended write: overwriting data: "+gWriteAction+" at "+gWriteAction);switch(i){case WriteMode.replace:s=a;break;case WriteMode.merge:s=a instanceof Array&&0===a.length?a:mergeCopyValue(a,e,r)}}else{var d=a instanceof Array?a:[a];s=e;for(var u=0;u!==n.length;u++)s=updateValue(s,d,n[u],i,r,o)}return s}function updateValue(e,t,i,r,n,o){function s(t){for(var i=0;i<e.length;i++)if(interpretedBoolMatch(t,e[i]))return i;return e.length}function a(e,t){var i={};for(var r in e){if(r in t&&!objectEqual(e[r],t[r]))return void Utilities.warn("cannot merge added attributes");i[r]=e[r]}for(var r in t)i[r]=t[r];return i}var d,u,h,l;if(n.push===!0)return assert(void 0===i.path,"meaningless?"),e.concat(t);if(n.atomic===!0||n.erase===!0)return assert(void 0===i.path,"meaningless?"),void 0===o.markShift(0,1/0,t,!1,r)?(Utilities.warn("dead-ended write (atomic): "+gWriteAction+" at "+gWriteAction),e):t;var c=void 0===i.addedAttributes?o.getIndex(i.index):s(i.addedAttributes);if(void 0===i.path||0===i.path.length){if(void 0===o.markShift(c,i.length,t,!1,r))return Utilities.warn("double write (term): "+gWriteAction),e;switch(r){case WriteMode.replace:u=t;break;case WriteMode.merge:u=1!==t.length?t:mergeCopyValue(t,e.slice(c,c+i.length),n)}if(void 0!==i.addedAttributes){if(1!==u.length)return Utilities.warn("Cannot add attributes in write"),e;if(u=u.slice(0),u[0]=a(shallowCopy(u[0]),i.addedAttributes),void 0===u[0])return e}l=i.length}else{if(1!==i.path.length)return Utilities.warn("Cannot write across paths longer than 1"),e;h=i.path[0],d=c<e.length?e[c]:{},d instanceof Object&&!(d instanceof NonAV)||(d={}),u=shallowCopyMinus(d,h);var p=h in d?d[h]:[],f=n.popPathElement(h);if(f.erase!==!0){for(var v=0;v<i.sub.length;v++){var g=i.sub[v],m=o.markShift(g.index,1,[{}],!0,r);if(void 0!==m){var y=m.markProjection(h);p=updateValue(p,t,g,r,f,y)}else Utilities.warn("versus: "+gWriteAction)}if(u[h]=p,void 0!==i.addedAttributes&&(u=a(u,i.addedAttributes),void 0===u))return e}l=1}return e.slice(0,c).concat(u).concat(e.slice(c+l))}function getSelectedWritePositionsNoPath(e,t){if(void 0===e)return t;if(void 0===t||0===t.length)return e;for(var i=[],r=0;r!==e.length;r++){var n=e[r].copy();void 0!==n.index&&(n.index=t[e[r].index].index),i.push(n)}return i}function getSelectedWritePositionsWithPath(e,t,i){var r,n,o,s;if(void 0!==e&&e.length>0&&void 0===e[0].index||void 0===t||0===t.length){r=e;for(var n=i.length-1;n>=0;n--)r=[new DataPosition(0,0,[i[n]],void 0===r?[new DataPosition(0,0)]:r)]}else if(void 0===e)for(r=[],n=0;n<t.length;n++)s=new DataPosition(0,t[n].length),r.push(new DataPosition(t[n].index,1,i,[s]));else for(r=[],n=0;n!==e.length;n++){var a=0;for(o=0;o<t.length&&(a<=e[n].index&&(0===t[o].length||o===t.length-1||e[n].index+e[n].length<=a+t[o].length)&&(s=e[n].copy(),s.index=e[n].index-a,r.push(new DataPosition(t[o].index,1,i,[s]))),0!==t[o].length);o++)a+=t[o].length}return r}function findMaxLenSrcIdPath(e,t){function i(e,t){for(var i=e;void 0!==i;){if(i.step===t)return!0;i=i.previous}return!1}function r(e){for(var t=e,i=[];void 0!==t.previous;)i.push(t.step),t=t.previous;return i.reverse()}for(var n=[[{v:e,previous:void 0,step:void 0}]],o=0;o<t.size&&n[o].length>0;){var s=n[o];o++,n.push([]);for(var a=0;a<s.length;a++){var d=s[a];t.forEach(function(e,t){var r=d.v.getQueryApplicationWithSourceId(t);void 0===r||i(d,t)||n[o].push({v:r,previous:d,step:t})})}}return 0===n[o].length&&o--,0===o?constEmptyOS:r(n[o][0])}function convertToRawDataDescription(e){function t(e,i){var a=o.get(e);for(var d in i){var u,h=getDeOSedValue(i[d]);a.next.has(d)?u=a.next.get(d):(u=n.length,a.next.set(d,u),o.set(u,{path:a.path.concat(d),next:new Map}),r[u]=[],n[u]={path:o.get(u).path,indexedValues:void 0,pathValuesRanges:[{o:0,v:r[u]}]}),isSimpleType(h)?r[u][s]=h:h instanceof Array||!isAV(h)||t(u,h)}}function i(e){var t=[];return e.forEach(function(e){t.push(e.path)}),t}var r,n=[],o=new Map;n.push({path:[],indexedValues:void 0,pathValuesRanges:void 0}),o.set(0,{path:[],next:new Map});for(var s=0;s<e.length;s++){var a=e[s];isAV(a)&&t(0,a)}return[{mapping:{rowNr:0,nrDataElements:e.length,firstDataElementId:0,paths:i(o)},values:n.slice(1).map(function(e){return{path:e.path,indexedValues:void 0,pathValuesRanges:compressRawData(e.pathValuesRanges[0].v,void 0)}})}]}function checkForCycles(e){function t(){for(var e=n,t=[];e>=0;)t.push(i[e]),e=r[e];return t.reverse()}var i=gCycleCheckQueue,r=gCycleCheckUp,n=0,o=0,s=++gCycleCheckNr;for(r[o]=-1,i[o++]=e;n<o;){var a=i[n];if(a.lastSeenInCycleCheck!==s){var d=void 0;if(a.lastSeenInCycleCheck=s,a.watchers.forEach(function(e){var s=e.watcher;s instanceof EvaluationNode&&s.nrActiveWatchers>0&&(s===a?d=t():(r[o]=n,i[o++]=s))}),void 0!==d)return d}n++}}function checkAllExpressionsForCycles(){function e(e,t){for(var i=0;i<e.length;i++)if(void 0!==e[i]&&e[i].nrActiveWatchers>0){var r=checkForCycles(e[i]);void 0!==r&&console.log("cycle found in "+t+": "+r.map(function(e){return e.prototype.idStr()}).join(" -> "))}}e(globalEvaluationNodes,"global");for(var t in allAreaMonitor.allAreas){var i=allAreaMonitor.allAreas[t];e(i.evaluationNodes[0],i.tAreaId)}}function singleChangeCycleCheck(e){var t=checkForCycles(e);void 0!==t&&console.log("cycle found: "+t.map(function(e){return e.prototype.idStr()}).join(" -> "))}function trackAllExpressions(e,t){function i(e,t){if(e in d){if(d[e]){console.log("LOOP");for(var r=0;r<t.length;r++)console.log(t[r].areaId,t[r].evaluationNode.prototype.idStr(),t[r].evaluationNode.toString())}}else{var n=s[e];if(void 0===n)console.log("UNDEFINED!!!",t);else{d[e]=!0;for(var r=0;r<n.length;r++){var o=n[r].evaluationNode.watcherId;i(o,t.concat(n[r]))}}d[e]=!1}}var r=allAreaMonitor.allAreas[e],n=[e],o=[r.evaluationNodes[0][t]],s={},a={},d={};s[o[0].watcherId]=[];for(var u=0;u<o.length;u++){var h,l=o[u],c=void 0;if(l instanceof EvaluationAreaProjection){h=l.inputs.slice(0),c=l.inputs.map(function(e){});for(var p in l.activeProducers){var f=l.watchedProducers[p];f instanceof EvaluationNode&&h.push(f),c.push(l.activeProducers[p])}}else h=l.allInputs();if(void 0!==h)for(var v=0;v<h.length;v++){var g=h[v],m=void 0===c||void 0===c[v]?n[u]:c[v],y={areaId:n[u],evaluationNode:l};void 0===g||g.watcherId in s||(o.push(g),n.push(m),s[l.watcherId].push({areaId:m,evaluationNode:g}),s[g.watcherId]=[],a[g.watcherId]=y),console.log('"'+y.areaId+" "+y.evaluationNode.prototype.idStr()+'" -> "'+m+" "+g.prototype.idStr()+'";')}}i(o[0].watcherId,[{areaId:e,evaluationNode:o[0]}])}function makeElementReference(e){return new ElementReference(e)}function buildQualifiers(e,t){for(var i=[],r=0;r!==e.length;r++)i.push({value:getEvaluationNode(e[r].functionNode,t),match:e[r].value});return i}function buildEvaluationNode(e,t){var i=e.makeEvaluationNode(t);i.init(),i.isBeingInitialized=!1}function buildWriteTriggerNode(e,t,i){var r=new WriteTriggerNode(i,e,t);return r.initialize(),r}function simpleValueMatchInOS(e,t){return void 0!==e&&e.some(function(e){return e===t||e instanceof RangeValue&&e.match(t)})}function onlySimpleValueInOS(e,t){return void 0!==e&&e.every(function(e){return e===t||e instanceof RangeValue&&e.match(t)})}function makeSimpleQuery(e,t){function i(e){for(var t,i=0;i<e.length;i++){var r=typeof e[i];if("number"===r||"string"===r?r="simple":e[i]instanceof ElementReference&&(r="elementReference"),void 0===t)t=r;else if(t!==r)return}return t}function r(e){return e.closedLower&&e.closedUpper?new SimpleRangeCCSelection(e):e.closedLower&&!e.closedUpper?new SimpleRangeCOSelection(e):!e.closedLower&&e.closedUpper?new SimpleRangeOCSelection(e):new SimpleRangeOOSelection(e)}var n,o=void 0;if(e instanceof Object)if(void 0===gSimpleQueryMap)gSimpleQueryMap=new WeakMap;else if(gSimpleQueryMap.has(e))return gSimpleQueryMap.get(e);if(e=singleton(e),e instanceof Array||!isAV(e))if(e instanceof Negation){var s=e.queries;if(0===s.length)o=new SimplePassThrough;else if("simple"===i(s))o=new SimpleValueInvMultipleSelection(s);else if(1===s.length&&isAV(s[0])){var a=Object.keys(s[0]);if(0===a.length)o=new SimpleSelectNone;else if(1===a.length){var d=a[0],u=singleton(s[0][d]);u!==!0&&u!==_||(o=new SingleAttributeAbsentSelection(d))}}if(void 0===o){for(var h=[],l=0;l<s.length;l++){var c=makeSimpleQuery(s[l],void 0);if(void 0===c)break;h.push(c)}l===s.length&&(o=new SimpleNegation(h))}}else if(e instanceof Array)if(0===e.length)o=new SimpleSelectNone;else if(void 0!==(n=i(e)))switch(n){case"simple":o=new SimpleValueMultipleSelection(e);break;case"elementReference":o=new ElementReferenceMultipleSelection(e);break;case"boolean":o=isTrue(e)?new SimpleTrueSelection:new SimpleFalseSelection}else o=orOfSimpleQueries(e);else{if(e===_)return new SimplePassThrough;if(void 0===e)return new SimpleSelectNone;if(e instanceof RangeValue)o=r(e);else{if(e===!0)return new SimpleTrueSelection;if(e===!1||void 0===e)return new SimpleFalseSelection;if(isSimpleType(e))return new SimpleValueSelection(e);if(e instanceof ElementReference)return new ElementReferenceSelection(e);if(e instanceof SubStringQuery)return new SimpleSubstringSelection(e)}}else{var a=Object.keys(e);if(0===a.length)o=new SimplePassThrough;else{for(var p=[],f=void 0,l=0;l<a.length;l++){var d=a[l],u=singleton(e[d]);if(u===_){if(void 0!==f)break;f=new SingleAttributeProjection(d)}else if(u instanceof RangeValue)p.push(new SingleAttributeRangeSelection(d,u));else if(u instanceof SubStringQuery)p.push(new SingleAttributeSubStringQuery(d,u));else if(u===!0)p.push(new SingleAttributeTrueSelection(d));else if(u===!1)p.push(new SingleAttributeFalseSelection(d));else{if(u instanceof Array&&0===u.length){p=[new SimpleSelectNone];break}if(u instanceof Negation)if(u=singleton(u.queries),isSimpleType(u))p.push(new SingleAttributeSimpleValueInvSelection(d,u));else if("simple"===i(u))p.push(new SingleAttributeSimpleValueInvMultipleSelection(d,u));else{if(!(u instanceof Array&&0===u.length))break;p.push(new SingleAttributeSelection(d))}else if(isSimpleType(u))p.push(new SingleAttributeSimpleValueSelection(d,u));else{if("simple"!==i(u))break;p.push(new SingleAttributeSimpleValueMultipleSelection(d,u))}}}l===a.length&&(void 0!==f&&p.push(f),o=1===p.length?p[0]:new SimpleQueryChain(p))}}return gSimpleQueryMap.set(e,o),void 0===o&&showRuntimeWarnings&&console.log("warning: no simple query for",vstringify(e)),o}function orOfSimpleQueries(e){for(var t=[],i=0;i<e.length;i++){var r=makeSimpleQuery(e[i],void 0);if(void 0===r||r.isProjection())return;t.push(r)}return new SimpleOrSelection(t)}function makeSimpleQueryDefault(e,t){var i=makeSimpleQuery(e,t);return void 0!==i?i:new SimpleQueryInterpretedQuery(e)}function makeSimpleQueryWithId(e,t){return void 0===t?makeSimpleQueryDefault(e,void 0):new IdentityQuery(t,e)}function setGDebugBreak(){gDebugBreak=!0}function signalOutputChange(e,t){if(gOutputChanged=!0,logTypeChanges&&void 0!==t)switch(t.type){case"valueTypeChange":console.log("change: valueType",void 0===t.origType?"undefined":t.origType.toString(),void 0===t.newType?"undefined":t.newType.toString());break;case"nrOutputAreas":console.log("change: nrOutputAreas",t.from,t.to)}}function getWritableNode(e,t,i){if(e in gWritableMap){var r=gWritableMap[e];if(t in r){var n=i.join("."),o=r[t][n];return void 0!==o&&(o.cycleNr=gCycleNr),o}}}function storeWritableNode(e,t,i,r){var n=gWritableMap[e],o=i.join(".");void 0===n&&(gWritableMap[e]=n={});var s=n[t];void 0===s&&(n[t]=s={}),assert(!(o in s),"each writable node should be stored once"),s[o]=r}function qEqual(e,t){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++){for(var r=0;r<e.length&&(e[i].functionNode!==t[r].functionNode||e[i].value!==t[r].value);)r++;if(r===e.length)return!1}return!0}function qImply(e,t){if(e.length<t.length)return!1;for(var i=0;i<t.length;i++){for(var r=0;r<e.length&&(e[r].functionNode!==t[i].functionNode||e[r].value!==t[i].value);)r++;if(r===e.length)return!1}return!0}function qOr(e,t,i,r){if(void 0!==t&&0!==t.length){for(var n=0;n<e.length;n++)if(qEqual(e[n],t))return void(void 0!==i&&i[n].push(r));e.push(t),void 0!==i&&i.push([r])}}function qsEqual(e,t){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++){for(var r=0;r<t.length&&!qEqual(e[i],t[r]);r++);if(r===t.length)return!1}return!0}function qAnd(e,t){for(var i=[],r=0;r<e.length;r++){for(var n=e[r],o=0;o<t.length;o++){var s=t[o];if(n.functionNode===s.functionNode){if(n.value===s.value){i.push(n);break}if("boolean"==typeof n.value&&"boolean"!=typeof s.value){if(n.value!==!0)return;i.push(s);break}if("boolean"!=typeof n.value&&"boolean"==typeof s.value){if(s.value!==!0)return;i.push(n);break}return}}o===t.length&&i.push(n)}for(var o=0;o<t.length;o++){for(var s=t[o],r=0;r<e.length;r++){var n=e[r];if(s.functionNode===n.functionNode)break}r===e.length&&i.push(s)}return i}function subSetOf(e,t){return e.every(function(e){return t.indexOf(e)!==-1})}function equalSets(e,t){return subSetOf(e,t)&&subSetOf(t,e)}function qSimplify(e,t){function i(e,t){for(var i=0;i<e.length;i++)if("boolean"==typeof e[i].value)for(var r=0;r<t.length;r++)if(e[i].functionNode===t[r].functionNode&&"boolean"==typeof t[r].value&&e[i].value!==t[r].value)return i;return-1}for(var r=!0;r;){r=!1;for(var n=0;!r&&n<e.length;n++)for(var o=n+1;!r&&o<e.length;o++)if(void 0===t||equalSets(t[n],t[o])){var s=i(e[n],e[o]);if(s!==-1){var a=e[n].slice(0,s).concat(e[n].slice(s+1));e=e.slice(0,n).concat(e.slice(n+1,o)).concat(e.slice(o+1)),a.length>0&&qOr(e,a,void 0,void 0),r=!0}}}return e}function mergeLocality(e,t){if(void 0===e)return t;if(void 0===t)return e;if(e!==t){for(var i=Math.min(e,t),r=Math.max(e,t),n=r;n>i;)n=areaTemplates[n].parent.id;return n!==i&&Utilities.error("incompatible locality"),r}return e}function testMergeLocality(e,t){if(void 0!==e&&void 0!==t&&e!==t){for(var i=Math.min(e,t),r=Math.max(e,t),n=r;n>i;)n=areaTemplates[n].parent.id;if(n!==i)return!1}return!0}function mergeDefunLocality(e,t){if(0===e)return t;if(0===t)return e;var i=gDefunStack.lastIndexOf(e),r=gDefunStack.lastIndexOf(t);return assert(i>=0&&r>=0,"not on defun stack"),i>r?e:t}function testMergeDefunLocality(e,t){if(0===e||0===t)return!0;var i=gDefunStack.lastIndexOf(e),r=gDefunStack.lastIndexOf(t);return i>=0&&r>=0}function sqInSQs(e,t){return t.some(function(t){return e.isEqualSym(t)})}function sqsImplies(e,t){return t.every(function(t){return sqInSQs(t,e)})}function sqsEqual(e,t){return sqsImplies(e,t)&&sqsImplies(t,e)}function sqsMismatch(e,t){return e.some(function(e){return t.some(function(t){return e.mismatch(t)})})}function pathToQueryString(e,t){for(var i=t,r=e.length-1;r>=0;r--)i="{"+e[r]+": "+i+"}";return i}function pathToQueryObject(e,t){for(var i=t,r=e.length-1;r>=0;r--){var n={};n[e[r]]=i,i=n}return i}function getValueTypeFromConstant(e){var t=typeof e,i=new ValueType;if("object"!==t)switch(t){case"undefined":i.addUndefined().addSize(0);break;case"string":i.addString().addSize(1);break;case"number":i.addNumber().addSize(1);break;case"boolean":i.addBoolean().addSize(1);break;default:assert(!1,"unknown type")}else if(e instanceof NonAV)switch(e.typeName()){case"range":i.addRange().addSize(1);break;case"orderedSet":for(var r=0;r<e.os.length;r++)i=i.merge(getValueTypeFromConstant(e.os[r]));i.addSize(e.os.length);break;case"projector":i.addProjector().addSize(1);break;case"terminalSymbol":i.addTerminalSymbol().addSize(1);break;case"comparisonFunction":i.addComparisonFunction(e.os.map(getValueTypeFromConstant)).addSize(1);break;case"elementReference":"p1"===e.element?i.addArea(0,[_r(1,1)]):Utilities.error("cannot add areas as constant");break;default:assert(!1,"unknown type")}else if(e instanceof Array){for(var r=0;r<e.length;r++){var n=getValueTypeFromConstant(e[r]);i=i.merge(n)}i.sizes=[_r(e.length,e.length)]}else{i.addObject({}).addSize(1);for(var o in e)i.addAttribute(o,getValueTypeFromConstant(e[o]))}return i}function debugLogEvent(e){return debugEvents===!0||"object"==typeof debugEvents&&debugEvents[e]}function debugEventMessage(e,t,i){if(!debugEventFilter(e)){var r=cdlify(e);
0===i?console.groupCollapsed("%cevent: "+r,"font-weight:500;"):console.log(r),t&&debugEventListArea(t),2===i&&console.groupEnd()}}function debugEventPropagationAbortedMessage(e){if(!debugEventFilter(e)){var t=gDomEvent.debugAbortId?" by "+gDomEvent.debugAbortId:"";console.log("event propagation aborted"+t)}}function debugEventListArea(e){for(var t=[],i=0;i<e.length;i++)t.push("@"+e[i].recipient.areaId);console.log("covering area list:",t)}function debugEventFilter(e){return void 0!==e.type&&!runTests&&"MouseMove"===e.type[0]}function markEventStart(e,t){void 0===t&&(t=void 0),void 0!==t?globalTaskQueue.iterationTimeout=t:globalTaskQueue.iterationTimeout=50,!gInitPhase&&logEventTimes&&(void 0!==lastEventDescription&&console.log(lastEventDescription+" interrupted after "+(Date.now()-mondriaOnLoadDate.getTime())+" ms"),mondriaOnLoadDate=new Date,lastEventDescription=e)}function markEventEnd(){}function postKeyEvent(e,t){var i;if(t instanceof ElementReference){var r=allAreaMonitor.getAreaById(t.element);if(!(r instanceof DisplayArea))return!1;i=r}switch(e.stopImmediatePropagation(),e.stopPropagation(),e.type){case"keydown":return gDomEvent.keyDownUpHandler(e,i,!0);case"keyup":return gDomEvent.keyDownUpHandler(e,i,!1);case"keypress":return gDomEvent.keyPressHandlerInt(e,i)}return!1}function copyTouch(e){return{identifier:e.identifier,clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,target:e.target}}function _n(e,t){var i=new FNRef;return i.level=e,i.index=t,i}function _nt(e,t){var i=new FNRef;return i.level=e,i.index=t,i.suppressSet=!0,i}function _nf(e,t){var i=new FNRef;return i.level=e,i.index=t,i.suppressSet=!1,i}function _nd(e,t,i){var r=new FNRef;return r.level=e,r.defunNr=t,r.index=i,r}function _ntd(e,t,i){var r=new FNRef;return r.level=e,r.defunNr=t,r.index=i,r.suppressSet=!0,r}function _nfd(e,t,i){var r=new FNRef;return r.level=e,r.defunNr=t,r.index=i,r.suppressSet=!1,r}function addFunctionNode(e,t){var i;e.localToDefun?e.localToDefun in gCurLocalDefunFunctionNodes?i=gCurLocalDefunFunctionNodes[e.localToDefun]:gCurLocalDefunFunctionNodes[e.localToDefun]=i=[]:i=gCurLocalFunctionNodes,e.scheduleStep=t,e.id=i.length,i.push(e)}function refFunctionNode(e){if(void 0!==e){var t;if(void 0===e.level)t=e.defunNr?FunctionNode.globalDefunFunctionNodes[e.defunNr]:FunctionNode.globalFunctionNodes;else{for(var i=gCurAreaTemplate,r=0;r<e.level;r++)i=i.parent;t=e.defunNr?i.defunFunctionNodes[e.defunNr]:i.functionNodes}return t[e.index]}}function refFunctionNodeMapNum(e){if(void 0!==e){var t={};for(var i in e)t[i]=refFunctionNode(e[i]);return t}}function refFunctionNodeMapStr(e){if(void 0!==e){var t={};for(var i in e)t[i]=refFunctionNode(e[i]);return t}}function _a(e,t,i,r){var n={},o={};for(var s in i)n[s]=refFunctionNode(i[s]),"suppressSet"in i[s]&&(o[s]=i[s].suppressSet);addFunctionNode(new AVFunctionNode(n,gCurTemplateId,t,void 0,void 0,r,o),e)}function _g(e,t){return new SingleQualifier(refFunctionNode(e),void 0,t,void 0)}function _gx(e,t,i,r){return new SingleQualifier(refFunctionNode(e),t,r,i)}function _q(e,t,i){addFunctionNode(new QualifiersFunctionNode(i,gCurTemplateId,t),e)}function _m(e,t,i,r){addFunctionNode(new VariantFunctionNode(refFunctionNode(i),r.map(refFunctionNode),gCurTemplateId,t,void 0,void 0,void 0),e)}function _m1(e,t,i,r){addFunctionNode(new VariantFunctionNode(refFunctionNode(i),[refFunctionNode(r)],gCurTemplateId,t,void 0,void 0,void 0),e)}function _f(e,t,i,r){addFunctionNode(new FunctionApplicationNode(i,r.map(refFunctionNode),gCurTemplateId,t,void 0,void 0),e)}function _srt(e,t,i,r){addFunctionNode(new SortNode(r.map(refFunctionNode),gCurTemplateId,t,i,void 0,void 0),e)}function _c(e,t,i,r,n,o){var s=i;addFunctionNode(new CompiledFunctionNode(s.name,i,r.map(refFunctionNode),n,void 0,void 0,void 0,refFunctionNode(o),gCurTemplateId,t,void 0),e)}function _w(e,t,i,r,n){var o=new WritableNode(i,refFunctionNode(r),gCurTemplateId,t,void 0,void 0,void 0);o.setRemoteWritability(n),addFunctionNode(o,e)}function _st(e,t,i){addFunctionNode(new StorageNode(i,gCurTemplateId,t,void 0,void 0,void 0),e)}function _mq(e,t,i){addFunctionNode(new MessageQueueNode(i,gCurTemplateId,t,void 0,void 0),e)}function _ptr(e,t,i){addFunctionNode(new PointerStorageNode(i,gCurTemplateId,t,void 0,void 0),e)}function _dB(e,t,i){addFunctionNode(new DebugBreakNode(i),e)}function _par(e,t,i){addFunctionNode(new ParamStorageNode(i,gCurTemplateId,t,void 0,void 0),e)}function _p(e,t,i,r){addFunctionNode(new AreaProjectionNode(i,void 0,gCurTemplateId,t,refFunctionNode(r),void 0,void 0,void 0,void 0),e)}function _coa(e,t,i){addFunctionNode(new ClassOfAreaNode(gCurTemplateId,t,refFunctionNode(i),void 0,void 0,void 0),e)}function _s(e,t,i,r,n,o){var s=new QueryComponentSelect(void 0,void 0,n,refFunctionNode(r));addFunctionNode(new AreaSelectionNode(i,s,gCurTemplateId,t,refFunctionNode(o),void 0,void 0),e)}function _o(e,t,i){addFunctionNode(new OrderedSetNode(i.map(refFunctionNode),gCurTemplateId,t,void 0,void 0,void 0),e)}function _rcc(e,t,i){addFunctionNode(new RangeNode(i.map(refFunctionNode),!0,!0,gCurTemplateId,t,void 0,void 0),e)}function _rco(e,t,i){addFunctionNode(new RangeNode(i.map(refFunctionNode),!0,!1,gCurTemplateId,t,void 0,void 0),e)}function _roc(e,t,i){addFunctionNode(new RangeNode(i.map(refFunctionNode),!1,!0,gCurTemplateId,t,void 0,void 0),e)}function _roo(e,t,i){addFunctionNode(new RangeNode(i.map(refFunctionNode),!1,!1,gCurTemplateId,t,void 0,void 0),e)}function _neg(e,t,i){addFunctionNode(new NegationNode(i.map(refFunctionNode),gCurTemplateId,t,void 0,void 0),e)}function _substr(e,t,i){addFunctionNode(new SubStringQueryNode(i.map(refFunctionNode),gCurTemplateId,t,void 0,void 0,void 0),e)}function _cf(e,t,i){addFunctionNode(new ComparisonFunctionNode(i.map(refFunctionNode),gCurTemplateId,t,void 0,void 0,void 0),e)}function _v(e,t){addFunctionNode(new ConstNode(e,void 0,void 0,t,!0),-1)}function _vcq(e,t,i){var r=new ConstNode(e,void 0,void 0,i,!0),n=refFunctionNode(t);r.setCompiledQuery(n),addFunctionNode(r,-1)}function _mss(e,t){evaluationQueue.init(e,t)}function _ac(e,t,i,r){var n=void 0===e?void 0:areaTemplates[e],o=new AreaTemplate(void 0,n,t,void 0,void 0);areaTemplates.push(o),o.scheduleStep=i,void 0!==n&&r&&(n.children[t]=o),gCurAreaTemplate=o,gCurTemplateId=o.id,gCurLocalFunctionNodes=o.functionNodes,gCurLocalDefunFunctionNodes=o.defunFunctionNodes,gCurGeneric=!1}function _aeq(e){gCurAreaTemplate.existenceQualifiers=e}function _ca(){gCurAreaTemplate.isDisplayArea=!1}function _cnp(e){gCurAreaTemplate.classNamePrio=e}function _icp(e){gCurAreaTemplate.independentContentPosition=refFunctionNode(e)}function _eir(){gCurAreaTemplate.embeddingInReferred=!0}function _ppia(e){gCurAreaTemplate.propagatePointerInArea=refFunctionNode(e)}function _acc(e,t){var i=areaTemplates[e],r={};for(var n in t)r[n]={data:refFunctionNode(t[n].data),partner:refFunctionNode(t[n].partner)};i.setFunctions=r}function _ae(e,t,i,r,n){var o=areaTemplates[e];o.displayFunction=refFunctionNode(t),o.positionFunctions=refFunctionNodeMapStr(i),void 0!==r&&(o.stackingFunctions=refFunctionNodeMapStr(r)),o.exports=refFunctionNodeMapNum(n),_gd()}function _afi(e){gCurAreaTemplate.foreignInterfaceDisplayFunction=refFunctionNode(e)}function _gd(){var e={};if(void 0!==bodyCreateFuns){for(var t=0;t!==bodyCreateFuns.length;t++){var i=bodyCreateFuns[t];i.defunNode.defunNr in e||(e[i.defunNode.defunNr]=!0,i.bodyImpl()),i.defunNode.parameterNodes=i.parameterNodes.map(refFunctionNode),i.defunNode.setBody(refFunctionNode(i.bodyNode))}bodyCreateFuns=void 0}}function _ctx(e,t,i){debugAreaInfo[e]={content:t,context:i}}function _d(e,t,i,r){addFunctionNode(new ChildAreasNode(i,refFunctionNode(r),void 0,void 0),e)}function _aw(e,t,i,r,n,o,s,a){var d=areaTemplates[e],u=new WriteNode;u.scheduleStep=a,u.upon=refFunctionNode(i),void 0===r&&void 0===n||(u.whenBecomesTrue={continuePropagation:refFunctionNode(r),actions:n}),void 0===o&&void 0===s||(u.whenBecomesFalse={continuePropagation:refFunctionNode(o),actions:s}),void 0===d.writeFunctions&&(d.writeFunctions={}),d.writeFunctions[t]=u}function getLastNodeFromFunctionNodes(e,t){var i;if(e)if(t){var r=gCurAreaTemplate.defunFunctionNodes;t in r?i=r[t]:r[t]=i=[]}else i=gCurAreaTemplate.functionNodes;else t?t in FunctionNode.globalDefunFunctionNodes?i=FunctionNode.globalDefunFunctionNodes[t]:FunctionNode.globalDefunFunctionNodes[t]=i=[]:i=FunctionNode.globalFunctionNodes;return i[i.length-1]}function _owp(e,t){var i=getLastNodeFromFunctionNodes(gCurTemplateId,t);i.writable=!0}function _sp(e,t){var i=getLastNodeFromFunctionNodes(gCurTemplateId,e);i.prio=t}function _se(e,t,i){var r=getLastNodeFromFunctionNodes(gCurTemplateId,t);r.schedulingError=!0}function _bg(e,t,i,r){addFunctionNode(new BoolGateNode(refFunctionNode(i),refFunctionNode(r),gCurTemplateId,t,void 0),e)}function _bm(e,t,i,r,n){addFunctionNode(new BoolMatchNode(refFunctionNode(i),refFunctionNode(r),refFunctionNode(n),gCurTemplateId,t,void 0,void 0),e)}function _tm(e,t,i){var r=new ToMergeNode(refFunctionNode(e),refFunctionNode(t),void 0);return r.scheduleStep=i,r}function _co(e,t,i,r){var n=r.map(function(e){return{on:refFunctionNode(e.on),use:refFunctionNode(e.use)}});addFunctionNode(new CondNode(refFunctionNode(i),n,gCurTemplateId,t,void 0,void 0),e)}function _def(e,t,i,r,n,o){var s=new DefunNode(gCurTemplateId,t,i,void 0,void 0,void 0,void 0);s.localToArea=gCurTemplateId,addFunctionNode(s,e),void 0===bodyCreateFuns&&(bodyCreateFuns=[]),bodyCreateFuns.push({defunNode:s,parameterNodes:r,bodyNode:n,bodyImpl:o})}function _executeCompiledQuery_(e,t){if(t instanceof Array){for(var i=[],r=0;r!==t.length;r++){var n=e(t[r]);void 0!==n&&i.push(n)}return i}return e(t)}function createAreas(){var e=getEvaluationNode(FunctionNode.globalFunctionNodes[globalMessageNodeIndex],void 0);e.lastUpdate=new Result([]),buildEvaluationNode(FunctionNode.globalFunctionNodes[pointerNodeIndex],globalEvaluationEnv),"undefined"!=typeof globalAreasUnderPointerNodeIndex&&buildEvaluationNode(FunctionNode.globalFunctionNodes[globalAreasUnderPointerNodeIndex],globalEvaluationEnv),"undefined"!=typeof globalDefaultsNodeIndex&&buildEvaluationNode(FunctionNode.globalFunctionNodes[globalDefaultsNodeIndex],globalEvaluationEnv),CoreArea.instantiate(areaTemplates[1],void 0,[])}function initialize(){globalConcludeInitPhaseTask.schedule(),createAreas(),startEventProcessing(),evaluationQueue.runQueue(0,void 0)||globalContentTask.schedule(),scheduleDisplayQueryRecalculation()}function createGlobalObjects(){initDebugObjMgr(),gArgParser=getArgParser(),initDefaultArgs(),initTaskQueue(),initPositioning(),initAbsolutePosManager(),initPosConstraintSynchronizer(),initZIndex(),gPointer=new MondriaPointer(labelBySuffix("1:1",leftSuffix(void 0,!1,!1)),labelBySuffix("1:1",topSuffix(void 0,!1,!1))),buildEvaluationNode(FunctionNode.globalFunctionNodes[globalMessageNodeIndex],globalEvaluationEnv),evaluationQueue.setGlobalMessageQueue(globalEvaluationNodes[globalMessageNodeIndex]),createScreenArea(),createRemoteMgr()}function initDefaultArgs(){logValues=gArgParser.getArg("logValues",!1),logValues&&(logPrototypes=void 0),debugWrites=gArgParser.getArg("debugWrites",debugWrites),debugWritesEval=gArgParser.getArg("debugWritesEval",debugWritesEval),debugWritesString=gArgParser.getArg("debugWritesString",debugWritesString),debugEvents=gArgParser.getArg("debugEvents",debugEvents),gProfile=gArgParser.getArg("profile",gProfile),debugTest=gArgParser.getArg("debugTest",debugTest),logEventTimes=gArgParser.getArg("logEventTimes",!1),useResultIndexers=gArgParser.getArg("useResultIndexers",useResultIndexers),dsDestroyTimeOut=gArgParser.getArg("destroyTimeOut",dsDestroyTimeOut),allowSetData=gArgParser.getArg("allowSetData",allowSetData),linearMultiQuery=gArgParser.getArg("linearMultiQuery",linearMultiQuery),runTests=gArgParser.getArg("test",runTests),testSingleStep=gArgParser.getArg("testSingleStep",testSingleStep),debugTasks=gArgParser.getArg("debugTasks",debugTasks),dataTableMaxNrRows=gArgParser.getArg("dataTableMaxNrRows",void 0),dataTableMaxNrColumns=gArgParser.getArg("dataTableMaxNrColumns",void 0),dataTableFacetRestriction=gArgParser.getArg("dataTableFacetRestriction",void 0),gDontSetPosition=gArgParser.getArg("gDontSetPosition",gDontSetPosition),useResultIndexers||console.warn("no result indexers"),maxTestDuration=testSingleStep&&!gArgParser.getArg("maxTestDuration",void 0)?1e12:1e3*gArgParser.getArg("maxTestDuration",maxTestDuration/1e3),runTests&&(logEventHistory=!1,g_noTryAndCatchUpdate=!0),g_noTryAndCatchUpdate=gArgParser.getArg("noTryAndCatch",g_noTryAndCatchUpdate),noTimeOut=gArgParser.getArg("noTimeOut",!1),debugAreaConstruction=gArgParser.getArg("debugAreaConstruction",!1),debugDelayLoad=gArgParser.getArg("debugDelayLoad",debugDelayLoad),gMaxMessageSize=gArgParser.getArg("gMaxMessageSize",gMaxMessageSize),baseDelay=gArgParser.getArg("baseDelay",baseDelay),sizeDependentDelay=gArgParser.getArg("sizeDependentDelay",sizeDependentDelay);var e=Number(gArgParser.getArg("maxEPS",maxEvaluationsPerSlice));e>0&&(maxEvaluationsPerSlice=e),gArgParser.getArg("noProgressBar",!1)&&(gProgressValue=void 0,gProgressDiv=document.getElementById("progress"),void 0!==gProgressDiv&&null!==gProgressDiv&&(gProgressDiv.parentNode.removeChild(gProgressDiv),gProgressDiv=null)),gProfile&&requirePerformanceNow();for(var t=gArgParser.getArg("debugBreak","").split(",").map(function(e){return e.split(":")}),i=0;i<t.length;i++)3===t[i].length&&"_"===t[i][0]?setDebugBreak(_,t[i][1],t[i][2]):4===t[i].length&&setDebugBreak(t[i][0]+":"+t[i][1],t[i][2],t[i][3]);for(var r=gArgParser.getArg("contextTrace","").split(",").map(function(e){return e.split(":")}),i=0;i<r.length;i++)3===r[i].length&&contextTrace(r[i][0]+":"+r[i][1],r[i][2]);var n=gArgParser.getArg("testLogBreak",void 0);if(void 0!==n&&(testLogBreak=new RegExp(decodeURIComponent(n))),"undefined"!=typeof globalDefaultsNodeIndex)for(var o=FunctionNode.globalFunctionNodes[globalDefaultsNodeIndex].initialValue.value,s=gArgParser.getArg("globalDefaults","").split(",").filter(function(e){return e.includes(":")}).map(function(e){var t=e.split(":");return{path:t[0].split("."),value:[argvConvertString(t[1])]}}),i=0;i<s.length;i++)updateNormalizedValue(o,s[i].path,s[i].value);var a=gArgParser.getArg("productStatus",void 0);productStatus=void 0!==a?a:"undefined"!=typeof process?ProductStatus.testing:"testing.mondriatech.com"===window.location.hostname?ProductStatus.testing:"www.mondriatech.com"===window.location.hostname?ProductStatus.production:ProductStatus.development}function startEventProcessing(){var e=globalEvaluationNodes[pointerNodeIndex];gDomEvent=new MondriaDomEvent(gPointer,"1:1"),e.set(new Result([{position:{top:[0],left:[0]},display:[{image:["default"]}],button:[],modifier:[],id:[1]}])),updateScreenAreaPosition("1:1")}function cdlMain(){return fmtVersion!==gRunFmtVersion?void userAlert("wrong format version"):(createGlobalObjects(),gAppStateMgr.load(),void initialize())}function intConvToPrintable(e){return e instanceof Array?e.map(intConvToPrintable):e instanceof CoreArea?"@"+e.areaId:e instanceof ElementReference?"@"+e.element:e instanceof NonAV?e:e instanceof Object?objMap(e,intConvToPrintable):e}function intConvToInterpretable(e){return e instanceof Array?e.map(intConvToInterpretable):e instanceof NonAV?e:e instanceof Object?objMap(e,intConvToInterpretable):"string"==typeof e&&"@"===e.charAt(0)?new ElementReference(e.slice(1)):e}function I(e){return intConvToPrintable(stripArray(interpretCDL(intConvToInterpretable(e)),!0))}function intGetArea(e){return allAreaMonitor.getAreaById(e.element)}function intMakeAreaReference(e){return new ElementReference(e)}function intGetCdlExpressionType(e){function t(e){switch(intGetCdlExpressionType(e)){case IntExpressionType.attributeValue:case IntExpressionType.negation:case IntExpressionType.range:case IntExpressionType.number:case IntExpressionType.boolean:return!0;case IntExpressionType.string:return!0;case IntExpressionType.orderedSet:return e.os.every(t);default:return!1}}if(e instanceof Object)return e instanceof BuiltInFunction?IntExpressionType.builtInFunction:e instanceof Negation?IntExpressionType.negation:e instanceof Array?0===e.length?IntExpressionType.false:1!==e.length&&2!==e.length||!t(e[0])?IntExpressionType.functionApplication:IntExpressionType.query:e instanceof JavascriptFunction?IntExpressionType.jsFunctionApplication:e instanceof MoonRange?IntExpressionType.range:e instanceof MoonComparisonFunction?IntExpressionType.comparisonFunction:e instanceof MoonSubstringQuery?IntExpressionType.subStringQuery:e instanceof MoonOrderedSet?IntExpressionType.orderedSet:e instanceof Projector?IntExpressionType.projector:e instanceof TerminalSymbol?IntExpressionType.terminalSymbol:e instanceof RegExp?IntExpressionType.string:IntExpressionType.attributeValue;switch(typeof e){case"string":return IntExpressionType.string;case"number":return IntExpressionType.number;case"boolean":return IntExpressionType.boolean;case"object":return IntExpressionType.null;case"undefined":return IntExpressionType.undefined}return IntExpressionType.unknown}function interpretCDL(e){function t(e){return"@"===e.charAt(0)?intMakeAreaReference(e.slice(1)):e}if(e instanceof NonAV)return e;switch(intGetCdlExpressionType(e)){case IntExpressionType.attributeValue:return intAttributeValue(e);case IntExpressionType.query:return intQuery(e);case IntExpressionType.functionApplication:return intFuncAppl(e);case IntExpressionType.jsFunctionApplication:break;case IntExpressionType.range:return new RangeValue(e.os.map(interpretCDL),e.closedLower,e.closedUpper);case IntExpressionType.subStringQuery:return new SubStringQuery(e.os.map(interpretCDL));case IntExpressionType.orderedSet:return e.os.map(interpretCDL);case IntExpressionType.negation:return new Negation(e.queries.map(interpretCDL));case IntExpressionType.projector:case IntExpressionType.terminalSymbol:case IntExpressionType.comparisonFunction:case IntExpressionType.number:case IntExpressionType.boolean:case IntExpressionType.undefined:case IntExpressionType.false:case IntExpressionType.null:case IntExpressionType.builtInFunction:return e;case IntExpressionType.string:return t(e)}console.log("cannot interpret",e)}function intAttributeValue(e){var t={};for(var i in e){var r=interpretCDL(e[i]);void 0!==r&&(t[i]=r)}return t}function intApplyQuery(e,t){function i(e,t){if(t instanceof FNRef)return{fnRef:t,match:e};if(void 0!==t&&e instanceof Object&&!(e instanceof Array||e instanceof NonAV)){var r=void 0;for(var n in e){if(void 0!==r)return;if(n in t&&(r=i(e[n],t[n]),void 0===r))return}return r}}if(!(t instanceof ElementReference&&e instanceof Object)||e instanceof NonAV||e instanceof Array)return interpretedQuery(e,t);var r=intGetArea(t);if(void 0===r)return[];var n=debugAreaInfo[r.template.id],o=i(e,n)||i({context:e},n);if(void 0===o)return[];var s=r.getExprByFNRef(o.fnRef,!0),a=s.result.value;return queryIsSelection(o.match)?interpretedBoolMatch(o.match,a)?[r.areaReference]:void 0:interpretedQuery(o.match,a)}function intQueryApply(e,t){var i=[];t instanceof Array||(t=[t]);for(var r=0;r<t.length;r++){var n=intApplyQuery(e,t[r]);void 0!==n&&(i=i.concat(n))}return i}function intQuery(e){return intQueryApply(interpretCDL(e[0]),interpretCDL(e[1]))}function debugObjAreaOfClass(e,t,i){var r={watcherId:getNextWatcherId(),dataSourceAware:!0,totalUpdateInputTime:0,attributedTime:0,updateInput:function(e,t){},debugName:function(){return"debugObjAreaOfClassWatcher"},getDebugOrigin:function(){return[]},isDeferred:function(){return!1},defer:function(){},undefer:function(){},isActive:function(){return!0},isReady:function(){return!0}};if(void 0!==e.exports&&"0"in e.exports){if(void 0===e.exports[0]&&!i)return gDebugObjClassesInactive++,!1;var n=e.getExport(0);if(t in n.inputByAttr){var o=n.inputByAttr[t];if(i){if(!o.isActive()&&i){try{o.forceActive(r,!1)||console.log("node not evaluated on time:",o.prototype.idStr())}catch(e){Utilities.warn(e.toString())}o.deactivate(r,!1)}}else 0===o.nrActiveWatchers&&gDebugObjClassesInactive++;return isTrue(o.result.value)}}return!1}function debugObjEmbedding(e){var t=e instanceof CoreArea?e:e instanceof ElementReference?intGetArea(e):void 0,i=[];if(void 0!==t){var r=t.embedding;void 0!==r&&i.push(r.areaId)}return i}function intEmbeddedFun(e){var t=e instanceof CoreArea?e:e instanceof ElementReference?intGetArea(e):void 0;return void 0===t?[]:t.getEmbeddedAreaList().map(function(e){return e.areaId})}function debugObjEmbeddingStar(e){var t=e instanceof CoreArea?e:e instanceof ElementReference?intGetArea(e):void 0,i=[];if(void 0!==t)for(var r=t.embedding;void 0!==r;)i.push(r.areaId),r=r.embedding;return i}function intAreaOfClass(e,t){var i=[],r=allAreaMonitor.getAllAreaIds();void 0===t&&(t=globalTaskQueue.pendingTasks.isEmpty()),resetDebugObjCache(),gDebugObjMgr.init(),gDebugObjClassesInactive=0;for(var n=0;n!=r.length;n++){var o=r[n],s=allAreaMonitor.getAreaById(o);debugObjAreaOfClass(s,e,t)&&i.push(intMakeAreaReference(s.areaId))}return gDebugObjClassesInactive>0&&console.warn("warning:",gDebugObjClassesInactive,"areas with inactive class function"),i}function intFuncAppl(e){function t(e,t){return void 0===t||void 0===t.value?[]:t.value instanceof Array?t.value.reduce(function(t,i){return t.concat(e(i))},[]):e(t.value)}var i=interpretCDL(e[0]),r=e.slice(1).map(interpretCDL).map(function(e){return new Result(normalizeObject(e))});if(!(i instanceof BuiltInFunction))return 1!==r.length?(console.log("cannot interpret function",i),[]):intQueryApply(i,r[0].value);var n=i.name;if(n in intFuncMap)return intFuncMap[n].execute(r);switch(n){case"areaOfClass":if(r[0]instanceof Result){var o=getDeOSedValue(r[0].value);return intAreaOfClass(o)}case"allAreas":return Object.keys(allAreaMonitor.allAreas).map(intMakeAreaReference);case"embeddingStar":return t(debugObjEmbeddingStar,r[0]).map(intMakeAreaReference);case"embedding":return t(debugObjEmbedding,r[0]).map(intMakeAreaReference);case"embedded":return t(intEmbeddedFun,r[0]).map(intMakeAreaReference)}console.log("cannot interpret function",n)}function dumpEventHistory(){console.log(JSON.stringify(gDomEvent.eventHistory))}function FakeDomEvent(e){for(var t in e)this[t]=e[t]}function fakeDomEventPreventDefault(){}function fakeDomEventStopPropagation(){}function fakeDomEventStopImmediatePropagation(){}function replayEventHistory(e){replayHistory=e,replayProgress=0,replayPosition=0,replayHistory instanceof Array&&replayHistory.length>0&&(replayTimeoutId=setTimeout(replayNextEvent,1,0))}function replayNextEvent(){if(tasksInQueue())return console.log("queue running"),void(replayTimeoutId=setTimeout(replayNextEvent,500));if(replayProgress=replayPosition/replayHistory.length,Math.floor((replayPosition-1)/(replayHistory.length/10))!==Math.floor(replayPosition/(replayHistory.length/10))&&console.log("progress",(100*replayProgress).toFixed(0)+"%"),replaySingleEvent(replayHistory[replayPosition]),replayPosition++,replayPosition<replayHistory.length){var e=0===replayPosition?0:replayHistory[replayPosition].time-replayHistory[replayPosition-1].time;e>500&&console.log("wait",e),e=tasksInQueue()?Math.min(e,1e3):Math.min(e,10),replayTimeoutId=setTimeout(replayNextEvent,e)}else console.log("replay done")}function replaySingleEvent(e){switch(e.type){case"mousemove":gDomEvent.mouseMoveHandler(new FakeDomEvent({type:"mousemove",clientX:e.absX,clientY:e.absY,time:e.time,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,ctrlKey:e.ctrlKey}));break;case"MouseUp":case"MouseDown":console.log(e.type),gDomEvent.mouseEventHandler(new FakeDomEvent({type:e.type.toLowerCase(),clientX:e.absX,clientY:e.absY,shiftKey:e.modifier.indexOf("shift")>=0,altKey:e.modifier.indexOf("alt")>=0,ctrlKey:e.modifier.indexOf("control")>=0,time:e.time}),e.type);break;case"wheel":console.log(e.type),gDomEvent.wheelEventHandler(new FakeDomEvent({type:e.type,absX:absX,absY:absY,deltaX:e.deltaX,deltaY:e.deltaY,deltaZ:e.deltaZ,deltaMode:deltaMode,shiftKey:e.modifier.indexOf("shift")>=0,altKey:e.modifier.indexOf("alt")>=0,ctrlKey:e.modifier.indexOf("control")>=0,time:e.time}));break;case"KeyUp":case"KeyDown":case"KeyPress":console.log(e.type),gDomEvent.keyEventHandler(new FakeDomEvent({type:e.type.toLowerCase(),key:e.key,char:e.char,which:e.which,charCode:e.charCode,location:e.location,repeat:e.repeat,shiftKey:e.modifier.indexOf("shift")>=0,altKey:e.modifier.indexOf("alt")>=0,ctrlKey:e.modifier.indexOf("control")>=0,time:e.time}),e.type,"KeyPress"===e.type?"char":"key","global");break;case"resizeScreenArea":for(console.log(e.type);window.innerWidth!==e.width||window.innerHeight!==e.height;){var t=!0;if(console.log("Window size is wrong; change to",e.width,"wide and",e.height,"high, or set success to","false to abort"),!t)return!1}break;case"comment":break;default:return console.log("error: unknown event type "+e.type),!1}return!0}function SplashScreenController(){this.showing=!0,this.timeoutId=void 0,this.showText=!0,this.currentAnimationIndex=0,this.initializationTime=Date.now(),this.lastSplashUpdate=Date.now(),this.firstSplash=this.lastSplashUpdate,this.timeoutId=setTimeout(refreshSplashScreen,splashScreenRefreshRateCheck)}function splashScreenControllerRefresh(){this.timeoutId=setTimeout(refreshSplashScreen,splashScreenRefreshRateCheck);var e=Date.now(),t=this.showText&&e-this.initializationTime>2e3;if(t){this.showText=!1;var i=document.getElementById("mondriaSplashScreenText");null!==i&&(i.hidden=!0)}var r=e-this.lastSplashUpdate;if(nextAnimationFrame=!this.showText&&r>=splashScreenRefreshRateAnimation,nextAnimationFrame){this.lastSplashUpdate=e;var n=document.getElementById("mondriaSplashScreenDots");null!==n&&(src=n.src,dir_name=src.substring(0,src.lastIndexOf("/")+1),frameIndexStr=this.currentAnimationIndex.toString(),n.src=dir_name+"three_dots_"+frameIndexStr+".svg"),this.currentAnimationIndex+=1,4==this.currentAnimationIndex&&(this.currentAnimationIndex=1)}}function splashScreenControllerHide(){if(void 0!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.showing){var e=Date.now();console.log("splash screen hidden after",e-this.firstSplash,"ms"),this.showing=!1}}function splashScreenControllerFeedback(e){var t=document.getElementById("mondriaSplashScreenText"),i=document.getElementById("mondriaSplashScreenDots");null!==t&&(t.innerText=e,t.hidden=void 0===e,this.showText=void 0===e),null!==i&&(i.hidden=void 0!==e)}function refreshSplashScreen(){gSplashScreenController.refresh()}function hideSplashScreen(){var e=document.getElementById("mondriaSplashScreenBackground");null!==e&&(e.remove(),unhideMondriaRootDiv(),gSplashScreenController.hide(),gDomEvent.updateFocus())}function debugNoPendingTasksNotification(){if(mondriaOnLoadDate&&!EvaluationDatasourceInfo.hasDataloadInProgress()){var e=new Date;if(void 0!==lastEventDescription)return lastEventDescription=void 0,void(mondriaOnLoadDate=void 0);if(mMessage("Time from onload to idle = "+(e.getTime()-mondriaOnLoadDate.getTime())+"ms"),"undefined"!=typeof nodeTimeKitModule&&nodeTimeKitModule){var t=nodeTimeKitModule.cputime();console.log("CPU time from onload = "+Math.round((t-mondriaT0)/1e3)+" ms"),mondriaT0=t}console.log("Executing '"+gArgParser.getAppName()+"'"),testParamsDescStr="parameters:";for(var i=gArgParser.getArgList(),r=0;r<i.length;r++){var n=i[r];if(""!==n){var o=gArgParser.getArg(n);testParamsDescStr+=" "+n+"="+String(o)}}console.log(testParamsDescStr),mondriaOnLoadDate=void 0,appStart=Date.now(),!runTests||EvaluationDatasourceInfo.hasDataloadInProgress()||testSingleStep||(testDurationGuardTime=Date.now()+maxTestDuration,scheduleTestTask())}}function clearProgressDiv(){void 0!==gRunningDiv&&null!==gRunningDiv?(gDomEvent.recordShowRunningDiv(0),gRunningDiv.style.opacity=0,gRunningDiv.hidden=!0,gRunIndicatorHidden1=!0,gRunIndicatorHidden2=!0,void 0!==gSpinnerElt&&null!==gSpinnerElt?gSpinnerElt.hidden=!0:gRunningDiv.style.cursor="default"):void 0!==gEventDivStyleCursor&&(gEventDiv.style.cursor=gEventDivStyleCursor,gEventDivStyleCursor=void 0),gTimeQueueStarted=Date.now()}function taskQueueEmptyHook(){void 0===gProgressDiv&&(gProgressDiv=document.getElementById("progress")),null!==gProgressDiv&&(gProgressDiv.parentNode.removeChild(gProgressDiv),gProgressDiv=null),clearProgressDiv(),gTimeQueueStarted=void 0,suppressRunningUntil=void 0}function unsubcribeResourceHook(){globalConcludeInitPhaseTask.schedule()}function unhideMondriaRootDiv(){mondriaRootDiv=document.getElementById("mondriaRootDiv"),null!==mondriaRootDiv&&(mondriaRootDiv.hidden=!1,mondriaRootDiv.style.visibility="visible")}function taskQueueInitProgressHook(e){if(void 0===gRunningDiv&&(gRunningDiv=document.getElementById("mondriaTaskRunningDiv"),gSpinnerElt=document.getElementById("mondriaTaskSpinnerElt"),gRunIndicatorHidden1=!0,null!==gRunningDiv&&(gDomEvent.addEventHandlers(gRunningDiv),gRunningDiv.hidden=!0),gEventDiv=gDomEvent.eventDiv),void 0===gProgressDiv&&(gProgressDiv=document.getElementById("progress"),gProgressIndicator=document.getElementById("progressBar")),null!==gProgressIndicator&&e>lastProgressIndicator){var t=.8/(1+Math.exp(-10*(e/100-.6)))+.1;gProgressIndicator.style.width=100*t+"%",lastProgressIndicator=e}}function taskQueueRunningHook(){var e=document.getElementById("mondriaSplashScreenDiv");if(null===e&&(void 0===gProgressDiv||null===gProgressDiv)){if(void 0!==suppressRunningUntil){if(suppressRunningUntil>Date.now())return;suppressRunningUntil=void 0}null!==gRunningDiv?void 0===gTimeQueueStarted?gTimeQueueStarted=Date.now():gRunIndicatorHidden1?Date.now()-gTimeQueueStarted>=250&&(gRunningDiv.style.opacity=0,gOpacitySet=!1,gRunningDiv.hidden=!1,gRunIndicatorHidden1=!1,gDomEvent.recordShowRunningDiv(1)):(gOpacitySet||(gRunningDiv.style.opacity=.5,gOpacitySet=!0),gRunIndicatorHidden2&&Date.now()-gTimeQueueStarted>=1e3&&(gRunIndicatorHidden2=!1,void 0!==gSpinnerElt&&null!==gSpinnerElt?(gSpinnerElt.hidden=!1,gDomEvent.recordShowRunningDiv(2)):gRunningDiv.style.cursor="wait")):void 0===gTimeQueueStarted?gTimeQueueStarted=Date.now():gRunIndicatorHidden2&&Date.now()-gTimeQueueStarted>=500&&(gRunIndicatorHidden2=!1,void 0===gEventDivStyleCursor&&(gEventDivStyleCursor=gEventDiv.style.cursor,gEventDiv.style.cursor="wait"))}}function showRunningDivNow(){gRunningDiv&&(gRunIndicatorHidden1&&(gRunningDiv.style.opacity=0,gOpacitySet=!1,gRunningDiv.hidden=!1,gRunIndicatorHidden1=!1),gOpacitySet||(gRunningDiv.style.opacity=.5,gOpacitySet=!0),gRunIndicatorHidden2=!1,gSpinnerElt.hidden=!1,gDomEvent.recordShowRunningDiv(2))}function userAlert(e){alert(e)}var SystemEventHandler=function(){function e(){}return e}(),SystemEvents=function(){function e(){this.nextSystemEventHandlerId=0,this.eventHandlers=new Map,this.lastEventInfo=new Map}return e.prototype.addHandler=function(e,t,i){var r=this.nextSystemEventHandlerId++;return this.eventHandlers.has(e)||this.eventHandlers.set(e,new Map),this.eventHandlers.get(e).set(r,{id:r,handler:t,userInfo:i}),r},e.prototype.removeHandler=function(e,t){this.eventHandlers.has(e)&&this.eventHandlers.get(e).delete(t)},e.prototype.notifyHandlers=function(e,t){for(var i=0;i<e.length;i++){var r=e[i];this.eventHandlers.has(r)&&this.eventHandlers.get(r).forEach(function(e){e.handler(e.id,void 0===t?void 0:t[i],e.userInfo)})}this.lastEventInfo.set(r,{count:this.getEventCount(r)+1,eventInfo:t})},e.prototype.getEventCount=function(e){return this.lastEventInfo.has(e)?this.lastEventInfo.get(e).count:0},e.prototype.getLatestEventInfo=function(e){return this.lastEventInfo.has(e)?this.lastEventInfo.get(e).eventInfo:void 0},e}(),globalSystemEvents=new SystemEvents;!function(e){"use strict";function t(e,t){function i(e){return t.bgcolor&&(e.style.backgroundColor=t.bgcolor),t.width&&(e.style.width=t.width+"px"),t.height&&(e.style.height=t.height+"px"),t.style&&Object.keys(t.style).forEach(function(i){e.style[i]=t.style[i]}),e}return t=t||{},s(t),Promise.resolve(e).then(function(e){return d(e,t.filter,!0)}).then(u).then(h).then(i).then(function(i){
return l(i,t.width||g.width(e),t.height||g.height(e))})}function i(e,t){return a(e,t||{}).then(function(t){return t.getContext("2d").getImageData(0,0,g.width(e),g.height(e)).data})}function r(e,t){return a(e,t||{}).then(function(e){return e.toDataURL()})}function n(e,t){return t=t||{},a(e,t).then(function(e){return e.toDataURL("image/jpeg",t.quality||1)})}function o(e,t){return a(e,t||{}).then(g.canvasToBlob)}function s(e){"undefined"==typeof e.imagePlaceholder?C.impl.options.imagePlaceholder=b.imagePlaceholder:C.impl.options.imagePlaceholder=e.imagePlaceholder,"undefined"==typeof e.cacheBust?C.impl.options.cacheBust=b.cacheBust:C.impl.options.cacheBust=e.cacheBust}function a(e,i){function r(e){var t=document.createElement("canvas");if(t.width=i.width||g.width(e),t.height=i.height||g.height(e),i.bgcolor){var r=t.getContext("2d");r.fillStyle=i.bgcolor,r.fillRect(0,0,t.width,t.height)}return t}return t(e,i).then(g.makeImage).then(g.delay(100)).then(function(t){var i=r(e);return i.getContext("2d").drawImage(t,0,0),i})}function d(e,t,i){function r(e){return e instanceof HTMLCanvasElement?g.makeImage(e.toDataURL()):e.cloneNode(!1)}function n(e,t,i){function r(e,t,i){var r=Promise.resolve();return t.forEach(function(t){r=r.then(function(){return d(t,i)}).then(function(t){t&&e.appendChild(t)})}),r}var n=e.childNodes;return 0===n.length?Promise.resolve(t):r(t,g.asArray(n),i).then(function(){return t})}function o(e,t){function i(){function i(e,t){function i(e,t){g.asArray(e).forEach(function(i){t.setProperty(i,e.getPropertyValue(i),e.getPropertyPriority(i))})}e.cssText?t.cssText=e.cssText:i(e,t)}i(window.getComputedStyle(e),t.style)}function r(){function i(i){function r(e,t,i){function r(e){var t=e.getPropertyValue("content");return e.cssText+" content: "+t+";"}function n(e){function t(t){return t+": "+e.getPropertyValue(t)+(e.getPropertyPriority(t)?" !important":"")}return g.asArray(e).map(t).join("; ")+";"}var o="."+e+":"+t,s=i.cssText?r(i):n(i);return document.createTextNode(o+"{"+s+"}")}var n=window.getComputedStyle(e,i),o=n.getPropertyValue("content");if(""!==o&&"none"!==o){var s=g.uid();t.className=t.className+" "+s;var a=document.createElement("style");a.appendChild(r(s,i,n)),t.appendChild(a)}}[":before",":after"].forEach(function(e){i(e)})}function n(){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}function o(){t instanceof SVGElement&&(t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t instanceof SVGRectElement&&["width","height"].forEach(function(e){var i=t.getAttribute(e);i&&t.style.setProperty(e,i)}))}return t instanceof Element?Promise.resolve().then(i).then(r).then(n).then(o).then(function(){return t}):t}return i||!t||t(e)?Promise.resolve(e).then(r).then(function(i){return n(e,i,t)}).then(function(t){return o(e,t)}):Promise.resolve()}function u(e){return y.resolveAll().then(function(t){var i=document.createElement("style");return e.appendChild(i),i.appendChild(document.createTextNode(t)),e})}function h(e){return I.inlineAll(e).then(function(){return e})}function l(e,t,i){return Promise.resolve(e).then(function(e){return e.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(e)}).then(g.escapeXhtml).then(function(e){return'<foreignObject x="0" y="0" width="100%" height="100%">'+e+"</foreignObject>"}).then(function(e){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+t+'" height="'+i+'">'+e+"</svg>"}).then(function(e){return"data:image/svg+xml;charset=utf-8,"+e})}function c(){function e(){var e="application/font-woff",t="image/jpeg";return{woff:e,woff2:e,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:t,jpeg:t,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function t(e){var t=/\.([^\.\/]*?)$/g.exec(e);return t?t[1]:""}function i(i){var r=t(i).toLowerCase();return e()[r]||""}function r(e){return e.search(/^(data:)/)!==-1}function n(e){return new Promise(function(t){for(var i=window.atob(e.toDataURL().split(",")[1]),r=i.length,n=new Uint8Array(r),o=0;o<r;o++)n[o]=i.charCodeAt(o);t(new Blob([n],{type:"image/png"}))})}function o(e){return e.toBlob?new Promise(function(t){e.toBlob(t)}):n(e)}function s(e,t){var i=document.implementation.createHTMLDocument(),r=i.createElement("base");i.head.appendChild(r);var n=i.createElement("a");return i.body.appendChild(n),r.href=t,n.href=e,n.href}function a(){var e=0;return function(){function t(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}return"u"+t()+e++}}function d(e){return new Promise(function(t,i){var r=new Image;r.onload=function(){t(r)},r.onerror=i,r.src=e})}function u(e){var t=3e4;return C.impl.options.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime()),new Promise(function(i){function r(){if(4===s.readyState){if(200!==s.status)return void(a?i(a):o("cannot fetch resource: "+e+", status: "+s.status));var t=new FileReader;t.onloadend=function(){var e=t.result.split(/,/)[1];i(e)},t.readAsDataURL(s.response)}}function n(){a?i(a):o("timeout of "+t+"ms occured while fetching resource: "+e)}function o(e){console.error(e),i("")}var s=new XMLHttpRequest;s.onreadystatechange=r,s.ontimeout=n,s.responseType="blob",s.timeout=t,s.open("GET",e,!0),s.send();var a;if(C.impl.options.imagePlaceholder){var d=C.impl.options.imagePlaceholder.split(/,/);d&&d[1]&&(a=d[1])}})}function h(e,t){return"data:"+t+";base64,"+e}function l(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function c(e){return function(t){return new Promise(function(i){setTimeout(function(){i(t)},e)})}}function p(e){for(var t=[],i=e.length,r=0;r<i;r++)t.push(e[r]);return t}function f(e){return e.replace(/#/g,"%23").replace(/\n/g,"%0A")}function v(e){var t=m(e,"border-left-width"),i=m(e,"border-right-width");return e.scrollWidth+t+i}function g(e){var t=m(e,"border-top-width"),i=m(e,"border-bottom-width");return e.scrollHeight+t+i}function m(e,t){var i=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(i.replace("px",""))}return{escape:l,parseExtension:t,mimeType:i,dataAsUrl:h,isDataUrl:r,canvasToBlob:o,resolveUrl:s,getAndEncode:u,uid:a(),delay:c,asArray:p,escapeXhtml:f,makeImage:d,width:v,height:g}}function p(){function e(e){return e.search(n)!==-1}function t(e){for(var t,i=[];null!==(t=n.exec(e));)i.push(t[1]);return i.filter(function(e){return!g.isDataUrl(e)})}function i(e,t,i,r){function n(e){return new RegExp("(url\\(['\"]?)("+g.escape(e)+")(['\"]?\\))","g")}return Promise.resolve(t).then(function(e){return i?g.resolveUrl(e,i):e}).then(r||g.getAndEncode).then(function(e){return g.dataAsUrl(e,g.mimeType(t))}).then(function(i){return e.replace(n(t),"$1"+i+"$3")})}function r(r,n,o){function s(){return!e(r)}return s()?Promise.resolve(r):Promise.resolve(r).then(t).then(function(e){var t=Promise.resolve(r);return e.forEach(function(e){t=t.then(function(t){return i(t,e,n,o)})}),t})}var n=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:r,shouldProcess:e,impl:{readUrls:t,inline:i}}}function f(){function e(){return t(document).then(function(e){return Promise.all(e.map(function(e){return e.resolve()}))}).then(function(e){return e.join("\n")})}function t(){function e(e){return e.filter(function(e){return e.type===CSSRule.FONT_FACE_RULE}).filter(function(e){return m.shouldProcess(e.style.getPropertyValue("src"))})}function t(e){var t=[];return e.forEach(function(e){try{g.asArray(e.cssRules||[]).forEach(t.push.bind(t))}catch(t){console.log("Error while reading CSS rules from "+e.href,t.toString())}}),t}function i(e){return{resolve:function(){var t=(e.parentStyleSheet||{}).href;return m.inlineAll(e.cssText,t)},src:function(){return e.style.getPropertyValue("src")}}}return Promise.resolve(g.asArray(document.styleSheets)).then(t).then(e).then(function(e){return e.map(i)})}return{resolveAll:e,impl:{readAll:t}}}function v(){function e(e){function t(t){return g.isDataUrl(e.src)?Promise.resolve():Promise.resolve(e.src).then(t||g.getAndEncode).then(function(t){return g.dataAsUrl(t,g.mimeType(e.src))}).then(function(t){return new Promise(function(i,r){e.onload=i,e.onerror=r,e.src=t})})}return{inline:t}}function t(i){function r(e){var t=e.style.getPropertyValue("background");return t?m.inlineAll(t).then(function(t){e.style.setProperty("background",t,e.style.getPropertyPriority("background"))}).then(function(){return e}):Promise.resolve(e)}return i instanceof Element?r(i).then(function(){return i instanceof HTMLImageElement?e(i).inline():Promise.all(g.asArray(i.childNodes).map(function(e){return t(e)}))}):Promise.resolve(i)}return{inlineAll:t,impl:{newImage:e}}}var g=c(),m=p(),y=f(),I=v(),b={imagePlaceholder:void 0,cacheBust:!1},C={toSvg:t,toPng:r,toJpeg:n,toBlob:o,toPixelData:i,impl:{fontFaces:y,images:I,util:g,inliner:m,options:{}}};"undefined"!=typeof module?module.exports=C:e.domtoimage=C}(this);var saveAs=saveAs||function(e){"use strict";if(!("undefined"==typeof e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,i=function(){return e.URL||e.webkitURL||e},r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),n="download"in r,o=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},s=/constructor/i.test(e.HTMLElement)||e.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent),d=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},u="application/octet-stream",h=4e4,l=function(e){var t=function(){"string"==typeof e?i().revokeObjectURL(e):e.remove()};setTimeout(t,h)},c=function(e,t,i){t=[].concat(t);for(var r=t.length;r--;){var n=e["on"+t[r]];if("function"==typeof n)try{n.call(e,i||e)}catch(e){d(e)}}},p=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},f=function(t,d,h){h||(t=p(t));var f,v=this,g=t.type,m=g===u,y=function(){c(v,"writestart progress write writeend".split(" "))},I=function(){if((a||m&&s)&&e.FileReader){var r=new FileReader;return r.onloadend=function(){var t=a?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;"),i=e.open(t,"_blank");i||(e.location.href=t),t=void 0,v.readyState=v.DONE,y()},r.readAsDataURL(t),void(v.readyState=v.INIT)}if(f||(f=i().createObjectURL(t)),m)e.location.href=f;else{var n=e.open(f,"_blank");n||(e.location.href=f)}v.readyState=v.DONE,y(),l(f)};return v.readyState=v.INIT,n?(f=i().createObjectURL(t),void setTimeout(function(){r.href=f,r.download=d,o(r),y(),l(f),v.readyState=v.DONE})):void I()},v=f.prototype,g=function(e,t,i){return new f(e,t||e.name||"download",i)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,i){return t=t||e.name||"download",i||(e=p(e)),navigator.msSaveOrOpenBlob(e,t)}:(v.abort=function(){},v.readyState=v.INIT=0,v.WRITING=1,v.DONE=2,v.error=v.onwritestart=v.onprogress=v.onwrite=v.onabort=v.onerror=v.onwriteend=null,g)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return saveAs});var copiedPrototypeHash={},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ResourcePath=function(){function e(e,t,i){this.hierarchy=e,this.baseName=t,this.extension=i}return e.prototype.up=function(){var e=this.clone();return e.hierarchy.pop(),e},e.prototype.down=function(e){var t=this.clone();return t.hierarchy=t.hierarchy.concat(e),t},e.prototype.replaceExtension=function(e){var t=this.clone();return t.extension=e,t},e}(),PathFunctions=function(){function e(){}return e}(),URLResourcePath=function(e){function t(t,i,r,n,o){var s=e.call(this,i,r,n)||this;return s.protocol=t,s.args=o,s}return __extends(t,e),t.prototype.getResourceString=function(){return this.protocol+"://"+(0===this.hierarchy.length?"":this.hierarchy.map(encodeURIComponent).join("/")+"/")+this.baseName+(void 0===this.extension?"":"."+this.extension)+(void 0===this.args?"":"?"+this.args)},t.prototype.clone=function(){return new t(this.protocol,this.hierarchy.map(decodeURIComponent),this.baseName,this.extension,this.args)},t.prototype.getURLResourcePath=function(){return this},t}(ResourcePath),URLPathFunctions=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getPath=function(e){var t,i,r,n,o,s,a,d=e.match(/^[a-z]+:\/\//);if(null!==d)return t=d[0].slice(0,-3),e=e.slice(d[0].length),s=e.indexOf("?"),s>=0&&(o=e.slice(s+1),e=e.slice(0,s)),i=e.split("/"),r=i.pop(),a=void 0===r?-1:r.lastIndexOf("."),a>=0&&(n=r.slice(a+1),r=r.slice(0,a)),new URLResourcePath(t,i,r,n,o)},t}(PathFunctions),OSResourcePath=function(e){function t(t,i,r,n){var o=e.call(this,i,r,n)||this;return o.isWindows=t,o}return __extends(t,e),t.prototype.getResourceString=function(){var e=this.isWindows?"\\":"/";return(0===this.hierarchy.length?"":this.hierarchy.join(e)+e)+this.baseName+(void 0===this.extension?"":"."+this.extension)},t.prototype.clone=function(){return new t(this.isWindows,this.hierarchy,this.baseName,this.extension)},t.prototype.getURLResourcePath=function(){return new URLResourcePath("file",this.hierarchy,this.baseName,this.extension,void 0)},t}(ResourcePath),OSPathFunctions=function(e){function t(t){var i=e.call(this)||this;return i.isWindows=t,i}return __extends(t,e),t.prototype.getPath=function(e){var t,i,r;t=e.split(this.isWindows?/\\\\|\//:/\//),i=t.pop();var n=void 0===i?-1:i.lastIndexOf(".");return n>=0&&(r=i.slice(n+1),i=i.slice(0,n)),new OSResourcePath(this.isWindows,t,i,r)},t}(PathFunctions),runtimeEnvironment={},performance;if("undefined"!=typeof window){runtimeEnvironment.appName=window.location.href;var endOfURL=runtimeEnvironment.appName.indexOf("?");endOfURL===-1&&(endOfURL=runtimeEnvironment.appName.length),runtimeEnvironment.name="browser",runtimeEnvironment.dirName=runtimeEnvironment.appName.slice(0,runtimeEnvironment.appName.lastIndexOf("/",endOfURL)+1),runtimeEnvironment.appName=runtimeEnvironment.appName.slice(runtimeEnvironment.dirName.length,endOfURL),runtimeEnvironment.appName=runtimeEnvironment.appName.slice(0,Math.min(runtimeEnvironment.appName.length,runtimeEnvironment.appName.lastIndexOf("."))),runtimeEnvironment.pathFunctions=new URLPathFunctions;var require=function(){}}else"undefined"!=typeof process&&(runtimeEnvironment.appName=process.argv[1],runtimeEnvironment.name="nodejs",runtimeEnvironment.dirName="file://"+(process.platform.startsWith("win")?__dirname.replace(/\\/g,"/"):__dirname)+"/",runtimeEnvironment.pathFunctions=new OSPathFunctions(process.platform.startsWith("win")));runtimeEnvironment.nodeWebSocketState=function(e){switch(e){case"open":return 1;case"closing":return 2;case"closed":return 3;default:return-2}};var btoa,atob,isJSONSupported,isSVGSupported,isSvgweb,svgNS,isInternetExplorer,useConsoleLog,useConsoleLogApply,useOperaPostError,useSetAttribute,userLocale,secondModifierKey="undefined"!=typeof navigator&&"MacIntel"==navigator.platform?"meta":"control";"log10"in Math||(Math.log10=function(e){return Math.log(e)/Math.LN10}),"undefined"!=typeof navigator&&"function"==typeof navigator.getBattery&&navigator.getBattery().then(function(e){globalSystemEvents.notifyHandlers(["power disconnected"],[!e.charging]),e.addEventListener("chargingchange",function(){globalSystemEvents.notifyHandlers(["power disconnected"],[!e.charging])})});var globalDebugTracingLog;DebugTracingLog.prototype.newCycle=debugTracingLogNewCycle,DebugTracingLog.prototype.pushNextLog=debugTracingLogPushNextLog,DebugTracingLog.prototype.openSection=debugTracingLogOpenSection,DebugTracingLog.prototype.closeSection=debugTracingLogCloseSection;var gBR=new Object;DebugTracingLog.prototype.message=debugTracingLogMessage,DebugTracingLog.prototype.incCounter=debugTracingLogIncCounter,DebugTracingLog.prototype.incHistogramCounter=debugTracingLogIncHistogramCounter,DebugTracingLog.prototype.recordStatistics=debugTracingLogRecordStatistics,DebugTracing.prototype.debugNewCycle=debugTracingDebugNewCycle,DebugTracing.prototype.debugOpenLogSection=debugTracingDebugOpenLogSection,DebugTracing.prototype.debugCloseLogSection=debugTracingDebugCloseLogSection,DebugTracing.prototype.debugPushNextLog=debugTracingDebugPushNextLog,DebugTracing.prototype.debugMessage=debugTracingDebugMessage,DebugTracing.prototype.debugIncCounter=debugTracingDebugIncCounter,DebugTracing.prototype.debugIncHistogramCounter=debugTracingDebugIncHistogramCounter,DebugTracing.prototype.debugRecordStatistics=debugTracingDebugRecordStatistics,SortedList.prototype.clear=sortedListClear,SortedList.prototype.getNextIteratorId=sortedListGetNextIteratorId,SortedList.prototype.getNode=sortedListGetNode,SortedList.prototype.getEntry=sortedListGetEntry,SortedList.prototype.getNodePath=sortedListGetNodePath,SortedList.prototype.insert=sortedListInsert,SortedList.prototype.changeSortVal=SortedListChangeSortVal,SortedList.prototype.changeNodeSortVal=SortedListChangeNodeSortVal,SortedList.prototype.remove=sortedListRemove,SortedList.prototype.removeWhenLabelInPath=sortedListRemoveWhenLabelInPath,SortedList.prototype.removeWhenLabelInPathFromNode=sortedListRemoveWhenLabelInPathFromNode,SortedList.prototype.removeNodesUnder=sortedListRemoveNodesUnder,SortedList.prototype.insertBefore=sortedListInsertBefore,SortedList.prototype.removeNodeFromList=sortedListRemoveNodeFromList,SortedList.prototype.transferIteratorsToPrevNode=sortedListTransferIteratorsToPrevNode,SortedList.prototype.isEmpty=sortedListIsEmpty,SortedList.prototype.isBeforePos=sortedListIsBoforePos,SortedList.prototype.isAfterPos=sortedListIsAfterPos,SortedList.prototype.positionCompare=sortedListPositionCompare,SortedList.prototype.pathPositionCompare=sortedListPathPositionCompare,SortedList.prototype.valsEqual=sortedListValsEqual,SortedList.prototype.valLessThan=sortedListValLessThan,SortedList.prototype.valLessOrEqual=sortedListValLessOrEqual,SortedList.prototype.debugPrint=sortedListDebugPrint,SortedListIter.prototype.destroy=sortedListIterDestroy,SortedListIter.prototype.next=sortedListIterNext,SortedListIter.prototype.getNode=sortedListIterGetNode,inherit(PairSortedList,SortedList),PairSortedList.prototype.valsEqual=pairSortedListValsEqual,PairSortedList.prototype.valLessThan=pairSortedListValLessThan,PairSortedList.prototype.valLessOrEqual=pairSortedListValLessOrEqual;var gArgParser=void 0,actualArgumentValues={};ArgvParser.prototype.getArg=argvParserGetArg,ArgvParser.prototype.hasArg=argvParserHasArg,ArgvParser.prototype.getArgv=argvParserGetArgv,ArgvParser.prototype.getRawArgv=argvParserGetRawArgv,ArgvParser.prototype.getArgList=argvParserGetArgList,ArgvParser.prototype.getAppName=argvParserGetAppName,UrlArgParser.prototype.getArg=urlArgParserGetArg,UrlArgParser.prototype.hasArg=urlArgParserHasArg,UrlArgParser.prototype.getArgv=urlArgParserGetArgv,UrlArgParser.prototype.getRawArgv=urlArgParserGetRawArgv,UrlArgParser.prototype.getArgList=urlArgParserGetArgList,UrlArgParser.prototype.getAppName=urlArgParserGetAppName,IdMgr.prototype.allocate=idMgrAllocate,IdMgr.prototype.free=idMgrFree,IdMgr.prototype.count=idMgrCount;var doDebugging=!1,debugCounter=0,maxDebugCount=4e3,gProfiling,ConsoleLogAttributes={__Explanation__:"<logging-level (-1 for none)>, <RegExp-Filter (if exists)>",constraints:[-1,"/area.[lr]/"],setLabel:[-1],classNameModifier:[-1],mouse:[0],eventsHandler:[-1],triggers:[-1],executePendingTasks:[-1],conditionMatcher:[-1]},compiledConsoleLogAttributesFilters={},prevConsoleLogAttributeFilter={};AssertException.prototype.toString=function(){return"AssertException: "+this.message};var DebugObj_isDebuggingAreaUnderMouse=!1,gDebugObjMgr,debugObjCache;DebugObjMgr.nViolationMessages=10,DebugObjMgr.prototype.init=function(){this.drawFrame(!1),this.initCache(),this.embeddingDepth=0},DebugObjMgr.prototype.initCache=function(){"undefined"==typeof this.allDebugObjAreas&&(this.allDebugObjAreas={}),this.syncCount===globalPosConstraintSynchronizer.count&&"undefined"!=typeof this.constraints||(this.constraints=new DebugObjConstraint,this.constraints.init(),this.syncCount=globalPosConstraintSynchronizer.count)},DebugObjMgr.prototype.resetCache=function(){delete this.allDebugObjAreas},DebugObjMgr.prototype.verifyConsistency=function(){this.constraints.verifyConsistency()},DebugObjMgr.prototype.drawFrame=function(e,t,i,r,n){void 0===this.divsArr&&(this.divsArr=[]);var o=(this.divsArr,document.getElementsByTagName("body")[0]);if(e&&r){var s=document.createElement("div");s.style.overflow="visible",s.style.position="absolute",s.style.backgroundColor="#000000",s.style.color="#ffffff",s.style.textAlign="center",s.style.verticalAlign="middle",s.style.opacity=.5,s.style.zIndex=2e8,s.style.borderStyle="dotted",s.style.borderWidth="1px",s.style.borderColor="#ffffff",s.style.borderSpacing="0px",s.style.margin="0px";for(var a in n)s.style[a]=n[a];o.appendChild(s),this.divsArr.push(s),void 0===n||"object"==typeof n&&""!==n.borderStyle?(s.style.left=r.absLeft-1+"px",s.style.top=r.absTop-1+"px"):(s.style.left=r.absLeft+"px",s.style.top=r.absTop+"px"),s.style.width=r.width+"px",s.style.height=r.height+"px"}else{if(this.divsArr)for(var d=0;d<this.divsArr.length;d++)o.removeChild(this.divsArr[d]);this.divsArr=[]}},DebugObjMgr.prototype.getArea=function(e,t,i){var r=this.allDebugObjAreas[e];return r&&r.nesting<=gDebugObjMgr.embeddingDepth?r.obj:(new DebugObjArea(e,t,i),this.allDebugObjAreas[e].obj)};var gDebugObjClassesInactive=0,gPointNameMap=void 0;DebugObjConstraint.prototype.init=debugObjConstraintInit,DebugObjConstraint.prototype.mapConstraintIds=debugObjConstraintMapConstraintIds,DebugObjConstraint.prototype.mapPointLabels=debugObjConstraintMapPointLabels,DebugObjConstraint.prototype.readAllLinearConstraints=debugObjConstraintReadAllLinearConstraints,DebugObjConstraint.prototype.readAllSegmentConstraints=debugObjConstraintReadAllSegmentConstraints,DebugObjConstraint.prototype.fillInPointersToPoints=debugObjConstraintFillInPointersToPoints,DebugObjConstraint.prototype.fillInPairsCycles=debugObjConstraintFillInPairsCycles,DebugObjConstraint.prototype.addPairCycles=DebugObjConstraintAddPairCycles,DebugObjConstraint.prototype.getPointEntry=debugObjConstraintGetPointEntry,DebugObjConstraint.prototype.getFullName=debugObjConstraintGetFullName;var getPointConstraintIDRegExp,getPointAreaIDRegExp;DebugObjConstraint.prototype.getPointAreaID=debugObjConstraintGetPointAreaID;var singleConstraintLabelsIgnore="";DebugObjConstraint.prototype.verifyConsistency=debugObjMgrVerifyConsistency,DebugObjConstraint.prototype.addSegmentViolation=debugObjConstraintAddSegmentViolation,DebugObjConstraint.prototype.fillInViolations=debugObjConstraintFillInViolations,DebugObjConstraint.prototype.getConstraintOfArea=debugObjConstraintGetConstraintOfArea,DebugObjConstraint.prototype.visualizeConstraints=debugObjConstraintVisualizeConstraints;var ConsoleLogAttributes={__Explanation__:"<logging-level (-1 for none)>, <RegExp-Filter (if exists)>",constraints:[-1,"/area.[lr]/"],setLabel:[-1],classNameModifier:[-1],mouse:[0],eventsHandler:[-1],triggers:[-1],executePendingTasks:[-1],conditionMatcher:[-1]},maxErrorReports=200,maxAlertPopups=3,debugPrintStackStrace=!0,errorsReported=0,alertMessageCounter=0,mondriaInternalErrorCounter=0,RemotePaidInterface=function(){function e(e){this.paidMgr=e,this.definedTemplates=new Set,this.definedIndices=new Set,this.remoteToLocalTemplateId=new Map,this.remoteToLocalIndexId=new Map,this.resetChannel()}return e.prototype.resetChannel=function(){this.definedTemplates.clear(),this.definedTemplates.add(1),this.definedIndices.clear(),this.definedIndices.add(1),this.remoteToLocalTemplateId.clear(),this.remoteToLocalTemplateId.set(1,1),this.remoteToLocalIndexId.clear(),this.remoteToLocalIndexId.set(1,1),this.templatesToTransmit=void 0,this.indicesToTransmit=void 0},e.prototype.defineTemplate=function(e){if(!this.definedTemplates.has(e)){var t=this.paidMgr.getTemplateEntry(e);if(void 0===t)return void RemotingLog.log(1,"defineTemplate: templateId: "+e+" lacks a template entry");this.definedTemplates.add(e),this.defineTemplate(t.parentId),void 0!==t.referredId&&null!==t.referredId&&this.defineTemplate(t.referredId),void 0===this.templatesToTransmit&&(this.templatesToTransmit=[]),this.templatesToTransmit.push(e)}},e.prototype.defineIndex=function(e){if(!this.definedIndices.has(e)){var t=this.paidMgr.getIndexEntry(e);if(void 0===t)return void RemotingLog.log(1,"defineIndex: indexId: "+e+" lacks a template entry");this.definedIndices.add(e),this.defineIndex(t.prefixId),void 0!==t.compose&&this.defineIndex(t.compose),void 0===this.indicesToTransmit&&(this.indicesToTransmit=[]),this.indicesToTransmit.push(e)}},e.getXDRTemplateDefinition=function(e,t){var i=e.getTemplateEntry(t),r={templateId:t,parentId:i.parentId,childType:i.childType,childName:i.childName};return void 0!==i.referredId&&null!==i.referredId&&(r.referredId=i.referredId),r},e.getXDRIndexDefinition=function(e,t){var i=e.getIndexEntry(t),r={indexId:t,prefixId:i.prefixId};return void 0!==i.append&&(r.append=i.append),void 0!==i.compose&&null!==i.compose&&(r.compose=i.compose),r},e.prototype.getTemplateIndexIdUpdates=function(){if(void 0!==this.templatesToTransmit||void 0!==this.indicesToTransmit){var t;if(void 0!==this.templatesToTransmit){var i=this.paidMgr;t=this.templatesToTransmit.map(function(t){return e.getXDRTemplateDefinition(i,t)}),this.templatesToTransmit=void 0}else t=[];if(void 0!==this.indicesToTransmit){var i=this.paidMgr;t=t.concat(this.indicesToTransmit.map(function(t){return e.getXDRIndexDefinition(i,t)})),this.indicesToTransmit=void 0}return t}},e.prototype.getAllTemplateIndexIds=function(){var t=this.paidMgr,i=[],r=[];return this.definedTemplates.forEach(function(e){return i.push(e)}),i.sort(function(e,t){return e-t}),this.definedIndices.forEach(function(e){return r.push(e)}),r.sort(function(e,t){return e-t}),i.map(function(i){return e.getXDRTemplateDefinition(t,i)}).concat(r.map(function(i){return e.getXDRIndexDefinition(t,i)}))},e.prototype.translateTemplate=function(e){if(void 0!==e){var t=this.remoteToLocalTemplateId.get(e);return assert(void 0!==t,"translateTemplate: undefined local template id: "+JSON.stringify(e)),t}},e.prototype.translateIndex=function(e){if(void 0!==e){var t=this.remoteToLocalIndexId.get(e);return assert(void 0!==t,"translateTemplate: undefined local template id: "+JSON.stringify(e)),t}},e.prototype.addRemoteTemplateDefinition=function(e){if(1!==e.templateId){var t=this.paidMgr.getTemplateByEntry(this.translateTemplate(e.parentId),e.childType,e.childName,this.translateTemplate(e.referredId));this.remoteToLocalTemplateId.set(e.templateId,t)}},e.prototype.addRemoteIndexDefinition=function(e){if(1!==e.indexId){var t=this.paidMgr.getIndexByEntry(this.translateIndex(e.prefixId),e.append,this.translateIndex(e.compose));this.remoteToLocalIndexId.set(e.indexId,t)}},e}(),nopTemplateIndexChannel={resetChannel:function(){},defineTemplate:function(e){return void{}},defineIndex:function(e){return void{}},getTemplateIndexIdUpdates:function(){},getAllTemplateIndexIds:function(){},translateTemplate:function(e){return e},translateIndex:function(e){return e}},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),XDRDirection;!function(e){e[e.Marshal=0]="Marshal",e[e.Unmarshal=1]="Unmarshal"}(XDRDirection||(XDRDirection={}));var xdrDeleteIdent={type:"xdrDelete",typeName:function(){return"xdrDelete"}},BaseXDR=function(){function e(e,t){this.dir=e,this.templateInfoChannel=t}return e.prototype.xdrString=function(e){return e},e.prototype.xdrBoolean=function(e){return e},e.prototype.xdrNull=function(){return null},e.prototype.xdrUndefined=function(){return this.dir===XDRDirection.Marshal?{type:"undefined"}:void 0},e.prototype.xdrDelete=function(e){return this.dir===XDRDirection.Marshal?{type:"xdrDelete"}:xdrDeleteIdent},e.prototype.xdrNumber=function(e){if(this.dir===XDRDirection.Marshal){if(e===1/0||e===-(1/0)||isNaN(e))return{type:"number",value:String(e)}}else if(e instanceof Object)return Number(e.value);return e},e.prototype.xdrTemplateId=function(e){var t=e;return this.dir===XDRDirection.Marshal&&this.templateInfoChannel.defineTemplate(t),t=this.xdrNumber(t),this.dir===XDRDirection.Unmarshal&&(t=this.templateInfoChannel.translateTemplate(t)),void 0===t&&RemotingLog.log(1,"internal error: xdrTemplateId is undefined: "+JSON.stringify(e)+" "+XDRDirection[this.dir]),t},e.prototype.xdrIndexId=function(e){var t=e;this.dir===XDRDirection.Marshal&&this.templateInfoChannel.defineIndex(t);var t=this.xdrNumber(t);return this.dir===XDRDirection.Unmarshal&&(t=this.templateInfoChannel.translateIndex(t)),void 0===t&&RemotingLog.log(1,"internal error: xdrIndexId is undefined: "+JSON.stringify(e)),t},e.prototype.xdrCdlObj=function(e){var t=typeof e;switch(t){case"string":return this.xdrString(e);case"number":return this.xdrNumber(e);case"boolean":return this.xdrBoolean(e);case"undefined":return this.xdrUndefined();case"object":if(null===e)return this.xdrNull();if(e instanceof Array)return this.xdrOS(e);var i;return this.dir===XDRDirection.Unmarshal?(assert("type"in e&&"string"==typeof e.type,"XDR.unmarshal: must have a string 'type'"),i=e.type):i=this.xdrGetMarshalType(e),this.xdrObjByType(e,i);default:return void Utilities.warn("XDR: unexpected type '"+t+"'")}},e.prototype.xdrObjByType=function(e,t){switch(t){case"number":return this.xdrNumber(e);case"undefined":return this.xdrUndefined();case"attributeValue":return this.xdrAV(e);case"xdrDelete":return this.xdrDelete(e);case"orderedSet":return this.xdrOS(e);case"range":return this.xdrRange(e);case"comparisonFunction":return this.xdrComparisonFunction(e);case"negation":return this.xdrNegation(e);case"elementReference":return this.xdrElementReference(e);default:return void Utilities.warn("XDR: unexpected type '"+t+"'")}},e}(),AgentXDR=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.xdrOS=function(e){if(this.dir===XDRDirection.Unmarshal)return MoonOrderedSet.unmarshalValue(e,this);var t;return e instanceof Array?(t=e,MoonOrderedSet.marshalValue("orderedSet",t,this)):(assert("function"==typeof e.marshalValue,"XDR: object must have a 'marshalValue' method"),e.marshalValue(this))},t.prototype.xdrRange=function(e){if(this.dir===XDRDirection.Unmarshal)return MoonRange.unmarshalValue(e,this);var t;return e instanceof Array?(t=e,MoonRange.marshalValue("range",t,this)):(assert("function"==typeof e.marshalValue,"XDR: object must have a 'marshalValue' method"),e.marshalValue(this))},t.prototype.xdrComparisonFunction=function(e){return this.dir===XDRDirection.Marshal?e.marshalValue(this):ComparisonFunctionValue.unmarshalValue(e,this)},t.prototype.xdrAV=function(e){var t,i={};t=this.dir===XDRDirection.Marshal?e:e.value;for(var r in t){var n=this.xdrCdlObj(t[r]);void 0!==n&&(i[r]=n)}return this.dir===XDRDirection.Marshal?{type:"attributeValue",value:i}:i},t.prototype.xdrNegation=function(e){return this.dir===XDRDirection.Marshal?e.marshalValue(this):Negation.unmarshalValue(e,this)},t.prototype.xdrElementReference=function(e){return this.dir===XDRDirection.Marshal?e.marshalValue(this):ElementReference.unmarshalValue(e,this)},t.prototype.xdrGetMarshalType=function(e){var t;return t="function"==typeof e.typeName?e.typeName():"attributeValue"},t}(BaseXDR),ServerXDR=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.xdrOS=function(e){
return this.xdrOSorRange(e,"orderedSet")},t.prototype.xdrRange=function(e){return this.xdrOSorRange(e,"range")},t.prototype.xdrComparisonFunction=function(e){var t=this.xdrCdlObj(e.elements);return void 0!==t?{type:"comparisonFunction",queries:t}:void 0},t.prototype.xdrOSorRange=function(e,t){for(var i=[],r=0;r<e.os.length;r++){var n=this.xdrCdlObj(e.os[r]);void 0!==n&&i.push(n)}return{type:t,os:i}},t.prototype.xdrAV=function(e){return{type:"attributeValue",value:this.xdrAllObjAttr(e.value)}},t.prototype.xdrNegation=function(e){return{type:"negation",queries:this.xdrCdlObj(e.queries)}},t.prototype.xdrAllObjAttr=function(e){var t={};for(var i in e){var r=this.xdrCdlObj(e[i]);void 0!==r&&(t[i]=r)}return t},t.prototype.xdrElementReference=function(e){var t=this.xdrTemplateId(e.templateId),i=this.xdrIndexId(e.indexId);return{type:"elementReference",templateId:t,indexId:i}},t.prototype.xdrGetMarshalType=function(e){return assert(e instanceof Object&&"string"==typeof e.type,"marshalled object must have a string type"),e.type},t}(BaseXDR),AppStateIdentifier=function(){function e(e,t,i){this.templateId=e,this.indexId=t,this.path=i}return e.prototype.toString=function(){return e.getHashStr(this)},e.getHashStr=function(e){return e.templateId+":"+e.indexId+":"+e.path},e}(),AppStateElement=function(){function e(){}return e}(),MetadataElement=function(){function e(){}return e}(),XDR;!function(e){function t(e,t){var i=t.xdrTemplateId(e.templateId),r=t.xdrIndexId(e.indexId),n=t.xdrString(e.path);return{templateId:i,indexId:r,path:n}}function i(e,t){return t.xdrCdlObj(e)}function r(e,r){var n=t(e.ident,r),o=e.revision,s=i(e.value,r);return void 0===o||null===o?{ident:n,value:s}:{ident:n,revision:o,value:s}}function n(e,t){var r=e.ident,n=e.revision,o=i(e.value,t);return void 0===n||null===n?{ident:r,value:o}:{ident:r,revision:n,value:o}}function o(e,t){return e}function s(e){return e instanceof Object&&"orderedSet"===e.type&&(void 0===e.os||0===e.os.length)}function a(e){return void 0===e||e===!1||e instanceof Object&&"orderedSet"===e.type&&(void 0===e.os||e.os.every(a))}function d(e){return!a(e)}function u(e,t,i){var r=e,n=t;if(void 0===e)return void 0!==t&&void 0!==i&&(i.changed=!0),t;if(void 0===t)return e;if(e instanceof Object&&"orderedSet"===e.type){if(1!==e.os.length)return e;r=e.os[0]}if(t instanceof Object&&"orderedSet"===t.type){if(1!==t.os.length)return e;n=t.os[0]}if(!(r instanceof Object&&"attributeValue"===r.type&&n instanceof Object&&"attributeValue"===n.type))return e;var o={type:"attributeValue",value:{}};for(var s in r.value)o.value[s]=u(r.value[s],n.value[s],i);for(var s in n.value)s in r.value||(void 0!==i&&(i.changed=!0),o.value[s]=n.value[s]);return"orderedSet"===e.type?{type:"orderedSet",os:[o]}:o}e.xdrAppStateIdentifier=t,e.xdrCdlValue=i,e.xdrAppStateElement=r,e.xdrMetadataElement=n,e.xdrTableElement=o,e.isEmptyOS=s,e.isFalse=a,e.isTrue=d,e.mergeXDRValues=u}(XDR||(XDR={}));var gRemoteDebug=0,RemotingLog=function(){function e(){}return e.shouldLog=function(e){return gRemoteDebug>=e},e.log=function(t,i){if(e.shouldLog(t)){var r=(new Date).toString()+":";"function"==typeof i?console.log(r,i()):console.log(r,i)}},e}(),child_process=require("child_process"),url=require("url"),crypto=require("crypto");requireBtoaAtob();var WSAuth=function(){function e(){}return e.validate=function(t,i,r,n,o){if(o&&"not-required"!==o.origin&&!e.validateOrigin(t))return void n(null,void 0,!1);if("authorization"in t){var s=t.authorization;return RemotingLog.log(2,function(){return"validating authorization header '"+s+"'"}),void BasicWSAuth.validate(s,r,n)}for(var a=0;a<i.length;a++){var d=i[a];if("mauth"===d.name)return RemotingLog.log(2,function(){return"validating 'mauth' cookie '"+d.value+"'"}),void CookieAuth.validate(d.value,n)}RemotingLog.log(2,"no 'authorization' header nor 'mauth' cookie present"),n("no cookie",void 0,!1)},e.validateOrigin=function(e){if(!("origin"in e))return RemotingLog.log(1,"WSAuth.validate: 'Origin' header missing"),!1;var t=e.origin,i=url.parse(t),r=e.host||"",n=r.split(":")[0];return"string"==typeof n&&n===i.hostname&&"https:"===i.protocol||(RemotingLog.log(1,function(){return"websocket host '"+String(n)+"' must match 'origin' host '"+i.hostname+"' and origin.protocol '"+i.protocol+"' must be 'https:'"}),!1)},e}();WSAuth.wwwRoot="/var/www";var BasicWSAuth=function(){function e(){}return e.validate=function(t,i,r){if(!/^Basic /.test(t))return RemotingLog.log(2,"BasicWSAuth.validate: authStr does not start with 'Basic '"),void r("basic authorization error",void 0,!1);var n=t.slice(6).trim(),o=btoa(n),s=o.split(":");if(!(s instanceof Array)||2!==s.length)return RemotingLog.log(2,"BasicWSAuth.validate: upa.length != 2"),void r("basic authorization error",void 0,!1);var a=s[0],d=s[1];e.validateLogin(i,a,d,r)},e.validateLogin=function(t,i,r,n){void 0===t?e.doValidate(i,r,n):e.doValidateFromDB(t,i,r,n)},e.doValidate=function(t,i,r){var n=WSAuth.wwwRoot+e.passwordCheck+" "+t+" "+i;child_process.exec(n,function(e,i,n){null===e&&"yes"===i.trim()?(RemotingLog.log(3,function(){return"Password Matches! (user="+t+")"}),r(null,t,!0)):(RemotingLog.log(2,function(){return"Password Check Error: "+e+"(user="+t+")"}),r("login error",void 0,!1))})},e.doValidateFromDB=function(t,i,r,n){function o(t,o){if(null!==t||!(o instanceof Object))return void n("login error",void 0,!1);var s=o.hash;if("string"!=typeof s)return void n("internal error",void 0,!1);var a=s.split("\t");if(a.length!==e.HASH_SECTIONS)return void n("internal error",void 0,!1);var d=a[e.HASH_PBKDF2_INDEX],u=crypto.pbkdf2Sync(r,a[e.HASH_SALT_INDEX],Number(a[e.HASH_ITERATION_INDEX]),d.length/2,a[e.HASH_ALGORITHM_INDEX]).toString("hex"),h=i===a[e.HASH_USERNAME_INDEX]&&d===u;n(h?null:"login error",i,h)}var s=t.collection("userHash");s?s.findOne({userName:i},o):n("internal error",void 0,!1)},e.addUserNamePasswordEmail=function(t,i,r,n,o,s){function a(){var t=crypto.randomBytes(e.PBKDF2_SALT_BYTE_SIZE).toString("hex"),n=crypto.pbkdf2Sync(r,t,e.PBKDF2_ITERATIONS,e.PBKDF2_KEY_LEN,e.PBKDF2_HASH_ALGORITHM).toString("hex"),o=[];return o[e.HASH_USERNAME_INDEX]=i,o[e.HASH_ALGORITHM_INDEX]=e.PBKDF2_HASH_ALGORITHM,o[e.HASH_ITERATION_INDEX]=String(e.PBKDF2_ITERATIONS),o[e.HASH_SALT_INDEX]=t,o[e.HASH_PBKDF2_INDEX]=n,o.join("\t")}var d=t.collection("userHash");if(i.indexOf("\t")!==-1)return void s("illegal character",void 0,!1);if(d){var u=a();o?d.update({userName:i},{userName:i,hash:u,email:n},{upsert:!0},function(e,t){s(e,i,null===e)}):d.findOne({userName:i},function(e,t){null!==e?s(e,void 0,!1):t?s("user name already exists",i,!1):d.insert({userName:i,hash:u,email:n},function(e,t){return s(e,i,null===e)})})}else s("database error",void 0,!1)},e.getAuthStr=function(e,t){var i=e+":"+t,r=atob(i),n="Basic "+r;return n},e}();BasicWSAuth.passwordCheck="/auth/passwordCheck.php",BasicWSAuth.PBKDF2_HASH_ALGORITHM="sha512",BasicWSAuth.PBKDF2_ITERATIONS=3842,BasicWSAuth.PBKDF2_SALT_BYTE_SIZE=56,BasicWSAuth.PBKDF2_KEY_LEN=36,BasicWSAuth.HASH_SECTIONS=5,BasicWSAuth.HASH_USERNAME_INDEX=0,BasicWSAuth.HASH_ALGORITHM_INDEX=1,BasicWSAuth.HASH_ITERATION_INDEX=2,BasicWSAuth.HASH_SALT_INDEX=3,BasicWSAuth.HASH_PBKDF2_INDEX=4;var CookieAuth=function(){function e(){}return e.validate=function(t,i){var r=WSAuth.wwwRoot+e.cookieCheck+" "+t;RemotingLog.log(3,function(){return"validating cookie as '"+r+"'"}),child_process.exec(r,function(e,t,r){if(null===e){var n=t.trim();if(n.length>0)return RemotingLog.log(3,function(){return"Cookie verified! (user="+n+")"}),void i(null,n,!0)}RemotingLog.log(2,"Cookie was not verified"),i("could not verify cookie",void 0,!1)})},e.getCookieUserName=function(){var e=document.cookie.replace(/(?:(?:^|.*;\s*)mauth\s*\=\s*([^;]*).*$)|^.*$/,"$1");if("string"==typeof e&&0!==e.length){var t=decodeURIComponent(e),i=t.split(":");return i.length<2?void 0:i[0]}},e}();CookieAuth.cookieCheck="/auth/cookieCheck.php";var gNumHeaderVersionChars=2,gNumResourceIdChars=8,gNumSequenceNrChars=10,gNumMessageLengthChars=12,gNetworkPaddingZeros="00000000000000000",gNetworkHeaderLength=1+gNumResourceIdChars+gNumSequenceNrChars+gNumMessageLengthChars,gHeaderVersion=1,networkConnectionId=1,gMaxMessageSize=16e3-gNetworkHeaderLength,baseDelay=0,sizeDependentDelay=0,NetworkConnection=function(){function e(t){this.options=t,this.sequenceNr=1,this.id=networkConnectionId++,this.messageQueue=[],this.flushing=!1,this.onReply={},this.replyTimeoutTime=void 0,this.replyTimeoutSequenceNr=void 0,this.replyTimeoutId=void 0,this.queueTimeoutId=void 0,this.eventHandlerObj={},this.messageHandlerObj={},this.inboundProgressHandler=void 0,this.outboundProgressHandler=void 0,this.messageBuffer=void 0,this.delayedMessageQueue=[],this.delayedSendTaskId=void 0,this.errorStatus=void 0,this.options=t,this.poolSize="number"==typeof this.options.poolSize?t.poolSize:e.defaultPoolSize,this.poolDelay="number"==typeof t.poolDelay?t.poolDelay:e.defaultPoolDelay}return e.prototype.sendMessage=function(e,t,i){return"undefined"==typeof this.messageQueue?void this.dlog(1,"sendMessage: queue undefined"):(e.sequenceNr=this.sequenceNr++,void 0!==t&&(this.dlog(5,"sendMessage: waitForReply"),this.waitForReply(t,i,e.sequenceNr)),this.messageQueue.push(e),void this.flushIfNeeded())},e.prototype.sendReplyMessage=function(e,t){e.inReplyTo=t.sequenceNr,this.sendMessage(e)},e.prototype.flushIfNeeded=function(){return"undefined"==typeof this.connection?void this.dlog(1,"flushIfNeeded: connection undefined"):"open"!==this.getConnectionState()?void this.dlog(1,"flushIfNeeded: connection not open"):(this.messageQueue.length>this.poolSize&&this.flush(),void(this.messageQueue.length>0&&void 0===this.queueTimeoutId&&this.setQueueTimeout()))},e.prototype.setQueueTimeout=function(){function e(){t.queueTimeoutHandler()}var t=this;"undefined"==typeof this.queueTimeoutId&&(this.queueTimeoutId=setTimeout(e,this.poolDelay))},e.prototype.queueTimeoutHandler=function(){this.queueTimeoutId=void 0,this.flush()},e.prototype.delayedSendTask=function(){for(this.delayedSendTaskId=void 0;this.delayedMessageQueue.length>0&&Date.now()>=this.delayedMessageQueue[0].transmissionTime;)this.connection.send(this.delayedMessageQueue.shift().message);this.scheduleDelayedSendTask()},e.prototype.scheduleDelayedSendTask=function(){if(void 0===this.delayedSendTaskId&&this.delayedMessageQueue.length>0){var e=this.delayedMessageQueue[0].transmissionTime-Date.now();if(e>0){var t=this;this.delayedSendTaskId=setTimeout(function(){t.delayedSendTask()},e)}else this.delayedSendTask()}},e.prototype.queueSendBuffer=function(e,t){var i=void 0===e?Date.now():e;return i+=baseDelay+sizeDependentDelay*t.length/1e6,this.delayedMessageQueue.push({transmissionTime:i,message:t}),this.scheduleDelayedSendTask(),i},e.prototype.flush=function(){if(!this.flushing&&(this.flushing=!0,"undefined"!=typeof this.queueTimeoutId&&(clearTimeout(this.queueTimeoutId),this.queueTimeoutId=void 0),void 0!==this.connection&&"open"===this.getConnectionState())){var e=void 0;try{for(var t=0;t<this.messageQueue.length;t++){var i=this.messageQueue[t],r=JSON.stringify(i);if(this.dlog(6,function(){return"sending '"+r+"'"}),r.length<=gMaxMessageSize)r=this.addHeader("-",i.resourceId,i.sequenceNr,r.length,r),0===baseDelay&&0===sizeDependentDelay?this.connection.send(r):e=this.queueSendBuffer(e,r);else for(var n=0;n<r.length;n+=gMaxMessageSize){var o=0===n?"[":n+gMaxMessageSize>=r.length?"]":"+",s=this.addHeader(o,i.resourceId,i.sequenceNr,r.length,r.slice(n,n+gMaxMessageSize));0===baseDelay&&0===sizeDependentDelay?(this.connection.send(s),n>0&&n%(100*gMaxMessageSize)===0&&this.dlog(4,function(){return"sent "+n+" bytes"})):e=this.queueSendBuffer(e,s)}}}catch(e){this.dlog(0,"ERROR: flush "+e.toString())}this.messageQueue=[],this.flushing=!1}},e.prototype.waitForReply=function(e,t,i){var r={handler:e,arg:t};this.onReply[i]=r,this.options.replyTimeout>0&&(r.timeoutTime=Date.now()+this.options.replyTimeout,this.setReplyTimeout())},e.prototype.setReplyTimeout=function(){function e(){t.replyTimeoutHandler()}var t=this,i=void 0,r=void 0;for(var n in this.onReply){var o=this.onReply[n],s=o.timeoutTime;"undefined"!=typeof s&&(void 0===r||r>s)&&(r=s,i=n)}if(r<Date.now())return void this.shutdown("setReplyTimeout: min time has passed",!0);if((void 0===r||r<this.replyTimeoutTime)&&this.clearReplyTimeout(),"number"==typeof r&&void 0===this.replyTimeoutTime){this.replyTimeoutTime=r,this.replyTimeoutSequenceNr=i;var a=Math.max(1,r-Date.now());this.replyTimeoutId=setTimeout(e,a)}},e.prototype.clearReplyTimeout=function(){void 0!==this.replyTimeoutId&&(clearTimeout(this.replyTimeoutId),this.replyTimeoutId=void 0,this.replyTimeoutTime=void 0,this.replyTimeoutSequenceNr=void 0)},e.prototype.replyTimeoutHandler=function(){this.setReplyTimeout()},e.prototype.errorHandler=function(e){void 0!==this.eventHandlerObj.error&&this.eventHandlerObj.error.call(this,e),this.errorStatus||(globalSystemEvents.notifyHandlers(["error","connection error"]),this.errorStatus=!0),this.shutdown("errorHandler: error="+e,!0)},e.prototype.closeHandler=function(e){void 0!==this.eventHandlerObj.close&&this.eventHandlerObj.close.call(this,e),void 0===this.errorStatus&&globalSystemEvents.notifyHandlers(["connection closed"]),this.shutdown("closeHandler",!0)},e.prototype.openHandler=function(){this.messageBuffer=void 0,void 0!==this.eventHandlerObj.open&&this.eventHandlerObj.open.call(this),void 0===this.errorStatus&&globalSystemEvents.notifyHandlers(["connection opened"]),this.flushIfNeeded()},e.prototype.messageHandler=function(e){var t=this.readHeader(e);if(void 0!==t){if(this.dlog(6,"received "+t.buffer.length+" characters of "+t.msgLength+" for resource "+t.resourceId+" sequence nr. "+t.sequenceNr),0===t.sequenceNr)return void this.handleAcknowledgement(t);switch(t.segmentIndicator){case"[":void 0!==this.messageBuffer&&this.dlog(0,"message out of order"),this.messageBuffer=t.buffer;break;case"+":if(void 0===this.messageBuffer)return void this.dlog(0,"message out of order");this.messageBuffer+=t.buffer;break;case"]":if(void 0===this.messageBuffer)return void this.dlog(0,"message out of order");e=this.messageBuffer+t.buffer,this.messageBuffer=void 0;break;default:void 0!==this.messageBuffer&&(this.dlog(0,"message out of order"),this.messageBuffer=void 0),e=t.buffer}if(void 0!==this.inboundProgressHandler){var i=void 0!==this.messageBuffer?this.messageBuffer.length:e.length;this.inboundProgressHandler(t.resourceId,t.sequenceNr,i,t.msgLength)}if(void 0!==this.messageBuffer)return void this.sendAcknowledgement(t.resourceId,t.sequenceNr,this.messageBuffer.length,t.msgLength);this.sendAcknowledgement(t.resourceId,t.sequenceNr,e.length,t.msgLength);try{var r=JSON.parse(e);if(this.dlog(6,function(){return"got message "+e}),"undefined"!=typeof r.inReplyTo)return void this.handleReply(r);var n=this.getMessageType(r),o=this.messageHandlerObj[n];if(this.dlog(5,"message of type "+n+" for resource "+t.resourceId+(r.revision?" with revision "+r.revision:" without revision")),"function"!=typeof o&&"error"!==n)return this.dlog(1,function(){return"NetworkConnection: no handler for '"+n+"'"}),void this.sendReplyMessage({type:"error",description:"no handler for message type '"+n+"'"},r);o.call(this,r),void 0!==this.errorStatus&&(globalSystemEvents.notifyHandlers(["connection error cleared"]),this.errorStatus=void 0)}catch(e){this.dlog(0,"ERROR: messageHandler "+e.toString()),console.error(e),this.sendReplyMessage({type:"error",description:"exception while handling message"},r),this.sendMessage({type:"reloadApplication",reason:"exception: "+e.toString()}),this.flush(),this.shutdown("exception: "+e.toString(),!1)}}},e.prototype.handleReply=function(e){var t=e.inReplyTo,i=this.onReply[t];return void 0===i?void this.dlog(0,"handleReply: reply not found"):(delete this.onReply[t],this.setReplyTimeout(),void i.handler.call(this,i.arg,!0,e))},e.prototype.addMessageHandler=function(e,t){this.messageHandlerObj[e]=t},e.prototype.setInboundProgressHandler=function(e){this.inboundProgressHandler=e},e.prototype.setOutboundProgressHandler=function(e){this.outboundProgressHandler=e},e.prototype.addEventHandler=function(e,t){switch(e){case"open":case"close":case"error":this.eventHandlerObj[e]=t;break;default:mondriaInternalError("NetworkConnection.addEventHandler: unknown event type '"+e+"'")}},e.prototype.getMessageType=function(e){return e.type},e.prototype.shutdown=function(e,t){void 0!==this.messageQueue&&(this.dlog(1,"Shutting down connection: "+e),this.clearMessageQueue(),this.clearReplyTimeout(),"undefined"!=typeof this.connection&&(this.connection.close(),this.connection=void 0),t&&this.clearReplyQueue())},e.prototype.clearMessageQueue=function(){this.messageQueue=void 0},e.prototype.clearReplyQueue=function(){for(var e in this.onReply){var t=this.onReply[e];delete this.onReply[e],t.handler.call(this,t.arg,!1)}this.setReplyTimeout()},e.prototype.getConnectionState=function(){if("undefined"==typeof this.connection)return"error";var e=this.connection.readyState;assert("number"==typeof e,"typecheck");var t=["connecting","open","closing","closed"][e];return"undefined"==typeof t&&(t="error"),assert("string"==typeof t,"getConnectionState"),t},e.prototype.getMessageSequenceNr=function(e){return e.sequenceNr},e.prototype.dlog=function(e,t){if(RemotingLog.shouldLog(e)){"function"==typeof t&&(t=t());var i="(cid:"+String(this.id)+")";this.connection&&this.connection.url&&(i+="("+this.connection.url+":"+this.getConnectionState()+")"),RemotingLog.log(e,String(t)+i)}},e.prototype.addHeader=function(e,t,i,r,n){var o=(gNetworkPaddingZeros+gHeaderVersion).slice(-gNumHeaderVersionChars),s=(gNetworkPaddingZeros+t).slice(-gNumResourceIdChars),a=(gNetworkPaddingZeros+i).slice(-gNumSequenceNrChars),d=(gNetworkPaddingZeros+r).slice(-gNumMessageLengthChars);return o+e+s+a+d+n},e.prototype.readHeader=function(e){var t=0,i=Number(e.substr(t,gNumHeaderVersionChars));if(isNaN(i))return void this.signalTerminationToNoHeader();if(i!==gHeaderVersion)return void this.signalTerminationOtherHeaderVersion(i);t+=gNumHeaderVersionChars;var r=e.charAt(t);t+=1;var n=Number(e.substr(t,gNumResourceIdChars));t+=gNumResourceIdChars;var o=Number(e.substr(t,gNumSequenceNrChars));t+=gNumSequenceNrChars;var s=Number(e.substr(t,gNumMessageLengthChars));return t+=gNumMessageLengthChars,{segmentIndicator:r,resourceId:n,sequenceNr:o,msgLength:s,buffer:e.slice(t)}},e.prototype.sendAcknowledgement=function(e,t,i,r){var n=(gNetworkPaddingZeros+t).slice(-gNumSequenceNrChars),o=(gNetworkPaddingZeros+i).slice(-gNumMessageLengthChars),s=(gNetworkPaddingZeros+r).slice(-gNumMessageLengthChars),a=n+o+s,d=this.addHeader("-",e,0,a.length,a);try{this.connection.send(d)}catch(e){this.dlog(0,"ERROR: send ack "+e.toString())}},e.prototype.handleAcknowledgement=function(e){var t=0,i=Number(e.buffer.substr(t,gNumSequenceNrChars));t+=gNumSequenceNrChars;var r=Number(e.buffer.substr(t,gNumMessageLengthChars));t+=gNumMessageLengthChars;var n=Number(e.buffer.substr(t,gNumMessageLengthChars));t+=gNumMessageLengthChars,this.dlog(6,"received acknowledgement for "+r+" characters of "+n+" for message nr. "+i+" for resource "+e.resourceId);var o;i in this.onReply&&(o=this.onReply[i].arg),void 0!==this.outboundProgressHandler&&this.outboundProgressHandler(e.resourceId,i,o,r,n)},e.prototype.signalTerminationToNoHeader=function(){if(void 0!==this.connection&&"open"===this.getConnectionState())try{var e=JSON.stringify({type:"terminate",reason:"incompatible version (reload application)"});this.connection.send(e)}catch(e){this.dlog(0,"ERROR: signalTerminationToNoHeader "+e.toString())}},e.prototype.signalTerminationOtherHeaderVersion=function(e){this.dlog(0,"message with header version "+e+" received")},e}();NetworkConnection.defaultPoolSize=10,NetworkConnection.defaultPoolDelay=10;var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),NetworkClientConnection=function(e){function t(t,i){var r=e.call(this,i)||this,n="ws"===t.protocol?"ws":"wss",o=t.hostName,s=void 0===t.port?8080:t.port,a=void 0===t.path?"/":t.path,d={};for(var u in t)"protocol"===u?d.protocol="ws"===n?"http:":"https:":d[u]=t[u];if(r.url=n+"://"+o+":"+s+a,requireWebSockets(),requireBtoaAtob(),"string"==typeof t.username&&"string"==typeof t.password){var h=BasicWSAuth.getAuthStr(t.username,t.password);"undefined"==typeof d.headers&&(d.headers={}),d.headers.authorization=h}d.protocols=["json"],r.requestOptions=d;try{RemotingLog.log(1,"new web socket to url: '"+r.url+"'"),r.connect()}catch(e){r.connection=void 0}return r}return __extends(t,e),t.prototype.destroy=function(){this.disconnect()},t.prototype.connect=function(){this.connection=runtimeEnvironment.newWebSocket(this,this.url,this.requestOptions),this.messageQueue=[]},t.prototype.disconnect=function(){this.connection.close(),this.connection=void 0},t}(NetworkConnection),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),__assign=this&&this.__assign||Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},gRemoteMgr,RemoteMgr=function(){function e(){this.nextClientId=0,this.clientById={},this.clientBySpecHash={},this.nextResourceId=0,this.resourceById={},this.pendingWrite=void 0,this.pendingResources=new Set,this.reconnectScheduled=void 0,this.reconnectDelay=3e3,this.terminated=!1,this.loginStatusUpdateClients={},this.loginCounter=0}return e.prototype.hasPendingResources=function(){return this.pendingResources.size>0},e.prototype.subscribe=function(e,t,i,r,n,o){var s=this.getClient(t);if(void 0!==s){var a=this.createResource(s,i,r,n,e,o),d=a.getId();this.pendingResources.add(d);var u=this.clientById[s];return u.subscribe(a.getId(),a.getSpec()),a.getId()}},e.prototype.unsubscribe=function(e){this.pendingResources.delete(e),unsubcribeResourceHook();var t=this.resourceById[e],i=t.getClientId(),r=this.clientById[i];r.unsubscribe(t.getId()),this.destroyResource(t),this.releaseClient(i)},e.prototype.login=function(e,t){var i=this.getClient(e);if(this.loginCounter++,void 0!==i){var r=this.clientById[i];r.login(__assign({},t,{loginSeqNr:this.loginCounter})),this.releaseClient(i)}},e.prototype.logout=function(e){var t=this.resourceById[e],i=t.getClientId(),r=this.clientById[i];r.logout(),this.unsubscribe(e)},e.prototype.createAccount=function(e,t){var i=this.getClient(e);if(this.loginCounter++,void 0!==i){var r=this.clientById[i];r.createAccount(__assign({},t,{loginSeqNr:this.loginCounter})),this.releaseClient(i)}},e.prototype.registerForLoginStatusUpdates=function(e){this.loginStatusUpdateClients[e.watcherId]=e},e.prototype.unregisterForLoginStatusUpdates=function(e){delete this.loginStatusUpdateClients},e.prototype.loginStatusUpdate=function(e,t,i,r){if(r===this.loginCounter)for(var n in this.loginStatusUpdateClients){var o=this.loginStatusUpdateClients[n];o.loginStatusUpdate(e,t,i)}},e.prototype.releaseResource=function(e){var t=this.resourceById[e],i=t.getClientId(),r=this.clientById[i];r.releaseResource(t.getId()),this.destroyResource(t),this.releaseClient(i)},e.prototype.getRemotingConnectionById=function(e){var t=this.resourceById[e],i=t.getClientId();return this.clientById[i]},e.prototype.getClient=function(e){var t=this.getHostSpecHash(e),i=this.clientBySpecHash[t];if(void 0===i&&(i=this.clientBySpecHash[t]=this.createClient(e,t)),void 0!==i){var r=i.getAdminData();return r.refCount++,r.id}},e.prototype.releaseClient=function(e){var t=this.clientById[e];if(void 0!==t){var i=t.getAdminData();i.refCount--,i.refCount<=0&&this.destroyClient(t)}},e.prototype.getHostSpecHash=function(e){return e.protocol+"://"+e.hostName+":"+e.port+(void 0===e.path?"/":e.path)},e.prototype.createClient=function(e,t){var i=void 0;if("wss"===e.protocol||"ws"===e.protocol){var r=this.nextClientId++,n={refCount:0,id:r,specHash:t};i=this.createNetworkClient(e,t,n),this.clientById[r]=i}return i},e.prototype.createNetworkClient=function(e,t,i){var r={poolSize:100,poolDelay:100};return new RemotingClientConnection(e,r,this,i,gPaidMgr)},e.prototype.destroyClient=function(e){var t=e.getAdminData();e.destroy(),delete this.clientById[t.id],delete this.clientBySpecHash[t.specHash]},e.prototype.createResource=function(e,t,i,r,n,o){var s=this.nextResourceId++,a=new RemotingResource(s,t,e,i,r,n,o);return this.resourceById[s]=a,a},e.prototype.destroyResource=function(e){var t=e.getId();delete this.resourceById[t],e.destroy()},e.prototype.updateResource=function(e,t,i,r){this.pendingResources.delete(e),unsubcribeResourceHook();var n=this.resourceById[e];void 0===n?mMessage("RemoteMgr.updateResource: No such resource "+e):n.update(t,i,r)},e.prototype.write=function(e,t,i){var r=this.resourceById[e],n=r.getClientId();"undefined"==typeof this.pendingWrite&&(this.pendingWrite={},scheduleRemotingTask());var o=this.pendingWrite[n];"undefined"==typeof o&&(o=this.pendingWrite[n]={});var s=o[e];void 0===s&&(s=o[e]={});var a={ident:t,value:i},d=this.clientById[n];if(void 0!==d){var u=d.getIdentStrFunc(e),h=u(a);RemotingLog.log(4,function(){return"RemoteMgr.write: "+h+"="+cdlify(i)}),s[h]=a}},e.prototype.flush=function(){var e=this.pendingWrite;if(void 0!==e){this.pendingWrite=void 0;for(var t in e){var i=this.clientById[t];if(void 0!==i){var r=e[t];for(var n in r){var o=r[n];i.write(Number(n),o,void 0)}}}}},e.prototype.getClientConsumerList=function(e){var t=[],i=e.getSubscribedResourceObj();for(var r in i){var n=this.resourceById[r],o=n.getConsumer(),s=n.getConsumerIdent();t.push({consumer:o,ident:s})}return t},e.prototype.notifyConnectionState=function(e,t,i){for(var r=0;r<e.length;r++){var n=e[r];n.consumer.resourceConnectionStateUpdate(t,i,n.ident)}},e.prototype.resourceUpdateComplete=function(e,t){for(var i=0;i<e.length;i++)e[i].consumer.resourceUpdateComplete(t)},e.prototype.clientOpenCB=function(e){var t=this.getClientConsumerList(e);this.notifyConnectionState(t,0,"")},e.prototype.clientCloseCB=function(e,t){if(!this.terminated){var i=this.getClientConsumerList(e);this.notifyConnectionState(i,1,"connection closed: "+("object"==typeof t?t.code:"(unknown)")),e.shutdown("error",!0),this.scheduleReconnect(e)}},e.prototype.clientErrorCB=function(e,t){var i=this.getClientConsumerList(e);this.notifyConnectionState(i,1,"connection error"),e.shutdown("connection error",!0),this.scheduleReconnect(e)},e.prototype.terminate=function(e,t){if(!this.terminated){this.terminated=!0;for(var i in this.resourceById)this.resourceById[i].terminate(t);gAppStateMgr.resourceConnectionStateUpdate(2,t,"appState"),e.shutdown("terminated",!1)}},e.prototype.reloadApplication=function(e,t){this.terminated||(this.terminated=!0,gAppStateMgr.resourceConnectionStateUpdate(3,t,"appState"),e.shutdown("reloadApplication",!1))},e.prototype.reconnect=function(e){for(var t in e){var i=e[t];if(i.debugRemainClosed)return void this.scheduleReconnect(i);i.connect(),i.resubscribe(),i.resubmitWrite()}},e.prototype.scheduleReconnect=function(e){function t(){var e=i.reconnectScheduled;i.reconnectScheduled=void 0,i.reconnect(e)}var i=this;void 0===this.reconnectScheduled&&(this.reconnectScheduled={},setTimeout(t,this.reconnectDelay));var r=e.getAdminData(),n=r.id;this.reconnectScheduled[n]=e},e.prototype.resetTemplateIndexIds=function(){for(var e in this.clientById)this.clientById[e].resetTemplateIndexIds()},e.prototype.debugForceClose=function(e){if(this.clientById)for(var t in this.clientById)this.clientById[t].debugForceClose(e)},e.prototype.debugReleaseForceClose=function(){if(this.clientById)for(var e in this.clientById)this.clientById[e].debugReleaseForceClose()},e.getAppName=function(){if(void 0===e.appName){var t=getArgParser(),i=t.getAppName(),r=Math.max(i.lastIndexOf("/"),i.lastIndexOf("\\"));r>=0&&(i=i.slice(r+1)),".node.js"===i.slice(-8)?i=i.slice(0,-8):".html"===i.slice(-5)?i=i.slice(0,-5):".htm"===i.slice(-4)&&(i=i.slice(0,-4)),".crt"!==i.slice(-4)&&".min"!==i.slice(-4)||(i=i.slice(0,-4)),e.appName=t.getArg("appName",i)}return e.appName},e}();RemoteMgr.appName=void 0;var RemotingClientConnection=function(e){function t(t,i,r,n,o){var s=e.call(this,t,i)||this;return s.remoteMgr=r,s.adminData=n,s.paidMgr=o,s.pendingAcknowledge={},s.nPendingAcknowledge={},s.nextAckId=1,s.subscribedResource={},s.remotePaidMgr=new RemotePaidInterface(o),s.addMessageHandler("resourceUpdate",s.resourceUpdateHandler),s.addMessageHandler("terminate",s.terminationHandler),s.addMessageHandler("reloadApplication",s.reloadHandler),s.addMessageHandler("define",s.defineHandler),s.addMessageHandler("loginStatus",s.loginStatusHandler),s.setOutboundProgressHandler(s.resourceOutboundProgressHandler),s.setInboundProgressHandler(s.resourceInboundProgressHandler),s.addEventHandler("error",s.networkErrorHandler),s.addEventHandler("close",s.networkCloseHandler),s.addEventHandler("open",s.networkOpenHandler),s}return __extends(t,e),t.prototype.destroy=function(){this.pendingAcknowledge=void 0,this.nPendingAcknowledge=void 0,this.subscribedResource=void 0,this.remoteMgr=void 0,e.prototype.destroy.call(this)},t.prototype.connect=function(){this.initDef(),e.prototype.connect.call(this)},t.prototype.subscribe=function(e,t){var i=this.subscribedResource[e]={spec:t,revision:void 0,ackRevision:void 0,ackRevisionByIdent:void 0};this.sendSubscriptionRequest(e,i)},t.prototype.unsubscribe=function(e){this.sendUnsubscribeRequest(e),delete this.subscribedResource[e]},t.prototype.login=function(e){this.sendMessage({type:"login",username:e.username,password:e.password,loginSeqNr:e.loginSeqNr})},t.prototype.logout=function(){this.sendMessage({type:"logout"})},t.prototype.createAccount=function(e){this.sendMessage({type:"createAccount",username:e.username,password:e.password,email:e.email,loginSeqNr:e.loginSeqNr})},t.prototype.releaseResource=function(e){this.sendReleaseResourceRequest(e),delete this.subscribedResource[e]},t.prototype.sendSubscriptionRequest=function(e,t){this.sendMessage({type:"subscribe",resourceId:e,resourceSpec:t.spec,revision:t.revision})},t.prototype.sendUnsubscribeRequest=function(e){this.sendMessage({type:"unsubscribe",resourceId:e})},t.prototype.sendReleaseResourceRequest=function(e){this.sendMessage({type:"releaseResource",resourceId:e})},t.prototype.resubscribe=function(){this.remoteMgr.resetTemplateIndexIds();for(var e in this.subscribedResource)this.sendSubscriptionRequest(Number(e),this.subscribedResource[e])},t.prototype.getNextAckId=function(){return this.nextAckId++},t.prototype.resubmitWrite=function(){for(var e in this.pendingAcknowledge)if(0!==this.nPendingAcknowledge[e]){var t=this.pendingAcknowledge[e],i={};for(var r in t){var n=t[r];i[r]=n.entry}this.write(Number(e),i,void 0)}},t.prototype.write=function(e,t,i){var r=[],n=this.getXDRFunc(XDRDirection.Marshal,e);for(var o in t){var s=t[o];r.push(n(s))}var a=this.remotePaidMgr.getTemplateIndexIdUpdates();void 0!==a&&this.sendMessage({type:"define",resourceId:e,list:a}),void 0===i&&(i=this.getNextAckId()),this.markWaitingAck(e,t,i),this.sendMessage({type:"write",resourceId:e,list:r},this.writeAckHandler,{resourceId:e,elementObj:t,ackId:i})},t.prototype.markWaitingAck=function(e,t,i){var r=this.pendingAcknowledge[e];void 0===r&&(r=this.pendingAcknowledge[e]={},this.nPendingAcknowledge[e]=0);for(var n in t){n in r||this.nPendingAcknowledge[e]++;var o=t[n];r[n]={ackId:i,entry:o}}},t.prototype.writeAckHandler=function(e,t,i){if(t===!0){var r=this.updateSubscribedResourceRevision(e.resourceId,e.elementObj,i.revision,!0);this.writeAcknowledgmentReceived(e.resourceId,e.elementObj,e.ackId,i.info,i.revision,r);
}else this.remoteMgr.clientErrorCB(this,"nack received")},t.prototype.writeAcknowledgmentReceived=function(e,t,i,r,n,o){var s=this,a=this.pendingAcknowledge[e];if(void 0!==a){var d=void 0,u=this.remoteMgr.resourceById[e],h=u.getConsumer();for(var l in t)if(l in a){var c=a[l];c.ackId===i&&(void 0!==c.queuedUpdate&&(void 0===n||c.queuedUpdate.revision>n)&&(void 0===d&&(d={}),d[l]=c.queuedUpdate),delete a[l],0===--this.nPendingAcknowledge[e]&&h.allRequestsAcknowledged(e))}h.writeAckInfoUpdate(e,r),void 0!==d&&(RemotingLog.log(5,function(){return"updating resource "+e+" after write acknowledgement from client "+s.adminData.id+" with full sync revision "+o}),this.remoteMgr.updateResource(e,d,void 0,o))}},t.prototype.resourceUpdateHandler=function(e){var t=this,i=e.resourceId,r=e.revision,n=e.update,o={},s=this.getXDRFunc(XDRDirection.Unmarshal,i);if("function"!=typeof s)return void this.dlog(1,"resourceUpdateHandler: no xdr, message ignored");var a,d,u=this.getIdentStrFunc(i);i in this.nPendingAcknowledge&&this.nPendingAcknowledge[i]>0&&(a=this.pendingAcknowledge[i]),i in this.subscribedResource&&(d=this.subscribedResource[i].ackRevisionByIdent);for(var h in n){var l=n[h],c=s(l),p=u(c);if(void 0!==a&&p in a){var f=a[p].queuedUpdate;void 0===f?a[p].queuedUpdate=c:void 0!==c.revision&&(void 0===f.revision||f.revision<c.revision)&&(a[p].queuedUpdate=c)}else if(void 0!==d&&p in d){var v=d[p];if(void 0===c.revision||c.revision<=v)continue;delete d[p],o[p]=c}else o[p]=c}var g=this.updateSubscribedResourceRevision(i,o,r,!1);RemotingLog.log(5,function(){return"updating resource "+i+" from client "+t.adminData.id+" with update revision "+r+" and full sync revision "+g}),this.remoteMgr.updateResource(i,o,r,g);var m=this.remoteMgr.getClientConsumerList(this);e.error&&this.remoteMgr.notifyConnectionState(m,1,e.reason),this.remoteMgr.resourceUpdateComplete(m,i)},t.prototype.resourceInboundProgressHandler=function(e,t,i,r){var n=this.remoteMgr.resourceById[e];return void 0===n?void this.dlog(2,"RemotingClientConnection.resourceInboundProgressHandler: No such resource "+e):void(void 0!==n.inboundProgressUpdate&&n.inboundProgressUpdate(t,i,r))},t.prototype.resourceOutboundProgressHandler=function(e,t,i,r,n){var o=this.remoteMgr.resourceById[e];if(void 0===o)return void this.dlog(2,"RemotingClientConnection.resourceOutboundProgressHandler: No such resource "+e);if(void 0!==o.outboundProgressUpdate){var s,a;void 0!==i&&void 0!==i.elementObj&&(s=i.elementObj,a=Object.keys(s)),o.outboundProgressUpdate(a,s,r,n)}},t.prototype.networkErrorHandler=function(e){this.remoteMgr.clientErrorCB(this,e)},t.prototype.networkCloseHandler=function(e){this.remoteMgr.clientCloseCB(this,e)},t.prototype.networkOpenHandler=function(){this.remoteMgr.clientOpenCB(this)},t.prototype.getSubscribedResourceObj=function(){return this.subscribedResource},t.prototype.terminationHandler=function(e){this.remoteMgr.terminate(this,e.reason)},t.prototype.reloadHandler=function(e){this.remoteMgr.reloadApplication(this,e.reason)},t.prototype.defineHandler=function(e){var t=e.list;if(t instanceof Array)for(var i=0;i<t.length;i++){var r=t[i];isXDRTemplateDefinition(r)?this.remotePaidMgr.addRemoteTemplateDefinition(r):isXDRIndexDefinition(r)?this.remotePaidMgr.addRemoteIndexDefinition(r):RemotingLog.log(4,function(){return"not an XDR template or index definition: "+JSON.stringify(r)})}else RemotingLog.log(4,function(){return"not an XDR template or index definition list: "+JSON.stringify(t)})},t.prototype.loginStatusHandler=function(e){this.remoteMgr.loginStatusUpdate(e.username,e.authenticated,e.reason,e.loginSeqNr)},t.prototype.initDef=function(){},t.prototype.updateSubscribedResourceRevision=function(e,t,i,r){if(void 0!==i&&e in this.subscribedResource){var n,o=this.subscribedResource[e];if(r){var s=o.ackRevision;if(void 0===s)if(void 0!==o.revision&&o.revision>=i-1)o.revision===i-1&&(o.revision=i);else{o.ackRevision=[i,i],o.ackRevisionByIdent={};for(n in t)o.ackRevisionByIdent[n]=i}else{var a=s.length-1;i-1===s[a]?s[a]=i:i>s[a]&&s.push(i,i);for(n in t)n in o.ackRevisionByIdent&&!(i>o.ackRevisionByIdent[n])||(o.ackRevisionByIdent[n]=i)}return o.revision}if(void 0!==o.revision&&o.revision>=i)return o.revision;if(o.revision=i,void 0===o.ackRevision)return o.revision;for(var d=o.ackRevision.length-2;d>=0;d-=2)if(o.ackRevision[d]>=i-1){o.revision=o.ackRevision[d+1],d===o.ackRevision.length-2?(o.ackRevision=void 0,o.ackRevisionByIdent=void 0):o.ackRevision.splice(0,d+2);break}return o.revision}},t.prototype.getAdminData=function(){return this.adminData},t.prototype.getTemplateIndexAdmin=function(){return this.remotePaidMgr},t.prototype.getXDRFunc=function(e,t){var i=this.remoteMgr.resourceById[t],r=i.getXdrFunc(),n=new AgentXDR(e,this.remotePaidMgr);return function(e){return r(e,n)}},t.prototype.getIdentStrFunc=function(e){var t=this.remoteMgr.resourceById[e];return void 0===t?void 0:t.getIdentStrFunc()},t.prototype.resetTemplateIndexIds=function(){this.remotePaidMgr.resetChannel()},t.prototype.debugForceClose=function(e){function t(){i.debugReleaseForceClose()}if(this.debugRemainClosed=!0,this.closeHandler({code:"debug forced close"}),e){var i=this;setTimeout(t,e)}},t.prototype.debugReleaseForceClose=function(){this.debugRemainClosed&&(this.debugRemainClosed=!1)},t}(NetworkClientConnection),RemotingResource=function(){function e(e,t,i,r,n,o,s){this.id=e,this.spec=t,this.clientId=i,this.xdrFunc=r,this.identStrFunc=n,this.consumer=o,this.consumerIdent=s,this.revision=void 0}return e.prototype.destroy=function(){},e.prototype.getId=function(){return this.id},e.prototype.getSpec=function(){return this.spec},e.prototype.update=function(e,t,i){if(void 0!==t){if(void 0!==this.revision&&t<=this.revision)return RemotingLog.log(5,"update ignored, revision already updated"),void(void 0!==i&&i>this.revision&&(this.revision=i));void 0!==i&&i>t?this.revision=i:this.revision=t}this.consumer.resourceUpdate(e,this.consumerIdent,t)},e.prototype.inboundProgressUpdate=function(e,t,i){void 0!==this.consumer.inboundProgressUpdate&&this.consumer.inboundProgressUpdate(e,t,i)},e.prototype.outboundProgressUpdate=function(e,t,i,r){void 0!==this.consumer.outboundProgressUpdate&&this.consumer.outboundProgressUpdate(e,t,i,r)},e.prototype.getElement=function(e){return this.element[e]},e.prototype.getClientId=function(){return this.clientId},e.prototype.getXdrFunc=function(){return this.xdrFunc},e.prototype.getIdentStrFunc=function(){return this.identStrFunc},e.prototype.getConsumer=function(){return this.consumer},e.prototype.getConsumerIdent=function(){return this.consumerIdent},e.prototype.terminate=function(e){this.consumer.resourceConnectionStateUpdate(2,e,this.consumerIdent)},e}(),cssPropTranslationTable={borderTopLeftRadius:["-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius"],borderTopRightRadius:["-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius"],borderBottomLeftRadius:["-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius"],borderBottomRightRadius:["-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius"],borderStyle:"border-style",borderLeftStyle:"border-left-style",borderRightStyle:"border-right-style",borderTopStyle:"border-top-style",borderBottomStyle:"border-bottom-style",borderColor:"border-color",borderLeftColor:"border-left-color",borderRightColor:"border-right-color",borderTopColor:"border-top-color",borderBottomColor:"border-bottom-color",borderWidth:"border-width",borderLeftWidth:"border-left-width",borderRightWidth:"border-right-width",borderTopWidth:"border-top-width",borderBottomWidth:"border-bottom-width",paddingTop:"padding-top",paddingBottom:"padding-bottom",paddingLeft:"padding-left",paddingRight:"padding-right",textShadow:"text-shadow",textOverflow:"text-overflow",fontFamily:"font-family",fontSize:"font-size",fontStyle:"font-style",fontWeight:"font-weight",fontVariant:"font-variant",lineHeight:"line-height",textDecoration:"text-decoration",boxShadow:["box-shadow","MozBoxShadow","-webkit-box-shadow"],overflowX:"overflow-x",overflowY:"overflow-y",textFillColor:["text-fill-color","-webkit-text-fill-color","MozTextFillColor"],textStrokeWidth:["text-stroke-width","-webkit-text-stroke-width","MozTextStrokeWidth"],textStrokeColor:["text-stroke-color","-webkit-text-stroke-color","MozTextStrokeColor"],borderSpacing:"border-spacing",textAlign:"text-align",textIndent:"text-indent",textTransform:"text-transform",verticalAlign:"vertical-align",backgroundColor:"background-color",transform:["transform","-webkit-transform"],hoverText:"title",overflow:"text-overflow",whiteSpace:"white-space"},elementTransitionProperties={transform:!0,color:!0},elementsWithTextProperties={text:!0,div:!0,input:!0};ContentDisplay.prototype.destroy=function(){this.destroyDisplayElement("displayDiv")},ContentDisplay.prototype.destroyDisplayElement=function(e){"undefined"!=typeof this[e]&&(removeElement(this[e]),this[e]=void 0)},ContentDisplay.prototype.removeDisplayElement=function(){var e=this.displayElement;this.displayElement=void 0,e&&e.root&&removeElement(e.root)},ContentDisplay.prototype.updatePos=function(e,t){updateElementPos(this.displayDiv,t),updateElementPos(this.embeddingDiv,e)},ContentDisplay.prototype.updateZeroOffsetPos=function(e){updateZeroOffsetElementPos(this.displayDiv,e),updateZeroOffsetElementPos(this.embeddingDiv,e)},ContentDisplay.prototype.getRotation=function(){var e=this.descriptionDisplay.transform;return"object"==typeof e&&"number"==typeof e.rotation?e.rotation:0},ContentDisplay.prototype.configurationUpdate=function(e,t,i){this.descriptionDisplay=e,this.createDisplayDiv(),this.displayContentRefresh(!0,t,i),this.prevProperties=this.displayProperties,this.prevDisplayType=this.displayType},ContentDisplay.prototype.getTransitions=function(){return void 0!==this.descriptionDisplay?this.descriptionDisplay.transitions:void 0},ContentDisplay.prototype.applyTransitionProperties=function(e){void 0!==this.descriptionDisplay&&(copyTransitionCssProp(this.displayDiv.style,this.displayElement,e),this.embeddingDiv&&copyTransitionCssProp(this.embeddingDiv.style,this.displayElement,e))},ContentDisplay.displayTypes={text:{value:!0,input:!0},foreign:{value:!0},image:{src:!0},iframe:{src:!0},html:{value:!0},triangle:!0,arc:!0},ContentDisplay.prototype.displayContentRefresh=function(e,t,i){var r=this.descriptionDisplay;if(void 0!==r){var n=ContentDisplay.getDisplayType(r);n!==this.displayType&&this.setNewDisplayElement(r,n),this.applyDisplayProperties(r,t,i),t&&(this.setDisplayElementPos(),this.refreshDisplayContentForType(r,n,e))}},ContentDisplay.getDisplayType=function(e){function t(e){return void 0!==e&&!(e instanceof Array&&0===e.length)}var i="empty";for(var r in ContentDisplay.displayTypes){var n=ContentDisplay.displayTypes[r];if(e[r]){if(n===!0)i=r;else if(e[r]instanceof Object)for(var o in n)if(t(e[r][o])){i=r;break}if("empty"!==i)break}}return i},ContentDisplay.prototype.setNewDisplayElement=function(e,t){this.displayElement&&this.removeDisplayElement(),this.displayElement=this.createDisplayContentForType(e,t);var i;if(void 0!==this.displayElement&&(this.displayDiv||this.createDisplayDiv(),this.displayDiv&&(this.displayElement.root&&this.displayDiv.appendChild(this.displayElement.root),this.postAddActions())),this.prevProperties)for(i in displayResetProperties)delete this.prevProperties[i]},ContentDisplay.prototype.postAddActions=function(){},ContentDisplay.prototype.createDisplayDiv=function(e){return!this.displayDiv&&(!!this.descriptionDisplay&&(this.displayDiv=createDiv(e),!0))};var expandingAttributes={borderRadius:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"],padding:["paddingTop","paddingLeft","paddingBottom","paddingRight"]};ContentDisplay.prototype.applyDisplayProperties=function(e,t,i,r){r||(e=e?shallowCopy(e):{}),this.displayDiv&&i&&("transitions"in e?(copyTransitionCssProp(this.displayDiv.style,this.displayElement,e.transitions),this.embeddingDiv&&copyTransitionCssProp(this.embeddingDiv.style,this.displayElement,e.transitions)):(resetTransitionCssProp(this.displayDiv.style,this.displayElement,this.displayElement),this.embeddingDiv&&resetTransitionCssProp(this.embeddingDiv.style,this.displayElement,this.displayElement)));for(var n in expandingAttributes)if(n in e){for(var o=expandingAttributes[n],s=0;s<o.length;s++){var a=o[s];e[a]||(e[a]=e[n])}delete e[n]}if(this.displayProperties=e,void 0!==this.prevProperties)for(d in frameResetProperties)d in e&&void 0!==e[d]||!(d in this.prevProperties&&void 0!==this.prevProperties[d])||copyDisplayCssProp(this,d,frameResetProperties[d]);for(var d in e)void 0!==this.prevProperties&&e[d]===this.prevProperties[d]||copyDisplayCssProp(this,d,e[d]);"text"!=this.displayType&&"html"!=this.displayType||this.applyDisplayElementProperties(this.displayElement,this.displayElement,i)},ContentDisplay.prototype.applyDisplayElementProperties=function(e,t){if(this.displayType&&e&&this.displayProperties){var i=this.displayType,r=this.displayProperties[i],n=void 0===this.prevProperties?void 0:this.prevProperties[this.prevDisplayType];t&&("transitions"in this.displayProperties?copyTransitionCssProp(e.root.style,this.displayElement,this.displayProperties.transitions):resetTransitionCssProp(e.root.style,this.displayElement,e));for(var o in r)copyDisplayTypeCssProp(i,e,o,r[o]);if(void 0!==n)for(o in displayResetProperties)o in r&&void 0!==r[o]||!(o in n&&void 0!==n[o])||copyDisplayTypeCssProp(i,e,o,displayResetProperties[o])}},ContentDisplay.prototype.createDisplayContentForType=function(e,t){switch(this.displayType=t,t){case"text":return this.textContentDisplay(e);case"foreign":return this.foreignContentDisplay(e);case"html":return this.htmlContentDisplay(e);case"image":return this.imageContentDisplay(e);case"iframe":return this.iframeContentDisplay(e);case"triangle":case"arc":return this.canvasContentDisplay(e,t);case"empty":default:return}},ContentDisplay.prototype.refreshDisplayContentForType=function(e,t,i){switch(t){case"text":i&&this.refreshText(e);break;case"html":i&&this.refreshHTML(e);break;case"image":i&&this.refreshImage(e);break;case"iframe":i&&this.refreshIFrame(e);break;case"triangle":this.refreshTriangle(e,this.getContentWidth(),this.getContentHeight());break;case"arc":this.refreshArc(e,this.getContentWidth(),this.getContentHeight())}},ContentDisplay.prototype.getContentWidth=function(){return NaN},ContentDisplay.prototype.getContentHeight=function(){return NaN},ContentDisplay.prototype.textContentDisplay=function(e){if(e&&e.text&&isTrue(e.text.input))return this.displayElement&&this.setText(this.displayElement,void 0),this.createInputCell(e);var t=document.createElement("span");t.style.display="table-cell",t.style.verticalAlign="middle",t.style.textAlign="center",t.style.overflow="hidden",t.style.width="100%",t.style.height="100%";var i=document.createElement("div");return i.style.display="table",i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.appendChild(t),{root:i,format:i,content:t,type:"text",value:void 0}},ContentDisplay.prototype.setText=function(e,t){for(var i=e.content;i.firstChild;)i.removeChild(i.firstChild);var r;if(void 0!==t&&t.search(/\n/)>=0)for(var n=t.split("\n"),o=0;o<n.length;o++)r=document.createTextNode(n[o]),i.appendChild(r),i.appendChild(document.createElement("br"));else void 0!==t&&(r=document.createTextNode(t),i.appendChild(r))};var copyInputCellAttributes={min:!0,max:!0,type:!0,placeholder:!0},copyInputCellStyleAttributes={};ContentDisplay.prototype.createInputCell=function(e){var t,i=e.text.input,r="input",n="text"in e?e.text.value:void 0;switch(n instanceof Array&&(n=n[0]),i.type){case"number":void 0===n?n="":"number"!=typeof n&&(n=Number(n),isNaN(n)&&(n=0));break;case"text":void 0!==n&&isSimpleType(n)||(n=""),getDeOSedValue(i.multiLine)===!0&&(r="textarea");break;case"password":void 0!==n&&isSimpleType(n)||(n="")}t=document.createElement(r),t.value=n;for(var o in i)o in copyInputCellAttributes&&(copyInputCellAttributes[o]===!0?t[o]=i[o]:t[copyInputCellAttributes[o]]=i[o]),o in copyInputCellStyleAttributes&&(copyInputCellStyleAttributes[o]===!0?t.style[o]=i[o]:t.style[copyInputCellStyleAttributes[o]]=i[o]);return t.style.left="0px",t.style.top="0px",t.style.textAlign="center",t.style.overflow="hidden",t.style.border="none",t.style.outline="none",t.style.padding="0px",{root:t,format:t,content:t,type:"input",inputType:i.type}},ContentDisplay.prototype.refreshText=function(e){var t,i=e&&e.text,r=i&&i.value;if(i&&isTrue(i.input))return void(("input"!==this.displayElement.type||void 0!==this.prevProperties&&void 0!==this.prevProperties.text&&void 0!==this.prevProperties.text.input&&this.prevProperties.text.input.multiLine!==i.input.multiLine)&&(this.setNewDisplayElement(e,"text"),this.applyDisplayProperties(e,!0,!1),this.setDisplayElementPos()));if("text"!==this.displayElement.type&&(this.setNewDisplayElement(e,"text"),this.applyDisplayProperties(e,!0,!1),this.setDisplayElementPos()),r instanceof Array&&(r=0===r.length?"":r[0]),void 0===r&&(r=""),runTests)t=this.getDisplayText(r,i);else try{t=this.getDisplayText(r,i)}catch(e){t="<error>",Utilities.warn(e.toString())}t!==this.displayElement.value&&(this.displayElement.value=t,this.setText(this.displayElement,t))},ContentDisplay.getDisplayValue=function(e){switch(typeof e){case"number":case"string":return e;case"undefined":return;default:return cdlify(e)}},ContentDisplay.prototype.getDisplayText=function(e,t){if(e=ContentDisplay.getDisplayValue(e),void 0!==e)return this.makeContentText(e,t)},ContentDisplay.prototype.makeContentText=function(e,t){if("undefined"!==e){var i,r,n,o,s=!1;if("object"==typeof e){if(null===e)return;if(e instanceof Array){r=!0;for(var a in e){var d=this.makeContentText(e[a],t);d&&(r?(i=d,r=!1):i=i+", "+d)}return i}if(e instanceof Date){if(o=t.dateFormat,void 0===o||"intl"!==o.type)return e.toString();var u=o.locale,h=new Intl.DateTimeFormat(u,o);i=h.format(e)}else{i="",r=!0;for(var l in e)r?r=!1:i+="; ",i+="undefined"==typeof e[l]||"object"==typeof e[l]&&(!e[l]||isEmptyObj(e[l]))?l:l+": "+this.makeContentText(e[l],t)}}else if("number"==typeof e&&void 0!==(n=suppressSet(t.numericFormat))&&(0<=n.numberOfDigits&&n.numberOfDigits<=20||"intl"===n.type))switch(n.type){case"fixed":i=e.toFixed(n.numberOfDigits),s=!0;break;case"exponential":i=e.toExponential(n.numberOfDigits),s=!0;break;case"precision":i=0===n.numberOfDigits?e.toPrecision():e.toPrecision(n.numberOfDigits),s=!0;break;case"hexadecimal":case"HEXADECIMAL":for(i=e.toString(16),"HEXADECIMAL"===n.type&&(i=i.toUpperCase());i.length<n.numberOfDigits;)i="0"+i;break;case"intl":try{var u=n.locale,h=new Intl.NumberFormat(u,n);i=h.format(e),s=!0}catch(t){i=String(e)}break;default:i=String(e)}else if("number"==typeof e&&void 0!==(o=suppressSet(t.dateFormat))&&"intl"===o.type)try{var u=o.locale,h=new Intl.DateTimeFormat(u,o);i=h.format(new Date(e))}catch(t){i=String(e)}else if("number"==typeof e&&void 0!==n)switch(n.type){case"fixed":i=e.toFixed(),s=!0;break;case"exponential":i=e.toExponential(),s=!0;break;case"precision":i=e.toPrecision(),s=!0;break;case"hexadecimal":case"HEXADECIMAL":i=e.toString(16),"HEXADECIMAL"===n.type&&(i=i.toUpperCase());break;default:i=String(e)}else i=String(e);return s&&/^-0(\.0*)?$/.test(i)&&(i=i.slice(1)),i}},ContentDisplay.prototype.foreignContentDisplay=function(e){if(!this.displayDiv)return{};var t=createDiv(this.displayDiv.id+":foreign");return t.style.left="0px",t.style.top="0px",t.style.width="100%",t.style.height="100%",{root:t,format:t,content:t,type:"foreign",value:void 0}},ContentDisplay.prototype.htmlContentDisplay=function(e){if(!this.displayDiv)return{};var t=createDiv(this.displayDiv.id+":html");return t.style.left="0px",t.style.top="0px",{root:t,format:t,content:t,type:"html",value:void 0}},ContentDisplay.prototype.refreshHTML=function(e){function t(e){if(e instanceof HTMLAnchorElement)""===e.target&&(e.target="_blank");else if(void 0!==e.children)for(var i=0;i<e.children.length;i++)t(e.children[i])}var i=e&&e.html,r=i&&i.value;r!==this.displayElement.value&&(this.displayElement.value=r,this.displayElement.content.innerHTML=this.getDisplayText(r),t(this.displayElement.content))},ContentDisplay.prototype.canvasContentDisplay=function(e,t){var i=document.createElement("canvas");return this.context="getContext"in i?i.getContext("2d"):void 0,this.canvas=i,{root:i,format:i,content:i,type:t}},ContentDisplay.prototype.refreshTriangle=function(e,t,i){var r,n=e.triangle,o=getDeOSedValue(n.baseSide),s=getDeOSedValue(n.rightAngle),a=this.context,d=t,u=i,h=getDeOSedValue(n.shadow);if(void 0!==a){if("string"==typeof o)switch(o){case"leftBottom":r=[[.5,1],[1,0],[0,.5]];break;case"left":r=[[0,0],[1,.5],[0,1]];break;case"leftTop":r=[[0,.5],[1,1],[.5,0]];break;case"top":r=[[0,0],[.5,1],[1,0]];break;case"rightTop":r=[[.5,0],[0,1],[1,.5]];break;case"right":r=[[1,0],[0,.5],[1,1]];break;case"rightBottom":r=[[.5,1],[0,0],[1,.5]];break;default:r=[[0,1],[.5,0],[1,1]]}else{if("string"!=typeof s)return;switch(s){case"leftBottom":r=[[0,1],[0,0],[1,1]];break;case"leftTop":r=[[0,0],[1,0],[0,1]];break;case"rightTop":r=[[1,0],[1,1],[0,0]];break;default:r=[[1,1],[0,1],[1,0]]}}a.save(),a.beginPath(),a.moveTo(r[0][0]*d,r[0][1]*u),a.lineTo(r[1][0]*d,r[1][1]*u),a.lineTo(r[2][0]*d,r[2][1]*u),a.lineTo(r[0][0]*d,r[0][1]*u),h instanceof Object&&!(h instanceof Array)&&(a.save(),a.shadowBlur=getValueForCSSStyle(h.blurRadius),a.shadowColor=getValueForCSSStyle(h.color),a.shadowOffsetX=getValueForCSSStyle(h.horizontal),a.shadowOffsetY=getValueForCSSStyle(h.vertical),"color"in n&&(a.fillStyle=getValueForCSSStyle(n.color),a.fill()),"stroke"in n&&(a.strokeStyle=getValueForCSSStyle(n.stroke),a.stroke()),a.restore()),"color"in n&&(a.fillStyle=getValueForCSSStyle(n.color),a.fill()),"stroke"in n&&(a.strokeStyle=getValueForCSSStyle(n.stroke),a.stroke()),a.restore()}},ContentDisplay.prototype.refreshArc=function(e,t,i){var r=t,n=i,o=e.arc,s=ensureOS(o.x),a=ensureOS(o.y),d=ensureOS(o.radius),u=ensureOS(o.start),h=ensureOS(o.range),l=ensureOS(o.end),c=ensureOS(o.color),p=ensureOS(o.inset),f=this.context,v=2*Math.PI,g=0===d.length||0===c.length?0:0!==l.length?l.length:0!==h.length?h.length:0;if(void 0!==f)for(var m=0;m<g;m++){var y=(u[m%u.length]-.25)*v,I=0!==l.length?(l[m%l.length]-.25)*v:h[m%h.length]*v+y,b=0!==s.length?s[m%s.length]:r/2,C=0!==a.length?a[m%a.length]:n/2,S=0!==p.length?p[m%p.length]:0,R=d[m%d.length];f.strokeStyle=c[m%c.length],f.beginPath(),f.lineWidth=R-S,R-=(R-S)/2,f.arc(b,C,R,y,I),f.stroke()}},ContentDisplay.imageCSSProperties={src:1,alt:1},ContentDisplay.imageMondriaProperties={size:1},ContentDisplay.prototype.imageContentDisplay=function(e){var t=document.createElement("img");return{root:t,format:t,content:t,type:"image",value:void 0}},ContentDisplay.prototype.refreshImage=function(e){var t=e.image,i=this.displayElement.content,r=this;for(var n in t)ContentDisplay.imageCSSProperties[n]&&i.setAttribute(n,t[n]);i.onload=function(e){var t=e.currentTarget;r.imageUpdateHeightWidth(t)}},ContentDisplay.prototype.imageUpdateHeightWidth=function(e){var t=this.descriptionDisplay.image,i=(this.descriptionDisplay.transform,this.getContentWidth()),r=this.getContentHeight();if(t instanceof Object){if(this instanceof SurveyDisplay)i=void 0!==this.swidth?this.swidth:1/0,r=void 0!==this.sheight?this.sheight:1/0;else if(isNaN(i)||isNaN(r)||0==i||0==r)return;var n=e.naturalWidth,o=e.naturalHeight;if(n&&o){e.onload=void 0;var s,a=n/i,d=o/r;if(void 0!==t.size){var u=typeof t.size;"string"===u?s=t.size.split("%")[0]/100:"number"===u&&(s=t.size),this instanceof SurveyDisplay&&(i=n,r=o)}else s=Math.max(a,d),this instanceof SurveyDisplay&&0===s&&(s=1,i=n,r=o);isNaN(s)&&mondriaAuthorError("Illegal size="+vstringify(t.size));var h=i/n,l=r/o,c=Math.min(h,l);n=Math.round(e.naturalWidth*c),o=Math.round(e.naturalHeight*c);var p;if(p=r==Math.round(i*o/n)||i!=Math.round(r*n/o)&&a>=d,e.style.position="absolute",p){var f=Math.round(s*i),v=Math.round(f*o/n);if(this instanceof SurveyDisplay)return void this.notifyImageSize(f,v);e.style.width=f+"px",e.style.removeProperty("height"),e.style.left=Math.round((this.paddingLeft?this.paddingLeft:0)+(i-f)/2)+"px",e.style.top=Math.round((this.paddingTop?this.paddingTop:0)+(r-v)/2)+"px"}else{var g=Math.round(s*r),m=Math.round(g*n/o);if(this instanceof SurveyDisplay)return void this.notifyImageSize(m,g);e.style.height=g+"px",e.style.removeProperty("width"),e.style.left=Math.round((this.paddingLeft?this.paddingLeft:0)+(i-m)/2)+"px",e.style.top=Math.round((this.paddingTop?this.paddingTop:0)+(r-g)/2)+"px"}}}},ContentDisplay.prototype.iframeContentDisplay=function(e){var t=document.createElement("iframe");return t.frameBorder=0,t.scrolling="auto",{root:t,format:t,content:t,type:"iframe",value:void 0}},ContentDisplay.prototype.refreshIFrame=function(e){var t=e.iframe,i=this.displayElement.content;void 0!==t&&void 0!==t.src&&(i.src=t.src)},ContentDisplay.prototype.setDisplayElementPos=function(){if(this.displayElement){var e=this.displayElement.root;if(e){this.updateSizeRequirements();var t=this.getContentWidth(),i=this.getContentHeight(),r=isNaN(t)?0:t+this.extraWidth,n=isNaN(i)?0:i+this.extraHeight;switch(this.displayType){case"image":this.imageUpdateHeightWidth(e);break;case"arc":case"triangle":this.canvas.width=r,this.canvas.height=n,e.style.width=r+"px",e.style.height=n+"px",e.style.top=(this.paddingTop?this.paddingTop:0)+"px",e.style.left=(this.paddingLeft?this.paddingLeft:0)+"px";break;case"text":if(e.style.width=r+"px",e.style.height=n+"px",e.style.top=(this.paddingTop?this.paddingTop:0)+"px",e.style.left=(this.paddingLeft?this.paddingLeft:0)+"px",!isNaN(t)&&void 0!==this.descriptionDisplay&&void 0!==this.descriptionDisplay.text&&void 0!==this.descriptionDisplay.text.value){var o=this.descriptionDisplay.text;this.displayElement.content.style.maxWidth=void 0!==o.overflow&&"clip"!==o.overflow&&"nowrap"===o.whiteSpace?r+"px":""}0!==this.getRotation()&&this.applyHTMLTransform(this.descriptionDisplay.transform);break;case"html":case"iframe":case"foreign":if(void 0===this.previousPositions)this.previousPositions={top:void 0,left:void 0,width:void 0,height:void 0};else if(this.previousPositions.width===r&&this.previousPositions.height===n&&this.previousPositions.top===(this.paddingTop?this.paddingTop:0)&&this.previousPositions.left===(this.paddingLeft?this.paddingLeft:0))return;if(this.previousPositions.width=r,this.previousPositions.height=n,this.previousPositions.top=this.paddingTop?this.paddingTop:0,this.previousPositions.left=this.paddingLeft?this.paddingLeft:0,e.style.width=r+"px",e.style.height=n+"px",e.style.top=(this.paddingTop?this.paddingTop:0)+"px",e.style.left=(this.paddingLeft?this.paddingLeft:0)+"px",void 0!==this.displayElement.foreignElement){var s=this.displayElement.foreignElement;s.style.width=r+"px",s.style.height=n+"px"}break;case"empty":break;default:mondriaInternalError("setting element pos for unknown type: ",this.displayType)}}}},ContentDisplay.prototype.updateSizeRequirements=function(){switch(this.displayElement.type){case"triangle":var e=getDeOSedValue(this.descriptionDisplay.triangle.shadow);if(e instanceof Object&&!(e instanceof Array)){var t=getNumberForCSSStyle(e.blurRadius),i=getNumberForCSSStyle(e.horizontal),r=getNumberForCSSStyle(e.vertical);this.extraWidth=Math.max(i+t,0),this.extraHeight=Math.max(r+t,0)}else this.extraWidth=0,this.extraHeight=0;break;default:this.extraWidth=0,this.extraHeight=0}},ContentDisplay.prototype.setForeignElement=function(e){void 0!==this.displayElement&&(this.displayElement.foreignElement=e,void 0!==e&&void 0!==this.previousPositions&&(e.style.width=this.previousPositions.width,e.style.height=this.previousPositions.height))},ContentDisplay.prototype.setShowEmbedding=function(e){this.showEmbedding=!!e},inherit(Display,ContentDisplay),Display.prototype.destroy=function(){this.destroyDisplayElements(),this.ContentDisplay_destroy()},Display.prototype.getEmbeddingDiv=function(){return null===this.embeddingDiv&&(this.embeddingDiv=createDiv(this.baseArea.areaId+":embedding"),this.showEmbedding&&(this.baseArea.contentPos?embedElementAtPos(this.embeddingDiv,this.baseArea.contentPos,this.frameDiv,null):embedZeroOffsetElementAtPos(this.embeddingDiv,this.baseArea.relative,this.frameDiv,null))),this.embeddingDiv},Display.prototype.configurationUpdate=function(e,t,i){this.resetFrame(e,i),this.ContentDisplay_configurationUpdate(e,t,i)},Display.prototype.applyTransitionProperties=function(e){this.ContentDisplay_applyTransitionProperties(e),void 0!==this.descriptionDisplay&&(copyTransitionCssProp(this.frameDiv.style,void 0,e),this.embeddingDiv&&copyTransitionCssProp(this.embeddingDiv.style,void 0,e))},Display.prototype.contentOffsetModeChange=function(e,t,i,r){var n="independent"===i,o=n!==this.independentContentPosition;this.independentContentPosition=n,o&&void 0!==this.descriptionDisplay&&"boxShadow"in this.descriptionDisplay&&copyDisplayCssProp(this,"boxShadow",n?"":this.descriptionDisplay.boxShadow)},Display.prototype.refreshPos=function(){"triangle"==this.displayType||"arc"===this.displayType?this.displayContentRefresh(!1,!0,!1):this.setDisplayElementPos()},Display.prototype.getContentWidth=function(){var e=this.baseArea.contentPos?this.baseArea.contentPos:this.baseArea.relative;return e.width},Display.prototype.getContentHeight=function(){var e=this.baseArea.contentPos?this.baseArea.contentPos:this.baseArea.relative;return e.height},Display.prototype.getScaleX=function(){var e=this.descriptionDisplay.transform;if("object"==typeof e){if("number"==typeof e.scale)return e.scale;if("object"==typeof e.scale&&"number"==typeof e.scale.x)return e.scale.x}return 1},Display.prototype.getScaleY=function(){var e=this.descriptionDisplay.transform;if("object"==typeof e){if("number"==typeof e.scale)return e.scale;if("object"==typeof e.scale&&"number"==typeof e.scale.y)return e.scale.y}return 1};var selectableInputElementTypes={text:!0,password:!0};Display.prototype.createInputCell=function(e){var t=this.ContentDisplay_createInputCell(e),i="text"in e?e.text.input:void 0,r=this.baseArea.areaReference,n={},o=this,s="text"in e?e.text.value:void 0,a=s;s instanceof Array&&(s=s[0]);var d=t.root;switch(d.style.background="transparent",i.type in selectableInputElementTypes&&d&&"object"==typeof d&&postInputParamChangeEvent(this.baseArea,!1,{selectionStart:d.selectionStart,selectionEnd:d.selectionEnd,selectionDirection:d.selectionDirection,value:""===s?constEmptyOS:s}),d.addEventListener("input",function(e){d.value!==a&&(a=d.value,o.oninput(e,d))},!1),"file"===i.type?d.addEventListener("change",function(e){o.oninput(e,d),d.value=""},!1):d.addEventListener("change",function(e){d.value!==a&&(a=d.value,o.oninput(e,d))},!1),d.addEventListener("select",function(e){d.value!==a&&(a=d.value,o.oninput(e,d))},!1),d.addEventListener("focus",function(e){o.onfocus(!0)},!1),d.addEventListener("blur",function(e){o.onfocus(!1)},!1),i.type){case"text":case"number":case"password":d.addEventListener("keydown",function(e){postKeyEvent(e,r)},!1),d.addEventListener("keyup",function(e){postKeyEvent(e,r)},!1),d.addEventListener("keypress",function(e){if(postKeyEvent(e,r)&&e.ctrlKey&&10===e.keyCode&&"textarea"===d.type){var t=d.selectionStart,i=d.value.substr(0,t),n=d.value.substr(d.selectionEnd);d.value=i+"\n"+n,d.setSelectionRange(t+1,t+1)}},!1);break;case"file":if(d.addEventListener("dragenter",function(e){gDomEvent.dragEnterHandler(e)},!1),d.addEventListener("dragleave",function(e){gDomEvent.dragLeaveHandler(e)},!1),d.addEventListener("drop",function(e){e.preventDefault()},!1),void 0!==i.acceptFiles){var u=i.acceptFiles;u instanceof Array&&(u=u.filter(function(e){return"string"==typeof e}).join(",")),"string"==typeof u?d.accept=u:d.accept=""}}if(i.type in selectableInputElementTypes&&void 0!==i.init){var h=getDeOSedValue(i.init),l=getDeOSedValue(h.selectionStart);
l>=0&&(n.selectionStart=l,this.baseArea.updateParamInput({selectionStart:l},!1,!1)),l=getDeOSedValue(h.selectionEnd),l<0&&(l+=d.value.length+1),l>=0&&(n.selectionEnd=l,d.selectionEnd!==l&&this.baseArea.updateParamInput({selectionEnd:l},!1,!1)),l=getDeOSedValue(h.selectionDirection),"forward"!==l&&"backward"!==l&&"none"!==l||(n.selectionDirection=l,d.selectionDirection!==l&&this.baseArea.updateParamInput({selectionDirection:l},!1,!1)),"focus"in h&&!isTrue(h.focus)?this.baseArea.updateParamInput({focus:[!1]},!1,!1):(n.focus=!0,this.baseArea.updateParamInput({focus:[!0]},!1,!1))}else n.focus=!0,this.baseArea.updateParamInput({focus:[!0]},!1,!1);return t.postAddAction=n,t},Display.prototype.oninput=function(e,t){if(t.type in selectableInputElementTypes)postInputParamChangeEvent(this.baseArea,!0,{value:""===t.value?constEmptyOS:t.value,selectionStart:t.selectionStart,selectionEnd:t.selectionEnd,selectionDirection:t.selectionDirection});else if("file"===t.type)gDomEvent.pickFile(e,this.baseArea,t.files);else{var i=""===t.value?constEmptyOS:t.value;postInputParamChangeEvent(this.baseArea,!0,{value:i})}},Display.prototype.onfocus=function(e){gDomEvent.recordComment("focus "+e+" on "+this.baseArea.areaId),postInputParamChangeEvent(this.baseArea,!0,{focus:e})},Display.prototype.applyHTMLTransform=function(e){if(this.displayElement&&this.displayElement.root){var t=this.baseArea.parent,i=void 0===t?this.baseArea.relative.width:t.relative.width;assignCSSStyleProp(this.displayElement.root.style,"transform",getTransformObjectAsString(e,this.displayType,i))}},Display.prototype.hasActiveInputElement=function(){return void 0!==this.displayElement&&"input"===this.displayElement.type&&"file"!==this.displayElement.inputType&&!this.displayElement.disabled},Display.prototype.inputElementIsValid=function(){return void 0===this.displayElement||"input"!==this.displayElement.type||this.displayElement.root.validity.valid},Display.prototype.takeFocus=function(){gDomEvent.recordComment("takeFocus "+this.baseArea.areaId),this.displayElement.root.focus()},Display.prototype.hasFocus=function(){return void 0!==this.displayElement&&"input"===this.displayElement.type&&!this.displayElement.disabled&&this.displayElement.root===document.activeElement},Display.prototype.releaseFocus=function(){gDomEvent.recordComment("releaseFocus "+this.baseArea.areaId),gDomEvent.setNextFocussedArea(void 0)},Display.prototype.willHandleClick=function(){return void 0!==this.descriptionDisplay&&void 0!==this.descriptionDisplay.html&&isTrue(this.descriptionDisplay.html.handleClick)},Display.prototype.setInputState=function(e,t){if(void 0===this.displayElement||"input"!==this.displayElement.type)return!1;var i=this.displayElement.root;switch(e){case"value":if(t instanceof NonAV&&(t=t.toString()),!isSimpleType(t))return!1;if(i.type in selectableInputElementTypes){var r=i.selectionStart,n=i.selectionEnd,o=i.selectionDirection,s={value:""===t?constEmptyOS:t};i.value=t,i.selectionStart=r,i.selectionStart!==r&&(s.selectionStart=i.selectionStart),i.selectionEnd=n,i.selectionEnd!==n&&(s.selectionEnd=i.selectionEnd),i.selectionDirection=o,i.selectionDirection!==o&&(s.selectionDirection=i.selectionDirection),this.baseArea.updateParamInput(s,!0,!0)}break;case"focus":gDomEvent.setNextFocussedArea(isTrue(t)?this.baseArea:void 0);break;case"selectionStart":if(!(i.type in selectableInputElementTypes&&t>=0))return!1;i.selectionStart=t,i.selectionStart!==t&&this.baseArea.updateParamInput({selectionStart:t},!0,!0);break;case"selectionEnd":if(!(i.type in selectableInputElementTypes&&t>=0))return!1;i.selectionEnd=t,i.selectionEnd!==t&&this.baseArea.updateParamInput({selectionEnd:t},!0,!0);break;case"selectionDirection":if(!(i.type in selectableInputElementTypes)||"forward"!==t&&"backward"!==t&&"none"!==t)return!1;i.selectionDirection=t,i.selectionDirection!==t&&this.baseArea.updateParamInput({selectionDirection:t},!0,!0)}return!0},Display.prototype.postAddActions=function(){if("postAddAction"in this.displayElement)for(var e in this.displayElement.postAddAction)"focus"===e?this.displayElement.postAddAction.focus&&gDomEvent.setNextFocussedArea(this.baseArea):this.displayElement.root[e]=this.displayElement.postAddAction[e];"canvas"in this&&(this.displayDiv&&(this.displayDiv.style.overflow=""),this.frameDiv&&(this.frameDiv.style.overflow=""))},Display.prototype.createDisplayDiv=function(){var e=this.baseArea.areaId+":display";if(!this.ContentDisplay_createDisplayDiv(e))return!1;var t=this.baseArea.relative;return embedElementAtPos(this.displayDiv,this.baseArea.displayDivPos?this.baseArea.displayDivPos:{left:"0",top:"0",width:t.width,height:t.height},this.frameDiv,this.embeddingDiv),this.displayDiv.style.zIndex=this.displayZ,!0},Display.prototype.destroyDisplayElements=function(){this.hasFocus()&&(this.releaseFocus(),gDomEvent.setGlobalFocus()),this.destroyDisplayElement("frameDiv"),this.destroyDisplayElement("embeddingDiv"),this.removeDisplayElement()};var frameResetProperties={background:"",borderSpacing:"",boxShadow:"",hoverText:"",opacity:"",borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0,borderStyle:"",borderWidth:"",borderColor:"",paddingLeft:"",paddingRight:"",paddingTop:"",paddingBottom:"",overflow:"",transform:""},displayResetProperties={clip:!1,color:"",fontFamily:"",fontSize:"",fontStyle:"",fontVariant:"",fontWeight:"",lineHeight:"",textShadow:"",textAlign:"center",textDecoration:"",textFillColor:"",textIndent:"",textStrokeColor:"",textStrokeWidth:"",textTransform:"",verticalAlign:"middle",overflowX:"",overflowY:"",overflow:"",whiteSpace:""};Display.prototype.applyDisplayProperties=function(e,t,i,r){e=e?shallowCopy(e):{};var n=this.baseArea.registerContentOffsets(e,!0);t&&(this.independentContentPosition&&"boxShadow"in e&&delete e.boxShadow,this.ContentDisplay_applyDisplayProperties(e,!0,i,!0),this.paddingLeft=n.paddingLeft?n.paddingLeft:0,this.paddingTop=n.paddingTop?n.paddingTop:0,this.paddingRight=n.paddingRight?n.paddingRight:0,this.paddingBottom=n.paddingBottom?n.paddingBottom:0)},Display.prototype.resetFrame=function(e,t){t&&("transitions"in e?(copyTransitionCssProp(this.frameDiv.style,void 0,e.transitions),this.embeddingDiv&&copyTransitionCssProp(this.embeddingDiv.style,void 0,e.transitions)):(resetTransitionCssProp(this.frameDiv.style,void 0,void 0),this.embeddingDiv&&resetTransitionCssProp(this.embeddingDiv.style,void 0,void 0)))},Display.prototype.setZIndex=function(e,t){this.frameZ=e,this.frameDiv&&(this.frameDiv.style.zIndex=e),this.displayZ=t,this.displayDiv&&(this.displayDiv.style.zIndex=t)},Display.prototype.isOpaque=function(){var e=this.descriptionDisplay;return void 0!==e&&(void 0!==e.pointerOpaque?e.pointerOpaque:void 0!==e.background||void 0!==e.image&&void 0!==e.image.src||void 0!==e.triangle&&void 0!==e.triangle.color||void 0!==e.arc&&void 0!==e.arc.color)},Display.prototype.hasVisibleBorder=function(){function e(e){return void 0!==e&&""!==e&&"none"!==e}var t=this.descriptionDisplay;if(void 0===t)return!1;var i=e(t.borderStyle)||e(t.borderTopStyle)||e(t.borderLeftStyle)||e(t.borderBottomStyle)||e(t.borderRightStyle),r=e(t.borderWidth)||e(t.borderTopWidth)||e(t.borderLeftWidth)||e(t.borderBottomWidth)||e(t.borderRightWidth);return i&&r},Display.prototype.debugGetDescription=function(){return this.descriptionDisplay},Display.prototype.setShowEmbedding=function(e){!this.showEmbedding!=!e&&(this.embeddingDiv&&(e?this.baseArea.contentPos?embedElementAtPos(this.embeddingDiv,this.baseArea.contentPos,this.frameDiv,this.frameDiv.firstChild):embedZeroOffsetElementAtPos(this.embeddingDiv,this.baseArea.relative,this.frameDiv,this.frameDiv.firstChild):this.frameDiv.removeChild(this.embeddingDiv)),this.showEmbedding=!!e)},inherit(SurveyDisplay,ContentDisplay),SurveyDisplay.embeddingDiv=void 0,SurveyDisplay.getEmbeddingDiv=function(){if("undefined"==typeof SurveyDisplay.embeddingDiv){var e=createDiv("surveyDivContainer");e.style.position="absolute",e.style.left=0,e.style.top=0,e.style.width="100000px",e.style.width="100000px",document.body.appendChild(e),SurveyDisplay.embeddingDiv=e}return SurveyDisplay.embeddingDiv},SurveyDisplay.prototype.update=function(e,t,i){if(this.swidth=t,this.sheight=i,this.configurationUpdate(e,!0,!1),void 0!==this.displayElement){var r=this.displayElement.root;"number"==typeof t?r.style.width=t+"px":r.style.width="auto","number"==typeof i?r.style.height=i+"px":r.style.height="auto"}"image"!==this.displayType&&this.surveyor.surveyNotification()},SurveyDisplay.prototype.applyHTMLTransform=function(e){this.displayElement&&this.displayElement.root&&assignCSSStyleProp(this.displayElement.root.style,"transform",getTransformObjectAsString(e,this.displayType,0))},SurveyDisplay.prototype.notifyImageSize=function(e,t){this.surveyor.imageSizeNotification(e,t)},SurveyDisplay.prototype.createDisplayDiv=function(){if(this.ContentDisplay_createDisplayDiv(this.areaId+":survey"),this.displayDiv){var e=SurveyDisplay.getEmbeddingDiv();e.appendChild(this.displayDiv),this.displayDiv.style.left="inherit",this.displayDiv.style.top="inherit",this.displayDiv.style.width="inherit",this.displayDiv.style.height="inherit",this.displayDiv.style.visibility="hidden";var t=this.areaId;this.displayDiv.onload=function(){console.log("loaded div",t)}}},SurveyDisplay.prototype.getWidth=function(){if("undefined"==typeof this.displayElement)return 0;var e=this.displayElement.root;if("image"===this.displayType){if("number"==typeof this.swidth)return this.swidth;var t=e,i=t.naturalWidth;return"number"==typeof this.sheight?t.naturalHeight?Math.round(i*(this.sheight/t.naturalHeight)):0:i}if("estimate"===runtimeEnvironment.surveyMode)return this.getEstimateWidth();var r=e.getBoundingClientRect(),n=r.right-r.left;return Math.ceil(n)},SurveyDisplay.prototype.getHeight=function(){if("undefined"==typeof this.displayElement)return 0;var e=this.displayElement.root;if("image"===this.displayType){if("number"==typeof this.sheight)return this.sheight;var t=e,i=t.naturalHeight;return"number"==typeof this.swidth?t.naturalWidth?Math.round(i*(this.swidth/t.naturalWidth)):0:i}if("estimate"===runtimeEnvironment.surveyMode)return this.getEstimateHeight();var r=e.getBoundingClientRect(),n=r.bottom-r.top;return Math.ceil(n)},SurveyDisplay.prototype.getSize=function(){if(void 0===this.displayElement)return[0,0];if("image"===this.displayType)return[this.getWidth(),this.getHeight()];if("estimate"===runtimeEnvironment.surveyMode){var e=this.getEstimateSize();return[e.width,e.height]}var t=this.displayElement.root,i=t.getBoundingClientRect(),r=i.bottom-i.top,n=i.right-i.left;return[Math.ceil(n),Math.ceil(r)]},SurveyDisplay.prototype.getEstimateWidth=function(){var e=this.getEstimateSize();return e.width},SurveyDisplay.prototype.getEstimateHeight=function(){var e=this.getEstimateSize();return e.height},SurveyDisplay.prototype.getEstimateSize=function(){switch(this.displayType){case"text":return this.getEstimateTextSize();default:return Utilities.warnOnce("SurveyDisplay.getWidth: estimate environment does not support display type '"+this.displayType+"'"),{width:0,height:0}}},SurveyDisplay.prototype.getEstimateTextSize=function(){var e=this.descriptionDisplay,t=e.text,i=t.value;i instanceof Array&&(i=i[0]);var r="number"==typeof t.fontSize?t.fontSize:11,n=String(i).length*r*.63,o=1.2*r;return{width:n,height:o}};var globalScreenWidthConstraint,globalScreenHeightConstraint;IntersectionChain.prototype.mergeIntersectionChain=intersectionChainMergeIntersectionChain,IntersectionChain.prototype.contains=intersectionChainContains;var posPointLabelFuncByEdge={left:leftLabel,right:rightLabel,top:topLabel,bottom:bottomLabel},posPointFrameLabelFuncByEdge={left:leftFrameLabel,right:rightFrameLabel,top:topFrameLabel,bottom:bottomFrameLabel},edgePointSuffixFunctions={},centerPointSuffixFunctions={},nextPointLabelId=1025,globalPointLabelIds={};RVPosPoint.uid=0,RVPosPoint.nextUid=1,RVPosPoint.prototype.getNextUid=rvPosPointGetNextUid,RVPosPoint.prototype.destroy=rvPosPointDestroy,RVPosPoint.prototype.newDescription=rvPosPointNewDescription,RVPosPoint.prototype.destroyEmbeddingChangeRequests=rvPosPointDestroyEmbeddingChangeRequests,RVPosPoint.prototype.setElement=rVPosPointSetElement,RVPosPoint.prototype.cleanElement=rVPosPointCleanElement,RVPosPoint.prototype.addIdRef=rVPosPointAddIdRef,RVPosPoint.prototype.removeIdRef=rVPosPointRemoveIdRef,RVPosPoint.prototype.addId=rVPosPointAddId,RVPosPoint.prototype.removeId=rVPosPointRemoveId,RVPosPoint.prototype.addRemoveId=rVPosPointAddRemoveId,RVPosPoint.prototype.createAllLabels=rvPosPointCreateAllLabels,RVPosPoint.prototype.removeAllLabels=rvPosPointRemoveAllLabels,RVPosPoint.prototype.addAreaPair=rvPosPointAddAreaPair,RVPosPoint.prototype.removeAreaPair=rvPosPointRemoveAreaPair,RVPosPoint.prototype.updateEmbedding=rvPosPointUpdateEmbedding,RVPosPoint.prototype.isSimple=rvPosPointIsSimple,RVPosPoint.prototype.registerToContentPosModule=rvPosPointRegisterToContentPosModule,RVPosPoint.prototype.unregisterFromContentPosModule=rvPosPointUnregisterFromContentPosModule,RVPosPoint.prototype.contentOffsetModeChange=rvPosPointContentOffsetModeChange,RVPosPoint.getEmbeddingId=rvPosPointGetEmbeddingId,SuffixPosPoint.prototype.destroy=suffixPosPointDestroy,SuffixPosPoint.prototype.labelAttrs={element:!0,label:!0},SuffixPosPoint.prototype.typeAttrs={type:!0,content:!0,element:!0,intersection:!0},SuffixPosPoint.prototype.newDescription=suffixPosPointNewDescription,SuffixPosPoint.prototype.destroyAllLabels=suffixPosPointDestroyAllLabels,SuffixPosPoint.prototype.labelPrefixStr="",SuffixPosPoint.prototype.createAreaLabel=suffixPosPointCreateAreaLabel,SuffixPosPoint.prototype.updateAreas=suffixPosPointUpdateAreas,SuffixPosPoint.prototype.addArea=suffixPosPointAddArea,SuffixPosPoint.prototype.removeArea=suffixPosPointRemoveArea,SuffixPosPoint.prototype.removeAreaLabel=suffixPosPointRemoveAreaLabel,SuffixPosPoint.prototype.getSuffixFunc=suffixPosPointGetSuffixFunc,SuffixPosPoint.prototype.zeroOffsetToggle=suffixPosPointZeroOffsetToggle,SuffixPosPoint.prototype.allAreasRegisterZeroModeToggle=suffixPosPointAllAreasRegisterZeroModeToggle;var suffixPosPointNextUid=1;SuffixPosPoint.prototype.registerZeroModeToggle=suffixPosPointRegisterZeroModeToggle,SuffixPosPoint.prototype.unregisterZeroModeToggle=suffixPosPointUnregisterZeroModeToggle,PosPoint.prototype.destroyPoint=posPointDestroyPoint,PosPoint.prototype.callReleaseElementFunctions=posPointCallReleaseElementFunctions,PosPoint.prototype.addLabel=posPointAddLabel,PosPoint.prototype.removeLabel=posPointRemoveLabel,PosPoint.prototype.removeAllLabels=posPointRemoveAllLabels,PosPoint.prototype.getLabels=posPointGetLabels,PosPoint.prototype.newDescription=posPointNewDescription,PosPoint.prototype.determineType=posPointDetermineType,PosPoint.definedTypes={left:!0,right:!0,top:!0,bottom:!0,"horizontal-center":!0,"vertical-center":!0},PosPoint.definedEdgeTypes={left:!0,right:!0,top:!0,bottom:!0},PosPoint.prototype.registerHandler=posPointRegisterHandler,PosPoint.prototype.removeHandlerById=posPointRemoveHandlerById,PosPoint.prototype.removeHandler=posPointRemoveHandler,PosPoint.prototype.applyChanges=posPointApplyChanges,PosPoint.prototype.callHandlers=posPointCallHandlers,UndefinedPosPoint.prototype.destroy=undefinedPosPointDestroy,UndefinedPosPoint.prototype.newDescription=undefinedPosPointNewDescription,GlobalLabelPosPoint.prototype.destroy=globalLabelPosPointDestroy,GlobalLabelPosPoint.prototype.constPrefixStr="_",GlobalLabelPosPoint.prototype.newDescription=globalLabelPosPointNewDescription,InternalLabelPosPoint.prototype.destroy=internalLabelPosPointDestroy,InternalLabelPosPoint.prototype.newDescription=internalLabelPosPointNewDescription,PosPair.prototype.destroyPair=posPairDestroyPair,PosPair.prototype.newDescription=posPairNewDescription,PosPair.prototype.updatePointsDescription=PosPair_updatePointsDescription,PosPair.prototype.pointHandler=posPairPointHandler,PosPair.prototype.addPair=posPairAddPair,PosPair.prototype.removePair=posPairRemovePair,PosPair.prototype.registerHandler=posPairRegisterHandler,PosPair.prototype.removeHandlerById=posPairRemoveHandlerById,PosPair.prototype.removeHandler=posPairRemoveHandler,PosPair.prototype.callHandlers=posPairCallHandlers,PairPointHandler.prototype.call=pairPointHandlerCall;var posConstraintLastId=0;PosConstraint.prototype.defaultPriority=0,PosConstraint.prototype.newDescription=posConstraintNewDescription,PosConstraint.prototype.setType=posConstraintSetType,PosConstraint.prototype.createLinearId=posConstraintCreateLinearId,PosConstraint.prototype.createSegmentId=posConstraintCreateSegmentId,PosConstraint.prototype.clearConstraintParameters=posConstraintClearConstraintParameters,PosConstraint.prototype.destroyConstraint=posConstraintDestroyConstraint,PosConstraint.prototype.removeAllConstraints=posConstraintRemoveAllConstraints,PosConstraint.prototype.removeConstraintsByPair=posConstraintRemoveConstraintsByPair,PosConstraint.prototype.addIdUnderPairEntry=posConstraintAddIdUnderPairEntry,PosConstraint.prototype.removeIdFromPairEntry=posConstraintRemoveIdFromPairEntry,PosConstraint.prototype.setLinearConstraint=posConstraintSetLinearConstraint,PosConstraint.prototype.createAllLinearConstraints=posConstraintCreateAllLinearConstraints,PosConstraint.prototype.updateChangedLinearConstraints=posConstraintUpdateChangedLinearConstraints,PosConstraint.prototype.pairChangesRemoveAndCreateLinear=posConstraintPairChangesRemoveAndCreateLinear,PosConstraint.prototype.updateLinearConstraint=posConstraintUpdateLinearConstraint,PosConstraint.prototype.addLinearConstraint=posConstraintAddLinearConstraint,PosConstraint.prototype.addLinearToPosCalc=posConstraintAddLinearToPosCalc,PosConstraint.prototype.removeLinearFromPosCalc=posConstraintRemoveLinearFromPosCalc,PosConstraint.prototype.updatePairChangesForLinear=posConstraintUpdatePairChangesForLinear,PosConstraint.prototype.setSegmentConstraint=posConstraintSetSegmentConstraint,PosConstraint.prototype.createAllSegmentConstraints=posConstraintCreateAllSegmentConstraints,PosConstraint.prototype.updateChangedSegmentConstraints=posConstraintUpdateChangedSegmentConstraints,PosConstraint.prototype.pairChangesRemoveAndCreateSegment=posConstraintPairChangesRemoveAndCreateSegment,PosConstraint.prototype.updateSegmentConstraint=posConstraintUpdateSegmentConstraint,PosConstraint.prototype.addSegmentConstraint=posConstraintAddSegmentConstraint,PosConstraint.prototype.updatePairChangesForSegment=posConstraintUpdatePairChangesForSegment,PosConstraint.prototype.pairHandler=posConstraintPairHandler,ConstraintPairHandler.prototype.call=constraintPairHandlerCall;var maxNonSystemPosPriority=1e3,defaultPosPriority=0,strongAutoPosPriority=2e3,strongestAutoPosPriority=3e3;PosConstraintManager.prototype.destroyConstraints=posConstraintManagerDestroyConstraints,PosConstraintManager.prototype.makeInnerName=posConstraintManagerMakeInnerName,PosConstraintManager.prototype.makeConfName=posConstraintManagerMakeConfName,PosConstraintManager.prototype.removeConstraintsNotInDescription=posConstraintManagerRemoveConstraintsNotInDescription,PosConstraintManager.prototype.newDescription=posConstraintManagerNewDescription,PosConstraintManager.prototype.addNewConstraint=posConstraintManagerAddNewDescription,PosConstraintManager.prototype.removeConstraint=posConstraintManagerRemoveConstraint,PosConstraintManager.prototype.removeConstraintInnerName=posConstraintManagerRemoveConstraintInnerName,PosConstraintManager.prototype.addConstraint=posConstraintManagerAddConstraint,PosConstraintManager.prototype.makeLinearDesc=posConstraintManagerMakeLinearDesc,PosConstraintManager.prototype.makeSegmentDesc=posConstraintManagerMakeSegmentDesc,PosConstraintManager.prototype.makePreferenceDesc=posConstraintManagerMakePreferenceDesc,PosConstraintManager.prototype.makePointDesc=posConstraintManagerMakePointDesc,PosConstraintManager.prototype.resolveGroupMembers=posConstraintManagerResolveGroupMembers,PosConstraintManager.prototype.rResolveGroupMembers=posConstraintManagerRResolveGroupMembers,PosConstraintManager.prototype.isReservedPoint=posConstraintManagerIsReservedPoint,PosConstraintManager.prototype.getReservedConstraintNameEntry=posConstraintManagerGetReservedConstraintNameEntry,inherit(AllPosConstraints,PosConstraintManager),AllPosConstraints.prototype.destroy=allPosConstraintsDestroy,AllPosConstraints.prototype.addAutoConstraints=allPosConstraintsAddAutoConstraints,AllPosConstraints.prototype.setAutoContentConstraint=allPosConstraintsSetAutoContentConstraint,AllPosConstraints.prototype.setAllAutoContentConstraints=allPosConstraintsSetAllAutoContentConstraints,AllPosConstraints.prototype.removeAutoContentConstraints=allPosConstraintsRemoveAutoContentConstraints,AllPosConstraints.prototype.initAutomaticPointConstraints=allPosConstraintsInitAutomaticPointConstraints,AllPosConstraints.prototype.removeAllAutomaticPointConstraints=allPosConstraintsRemoveAllAutomaticPointConstraints,AllPosConstraints.prototype.recreateAutomaticPointConstraints=allPosConstraintsRecreateAutomaticPointConstraints,AllPosConstraints.prototype.makeAutomaticPointConstraint=allPosConstraintsMakeAutomaticPointConstraint,AllPosConstraints.prototype.addCenterPointConstraints=allPosConstraintsAddCenterPointConstraints,AllPosConstraints.prototype.makeCenterPointConstraints=allPosConstraintsMakeCenterPointConstraints,AllPosConstraints.prototype.addRVPointConstraints=allPosConstraintsAddRVPointConstraints,AllPosConstraints.prototype.updateRVPointSimplicity=allPosConstraintsUpdateRVPointSimplicity,AllPosConstraints.prototype.makeRVPointConstraintDescs=allPosConstraintsMakeRVPointConstraintDescs,AllPosConstraints.prototype.addRVPointConstraintsFromDesc=allPosConstraintsAddRVPointConstraintsFromDesc,AllPosConstraints.prototype.removeRVPointConstraintsBySuffix=allPosConstraintsRemoveRVPointConstraintsBySuffix,AllPosConstraints.prototype.makeRVPointConstraints=allPosConstraintsMakeRVPointConstraints,AllPosConstraints.prototype.rvPointContentOffsetModeChange=allPosConstraintsRVPointContentOffsetModeChange,AllPosConstraints.prototype.rvPointEmbeddingChange=allPosConstraintsRvPointEmbeddingChange,AllPosConstraints.prototype.addIntersectionPointConstraints=allPosConstraintsAddIntersectionPointConstraints,AllPosConstraints.prototype.makeIntersectionPointConstraints=allPosConstraintsMakeIntersectionPointConstraints,AllPosConstraints.prototype.lceHandler=allPosConstraintsLceHandler,AllPosConstraints.prototype.makeIntersectionConstraintName=allPosConstraintsMakeIntersectionConstraintName,AllPosConstraints.prototype.removeAutomaticPointConstraints=allPosConstraintsRemoveAutomaticPointConstraints,AllPosConstraints.prototype.doRemoveAutomaticPointConstraint=allPosConstraintsDoRemoveAutomaticPointConstraint,AllPosConstraints.prototype.registerToContentPosModule=allPosConstraintsRegisterToContentPosModule,AllPosConstraints.prototype.unregisterFromContentPosModule=allPosConstraintsUnregisterFromContentPosModule,AllPosConstraints.prototype.contentOffsetModeChange=allPosConstraintsContentOffsetModeChange,AllPosConstraints.prototype.registerToEmbeddingChanges=allPosConstraintsRegisterToEmbeddingChanges,AllPosConstraints.prototype.unregisterFromEmbeddingChanges=allPosConstraintsUnregisterFromEmbeddingChanges,AllPosConstraints.prototype.updateEmbedding=allPosConstraintsUpdateEmbedding;var PosConstraintSynchronizer=function(){function e(){this.buffer=[],this.count=0}return e.prototype.addSegment=function(e,t,i,r,n,o,s,a,d){this.buffer.push([0,e,t,i,r,n,o,s,a,d])},e.prototype.removeSegment=function(e,t,i){this.buffer.push([1,e,t,i])},e.prototype.addLinear=function(e,t,i,r,n,o,s){this.buffer.push([2,e,t,i,r,n,o,s])},e.prototype.removeLinearById=function(e){this.buffer.push([3,e])},e.prototype.flushBuffer=function(){this.count+=this.buffer.length;for(var e=0;e!==this.buffer.length;e++){var t=this.buffer[e];switch(t[0]){case 0:globalPos.addSegment(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9]);break;case 1:globalPos.removeSegment(t[1],t[2],t[3]);break;case 2:globalPos.addLinear(t[1],t[2],t[3],t[4],t[5],t[6],t[7]);break;case 3:globalPos.removeLinearById(t[1])}}"log"in this?(this.log.push(this.buffer),this.buffer=[]):this.buffer.length=0},e.prototype.isEmpty=function(){return 0===this.buffer.length},e.prototype.logBuffers=function(){this.log=[]},e.prototype.stopLogging=function(){delete this.log},e.prototype.logToStr=function(){return this.log.map(function(e){return e.map(function(e){switch(e[0]){case 0:return"adds "+e[1]+","+e[2];case 1:return"rems "+e[1]+","+e[2];case 2:return"addl "+e[1]+","+e[2]+","+e[3]+","+e[4]+","+e[5];case 3:return"reml "+e[1];default:return"unknown"}}).join("\n")}).join("\n")},e}(),globalPosConstraintSynchronizer,globalAbsolutePosManager;AbsolutePosManager.makeEmptyPosObject=absolutePosManagerMakeEmptyPosObject,AbsolutePosManager.prototype.addArea=absolutePosManagerAddArea,AbsolutePosManager.prototype.addAreaContentOffsets=absolutePosManagerAddAreaContentOffsets,AbsolutePosManager.prototype.removeArea=absolutePosManagerRemoveArea,AbsolutePosManager.prototype.removeAreaContentOffsets=absolutePosManagerRemoveAreaContentOffsets,AbsolutePosManager.prototype.newEmbedding=absolutePosManagerNewEmbedding,AbsolutePosManager.prototype.addOffset=absolutePosManagerAddOffset,AbsolutePosManager.prototype.removeOffset=absolutePosManagerRemoveOffset,AbsolutePosManager.prototype.refreshPos=absolutePosManagerRefreshPos,AbsolutePosManager.prototype.updatePairOffset=absolutePosManagerUpdatePairOffset,AbsolutePosManager.prototype.updateCornerOffset=absolutePosManagerUpdateCornerOffset,AbsolutePosManager.prototype.updateSizeOffset=absolutePosManagerUpdateSizeOffset,AbsolutePosManager.prototype.refreshDisplayOffset=absolutePosManagerRefreshDisplayOffset,ContentPosManager.edgeNames={left:!0,right:!0,top:!0,bottom:!0},ContentPosManager.prototype.independentContentPositionHandler=contentPosManagerIndependentContentPositionHandler,ContentPosManager.prototype.setContentOffset=contentPosManagerSetContentOffset,ContentPosManager.prototype.setAllContentOffsets=contentPosManagerSetAllContentOffsets,ContentPosManager.prototype.setAutoConstraint=contentPosManagerSetAutoConstraint,ContentPosManager.prototype.getOffset=contentPosManagerGetOffset,ContentPosManager.prototype.determineMode=contentPosManagerDetermineMode,ContentPosManager.prototype.isInAutoOffsetMode=contentPosManagerIsInAutoOffsetMode,ContentPosManager.prototype.isInZeroOffsetMode=contentPosManagerIsInZeroOffsetMode,ContentPosManager.prototype.isInIndependentContentPositionMode=contentPosManagerIsInIndependentContentPositionMode,ContentPosManager.prototype.setZeroOffsetMode=contentPosManagerSetZeroOffsetMode,ContentPosManager.prototype.setAutoOffsetMode=contentPosManagerSetAutoOffsetMode,ContentPosManager.prototype.setIndependentContentPositionMode=contentPosManagerSetIndependentContentPositionMode,ContentPosManager.prototype.toggleZeroOffsetMode=contentPosManagerToggleZeroOffsetMode,ContentPosManager.prototype.registerAllModeChange=contentPosManagerRegisterAllModeChange,ContentPosManager.prototype.unregisterAllModeChange=contentPosManagerUnregisterAllModeChange,ContentPosManager.prototype.unregisterZeroOffsetModeToggle=contentPosManagerUnregisterZeroOffsetModeToggle,ContentPosManager.prototype.registerZeroOffsetModeToggle=contentPosManagerRegisterZeroOffsetModeToggle,ContentPosManager.prototype.unregisterZeroOffsetModeToggle=contentPosManagerUnregisterZeroOffsetModeToggle,ContentPosManager.prototype.callCallbacks=contentPosManagerCallCallbacks,LabelPairOffset.prototype.destroy=labelPairOffsetDestroy,LabelPairOffset.prototype.get=labelPairOffsetGet,LabelPairOffset.prototype.updateOffset=labelPairOffsetUpdateOffset;var gZRelationId=1;ZRelation.prototype.getId=zrelationGetId,ZRelation.prototype.getBelow=zRelationGetBelow,ZRelation.prototype.getAbove=zRelationGetAbove,ZRelation.prototype.getRelationSet=zrelationGetRelationSet,ZRelation.prototype.getPriority=zrelationGetPriority,ZRelation.prototype.isPresent=zrelationIsPresent,ZRelation.prototype.isActive=zrelationIsActive,ZRelationSet.prototype.toString=zrelationSetToString,ZRelationSet.prototype.toString2=zrelationSetToString2,ZRelationSet.prototype.getId=zRelationSetGetId,ZRelationSet.prototype.getActive=zrelationSetGetActive,ZRelationSet.prototype.contains=zrelationSetContains,ZRelationSet.prototype.add=zrelationSetAdd,ZRelationSet.prototype.remove=zrelationSetRemove,ZRelationSet.prototype.activate=zrelationSetActivate,ZRelationSet.prototype.deactivate=zrelationSetDeactivate,ZRelationSet.prototype.getMaxPriorityRelation=zrelationSetGetMaxPriorityRelation,ZRelationSet.prototype.getMaxPriority=zrelationSetGetMaxPriority,ZRelationSet.prototype.isEmpty=zrelationSetIsEmpty,ZRelationSet.prototype.findEquivalentRel=zRelationSetFindEquivalentRel,Vertex.prototype.addAbove=lowerThanAddAbove,Vertex.prototype.addBelow=lowerThanAddBelow,Vertex.prototype.isDirectlyBelow=vertexIsDirectlyBelow,Vertex.prototype.isDirectlyAbove=vertexIsDirectlyAbove,Vertex.prototype.getAbove=vertexGetAbove,Vertex.prototype.removeAbove=lowerThanRemoveAbove,Vertex.prototype.removeBelow=lowerThanRemoveBelow,Vertex.prototype.isBottom=vertexIsBottom,Vertex.prototype.isRoot=vertexIsRoot,Vertex.prototype.isIsolated=vertexIsIsolated,Vertex.prototype.isLeaf=vertexIsLeaf,ZRelationGraph.prototype.registerCallback=zRelationGraphRegisterCallback,ZRelationGraph.prototype.unregisterCallback=zRelationGraphUnregisterCallback,ZRelationGraph.prototype.callback=zRelationGraphCallback,ZRelationGraph.prototype.findDirectedPath=ZRelationGraphFindDirectedPath,ZRelationGraph.prototype.collectAllRelations=zRelationGraphCollectAllRelations,ZRelationGraph.prototype.resolveCycle=zRelationGraphResolveCycle,ZRelationGraph.prototype.getActiveRel=zRelationGraphGetActiveRel,ZRelationGraph.prototype.addRel=zRelationGraphAddRel,ZRelationGraph.prototype.potentialCycle=zRelationGraphPotentialCycle,ZRelationGraph.prototype.getEdgeRelationSet=zRelationGraphGetEdgeRelationSet,ZRelationGraph.prototype.removeVertex=zRelationGraphRemoveVertex,ZRelationGraph.prototype.addSuspended=zRelationGraphAddSuspended,ZRelationGraph.prototype.removeSuspended=zRelationGraphRemoveSuspended,ZRelationGraph.prototype.checkVertex=zRelationGraphCheckVertex,ZRelationGraph.prototype.activate=zRelationGraphActivate,ZRelationGraph.prototype.replaceRel=zRelationGraphReplaceRel,ZRelationGraph.prototype.isEdgeActive=zRelationGraphIsEdgeActive,ZRelationGraph.prototype.deactivateRel=zRelationGraphDeactivateRel,ZRelationGraph.prototype.removeEdge=zRelationGraphRemoveEdge,ZRelationGraph.prototype.suspendRel=ZRelationGraphSuspendRel,ZRelationGraph.prototype.retestSuspended=zRelationGraphRetestSuspended,ZRelationGraph.prototype.blockingCycleStillActive=ZRelationGraphBlockingCycleStillActive,ZRelationGraph.prototype.removeRel=zRelationGraphRemoveRel,ZRelationGraph.prototype.updateViolatingLevels=ZRelationGraphUpdateViolatingLevels,ZRelationGraph.prototype.propagateChanges=zRelationGraphPropagateChanges,ZRelationGraph.prototype.propagateChange=zRelationGraphPropagateChange,ZRelationGraph.prototype.getMinimalZValue=zRelationGraphGetMinimalZValue,ZRelationGraph.prototype.allLowerVerticesIn=zRelationGraphAllLowerVerticesIn,ZRelationGraph.prototype.getHTMLZValue=zRelationGraphGetHTMLZValue,ZRelationGraph.prototype.getZValue=zRelationGraphGetZValue,ZRelationGraph.prototype.setZValue=zRelationGraphSetZValue,ZRelationGraph.prototype.getEdge=zRelationGraphGetEdge,ZRelationGraph.prototype.hasPath=zRelationGraphHasPath,ZRelationGraph.prototype.checkConsistency=zRelationGraphCheckConsistency,ZRelationGraph.prototype.dump=zRelationGraphDump,ZRelationGraph.prototype.findCompleteBipartiteSubGraphs=zRelationGraphFindCompleteBipartiteSubGraphs,ZRelationGraph.prototype.expandKnm=zRelationGraphExpandKnm,ZRelationGraph.prototype.allContainedIn=zRelationGraphAllContainedIn,ZRelationGraph.prototype.pathFrom=zRelationGraphPathFrom,ZRelationGraph.prototype.isKnm=zRelationGraphIsKnm,
ZRelationGraph.prototype.minimizeZValues=zRelationGraphMinimizeZValues;var ZIndexStatus=Object.freeze({none:"none",copy:"copy",independent:"independent",mark:"mark"});ZArea.prototype.destroy=zAreaDestroy,ZArea.areaMap={},ZArea.get=zAreaGet,ZArea.release=zAreaRelease,ZArea.prototype.clear=zAreaClear,ZArea.prototype.dump=zAreaDump,ZArea.prototype.isEmbeddedIn=zAreaIsEmbeddedIn,ZArea.prototype.addChild=zAreaAddChild,ZArea.prototype.removeChild=zAreaRemoveChild,ZArea.prototype.getEmbeddingDepth=zAreaGetEmbeddingDepth,ZArea.prototype.getFrameDiv=zAreaGetFrameDiv,ZArea.prototype.getZ=zAreaGetZ,ZArea.prototype.setSetRepresentative=ZAreaSetSetRepresentative,ZArea.prototype.removeSetRepresentative=ZAreaRemoveSetRepresentative,ZArea.prototype.collectIndependentDescendants=zAreaCollectIndependentDescendants,ZArea.prototype.findChildName=zAreaFindChildName,ZArea.prototype.hasIndependentDescendants=zAreaHasIndependentDescendants,ZArea.prototype.hasAncestorPath=zAreaHasAncestorPath,ZArea.prototype.getAncestorPath=zAreaGetAncestorPath,ZArea.prototype.clearZIndex=zAreaClearZIndex,ZArea.prototype.markPath=zAreaMarkPath,ZArea.prototype.embeddedIn=zAreaEmbeddedIn,ZArea.prototype.setTopRelation=zAreaSetTopRelation,ZArea.prototype.addRelation=zAreaAddRelation,ZArea.prototype.removeTopRelation=zAreaRemoveTopRelation,ZArea.prototype.removeRelation=zAreaRemoveRelation,ZArea.prototype.propagateUp=zAreaPropagateUp,ZArea.prototype.stopPropagateUp=zAreaStopPropagateUp,ZArea.prototype.setLowestIndependentAncestor=zAreaSetLowestIndependentAncestor,ZArea.prototype.updateLowestIndependentAncestor=zAreaUpdateLowestIndependentAncestor,ZArea.prototype.copyZIndexToDescendants=zAreaCopyZIndexToDescendants,ZArea.prototype.configurationUpdate=zAreaConfigurationUpdate,ZArea.prototype.updateConstraint=ZAreaUpdateConstraint,ZArea.prototype.newDescription=zAreaNewDescription,ZArea.prototype.addConstraint=zAreaAddConstraint,ZArea.prototype.removeConstraint=zAreaRemoveConstraint,ZArea.prototype.findLce=zAreaFindLce,ZArea.prototype.findIndependentAncestor=zAreaFindIndependentAncestor,ZArea.compare=zAreaCompare,ZArea.divFollows=zAreaDivFollows;var ZConstraintType=Object.freeze({none:"none",areaSet:"area set",localLabelSet:"local label set",globalLabel:"global label"});ZConstraint.prototype.unregisterAll=zConstraintUnregisterAll,ZConstraint.prototype.destroy=zConstraintDestroy,ZConstraint.prototype.hasChanged=zConstraintHasChanged,ZConstraint.prototype.update=zConstraintUpdate,ZConstraintSection.prototype.parseDescr=zConstraintSectionParseDescr,ZConstraintSection.prototype.addArea=zConstraintSectionAddArea,ZConstraintSection.prototype.hasChanged=zConstraintSectionHasChanged,ZConstraintSection.prototype.removeArea=zConstraintSectionRemoveArea,ZConstraintSection.prototype.getDiff=zConstraintSectionGetDiff,ZConstraintSection.prototype.getNew=zConstraintSectionGetNew,ZConstraintSection.prototype.getOld=zConstraintSectionGetOld,ZConstraintSection.prototype.getChanges=zConstraintSectionGetChanges,ZConstraintSection.prototype.reset=zConstraintSectionReset,ZConstraintSection.prototype.releaseAreaSetReprs=zConstraintSectionReleaseAreaSetReprs;var gZIndex;ZIndex.prototype.addArea=zIndexAddArea,ZIndex.prototype.removeArea=zIndexRemoveArea,ZIndex.prototype.newEmbedding=zIndexNewEmbedding,ZIndex.prototype.getZArea=zIndexGetZArea,ZIndex.prototype.addToNewZ=zIndexAddToNewZ,ZIndex.prototype.markRelElements=zIndexMarkRelElements,ZIndex.prototype.updateZ=zIndexUpdateZ,ZIndex.prototype.findCurrentZRelation=zIndexFindCurrentZRelation,ZIndex.prototype.addDependentRelation=zIndexAddDependentRelation,ZIndex.prototype.removeDependentRelations=zIndexRemoveDependentRelations,ZIndex.prototype.createRelation=zIndexCreateRelation,ZIndex.prototype.createDependentRelation=zIndexCreateDependentRelation,ZIndex.prototype.deleteDependentRelation=zIndexDeleteDependentRelation,ZIndex.prototype.hardDeleteDependentRelation=zIndexHardDeleteDependentRelation,ZIndex.prototype.checkLceUpward=zIndexCheckLceUpward,ZIndex.prototype.assignDefaultSiblingRelations=zIndexAssignDefaultSiblingRelations,ZIndex.prototype.addAll=zIndexAddAll,ZIndex.prototype.removeAll=zIndexRemoveAll,ZIndex.prototype.retractRelations=zIndexRetractRelations,ZIndex.prototype.reassertRelations=zIndexReassertRelations,CombinationVectors.prototype.getComponentChanges=combinationVectorsGetComponentChanges,CombinationVectors.prototype.clearComponentChanges=combinationVectorsClearComponentChanges,CombinationVectors.prototype.hasComponent=combinationVectorsHasComponent,CombinationVectors.prototype.combinationComponentIndex=combinationVectorsCombinationComponentIndex,CombinationVectors.prototype.baseSetSize=combinationVectorsBaseSetSize,CombinationVectors.prototype.combinationSetSize=combinationVectorsCombinationSetSize,CombinationVectors.prototype.baseNonZeroSize=combinationVectorsBaseNonZeroSize,CombinationVectors.prototype.combinationNonZeroSize=combinationVectorsCombinationNonZeroSize,CombinationVectors.prototype.getValue=combinationVectorsGetValue,CombinationVectors.prototype.addValue=combinationVectorsAddValue,CombinationVectors.prototype.transferValue=combinationVectorsTransferValue,CombinationVectors.prototype.newVector=combinationVectorsNewVector,CombinationVectors.prototype.setVector=combinationVectorsSetVector,CombinationVectors.prototype.removeVector=combinationVectorsRemoveVector,CombinationVectors.prototype.addToVector=combinationVectorsAddToVector,CombinationVectors.prototype.newCombVector=combinationVectorsNewCombVector,CombinationVectors.prototype.removeCombVector=combinationVectorsRemoveCombVector,CombinationVectors.prototype.addBaseToCombVector=combinationVectorsAddBaseToCombVector,CombinationVectors.prototype.addCombToCombVector=combinationVectorsAddCombToCombVector,CombinationVectors.prototype.eliminate=combinationVectorsEliminate,CombinationVectors.prototype.repairCombinations=combinationVectorsRepairCombinations,CombinationVectors.prototype.calcNormalizationConstant=combinationVectorsCalcNormalizationConstant,CombinationVectors.prototype.normalize=combinationVectorsNormalize,CombinationVectors.prototype.recalculateCombination=combinationVectorsRecalculateCombination,CombinationVectors.prototype.clearNormalizationCandidates=combinationVectorsClearNormalizationCandidates;var treeIdCounter=0;TreeNode.prototype.makeIntoRoot=treeNodeMakeIntoRoot,TreeNode.prototype.isUpToDate=treeNodeIsUpToDate,TreeNode.prototype.isDepthUpToDate=treeNodeIsDepthUpToDate,TreeNode.prototype.getTreeId=treeNodeGetTreeId,TreeNode.prototype.getDepth=treeNodeGetDepth,TreeNode.prototype.getRootNode=treeNodeGetRootNode,TreeNode.prototype.isLeaf=treeNodeIsLeaf,Forest.prototype.nodeInForest=forestNodeInForest,Forest.prototype.getNode=forestGetNode,Forest.prototype.isRoot=forestIsRoot,Forest.prototype.isLeaf=forestIsLeaf,Forest.prototype.addEdge=forestAddEdge,Forest.prototype.removeEdge=forestRemoveEdge,Forest.prototype.replaceEdge=forestReplaceEdge,Forest.prototype.exchangeWithRoot=forestExchangeWithRoot,Forest.prototype.setName=forestSetName,Forest.prototype.mergeTrees=forestMergeTrees,Forest.prototype.getTreeId=forestGetTreeId,Forest.prototype.inSameTree=forestInSameTree,Forest.prototype.getPath=forestGetPath;var vectorIdCounter=1025;VectorSet.prototype.removeComponent=vectorSetRemoveComponent,VectorSet.prototype.addComponent=vectorSetAddComponent,VectorSet.prototype.getValue=vectorGetValue,VectorSet.prototype.addValue=vectorAddValue,VectorSet.prototype.setValue=vectorSetValue,VectorSet.prototype.transferValue=vectorSetTransferValue,VectorSet.prototype.multiplyVector=vectorSetMultiplyVector,VectorSet.prototype.newVector=vectorSetNewVector,VectorSet.prototype.setVector=vectorSetSetVector,VectorSet.prototype.removeVector=vectorSetRemoveVector,VectorSet.prototype.addToVector=vectorSetAddToVector,VectorSet.prototype.setToZeroInAllVectors=vectorSetSetToZeroInAllVectors,VectorSet.prototype.merge=vectorSetMerge,VectorSet.prototype.duplicate=vectorSetDuplicate,VectorSet.prototype.registerInnerProducts=vectorSetRegisterInnerProducts,VectorSet.prototype.deregisterInnerProducts=vectorSetDeregisterInnerProducts,VectorSet.prototype.clearComponentChanges=vectorSetClearComponentChanges,Edges.prototype.getEdge=edgesGetEdge,Edges.prototype.getEdgeId=edgesGetEdgeId,Edges.prototype.getEdgePoints=edgesGetEdgePoints,Edges.prototype.edgeOtherEnd=edgesEdgeOtherEnd,Edges.prototype.allLabelEdges=edgesAllLabelEdges,Edges.prototype.edgeOppositeEnd=edgesEdgeOppositeEnd,Edges.prototype.getEdgePropById=edgesGetEdgePropById,Edges.prototype.addEdge=edgesAddEdge,Edges.prototype.allocateEdge=edgesAllocateEdge,Edges.prototype.setEdgeProp=edgesSetEdgeProp,Edges.prototype.releaseEdge=edgesReleaseEdge,Edges.prototype.removeEdge=edgesRemoveEdge;var nextPointPairId=1026;Cycles.prototype.nodeInForest=cyclesNodeInForest,Cycles.prototype.getEdge=cyclesGetEdge,Cycles.prototype.getEdgePoints=cyclesGetEdgePoints,Cycles.prototype.getEdgeTreeId=cyclesGetEdgeTreeId,Cycles.prototype.edgeOtherEnd=cyclesEdgeOtherEnd,Cycles.prototype.edgeOppositeEnd=cyclesEdgeOppositeEnd,Cycles.prototype.getEdgeInfo=cyclesGetEdgeInfo,Cycles.prototype.isNormal=cyclesIsNormal,Cycles.prototype.isNormalById=cyclesIsNormalById,Cycles.prototype.isWatched=cyclesIsWatched,Cycles.prototype.isWatchedById=cyclesIsWatchedById,Cycles.prototype.inForest=cyclesInForest,Cycles.prototype.inForestById=cyclesInForestById,Cycles.prototype.edgeExists=cyclesEdgeExists,Cycles.prototype.createEdge=cyclesCreateEdge,Cycles.prototype.addEdge=cyclesAddEdge,Cycles.prototype.addNormalEdge=cyclesAddNormalEdge,Cycles.prototype.addCycleOrPath=cyclesAddCycleOrPath,Cycles.prototype.reduceWatchedCyclesByCycle=cyclesReduceWatchedCyclesByCycle,Cycles.prototype.addExternalCycle=cyclesAddExternalCycle,Cycles.prototype.addWatchedEdge=cyclesAddWatchedEdge,Cycles.prototype.removeEdge=cyclesRemoveEdge,Cycles.prototype.removeEdgeById=cyclesRemoveEdgeById,Cycles.prototype.removeNormalEdge=cyclesRemoveNormalEdge,Cycles.prototype.removeWatchedEdge=cyclesRemoveWatchedEdge,Cycles.prototype.removeEdgeFromForest=cyclesRemoveEdgeFromForest,Cycles.prototype.replaceEdgeByCycle=cyclesReplaceEdgeByCycle,Cycles.prototype.replaceEdgeByWatchedCycle=cyclesReplaceEdgeByWatchedCycle,Cycles.prototype.removeCycle=cyclesRemoveCycle,Cycles.prototype.removeWatchedCycle=cyclesRemoveWatchedCycle,Cycles.prototype.makeWatchedCycleFromCycle=cyclesMakeWatchedCycleFromCycle,Cycles.prototype.edgeInCycle=cyclesEdgeInCycle,Cycles.prototype.clearChanges=cyclesClearChanges;var variableIdCounter=1025;LinearConstraints.prototype.getPair=linearConstraintsGetPair,LinearConstraints.prototype.getPairById=linearConstraintsGetPairById,LinearConstraints.prototype.getPairPoints=linearConstraintsGetPairPoints,LinearConstraints.prototype.getPairVariable=linearConstraintsGetPairVariable,LinearConstraints.prototype.getOtherInPair=linearConstraintsGetOtherInPair,LinearConstraints.prototype.getPairVal=linearConstraintsGetPairVal,LinearConstraints.prototype.setPairIndexAndRatio=linearConstraintsSetPairIndexAndRatio,LinearConstraints.prototype.addPair=linearConstraintsAddPair,LinearConstraints.prototype.removePair=linearConstraintsRemovePair,LinearConstraints.prototype.getEdgeConstraints=linearConstraintsGetEdgeConstraints,LinearConstraints.prototype.getConstraintByPairIds=linearConstraintsGetConstraintByPairIds,LinearConstraints.prototype.getConstraint=linearConstraintsGetConstraint,LinearConstraints.prototype.addConstraintToEdge=linearConstraintsAddConstraintToEdge,LinearConstraints.prototype.removeConstraintFromEdge=linearConstraintsRemoveConstraintFromEdge,LinearConstraints.prototype.setConstraint=linearConstraintsSetConstraint,LinearConstraints.prototype.setConstraintByPairIds=linearConstraintsSetConstraintByPairIds,LinearConstraints.prototype.addHigherPriorityConstraint=linearConstraintsAddHigherPriorityConstraint,LinearConstraints.prototype.addLowerPriorityConstraint=linearConstraintsAddLowerPriorityConstraint,LinearConstraints.prototype.removeConstraintById=linearConstraintsRemoveConstraintById,LinearConstraints.prototype.removeConstraint=linearConstraintsRemoveConstraint,LinearConstraints.prototype.removeConstraintByPoints=linearConstraintsRemoveConstraintByPoints,LinearConstraints.prototype.removePairConstraints=linearConstraintsRemovePairConstraints,LinearConstraints.prototype.addActiveEdge=linearConstraintsAddActiveEdge,LinearConstraints.prototype.refreshEdge=linearConstraintsRefreshEdge,LinearConstraints.prototype.removeEdge=linearConstraintsRemoveEdge,LinearConstraints.prototype.updateVariableAndRatio=linearConstraintsUpdateVariableAndRatio,LinearConstraints.prototype.checkConflict=linearConstraintsCheckConflict,LinearConstraints.prototype.conflictResolvingSet=linearConstraintsConflictResolvingSet,LinearConstraints.prototype.reactivateNonconflictingSuspended=linearConstraintsReactivateNonconflictingSuspended,LinearConstraints.prototype.reactivateSuspendedEdge=linearConstraintsReactivateSuspendedEdge,LinearConstraints.prototype.suspendOrRemoveConstraint=linearConstraintsSuspendOrRemoveConstraint,LinearConstraints.prototype.suspendNewEdge=linearConstraintsSuspendNewEdge,LinearConstraints.prototype.suspendEdgesById=linearConstraintsSuspendEdgesById,LinearConstraints.prototype.replaceBySuspendedConstraint=linearConstraintsReplaceBySuspendedConstraint,LinearConstraints.prototype.addEdgeToSuspended=linearConstraintsAddEdgeToSuspended,LinearConstraints.prototype.removeEdgeFromSuspended=linearConstraintsRemoveEdgeFromSuspended,LinearConstraints.prototype.clearChanges=linearConstraintsClearChanges,LinearConstraints.prototype.addToByVariable=linearConstraintsAddToByVariable,LinearConstraints.prototype.removeFromByVariable=linearConstraintsRemoveFromByVariable,LinearConstraints.prototype.changeIndexByPairInByVariable=linearConstraintsChangeIndexByPairInByVariable,LinearConstraints.prototype.allocateEdgeToConstraintId=linearConstraintsAllocateEdgeToConstraintId,LinearConstraints.prototype.removeEdgeAllocationToConstraintId=linearConstraintsRemoveEdgeAllocationToConstraintId,LinearConstraints.prototype.createClone=linearConstraintsCreateClone,LinearConstraints.prototype.destroyIfClone=linearConstraintsDestroyIfClone,LinearConstraints.prototype.clearCloneChanges=linearConstraintsClearCloneChanges,LinearConstraints.prototype.getMainVariable=linearConstraintsGetMainVariable,LinearConstraints.prototype.variableExists=linearConstraintsVariableExists,LinearConstraints.prototype.hasConstraint=linearConstraintsHasConstraint,LinearConstraints.prototype.hasActiveConstraint=linearConstraintsHasActiveConstraint,LinearConstraints.prototype.getPointsById=linearConstraintsGetPointsById,LinearConstraints.prototype.debugGetVarStr=linearConstraintsDebugGetVarStr,SegmentConstraints.prototype.getPair=segmentConstraintsGetPair,SegmentConstraints.prototype.getIndexEntry=segmentConstraintsGetIndexEntry,SegmentConstraints.prototype.clearIndexEntry=segmentConstraintsClearIndexEntry,SegmentConstraints.prototype.setConstraint=segmentConstraintsSetConstraint,SegmentConstraints.prototype.updateVariableSegmentConstraints=segmentConstraintsUpdateVariableSegmentConstraints,SegmentConstraints.prototype.assignConstraintToVariable=segmentConstraintsAssignConstraintToVariable,SegmentConstraints.prototype.replaceConstraintOnVariable=segmentConstraintsReplaceConstraintOnVariable,SegmentConstraints.prototype.addConstraintToVariable=segmentConstraintsAddConstraintToVariable,SegmentConstraints.prototype.updateVariableStability=segmentConstraintsUpdateVariableStability,SegmentConstraints.prototype.recalcStabilityPriority=segmentConstraintsRecalcStabilityPriority,SegmentConstraints.prototype.removeStability=segmentConstraintsRemoveStability,SegmentConstraints.prototype.removeConstraint=segmentConstraintsRemoveConstraint,SegmentConstraints.prototype.removeConstraintByPairId=segmentConstraintsRemoveConstraintByPairId,SegmentConstraints.prototype.removePair=segmentConstraintsRemovePair,SegmentConstraints.prototype.addChange=segmentConstraintsAddChange,SegmentConstraints.prototype.clearChanges=segmentConstraintsClearChanges,SegmentConstraints.prototype.updateConstraintPriority=segmentConstraintsUpdateConstraintPriority,SegmentConstraints.prototype.addConstraintNonOrGroupPriority=segmentConstraintsAddConstraintNonOrGroupPriority,SegmentConstraints.prototype.removeConstraintNonOrGroupPriority=segmentConstraintsRemoveConstraintNonOrGroupPriority,SegmentConstraints.prototype.hasConstraint=segmentConstraintsHasConstraint,SegmentConstraints.prototype.variableHasConstraint=segmentConstraintsVariableHasConstraint,SegmentConstraints.prototype.pairHasConstraint=segmentConstraintsPairHasConstraint,SegmentConstraints.prototype.variableHasOrGroups=segmentConstraintsVariableHasOrGroups,SegmentConstraints.prototype.setVariableHasOrGroups=segmentConstraintsSetVariableHasOrGroups,SegmentConstraints.prototype.getVariableOrGroups=segmentConstraintsGetVariableOrGroups,SegmentConstraints.prototype.processLinearConstraintChanges=segmentConstraintsProcessLinearConstraintChanges,SegmentConstraints.prototype.updateNewIndexOrRatio=segmentConstraintsUpdateNewIndexOrRatio,SegmentConstraints.prototype.getMax=segmentConstraintsGetMax,SegmentConstraints.prototype.getMin=segmentConstraintsGetMin,SegmentConstraints.prototype.priorityForValue=segmentConstraintsPriorityForValue,SegmentConstraints.prototype.nextValue=segmentConstraintsNextValue,SegmentConstraints.prototype.getOrGroupMinOrMaxSatisfaction=segmentConstraintsGetOrGroupMinOrMaxSatisfaction,SegmentConstraints.prototype.getOrGroupSatisfaction=segmentConstraintsGetOrGroupSatisfaction,SegmentConstraints.prototype.allowsMovement=segmentConstraintsAllowsMovement,SegmentConstraints.prototype.getStability=segmentConstraintsGetStability,SegmentConstraints.prototype.getPreferredValue=segmentConstraintsGetPreferredValue,SegmentConstraints.prototype.updateOrGroups=segmentConstraintsUpdateOrGroups,SegmentConstraints.prototype.destroyOrGroups=segmentConstraintsDestroyOrGroups,SegmentConstraints.prototype.addToOrGroup=segmentConstraintsAddToOrGroup,SegmentConstraints.prototype.removeFromOrGroup=segmentConstraintsRemoveFromOrGroup,SegmentConstraints.prototype.refreshOrGroupPriority=segmentConstraintsRefreshOrGroupPriority,SegmentConstraints.prototype.refreshOrGroupsOnVariable=segmentConstraintsRefreshOrGroupsOnVariable,SegmentConstraints.prototype.variableHasOrGroup=segmentConstraintsVariableHasOrGroup,SegmentConstraints.prototype.hasAnyOrGroups=segmentConstraintsHasAnyOrGroups,SegmentConstraints.prototype.refreshHasOrGroups=segmentConstraintsRefreshHasOrGroups,SegmentConstraints.prototype.variableHasOrGroups=segmentConstraintsVariableHasOrGroups,SegmentConstraints.prototype.getOrGroupPriority=segmentConstraintsGetOrGroupPriority,SegmentConstraints.prototype.addOrGroupRemove=segmentConstraintsAddOrGroupRemove,SegmentConstraints.prototype.delOrGroupRemove=segmentConstraintsDelOrGroupRemove,SegmentConstraints.prototype.clearOrGroupChanges=segmentConstraintsClearOrGroupChanges,SegmentConstraints.prototype.orGroupHandler=segmentConstraintsOrGroupHandler,OrGroupHandler.prototype.call=orGroupHandlerCall,OrGroups.prototype.getGroupStatus=orGroupsGetGroupStatus,OrGroups.prototype.getOrGroupSatisfaction=orGroupsGetOrGroupSatisfaction,OrGroups.prototype.isOrGroupSatisfiedOnVariable=orGroupsIsOrGroupSatisfiedOnVariable,OrGroups.prototype.orGroupSatisfiedOnVariableOnly=orGroupsOrGroupSatisfiedOnVariableOnly,OrGroups.prototype.isOrGroupSatisfiedOnOtherVariable=orGroupsIsOrGroupSatisfiedOnOtherVariable,OrGroups.prototype.getFirstSatisfiedVariable=orGroupsGetFirstSatisfiedVariable,OrGroups.prototype.getSatisfiedVariables=orGroupsGetSatisfiedVariables,OrGroups.prototype.updateVariableSatisfaction=orGroupsUpdateVariableSatisfaction,OrGroups.prototype.removeVariableFromGroup=orGroupsRemoveVariableFromGroup,OrGroups.prototype.refreshModifiedGroups=orGroupsRefreshModifiedGroups,OrGroups.prototype.addVariableChange=orGroupsAddVariableChange,OrGroups.prototype.addStatusChange=orGroupsAddStatusChange,OrGroups.prototype.addPriorityChange=orGroupsAddPriorityChange,OrGroups.prototype.clearChanges=orGroupsClearChanges,VecInnerProducts.prototype.addToProducts=vecInnerProductsAddToProducts,VecInnerProducts.prototype.addDualToProducts=vecInnerProductsAddDualToProducts,VecInnerProducts.prototype.calcInnerProducts=vecInnerProductsCalcInnerProducts,VecInnerProducts.prototype.calcDualInnerProducts=vecInnerProductsCalcDualInnerProducts,VecInnerProducts.prototype.addVectors=vecInnerProductsAddVectors,VecInnerProducts.prototype.removeVector=vecInnerProductsRemoveVector,VecInnerProducts.prototype.setToZero=vecInnerProductsSetToZero,VecInnerProducts.prototype.multiplyVector=vecInnerProductsMultiplyVector,Resistance.prototype.refreshEntry=resistanceRefreshEntry,Resistance.prototype.calcResistance=resistanceCalcResistance,Resistance.prototype.addToResistance=resistanceAddToResistance,Resistance.prototype.calcMinOrMaxResistance=resistanceCalcMinOrMaxResistance,Resistance.prototype.calcStabilityResistance=resistanceCalcStabilityResistance,Resistance.prototype.addOrGroupViolationResistance=resistanceAddOrGroupViolationResistance,Resistance.prototype.addAllOrGroupViolationResistance=resistanceAddAllOrGroupViolationResistance,Resistance.prototype.recalcViolatedOrGroupResistance=resistanceRecalcViolatedOrGroupResistance,Resistance.prototype.addSatisfiedOrGroupResistance=resistanceAddSatisfiedOrGroupResistance,Resistance.prototype.calcMultiVariableSatisfiedOrGroupResistance=resistanceCalcMultiVariableSatisfiedOrGroupResistance,Resistance.prototype.refreshAfterBoundVarRemoved=resistanceRefreshAfterBoundVarRemoved,Resistance.prototype.refreshAfterBoundVarAdded=resistanceRefreshAfterBoundVarAdded,Resistance.prototype.refreshAfterEquationChange=resistanceRefreshAfterEquationChange,Resistance.prototype.refreshAfterBoundVarChange=resistanceRefreshAfterBoundVarChange,Resistance.prototype.calcPendingResistance=resistanceCalcPendingResistance,Resistance.prototype.calcAllPending=resistanceCalcAllPending,Resistance.prototype.setStableValue=resistanceSetStableValue,Resistance.prototype.getStableValue=resistanceGetStableValue,Resistance.prototype.remove=resistanceRemove,Resistance.prototype.getMaxResistance=resistanceGetMaxResistance,Resistance.prototype.getMinResistance=resistanceGetMinResistance,Resistance.prototype.getUpResistance=resistanceGetUpResistance,Resistance.prototype.getDownResistance=resistanceGetDownResistance,Resistance.prototype.getResistance=resistanceGetResistance,Resistance.prototype.getSatOrGroupResistance=resistanceGetSatOrGroupResistance,Resistance.prototype.getResistanceWithSatOrGroups=resistanceGetResistanceWithSatOrGroups,Resistance.prototype.violationIsOrGroup=resistanceViolationIsOrGroup,Resistance.prototype.violatedBoundResistsFree=resistanceViolatedBoundResistsFree,Resistance.prototype.hasViolation=resistanceHasViolation,Resistance.prototype.getViolationPriority=resistanceGetViolationPriority,Resistance.prototype.clearResistanceChanges=resistanceClearResistanceChanges,Resistance.prototype.getTotalResistance=resistanceGetTotalResistance,Resistance.prototype.removeTotalResistanceVariable=resistanceRemoveTotalResistanceVariable,Resistance.prototype.removeAllTotalResistanceVariablesExcept=resistanceRemoveAllTotalResistanceVariablesExcept,Resistance.prototype.clearFreeFromBound=resistanceClearFreeFromBound,Resistance.prototype.addFreeToBound=resistanceAddFreeToBound,Resistance.prototype.addToTotalResistance=resistanceAddToTotalResistance,Resistance.prototype.setTotalResistingVarAndGroup=resistanceSetTotalResistingVarAndGroup,Resistance.prototype.addOwnResistanceToTotal=resistanceAddOwnResistanceToTotal,Resistance.prototype.increaseTotalResistanceByBound=resistanceIncreaseTotalResistanceByBound,Resistance.prototype.calcTotalResistance=resistanceCalcTotalResistance,Resistance.prototype.addOrGroupTotalResistance=resistanceAddOrGroupTotalResistance,Resistance.prototype.addSatisfiedOrGroupTotalResistance=resistanceAddSatisfiedOrGroupTotalResistance,Resistance.prototype.addViolatedOrGroupTotalResistance=resistanceAddViolatedOrGroupTotalResistance,Resistance.prototype.addSingleViolatedOrGroupTotalResistance=resistanceAddSingleViolatedOrGroupTotalResistance,Resistance.prototype.calcTotalOfAllPending=resistanceCalcTotalOfAllPending,Resistance.prototype.removeBoundVarTotalResistance=resistanceRemoveBoundVarTotalResistance,Resistance.prototype.refreshTotalAfterBoundVarChange=resistanceRefreshTotalAfterBoundVarChange,Resistance.prototype.refreshTotalAfterEquationChange=resistanceRefreshTotalAfterEquationChange,Resistance.prototype.refreshTotalAfterBoundResistanceChange=resistanceRefreshTotalAfterBoundResistanceChange,Resistance.prototype.refreshTotalAfterResistanceChange=resistanceRefreshTotalAfterResistanceChange,Resistance.prototype.processOrGroupChanges=resistanceProcessOrGroupChanges,Resistance.prototype.applyOrGroupStatusChange=resistanceApplyOrGroupStatusChange,Resistance.prototype.orGroupResistanceAfterBoundVarChange=resistanceOrGroupResistanceAfterBoundVarChange,Resistance.prototype.orGroupResistanceAfterEquationChange=resistanceOrGroupResistanceAfterEquationChange,Resistance.prototype.orGroupResistanceAddBoundVar=resistanceOrGroupResistanceAddBoundVar,Resistance.prototype.orGroupResistanceRemoveBoundVar=resistanceOrGroupResistanceRemoveBoundVar,Resistance.prototype.addToRequireOrGroupResistance=resistanceAddToRequireOrGroupResistance,Resistance.prototype.removeFromRequireOrGroupResistance=resistanceRemoveFromRequireOrGroupResistance,Resistance.prototype.removeModuleFromFreeRequireOrGroup=resistanceRemoveModuleFromFreeRequireOrGroup,Resistance.prototype.calcAllOrGroupsForFreeVar=resistanceCalcAllOrGroupsForFreeVar,Resistance.prototype.satisfiedOrGroupResistanceAfterBoundVarChange=resistanceSatisfiedOrGroupResistanceAfterBoundVarChange,Resistance.prototype.satisfiedOrGroupResistanceAfterEquationChange=resistanceSatisfiedOrGroupResistanceAfterEquationChange,Resistance.prototype.satisfiedOrGroupResistanceAddBoundVar=resistanceSatisfiedOrGroupResistanceAddBoundVar,Resistance.prototype.satisfiedOrGroupResistanceRemoveBoundVar=resistanceSatisfiedOrGroupResistanceRemoveBoundVar,Resistance.prototype.addSatOrGroupToVarRes=resistanceAddSatOrGroupToVarRes,Resistance.prototype.removeSatOrGroupFromVarRes=resistanceRemoveSatOrGroupFromVarRes,Resistance.prototype.refreshAfterSatisfiedOrGroupPriorityChange=resistanceRefreshAfterSatisfiedOrGroupPriorityChange,Resistance.prototype.calcPendingTightOrGroups=resistanceCalcPendingTightOrGroups,Resistance.prototype.removeSatisfiedOrGroupResistance=resistanceRemoveSatisfiedOrGroupResistance,Resistance.prototype.calcSatisfiedResistanceOfOrGroup=resistanceCalcSatisfiedResistanceOfOrGroup,Resistance.prototype.satisfiedOrGroupMayBeTight=resistanceSatisfiedOrGroupMayBeTight,Resistance.prototype.setTightOrGroupOnVariable=resistanceSetTightOrGroupOnVariable,Resistance.prototype.removeTightOrGroupFromVariable=resistanceRemoveTightOrGroupFromVariable,Resistance.prototype.satisfiedOrGroupsRemoveFree=resistanceSatisfiedOrGroupsRemoveFree;Resistance.prototype.getTightOrGroupOnFreeVar=resistanceGetTightOrGroupOnFreeVar;Resistance.prototype.checkAndSetTightOrGroupOnFreeVar=resistanceCheckAndSetTightOrGroupOnFreeVar,Resistance.prototype.checkTightOrGroupOnFreeVar=resistanceCheckTightOrGroupOnFreeVar,Resistance.prototype.satisfiedOrGroupsOfViolatedBoundResistFree=resistanceSatisfiedOrGroupsOfViolatedBoundResistFree,Resistance.prototype.processSatisfiedOrGroupChanges=resistanceProcessSatisfiedOrGroupChanges,Resistance.prototype.recalcAfterSatisfiedOrGroupChanges=resistancerecalcAfterSatisfiedOrGroupChanges,Resistance.prototype.getResistingEqsOfSatOrGroupsForVar=resistanceGetResistingEqsOfSatOrGroupsForVar,Resistance.prototype.violatedOrGroupResistanceAfterBoundVarChange=resistanceViolatedOrGroupResistanceAfterBoundVarChange,Resistance.prototype.violatedOrGroupResistanceAfterEquationChange=resistanceViolatedOrGroupResistanceAfterEquationChange,Resistance.prototype.violatedOrGroupResistanceAddBoundVar=resistanceViolatedOrGroupResistanceAddBoundVar,Resistance.prototype.violatedOrGroupResistanceRemoveBoundVar=resistanceViolatedOrGroupResistanceRemoveBoundVar,Resistance.prototype.removeViolatedOrGroupResistance=resistanceRemoveViolatedOrGroupResistance,Resistance.prototype.removeViolatedOrGroupResistanceFromVariable=resistanceRemoveViolatedOrGroupResistanceFromVariable,Resistance.prototype.removeBoundViolatedOrGroupVarFromFree=resistanceRemoveBoundViolatedOrGroupVarFromFree,Resistance.prototype.removeBoundViolatedOrGroupVarFromFreeVar=resistanceRemoveBoundViolatedOrGroupVarFromFreeVar,Resistance.prototype.violatedOrGroupsRemoveNonGroupFree=resistanceViolatedOrGroupsRemoveNonGroupFree,Resistance.prototype.addViolatedOrGroupResisance=resistanceAddViolatedOrGroupResisance,Resistance.prototype.addViolatedOrGroupResistanceToVariable=resistanceAddViolatedOrGroupResistanceToVariable,Resistance.prototype.addBoundViolatedOrGroupVarToFree=resistanceAddBoundViolatedOrGroupVarToFree,Resistance.prototype.addVariableAndGroupToViolatedOrGroupVars=resistanceAddVariableAndGroupToViolatedOrGroupVars,Resistance.prototype.getViolatedOrGroupVarsGroupEntry=resistanceGetViolatedOrGroupVarsGroupEntry,Resistance.prototype.resetViolatedOrGroupVarsGroupEntry=resistanceResetViolatedOrGroupVarsGroupEntry,Resistance.prototype.violatedOrGroupsOfBoundResistFree=resistanceViolatedOrGroupsOfBoundResistFree,Resistance.prototype.queueRecalcForViolatedOrGroups=resistanceQueueRecalcForViolatedOrGroups,Resistance.prototype.queueRecalcTotalForViolatedOrGroups=resistanceQueueRecalcTotalForViolatedOrGroups,Resistance.prototype.calcPendingResistanceFromViolatedOrGroups=resistanceCalcPendingResistanceFromViolatedOrGroups,Resistance.prototype.calcPendingTotalResistanceFromViolatedOrGroups=resistanceCalcPendingTotalResistanceFromViolatedOrGroups,Resistance.prototype.processViolatedOrGroupChanges=resistanceProcessViolatedOrGroupChanges;var posEquationsMaxReductionStepNum=5e3,posEquationsMaxOptimizationSteps=5e3,posEquationsMaxRepeatExchanges=10;inherit(PosEquations,DebugTracing),PosEquations.prototype.hasVariable=posEquationsHasVariable,PosEquations.prototype.transferValue=posEquationsTransferValue,PosEquations.prototype.addEquation=posEquationsAddEquation,PosEquations.prototype.setEquation=posEquationsSetEquation,PosEquations.prototype.removeEquation=posEquationsRemoveEquation,PosEquations.prototype.removeOneCombinationVector=posEquationsRemoveOneCombinationVector,PosEquations.prototype.recordModifiedBaseEq=posEquationsRecordModifiedBaseEq,PosEquations.prototype.prepareAndSolve=posEquationsPrepareAndSolve,PosEquations.prototype.removeFromSolution=posEquationsRemoveFromSolution,PosEquations.prototype.setSolution=posEquationsSetSolution,PosEquations.prototype.addToSolution=posEquationsAddToSolution,PosEquations.prototype.prepareToSolve=posEquationsPrepareToSolve,PosEquations.prototype.initializeValues=posEquationsInitializeValues,PosEquations.prototype.removeVariable=posEquationsRemoveVariable,PosEquations.prototype.refreshSingleVariable=posEquationsRefreshSingleVariable,PosEquations.prototype.initializeChangedVariableResistance=posEquationsInitializeChangedVariableResistance,PosEquations.prototype.completeResistanceInitialization=posEquationsCompleteResistanceInitialization,PosEquations.prototype.normalizeEquations=posEquationsNormalizeEquations,PosEquations.prototype.assignMissingBoundVariables=posEquationsAssignMissingBoundVariables,PosEquations.prototype.findBoundVarCandidate=posEquationsFindBoundVarCandidate,PosEquations.prototype.reduceErrorByNoResistanceBoundVars=posEquationsReduceErrorByNoResistanceBoundVars,PosEquations.prototype.initializeErrorDerivatives=posEquationsInitializeErrorDerivatives,PosEquations.prototype.initializeVariablesByResistance=posEquationsInitializeVariablesByResistance,PosEquations.prototype.eliminate=posEquationsEliminate,PosEquations.prototype.findFeasibleSolution=posEquationsFindFeasibleSolution,
PosEquations.prototype.findOptimalSolution=posEquationsFindOptimalSolution,PosEquations.prototype.calcOptimizationDirection=posEquationsCalcOptimizationDirection,PosEquations.prototype.checkOptimizationResistance=posEquationsCheckOptimizationResistance,PosEquations.prototype.calcOptimizationErrorDerivatives=posEquationsCalcOptimizationErrorDerivatives,PosEquations.prototype.isBlocked=posEquationsIsBlocked,PosEquations.prototype.suspendOptimization=posEquationsSuspendOptimization,PosEquations.prototype.suspendOptimizationByBlocked=posEquationsSuspendOptimizationByBlocked,PosEquations.prototype.addBlockedVariable=posEquationsAddBlockedVariable,PosEquations.prototype.removeOptimizationSuspension=posEquationsRemoveOptimizationSuspension,PosEquations.prototype.removeBlockingEquation=posEquationsRemoveBlockingEquation,PosEquations.prototype.removeSelfBlockedFromEquation=posEquationsRemoveSelfBlockedFromEquation,PosEquations.prototype.removeBlockedVariable=posEquationsRemoveBlockedVariable,PosEquations.prototype.setBlockedVarEntry=posEquationsSetBlockedVarEntry,PosEquations.prototype.refreshBlockedEqAfterBlockedRemoval=posEquationRefreshBlockedEqAfterBlockedRemoval,PosEquations.prototype.decreaseVariableBlockingPriority=posEquationsDecreaseVariableBlockingPriority,PosEquations.prototype.getSelfBlockedEntry=posEquationsGetSelfBlockedEntry,PosEquations.prototype.makeBlockedIntoSelfBlocked=posEquationsMakeBlockedIntoSelfBlocked,PosEquations.prototype.changeSelfBlockingPriority=posEquationsChangeSelfBlockingPriority,PosEquations.prototype.findFirstEquationWhereBlocked=posEquationsFindFirstEquationWhereBlocked,PosEquations.prototype.splitByFirstEquationWhereBlocked=posEquationsSplitByFirstEquationWhereBlocked,PosEquations.prototype.optimizationBlockingAfterResistanceChange=posEquationsOptimizationBlockingAfterResistanceChange,PosEquations.prototype.optimizationBlockingAfterViolationChange=posEquationsOptimizationBlockingAfterViolationChange,PosEquations.prototype.updateOptimizationSuspensionOfChangedEquations=posEquationsUpdateOptimizationSuspensionOfChangedEquations,PosEquations.prototype.optimizationBlockingAfterEquationChange=posEquationsOptimizationBlockingAfterEquationChange,PosEquations.prototype.optimizationBlockingAfterViolatedOrGroupChange=posEquationsOptimizationBlockingAfterViolatedOrGroupChange,PosEquations.prototype.stillBlocksOptimization=posEquationsStillBlocksOptimization,PosEquations.prototype.reduceResistance=posEquationsReduceResistance,PosEquations.prototype.continueResistanceReduction=posEquationsContinueResistanceReduction,PosEquations.prototype.reduceResistanceWithSatisfiedOrGroupVariable=posEquationsReduceResistanceWithSatisfiedOrGroupVariable,PosEquations.prototype.getResistingVar=posEquationsGetResistingVar,PosEquations.prototype.exchangeFreeAndBound=posEquationsExchangeFreeAndBound,PosEquations.prototype.reduceError=posEquationsReduceError,PosEquations.prototype.inducedMaxMove=posEquationsInducedMaxMove,PosEquations.prototype.applyMove=posEquationsApplyMove,PosEquations.prototype.moveAllowedByVar=posEquationsMoveAllowedByVar,PosEquations.prototype.addEquationToErrorDerivatives=posEquationsAddEquationToErrorDerivatives,PosEquations.prototype.calcAllPendingResistance=posEquationsCalcAllPendingResistance,PosEquations.prototype.updateOrGroupSatisfaction=posEquationsUpdateOrGroupSatisfaction,PosEquations.prototype.updateViolationsAfterResistanceChanges=posEquationsUpdateViolationsAfterResistanceChanges,PosEquations.prototype.calcErrorReducingResistanceAndTotal=posEquationsCalcErrorReducingResistanceAndTotal,PosEquations.prototype.updateErrorReducingResistanceAndTotal=posEquationsUpdateErrorReducingResistanceAndTotal,PosEquations.prototype.calcErrorReducingResistance=posEquationsCalcErrorReducingResistance,PosEquations.prototype.refreshTotalForVariablesByResistance=posEquationsRefreshTotalForVariablesByResistance,PosEquations.prototype.recalcAllErrorReducingResistance=posEquationsRecalcAllErrorReducingResistance,PosEquations.prototype.removeErrorReducingResistance=posEquationsRemoveErrorReducingResistance,PosEquations.prototype.refreshResistanceAfterExchange=posEquationsRefreshResistanceAfterExchange,PosEquations.prototype.updateErrorReducingResistanceAfterExchange=posEquationsUpdateErrorReducingResistanceAfterExchange,PosEquations.prototype.refreshResistanceAfterMove=posEquationsRefreshResistanceAfterMove,PosEquations.prototype.setResistanceForNextRound=posEquationsSetResistanceForNextRound,PosEquations.prototype.addToSatOrGroupVariables=posEquationsAddToSatOrGroupVariables,PosEquations.prototype.deleteFromSatOrGroupVariables=posEquationsDeleteFromSatOrGroupVariables,PosEquations.prototype.removeFromSatOrGroupVariables=posEquationsRemoveFromSatOrGroupVariables,PosEquations.prototype.clearSatOrGroupVariables=posEquationsClearSatOrGroupVariables,PosEquations.prototype.refreshViolation=posEquationsRefreshViolation,PosEquations.prototype.removeFromViolationList=posEquationsRemoveFromViolationList,PosEquations.prototype.clearAllInputChanges=posEquationsClearAllInputChanges,PosEquations.prototype.clearSolutionChanges=posEquationsClearSolutionChanges;var posCalcDefaultZeroRounding=1e-6;inherit(PosCalc,DebugTracing),PosCalc.prototype.getPair=posCalcGetPair,PosCalc.prototype.getVarPairById=posCalcGetVarPairById,PosCalc.prototype.getPairPoints=posCalcGetPairPoints,PosCalc.prototype.getOtherInPair=posCalcGetOtherInPair,PosCalc.prototype.addWatchedPair=posCalcAddWatchedPair,PosCalc.prototype.removeWatchedPair=posCalcRemoveWatchedPair,PosCalc.prototype.addLinear=posCalcAddLinear,PosCalc.prototype.removeLinearById=posCalcRemoveLinearById,PosCalc.prototype.addSegment=posCalcAddSegment,PosCalc.prototype.removeSegment=posCalcRemoveSegment,PosCalc.prototype.internalAddPair=posCalcInternalAddPair,PosCalc.prototype.internalRemoveWatchedPair=posCalcInternalRemoveWatchedPair,PosCalc.prototype.suspendOrRemoveUnusedPair=posCalcSuspendOrRemoveUnusedPair,PosCalc.prototype.getChangedPairs=posCalcGetChangedPairs,PosCalc.prototype.internalAddLinear=posCalcInternalAddLinear,PosCalc.prototype.internalRemoveLinearById=posCalcInternalRemoveLinearById,PosCalc.prototype.internalAddSegment=posCalcInternalAddSegment,PosCalc.prototype.internalRemoveSegment=posCalcInternalRemoveSegment,PosCalc.prototype.updateQueuedPairsAndConstraints=posCalcUpdateQueuedPairsAndConstraints,PosCalc.prototype.constraintQueueIsEmpty=posCalcConstraintQueueIsEmpty,PosCalc.prototype.needToRecalcConstraintSolution=posCalcNeedToRecalcConstraintSolution,PosCalc.prototype.watchedEquationsChanged=posCalcWatchedEquationsChanged,PosCalc.prototype.needToRecalcPositioning=posCalcNeedToRecalcPositioning,PosCalc.prototype.refreshEquations=posCalcRefreshEquations,PosCalc.prototype.refreshChangedVarPairs=posCalcRefreshChangedVarPairs,PosCalc.prototype.refreshChangedPairEquations=posCalcRefreshChangedPairEquations,PosCalc.prototype.refreshChangedEquations=posCalcRefreshChangedEquations,PosCalc.prototype.refreshCloneEquations=posCalcRefreshCloneEquations,PosCalc.prototype.refreshChangedCycles=posCalcRefreshChangedCycles,PosCalc.prototype.refreshChangedWatchedCycles=posCalcRefreshChangedWatchedCycles,PosCalc.prototype.solveConstraints=posCalcSolveConstraints,PosCalc.prototype.updateChangesFromEquations=posCalcUpdateChangesFromEquations,PosCalc.prototype.clearAllChanges=posCalcClearAllChanges,PosCalc.prototype.clearNewVariables=posCalcClearNewVariables,PosCalc.prototype.clearSolutionChanges=posCalcClearSolutionChanges,PosCalc.prototype.setVariable=posCalcSetVariable,PosCalc.prototype.removeVariable=posCalcRemoveVariable,PosCalc.prototype.setNewAndIndependentVariables=posCalcSetNewAndIndependentVariables,PosCalc.prototype.setToPreferredValue=posCalcSetToPreferredValue,PosCalc.prototype.getLastValue=posCalcGetLastValue,PosCalc.prototype.getCurrentValue=posCalcGetCurrentValue,PosCalc.prototype.setPairValue=posCalcSetPairValue,PosCalc.prototype.removePairValue=posCalcRemovePairValue,PosCalc.prototype.calcChangedPairs=posCalcCalcChangedPairs;var positioningDefaultZeroRounding=1e-6;Positioning.prototype.getPairOffset=Positioning_GetPairOffset,Positioning.prototype.getOffsetByPairEntry=positioningGetOffsetByPairEntry,Positioning.prototype.getChangedPairs=PositioningGetChangedPairs,Positioning.prototype.getPair=positioningGetPair,Positioning.prototype.getPairPoints=positioningGetPairPoints,Positioning.prototype.addLinear=positioningAddLinear,Positioning.prototype.removeLinearById=positioningRemoveLinearById,Positioning.prototype.addSegment=positioningAddSegment,Positioning.prototype.removeSegment=positioningRemoveSegment,Positioning.prototype.addWatchedCalcPair=positioningAddWatchedCalcPair,Positioning.prototype.removeWatchedCalcPair=positioningCalcRemoveWatchedCalcPair,Positioning.prototype.addObjUsingWatchedPair=Positioning_addObjUsingWatchedPair,Positioning.prototype.delObjUsingWatchedPair=Positioning_delObjUsingWatchedPair,Positioning.prototype.delWatchedPairIfNotUsed=Positioning_delWatchedPairIfNotUsed,Positioning.prototype.addWatchedCallback=positioningAddWatchedCallback,Positioning.prototype.removeWatchedCallback=positioningRemoveWatchedCallback,Positioning.prototype.callWatchedCallbacks=positioningCallWatchedCallback,Positioning.prototype.reposition=positioningReposition,Positioning.prototype.needToRefresh=positioningNeedToRefresh,Positioning.prototype.refresh=positioningRefresh,Positioning.prototype.clearSolutionChanges=positioningClearSolutionChanges,Positioning.prototype.debugGetPairCycles=positioningDebugGetPairCycles;var doDebugTiming=!1,doDebugTimingReport,globalDebugTimingObj,totalTimeDebugTimingObj;DebugTimingObj.prototype.debugStartTimer=debugTimingObjDebugStartTimer,DebugTimingObj.prototype.debugStopTimer=debugTimingObjDebugStopTimer,DebugTimingObj.prototype.calcStatistics=debugTimingObjCalcStatistics,DebugTimingObj.prototype.debugTimingClear=debugTimingObjDebugTimingClear,DebugTimingObj.prototype.debugTimingAddGroup=debugTimingObjDebugTimingAddGroup,DebugTimingObj.prototype.debugTimingAddConditionalGroup=debugTimingObjDebugTimingAddConditionalGroup,DebugTimingObj.prototype.debugTimingRemoveGroup=debugTimingObjDebugTimingRemoveGroup,DebugTimingObj.prototype.printLastDebugTiming=debugTimingObjPrintLastDebugTiming,DebugTimingObj.prototype.printSingleDebugTiming=debugTimingObjPrintSingleDebugTiming,DebugTimingObj.prototype.debugLogTimeElapsed=debugTimingObjDebugLogTimeElapsed,DebugTimingObj.prototype.displayStatistics=debugTimingObjDisplayStatistics;var globalPos;InnerProducts.prototype.addToProducts=innerProductsAddToProducts,InnerProducts.prototype.calcInnerProducts=innerProductsCalcInnerProducts,InnerProducts.prototype.initInnerProducts=innerProductsInitInnerProducts,InnerProducts.prototype.addVectors=innerProductsAddVectors,InnerProducts.prototype.removeVector=innerProductsRemoveVector,InnerProducts.prototype.setToZero=innerProductsSetToZero,InnerProducts.prototype.multiplyVector=innerProductsMultiplyVector,PosEquations.prototype.debugSetDebugMode=posEquationsDebugSetDebugMode,PosEquations.prototype.debugNewSolutionCycle=posEquationsDebugNewSolutionCycle,PosEquations.prototype.debugRecord=posEquationsDebugRecord,PosEquations.prototype.debugGetEquation=posEquationsDebugGetEquation,PosEquations.prototype.debugGetResistance=posEquationsDebugGetResistance,PosEquations.prototype.debugGetVarStr=posEquationsDebugGetVarStr,PosEquations.prototype.debugInitStatistics=posEquationsDebugInitStatistics,PosEquations.prototype.debugReportProblemChanges=posEquationsDebugReportProblemChanges,PosEquations.prototype.debugCheckOptimizationSuspension=posEquationsDebugCheckOptimizationSuspension,PosEquations.prototype.debugBreakOnOptimizationSuspensionErrors=posEquationsDebugBreakOnOptimizationSuspensionErrors,PosEquations.prototype.debugCheckOptimizationSuspensionInternalConsistency=posEquationsDebugCheckOptimizationSuspensionInternalConsistency,PosEquations.prototype.debugCheckOptimizationSuspensionCorrectness=posEquationsDebugCheckOptimizationSuspensionCorrectness,PosEquations.prototype.debugReportViolations=posEquationsDebugReportViolations,PosEquations.prototype.debugGetViolatedVarsByPairId=posEquationsDebugGetViolatedVarsByPairId,PosEquations.prototype.debugGetViolation=posEquationsDebugGetViolation,PosEquations.prototype.debugAddBlockingToResult=posEquationsDebugAddBlockingToResult,PosEquations.prototype.debugAddBlockingEquationToResult=posEquationsDebugAddBlockingEquationToResult,PosEquations.prototype.debugUpdateInnerProdOfBaseEqWithSolution=posEquationsDebugUpdateInnerProdOfBaseEqWithSolution,Heap.prototype.addSingle=heapAddSingle,Heap.prototype.addMulti=heapAddMulti,Heap.prototype.pop=heapPop,Heap.prototype.peek=heapPeek,Heap.prototype.bubbleUp=heapBubbleUp,Heap.prototype.maxHeapify=heapMaxHeapify,Heap.prototype.isEmpty=heapIsEmpty,Heap.prototype.getSize=heapGetSize,InternalQCMPathIdAllocator.prototype.allocatePathId=internalQCMPathIdAllocatorAllocatePathId,InternalQCMPathIdAllocator.prototype.allocatePathIdFromPath=internalQCMPathIdAllocatorAllocatePathIdFromPath,InternalQCMPathIdAllocator.prototype.allocateConcatPathId=internalQCMPathIdAllocatorAllocateConcatPathId,InternalQCMPathIdAllocator.prototype.allocatePathIdByPathId=internalQCMPathIdAllocatorAllocatePathIdByPathId,InternalQCMPathIdAllocator.prototype.allocateSuffixPath=internalQCMPathIdAllocatorAllocateSuffixPath,InternalQCMPathIdAllocator.prototype.releasePathId=internalQCMPathIdAllocatorReleasePathId,InternalQCMPathIdAllocator.prototype.diffPathId=internalQCMPathIdAllocatorDiffPathId,InternalQCMPathIdAllocator.prototype.isPrefixOf=internalQCMPathIdAllocatorIsPrefixOf,InternalQCMPathIdAllocator.prototype.getRootPathId=internalQCMPathIdAllocatorGetRootPathId,InternalQCMPathIdAllocator.prototype.getPathId=internalQCMPathIdAllocatorGetPathId,InternalQCMPathIdAllocator.prototype.getPathLength=internalQCMPathIdAllocatorGetPathLength,InternalQCMPathIdAllocator.prototype.getPrefix=internalQCMPathIdAllocatorGetPrefix,InternalQCMPathIdAllocator.prototype.getCommonPrefix=internalQCMPathIdAllocatorGetCommonPrefix,InternalQCMPathIdAllocator.prototype.getFirstAttrAfterPrefix=internalQCMPathIdAllocatorGetFirstAttrAfterPrefix,InternalQCMPathIdAllocator.prototype.getLastPathAttr=internalQCMPathIdAllocatorGetLastPathAttr,InternalQCMPathIdAllocator.prototype.getPathStrings=internalQCMPathIdAllocatorGetPathStrings,InternalQCMPathIdAllocator.prototype.getPathSuffix=internalQCMPathIdAllocatorGetPathSuffix,InternalQCMPathIdAllocator.prototype.getSortKey=internalQCMPathIdAllocatorGetSortKey,InternalQCMPathIdAllocator.prototype.extensionSortKeyRange=internalQCMPathIdAllocatorExtensionSortKeyRange,InternalQCMPathIdAllocator.prototype.calculateSK=internalQCMPathIdAllocatorCalculateSK,InternalQCMCompression.prototype.initRounding=internalQCMCompressionInitRounding,InternalQCMCompression.prototype.createRoundingFunction=internalQCMCompressionCreateRoundingFunction,InternalQCMCompression.prototype.nextQuick=internalQCMCompressionNextQuick,InternalQCMCompression.prototype.simple=internalQCMCompressionSimple,InternalQCMCompression.prototype.reallocateSimple=internalQCMCompressionReallocateSimple,InternalQCMCompression.prototype.path=internalQCMCompressionPath,InternalQCMCompression.prototype.pathAndValue=internalQCMCompressionPathAndValue,InternalQCMCompression.prototype.next=internalQCMCompressionNext,InternalQCMCompression.prototype.releaseSimple=internalQCMCompressionReleaseSimple,InternalQCMCompression.prototype.releaseSimpleCompressed=internalQCMCompressionReleaseSimpleCompressed,InternalQCMCompression.prototype.applyQueuedSimpleRelease=internalQCMCompressionApplyQueuedSimpleRelease,InternalQCMCompression.prototype.releasePath=internalQCMCompressionReleasePath,InternalQCMCompression.prototype.releasePathAndValue=internalQCMCompressionReleasePathAndValue,InternalQCMCompression.prototype.releaseNext=internalQCMCompressionReleaseNext,InternalQCMCompression.prototype.getSimpleValue=internalQCMCompressionGetSimpleValue,IndexerQueue.prototype.comparator=function(e,t){return e.pathId<t.pathId?1:e.pathId==t.pathId?0:-1},IndexerQueue.prototype.schedulePathNode=indexerQueueSchedulePathNode,IndexerQueue.prototype.decreaseIndexerCount=indexerQueueDecreaseIndexerCount,IndexerQueue.prototype.removeIndexerFromQueues=indexerQueueRemoveIndexerFromQueues,IndexerQueue.prototype.scheduleIdentityUpdate=indexerQueueScheduleIdentityUpdate,IndexerQueue.prototype.scheduleCompCalc=indexerQueueScheduleCompCalc,IndexerQueue.prototype.scheduleOrderService=indexerQueueScheduleOrderService,IndexerQueue.prototype.scheduleCompleteIncrementalUpdate=indexerQueueScheduleCompleteIncrementalUpdate,IndexerQueue.prototype.scheduleDataElements=indexerQueueScheduleDataElements,IndexerQueue.prototype.queuesEmpty=indexerQueueQueuesEmpty,IndexerQueue.prototype.indexerIsScheduled=indexerQueueIndexerIsScheduled,IndexerQueue.prototype.executeScheduled=indexerQueueExecuteScheduled,IndexerQueue.prototype.executeFinalCleanups=indexerQueueExecuteFinalCleanups,IndexerQueue.prototype.executeIdentityUpdates=indexerQueueExecuteIdentityUpdates,IndexerQueue.prototype.executePathNodeUpdates=indexerQueueExecutePathNodeUpdates,IndexerQueue.prototype.executeOrderServiceUpdates=indexerQueueExecuteOrderServiceUpdates,IndexerQueue.prototype.executeCompCalcUpdates=indexerQueueExecuteCompCalcUpdates,IndexerQueue.prototype.executeCompleteIncrementalUpdateTasks=indexerQueueExecuteCompleteIncrementalUpdateTasks,IndexerQueue.prototype.executeDataElementCleanup=indexerQueueExecuteDataElementCleanup,BinaryTree.prototype.defaultAllocateTreeNode=binaryTreeDefaultAllocateTreeNode,BinaryTree.prototype.compare=binaryTreeCompare,BinaryTree.prototype.isEmpty=binaryTreeIsEmpty,BinaryTree.prototype.insertKey=binaryTreeInsertKey,BinaryTree.prototype.removeKey=binaryTreeRemoveKey,BinaryTree.prototype.removeNode=binaryTreeRemoveNode,BinaryTree.prototype.copySplicedToRemovedNode=binaryTreeCopySplicedToRemovedNode,BinaryTree.prototype.find=binaryTreeFind,BinaryTree.prototype.print=binaryTreePrint,BinaryTreeNode.prototype.print=binaryTreeNodePrint,inherit(RedBlackTree,BinaryTree),RedBlackTree.prototype.insertKey=redBlackTreeInsertKey,RedBlackTree.prototype.fixAfterInsertion=redBlackTreeFixAfterInsertion,RedBlackTree.prototype.removeNode=redBlackTreeRemoveNode,RedBlackTree.prototype.fixAfterRemoval=redBlackTreeFixAfterRemoval,RedBlackTree.prototype.rotateRight=redBlackTreeRotateRight,RedBlackTree.prototype.rotateLeft=redBlackTreeRotateLeft,Uint31HashSet.loadFactor=.7,Uint31HashSet.defaultInitialSize=64,Uint31HashSet.prototype.init=uint31HashSetInit,Uint31HashSet.prototype.clear=uint31HashSetClear,Uint31HashSet.prototype.set=uint31HashSetSet,Uint31HashSet.prototype.has=uint31HashSetHas,Uint31HashSet.prototype.getPos=uint31HashSetGetPos,Uint31HashSet.prototype.delete=uint31HashSetDelete,Uint31HashSet.prototype.deleteAtPos=uint31HashSetDeleteAtPos,Uint31HashSet.prototype.forEach=uint31HashSetForEach,Uint31HashSet.prototype.pushTo=uint31HashSetPushTo,Uint31HashSet.prototype.getList=uint31HashSetGetList,Uint31HashSet.prototype.expectSize=uint31HashSetExpectSize,Uint31HashSet.prototype.suspendMinFill=uint31HashSetSuspendMinFill,Uint31HashSet.prototype.resetMinFill=uint31HashSetResetMinFill,Uint31HashSet.prototype.increaseSize=uint31HashSetIncreaseSize,Uint31HashSet.prototype.decreaseSize=uint31HashSetDecreaseSize,Uint31HashSet.prototype.resize=uint31HashSetResize,IntHashMap.prototype.clear=intHashMapClear,IntHashMap.prototype.makeValueArray=intHashMapMakeValueArray,IntHashMap.prototype.set=intHashMapSet,IntHashMap.prototype.has=intHashMapHas,IntHashMap.prototype.get=intHashMapGet,IntHashMap.prototype.getPos=intHashMapGetPos,IntHashMap.prototype.delete=intHashMapDelete,IntHashMap.prototype.forEach=intHashMapForEach,IntHashMap.prototype.suspendMinFill=intHashMapSuspendMinFill,IntHashMap.prototype.resetMinFill=intHashMapResetMinFill,IntHashMap.prototype.expectSize=intHashMapExpectSize,IntHashMap.prototype.resize=intHashMapResize,inherit(IntHashMapUint,IntHashMap),IntHashMapUint.prototype.makeValueArray=intHashMapUintMakeValueArray,IntHashMapUint.prototype.getByteNumForMaxValue=intHashMapUintGetByteNumForMaxValue,IntHashMapUint.prototype.adjustByteNumber=intHashMapUintAdjustByteNumber,IntHashMapUint.prototype.inc=intHashMapUintInc,IntHashMapUint.prototype.dec=intHashMapUintDec,inherit(IntHashPairMap,IntHashMap),IntHashPairMap.prototype.clear=intHashPairMapClear,IntHashPairMap.prototype.makeValueArray=intHashPairMapMakeValueArray,IntHashPairMap.prototype.makeSecondValueArray=intHashPairMapMakeSecondValueArray,IntHashPairMap.prototype.setSecond=intHashPairMapSetSecond,IntHashPairMap.prototype.setPair=intHashPairMapSetPair,IntHashPairMap.prototype.getSecond=intHashPairMapGetSecond,IntHashPairMap.prototype.getPair=intHashPairMapGetPair,IntHashPairMap.prototype.delete=intHashPairMapDelete,IntHashPairMap.prototype.forEachPair=intHashPairMapForEachPair,IntHashPairMap.prototype.resize=intHashPairMapResize,inherit(IntHashPairMapUint,IntHashPairMap),IntHashPairMapUint.prototype.makeValueArray=IntHashMapUint.prototype.makeValueArray,IntHashPairMapUint.prototype.getByteNumForMaxValue=IntHashMapUint.prototype.getByteNumForMaxValue,IntHashPairMapUint.prototype.adjustByteNumber=IntHashMapUint.prototype.adjustByteNumber,IntHashPairMapUint.prototype.inc=IntHashMapUint.prototype.inc,IntHashPairMapUint.prototype.dec=IntHashMapUint.prototype.dec,IntHashPairMapUint.prototype.incAndGetSecond=intHashPairMapUintIncAndGetSecond,IntHashPairMapUint.prototype.decAndGetSecond=intHashPairMapUintDecAndGetSecond,IntHashPairMapUint.prototype.getSecondIfZeroCount=intHashPairMapUintGetSecondIfZeroCount,IdStorage.minMapSize=100,IdStorage.prototype.has=idStorageHas,IdStorage.prototype.set=idStorageSet,IdStorage.prototype.delete=idStorageDelete,IdStorage.prototype.forEach=idStorageForEach,IdStorage.prototype.pushTo=idStoragePushTo,IdStorage.prototype.getList=idStorageGetList,IntIdStorage.minMapSize=100,IntIdStorage.initialLoadFactor=.7,IntIdStorage.prototype.has=intIdStorageHas,IntIdStorage.prototype.set=intIdStorageSet,IntIdStorage.prototype.delete=intIdStorageDelete,IntIdStorage.prototype.forEach=intIdStorageForEach,IntIdStorage.prototype.pushTo=intIdStoragePushTo,IntIdStorage.prototype.getList=intIdStorageGetList,inherit(IntBinaryTreeNode,IntIdStorage),inherit(DegenerateIntervalTree,RedBlackTree);var debugAllDegenerateIntervalTrees;DegenerateIntervalTree.prototype.intStorageAllocate=degenerateIntervalTreeIntStorageAllocate,DegenerateIntervalTree.prototype.nonIntStorageAllocate=degenerateIntervalTreeNonIntStorageAllocate,DegenerateIntervalTree.prototype.allocateIntTreeNode=degenerateIntervalTreeAllocateIntTreeNode,DegenerateIntervalTree.prototype.insertPoint=degenerateIntervalTreeInsertPoint,DegenerateIntervalTree.prototype.removePoint=degenerateIntervalTreeRemovePoint,DegenerateIntervalTree.prototype.getFirst=degenerateIntervalTreeGetFirst,DegenerateIntervalTree.prototype.getFirstKey=degenerateIntervalTreeGetFirstKey,DegenerateIntervalTree.prototype.find=degenerateIntervalTreeFind,DegenerateIntervalTree.prototype.findIntersections=degenerateIntervalTreeFindIntersections,DegenerateIntervalTree.prototype.findContained=degenerateIntervalTreeFindContained,DegenerateIntervalTree.prototype.findWithUpperBound=degenerateIntervalTreeFindWithUpperBound,DegenerateIntervalTree.prototype.findWithLowerBound=degenerateIntervalTreeFindWithLowerBound,DegenerateIntervalTree.prototype.debugGetValueDistribution=degenerateIntervalTreeDebugGetValueDistribution,IndexerGarbageCollector.collectionTimeStep=5e3,IndexerGarbageCollector.tracingTimeout=5e3,IndexerGarbageCollector.indexTimeout=5e3,IndexerGarbageCollector.prototype.scheduleGarbageCollection=indexerGarbageCollectorScheduleGarbageCollection,IndexerGarbageCollector.prototype.scheduleIndexDestroy=indexerGarbageCollectorScheduleIndexDestroy,IndexerGarbageCollector.prototype.descheduleIndexDestroy=indexerGarbageCollectorDescheduleIndexDestroy,IndexerGarbageCollector.prototype.scheduleTraceDeactivation=indexerGarbageCollectorScheduleTraceDeactivation,IndexerGarbageCollector.prototype.descheduleTraceDeactivation=indexerGarbageCollectorDescheduleTraceDeactivation,IndexerGarbageCollector.prototype.executeGarbageCollection=indexerGarbageCollectorExecuteGarbageCollection,PathNodeQueue.stringCompare=function(e,t){return e==t?0:e<t?-1:1},PathNodeQueue.prototype.getPathNodeId=pathNodeQueueGetPathNodeId,PathNodeQueue.prototype.add=pathNodeQueueAdd,PathNodeQueue.prototype.remove=pathNodeQueueRemove,PathNodeQueue.prototype.peek=pathNodeQueuePeek,PathNodeQueue.prototype.pop=pathNodeQueuePop,PathNodeQueue.prototype.isEmpty=pathNodeQueueIsEmpty;var internalQCMNextId=1025;InternalQCM.newId=function(){return internalQCMNextId++},InternalQCM.prototype.schedulePathNode=internalQCMSchedulePathNode,InternalQCM.prototype.scheduleIdentityUpdate=internalQCMScheduleIdentityUpdate,InternalQCM.prototype.scheduleCompCalc=internalQCMScheduleCompCalc,InternalQCM.prototype.scheduleOrderService=internalQCMScheduleOrderService,InternalQCM.prototype.scheduleCompleteIncrementalUpdate=internalQCMScheduleCompleteIncrementalUpdate,InternalQCM.prototype.scheduleDataElements=internalQCMScheduleDataElements,InternalQCM.prototype.indexerIsScheduled=internalQCMIndexerIsScheduled,InternalQCM.prototype.executeScheduled=internalQCMExecuteScheduled,InternalQCM.prototype.removeIndexerFromQueues=internalQCMRemoveIndexerFromQueues,InternalQCM.prototype.scheduleIndexDestroy=internalQCMScheduleIndexDestroy,InternalQCM.prototype.descheduleIndexDestroy=internalQCMDescheduleIndexDestroy,InternalQCM.prototype.scheduleTraceDeactivation=internalQCMScheduleTraceDeactivation,InternalQCM.prototype.descheduleTraceDeactivation=internalQCMDescheduleTraceDeactivation,InternalQCM.prototype.executeGarbageCollection=internalQCMExecuteGarbageCollection,InternalQCM.prototype.allocatePathId=internalQCMAllocatePathId,InternalQCM.prototype.allocatePathIdFromPath=internalQCMAllocatePathIdFromPath,InternalQCM.prototype.allocateConcatPathId=internalQCMAllocateConcatPathId,InternalQCM.prototype.allocatePathIdByPathId=internalQCMAllocatePathIdByPathId,InternalQCM.prototype.getPathId=internalQCMGetPathId,InternalQCM.prototype.releasePathId=internalQCMReleasePathId,InternalQCM.prototype.diffPathId=internalQCMDiffPathId,InternalQCM.prototype.getRootPathId=internalQCMGetRootPathId,InternalQCM.prototype.getPathSortKey=internalQCMGetPathSortKey,InternalQCM.prototype.extensionSortKeyRange=internalQCMExtensionSortKeyRange,InternalQCM.prototype.isPrefixOf=internalQCMIsPrefixOf,InternalQCM.prototype.getPathLength=internalQCMGetPathLength,InternalQCM.prototype.getPrefix=internalQCMGetPrefix,InternalQCM.prototype.getCommonPrefix=internalQCMGetCommonPrefix,InternalQCM.prototype.getFirstAttrAfterPrefix=internalQCMGetFirstAttrAfterPrefix,InternalQCM.prototype.getLastPathAttr=internalQCMGetLastPathAttr,InternalQCM.prototype.getPathStrings=internalQCMGetPathStrings,InternalQCM.prototype.getPathSuffix=internalQCMGetPathSuffix,InternalQCM.prototype.getRootQueryCalc=internalQCMGetRootQueryCalc,InternalQCM.prototype.releaseRootQueryCalc=internalQCMReleaseRootQueryCalc,InternalQCM.prototype.getCompCalc=internalQCMGetCompCalc,InternalQCM.prototype.releaseCompCalc=internalQCMReleaseCompCalc,InternalQCM.prototype.getOrderService=internalQCMGetOrderService,InternalQCM.prototype.releaseOrderService=internalQCMReleaseOrderService;var debugInternalQCMStoreObjects=!0;InternalQCM.prototype.debugInitStoreObjects=internalQCMDebugInitStoreObjects,DataElements.prototype.updateNumPathNodes=dataElementsUpdateNumPathNodes,DataElements.prototype.expectAdditionalDataElementNum=dataElementsExpectAdditionalDataElementNum,DataElements.prototype.addNewDataElement=dataElementsAddNewDataElement,DataElements.prototype.getNewDataElementPathChildren=dataElementsGetNewDataElementPathChildren,DataElements.prototype.getEntryForNewElement=dataElementsGetEntryForNewElement,DataElements.prototype.newDataElementEntry=dataElementsNewDataElementEntry,DataElements.prototype.getNonDefaultElementEntry=dataElementsGetNonDefaultElementEntry,DataElements.prototype.incRef=dataElementsIncRef,DataElements.prototype.releaseDataElement=dataElementsReleaseDataElement,DataElements.prototype.removeDataElement=dataElementsRemoveDataElement,DataElements.prototype.removeDataElementFromParent=dataElementsRemoveDataElementFromParent,DataElements.prototype.removePendingRemovals=dataElementsRemovePendingRemovals,DataElements.prototype.hasPendingRemovals=dataElementsHasPendingRemovals,DataElements.prototype.getBaseIdentity=dataElementsGetBaseIdentity,DataElements.prototype.getBaseIdentities=dataElementsGetBaseIdentities,DataElements.prototype.setBaseIdentityForNewNode=dataElementsSetBaseIdentityForNewNode,DataElements.prototype.assignDefaultBaseIdentity=dataElementsAssignDefaultBaseIdentity,DataElements.prototype.setBaseIdentityForExistingNode=dataElementsSetBaseIdentityForExistingNode,DataElements.prototype.updateSingleChildrenWithIdentity=dataElementsUpdateSingleChildrenWithIdentity,DataElements.prototype.verifyDefaultBaseIdentity=dataElementsVerifyDefaultBaseIdentity,DataElements.prototype.addBasePendingIdentity=dataElementsAddBasePendingIdentity,DataElements.prototype.hasPendingBaseIdentities=dataElementsHasPendingBaseIdentities,DataElements.prototype.createBaseIdentityNotifications=dataElementsCreateBaseIdentityNotifications,DataElements.prototype.setNotifiedBaseIdentities=dataElementsSetNotifiedBaseIdentities,DataElements.prototype.hasEntry=dataElementsHasEntry,DataElements.prototype.getEntry=dataElementsGetEntry,DataElements.prototype.getParentId=dataElementsGetParentId,DataElements.prototype.getPathId=dataElementsGetPathId,DataElements.prototype.dataElementHasSiblings=dataElementsDataElementHasSiblings,DataElements.prototype.getNumDirectChildDataElements=dataElementsGetNumDirectChildDataElements,DataElements.prototype.getDirectChildDataElements=dataElementsGetDirectChildDataElements,DataElements.prototype.getDirectChildDataElementsAsObj=dataElementsGetDirectChildDataElementsAsObj,DataElements.prototype.hasDirectChildDataElements=dataElementsHasDirectChildDataElements,DataElements.prototype.getAllDominatedDataElements=dataElementsGetAllDominatedDataElements,DataElements.prototype.getChildDataElements=dataElementsGetChildDataElements,DataElements.prototype.lowerDataElementsTo=dataElementsLowerDataElementsTo,DataElements.prototype.raiseToPath=dataElementsRaiseToPath,DataElements.prototype.raiseExactlyToPath=dataElementsRaiseExactlyToPath,DataElements.prototype.raiseAllToPath=dataElementsRaiseAllToPath,DataElements.prototype.getLowestParentWithSiblings=dataElementsGetLowestParentWithSiblings,DataElements.prototype.filterDataElementsUnderPathId=dataElementsFilterDataElementsUnderPathId,inherit(MergeDataElements,DataElements),MergeDataElements.prototype.getNewDataElementPathChildren=mergeDataElementsGetNewDataElementPathChildren,MergeDataElements.prototype.getEntryForNewElement=mergeDataElementsGetEntryForNewElement,MergeDataElements.prototype.newInitialDataElementEntry=mergeDataElementsNewInitialDataElementEntry,MergeDataElements.prototype.newDataElementEntry=mergeDataElementsNewDataElementEntry,MergeDataElements.prototype.getGroupId=mergeDataElementsGetGroupId,MergeDataElements.prototype.getSourceId=mergeDataElementsGetSourceId,MergeDataElements.prototype.filterTranslated=mergeDataElementsFilterTranslated,CompressedValue.prototype.destroy=compressedValueDestroy,CompressedValue.prototype.updateSimpleElement=compressedValueUpdateSimpleElement,CompressedValue.prototype.removeSimpleElement=compressedValueRemoveSimpleElement,CompressedValue.prototype.completeUpdate=compressedValueCompleteUpdate,CompressedValue.prototype.getCompression=compressedValueGetCompression,CompressedValue.prototype.getFullCompression=compressedValueGetFullCompression,CompressedValue.prototype.hasFullCompression=compressedValueHasFullCompression,CompressedValue.prototype.requestFullCompression=compressedValueRequestFullCompression,
CompressedValue.prototype.addToFullCompression=compressedValueAddToFullCompression,CompressedValue.prototype.getSequenceId=compressedValueGetSequenceId,CompressedValue.prototype.addToSequences=compressedValueAddToSequences,CompressedValue.prototype.addToSequenceParents=compressedValueAddToSequenceParents,CompressedValue.prototype.extractExistingSequenceEntries=compressedValueExtractExistingSequenceEntries,CompressedValue.prototype.checkMultipleChildren=compressedValueCheckMultipleChildren,CompressedValue.prototype.removeFromSequence=compressedValueRemoveFromSequence,CompressedValue.prototype.modifiedInSequence=compressedValueModifiedInSequence,CompressedValue.prototype.getSeqModEntry=compressedValueGetSeqModEntry,CompressedValue.prototype.destroySequences=compressedValueDestroySequences,CompressedValue.prototype.releaseSequence=compressedValueReleaseSequence,CompressedValue.prototype.deactivateFullCompression=compressedValueDeactivateFullCompression,CompressedValue.prototype.removeSequence=compressedValueRemoveSequence,CompressedValue.prototype.entryCompFuncByValue=compressedValueEntryCompFuncByValue,CompressedValue.prototype.sortAndCompressAllSequences=compressedValueSortAndCompressAllSequences,CompressedValue.prototype.sortAndCompressModifiedSequences=compressedValueSortAndCompressModifiedSequences,CompressedValue.prototype.compressSequence=compressedValueCompressSequence,InternalSubTree.prototype.destroy=internalSubTreeDestroy,InternalSubTree.prototype.clear=internalSubTreeClear,InternalSubTree.prototype.clearSimpleCompressedValues=internalSubTreeClearSimpleCompressedValues,InternalSubTree.prototype.isSimple=internalSubTreeIsSimple,InternalSubTree.prototype.isEmpty=internalSubTreeIsEmpty,InternalSubTree.prototype.addMonitor=internalSubTreeAddMonitor,InternalSubTree.prototype.addCompressionMonitor=internalSubTreeAddCompressionMonitor,InternalSubTree.prototype.removeMonitor=internalSubTreeRemoveMonitor,InternalSubTree.prototype.getMonitorIds=internalSubTreeGetMonitorIds,InternalSubTree.prototype.updateSimpleElement=internalSubTreeUpdateSimpleElement,InternalSubTree.prototype.removeSimpleElement=internalSubTreeRemoveSimpleElement,InternalSubTree.prototype.completeUpdate=internalSubTreeCompleteUpdate,InternalSubTree.prototype.getCompression=internalSubTreeGetCompression,InternalSubTree.prototype.getFullCompression=internalSubTreeGetFullCompression,InternalSubTree.prototype.setFullCompression=internalSubTreeSetFullCompression,InternalSubTree.prototype.unsetFullCompression=internalSubTreeUnsetFullCompression,MinMaxHeap.prototype.setComparatorInfo=minMaxHeapSetComparatorInfo,MinMaxHeap.prototype.getComparatorInfo=minMaxHeapGetComparatorInfo,MinMaxHeap.prototype.isSorted=!1,MinMaxHeap.prototype.clear=minMaxHeapClear,MinMaxHeap.prototype.isEmpty=minMaxHeapIsEmpty,MinMaxHeap.prototype.getSize=minMaxHeapGetSize,MinMaxHeap.prototype.getMin=minMaxHeapGetMin,MinMaxHeap.prototype.getMax=minMaxHeapGetMax,MinMaxHeap.prototype.compare=minMaxHeapCompare,MinMaxHeap.prototype.swap=minMaxHeapSwap,MinMaxHeap.prototype.add=minMaxHeapAdd,MinMaxHeap.prototype.removePos=minMaxHeapRemovePos,MinMaxHeap.prototype.bubbleUp=minMaxHeapBubbleUp,MinMaxHeap.isOnMinLevel=minMaxHeapIsOnMinLevel,MinMaxHeap.prototype.bubbleUpMin=minMaxHeapBubbleUpMin,MinMaxHeap.prototype.bubbleUpMax=minMaxHeapBubbleUpMax,MinMaxHeap.prototype.assignPos=minMaxHeapAssignPos,MinMaxHeap.prototype.popLastPos=minMaxHeapPopLastPos,MinMaxHeap.prototype.popMin=minMaxHeapPopMin,MinMaxHeap.prototype.popMax=minMaxHeapPopMax,MinMaxHeap.prototype.trickleDown=minMaxHeapTrickleDown,MinMaxHeap.prototype.trickleDownMin=minMaxHeapTrickleDownMin,MinMaxHeap.prototype.trickleDownMax=minMaxHeapTrickleDownMax,MinMaxHeap.prototype.getMinIndex=minMaxHeapGetMinIndex,MinMaxHeap.prototype.getMaxIndex=minMaxHeapGetMaxIndex,MinMaxHeap.errorCount=0,MinMaxHeap.prototype.verify=minMaxHeapVerify,MinMaxHeap.prototype.addArray=minMaxHeapAddArray,MinMaxHeap.prototype.getFirstElement=minMaxHeapGetFirstElement,MinMaxHeap.prototype.getLastElement=minMaxHeapGetLastElement,MinMaxHeap.prototype.initWithSortedArray=minMaxHeapInitWithSortedArray,MinMaxHeap.prototype.dump=sMMHeapDump,MinMaxHeap.prototype.dumpHorizontal=minMaxHeapDumpHorizontal,inherit(RangeKey,MinMaxHeap),RangeKey.prototype.comparator=function(e,t){return e.key<t.key?-1:e.key==t.key?0:1},RangeKey.prototype.isNonRangeType=rangeKeyIsNonRangeType,RangeKey.prototype.add=rangeKeyAdd,RangeKey.prototype.addFromRangeKey=rangeKeyAddFromRangeKey,RangeKey.prototype.remove=rangeKeyRemove,RangeKey.prototype.removeByRangeKey=rangeKeyRemoveByRangeKey,RangeKey.prototype.setMinOpen=rangeKeySetMinOpen,RangeKey.prototype.setMaxOpen=rangeKeySetMaxOpen,RangeKey.prototype.getMinOpen=rangeKeyGetMinOpen,RangeKey.prototype.getMaxOpen=rangeKeyGetMaxOpen,RangeKey.prototype.setType=rangeKeySetType,RangeKey.prototype.activate=rangeKeyActivate,RangeKey.prototype.isActive=rangeKeyIsActive,RangeKey.prototype.getMinKey=rangeKeyGetMinKey,RangeKey.prototype.getMaxKey=rangeKeyGetMaxKey,RangeKey.prototype.getMinMax=rangeKeyGetMinMax,RangeKey.prototype.isEmpty=rangeKeyIsEmpty,RangeKey.prototype.getEntries=rangeKeyGetEntries,RangeKey.prototype.getTypes=rangeKeyGetTypes,RangeKey.prototype.getType=rangeKeyGetType,RangeKey.prototype.getKeyUpdate=rangeKeyGetKeyUpdate,RangeKey.prototype.simpleCopy=rangeKeySimpleCopy,RangeKey.prototype.swap=rangeKeySwap,RangeKey.prototype.assignPos=rangeKeyAssignPos,RangeKey.prototype.popLastPos=rangeKeyPopLastPos,RangeKey.prototype.intersectsWith=rangeKeyIntersectsWith,RangeKey.prototype.valueInRange=rangeKeyValueInRange,ConstRangeKey.prototype.isActive=constRangeKeyIsActive,ConstRangeKey.prototype.isEmpty=constRangeKeyIsEmpty,ConstRangeKey.prototype.getMinKey=constRangeKeyGetMinKey,ConstRangeKey.prototype.getMaxKey=constRangeKeyGetMaxKey,ConstRangeKey.prototype.getMinOpen=constRangeKeyGetMinOpen,ConstRangeKey.prototype.getMaxOpen=constRangeKeyGetMaxOpen,ConstRangeKey.prototype.getType=constRangeKeyGetType,ConstRangeKey.prototype.simpleCopy=constRangeKeySimpleCopy,ConstRangeKey.prototype.intersectsWith=constRangeKeyIntersectsWith,ConstRangeKey.prototype.valueInRange=constRangeKeyValueInRange,DebugInternalTo.prototype.getElementPathId=debugInternalToGetElementPathId,DebugInternalTo.prototype.clear=debugInternalToClear,DebugInternalTo.prototype.setDataElementTable=debugInternalToSetDataElementTable,DebugInternalTo.prototype.addValue=debugInternalToAddValue,DebugInternalTo.prototype.getDominatingNode=debugInternalToGetDominatingNode,DebugInternalTo.prototype.createNewEntry=debugInternalToCreateNewEntry,DebugInternalTo.prototype.insertUnderDominating=debugInternalToInsertUnderDominating,DebugInternalTo.prototype.removeDominatedNodes=debugInternalToRemoveDominatedNodes,DebugInternalTo.prototype.removeValue=debugInternalToRemoveValue,DebugInternalTo.prototype.clearValue=debugInternalToClearValue,DebugInternalTo.prototype.getDescStr=debugInternalToGetDescStr,DiscreteSubIndex.prototype.addToHalfSubIndex=discreteSubIndexAddToHalfSubIndex,DiscreteSubIndex.prototype.addValue=discreteSubIndexAddValue,DiscreteSubIndex.prototype.addLookup=discreteSubIndexAddLookup,DiscreteSubIndex.prototype.removeFromHalfSubIndex=discreteSubIndexRemoveFromHalfSubIndex,DiscreteSubIndex.prototype.removeValue=discreteSubIndexRemoveValue,DiscreteSubIndex.prototype.clearValues=discreteSubIndexClearValues,DiscreteSubIndex.prototype.removeLookup=discreteSubIndexRemoveLookup,DiscreteSubIndex.prototype.getMatches=discreteSubIndexGetMatches,DiscreteSubIndex.prototype.supportsIntervals=discreteSubIndexSupportsIntervals,DiscreteSubIndex.prototype.hasRangeValues=discreteSubIndexHasRangeValues,DiscreteSubIndex.prototype.hasNoLookups=discreteSubIndexHasNoLookups,DiscreteSubIndex.prototype.getAllValues=discreteSubIndexGetAllValues,DiscreteSubIndex.prototype.getAllLookups=discreteSubIndexGetAllLookups,inherit(IntervalTree,RedBlackTree);var debugAllIntervalTrees;IntervalTree.prototype.isEmpty=intervalTreeIsEmpty,IntervalTree.prototype.intStorageAllocate=intervalTreeIntStorageAllocate,IntervalTree.prototype.nonIntStorageAllocate=intervalTreeNonIntStorageAllocate,IntervalTree.prototype.insertInterval=intervalTreeInsertInterval,IntervalTree.prototype.insertPoint=intervalTreeInsertPoint,IntervalTree.prototype.insertKey=intervalTreeInsertKey,IntervalTree.prototype.addInterval=intervalTreeAddInterval,IntervalTree.prototype.removeInterval=intervalTreeRemoveInterval,IntervalTree.prototype.removePoint=intervalTreeRemovePoint,IntervalTree.prototype.removeNode=intervalTreeRemoveNode,IntervalTree.prototype.eraseInterval=intervalTreeEraseInterval,IntervalTree.prototype.copySplicedToRemovedNode=intervalTreeCopySplicedToRemovedNode,IntervalTree.prototype.rotateRight=intervalTreeRotateRight,IntervalTree.prototype.rotateLeft=intervalTreeRotateLeft,IntervalTree.prototype.find=intervalTreeFind,IntervalTree.prototype.findKeyUnder=intervalTreeFindKeyUnder,IntervalTree.prototype.findIntersections=intervalTreeFindIntersections,IntervalTree.prototype.findIntersectionsUnder=intervalTreeFindIntersectionsUnder,IntervalTree.prototype.findContained=intervalTreeFindContained,IntervalTree.prototype.findContainedUnder=intervalTreeFindContainedUnder,IntervalTree.prototype.findWithUpperBound=intervalTreeFindWithUpperBound,IntervalTree.prototype.findWithUpperBoundUnder=intervalTreeFindWithUpperBoundUnder,IntervalTree.prototype.findWithLowerBound=intervalTreeFindWithLowerBound,IntervalTree.prototype.findWithLowerBoundUnder=intervalTreeFindWithLowerBoundUnder,IntervalTree.prototype.importFromDegenerateTree=intervalTreeImportFromDegenerateTree,HalfLinearSubIndex.prototype.clear=halfLinearSubIndexClear,HalfLinearSubIndex.prototype.isEmpty=halfLinearSubIndexIsEmpty,HalfLinearSubIndex.prototype.addInterval=halfLinearSubIndexAddInterval,HalfLinearSubIndex.prototype.loadDegenerateIntervals=halfLinearSubIndexLoadDegenerateIntervals,HalfLinearSubIndex.prototype.removeInterval=halfLinearSubIndexRemoveInterval,HalfLinearSubIndex.prototype.calcDiff=halfLinearSubIndexCalcDiff,HalfLinearSubIndex.prototype.calcDegenerateDiff=halfLinearSubIndexCalcDegenerateDiff,HalfLinearSubIndex.prototype.convertDegnerateTree=halfLinearSubIndexConvertDegnerateTree,HalfLinearSubIndex.prototype.findIntersections=halfLinearSubIndexFindIntersections,HalfLinearSubIndex.prototype.findWithUpperBound=halfLinearSubIndexFindWithUpperBound,HalfLinearSubIndex.prototype.findWithLowerBound=halfLinearSubIndexFindWithLowerBound,LinearSubIndex.stringCompare=function(e,t){return e==t?0:e===-(1/0)?-1:e===1/0?1:t===-(1/0)?1:t===1/0?-1:e<t?-1:1},LinearSubIndex.prototype.addToHalfSubIndex=linearSubIndexAddToHalfSubIndex,LinearSubIndex.prototype.addValue=linearSubIndexAddValue,LinearSubIndex.prototype.addLookup=linearSubIndexAddLookup,LinearSubIndex.prototype.removeValue=linearSubIndexRemoveValue,LinearSubIndex.prototype.clearValues=linearSubIndexClearValues,LinearSubIndex.prototype.removeLookup=linearSubIndexRemoveLookup,LinearSubIndex.prototype.getMatches=linearSubIndexGetMatches,LinearSubIndex.prototype.hasRangeValues=linearSubIndexHasRangeValues,LinearSubIndex.prototype.supportsIntervals=linearSubIndexSupportsIntervals,LinearSubIndex.prototype.hasNoLookups=linearSubIndexHasNoLookups,LinearSubIndex.prototype.loadFromDiscrete=linearSubIndexLoadFromDiscrete;var internalQCMIndexerNextId=1025,internalQCMIndexerNextDataElementId=1025;InternalQCMIndexer.prototype.createDataElements=internalQCMIndexerCreateDataElements,InternalQCMIndexer.prototype.destroy=internalQCMIndexerDestroy,InternalQCMIndexer.prototype.alphabeticTypes={string:!0},InternalQCMIndexer.prototype.isUnindexedType=internalQCMIndexerIsUnindexedType,InternalQCMIndexer.prototype.isElementReferenceType=internalQCMIndexerIsElementReferenceType,InternalQCMIndexer.prototype.isOperatorType=internalQCMIndexerIsOperatorType,InternalQCMIndexer.prototype.isRangeKey=internalQCMIndexerIsRangeKey,InternalQCMIndexer.prototype.getId=internalQCMIndexerGetId,InternalQCMIndexer.prototype.getRootPathId=internalQCMIndexerGetRootPathId,InternalQCMIndexer.prototype.addPath=internalQCMIndexerAddPath,InternalQCMIndexer.prototype.createPathNode=internalQCMIndexerCreatePathNode,InternalQCMIndexer.prototype.clearPathNode=internalQCMIndexerClearPathNode,InternalQCMIndexer.prototype.keepPathNodeActive=internalQCMIndexerKeepPathNodeActive,InternalQCMIndexer.prototype.releaseKeepPathNodeActive=internalQCMIndexerReleaseKeepPathNodeActive,InternalQCMIndexer.prototype.removePathNode=internalQCMIndexerRemovePathNode,InternalQCMIndexer.prototype.clearAllDataNodes=internalQCMIndexerClearAllDataNodes,InternalQCMIndexer.prototype.clear=internalQCMIndexerClear,InternalQCMIndexer.prototype.incPathNodeTracing=internalQCMIndexerIncPathNodeTracing,InternalQCMIndexer.prototype.decPathNodeTracing=internalQCMIndexerDecPathNodeTracing,InternalQCMIndexer.prototype.removePathNodeTracing=internalQCMIndexerRemovePathNodeTracing,InternalQCMIndexer.prototype.isPathActive=internalQCMIndexerIsPathActive,InternalQCMIndexer.prototype.incPathNodeIndexing=internalQCMIndexerIncPathNodeIndexing,InternalQCMIndexer.prototype.decPathNodeIndexing=internalQCMIndexerDecPathNodeIndexing,InternalQCMIndexer.prototype.setAlphabeticRanges=internalQCMIndexerSetAlphabeticRanges,InternalQCMIndexer.prototype.loadDataIntoIndexes=internalQCMIndexerLoadDataIntoIndexes,InternalQCMIndexer.prototype.destroyIndexAtNode=internalQCMIndexerDestroyIndexAtNode,InternalQCMIndexer.getNextDataElementId=function(){return internalQCMIndexerNextDataElementId++},InternalQCMIndexer.getDataElementIdRange=function(e){var t=internalQCMIndexerNextDataElementId;return internalQCMIndexerNextDataElementId+=e,t},InternalQCMIndexer.prototype.expectAdditionalDataElementNum=internalQCMIndexerExpectAdditionalDataElementNum,InternalQCMIndexer.prototype.expectNodeNum=internalQCMIndexerExpectNodeNum,InternalQCMIndexer.prototype.expectAdditionalNodeNum=internalQCMIndexerExpectAdditionalNodeNum,InternalQCMIndexer.prototype.addNonDataElementNode=internalQCMIndexerAddNonDataElementNode,InternalQCMIndexer.prototype.addNonDataElementNodes=internalQCMIndexerAddNonDataElementNodes,InternalQCMIndexer.prototype.addDataElementNode=internalQCMIndexerAddDataElementNode,InternalQCMIndexer.prototype.newElementNode=internalQCMIndexerNewElementNode,InternalQCMIndexer.prototype.removeNode=internalQCMIndexerRemoveNode,InternalQCMIndexer.prototype.removeNodes=internalQCMIndexerRemoveNodes,InternalQCMIndexer.prototype.queueAddedNode=internalQCMIndexerQueueAddedNode,InternalQCMIndexer.prototype.queueAddedNodes=internalQCMIndexerQueueAddedNodes,InternalQCMIndexer.prototype.queueRemovedNode=internalQCMIndexerQueueRemovedNode,InternalQCMIndexer.prototype.removeAllNodesOnPathNode=internalQCMIndexerRemoveAllNodesOnPathNode,InternalQCMIndexer.prototype.getDataNodesAtPath=internalQCMIndexerGetDataNodesAtPath,InternalQCMIndexer.prototype.getPrevKeysAtPath=internalQCMIndexerGetPrevKeysAtPath,InternalQCMIndexer.prototype.filterDataNodesAtPath=internalQCMIndexerFilterDataNodesAtPath,InternalQCMIndexer.prototype.filterDataNodesAtPathWithDiff=internalQCMIndexerFilterDataNodesAtPathWithDiff,InternalQCMIndexer.prototype.filterDataNodesAtPathPositions=internalQCMIndexerFilterDataNodesAtPathPositions,InternalQCMIndexer.prototype.getDataElements=internalQCMIndexerGetDataElements,InternalQCMIndexer.prototype.getDirectChildDataElements=internalQCMIndexerGetDirectChildDataElements,InternalQCMIndexer.prototype.getDirectChildDataElementsAsObj=internalQCMIndexerGetDirectChildDataElementsAsObj,InternalQCMIndexer.prototype.hasDirectChildDataElements=internalQCMIndexerHasDirectChildDataElements,InternalQCMIndexer.prototype.getAllDominatedDataElements=internalQCMIndexerGetAllDominatedDataElements,InternalQCMIndexer.prototype.getOperandDataElements=internalQCMIndexerGetOperandDataElements,InternalQCMIndexer.prototype.getAllDirectOperands=internalQCMIndexerGetAllDirectOperands,InternalQCMIndexer.prototype.getAllDirectOperandsFlat=internalQCMIndexerGetAllDirectOperandsFlat,InternalQCMIndexer.prototype.numOperandDataElements=internalQCMIndexerNumOperandDataElements,InternalQCMIndexer.prototype.isNonEmptyOperator=internalQCMIndexerIsNonEmptyOperator,InternalQCMIndexer.prototype.isOperand=internalQCMIndexerIsOperand,InternalQCMIndexer.prototype.isActive=internalQCMIndexerIsActive,InternalQCMIndexer.prototype.deactivateNode=internalQCMIndexerDeactivateNode,InternalQCMIndexer.prototype.activateNode=internalQCMIndexerActivateNode,InternalQCMIndexer.prototype.deactivateRangeNode=internalQCMIndexerDeactivateRangeNode,InternalQCMIndexer.prototype.activateRangeNode=internalQCMIndexerActivateRangeNode,InternalQCMIndexer.prototype.getChildPaths=internalQCMIndexerGetChildPaths,InternalQCMIndexer.prototype.pathHasOperands=internalQCMIndexerPathHasOperands,InternalQCMIndexer.prototype.pathHasDataElements=internalQCMIndexerPathHasDataElements,InternalQCMIndexer.prototype.raiseToOperator=internalQCMIndexerRaiseToOperator,InternalQCMIndexer.prototype.raiseElementsToDirectOperators=internalQCMIndexerRaiseElementsToDirectOperators,InternalQCMIndexer.prototype.raiseElementsToOperators=internalQCMIndexerRaiseElementsToOperators,InternalQCMIndexer.prototype.raiseToAllOperators=internalQCMIndexerRaiseToAllOperators,InternalQCMIndexer.prototype.raiseToPath=internalQCMIndexerRaiseToPath,InternalQCMIndexer.prototype.raiseAllToPath=internalQCMIndexerRaiseAllToPath,InternalQCMIndexer.prototype.getChildDataElements=internalQCMIndexerGetChildDataElements,InternalQCMIndexer.prototype.getDominatedNodes=internalQCMIndexerGetDominatedNodes,InternalQCMIndexer.prototype.getAllDirectChildren=internalQCMIndexerGetAllDirectChildren,InternalQCMIndexer.prototype.getAllDirectChildrenFlat=internalQCMIndexerGetAllDirectChildrenFlat,InternalQCMIndexer.prototype.getAllDirectChildrenNoDataElements=internalQCMIndexerGetAllDirectChildrenNoDataElements,InternalQCMIndexer.prototype.getAllDirectChildrenWithDataElements=internalQCMIndexerGetAllDirectChildrenWithDataElements,InternalQCMIndexer.prototype.hasLowerDataElements=internalQCMIndexerHasLowerDataElements,InternalQCMIndexer.prototype.lowerDataElementsTo=internalQCMIndexerLowerDataElementsTo,InternalQCMIndexer.prototype.getParentDataElement=internalQCMIndexerGetParentDataElement,InternalQCMIndexer.prototype.getDataElementPathId=internalQCMIndexerGetDataElementPathId,InternalQCMIndexer.prototype.filterDataElementsUnderPathId=internalQCMIndexerFilterDataElementsUnderPathId,InternalQCMIndexer.prototype.getPrevKey=internalQCMIndexerGetPrevKey,InternalQCMIndexer.prototype.getKnownKey=internalQCMIndexerGetKnownKey,InternalQCMIndexer.prototype.getNodeValues=internalQCMIndexerGetNodeValues,InternalQCMIndexer.prototype.getKnownNodeValues=internalQCMIndexerGetKnownNodeValues,InternalQCMIndexer.prototype.getNodeNonAttrs=internalQCMIndexerGetNodeNonAttrs,InternalQCMIndexer.prototype.updateEpilogForPathNode=internalQCMIndexerUpdateEpilogForPathNode,InternalQCMIndexer.prototype.subTreeUpdateEpilog=internalQCMIndexerSubTreeUpdateEpilog,InternalQCMIndexer.prototype.getMatchPoints=internalQCMIndexerGetMatchPoints,InternalQCMIndexer.prototype.notifyPathHasDataElements=internalQCMIndexerNotifyPathHasDataElements,InternalQCMIndexer.prototype.notifyPathHasNoDataElements=internalQCMIndexerNotifyPathHasNoDataElements,InternalQCMIndexer.prototype.removeMatchPointsNotifications=internalQCMIndexerRemoveMatchPointsNotifications,InternalQCMIndexer.prototype.setKeyValue=internalQCMIndexerSetKeyValue,InternalQCMIndexer.prototype.pushOnKeyUpdateQueue=internalQCMIndexerPushOnKeyUpdateQueue,InternalQCMIndexer.prototype.preservePreviousKey=internalQCMIndexerPreservePreviousKey,InternalQCMIndexer.prototype.getPrevKeyObj=internalQCMIndexerGetPrevKeyObj,InternalQCMIndexer.prototype.removeKeysOfRemovedNodes=internalQCMIndexerRemoveKeysOfRemovedNodes,InternalQCMIndexer.prototype.updateKeyOnNode=internalQCMIndexerUpdateKeyOnNode,InternalQCMIndexer.prototype.addKeyToNode=internalQCMIndexerAddKeyToNode,InternalQCMIndexer.prototype.removeKeyFromNode=internalQCMIndexerRemoveKeyFromNode,InternalQCMIndexer.prototype.setNodeAsRangeNode=internalQCMIndexerSetNodeAsRangeNode,InternalQCMIndexer.prototype.addOperandsToRange=internalQCMIndexerAddOperandsToRange,InternalQCMIndexer.prototype.addKeysToRangeNode=internalQCMIndexerAddKeysToRangeNode,InternalQCMIndexer.prototype.removeKeysFromRangeNode=internalQCMIndexerRemoveKeysFromRangeNode,InternalQCMIndexer.prototype.refreshRangeNodeAfterUpdate=internalQCMIndexerRefreshRangeNodeAfterUpdate,InternalQCMIndexer.prototype.updateHasAttrOnNode=internalQCMIndexerUpdateHasAttrOnNode,InternalQCMIndexer.prototype.updateNonAttrOnNode=internalQCMIndexerUpdateNonAttrOnNode,InternalQCMIndexer.prototype.hasAttrs=internalQCMIndexerHasAttrs,InternalQCMIndexer.prototype.updateQueryMatches=internalQCMIndexerUpdateQueryMatches,InternalQCMIndexer.prototype.forwardKeyUpdates=internalQCMIndexerForwardKeyUpdates,InternalQCMIndexer.prototype.hasRangeValues=internalQCMIndexerHasRangeValues,InternalQCMIndexer.prototype.getSubIndex=internalQCMIndexerGetSubIndex,InternalQCMIndexer.prototype.discreteSubIndexTypes=internalQCMIndexerDiscreteSubIndexTypes,InternalQCMIndexer.prototype.addToSubIndex=internalQCMIndexerAddToSubIndex,InternalQCMIndexer.prototype.removeFromSubIndex=internalQCMIndexerRemoveFromSubIndex,InternalQCMIndexer.prototype.updateQueryMatchList=internalQCMIndexerUpdateQueryMatchList,InternalQCMIndexer.prototype.addQueryCalcToPathNode=internalQCMIndexerAddQueryCalcToPathNode,InternalQCMIndexer.prototype.shouldIndexForQueryCalc=internalQCMIndexerShouldIndexForQueryCalc,InternalQCMIndexer.prototype.needKeyUpdateForQuery=internalQCMIndexerNeedKeyUpdateForQuery,InternalQCMIndexer.prototype.stopKeyUpdateForQuery=internalQCMIndexerStopKeyUpdateForQuery,InternalQCMIndexer.prototype.updateSimpleQuery=internalQCMIndexerUpdateSimpleQuery,InternalQCMIndexer.prototype.getSimpleQueryValueMatches=internalQCMIndexerGetSimpleQueryValueMatches,InternalQCMIndexer.prototype.getSimpleQueryQueuedUpdates=internalQCMIndexerGetSimpleQueryQueuedUpdates,InternalQCMIndexer.prototype.removeQueryCalcFromPathNode=internalQCMIndexerRemoveQueryCalcFromPathNode,InternalQCMIndexer.prototype.unregisterQuery=internalQCMIndexerUnregisterQuery,InternalQCMIndexer.prototype.unregisterQueryValue=internalQCMIndexerUnregisterQueryValue,InternalQCMIndexer.prototype.addMatchesToNoIndexQueries=internalQCMIndexerAddMatchesToNoIndexQueries,InternalQCMIndexer.prototype.filterNodesJustBeingAdded=internalQCMIndexerFilterNodesJustBeingAdded,InternalQCMIndexer.prototype.removeMatchesFromNoIndexQueries=internalQCMIndexerRemoveMatchesFromNoIndexQueries,InternalQCMIndexer.prototype.filterNodesJustBeingRemoved=internalQCMIndexerFilterNodesJustBeingRemoved,InternalQCMIndexer.prototype.getAllMatches=internalQCMIndexerGetAllMatches,InternalQCMIndexer.prototype.getAllMatchesAsObj=internalQCMIndexerGetAllMatchesAsObj,InternalQCMIndexer.prototype.pathHasAdditionsPending=internalQCMIndexerPathHasAdditionsPending,InternalQCMIndexer.prototype.pathHasRemovalsPending=internalQCMIndexerPathHasRemovalsPending,InternalQCMIndexer.prototype.isSubTreeRoot=internalQCMIndexerIsSubTreeRoot,InternalQCMIndexer.prototype.inSubTree=internalQCMIndexerInSubTree,InternalQCMIndexer.prototype.inSubTreeOnlyAsRoot=internalQCMIndexerInSubTreeOnlyAsRoot,InternalQCMIndexer.prototype.addToSubTreeRootUpdates=internalQCMIndexerAddToSubTreeRootUpdates,InternalQCMIndexer.prototype.addToSubTreeMonitorUpdates=internalQCMIndexerAddToSubTreeMonitorUpdates;var globalSubTreeMonitorId=0;InternalQCMIndexer.prototype.addSubTreeMonitor=internalQCMIndexerAddSubTreeMonitor,InternalQCMIndexer.prototype.removeSubTreeMonitor=internalQCMIndexerRemoveSubTreeMonitor,InternalQCMIndexer.prototype.registerCompressionOnNode=internalQCMIndexerRegisterCompressionOnNode,InternalQCMIndexer.prototype.registerCompressionOnNodes=internalQCMIndexerRegisterCompressionOnNodes,InternalQCMIndexer.prototype.unregisterCompressionOnNode=internalQCMIndexerUnregisterCompressionOnNode,InternalQCMIndexer.prototype.registerSubTreeRetrievalOnNode=internalQCMIndexerRegisterSubTreeRetrievalOnNode,InternalQCMIndexer.prototype.unregisterSubTreeRetrievalOnNode=internalQCMIndexerUnRegisterSubTreeRetrievalOnNode,InternalQCMIndexer.prototype.setNewNodeSubTreeRoots=internalQCMIndexerSetNewNodeSubTreeRoots,InternalQCMIndexer.prototype.extendSubTreesToChild=internalQCMIndexerExtendSubTreesToChild,InternalQCMIndexer.prototype.extendSubTreesToOperandChildren=internalQCMIndexerExtendSubTreesToOperandChildren,InternalQCMIndexer.prototype.addSubTreeRootsToChildren=internalQCMIndexerAddSubTreeRootsToChildren,InternalQCMIndexer.prototype.addSubTreeRootsToChild=internalQCMIndexerAddSubTreeRootsToChild,InternalQCMIndexer.prototype.addParentSubTreeRoots=internalQCMIndexerAddParentSubTreeRoots,InternalQCMIndexer.prototype.addParentSubTreeCount=internalQCMIndexerAddParentSubTreeCount,InternalQCMIndexer.prototype.increaseSubTreeModeCount=internalQCMIndexerIncreaseSubTreeModeCount,InternalQCMIndexer.prototype.activateSubTreeMonitoringOnPath=InternalQCMIndexerActivateSubTreeMonitoringOnPath,InternalQCMIndexer.prototype.removeSubTreeNode=internalQCMIndexerRemoveSubTreeNode,InternalQCMIndexer.prototype.removeFromSubTreeRoots=InternalQCMIndexerRemoveFromSubTreeRoots,InternalQCMIndexer.prototype.clearSubTrees=internalQCMIndexerClearSubTrees,InternalQCMIndexer.prototype.detachSubTreesFromChild=internalQCMIndexerDetachSubTreesFromChild,InternalQCMIndexer.prototype.removeSubTreeRootsFromChildren=internalQCMIndexerRemoveSubTreeRootsFromChildren,InternalQCMIndexer.prototype.removeSubTreeRootsFromChild=internalQCMIndexerRemoveSubTreeRootsFromChild,InternalQCMIndexer.prototype.removeParentSubTreeRoots=internalQCMIndexerRemoveParentSubTreeRoots,InternalQCMIndexer.prototype.removeParentSubTreeCount=internalQCMIndexerRemoveParentSubTreeCount,InternalQCMIndexer.prototype.decreaseSubTreeModeCount=internalQCMIndexerDecreaseSubTreeModeCount,InternalQCMIndexer.prototype.deactivateSubTreeMonitoringOnPath=InternalQCMIndexerDeactivateSubTreeMonitoringOnPath,InternalQCMIndexer.prototype.setTerminalValueOnSubTrees=internalQCMIndexerSetTerminalValueOnSubTrees,InternalQCMIndexer.prototype.setTerminalValueOnSubTree=internalQCMIndexerSetTerminalValueOnSubTree,InternalQCMIndexer.prototype.updateSubTrees=internalQCMIndexerUpdateSubTrees,InternalQCMIndexer.prototype.getCompression=internalQCMIndexerGetCompression,InternalQCMIndexer.prototype.getFullCompression=internalQCMIndexerGetFullCompression,InternalQCMIndexer.prototype.setFullCompression=internalQCMIndexerSetFullCompression,InternalQCMIndexer.prototype.unsetFullCompression=internalQCMIndexerUnsetFullCompression,InternalQCMIndexer.prototype.registerPathActiveNotifications=internalQCMIndexerRegisterPathActiveNotifications,InternalQCMIndexer.prototype.unregisterPathActiveNotifications=internalQCMIndexerUnregisterPathActiveNotifications,InternalQCMIndexer.prototype.notifyPathActivated=internalQCMIndexerNotifyPathActivated,InternalQCMIndexer.prototype.notifyPathDeactivated=internalQCMIndexerNotifyPathDeactivated,InternalQCMIndexer.prototype.debugGetDataUnder=internalQCMIndexerDebugGetDataUnder,InternalQCMIndexer.prototype.debugAddDataFromPathNode=internalQCMIndexerDebugAddDataFromPathNode,inherit(FuncResult,DebugTracing);var debugTracingFuncResult=!1;FuncResult.prototype.destroy=funcResultDestroy,FuncResult.prototype.getId=funcResultGetId,FuncResult.prototype.hasNonQueryActiveComposed=functionResultHasNonQueryActiveComposed,FuncResult.prototype.getNumComposedFuncs=functionResultGetNumComposedFuncs,FuncResult.prototype.getComposedSelectingNum=functionResultGetComposedSelectingNum,FuncResult.prototype.setData=funcResultSetData,FuncResult.prototype.aboutToSetData=funcResultAboutToSetData,FuncResult.prototype.addDataObjMatches=funcResultAddDataObjMatches,FuncResult.prototype.removeDataObjMatches=funcResultRemoveDataObjMatches,FuncResult.prototype.removeRestrictionsFromNoSelection=funcResultRemoveRestrictionsFromNoSelection,FuncResult.prototype.setTerminalData=funcResultSetTerminalData,FuncResult.prototype.addComposedFunc=funcResultAddComposedFunc,FuncResult.prototype.attachActiveComposedFunc=funcResultAttachActiveComposedFunc,FuncResult.prototype.completeActiveComposedFuncAddition=funcResultCompleteActiveComposedFuncAddition,FuncResult.prototype.addActiveComposedFunc=funcResultAddActiveComposedFunc,FuncResult.prototype.aboutToAttachActiveComposed=funcResultAboutToAttachActiveComposed,FuncResult.prototype.aboutToAddActiveComposed=funcResultAboutToAddActiveComposed,FuncResult.prototype.becameActiveStar=funcResultBecameActiveStar,FuncResult.prototype.removeComposedFunc=funcResultRemoveComposedFunc,FuncResult.prototype.detachActiveComposedFunc=funcResultDetachActiveComposedFunc,FuncResult.prototype.completeActiveComposedFuncRemoval=funcResultCompleteActiveComposedFuncRemoval,FuncResult.prototype.removeActiveComposedFunc=funcResultRemoveActiveComposedFunc,FuncResult.prototype.activeComposedFuncRemoved=funcResultActiveComposedFuncRemoved,FuncResult.prototype.activated=funcResultActivated,FuncResult.prototype.deactivated=funcResultDeactivated,FuncResult.prototype.updateComposedSelectingNum=functionResultUpdateComposedSelectingNum,FuncResult.prototype.completeComposedSelectingNumUpdate=functionResultCompleteComposedSelectingNumUpdate,FuncResult.prototype.isActiveStar=funcResultIsActiveStar,FuncResult.prototype.wasActiveStarBeforeRecomposition=funcResultWasActiveStarBeforeRecomposition,FuncResult.prototype.supportsMultiProj=funcResultSupportsMultiProj,FuncResult.prototype.isMatchTransparent=funcResultIsMatchTransparent,FuncResult.prototype.isTerminalResult=funcResultIsTerminalResult,FuncResult.prototype.getFirstResult=funcResultGetFirstResult,FuncResult.prototype.getDominatedProjMappings=funcResultGetDominatedProjMappings,FuncResult.prototype.getDominatedIdentification=funcResultGetDominatedIdentification,FuncResult.prototype.getDominatedComparison=funcResultGetDominatedComparison,FuncResult.prototype.getDifference=funcResultGetDifference,FuncResult.prototype.increaseMatchCount=funcResultIncreaseMatchCount,FuncResult.prototype.decreaseMatchCount=funcResultDecreaseMatchCount,FuncResult.prototype.isOrder=funcResultIsOrder,FuncResult.prototype.isOrderStar=funcResultIsOrderStar,FuncResult.prototype.getContentDataObj=funcResultGetContentDataObj,FuncResult.prototype.isContentDataObj=funcResultIsContentDataObj,FuncResult.prototype.addOrderStarFunc=funcResultAddOrderStarFunc,FuncResult.prototype.removeOrderStarFunc=funcResultRemoveOrderStarFunc,FuncResult.prototype.refreshOrdering=funcResultRefreshOrdering,FuncResult.prototype.forwardResultIndexerAddMatches=funcResultForwardResultIndexerAddMatches,FuncResult.prototype.forwardResultIndexerRemoveMatches=funcResultForwardResultIndexerRemoveMatches,FuncResult.prototype.debugPrintDesc=funcResultDebugPrintDesc,IdentityMonitor.prototype.destroy=identityMonitorDestroy,IdentityMonitor.prototype.replaceSource=identityMonitorReplaceSource,IdentityMonitor.prototype.requestIdentity=identityMonitorRequestIdentity,IdentityMonitor.prototype.releaseIdentity=identityMonitorReleaseIdentity,IdentityMonitor.prototype.releaseAllIdentities=identityMonitorReleaseAllIdentities,IdentityMonitor.prototype.updateKeys=identityMonitorUpdateKeys,IdentityMonitor.prototype.subTreeUpdate=identityMonitorSubTreeUpdate,inherit(IdentityResult,FuncResult);var debugAllIdentityResults=void 0,identityResultNextId=1025;IdentityResult.newId=function(){return identityResultNextId++},IdentityResult.prototype.destroy=identityResultDestroy,IdentityResult.prototype.isMatchTransparent=identityResultIsMatchTransparent,IdentityResult.prototype.getIdentificationId=identityResultGetIdentificationId,IdentityResult.prototype.getIdentifiedPathId=identityResultGetIdentifiedPathId,IdentityResult.prototype.isActive=identityResultIsActive,IdentityResult.prototype.setIdentifiedData=identityResultSetIdentifiedData,IdentityResult.prototype.setIdentificationData=identityResultSetIdentificationData,
IdentityResult.prototype.setData=identityResultSetData,IdentityResult.prototype.setTerminalData=identityResultSetTerminalData,IdentityResult.prototype.getContentDataObj=identityResultGetContentDataObj,IdentityResult.prototype.isContentDataObj=identityResultIsContentDataObj,IdentityResult.prototype.refreshIndexerAndPaths=identityResultRefreshIndexerAndPaths,IdentityResult.prototype.refreshIdentifiedIndexerAndPaths=identityResultRefreshIdentifiedIndexerAndPaths,IdentityResult.prototype.refreshIdentificationIndexerAndPaths=identityResultRefreshIdentificationIndexerAndPaths,IdentityResult.prototype.replaceIndexerAndPaths=identityResultReplaceIndexerAndPaths,IdentityResult.prototype.replaceIdentifiedIndexerAndPaths=identityResultReplaceIdentifiedIndexerAndPaths,IdentityResult.prototype.replaceIdentificationIndexerAndPaths=identityResultReplaceIdentificationIndexerAndPaths,IdentityResult.prototype.increaseMatchCount=identityResultIncreaseMatchCount,IdentityResult.prototype.decreaseMatchCount=identityResultDecreaseMatchCount,IdentityResult.prototype.addDataObjMatches=identityResultAddDataObjMatches,IdentityResult.prototype.removeDataObjMatches=identityResultRemoveDataObjMatches,IdentityResult.prototype.addMatches=identityResultAddMatches,IdentityResult.prototype.addMatchesWithoutRaising=identityResultAddMatchesWithoutRaising,IdentityResult.prototype.addMatchesWithRaising=identityResultAddMatchesWithRaising,IdentityResult.prototype.getIdentifiedId=identityResultGetIdentifiedId,IdentityResult.prototype.removeMatches=identityResultRemoveMatches,IdentityResult.prototype.removeAllMatches=identityResultRemoveAllMatches,IdentityResult.prototype.addProjMatches=identityResultAddProjMatches,IdentityResult.prototype.removeProjMatches=identityResultRemoveProjMatches,IdentityResult.prototype.getMonitoredElements=identityResultGetMonitoredElements,IdentityResult.prototype.filterMonitoredElements=identityResultFilterMonitoredElements,IdentityResult.prototype.updateKeys=identityResultUpdateKeys,IdentityResult.prototype.updateCompressedValues=identityResultUpdateCompressedValues,IdentityResult.prototype.getDominatedIndexer=identityResultGetDominatedIndexer,IdentityResult.prototype.getDominatedProjPathId=identityResultGetDominatedProjPathId,IdentityResult.prototype.getDominatedProjPathNum=identityResultGetDominatedProjPathNum,IdentityResult.prototype.getDominatedProjMappings=identityResultGetDominatedProjMappings,IdentityResult.prototype.getTerminalProjMatches=identityResultGetTerminalProjMatches,IdentityResult.prototype.filterTerminalProjMatches=identityResultFilterTerminalProjMatches,IdentityResult.prototype.getDomMatchCount=identityResultGetDomMatchCount,IdentityResult.prototype.getDominatedMatches=identityResultGetDominatedMatches,IdentityResult.prototype.getDominatedMatchesAsObj=identityResultGetDominatedMatchesAsObj,IdentityResult.prototype.filterDominatedMatches=identityResultFilterDominatedMatches,IdentityResult.prototype.filterDominatedMatchPositions=identityResultFilterDominatedMatchPositions,IdentityResult.prototype.getDominatedIdentification=identityResultGetDominatedIdentification,IdentityResult.prototype.getDominatedComparison=identityResultGetDominatedComparison,IdentityResult.prototype.isSelection=identityResultIsSelection,IdentityResult.prototype.removeAllIndexerMatches=identityResultRemoveAllIndexerMatches,IdentityResult.prototype.setMatchPoints=identityResultSetMatchPoints,IdentityResult.prototype.addToMatchPoints=identityResultAddToMatchPoints,IdentityResult.prototype.removeFromMatchPoints=identityResultRemoveFromMatchPoints,IdentityResult.prototype.calcNeedToRaiseMatches=identityResultCalcNeedToRaiseMatches,inherit(IdentityIndexer,InternalQCMIndexer),IdentityIndexer.prototype.destroy=identityIndexerDestroy,IdentityIndexer.prototype.pathNodeActivated=identityIndexerPathNodeActivated,IdentityIndexer.prototype.pathNodeDeactivated=identityIndexerPathNodeDeactivated,IdentityIndexer.prototype.getIdentity=identityIndexerGetIdentity,IdentityIndexer.prototype.getIdentities=identityIndexerGetIdentities,IdentityIndexer.prototype.getBaseIdentity=identityIndexerGetBaseIdentity,IdentityIndexer.prototype.getAdditionalIdentity=identityIndexerGetAdditionalIdentity,IdentityIndexer.prototype.getAllIdentities=identityIndexerGetAllIdentities,IdentityIndexer.prototype.assignDefaultBaseIdentity=identityIndexerAssignDefaultBaseIdentity,IdentityIndexer.prototype.setBaseIdentityForExistingNode=identityIndexerSetBaseIdentityForExistingNode,IdentityIndexer.prototype.scheduleIdentityUpdate=identityIndexerScheduleIdentityUpdate,IdentityIndexer.prototype.notifyBaseIdentities=identityIndexerNotifyBaseIdentities,IdentityIndexer.prototype.createDefaultAdditionalNotifications=identityIndexerCreateDefaultAdditionalNotifications,IdentityIndexer.prototype.notifyOfAddedIdentities=identityIndexerNotifyOfAddedIdentities,IdentityIndexer.prototype.queueRemoveAllIdentities=identityIndexerQueueRemoveAllIdentities,IdentityIndexer.prototype.notifyRemoveAllIdentities=identityIndexerNotifyRemoveAllIdentities,IdentityIndexer.prototype.updatePendingIdentities=identityIndexerUpdatePendingIdentities,IdentityIndexer.prototype.registerIdentification=identityIndexerRegisterIdentification,IdentityIndexer.prototype.unregisterIdentification=identityIndexerUnregisterIdentification,IdentityIndexer.prototype.requestIdentification=identityIndexerRequestIdentification,IdentityIndexer.prototype.releaseIdentification=identityIndexerReleaseIdentification,IdentityIndexer.prototype.hasIdentificationRequests=identityIndexerHasIdentificationRequests,IdentityIndexer.prototype.getIdentifiedPathId=identityIndexerGetIdentifiedPathId,IdentityIndexer.prototype.notificationRequired=identityIndexerNotificationRequired,IdentityIndexer.prototype.addMappedIdentification=identityIndexerAddMappedIdentification,IdentityIndexer.prototype.removeMappedIdentification=identityIndexerRemoveMappedIdentification,IdentityIndexer.prototype.addTracingIdentification=identityIndexerAddTracingIdentification,IdentityIndexer.prototype.addTracingIdentificationToPath=identityIndexerAddTracingIdentificationToPath,IdentityIndexer.prototype.removeTracingIdentification=identityIndexerRemoveTracingIdentification,IdentityIndexer.prototype.removeTracingIdentificationFromPath=identityIndexerRemoveTracingIdentificationFromPath,IdentityIndexer.prototype.addMonitoringIdentification=identityIndexerAddMonitoringIdentification,IdentityIndexer.prototype.addMonitoringIdentificationToPath=identityIndexerAddMonitoringIdentificationToPath,IdentityIndexer.prototype.removeMonitoringIdentification=identityIndexerRemoveMonitoringIdentification,IdentityIndexer.prototype.removeMonitoringIdentificationFromPath=identityIndexerRemoveMonitoringIdentificationFromPath,IdentityIndexer.prototype.initMappedIdentifications=identityIndexerInitMappedIdentifications,IdentityIndexer.prototype.addIdentities=identityIndexerAddIdentities,IdentityIndexer.prototype.removeIdentities=identityIndexerRemoveIdentities,IdentityIndexer.prototype.removeAllIdentities=identityIndexerRemoveAllIdentities,IdentityIndexer.prototype.createPathNode=identityIndexerCreatePathNode,inherit(ResultToMerge,FuncResult),ResultToMerge.prototype.destroy=resultToMergeDestroy,ResultToMerge.prototype.supportsMultiProj=resultToMergeSupportsMultiProj,ResultToMerge.prototype.isActive=resultToMergeIsActive,ResultToMerge.prototype.refreshIndexerAndPaths=resultToMergeRefreshIndexerAndPaths,ResultToMerge.prototype.replaceIndexerAndPaths=resultToMergeReplaceIndexerAndPaths,ResultToMerge.prototype.refreshProjMappings=resultToMergeRefreshProjMappings,ResultToMerge.prototype.prefixMinTargetPath=resultToMergePrefixMinTargetPath,ResultToMerge.prototype.removeMapping=resultToMergeRemoveMapping,ResultToMerge.prototype.removeProjMappingArray=resultToMergeRemoveProjMappingArray,ResultToMerge.prototype.addDataObjMatches=resultToMergeAddDataObjMatches,ResultToMerge.prototype.removeDataObjMatches=resultToMergeRemoveDataObjMatches,ResultToMerge.prototype.addMatches=resultToMergeAddMatches,ResultToMerge.prototype.removeMatches=resultToMergeRemoveMatches,ResultToMerge.prototype.removeAllMatches=resultToMergeRemoveAllMatches,ResultToMerge.prototype.addProjMatches=resultToMergeAddProjMatches,ResultToMerge.prototype.removeProjMatches=resultToMergeRemoveProjMatches,ResultToMerge.prototype.getTerminalProjMatches=resultToMergeGetTerminalProjMatches,ResultToMerge.prototype.filterTerminalProjMatches=resultToMergeFilterTerminalProjMatches,ResultToMerge.prototype.pathActivated=resultToMergePathActivated,ResultToMerge.prototype.activated=resultToMergeActivated,ResultToMerge.prototype.pathDeactivated=resultToMergePathDeactivated,ResultToMerge.prototype.deactivated=resultToMergeDeactivated,SourceNodes.prototype.hasNode=sourceNodesHasNode,SourceNodes.prototype.getCount=sourceNodesGetCount,SourceNodes.prototype.numNodes=sourceNodesNumNodes,SourceNodes.prototype.incNode=sourceNodesIncNode,SourceNodes.prototype.decNode=sourceNodesDecNode,SourceNodes.prototype.clear=sourceNodesClear,SourceNodes.prototype.getAllSourceNodes=sourceNodesGetAllSourceNodes,SourceNodes.prototype.filterSourceNodes=sourceNodesFilterSourceNodes,IdentitySourceNodes.prototype.getSourceIdentity=identitySourceNodesGetSourceIdentity,IdentitySourceNodes.prototype.assignDataElementId=identitySourceNodesAssignDataElementId,IdentitySourceNodes.prototype.incNode=identitySourceNodesIncNode,IdentitySourceNodes.prototype.decNode=identitySourceNodesDecNode,IdentitySourceNodes.prototype.incRaised=identitySourceNodesIncRaised,IdentitySourceNodes.prototype.decRaised=identitySourceNodesDecRaised,IdentitySourceNodes.prototype.getRaisedCount=identitySourceNodesGetRaisedCount,IdentitySourceNodes.prototype.numRaised=identitySourceNodesNumRaised,IdentitySourceNodes.prototype.clear=identitySourceNodesClear,IdentitySourceNodes.prototype.getAllSourceNodes=identitySourceNodesGetAllSourceNodes,IdentitySourceNodes.prototype.getIdentityNodeId=identitySourceNodesGetIdentityNodeId,IdentitySourceNodes.prototype.getIdNodeIdentity=identitySourceNodesGetIdNodeIdentity,IdentitySourceNodes.prototype.getIdNodeIdentities=identitySourceNodesGetIdNodeIdentities,IdentitySourceNodes.prototype.replaceSourceIdentification=identitySourceNodesReplaceSourceIdentification,IdentitySourceNodes.prototype.updateIdentity=identitySourceNodesUpdateIdentity,DominatedIdentitySourceNodes.prototype.getSourceIdentity=dominatedIdentitySourceNodesGetSourceIdentity,DominatedIdentitySourceNodes.prototype.assignDataElementId=dominatedIdentitySourceNodesAssignDataElementId,DominatedIdentitySourceNodes.prototype.incNode=dominatedIdentitySourceNodesIncNode,DominatedIdentitySourceNodes.prototype.incNodeWithParent=dominatedIdentitySourceNodesIncNodeWithParent,DominatedIdentitySourceNodes.prototype.decNode=dominatedIdentitySourceNodesDecNode,DominatedIdentitySourceNodes.prototype.decNodeWithParent=dominatedIdentitySourceNodesDecNodeWithParent,DominatedIdentitySourceNodes.prototype.incRaised=dominatedIdentitySourceNodesIncRaised,DominatedIdentitySourceNodes.prototype.decRaised=dominatedIdentitySourceNodesDecRaised,DominatedIdentitySourceNodes.prototype.getRaisedCount=dominatedIdentitySourceNodesGetRaisedCount,DominatedIdentitySourceNodes.prototype.numRaised=dominatedIdentitySourceNodesNumRaised,DominatedIdentitySourceNodes.prototype.incParent=dominatedIdentitySourceNodesIncParent,DominatedIdentitySourceNodes.prototype.decParent=dominatedIdentitySourceNodesDecParent,DominatedIdentitySourceNodes.prototype.getParentCount=dominatedIdentitySourceNodesGetParentCount,DominatedIdentitySourceNodes.prototype.numParents=dominatedIdentitySourceNodesNumParents,DominatedIdentitySourceNodes.prototype.clear=dominatedIdentitySourceNodesClear,DominatedIdentitySourceNodes.prototype.replaceSourceIdentification=dominatedIdentitySourceNodesReplaceSourceIdentification,DominatedIdentitySourceNodes.prototype.getAllSourceNodes=dominatedIdentitySourceNodesGetAllSourceNodes,DominatedIdentitySourceNodes.prototype.getIdentityNodeId=dominatedIdentitySourceNodesGetIdentityNodeId,DominatedIdentitySourceNodes.prototype.getIdNodeIdentity=dominatedIdentitySourceNodesGetIdNodeIdentity,DominatedIdentitySourceNodes.prototype.getParentIdentity=dominatedIdentitySourceNodesGetParentIdentity,DominatedIdentitySourceNodes.prototype.updateIdentity=dominatedIdentitySourceNodesUpdateIdentity,DominatedIdentitySourceNodes.prototype.updateParentIdentity=dominatedIdentitySourceNodesUpdateParentIdentity,MappedDataElements.prototype.isEmpty=mappedDataElementsIsEmpty,MappedDataElements.prototype.assignPathPos=mappedDataElementsAssignPathPos,MappedDataElements.prototype.addTargetId=mappedDataElementsAddTargetId,MappedDataElements.prototype.removeTargetId=mappedDataElementsRemoveTargetId,MappedDataElements.prototype.getTargetIdsAtPath=mappedDataElementsGetTargetIdsAtPath,MappedDataElements.prototype.getAllTargetIdsAtPath=mappedDataElementsGetAllTargetIdsAtPath,MappedDataElements.prototype.getTargetId=mappedDataElementsGetTargetId,MappedDataElements.prototype.getAllocatedTargetIds=mappedDataElementsGetAllocatedTargetIds,CompCalc.prototype.destroy=compCalcDestroy,CompCalc.prototype.getId=compCalcGetId,CompCalc.prototype.getQCMKey=compCalcGetQCMKey,CompCalc.prototype.addCompResult=compCalcAddCompResult,CompCalc.prototype.removeCompResult=compCalcRemoveCompResult,CompCalc.prototype.refreshOrdering=compCalcRefreshOrdering,CompCalc.prototype.isActive=compCalcIsActive,CompCalc.prototype.resultActivated=compCalcResultActivated,CompCalc.prototype.resultDeactivated=compCalcResultDeactivated,CompCalc.prototype.activated=compCalcActivated,CompCalc.prototype.deactivated=compCalcDeactivated,CompCalc.prototype.needToSuspendOrderingUponAddition=compCalcNeedToSuspendOrderingUponAddition,CompCalcKeys.prototype.noSeqKeys=compCalcKeysNoSeqKeys,CompCalcKeys.prototype.getKey=compCalcKeysGetKey,CompCalcKeys.prototype.getCompKey=compCalcKeysGetCompKey,CompCalcKeys.prototype.expectAdditionalNum=compCalcKeysExpectAdditionalNum,CompCalcKeys.prototype.addKey=compCalcKeysAddKey,CompCalcKeys.prototype.removeKey=compCalcKeysRemoveKey,CompCalcKeys.prototype.removeAllKeysEqualTo=compCalcKeysRemoveAllKeysEqualTo,CompCalcKeys.prototype.removeAllMatchingKeys=compCalcKeysRemoveAllMatchingKeys,CompCalcKeys.prototype.clear=compCalcKeysClear,CompCalcKeys.prototype.clearKeysById=compCalcKeysClearKeysById,CompCalcKeys.prototype.clearKeysByRefList=compCalcKeysClearKeysByRefList,CompCalcKeys.prototype.translateKeys=compCalcKeysTranslateKeys,CompCalcKeys.prototype.translateAltKeys=compCalcKeysTranslateAltKeys,CompCalcKeys.prototype.setUseMinKey=compCalcKeysSetUseMinKey,inherit(CompCalcSeqKeys,CompCalcKeys),CompCalcSeqKeys.prototype.noSeqKeys=compCalcSeqKeysNoSeqKeys,CompCalcSeqKeys.prototype.setSeqCompare=compCalcSeqKeysSetSeqCompare,CompCalcSeqKeys.prototype.getCompKey=compCalcSeqKeysGetCompKey,CompCalcSeqKeys.prototype.addSeqKey=compCalcSeqKeysAddSeqKey;CompCalcSeqKeys.prototype.removeSeqKey=compCalcSeqKeysRemoveSeqKey;CompCalcSeqKeys.prototype.convertToSeqKeys=compCalcSeqKeysConvertToSeqKeys,CompValueQueryCalc.prototype.isSelection=compValueQueryCalcIsSelection,CompValueQueryCalc.prototype.destroy=compValueQueryCalcDestroy,CompValueQueryCalc.prototype.getId=compValueQueryCalcGetId,CompValueQueryCalc.prototype.needToRaiseMatches=compValueQueryCalcNeedToRaiseMatches,CompValueQueryCalc.prototype.setNeedKeyUpdates=compValueQueryCalcSetNeedKeyUpdates,CompValueQueryCalc.prototype.addResultId=compValueQueryCalcAddResultId,CompValueQueryCalc.prototype.removeResultId=compValueQueryCalcRemoveResultId,CompValueQueryCalc.prototype.getResultIds=compValueQueryCalcGetResultIds,CompValueQueryCalc.prototype.setMatchPoints=compValueQueryCalcSetMatchPoints,CompValueQueryCalc.prototype.addToMatchPoints=compValueQueryCalcAddToMatchPoints,CompValueQueryCalc.prototype.removeFromMatchPoints=compValueQueryCalcRemoveFromMatchPoints,CompValueQueryCalc.prototype.addMatches=compValueQueryCalcAddMatches,CompValueQueryCalc.prototype.getAllMatches=compValueQueryCalcGetAllMatches,CompValueQueryCalc.prototype.removeMatches=compValueQueryCalcRemoveMatches,CompValueQueryCalc.prototype.removeAllIndexerMatches=compValueQueryCalcRemoveAllIndexerMatches,CompValueQueryCalc.prototype.updateKeys=compValueQueryCalcUpdateKeys,CompValueQueryCalc.prototype.getProjKey=compValueQueryCalcGetProjKey,CompValueQueryCalc.prototype.getKnownKey=compValueQueryCalcGetKnownKey,inherit(PartitionCompResult,FuncResult),PartitionCompResult.prototype.destroy=partitionCompResultDestroy,PartitionCompResult.prototype.setDataResult=partitionCompResultSetDataResult,PartitionCompResult.prototype.addQueryResult=partitionCompResultAddQueryResult,PartitionCompResult.prototype.removeQueryResult=partitionCompResultRemoveQueryResult,PartitionCompResult.prototype.supportsMultiProj=partitionCompResultSupportsMultiProj,PartitionCompResult.prototype.isActive=partitionCompResultIsActive,PartitionCompResult.prototype.activated=partitionCompResultActivated,PartitionCompResult.prototype.deactivated=partitionCompResultDeactivated,PartitionCompResult.prototype.refreshIndexerAndPaths=partitionCompResultRefreshIndexerAndPaths,PartitionCompResult.prototype.replaceIndexerAndPaths=partitionCompResultReplaceIndexerAndPaths,PartitionCompResult.prototype.aboutToSetData=partitionCompResultAboutToSetData,PartitionCompResult.prototype.removeDataObjMatches=partitionCompResultRemoveDataObjMatches,PartitionCompResult.prototype.addDataObjMatches=partitionCompResultAddDataObjMatches,PartitionCompResult.prototype.addMatches=partitionCompResultAddMatches,PartitionCompResult.prototype.removeMatches=partitionCompResultRemoveMatches,PartitionCompResult.prototype.removeAllMatches=partitionCompResultRemoveAllMatches,PartitionCompResult.prototype.addProjMatches=partitionCompResultAddProjMatches,PartitionCompResult.prototype.removeProjMatches=partitionCompResultRemoveProjMatches,inherit(PartitionCompCalc,CompCalc),PartitionCompCalc.prototype.destroy=partitionCompCalcDestroy,PartitionCompCalc.prototype.numPartitions=partitionCompCalcNumPartitions,PartitionCompCalc.prototype.needToSuspendOrderingUponAddition=partitionCompCalcNeedToSuspendOrderingUponAddition,PartitionCompCalc.prototype.activated=partitionCompCalcActivated,PartitionCompCalc.prototype.deactivated=partitionCompCalcDeactivated,PartitionCompCalc.prototype.updateQueryData=partitionCompCalcUpdateQueryData,PartitionCompCalc.prototype.updatePartition=partitionCompCalcUpdatePartition,PartitionCompCalc.prototype.addQueryResult=partitionCompCalcAddQueryResult,PartitionCompCalc.prototype.removeQueryResult=partitionCompCalcRemoveQueryResult,PartitionCompCalc.prototype.updateValueQueryCalc=partitionCompCalcUpdateValueQueryCalc,PartitionCompCalc.prototype.replaceValueQueryCalc=partitionCompCalcReplaceValueQueryCalc,PartitionCompCalc.prototype.updateFirstKeyAfterPartitionUpdate=partitionCompCalcUpdateFirstKeyAfterPartitionUpdate,PartitionCompCalc.prototype.secondKeySeqAscending=partitionCompCalcSecondKeySeqAscending,PartitionCompCalc.prototype.secondKeySeqDescending=partitionCompCalcSecondKeySeqDescending,PartitionCompCalc.prototype.updateSecondKeyAfterPartitionUpdate=partitionCompCalcUpdateSecondKeyAfterPartitionUpdate,PartitionCompCalc.prototype.refreshProjectedKeyPath=partitionCompCalcRefreshProjectedKeyPath,PartitionCompCalc.prototype.addMatches=partitionCompCalcAddMatches,PartitionCompCalc.prototype.removeMatches=partitionCompCalcRemoveMatches,PartitionCompCalc.prototype.removeAllMatches=partitionCompCalcRemoveAllMatches,PartitionCompCalc.prototype.addProjMatches=partitionCompCalcAddProjMatches,PartitionCompCalc.prototype.removeProjMatches=partitionCompCalcRemoveProjMatches,PartitionCompCalc.prototype.updateKeys=partitionCompCalcUpdateKeys,PartitionCompCalc.prototype.addProjPathMatches=partitionCompCalcAddProjPathMatches,PartitionCompCalc.prototype.removeProjPathMatches=partitionCompCalcRemoveProjPathMatches,PartitionCompCalc.prototype.removeQueuedProjPathMatches=partitionCompCalcRemoveQueuedProjPathMatches,PartitionCompCalc.prototype.queueRemovedElements=partitionCompCalcQueueRemovedElements,PartitionCompCalc.prototype.removeAddedFromQueuedRemoved=partitionCompCalcRemoveAddedFromQueuedRemoved,PartitionCompCalc.prototype.applyQueuedRemovals=partitionCompCalcApplyQueuedRemovals,PartitionCompCalc.prototype.addMatchesByResultId=partitionCompCalcAddMatchesByResultId,PartitionCompCalc.prototype.addSecondKeyOfMatches=partitionCompCalcAddSecondKeyOfMatches,PartitionCompCalc.prototype.addSecondKey=partitionCompCalcAddSecondKey,PartitionCompCalc.prototype.convertSecondKey=partitionCompCalcConvertSecondKey,PartitionCompCalc.prototype.removeMatchesByResultId=partitionCompCalcRemoveMatchesByResultId,PartitionCompCalc.prototype.removeSecondKey=partitionCompCalcRemoveSecondKey,PartitionCompCalc.prototype.updatePartitionKey=partitionCompCalcUpdatePartitionKey,PartitionCompCalc.prototype.getCompareFunc=partitionCompCalcGetCompareFunc,PartitionCompCalc.prototype.getRaisingFunc=partitionCompCalcGetRaisingFunc,Comparison.prototype.destroy=comparisonDestroy,Comparison.prototype.getId=comparisonGetId,Comparison.prototype.allocate=comparisonAllocate,Comparison.prototype.release=comparisonRelease,Comparison.prototype.newCompCalc=comparisonNewCompCalc,Comparison.prototype.addCompCalc=comparisonAddCompCalc,Comparison.prototype.removeCompCalc=comparisonRemoveCompCalc,inherit(PartitionComparison,Comparison),PartitionComparison.prototype.destroy=partitionComparisonDestroy,PartitionComparison.prototype.setPartition=partitionComparisonSetPartition,PartitionComparison.prototype.newCompCalc=partitionComparisonNewCompCalc,PartitionComparison.prototype.addCompCalc=partitionComparisonAddCompCalc,PartitionComparison.prototype.removeCompCalc=partitionComparisonRemoveCompCalc,PartitionComparison.prototype.getGapPos=partitionComparisonGetGapPos,PartitionComparison.prototype.getQueries=partitionComparisonGetQueries,inherit(CompResult,FuncResult);var debugAllCompResults=void 0;CompResult.prototype.destroy=compResultDestroy,CompResult.prototype.isMatchTransparent=compResultIsMatchTransparent,CompResult.prototype.setComparison=compResultSetComparison,CompResult.prototype.resetCompCalc=compResultResetCompCalc,CompResult.prototype.compCalcRefreshed=compResultCompCalcRefreshed,CompResult.prototype.comparisonActivated=compResultComparisonActivated,CompResult.prototype.comparisonDeactivated=compResultComparisonDeactivated,CompResult.prototype.isActive=compResultIsActive,CompResult.prototype.refreshIndexerAndPaths=compResultRefreshIndexerAndPaths,CompResult.prototype.replaceIndexerAndPaths=compResultReplaceIndexerAndPaths,CompResult.prototype.increaseMatchCount=compResultIncreaseMatchCount,CompResult.prototype.decreaseMatchCount=compResultDecreaseMatchCount,CompResult.prototype.addDataObjMatches=compResultAddDataObjMatches,CompResult.prototype.removeDataObjMatches=compResultRemoveDataObjMatches,CompResult.prototype.addMatches=compResultAddMatches,CompResult.prototype.removeMatches=compResultRemoveMatches,CompResult.prototype.removeAllMatches=compResultRemoveAllMatches,CompResult.prototype.addProjMatches=compResultAddProjMatches,CompResult.prototype.removeProjMatches=compResultRemoveProjMatches,CompResult.prototype.getDominatedIndexer=compResultGetDominatedIndexer,CompResult.prototype.getDominatedProjPathId=compResultGetDominatedProjPathId,CompResult.prototype.getDominatedProjPathNum=compResultGetDominatedProjPathNum,CompResult.prototype.getDominatedProjMappings=compResultGetDominatedProjMappings,CompResult.prototype.getTerminalProjMatches=compResultGetTerminalProjMatches,CompResult.prototype.filterTerminalProjMatches=compResultFilterTerminalProjMatches,CompResult.prototype.getDomMatchCount=compResultGetDomMatchCount,CompResult.prototype.getDominatedMatches=compResultGetDominatedMatches,CompResult.prototype.getDominatedMatchesAsObj=compResultGetDominatedMatchesAsObj,CompResult.prototype.filterDominatedMatches=compResultFilterDominatedMatches,CompResult.prototype.filterDominatedMatchPositions=compResultFilterDominatedMatchPositions,CompResult.prototype.getDominatedIdentification=compResultGetDominatedIdentification,CompResult.prototype.getDominatedComparison=compResultGetDominatedComparison,CompInfo.prototype.setNeedToRaise=compInfoSetNeedToRaise,CompInfo.prototype.unshiftTranslation=compInfoUnshiftTranslation,CompInfo.prototype.getCompareFunc=compInfoGetCompareFunc,MergeGroup.nextGroupId=1025,MergeGroup.makeGroupDesc=mergeGroupMakeGroupDesc,MergeGroup.prototype.initGroup=mergeGroupInitGroup,MergeGroup.prototype.destroy=mergeGroupDestroy,MergeGroup.prototype.changeGroupSource=mergeGroupChangeGroupSource,MergeGroup.prototype.getMaxGroups=mergeGroupGetMaxGroups,MergeGroup.prototype.getSingleProj=mergeGroupGetSingleProj,MergeGroup.prototype.isDominated=mergeGroupIsDominated,MergeGroup.prototype.hasIdentityPrefixGroup=mergeGroupHasIdentityPrefixGroup,MergeGroup.prototype.addMapping=mergeGroupAddMapping,MergeGroup.prototype.removeMapping=mergeGroupRemoveMapping,MergeGroup.prototype.addMappingGroupToPath=mergeGroupAddMappingGroupToPath,MergeGroup.prototype.addGroupToTracingExtensionChildPaths=mergeGroupAddGroupToTracingExtensionChildPaths,MergeGroup.prototype.replaceMappingQueryCalcSource=mergeGroupReplaceMappingQueryCalcSource,MergeGroup.prototype.removeMappingGroupFromPath=mergeGroupRemoveMappingGroupFromPath,MergeGroup.prototype.removeGroupFromExtensionChildPaths=mergeGroupRemoveGroupFromExtensionChildPaths,MergeGroup.prototype.getSourceIdentity=mergeGroupGetSourceIdentity,MergeGroup.prototype.getSourceIdentities=mergeGroupGetSourceIdentities,MergeGroup.prototype.getIdentitiesOfSourceDataElements=mergeGroupGetIdentitiesOfSourceDataElements,MergeGroup.prototype.getSourceKeysByIdentity=mergeGroupGetSourceKeysByIdentity,MergeGroup.prototype.getSourceValues=mergeGroupGetSourceValues,MergeGroup.prototype.getSourceNonAttrs=mergeGroupGetSourceNonAttrs,MergeGroup.prototype.hasSourceDataElements=mergeGroupHasSourceDataElements,MergeGroup.prototype.hasSourceOperands=mergeGroupHasSourceOperands,MergeGroup.prototype.getSourcePathId=mergeGroupGetSourcePathId,MergeGroup.prototype.getSourceChildPaths=mergeGroupGetSourceChildPaths,MergeGroup.prototype.getSourceChildren=mergeGroupGetSourceChildren,MergeGroup.prototype.getAllSourceNodes=mergeGroupGetAllSourceNodes,MergeGroup.prototype.getSourceNodesDominatedBy=mergeGroupGetSourceNodesDominatedBy,MergeGroup.prototype.getMaxSourceNodes=mergeGroupGetMaxSourceNodes,MergeGroup.prototype.filterOutOperators=mergeGroupFilterOutOperators,MergeGroup.prototype.filterDominatedByProj=mergeGroupFilterDominatedByProj,MergeGroup.prototype.sourcePathHasOperands=mergeGroupSourcePathHasOperands,MergeGroup.prototype.getAllDominatingOperators=mergeGroupGetAllDominatingOperators,MergeGroup.prototype.getDirectDominatingOperators=mergeGroupGetDirectDominatingOperators,MergeGroup.prototype.getDominatingSourceNodes=mergeGroupGetDominatingSourceNodes,MergeGroup.prototype.getRefCount=mergeGroupGetRefCount,MergeGroup.prototype.getIdGroupRefCount=mergeGroupGetIdGroupRefCount,MergeGroup.prototype.raiseToGroup=mergeGroupRaiseToGroup,MergeGroup.prototype.addSourceElements=mergeGroupAddSourceElements,MergeGroup.prototype.addIdentityElements=mergeGroupAddIdentityElements,MergeGroup.prototype.addSourceElementsToMax=mergeGroupAddSourceElementsToMax,MergeGroup.prototype.addSourceElementsAtRootTarget=mergeGroupAddSourceElementsAtRootTarget,MergeGroup.prototype.addSourceParents=mergeGroupAddSourceParents,MergeGroup.prototype.incOperatorRefCount=mergeGroupIncOperatorRefCount,MergeGroup.prototype.refCountExistingProjMatches=mergeGroupRefCountExistingProjMatches,MergeGroup.prototype.clearRefCountOfRemainingProjMatches=mergeGroupClearRefCountOfRemainingProjMatches,MergeGroup.prototype.getSourceElements=mergeGroupGetSourceElements,MergeGroup.prototype.removeSourceElements=mergeGroupRemoveSourceElements,MergeGroup.prototype.removeIdentityElements=mergeGroupRemoveIdentityElements,MergeGroup.prototype.removeSourceElementsFromMax=mergeGroupRemoveSourceElementsFromMax,MergeGroup.prototype.decOperatorRefCount=mergeGroupDecOperatorRefCount,MergeGroup.prototype.removeSourceParents=mergeGroupRemoveSourceParents,MergeGroup.prototype.clearAllSourceElements=mergeGroupClearAllSourceElements,MergeGroup.prototype.addToIdentifiedChildren=mergeGroupAddToIdentifiedChildren,MergeGroup.prototype.removeFromIdentifiedChildren=mergeGroupRemoveFromIdentifiedChildren,MergeGroup.prototype.getParentIdentity=mergeGroupGetParentIdentity,MergeGroup.prototype.updateIdentity=mergeGroupUpdateIdentity,MergeGroup.prototype.getSourceNodesOfIdentities=mergeGroupGetSourceNodesOfIdentities,MergeGroup.prototype.getDominatedComparison=mergeGroupGetDominatedComparison,MergeGroup.prototype.addOrderStarFunc=mergeGroupAddOrderStarFunc,MergeGroup.prototype.removeOrderStarFunc=mergeGroupRemoveOrderStarFunc,MergeGroup.prototype.addAllOrderStarFuncsFromPath=mergeGroupAddAllOrderStarFuncsFromPath,MergeGroup.prototype.removeAllOrderStarFuncsFromPath=mergeGroupRemoveAllOrderStarFuncsFromPath,MergeGroup.prototype.hasSourceIdTranslation=mergeGroupHasSourceIdTranslation,MergeGroup.prototype.getAllTargetIdsAtPath=mergeGroupGetAllTargetIdsAtPath,MergeGroup.prototype.getTargetId=mergeGroupGetTargetId,MergeGroup.prototype.translateSourceIds=mergeGroupTranslateSourceIds,inherit(MergeGroupCompInfo,CompInfo),MergeGroupCompInfo.prototype.getCompareFunc=mergeGroupCompInfoGetCompareFunc,MappingQueryCalc.prototype.isExtensionPath=mappingQueryCalcIsExplicitPath,MappingQueryCalc.prototype.destroy=mappingQueryCalcDestroy,MappingQueryCalc.prototype.getId=mappingQueryCalcGetId,MappingQueryCalc.prototype.getSourcePathId=mappingQueryCalcGetSourcePathId,MappingQueryCalc.prototype.isSelection=mappingQueryCalcIsSelection,MappingQueryCalc.prototype.addMatches=mappingQueryCalcAddMatches,MappingQueryCalc.prototype.removeMatches=mappingQueryCalcRemoveMatches,MappingQueryCalc.prototype.removeAllIndexerMatches=mappingQueryCalcRemoveAllIndexerMatches,MappingQueryCalc.prototype.updateKeys=mappingQueryCalcUpdateKeys,MappingQueryCalc.prototype.setMatchPoints=mappingQueryCalcSetMatchPoints,MappingQueryCalc.prototype.addToMatchPoints=mappingQueryCalcAddToMatchPoints,MappingQueryCalc.prototype.removeFromMatchPoints=mappingQueryCalcRemoveFromMatchPoints,MappingQueryCalc.prototype.addPathNodeDependencies=mappingQueryCalcAddPathNodeDependencies,MappingQueryCalc.prototype.queueRemovalOfPathNodeDependency=mappingQueryCalcQueueRemovalOfPathNodeDependency,MappingMonitor.prototype.destroy=mappingMonitorDestroy,MappingMonitor.prototype.registerOn=mappingMonitorRegisterOn,MappingMonitor.prototype.unregisterFrom=mappingMonitorUnregisterFrom,MappingMonitor.prototype.getNumMonitored=mappingMonitorGetNumMonitored,MappingMonitor.prototype.updateSimpleElement=mappingMonitorUpdateSimpleElement,MappingMonitor.prototype.removeSimpleElement=mappingMonitorRemoveSimpleElement,MappingMonitor.prototype.completeUpdate=mappingMonitorCompleteUpdate,MappingMonitor.prototype.subTreeUpdate=mappingMonitorSubTreeUpdate,PathNonTerminals.prototype.getNum=pathNonTerminalsGetNum,PathNonTerminals.prototype.addAdditionalIdentification=pathNonTerminalsAddAdditionalIdentification,PathNonTerminals.prototype.removeAdditionalIdentification=pathNonTerminalsRemoveAdditionalIdentification,PathNonTerminals.prototype.getAdditionalIdentities=pathNonTerminalsGetAdditionalIdentities,PathNonTerminals.prototype.getAdditionalIdentifications=pathNonTerminalsGetAdditionalIdentifications,PathNonTerminals.prototype.addNonTerminal=pathNonTerminalsAddNonTerminal,PathNonTerminals.prototype.removeNonTerminal=pathNonTerminalsRemoveNonTerminal,PathNonTerminals.prototype.updateIdentity=pathNonTerminalsUpdateIdentity,PathNonTerminals.prototype.getNonTerminals=pathNonTerminalsGetNonTerminals,PathNonTerminals.prototype.getAllNonTerminals=pathNonTerminalsGetAllNonTerminals,NonTerminalsByIdentity.prototype.incGroups=nonTerminalsByIdentityIncGroups,NonTerminalsByIdentity.prototype.decGroups=nonTerminalsByIdentityDecGroups,
NonTerminalsByIdentity.prototype.addNonTerminal=nonTerminalsByIdentityAddNonTerminal,NonTerminalsByIdentity.prototype.removeNonTerminal=nonTerminalsByIdentityRemoveNonTerminal,NonTerminalsByIdentity.prototype.initAdditionalIdentities=nonTerminalsByIdentityInitAdditionalIdentities,NonTerminalsByIdentity.prototype.getNonTerminals=nonTerminalsByIdentityGetNonTerminals,NonTerminalsByIdentityAtRoot.prototype.incGroups=nonTerminalsByIdentityAtRootIncGroups,NonTerminalsByIdentityAtRoot.prototype.decGroups=nonTerminalsByIdentityAtRootDecGroups,NonTerminalsByIdentityAtRoot.prototype.addNonTerminal=nonTerminalsByIdentityAddNonTerminalAtRoot,NonTerminalsByIdentityAtRoot.prototype.removeNonTerminal=nonTerminalsByIdentityAtRootRemoveNonTerminal,NonTerminalsByIdentityAtRoot.prototype.initAdditionalIdentities=nonTerminalsByIdentityAtRootInitAdditionalIdentities,NonTerminalsByIdentityAtRoot.prototype.getNonTerminals=nonTerminalsByIdentityAtRootGetNonTerminals,ChildrenByIdentity.prototype.addChild=childrenByIdentityAddChild,ChildrenByIdentity.prototype.removeChild=childrenByIdentityRemoveChild,ChildrenByIdentity.prototype.removeGroup=childrenByIdentityRemoveGroup,ChildrenByIdentity.prototype.updateIdentity=childrenByIdentityUpdateIdentity,ChildrenByIdentity.prototype.updateChildIdentity=childrenByIdentityUpdateChildIdentity,ChildrenByIdentity.prototype.getChildren=childrenByIdentityGetChildren,ChildrenByIdentityEntry.prototype.addChild=childrenByIdentityEntryAddChild,ChildrenByIdentityEntry.prototype.removeChild=childrenByIdentityEntryRemoveChild,ChildrenByIdentityEntry.prototype.removeGroup=childrenByIdentityEntryRemoveGroup,UnmappedByIdentity.prototype.addUnmapped=unmappedByIdentityAddUnmapped,UnmappedByIdentity.prototype.getUnmapped=unmappedByIdentityGetUnmapped,UnmappedByIdentity.prototype.removeUnmapped=unmappedByIdentityRemoveUnmapped,UnmappedByIdentity.prototype.updateIdentity=unmappedByIdentityUpdateIdentity,UnmappedByIdentityEntry.prototype.addUnmapped=unmappedByIdentityEntryAddUnmapped,UnmappedByIdentityEntry.prototype.removeUnmapped=unmappedByIdentityEntryRemoveUnmapped,UnmappedByIdentityEntry.prototype.getGroupNum=unmappedByIdentityEntryGetGroupNum,UnmappedNodes.prototype.isUnmapped=unmappedNodesIsUnmapped,UnmappedNodes.prototype.unmappedNum=unmappedNodesUnmappedNum,UnmappedNodes.prototype.getDominating=unmappedNodesGetDominating,UnmappedNodes.prototype.getGroups=unmappedNodesGetGroups,UnmappedNodes.prototype.getByIdentity=unmappedNodesGetByIdentity,UnmappedNodes.prototype.addNode=unmappedNodesAddNode,UnmappedNodes.prototype.getByDominating=unmappedNodesGetByDominating,UnmappedNodes.prototype.getAllDominatingIds=unmappedNodesGetAllDominatingIds,UnmappedNodes.prototype.hasUnmapped=unmappedNodesHasUnmapped,UnmappedNodes.prototype.getHighestPriority=unmappedNodesGetHighestPriority,UnmappedNodes.prototype.removeByDominating=unmappedNodesRemoveByDominating,UnmappedNodes.prototype.removeSingleEntry=unmappedNodesRemoveSingleEntry,UnmappedNodes.prototype.removeFromBySource=unmappedNodesRemoveFromBySource,UnmappedNodes.prototype.removeBySource=unmappedNodesRemoveBySource,UnmappedNodes.prototype.updateIdentity=unmappedNodesUpdateIdentity,UnmappedNodesAtRoot.prototype.isUnmapped=unmappedNodesAtRootIsUnmapped,UnmappedNodesAtRoot.prototype.unmappedNum=unmappedNodesAtRootUnmappedNum,UnmappedNodesAtRoot.prototype.addNode=unmappedNodesAtRootAddNode,UnmappedNodesAtRoot.prototype.getByDominating=unmappedNodesAtRootGetByDominating,UnmappedNodesAtRoot.prototype.getGroups=unmappedNodesAtRootGetGroups,UnmappedNodesAtRoot.prototype.getByIdentity=unmappedNodesAtRootGetByIdentity,UnmappedNodesAtRoot.prototype.hasUnmapped=unmappedNodesAtRootHasUnmapped,UnmappedNodesAtRoot.prototype.getHighestPriority=unmappedNodesAtRootGetHighestPriority,UnmappedNodesAtRoot.prototype.removeFromBySource=unmappedNodesAtRootRemoveFromBySource,UnmappedNodesAtRoot.prototype.removeBySource=unmappedNodesAtRootRemoveBySource,UnmappedNodesAtRoot.prototype.updateIdentity=unmappedNodesAtRootUpdateIdentity,SourceNodesByPriority.prototype.addNode=sourceNodesByPriorityAddNode,SourceNodesByPriority.prototype.removeNode=sourceNodesByPriorityRemoveNode,SourceNodesByPriority.prototype.getHighestPriority=sourceNodesByPriorityGetHighestPriority,SourceNodesByPriority.prototype.isEmpty=sourceNodesByPriorityIsEmpty,inherit(MergeIndexer,IdentityIndexer);var debugAllMergeIndexers;MergeIndexer.prototype.createDataElements=mergeIndexerCreateDataElements,MergeIndexer.prototype.destroy=mergeIndexerDestroy,MergeIndexer.prototype.createPathNode=mergeIndexerCreatePathNode,MergeIndexer.prototype.newDataElementEntry=mergeIndexerNewDataElementEntry,MergeIndexer.prototype.addPath=mergeIndexerAddPath,MergeIndexer.prototype.addNonExtensionPathId=mergeIndexerAddNonExtensionPathId,MergeIndexer.prototype.addMapping=mergeIndexerAddMapping,MergeIndexer.prototype.removeMapping=mergeIndexerRemoveMapping,MergeIndexer.prototype.removeAllMappings=mergeIndexerRemoveAllMappings,MergeIndexer.prototype.replaceFuncSource=mergeIndexerReplaceFuncSource,MergeIndexer.prototype.getRegisteredFuncProjections=mergeIndexerGetRegisteredFuncProjections,MergeIndexer.prototype.getProjEntry=mergeIndexerGetProjEntry,MergeIndexer.prototype.getProjGroupSequence=mergeIndexerGetProjGroupSequence,MergeIndexer.prototype.getProjMaxGroup=mergeIndexerGetProjMaxGroup,MergeIndexer.prototype.projAlreadyAddedMatches=mergeIndexerProjAlreadyAddedMatches,MergeIndexer.prototype.isSingleMappingResult=mergeIndexerIsSingleMappingResult,MergeIndexer.prototype.addMappingToGroup=mergeIndexerAddMappingToGroup,MergeIndexer.prototype.createGroup=mergeIndexerCreateGroup,MergeIndexer.prototype.destroyGroup=mergeIndexerDestroyGroup,MergeIndexer.prototype.addIdentityGroupByIdentification=mergeIndexerAddIdentityGroupByIdentification,MergeIndexer.prototype.removeIdentityGroupByIdentification=mergeIndexerRemoveIdentityGroupByIdentification,MergeIndexer.prototype.pathNodeActivated=mergeIndexerPathNodeActivated,MergeIndexer.prototype.pathNodeTracingActivated=mergeIndexerPathNodeTracingActivated,MergeIndexer.prototype.mergeNonMonitoredAtExplicit=mergeIndexerMergeNonMonitoredAtExplicit,MergeIndexer.prototype.mergeNonMonitoredAtExtension=mergeIndexerMergeNonMonitoredAtExtension,MergeIndexer.prototype.pathNodeDeactivated=mergeIndexerPathNodeDeactivated,MergeIndexer.prototype.destroyPathNodeMapping=mergeIndexerDestroyPathNodeMapping,MergeIndexer.prototype.clearPathNode=mergeIndexerClearPathNode,MergeIndexer.prototype.pathNodeTracingDeactivated=mergeIndexerPathNodeTracingDeactivated,MergeIndexer.prototype.removeNonMonitoredNodes=mergeIndexerRemoveNonMonitoredNodes,MergeIndexer.prototype.subTreeMonitoringActivated=mergeIndexerSubTreeMonitoringActivated,MergeIndexer.prototype.subTreeMonitoringDeactivated=mergeIndexerSubTreeMonitoringDeactivated,MergeIndexer.prototype.inSubTreeActivated=mergeIndexerInSubTreeActivated,MergeIndexer.prototype.inSubTreeOnlyAsRootActivated=mergeIndexerInSubTreeOnlyAsRootActivated,MergeIndexer.prototype.inSubTreeWithAttrActivated=mergeIndexerInSubTreeWithAttrActivated,MergeIndexer.prototype.inSubTreeDeactivated=mergeIndexerInSubTreeDeactivated,MergeIndexer.prototype.inSubTreeOnlyAsRootDeactivated=mergeIndexerInSubTreeOnlyAsRootDeactivated,MergeIndexer.prototype.inSubTreeWithAttrDeactivated=mergeIndexerInSubTreeWithAttrDeactivated,MergeIndexer.prototype.addMappingMonitorForMappedNode=mergeIndexerAddMappingMonitorForMappedNode,MergeIndexer.prototype.addMappingMonitorUnderNonTerminals=mergeIndexerAddMappingMonitorUnderNonTerminals,MergeIndexer.prototype.removeMappingMonitorForMappedNode=mergeIndexerRemoveMappingMonitorForMappedNode,MergeIndexer.prototype.addMappingMonitorAtNoTracePath=mergeIndexerAddMappingMonitorAtNoTracePath,MergeIndexer.prototype.removeMappingMonitorAtTracePath=mergeIndexerRemoveMappingMonitorAtTracePath,MergeIndexer.prototype.removeUnmappedMappingMonitorByDominating=mergeIndexerRemoveUnmappedMappingMonitorByDominating,MergeIndexer.prototype.removeMappingMonitorUnderNonTerminal=mergeIndexerRemoveMappingMonitorUnderNonTerminal,MergeIndexer.prototype.removeUnmappedMappingMonitor=mergeIndexerRemoveUnmappedMappingMonitor,MergeIndexer.prototype.removeUnmappedMappingMonitorByIdentity=mergeIndexerRemoveUnmappedMappingMonitorByIdentity,MergeIndexer.prototype.addMappingMonitor=mergeIndexerAddMappingMonitor,MergeIndexer.prototype.removeMappingMonitor=mergeIndexerRemoveMappingMonitor,MergeIndexer.prototype.hasMappingMonitor=mergeIndexerHasMappingMonitor,MergeIndexer.prototype.getMonitoredTargetPath=mergeIndexerGetMonitoredTargetPath,MergeIndexer.prototype.mappingMonitorUpdate=mergeIndexerMappingMonitorUpdate,MergeIndexer.prototype.addProjMatches=mergeIndexerAddProjMatches,MergeIndexer.prototype.addExtensionMatches=mergeIndexerAddExtensionMatches,MergeIndexer.prototype.removeProjMatches=mergeIndexerRemoveProjMatches,MergeIndexer.prototype.removeExtensionMatches=mergeIndexerRemoveExtensionMatches,MergeIndexer.prototype.mergeAtMaximalPath=mergeIndexerMergeAtMaximalPath,MergeIndexer.prototype.mergeDominationSequence=mergeIndexerMergeDominationSequence,MergeIndexer.prototype.mergeAtExtensionPath=mergeIndexerMergeAtExtensionPath,MergeIndexer.prototype.addMergedNodes=mergeIndexerAddMergedNodes,MergeIndexer.prototype.addMergedOperatorNodes=mergeIndexerAddMergedOperatorNodes,MergeIndexer.prototype.addMergedNodesWithoutRaising=mergeIndexerAddMergedNodesWithoutRaising,MergeIndexer.prototype.addMergedNodesWithSingleProj=mergeIndexerAddMergedNodesWithSingleProj,MergeIndexer.prototype.addMergedNodesWithSingleResult=mergeIndexerAddMergedNodesWithSingleResult,MergeIndexer.prototype.addMergedNodesWithoutConflicts=mergeIndexerAddMergedNodesWithoutConflicts,MergeIndexer.prototype.addMergedNodesWithConflicts=mergeIndexerAddMergedNodesWithConflicts,MergeIndexer.prototype.addMergedNodesUndominatedWithConflicts=mergeIndexerAddMergedNodesUndominatedWithConflicts,MergeIndexer.prototype.convertToMultiResultFormat=mergeIndexerConvertToMultiResultFormat,MergeIndexer.prototype.unflattenTargetArray=mergeIndexerUnflattenTargetArray,MergeIndexer.prototype.addNodesAndValues=mergeIndexerAddNodesAndValues,MergeIndexer.prototype.addNodeEntries=mergeIndexerAddNodeEntries,MergeIndexer.prototype.setNodeValues=mergeIndexerSetNodeValues,MergeIndexer.prototype.updateKeys=mergeIndexerUpdateKeys,MergeIndexer.prototype.mergeChildrenUnderMerged=mergeIndexerMergeChildrenUnderMerged,MergeIndexer.prototype.mergeChildNode=mergeIndexerMergeChildNode,MergeIndexer.prototype.mergeChildOfNonMaxGroup=mergeIndexerMergeChildOfNonMaxGroup,MergeIndexer.prototype.mergeExplicitChildNode=mergeIndexerMergeExplicitChildNode,MergeIndexer.prototype.removeAtMaximalPath=mergeIndexerRemoveAtMaximalPath,MergeIndexer.prototype.removeAtExtensionPath=mergeIndexerRemoveAtExtensionPath,MergeIndexer.prototype.removeSourceNodes=mergeIndexerRemoveSourceNodes,MergeIndexer.prototype.getDominatingByGroup=mergeIndexerGetDominatingByGroup,MergeIndexer.prototype.getAllDominatingByMerged=mergeIndexerGetAllDominatingByMerged,MergeIndexer.prototype.filterSourceByMonitoredDominating=mergeIndexerFilterSourceByMonitoredDominating,MergeIndexer.prototype.filterMonitoredDominating=mergeIndexerFilterMonitoredDominating,MergeIndexer.prototype.getDominatingUnderIdentityNode=mergeIndexerGetDominatingUnderIdentityNode,MergeIndexer.prototype.initNonTerminals=mergeIndexerInitNonTerminals,MergeIndexer.prototype.destroyNonTerminals=mergeIndexerDestroyNonTerminals,MergeIndexer.prototype.addNonTerminal=mergeIndexerAddNonTerminal,MergeIndexer.prototype.removeNonTerminals=mergeIndexerRemoveNonTerminals,MergeIndexer.prototype.isNonTerminal=mergeIndexerIsNonTerminal,MergeIndexer.prototype.getSimpleValueByIdentity=mergeIndexerGetSimpleValueByIdentity,MergeIndexer.prototype.getSourcePathId=mergeIndexerGetSourcePathId,MergeIndexer.prototype.getDominatingId=mergeIndexerGetDominatingId,MergeIndexer.prototype.getAllTargetNodes=mergeIndexerGetAllTargetNodes,MergeIndexer.prototype.getTargetNodeWithDominating=mergeIndexerGetTargetNodeWithDominating,MergeIndexer.prototype.removeDataElementIdsFromGroup=mergeIndexerRemoveDataElementIdsFromGroup,MergeIndexer.prototype.numTranslatingGroups=mergeIndexerNumTranslatingGroups,MergeIndexer.prototype.getSourceChildrenOfNonMax=mergeIndexerGetSourceChildrenOfNonMax,MergeIndexer.prototype.mergeNodesAsUnmapped=mergeIndexerMergeNodesAsUnmapped,MergeIndexer.prototype.mergeUnmappedUnderOperators=mergeINdexerMergeUnmappedUnderOperators,MergeIndexer.prototype.makeNodesUnmapped=mergeIndexerMakeNodesUnmapped,MergeIndexer.prototype.makeNodesUnderDominatingUnmapped=mergeIndexerMakeNodesUnderDominatingUnmapped,MergeIndexer.prototype.addUnmappedNodes=mergeIndexerAddUnmappedNodes,MergeIndexer.prototype.removeDominatedTargetNodeBySource=mergeIndexerRemoveDominatedTargetNodeBySource,MergeIndexer.prototype.removeTargetNodesBySource=mergeIndexerRemoveTargetNodesBySource,MergeIndexer.prototype.makeUnmappedIntoMapped=mergeIndexerMakeUnmappedIntoMapped,MergeIndexer.prototype.removeTargetNodes=mergeIndexerRemoveTargetNodes,MergeIndexer.prototype.removeChildrenUnderMappedNodes=mergeIndexerRemoveChildrenUnderMappedNodes,MergeIndexer.prototype.removeMappedNodeEntries=mergeIndexerRemoveMappedNodeEntries,MergeIndexer.prototype.removeUnmappedNodesBySource=mergeIndexerRemoveUnmappedNodesBySource,MergeIndexer.prototype.removeUnmappedNodesByDominating=mergeIndexerRemoveUnmappedNodesByDominating,MergeIndexer.prototype.removeChildrenOfUnmappedByIdentity=mergeIndexerRemoveChildrenOfUnmappedByIdentity,MergeIndexer.prototype.removeChildrenOfUnmappedUnderAll=mergeIndexerRemoveChildrenOfUnmappedUnderAll,MergeIndexer.prototype.removeChildrenOfUnmapped=mergeIndexerRemoveChildrenOfUnmapped,MergeIndexer.prototype.removeChildrenOfUnmappedAtNonMax=mergeIndexerRemoveChildrenOfUnmappedAtNonMax,MergeIndexer.prototype.removeChildrenOfUnmappedAtMax=mergeIndexerRemoveChildrenOfUnmappedAtMax,MergeIndexer.prototype.removeUnmappedOperandsByIdentity=mergeIndexerRemoveUnmappedOperandsByIdentity,MergeIndexer.prototype.mergeUnderNode=mergeIndexerMergeUnderNode,MergeIndexer.prototype.mergeUnderIdentity=mergeIndexerMergeUnderIdentity,MergeIndexer.prototype.mergeOperandsUnderIdentity=mergeIndexerMergeOperandsUnderIdentity,MergeIndexer.prototype.mergeChildrenUnderIdentity=mergeIndexerMergeChildrenUnderIdentity,MergeIndexer.prototype.mergeChildrenFromMinSourcePath=mergeIndexerMergeChildrenFromMinSourcePath,MergeIndexer.prototype.mergeChildrenOfMatchingUnmapped=mergeIndexerMergeChildrenOfMatchingUnmapped,MergeIndexer.prototype.mergeChildrenOfUnmapped=mergeIndexerMergeChildrenOfUnmapped,MergeIndexer.prototype.isNonTerminalOperator=mergeIndexerIsNonTerminalOperator,MergeIndexer.prototype.addNonTerminalOperator=mergeIndexerAddNonTerminalOperator,MergeIndexer.prototype.removeNonTerminalOperators=mergeIndexerRemoveNonTerminalOperators,MergeIndexer.prototype.addDataElementOperator=mergeIndexerAddDataElementOperator,MergeIndexer.prototype.removeDataElementOperator=mergeIndexerRemoveDataElementOperator,MergeIndexer.prototype.addGroupToGroupBySourceIdentification=mergeIndexerAddGroupToGroupBySourceIdentification,MergeIndexer.prototype.removeGroupFromGroupBySourceIdentification=mergeIndexerRemoveGroupFromGroupBySourceIdentification,MergeIndexer.prototype.addToUnmappedByIdentification=mergeIndexerAddToUnmappedByIdentification,MergeIndexer.prototype.removeFromUnmappedByIdentification=mergeIndexerRemoveFromUnmappedByIdentification,MergeIndexer.prototype.changeUnmappedByIdentification=mergeIndexerChangeUnmappedByIdentification,MergeIndexer.prototype.updateSourceIdentity=mergeIndexerUpdateSourceIdentity,MergeIndexer.prototype.updateMappedTargetIdentity=mergeIndexerUpdateMappedTargetIdentity,MergeIndexer.prototype.updateMappedIdTargetIdentity=mergeIndexerUpdateMappedIdTargetIdentity,MergeIndexer.prototype.updateIdentityNodeIdentity=mergeIndexerUpdateIdentityNodeIdentity,MergeIndexer.prototype.updateUnmappedSourceIdentity=mergeIndexerUpdateUnmappedSourceIdentity,MergeIndexer.prototype.updateUnmappedSourceIdentityAtPath=mergeIndexerUpdateUnmappedSourceIdentityAtPath,MergeIndexer.prototype.remergeAsOperandAfterIdentityChange=mergeIndexerRemergeAsOperandAfterIdentityChange,MergeIndexer.prototype.updateUndominatedSourceIdentity=mergeIndexerUpdateUndominatedSourceIdentity,MergeIndexer.prototype.updateUndominatedSourceIdentityAtPath=mergeIndexerUpdateUndominatedSourceIdentityAtPath,MergeIndexer.prototype.addToIdentifiedByTarget=mergeIndexerAddToIdentifiedByTarget,MergeIndexer.prototype.removeFromIdentifiedByTarget=mergeIndexerRemoveFromIdentifiedByTarget,MergeIndexer.prototype.requiresTargetIdentification=mergeIndexerRequiresTargetIdentification,MergeIndexer.prototype.updateTargetIdentities=mergeIndexerUpdateTargetIdentities,MergeIndexer.prototype.updateTargetIdentity=mergeIndexerUpdateTargetIdentity,MergeIndexer.prototype.getDominatedComparisonAtPath=mergeIndexerGetDominatedComparisonAtPath,MergeIndexer.prototype.addOrderStarFuncAtPath=mergeIndexerAddOrderStarFuncAtPath,MergeIndexer.prototype.removeOrderStarFuncAtPath=mergeIndexerRemoveOrderStarFuncAtPath,MergeIndexer.prototype.getElementTranslation=mergeIndexerGetElementTranslation,MergeIndexerElementIdTranslation.prototype.get=mergeIndexerElementIdTranslationGet,QueryResultQueryCalc.prototype.destroy=queryResultQueryCalcDestroy,QueryResultQueryCalc.prototype.getId=queryResultQueryCalcGetId,QueryResultQueryCalc.prototype.isSelection=queryResultQueryCalcIsSelection,QueryResultQueryCalc.prototype.addMatches=queryResultQueryCalcAddMatches,QueryResultQueryCalc.prototype.removeMatches=queryResultQueryCalcRemoveMatches,QueryResultQueryCalc.prototype.removeAllIndexerMatches=queryResultQueryCalcRemoveAllIndexerMatches,inherit(InternalQueryResult,FuncResult);var debugAllQueryResults=void 0;InternalQueryResult.prototype.destroy=internalQueryResultDestroy,InternalQueryResult.prototype.getIndexer=internalQueryResultGetIndexer,InternalQueryResult.prototype.getIndexerByRoot=internalQueryResultGetIndexerByRoot,InternalQueryResult.prototype.getPrefixProjPathId=internalQueryResultGetPrefixProjPathId,InternalQueryResult.prototype.getProjectionPathId=internalQueryResultGetProjectionPathId,InternalQueryResult.prototype.hasMultipleProjPaths=internalQueryResultHasMultipleProjPaths,InternalQueryResult.prototype.hasNoSelectionOnIndexer=internalQueryResultHasNoSelectionOnIndexer,InternalQueryResult.prototype.getComposedSelectingNum=internalQueryResultGetComposedSelectingNum,InternalQueryResult.prototype.getDominatedIndexer=internalQueryResultGetDominatedIndexer,InternalQueryResult.prototype.getDominatedProjPathId=internalQueryResultGetDominatedProjPathId,InternalQueryResult.prototype.getDominatedProjPathNum=internalQueryResultGetDominatedProjPathNum,InternalQueryResult.prototype.getDominatedProjMappings=internalQueryResultGetDominatedProjMappings,InternalQueryResult.prototype.getTerminalProjMatches=internalQueryResultGetTerminalProjMatches,InternalQueryResult.prototype.filterTerminalProjMatches=internalQueryResultFilterTerminalProjMatches,InternalQueryResult.prototype.getDominatedIdentification=internalQueryResultGetDominatedIdentification,InternalQueryResult.prototype.getDominatedComparison=internalQueryResultGetDominatedComparison,InternalQueryResult.prototype.dominatedCount=internalQueryResultDominatedCount,InternalQueryResult.prototype.calcIsActive=internalQueryResultCalcIsActive,InternalQueryResult.prototype.isActive=internalQueryResultIsActive,InternalQueryResult.prototype.restrictsProjection=internalQueryResultRestrictsProjection,InternalQueryResult.prototype.setQuery=internalQueryResultSetQuery,InternalQueryResult.prototype.resetRootQueryCalc=internalQueryResultResetRootQueryCalc,InternalQueryResult.prototype.clearRootQueryCalcMatches=internalQueryResultClearRootQueryCalcMatches,InternalQueryResult.prototype.resetProjProperties=internalQueryResultResetProjProperties,InternalQueryResult.prototype.refreshProjProperties=internalQueryResultRefreshProjProperties,InternalQueryResult.prototype.requiresExplicitProjMatches=internalQueryResultRequiresExplicitProjMatches,InternalQueryResult.prototype.projMustGenerateMatches=internalQueryResultProjMustGenerateMatches,InternalQueryResult.prototype.refreshProjMustGenerateMatches=internalQueryResultRefreshProjMustGenerateMatches,InternalQueryResult.prototype.refreshIndexerAndPaths=internalQueryResultRefreshIndexerAndPaths,InternalQueryResult.prototype.refreshMatchCount=internalQueryResultRefreshMatchCount,InternalQueryResult.prototype.setMatchCount=internalQueryResultSetMatchCount,InternalQueryResult.prototype.setMappingsOnResultIndexer=internalQueryResultSetMappingsOnResultIndexer,InternalQueryResult.prototype.addRootQueryCalcMatches=internalQueryResultAddRootQueryCalcMatches,InternalQueryResult.prototype.addReplacedRootQueryCalcMatches=internalQueryResultAddReplacedRootQueryCalcMatches,InternalQueryResult.prototype.removeReplacedRootQueryCalcMatches=internalQueryResultRemoveReplacedRootQueryCalcMatches,InternalQueryResult.prototype.aboutToAttachActiveComposed=internalQueryResultAboutToAttachActiveComposed,InternalQueryResult.prototype.aboutToAddActiveComposed=internalQueryResultAboutToAddActiveComposed,InternalQueryResult.prototype.activeComposedFuncRemoved=internalQueryResultActiveComposedFuncRemoved,InternalQueryResult.prototype.deactivated=internalQueryResultDeactivated,InternalQueryResult.prototype.becameActiveStar=internalQueryResultBecameActiveStar,InternalQueryResult.prototype.updateMatchesAfterActiveStarBecameActive=internalQueryResultUpdateMatchesAfterActiveStarBecameActive,InternalQueryResult.prototype.addDominatedMatchesWithoutForwarding=internalQueryResultAddDominatedMatchesWithoutForwarding,InternalQueryResult.prototype.removePartialMatchesFromComposed=internalQueryResultRemovePartialMatchesFromComposed,InternalQueryResult.prototype.addPartialMatchesToComposed=internalQueryResultAddPartialMatchesToComposed,InternalQueryResult.prototype.replaceIndexerAndPaths=internalQueryResultReplaceIndexerAndPaths,InternalQueryResult.prototype.addCountsUnderRemovedIndexer=internalQueryResultAddCountsUnderRemovedIndexer,InternalQueryResult.prototype.removeNonResultIndexerMatches=internalQueryResultRemoveNonResultIndexerMatches,InternalQueryResult.prototype.aboutToSetData=internalQueryResultAboutToSetData,InternalQueryResult.prototype.setDataCompleted=internalQueryResultSetDataCompleted,InternalQueryResult.prototype.removeDataObjMatches=internalQueryResultRemoveDataObjMatches,InternalQueryResult.prototype.addDataObjMatches=internalQueryResultAddDataObjMatches,InternalQueryResult.prototype.replaceDataObjMatches=internalQueryResultReplaceDataObjMatches,InternalQueryResult.prototype.propagateMatchCountDiff=internalQueryResultPropagateMatchCountDiff,InternalQueryResult.prototype.decreaseMatchCount=internalQueryResultDecreaseMatchCount,InternalQueryResult.prototype.getMatchCountDiff=internalQueryResultGetMatchCountDiff,InternalQueryResult.prototype.decreaseCountOfReplacedData=internalQueryResultDecreaseCountOfReplacedData,InternalQueryResult.prototype.increaseCountOfNewData=internalQueryResultIncreaseCountOfNewData,InternalQueryResult.prototype.getMatchesFromSource=internalQueryResultGetMatchesFromSource,InternalQueryResult.prototype.getMatchesFromSourceAsObj=internalQueryResultGetMatchesFromSourceAsObj,InternalQueryResult.prototype.getChainMatchCountDiff=internalQueryResultGetChainMatchCountDiff,InternalQueryResult.prototype.getAccumulatedMatchCount=internalQueryResultGetAccumulatedMatchCount,InternalQueryResult.prototype.getChainMatches=internalQueryResultGetChainMatches,InternalQueryResult.prototype.reduceMatchesByInsertedQueries=internalQueryResultReduceMatchesByInsertedQueries,InternalQueryResult.prototype.addPrefixResultRestrictions=internalQueryResultAddPrefixResultRestrictions,InternalQueryResult.prototype.addPrefixRestrictionsToNoSelection=internalQueryResultAddPrefixRestrictionsToNoSelection,InternalQueryResult.prototype.increaseMatchCount=internalQueryResultIncreaseMatchCount,InternalQueryResult.prototype.removeRestrictionsOfRemovedQueries=internalQueryResultRemoveRestrictionsOfRemovedQueries,InternalQueryResult.prototype.removePrefixResultRestrictions=internalQueryResultRemovePrefixResultRestrictions,InternalQueryResult.prototype.removeRestrictionsFromNoSelection=internalQueryResultRemoveRestrictionsFromNoSelection,InternalQueryResult.prototype.getTerminalGeneratingProjs=internalQueryResultGetTerminalGeneratingProjs,InternalQueryResult.prototype.updateTerminalProjs=internalQueryResultUpdateTerminalProjs,InternalQueryResult.prototype.refreshIsPureProjection=internalQueryResultRefreshIsPureProjection,InternalQueryResult.prototype.updateComposedSelectingNum=internalQueryResultUpdateComposedSelectingNum,InternalQueryResult.prototype.completeComposedSelectingNumUpdate=internalQueryResultCompleteComposedSelectingNumUpdate,InternalQueryResult.prototype.getMatches=internalQueryResultGetMatches,InternalQueryResult.prototype.getSelectionMatches=internalQueryResultGetSelectionMatches,InternalQueryResult.prototype.getSelectionMatchesAsObj=internalQueryResultGetSelectionMatchesAsObj,InternalQueryResult.prototype.filterSelectionMatches=internalQueryResultFilterSelectionMatches,InternalQueryResult.prototype.filterSelectionMatchPositions=internalQueryResultFilterSelectionMatchPositions,InternalQueryResult.prototype.getDominatedMatches=internalQueryResultGetDominatedMatches,InternalQueryResult.prototype.getDominatedMatchesAsObj=internalQueryResultGetDominatedMatchesAsObj,InternalQueryResult.prototype.filterDominatedMatches=internalQueryResultFilterDominatedMatches,InternalQueryResult.prototype.filterDominatedMatchPositions=internalQueryResultFilterDominatedMatchPositions,InternalQueryResult.prototype.getDomMatchCount=internalQueryResultGetDomMatchCount,InternalQueryResult.prototype.addMatches=internalQueryResultAddMatches,InternalQueryResult.prototype.pushNewMatches=internalQueryResultPushNewMatches,InternalQueryResult.prototype.removeMatches=internalQueryResultRemoveMatches,InternalQueryResult.prototype.removeAllMatches=internalQueryResultRemoveAllMatches,InternalQueryResult.prototype.pushRemovedMatches=internalQueryResultPushRemovedMatches,InternalQueryResult.prototype.setProjMatches=internalQueryResultSetProjMatches,InternalQueryResult.prototype.addTerminalProjMatches=internalQueryResultAddTerminalProjMatches,InternalQueryResult.prototype.removeTerminalProjMatches=internalQueryResultRemoveTerminalProjMatches,InternalQueryResult.prototype.removeAllTerminalProjMatches=internalQueryResultRemoveAllTerminalProjMatches,InternalQueryResult.prototype.maxDirectComposedNum=3,InternalQueryResult.prototype.useResultIndexer=internalQueryResultUseResultIndexer,InternalQueryResult.prototype.insertResultIndexer=internalQueryResultInsertResultIndexer,InternalQueryResult.prototype.insertResultIndexerWithRefresh=internalQueryResultInsertResultIndexerWithRefresh,InternalQueryResult.prototype.createResultIndexer=internalQueryResultCreateResultIndexer,InternalQueryResult.prototype.removeResultIndexer=internalQueryResultRemoveResultIndexer,InternalQueryResult.prototype.removeResultIndexerWithRefresh=internalQueryResultRemoveResultIndexerWithRefresh,InternalQueryResult.prototype.destroyResultIndexer=internalQueryResultDestroyResultIndexer,InternalQueryResult.prototype.debugGetQueryResult=internalQueryResultDebugGetQueryResult,InternalQueryResult.prototype.debugGetQueryInput=internalQueryResultDebugGetQueryInput,InternalQueryResult.prototype.debugPrintQuery=internalQueryResultDebugPrintQuery,InternalQueryResult.prototype.debugPrintDesc=internalQueryResultDebugPrintDesc,inherit(DataResult,FuncResult),DataResult.prototype.destroy=dataResultDestroy,DataResult.prototype.isActive=dataResultIsActive,DataResult.prototype.isTerminalResult=dataResultIsTerminalResult,DataResult.prototype.isReplaceableTerminalResult=dataResultIsReplaceableTerminalResult,DataResult.prototype.aboutToAddActiveComposed=dataResultAboutToAddActiveComposed,DataResult.prototype.becameActiveStar=dataResultBecameActiveStar,DataResult.prototype.activeComposedFuncRemoved=dataResultActiveComposedFuncRemoved,DataResult.prototype.getDominatedIndexer=dataResultGetDominatedIndexer,DataResult.prototype.getDominatedProjPathId=dataResultGetDominatedProjPathId,DataResult.prototype.getDominatedProjPathNum=dataResultGetDominatedProjPathNum,DataResult.prototype.getDominatedProjMappings=dataResultGetDominatedProjMappings,DataResult.prototype.getTerminalProjMatches=dataResultGetTerminalProjMatches,DataResult.prototype.filterTerminalProjMatches=dataResultFilterTerminalProjMatches,DataResult.prototype.getDomMatchCount=dataResultGetDomMatchCount,DataResult.prototype.getDominatedMatches=dataResultGetDominatedMatches,DataResult.prototype.getDominatedMatchesAsObj=dataResultGetDominatedMatchesAsObj,DataResult.prototype.filterDominatedMatches=dataResultFilterDominatedMatches,DataResult.prototype.filterDominatedMatchPositions=dataResultFilterDominatedMatchPositions,DataResult.prototype.getDominatedIdentification=dataResultGetDominatedIdentification,DataResult.prototype.getDominatedComparison=dataResultGetDominatedComparison,DataResult.prototype.addOrderStarFunc=dataResultAddOrderStarFunc,DataResult.prototype.removeOrderStarFunc=dataResultRemoveOrderStarFunc,DataResult.prototype.isSelection=dataResultIsSelection,DataResult.prototype.addMatches=dataResultAddMatches,DataResult.prototype.removeMatches=dataResultRemoveMatches,DataResult.prototype.removeAllIndexerMatches=dataResultRemoveAllIndexerMatches;var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),FEGValueIndexer=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tracedPaths=new Set,t}return __extends(t,e),t.prototype.destroy=function(){var t=this;this.tracedPaths.forEach(function(e){e in t.pathNodesById&&t.decPathNodeTracing(t.pathNodesById[e])}),this.tracedPaths=void 0,e.prototype.destroy.call(this)},t.prototype.addRawObject=function(e,t){this.setAt(this.qcm.getRootPathId(),void 0,e,!0,t)},t.prototype.setAt=function(e,t,i,r,n){return i instanceof Array&&1===i.length&&(i=i[0]),i instanceof MoonOrderedSet&&1===i.os.length&&(i=i.os[0]),"object"!=typeof i?this.setTerminalAt(e,t,i,r,n):i instanceof Projector?this.setProjectorAt(e,t,i,r,n):i instanceof Array?this.setOrderedSetAt(e,t,i,r,n):i instanceof MoonOrderedSet?this.setOrderedSetAt(e,t,i.os,r,n):i instanceof RangeValue?this.setRangeAt(e,t,i,r,n):i instanceof Negation?this.setNegationAt(e,t,i,r,n):i instanceof ElementReference?this.setElementReference(e,t,i,r,n):this.setAttributeValueAt(e,t,i,r,n)},t.prototype.setTerminalAt=function(e,t,i,r,n){var o=typeof i;if("string"!=o&&"number"!=o&&"boolean"!=o)return!1;var s,a=this.addPath(e);return this.tracedPaths.has(e)||(this.incPathNodeTracing(a),this.tracedPaths.add(e)),r?(s=InternalQCMIndexer.getNextDataElementId(),this.addDataElementNode(a,s,t,n)):(s=t,this.addNonDataElementNode(a,s)),this.setKeyValue(a,s,o,i),!0},t.prototype.setElementReference=function(e,t,i,r,n){var o,s=this.addPath(e);return r?(o=InternalQCMIndexer.getNextDataElementId(),this.addDataElementNode(s,o,t,n)):(o=t,this.addNonDataElementNode(s,o)),this.setKeyValue(s,o,"elementReference",i),!0},t.prototype.setProjectorAt=function(e,t,i,r,n){var o,s=this.addPath(e);return r?(o=InternalQCMIndexer.getNextDataElementId(),this.addDataElementNode(s,o,t,n)):(o=t,this.addNonDataElementNode(s,o)),this.setKeyValue(s,o,"projector",0),!0},t.prototype.setOrderedSetAt=function(e,t,i,r,n){var o=i;if(0==o.length)return!1;for(var s=0,a=0,d=o.length;a<d;++a)this.setAt(e,t,o[a],!0,n)&&s++;return 0!=s},t.prototype.setRangeAt=function(e,t,i,r,n){var o,s=this.addPath(e);return r?(o=InternalQCMIndexer.getNextDataElementId(),
this.addDataElementNode(s,o,t,n)):(o=t,this.addNonDataElementNode(s,o)),this.setKeyValue(s,o,"range",[!i.closedLower,!i.closedUpper]),this.setAt(e,o,i.min,!0,void 0),this.setAt(e,o,i.max,!0,void 0),!0},t.prototype.setNegationAt=function(e,t,i,r,n){var o,s=this.addPath(e);r?(o=InternalQCMIndexer.getNextDataElementId(),this.addDataElementNode(s,o,t,n)):(o=t,this.addNonDataElementNode(s,o)),this.setKeyValue(s,o,"negation",0);for(var a=i.queries,d=0,u=a.length;d<u;++d)this.setAt(e,o,a[d],!0,void 0);return!0},t.prototype.setAttributeValueAt=function(e,t,i,r,n){var o,s=0,a=this.addPath(e);r?(o=InternalQCMIndexer.getNextDataElementId(),this.addDataElementNode(a,o,t,n)):(o=t,this.addNonDataElementNode(a,o));for(var d in i){var u="^"==d[0];u&&(d=d.substr(1));var h=this.qcm.allocatePathId(e,d);this.setAt(h,o,i[d],!1,void 0)&&s++,this.qcm.releasePathId(h)}if(!s)return this.removeNode(a,o),!1;this.setKeyValue(a,o,"attributeValue",void 0),this.setKeyValue(a,o,"attribute",!0);var l=a.nodes.get(o);return l.objectValue=i,!0},t.prototype.setTopLevelAttributeValue=function(e,t){var i=this.qcm.getRootPathId(),r=this.addPath(i),n=InternalQCMIndexer.getNextDataElementId();return this.addDataElementNode(r,n,void 0,t),this.setAttributeValueAt(i,n,e,!1,t),n},t.prototype.syntaxError=function(e,t,i,r){for(var n=this.qcm.getPathStrings(e),o="",s=0,a=n.length;s<a;++s)0!==s?o+=":"+n[s]:o=n[0];console.log("syntax error at path <",o,">: ",i)},t.prototype.addColumnObjects=function(e){var t,i,r=this.qcm.getRootPathId(),n=this.addPath(r),o=Object.keys(e)[0];if(void 0!==o&&(i=e[o].length,0!==i)){t=InternalQCMIndexer.getDataElementIdRange(i);for(var s=0;s<i;s++)this.addDataElementNode(n,t+s,void 0,void 0);for(var a in e){var d=this.qcm.allocatePathId(r,a),u=this.addPath(d),h=e[a];if(this.qcm.releasePathId(d),void 0!==h)for(var s=0;s<i;s++){var l=h[s];if(void 0!==l){var c=typeof l,p=t+s;this.addNonDataElementNode(u,p),this.setKeyValue(u,p,c,l,!0)}}}}},t.prototype.setDataSupplier=function(e){this.dataSupplier=e,this.reservedRanges=[],this.totalNrReservedDataElementIds=0,this.unloadedDataElementIds=new Map},t.prototype.announceNewDataElements=function(e,t){var i=this.qcm.getRootPathId();this.announceNewDataElementsForPathId(i,void 0,e,t)},t.prototype.announceNewDataElementsForPathId=function(e,t,i,r){var n=this.addPath(e),o=InternalQCMIndexer.getDataElementIdRange(r),s={rowNr:i,nrDataElements:r,firstDataElementId:o,paths:void 0};this.reservedRanges.push(s),this.totalNrReservedDataElementIds+=r,this.expectAdditionalDataElementNum(r),this.expectNodeNum(n,this.totalNrReservedDataElementIds);for(var a=0;a<r;a++)this.addDataElementNode(n,o+a,t,void 0);for(var d in this.pathNodesById){var e=Number(d);this.unloadedDataElementIds.has(e)?this.unloadedDataElementIds.get(e).push(s):e!==globalInternalQCM.getRootPathId()&&this.dataSupplier.fillPathNode(this.pathNodesById[e],[s])}},t.prototype.createPathNode=function(t){return void 0!==this.pathNodesById[t]?this.pathNodesById[t]:(void 0!==this.unloadedDataElementIds&&this.unloadedDataElementIds.set(t,this.reservedRanges.slice(0)),e.prototype.createPathNode.call(this,t))},t.prototype.removePathNode=function(t){void 0!==this.unloadedDataElementIds&&this.unloadedDataElementIds.delete(t.pathId),e.prototype.removePathNode.call(this,t)},t.prototype.addColumnRange=function(e,t,i){var i,r=t.length;this.expectNodeNum(e,this.totalNrReservedDataElementIds);for(var n=0;n<r;n++){var o=t[n];if(void 0!==o&&null!==o&&"object"!=typeof o){var s=typeof o,a=i+n;this.addNonDataElementNode(e,a),this.setKeyValue(e,a,s,o,!0)}}},t.prototype.getRawDataDescription=function(){return void 0!==this.dataSupplier?this.dataSupplier.getRawDataDescription():[]},t.prototype.pathNodeActivated=function(e){if(void 0!==this.unloadedDataElementIds&&this.unloadedDataElementIds.has(e.pathId)&&void 0!==this.dataSupplier&&this.dataSupplier.canFillPathNode(e)){var t=this.unloadedDataElementIds.get(e.pathId);this.dataSupplier.fillPathNode(e,t),this.unloadedDataElementIds.delete(e.pathId)}},t.prototype.pathNodeDeactivated=function(e){void 0!==this.dataSupplier&&this.dataSupplier.unloadPathNode(e),this.removePathNode(e)},t.prototype.pathNodeTracingActivated=function(e){},t.prototype.pathNodeTracingDeactivated=function(e){},t.prototype.subTreeMonitoringActivated=function(e){},t.prototype.subTreeMonitoringDeactivated=function(e){},t.prototype.inSubTreeActivated=function(e,t){},t.prototype.inSubTreeDeactivated=function(e,t){},t.prototype.inSubTreeOnlyAsRootActivated=function(e,t){},t.prototype.inSubTreeOnlyAsRootDeactivated=function(e,t){},t.prototype.inSubTreeWithAttrActivated=function(e,t){},t.prototype.inSubTreeWithAttrDeactivated=function(e,t){},t}(IdentityIndexer),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),FEGReplaceableValueIndexer=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dataElementIndex=[],t.alwaysUniqueDataElementId=!1,t.minimizeDataElementMovement=!1,t}return __extends(t,e),t.prototype.replaceRawObject=function(e){var t=this.qcm.getRootPathId(),i=this.replaceAt(t,void 0,e,!0,this.dataElementIndex,0);i<this.dataElementIndex.length&&this.removeDataElements(t,this.dataElementIndex,i)},t.prototype.replaceAt=function(e,t,i,r,n,o){var s;return s="object"!=typeof i?this.replaceTerminalAt(e,t,i,typeof i,r,n,o):i instanceof Projector?this.replaceTerminalAt(e,t,0,"projector",r,n,o):i instanceof Array?this.replaceOrderedSetAt(e,t,i,n,o,!1):i instanceof MoonOrderedSet?this.replaceOrderedSetAt(e,t,i.os,n,o,!1):i instanceof RangeValue?this.replaceRangeAt(e,t,i,r,n,o):i instanceof SubStringQuery?this.replaceStringMatchAt(e,t,i,r,n,o):i instanceof Negation?this.replaceNegationAt(e,t,i,r,n,o):i instanceof ElementReference?this.replaceTerminalAt(e,t,i,"elementReference",r,n,o):this.replaceAttributeValueAt(e,t,i,r,n,o)},t.prototype.terminalNodeIsEqual=function(e,t,i,r){if(e.nodes.has(t)){var n=e.nodes.get(t);return n.type===i&&n.key===r}return!1},t.prototype.replaceTerminalAt=function(e,t,i,r,n,o,s){if("string"!==r&&"number"!==r&&"boolean"!==r&&"elementReference"!==r&&"projector"!==r)return s;var a,d=this.addPath(e);return this.keepPathNodeActive(d),s<o.length&&0===o[s].type?a=o[s].dataElementId:(s<o.length&&this.removeSingleDataElement(e,o[s]),n||void 0===t||this.alwaysUniqueDataElementId?(a=InternalQCMIndexer.getNextDataElementId(),this.addDataElementNode(d,a,t)):(a=t,this.addNonDataElementNode(d,a)),o[s]={dataElementId:a,type:0,originalType:r,originalValue:i}),this.terminalNodeIsEqual(d,a,r,i)||this.setKeyValue(d,a,r,i),this.releaseKeepPathNodeActive(d),s+1},t.prototype.replaceOrderedSetAt=function(e,t,i,r,n,o){function s(){for(var e,t=i.map(cdlifyNormalized),n=r.map(function(e){return cdlifyNormalized(e.originalValue)}),o=new Map,s=[],a=[],d=[],u=i.map(function(e){return!0}),h=0;h<t.length;h++)o.has(t[h])?o.get(t[h]).push(h):o.set(t[h],[h]);for(var h=0;h<r.length;h++){var l=r[h],c=n[h];if(o.has(c)){var p=o.get(c),f=p.shift();s.push(l),d.push(i[f]),u[f]=!1,0===p.length&&o.delete(c)}else a.push(l)}e=i.filter(function(e,t){return u[t]}),i=d.concat(e);for(var v=s.concat(a),h=0;h<v.length;h++)r[h]=v[h];r.length=v.length}var a=n;i.length>1&&(o=!0),o&&1===r.length&&r[0].dataElementId===t&&(this.removeSingleDataElement(e,r[0]),r.splice(0,1)),this.minimizeDataElementMovement&&(i.length>1||r.length>1)&&i.length>0&&r.length>0&&s();for(var d=0,u=i.length;d<u;++d)a=this.replaceAt(e,t,i[d],o,r,a);return a<r.length&&this.removeDataElements(e,r,a),a},t.prototype.replaceWithChildrenAtSamePath=function(e,t,i,r,n,o,s,a,d){var u,h,l=this.addPath(e);this.keepPathNodeActive(l),d<a.length&&a[d].type===n?h=a[d]:(d<a.length&&this.removeSingleDataElement(e,a[d]),s||void 0===t?(u=InternalQCMIndexer.getNextDataElementId(),this.addDataElementNode(l,u,t)):(u=t,this.addNonDataElementNode(l,u)),h=a[d]={dataElementId:u,type:n,originalType:i,originalValue:r,children:{"":{pathId:e,dataElements:[]}}},this.setKeyValue(l,u,i,r)),this.releaseKeepPathNodeActive(l);var c=this.replaceOrderedSetAt(e,h.dataElementId,o,h.children[""].dataElements,0,!0);return assert(c===h.children[""].dataElements.length,"replaceOrderedSetAt should have truncated the list"),d+1},t.prototype.replaceRangeAt=function(e,t,i,r,n,o){var s=[!i.closedLower,!i.closedUpper],a=void 0!==i.min&&void 0!==i.max?[i.min,i.max]:[];return this.replaceWithChildrenAtSamePath(e,t,"range",s,2,a,r,n,o)},t.prototype.replaceNegationAt=function(e,t,i,r,n,o){return this.replaceWithChildrenAtSamePath(e,t,"negation",0,3,i.queries,r,n,o)},t.prototype.replaceStringMatchAt=function(e,t,i,r,n,o){var s,a=this.addPath(e),d="strMatch",u=i.strings[0];return this.keepPathNodeActive(a),void 0===u&&(u=""),o<n.length&&0===n[o].type?s=n[o].dataElementId:(o<n.length&&this.removeSingleDataElement(e,n[o]),r||void 0===t||this.alwaysUniqueDataElementId?(s=InternalQCMIndexer.getNextDataElementId(),this.addDataElementNode(a,s,t)):(s=t,this.addNonDataElementNode(a,s)),n[o]={dataElementId:s,type:0,originalType:d,originalValue:i}),this.terminalNodeIsEqual(a,s,d,u)||this.setKeyValue(a,s,d,u),this.releaseKeepPathNodeActive(a),o+1},t.prototype.replaceAttributeValueAt=function(e,t,i,r,n,o){var s,a,d=this.addPath(e),u=0;if(this.keepPathNodeActive(d),o<n.length&&1===n[o].type){a=n[o];for(var h in n[o].children)if(!(h in i)){var l=a.children[h];this.removeDataElements(l.pathId,l.dataElements,0),delete a.children[h]}s=a.dataElementId}else o<n.length&&this.removeSingleDataElement(e,n[o]),r||void 0===t||this.alwaysUniqueDataElementId?(s=InternalQCMIndexer.getNextDataElementId(),this.addDataElementNode(d,s,t)):(s=t,this.addNonDataElementNode(d,s)),a=n[o]={dataElementId:s,type:1,originalType:"object",originalValue:i,children:{}};this.releaseKeepPathNodeActive(d);for(var h in i){var c="^"==h[0];c&&(h=h.substr(1));var p=this.qcm.allocatePathId(e,h);h in a.children||(a.children[h]={pathId:p,dataElements:[]});var f=this.replaceAt(p,s,i[h],!1,a.children[h].dataElements,0);0!==f&&u++,f<a.children[h].dataElements.length&&this.removeDataElements(p,a.children[h].dataElements,f),this.qcm.releasePathId(p)}return 0===u?(this.removeNode(d,s),n.splice(o,1),o):(this.setKeyValue(d,s,"attributeValue",void 0),this.setKeyValue(d,s,"attribute",!0),o+1)},t.prototype.removeDataElements=function(e,t,i){for(var r=i;r<t.length;r++)this.removeSingleDataElement(e,t[r]);t.length=i},t.prototype.removeSingleDataElement=function(e,t){for(var i in t.children){var r=t.children[i];this.removeDataElements(r.pathId,r.dataElements,0)}this.removeNode(this.pathNodesById[e],t.dataElementId)},t.prototype.pathNodeActivated=function(e){},t.prototype.pathNodeDeactivated=function(e){this.removePathNode(e)},t.prototype.pathNodeTracingActivated=function(e){},t.prototype.pathNodeTracingDeactivated=function(e){},t.prototype.subTreeMonitoringActivated=function(e){},t.prototype.subTreeMonitoringDeactivated=function(e){},t.prototype.inSubTreeActivated=function(e,t){},t.prototype.inSubTreeDeactivated=function(e,t){},t.prototype.inSubTreeOnlyAsRootActivated=function(e,t){},t.prototype.inSubTreeOnlyAsRootDeactivated=function(e,t){},t.prototype.inSubTreeWithAttrActivated=function(e,t){},t.prototype.inSubTreeWithAttrDeactivated=function(e,t){},t}(IdentityIndexer);QueryCalc.prototype.destroy=queryCalcDestroy,QueryCalc.prototype.getId=queryCalcGetId,QueryCalc.prototype.assignAsRoot=queryCalcAssignAsRoot,QueryCalc.prototype.removeTheRoot=queryCalcRemoveTheRoot,QueryCalc.prototype.isRoot=queryCalcIsRoot,QueryCalc.prototype.addSubNode=queryCalcAddSubNode,QueryCalc.prototype.removeSubNode=queryCalcRemoveSubNode,QueryCalc.prototype.addUpdatedSubNode=queryCalcAddUpdatedSubNode,QueryCalc.prototype.detachFromParent=queryCalcDetachFromParent,QueryCalc.prototype.isGeneratingProjectionTerminal=queryCalcIsGeneratingProjectionTerminal,inherit(InternalQueryCalc,QueryCalc),InternalQueryCalc.prototype.destroy=internalQueryCalcDestroy,InternalQueryCalc.prototype.detachFromIndexer=internalQueryCalcDetachFromIndexer,InternalQueryCalc.prototype.isSelection=internalQueryCalcIsSelection,InternalQueryCalc.prototype.isProjection=internalQueryCalcIsProjection,InternalQueryCalc.prototype.isUnion=internalQueryCalcIsUnion,InternalQueryCalc.prototype.isNegation=internalQueryCalcIsNegation,InternalQueryCalc.prototype.subProjMustAddMatches=internalQueryCalcSubProjMustAddMatches,InternalQueryCalc.prototype.shouldAddMatches=internalQueryCalcShouldAddMatches,InternalQueryCalc.prototype.isSelectionProjection=internalQueryCalcIsSelectionProjection,InternalQueryCalc.prototype.addsProjMatchesToSubNodes=internalQueryCalcAddsProjMatchesToSubNodes,InternalQueryCalc.prototype.lowerThanQueryPrefixFullMatches=internalQueryCalcLowerThanQueryPrefixFullMatches,InternalQueryCalc.prototype.getFullCountMatchPoints=internalQueryCalcGetFullCountMatchPoints,InternalQueryCalc.prototype.clearParent=internalQueryCalcClearParent,InternalQueryCalc.prototype.clearSubNode=internalQueryCalcClearSubNode,InternalQueryCalc.prototype.unsetMustAddMatches=internalQueryCalcUnsetMustAddMatches,InternalQueryCalc.prototype.unsetSelectionProjection=internalQueryCalcUnsetSelectionProjection,InternalQueryCalc.prototype.setSelectionProjection=internalQueryCalcSetSelectionProjection,InternalQueryCalc.prototype.refreshQuery=internalQueryCalcRefreshQuery,InternalQueryCalc.prototype.setMustAddMatches=internalQueryCalcSetMustAddMatches,InternalQueryCalc.prototype.setRootAsMatchParent=internalQueryCalcSetRootAsMatchParent,InternalQueryCalc.prototype.isSuspended=internalQueryCalcIsSuspended,InternalQueryCalc.prototype.isSuspendedProjection=internalQueryCalcIsSuspendedProjection,InternalQueryCalc.prototype.suspend=internalQueryCalcSuspend,InternalQueryCalc.prototype.suspendProjection=internalQueryCalcSuspendProjection,InternalQueryCalc.prototype.unsuspend=internalQueryCalcUnsuspend,InternalQueryCalc.prototype.getFullMatchCount=internalQueryCalcGetFullMatchCount,InternalQueryCalc.prototype.refreshProjMustGenerateMatches=internalQueryCalcRefreshProjMustGenerateMatches,InternalQueryCalc.prototype.setProjMatches=internalQueryCalcSetProjMatches,InternalQueryCalc.prototype.addSelectionProjMatches=internalQueryCalcAddSelectionProjMatches,InternalQueryCalc.prototype.calcNewSelectionProjMatches=internalQueryCalcCalcNewSelectionProjMatches,InternalQueryCalc.prototype.addProjMatchesDoNothing=internalQueryCalcAddProjMatchesDoNothing,InternalQueryCalc.prototype.removeSelectionProjMatches=internalQueryCalcRemoveSelectionProjMatches,InternalQueryCalc.prototype.removeProjMatchesDoNothing=internalQueryCalcRemoveProjMatchesDoNothing,InternalQueryCalc.prototype.lowerToProjMatchPoints=internalQueryCalcLowerToProjMatchPoints,InternalQueryCalc.prototype.initEmptyProjMatches=internalQueryCalcInitEmptyProjMatches,InternalQueryCalc.prototype.makeEmptyProjMatchArrays=internalQueryCalcMakeEmptyProjMatchArrays,InternalQueryCalc.prototype.removeResultProjMatches=internalQueryCalcRemoveResultProjMatches,InternalQueryCalc.prototype.initExplicitProjMatches=internalQueryCalcInitExplicitProjMatches,InternalQueryCalc.prototype.setExplicitProjMatches=internalQueryCalcSetExplicitProjMatches,InternalQueryCalc.prototype.releaseExplicitProjMatches=internalQueryCalcReleaseExplicitProjMatches,InternalQueryCalc.prototype.getMatches=internalQueryCalcGetMatches,InternalQueryCalc.prototype.getMatchesAsObj=internalQueryCalcGetMatchesAsObj,InternalQueryCalc.prototype.getFullyRaisedMatches=internalQueryCalcGetFullyRaisedMatches,InternalQueryCalc.prototype.getFullyRaisedMatchesAsObj=internalQueryCalcGetFullyRaisedMatchesAsObj,InternalQueryCalc.prototype.getProjMatches=internalQueryCalcGetProjMatches,InternalQueryCalc.prototype.getProjMatchesAsObj=internalQueryCalcGetProjMatchesAsObj,InternalQueryCalc.prototype.getProjMatchesEntry=internalQueryCalcGetProjMatchesEntry,InternalQueryCalc.prototype.filterMatches=internalQueryCalcFilterMatches,InternalQueryCalc.prototype.filterMatchPositions=internalQueryCalcFilterMatchPositions,InternalQueryCalc.prototype.filterProjMatches=internalQueryCalcFilterProjMatches,inherit(PairwiseDisjoint,RedBlackTree),PairwiseDisjoint.prototype.isDisjoint=pairwiseDisjointIsDisjoint,PairwiseDisjoint.prototype.isDisjointInterval=pairwiseDisjointIsDisjointInterval,PairwiseDisjoint.prototype.isDisjointId=pairwiseDisjointIsDisjointId,PairwiseDisjoint.prototype.isDisjointEnd=pairwiseDisjointIsDisjointEnd,PairwiseDisjoint.prototype.getIntervalNode=pairwiseDisjointGetIntervalNode,PairwiseDisjoint.prototype.isDisjointValue=pairwiseDisjointIsDisjointValue,PairwiseDisjoint.prototype.isDisjointRange=pairwiseDisjointIsDisjointRange,PairwiseDisjoint.prototype.getCoveringIntervalId=pairwiseDisjointGetCoveringIntervalId,PairwiseDisjoint.prototype.addInterval=pairwiseDisjointAddInterval,PairwiseDisjoint.prototype.removeInterval=pairwiseDisjointRemoveInterval,PairwiseDisjoint.prototype.modifyInterval=pairwiseDisjointModifyInterval,PairwiseDisjoint.prototype.extendStartCount=pairwiseDisjointExtendStartCount,PairwiseDisjoint.prototype.reduceStartCount=pairwiseDisjointReduceStartCount,PairwiseDisjoint.prototype.increaseStartCount=pairwiseDisjointIncreaseStartCount,PairwiseDisjoint.prototype.decreaseStartCount=pairwiseDisjointDecreaseStartCount,PairwiseDisjoint.prototype.findDisjointIntervalStart=pairwiseDisjointFindDisjointIntervalStart,PairwiseDisjoint.prototype.findCoveringDisjointInterval=pairwiseDisjointFindCoveringDisjointInterval,PairwiseDisjoint.prototype.isJustRestoredDisjointEnd=pairwiseDisjointIsJustRestoredDisjointEnd,PairwiseDisjoint.prototype.updateStart=pairwiseDisjointUpdateStart,PairwiseDisjoint.prototype.updateEnd=pairwiseDisjointUpdateEnd,PairwiseDisjoint.prototype.startsWithStart=pairwiseDisjointStartsWithStart,PairwiseDisjoint.prototype.endsWithStart=pairwiseDisjointEndsWithStart,inherit(SimpleQueryCalc,InternalQueryCalc),SimpleQueryCalc.prototype.destroy=simpleQueryCalcDestroy,SimpleQueryCalc.prototype.isSelection=simpleQueryCalcIsSelection,SimpleQueryCalc.prototype.isProjection=simpleQueryCalcIsProjection,SimpleQueryCalc.prototype.isGeneratingProjection=simpleQueryCalcIsGeneratingProjection,SimpleQueryCalc.prototype.addValue=simpleQueryCalcAddValue,SimpleQueryCalc.prototype.removeValue=simpleQueryCalcRemoveValue,SimpleQueryCalc.prototype.getValueType=simpleQueryCalcGetValueType,SimpleQueryCalc.prototype.getDisjointValueIds=simpleQueryCalcGetDisjointValueIds;var queryNextUniqueValueId=1025;SimpleQueryCalc.prototype.newUniqueValueId=simpleQueryCalcNewUniqueValueId,SimpleQueryCalc.prototype.setMatchPoints=simpleQueryCalcSetMatchPoints,SimpleQueryCalc.prototype.addToMatchPoints=simpleQueryCalcAddToMatchPoints,SimpleQueryCalc.prototype.removeFromMatchPoints=simpleQueryCalcRemoveFromMatchPoints,SimpleQueryCalc.prototype.refreshQueryStructure=simpleQueryCalcRefreshQueryStructure,SimpleQueryCalc.prototype.unsetSelectionProjection=simpleQueryCalcUnsetSelectionProjection,SimpleQueryCalc.prototype.setSelectionProjection=simpleQueryCalcSetSelectionProjection,SimpleQueryCalc.prototype.refreshMatchPoints=simpleQueryCalcRefreshMatchPoints,SimpleQueryCalc.prototype.refreshMatches=simpleQueryCalcRefreshMatches,SimpleQueryCalc.prototype.addValueByType=simpleQueryCalcAddValueByType,SimpleQueryCalc.prototype.updateKeyInPairwiseDisjoint=simpleQueryCalcUpdateKeyInPairwiseDisjoint,SimpleQueryCalc.prototype.updateDisjointIntervalModifications=simpleQueryCalcUpdateDisjointIntervalModifications,SimpleQueryCalc.prototype.addDisjointIntervalToQuery=simpleQueryCalcAddDisjointIntervalToQuery,SimpleQueryCalc.prototype.removeValueByType=simpleQueryCalcRemoveValueByType,SimpleQueryCalc.prototype.alignChangedValues=simpleQueryCalcAlignChangedValues,SimpleQueryCalc.prototype.prepareValueChangeAlignment=simpleQueryCalcPrepareValueChangeAlignment,SimpleQueryCalc.prototype.findFreeOverlappingUniqueIds=simpleQueryCalcFindFreeOverlappingUniqueIds,SimpleQueryCalc.prototype.valuesOverlap=simpleQueryCalcValuesOverlap,SimpleQueryCalc.prototype.suspendProjMatches=simpleQueryCalcSuspendProjMatches,SimpleQueryCalc.prototype.setSelectionMode=simpleQueryCalcSetSelectionMode,SimpleQueryCalc.prototype.setProjectionMode=simpleQueryCalcSetProjectionMode,SimpleQueryCalc.prototype.setSuspendedProjectionMode=simpleQueryCalcSetSuspendedProjectionMode,SimpleQueryCalc.prototype.createMatchTable=simpleQueryCalcCreateMatchTable,SimpleQueryCalc.prototype.matchCountRequired=simpleQueryCalcMatchCountRequired,SimpleQueryCalc.prototype.addMatches=simpleQueryCalcAddMatches,SimpleQueryCalc.prototype.removeMatches=simpleQueryCalcRemoveMatches,SimpleQueryCalc.prototype.updateMatchCount=simpleQueryCalcUpdateMatchCount,SimpleQueryCalc.prototype.updateQueuedMatches=simpleQueryCalcUpdateQueuedMatches,SimpleQueryCalc.prototype.removeAllIndexerMatches=simpleQueryCalcRemoveAllIndexerMatches,SimpleQueryCalc.prototype.propagateMatchUpdates=simpleQueryCalcPropagateMatchUpdates,SimpleQueryCalc.prototype.getMatches=simpleQueryCalcGetMatches,SimpleQueryCalc.prototype.getMatchesAsObj=simpleQueryCalcGetMatchesAsObj,SimpleQueryCalc.prototype.getFullyRaisedMatches=simpleQueryCalcGetFullyRaisedMatches,SimpleQueryCalc.prototype.getFullyRaisedMatchesAsObj=simpleQueryCalcGetFullyRaisedMatchesAsObj,SimpleQueryCalc.prototype.filterMatches=simpleQueryCalcFilterMatches,SimpleQueryCalc.prototype.filterMatchPositions=simpleQueryCalcFilterMatchPositions,SimpleQueryCalc.prototype.addProjMatches=simpleQueryCalcAddProjMatches,SimpleQueryCalc.prototype.addNewSelectionProjMatches=simpleQueryCalcAddNewSelectionProjMatches,SimpleQueryCalc.prototype.removeProjMatches=simpleQueryCalcRemoveProjMatches,SimpleQueryCalc.prototype.removeOldSelectionProjMatches=simpleQueryCalcRemoveOldSelectionProjMatches,inherit(ProjectionQueryCalc,InternalQueryCalc),ProjectionQueryCalc.prototype.destroy=projectionQueryCalcDestroy,ProjectionQueryCalc.prototype.isSelection=projectionQueryCalcIsSelection,ProjectionQueryCalc.prototype.isProjection=projectionQueryCalcIsProjection,ProjectionQueryCalc.prototype.isGeneratingProjection=projectionQueryCalcIsGeneratingProjection,ProjectionQueryCalc.prototype.isTrivialProj=projectionQueryCalcIsTrivialProj,ProjectionQueryCalc.prototype.isPureProj=projectionQueryCalcIsPureProj,ProjectionQueryCalc.prototype.hasExplicitProjMatches=projectionQueryCalcHasExplicitProjMatches,ProjectionQueryCalc.prototype.needsToRegisterToIndexerForMatches=projectionQueryCalcNeedsToRegisterToIndexerForMatches,ProjectionQueryCalc.prototype.registerToIndexer=projectionQueryCalcRegisterToIndexer,ProjectionQueryCalc.prototype.refreshMustGenerateMatches=projectionQueryCalcRefreshMustGenerateMatches,ProjectionQueryCalc.prototype.refreshProjMustGenerateMatches=projectionQueryCalcRefreshProjMustGenerateMatches,ProjectionQueryCalc.prototype.removeResultProjMatches=projectionQueryCalcRemoveResultProjMatches,ProjectionQueryCalc.prototype.setMatchPoints=projectionQueryCalcSetMatchPoints,ProjectionQueryCalc.prototype.addToMatchPoints=projectionQueryCalcAddToMatchPoints,ProjectionQueryCalc.prototype.removeFromMatchPoints=projectionQueryCalcRemoveFromMatchPoints,ProjectionQueryCalc.prototype.refreshQueryStructure=projectionQueryCalcRefreshQueryStructure,ProjectionQueryCalc.prototype.refreshMatchPoints=projectionQueryCalcRefreshMatchPoints,ProjectionQueryCalc.prototype.refreshMatches=projectionQueryCalcRefreshMatches,ProjectionQueryCalc.prototype.suspendProjMatches=projectionQueryCalcSuspendProjMatches,ProjectionQueryCalc.prototype.setSelectionMode=projectionQueryCalcSetSelectionMode,ProjectionQueryCalc.prototype.setProjectionMode=projectionQueryCalcSetProjectionMode,ProjectionQueryCalc.prototype.setSuspendedProjectionMode=projectionQueryCalcSetSuspendedProjectionMode,ProjectionQueryCalc.prototype.addMatches=projectionQueryCalcAddMatches,ProjectionQueryCalc.prototype.addMatchesToMustGenerateMatches=projectionQueryCalcAddMatchesToMustGenerateMatches,ProjectionQueryCalc.prototype.removeMatches=projectionQueryCalcRemoveMatches,ProjectionQueryCalc.prototype.removeMatchesFromMustGenerateMatches=projectionQueryCalcRemoveMatchesFromMustGenerateMatches,ProjectionQueryCalc.prototype.removeAllIndexerMatches=projectionQueryCalcRemoveAllIndexerMatches,ProjectionQueryCalc.prototype.addProjMatches=projectionQueryCalcAddProjMatches,ProjectionQueryCalc.prototype.removeProjMatches=projectionQueryCalcRemoveProjMatches,ProjectionQueryCalc.prototype.setProjMatches=projectionQueryCalcSetProjMatches,ProjectionQueryCalc.prototype.checkRequiredExplicitProjMatches=projectionQueryCalcCheckRequiredExplicitProjMatches,ProjectionQueryCalc.prototype.initExplicitProjMatches=projectionQueryCalcInitExplicitProjMatches,ProjectionQueryCalc.prototype.setExplicitProjMatches=projectionQueryCalcSetExplicitProjMatches,ProjectionQueryCalc.prototype.releaseExplicitProjMatches=projectionQueryCalcReleaseExplicitProjMatches,ProjectionQueryCalc.prototype.getMatches=projectionQueryCalcGetMatches,ProjectionQueryCalc.prototype.getMatchesAsObj=projectionQueryCalcGetMatchesAsObj,ProjectionQueryCalc.prototype.getFullyRaisedMatches=projectionQueryCalcGetFullyRaisedMatches,ProjectionQueryCalc.prototype.getFullyRaisedMatchesAsObj=projectionQueryCalcGetFullyRaisedMatchesAsObj,ProjectionQueryCalc.prototype.filterMatches=projectionQueryCalcFilterMatches,ProjectionQueryCalc.prototype.filterMatchPositions=projectionQueryCalcFilterMatchPositions,ProjectionQueryCalc.prototype.getProjMatches=projectionQueryCalcGetProjMatches,ProjectionQueryCalc.prototype.getProjMatchesAsObj=projectionQueryCalcGetProjMatchesAsObj,InternalQueryCalc.prototype.getExplicitProjMatches=internalQueryCalcGetExplicitProjMatches,ProjectionQueryCalc.prototype.filterProjMatches=projectionQueryCalcFilterProjMatches,inherit(UnionQueryCalc,InternalQueryCalc),UnionQueryCalc.prototype.destroy=unionQueryCalcDestroy,UnionQueryCalc.prototype.splice=unionQueryCalcSplice,UnionQueryCalc.prototype.isProjection=unionQueryCalcIsProjection,UnionQueryCalc.prototype.isUnion=unionQueryCalcIsUnion,UnionQueryCalc.prototype.shouldAddMatches=unionQueryCalcShouldAddMatches,UnionQueryCalc.prototype.isGeneratingProjection=unionQueryCalcIsGeneratingProjection,UnionQueryCalc.prototype.isSelectionProjection=unionQueryCalcIsSelectionProjection,UnionQueryCalc.prototype.addToMatchPoints=unionQueryCalcAddToMatchPoints,UnionQueryCalc.prototype.removeFromMatchPoints=unionQueryCalcRemoveFromMatchPoints,UnionQueryCalc.prototype.updateQueryAfterNodeRemoval=unionQueryCalcUpdateQueryAfterNodeRemoval,UnionQueryCalc.prototype.updateMatchingAfterRemoval=unionQueryCalcUpdateMatchingAfterRemoval,UnionQueryCalc.prototype.unsetSubProjsMustAddMatches=unionQueryCalcUnsetSubProjsMustAddMatches,UnionQueryCalc.prototype.refreshQueryStructure=unionQueryCalcRefreshQueryStructure,UnionQueryCalc.prototype.setSubProjsMustAddMatches=unionQueryCalcSetSubProjsMustAddMatches,UnionQueryCalc.prototype.refreshMatchPoints=unionQueryCalcRefreshMatchPoints,UnionQueryCalc.prototype.refreshMatches=unionQueryCalcRefreshMatches,UnionQueryCalc.prototype.suspendProjMatches=unionQueryCalcSuspendProjMatches,UnionQueryCalc.prototype.setSelectionMode=unionQueryCalcSetSelectionMode,UnionQueryCalc.prototype.setProjectionMode=unionQueryCalcSetProjectionMode,UnionQueryCalc.prototype.setSuspendedProjectionMode=unionQueryCalcSetSuspendedProjectionMode,UnionQueryCalc.prototype.addMatches=unionQueryCalcAddMatches,UnionQueryCalc.prototype.removeMatches=unionQueryCalcRemoveMatches,UnionQueryCalc.prototype.setProjMatches=unionQueryCalcSetProjMatches,UnionQueryCalc.prototype.addProjMatches=unionQueryCalcAddProjMatches,UnionQueryCalc.prototype.removeProjMatches=unionQueryCalcRemoveProjMatches,UnionQueryCalc.prototype.getProjMatches=unionQueryCalcGetProjMatches,UnionQueryCalc.prototype.filterProjMatches=unionQueryCalcFilterProjMatches,inherit(NegationQueryCalc,InternalQueryCalc),NegationQueryCalc.prototype.destroy=negationQueryCalcDestroy,NegationQueryCalc.prototype.maxMatchCount=negationQueryCalcMaxMatchCount,NegationQueryCalc.prototype.isSelection=negationQueryCalcIsSelection,NegationQueryCalc.prototype.isProjection=negationQueryCalcIsProjection,NegationQueryCalc.prototype.isNegation=negationQueryCalcIsNegation,NegationQueryCalc.prototype.isGeneratingProjection=negationQueryCalcIsGeneratingProjection,NegationQueryCalc.prototype.setMatchPoints=negationQueryCalcSetMatchPoints,NegationQueryCalc.prototype.addToMatchPoints=negationQueryCalcAddToMatchPoints,NegationQueryCalc.prototype.removeFromMatchPoints=negationQueryCalcRemoveFromMatchPoints,NegationQueryCalc.prototype.updateQueryAfterNodeRemoval=negationQueryCalcUpdateQueryAfterNodeRemoval,NegationQueryCalc.prototype.unsetSubProjsMustAddMatches=negationQueryCalcUnsetSubProjsMustAddMatches,NegationQueryCalc.prototype.updateMatchingAfterRemoval=negationQueryCalcUpdateMatchingAfterRemoval,NegationQueryCalc.prototype.updateMatchPointsAfterRemoval=negationQueryCalcUpdateMatchPointsAfterRemoval,NegationQueryCalc.prototype.refreshQueryStructure=negationQueryCalcRefreshQueryStructure,NegationQueryCalc.prototype.setSubProjsMustAddMatches=negationQueryCalcSetSubProjsMustAddMatches,NegationQueryCalc.prototype.refreshMatchPoints=negationQueryCalcRefreshMatchPoints,NegationQueryCalc.prototype.refreshMatches=negationQueryCalcRefreshMatches,NegationQueryCalc.prototype.initialRefreshMatches=negationQueryCalcInitialRefreshMatches,NegationQueryCalc.prototype.suspendSelection=negationQueryCalcSuspendSelection,NegationQueryCalc.prototype.suspendProjMatches=negationQueryCalcSuspendProjMatches,NegationQueryCalc.prototype.calcNewFullMatchesAfterSuspension=negationQueryCalcCalcNewFullMatchesAfterSuspension,NegationQueryCalc.prototype.calcRemovedSuspendedMatches=negationQueryCalcCalcRemovedSuspendedMatches,NegationQueryCalc.prototype.setSelectionMode=negationQueryCalcSetSelectionMode,NegationQueryCalc.prototype.setProjectionMode=negationQueryCalcSetProjectionMode,NegationQueryCalc.prototype.setSuspendedMode=negationQueryCalcSetSuspendedMode,NegationQueryCalc.prototype.setSuspendedProjectionMode=negationQueryCalcSetSuspendedProjectionMode,NegationQueryCalc.prototype.initProjSelectionMatches=negationQueryCalcInitProjSelectionMatches,NegationQueryCalc.prototype.clearProjSelectionMatches=negationQueryCalcClearProjSelectionMatches,NegationQueryCalc.prototype.addMatches=negationQueryCalcAddMatches,NegationQueryCalc.prototype.removeMatches=negationQueryCalcRemoveMatches,NegationQueryCalc.prototype.addIndexerMatches=negationQueryCalcAddIndexerMatches,NegationQueryCalc.prototype.removeIndexerMatches=negationQueryCalcRemoveIndexerMatches,NegationQueryCalc.prototype.applyPendingUpdates=negationQueryCalcApplyPendingUpdates,NegationQueryCalc.prototype.removeAllIndexerMatches=negationQueryCalcRemoveAllIndexerMatches,NegationQueryCalc.prototype.addSelectionMatches=negationQueryCalcAddSelectionMatches,NegationQueryCalc.prototype.removeSelectionMatches=negationQueryCalcRemoveSelectionMatches,NegationQueryCalc.prototype.addProjSelectionMatches=negationQueryCalcAddProjSelectionMatches,NegationQueryCalc.prototype.removeProjSelectionMatches=negationQueryCalcRemoveProjSelectionMatches,NegationQueryCalc.prototype.disableProjUpdateAndAddMatchesToParent=negationQueryCalcDisableProjUpdateAndAddMatchesToParent,NegationQueryCalc.prototype.disableProjUpdateAndRemoveMatchesFromParent=negationQueryCalcDisableProjUpdateAndRemoveMatchesFromParent,NegationQueryCalc.prototype.addProjMatches=negationQueryCalcAddProjMatches,NegationQueryCalc.prototype.removeProjMatches=negationQueryCalcRemoveProjMatches,NegationQueryCalc.prototype.addNewMatchesToProjMatches=negationQueryCalcAddNewMatchesToProjMatches,NegationQueryCalc.prototype.lowerProjMatchesAndAdd=negationQueryCalcLowerProjMatchesAndAdd,NegationQueryCalc.prototype.removeOldMatchesFromProjMatches=negationQueryCalcRemoveOldMatchesFromProjMatches,NegationQueryCalc.prototype.lowerAndRemoveProjMatches=negationQueryCalcLowerAndRemoveProjMatches,
NegationQueryCalc.prototype.resetProjMatchesAfterNodeRemoval=negationQueryCalcResetProjMatchesAfterNodeRemoval,NegationQueryCalc.prototype.getMatches=negationQueryCalcGetMatches,NegationQueryCalc.prototype.getMatchesAsObj=negationQueryCalcGetMatchesAsObj,NegationQueryCalc.prototype.getFullyRaisedMatches=negationQueryCalcGetFullyRaisedMatches,NegationQueryCalc.prototype.getFullyRaisedMatchesAsObj=negationQueryCalcGetFullyRaisedMatchesAsObj,NegationQueryCalc.prototype.filterMatches=negationQueryCalcFilterMatches,NegationQueryCalc.prototype.filterMatchPositions=negationQueryCalcFilterMatchPositions,NegationQueryCalc.prototype.getProjMatches=negationQueryCalcGetProjMatches,NegationQueryCalc.prototype.filterProjMatches=negationQueryCalcFilterProjMatches,inherit(TrueQueryCalc,NegationQueryCalc),TrueQueryCalc.prototype.destroy=trueQueryCalcDestroy,inherit(IntersectionQueryCalc,InternalQueryCalc),IntersectionQueryCalc.prototype.destroy=intersectionQueryCalcDestroy,IntersectionQueryCalc.prototype.isProjection=intersectionQueryCalcIsProjection,IntersectionQueryCalc.prototype.subProjMustAddMatches=intersectionQueryCalcSubProjMustAddMatches,IntersectionQueryCalc.prototype.isGeneratingProjection=intersectionQueryCalcIsGeneratingProjection,IntersectionQueryCalc.prototype.isGeneratingProjectionTerminal=intersectionQueryCalcIsGeneratingProjectionTerminal,IntersectionQueryCalc.prototype.addsProjMatchesToSubNodes=intersectionQueryCalcAddsProjMatchesToSubNodes,IntersectionQueryCalc.prototype.calcMaxMatchPointCount=intersectionQueryCalcCalcMaxMatchPointCount,IntersectionQueryCalc.prototype.calcRaisingRequired=intersectionQueryCalcCalcRaisingRequired,IntersectionQueryCalc.prototype.calcLoweringRequired=intersectionQueryCalcCalcLoweringRequired,IntersectionQueryCalc.prototype.calcMaxCountIsFullMatch=intersectionQueryCalcCalcMaxCountIsFullMatch,IntersectionQueryCalc.prototype.lowerThanQueryPrefixFullMatches=intersectionQueryCalcLowerThanQueryPrefixFullMatches,IntersectionQueryCalc.prototype.getFullCountMatchPoints=intersectionQueryCalcGetFullCountMatchPoints,IntersectionQueryCalc.prototype.topMatchPointUpdatedForAll=intersectionQueryCalcTopMatchPointUpdatedForAll,IntersectionQueryCalc.prototype.addToMatchPoints=intersectionQueryCalcAddToMatchPoints,IntersectionQueryCalc.prototype.addToProjMatchPoints=intersectionQueryCalcAddToProjMatchPoints,IntersectionQueryCalc.prototype.increaseMatchPointCount=intersectionQueryCalcIncreaseMatchPointCount,IntersectionQueryCalc.prototype.removeFromMatchPoints=intersectionQueryCalcRemoveFromMatchPoints,IntersectionQueryCalc.prototype.decreaseProjMatchPointCount=intersectionQueryCalcDecreaseProjMatchPointCount,IntersectionQueryCalc.prototype.decreaseMatchPointCount=intersectionQueryCalcDecreaseMatchPointCount,IntersectionQueryCalc.prototype.updateQueryAfterNodeRemoval=intersectionQueryCalcUpdateQueryAfterNodeRemoval,IntersectionQueryCalc.prototype.unsetSubProjsMustAddMatches=intersectionQueryCalcUnsetSubProjsMustAddMatches,IntersectionQueryCalc.prototype.updateMatchingAfterRemoval=intersectionQueryCalcUpdateMatchingAfterRemoval,IntersectionQueryCalc.prototype.removeSubNodeMatchPoints=intersectionQueryCalcRemoveSubNodeMatchPoints,IntersectionQueryCalc.prototype.removeSubNodeMatchPointsAsProj=intersectionQueryCalcRemoveSubNodeMatchPointsAsProj,IntersectionQueryCalc.prototype.addSubNodeMatchPoints=intersectionQueryCalcAddSubNodeMatchPoints,IntersectionQueryCalc.prototype.refreshQueryStructure=intersectionQueryCalcRefreshQueryStructure,IntersectionQueryCalc.prototype.setSubProjsMustAddMatches=intersectionQueryCalcSetSubProjsMustAddMatches,IntersectionQueryCalc.prototype.refreshMatchPoints=intersectionQueryCalcRefreshMatchPoints;IntersectionQueryCalc.prototype.refreshMatches=intersectionQueryCalcRefreshMatches;IntersectionQueryCalc.prototype.suspendSelection=intersectionQueryCalcSuspendSelection,IntersectionQueryCalc.prototype.suspendProjMatches=intersectionQueryCalcSuspendProjMatches,IntersectionQueryCalc.prototype.calcNewFullMatchesAfterSuspension=intersectionQueryCalcCalcNewFullMatchesAfterSuspension,IntersectionQueryCalc.prototype.calcRemovedSuspendedMatches=intersectionQueryCalcCalcRemovedSuspendedMatches,IntersectionQueryCalc.prototype.setMode=intersectionQueryCalcSetMode,IntersectionQueryCalc.prototype.setSelectionMode=intersectionQueryCalcSetSelectionMode,IntersectionQueryCalc.prototype.setProjectionMode=intersectionQueryCalcSetProjectionMode,IntersectionQueryCalc.prototype.setSuspendedMode=intersectionQueryCalcSetSuspendedMode,IntersectionQueryCalc.prototype.setSuspendedProjectionMode=intersectionQueryCalcSetSuspendedProjectionMode,IntersectionQueryCalc.prototype.getFullMatchCount=intersectionQueryCalcGetFullMatchCount,IntersectionQueryCalc.prototype.addMatchesWithRaising=intersectionQueryCalcAddMatchesWithRaising,IntersectionQueryCalc.prototype.calcNewMatchesWithRaising=intersectionQueryCalcCalcNewMatchesWithRaising,IntersectionQueryCalc.prototype.addMatchesToProj=intersectionQueryCalcAddMatchesToProj,IntersectionQueryCalc.prototype.calcNewMatchesInProj=intersectionQueryCalcCalcNewMatchesInProj,IntersectionQueryCalc.prototype.addMatchesWithoutRaising=intersectionQueryCalcAddMatchesWithoutRaising,IntersectionQueryCalc.prototype.disableProjUpdateAndAddMatchesToParent=intersectionQueryCalcDisableProjUpdateAndAddMatchesToParent,IntersectionQueryCalc.prototype.addMatchesToSuspended=intersectionQueryCalcAddMatchesToSuspended,IntersectionQueryCalc.prototype.addProjMatchesToAdding=intersectionQueryCalcAddProjMatchesToAdding,IntersectionQueryCalc.prototype.lowerProjMatchesAndAdd=intersectionQueryCalcLowerProjMatchesAndAdd,IntersectionQueryCalc.prototype.lowerToPureProjMatchPoints=intersectionQueryCalcLowerToPureProjMatchPoints,IntersectionQueryCalc.prototype.addProjMatchesWithLowering=intersectionQueryCalcAddProjMatchesWithLowering,IntersectionQueryCalc.prototype.addProjMatchesWithoutLowering=intersectionQueryCalcAddProjMatchesWithoutLowering,IntersectionQueryCalc.prototype.addProjMatchesToAddingSelectionProj=intersectionQueryCalcAddProjMatchesToAddingSelectionProj,IntersectionQueryCalc.prototype.addProjMatchesToSelectionProj=intersectionQueryCalcAddProjMatchesToSelectionProj,IntersectionQueryCalc.prototype.removeMatchesWithRaising=intersectionQueryCalcRemoveMatchesWithRaising,IntersectionQueryCalc.prototype.removeMatchesFromProj=intersectionQueryCalcRemoveMatchesFromProj,IntersectionQueryCalc.prototype.removeMatchesWithoutRaising=intersectionQueryCalcRemoveMatchesWithoutRaising,IntersectionQueryCalc.prototype.removeMatchesFromSuspended=intersectionQueryCalcRemoveMatchesFromSuspended,IntersectionQueryCalc.prototype.disableProjUpdateAndRemoveMatchesFromParent=intersectionQueryCalcDisableProjUpdateAndRemoveMatchesFromParent,IntersectionQueryCalc.prototype.removeProjMatchesWithLowering=intersectionQueryCalcRemoveProjMatchesWithLowering,IntersectionQueryCalc.prototype.removeProjMatchesWithoutLowering=intersectionQueryCalcRemoveProjMatchesWithoutLowering,IntersectionQueryCalc.prototype.removeMatchesFromRemovingSelectionProj=intersectionQueryCalcRemoveMatchesFromRemovingSelectionProj,IntersectionQueryCalc.prototype.removeProjMatchesFromSelectionProj=intersectionQueryCalcRemoveProjMatchesFromSelectionProj,IntersectionQueryCalc.prototype.getMatches=intersectionQueryCalcGetMatches,IntersectionQueryCalc.prototype.getMatchesAsObj=intersectionQueryCalcGetMatchesAsObj,IntersectionQueryCalc.prototype.getFullyRaisedMatches=intersectionQueryCalcGetFullyRaisedMatches,IntersectionQueryCalc.prototype.getFullyRaisedMatchesAsObj=intersectionQueryCalcGetFullyRaisedMatchesAsObj,IntersectionQueryCalc.prototype.filterMatches=intersectionQueryCalcFilterMatches,IntersectionQueryCalc.prototype.filterMatchPositions=intersectionQueryCalcFilterMatchPositions,IntersectionQueryCalc.prototype.getProjMatches=intersectionQueryCalcGetProjMatches,IntersectionQueryCalc.prototype.filterProjMatches=intersectionQueryCalcFilterProjMatches,RootQueryCalc.prototype.getId=rootQueryCalcGetId,inherit(InternalRootQueryCalc,RootQueryCalc),InternalRootQueryCalc.prototype.destroy=internalRootQueryCalcDestroy,InternalRootQueryCalc.prototype.getQCMKey=internalRootQueryCalcGetQCMKey,InternalRootQueryCalc.prototype.getIndexer=internalRootQueryCalcGetIndexer,InternalRootQueryCalc.prototype.hasMultipleProjPaths=internalRootQueryCalcHasMultipleProjPaths,InternalRootQueryCalc.prototype.getTerminalGeneratingProjNum=internalRootQueryCalcGetTerminalGeneratingProjNum,InternalRootQueryCalc.prototype.getProjectionPathId=internalRootQueryCalcGetProjectionPathId,InternalRootQueryCalc.prototype.isSelection=internalRootQueryCalcIsSelection,InternalRootQueryCalc.prototype.isProjection=internalRootQueryCalcIsProjection,InternalRootQueryCalc.prototype.isPureProjection=internalRootQueryCalcIsPureProjection,InternalRootQueryCalc.prototype.isTrivialProjection=internalRootQueryCalcIsTrivialProjection,InternalRootQueryCalc.prototype.hasExplicitProjMatches=internalRootQueryCalcHasExplicitProjMatches,InternalRootQueryCalc.prototype.isCompiled=internalRootQueryCalcIsCompiled,InternalRootQueryCalc.prototype.needToLower=internalRootQueryCalcNeedToLower,InternalRootQueryCalc.prototype.getQueryResults=internalRootQueryCalcGetQueryResults,InternalRootQueryCalc.prototype.getSingleGeneratingProj=internalRootQueryCalcGetSingleGeneratingProj,InternalRootQueryCalc.prototype.addQueryResult=internalRootQueryCalcAddQueryResult,InternalRootQueryCalc.prototype.removeQueryResult=internalRootQueryCalcRemoveQueryResult,InternalRootQueryCalc.prototype.newIntersectionQueryCalc=internalRootQueryCalcNewIntersectionQueryCalc,InternalRootQueryCalc.prototype.newUnionQueryCalc=internalRootQueryCalcNewUnionQueryCalc,InternalRootQueryCalc.prototype.newNegationQueryCalc=internalRootQueryCalcNewNegationQueryCalc,InternalRootQueryCalc.prototype.newSimpleQueryCalc=internalRootQueryCalcNewSimpleQueryCalc,InternalRootQueryCalc.prototype.newProjectionQueryCalc=internalRootQueryCalcNewProjectionQueryCalc,InternalRootQueryCalc.prototype.newTrueQueryCalc=internalRootQueryCalcNewTrueQueryCalc,InternalRootQueryCalc.prototype.refreshQuery=internalRootQueryCalcRefreshQuery,InternalRootQueryCalc.prototype.updateQueryAfterNodeRemoval=internalRootQueryCalcUpdateQueryAfterNodeRemoval,InternalRootQueryCalc.prototype.queryStructureRefreshed=internalRootQueryCalcQueryStructureRefreshed,InternalRootQueryCalc.prototype.assignQueryCalc=internalRootQueryCalcAssignQueryCalc,InternalRootQueryCalc.prototype.detachFromQueryCalc=internalRootQueryCalcDetachFromQueryCalc,InternalRootQueryCalc.prototype.addToMatchPoints=internalRootQueryCalcAddToMatchPoints,InternalRootQueryCalc.prototype.removeFromMatchPoints=internalRootQueryCalcRemoveFromMatchPoints,InternalRootQueryCalc.prototype.getDomain=internalRootQueryCalcGetDomain,InternalRootQueryCalc.prototype.getDomainAsObj=internalRootQueryCalcGetDomainAsObj,InternalRootQueryCalc.prototype.getMatches=internalRootQueryCalcGetMatches,InternalRootQueryCalc.prototype.getMatchesAsObj=internalRootQueryCalcGetMatchesAsObj,InternalRootQueryCalc.prototype.filterMatches=internalRootQueryCalcFilterMatches,InternalRootQueryCalc.prototype.filterMatchPositions=internalRootQueryCalcFilterMatchPositions,InternalRootQueryCalc.prototype.initializeMatching=internalRootQueryCalcInitializeMatching,InternalRootQueryCalc.prototype.addMatches=internalRootQueryCalcAddMatches,InternalRootQueryCalc.prototype.addMatchesToSelectionRoot=internalRootQueryCalcAddMatchesToSelectionRoot,InternalRootQueryCalc.prototype.queueAddAllMatchesToDominating=internalRootQueryCalcQueueAddAllMatchesToDominating,InternalRootQueryCalc.prototype.addAllMatchesToQueuedResults=internalRootQueryCalcAddAllMatchesToQueuedResults,InternalRootQueryCalc.prototype.removeMatches=internalRootQueryCalcRemoveMatches,InternalRootQueryCalc.prototype.removeMatchesFromSelectionRoot=internalRootQueryCalcRemoveMatchesFromSelectionRoot,InternalRootQueryCalc.prototype.removeAllSelectionMatches=internalRootQueryCalcRemoveAllSelectionMatches,InternalRootQueryCalc.prototype.refreshProjMustGenerateMatches=internalRootQueryCalcRefreshProjMustGenerateMatches,InternalRootQueryCalc.prototype.initExplicitProjMatches=internalRootQueryCalcInitExplicitProjMatches,InternalRootQueryCalc.prototype.setExplicitProjMatches=internalRootQueryCalcSetExplicitProjMatches,InternalRootQueryCalc.prototype.releaseExplicitProjMatches=internalRootQueryCalcReleaseExplicitProjMatches,InternalRootQueryCalc.prototype.getProjMatches=internalRootQueryCalcGetProjMatches,InternalRootQueryCalc.prototype.getProjMatchesAsObj=internalRootQueryCalcGetProjMatchesAsObj,InternalRootQueryCalc.prototype.filterProjMatches=internalRootQueryCalcFilterProjMatches,InternalRootQueryCalc.prototype.setProjMatches=internalRootQueryCalcSetProjMatches,InternalRootQueryCalc.prototype.addProjMatches=internalRootQueryCalcAddProjMatches,InternalRootQueryCalc.prototype.removeProjMatches=internalRootQueryCalcRemoveProjMatches,InternalRootQueryCalc.prototype.lowerProjMatches=internalRootQueryCalcLowerProjMatches,InternalRootQueryCalc.prototype.lowerProjMatchesAsObj=internalRootQueryCalcLowerProjMatchesAsObj,InternalRootQueryCalc.prototype.removeAllTerminalProjMatches=internalRootQueryCalcRemoveAllTerminalProjMatches,InternalRootQueryCalc.prototype.addAllTerminalProjMatches=internalRootQueryCalcAddAllTerminalProjMatches,InternalRootQueryCalc.prototype.getGeneratingProj=internalRootQueryCalcCalcGetGeneratingProj,InternalRootQueryCalc.prototype.isTerminalGeneratingProj=internalRootQueryCalcIsTerminalGeneratingProj,InternalRootQueryCalc.prototype.addSimpleGeneratingProj=internalRootQueryCalcAddSimpleGeneratingProj,InternalRootQueryCalc.prototype.addIntersectionGeneratingProj=internalRootQueryCalcAddIntersectionGeneratingProj,InternalRootQueryCalc.prototype.addSelectionGeneratingProj=internalRootQueryCalcAddSelectionGeneratingProj,InternalRootQueryCalc.prototype.removeGeneratingProj=internalRootQueryCalcRemoveGeneratingProj,InternalRootQueryCalc.prototype.findGeneratingParent=internalRootQueryCalcFindGeneratingParent,InternalRootQueryCalc.prototype.setGeneratingParent=internalRootQueryCalcSetGeneratingParent,InternalRootQueryCalc.prototype.calcMappedPathId=internalRootQueryCalcCalcMappedPathId,InternalRootQueryCalc.prototype.calcIntersectionGeneratingProjPath=internalRootQueryCalcCalcIntersectionGeneratingProjPath,InternalRootQueryCalc.prototype.addModifiedGeneratingProj=internalRootQueryCalcAddModifiedGeneratingProj,InternalRootQueryCalc.prototype.generatingProjMapping=internalRootQueryCalcGeneratingProjMapping,InternalRootQueryCalc.prototype.getGeneratingProjMappings=internalRootQueryCalcGetGeneratingProjMappings,InternalRootQueryCalc.prototype.getTerminalGeneratingProjs=internalRootQueryCalcGetTerminalGeneratingProjs,InternalRootQueryCalc.prototype.getTerminalProjMatches=internalRootQueryCalcGetTerminalProjMatches,InternalRootQueryCalc.prototype.filterTerminalProjMatches=internalRootQueryCalcFilterTerminalProjMatches,InternalRootQueryCalc.prototype.notifyModifiedGeneratingProjs=internalRootQueryCalcNotifyModifiedGeneratingProjs,NegationKey.prototype.addNegated=negationKeyAddNegated,NegationKey.prototype.removeNegated=negationKeyRemoveNegated,NegationKey.prototype.numNegated=negationKeyNumNegated,NegationKey.prototype.isNegated=negationKeyIsNegated,NegationKey.prototype.getNegated=negationKeyGetNegated,NegationKey.prototype.simpleCopy=negationKeySimpleCopy,inherit(Query,FuncResult),Query.prototype.destroy=queryDestroy,Query.prototype.lockActive=queryLockActive,Query.prototype.unlockActive=queryUnlockActive,Query.prototype.isProjection=queryIsProjection,Query.prototype.isPureProjection=queryIsPureProjection,Query.prototype.supportsMultiProj=querySupportsMultiProj,Query.prototype.isActive=queryIsActive,Query.prototype.deactivated=queryDeactivated,Query.prototype.refreshIndexerAndPaths=queryRefreshIndexerAndPaths,Query.prototype.addDataObjMatches=queryAddDataObjMatches,Query.prototype.removeDataObjMatches=queryRemoveDataObjMatches,Query.prototype.removeAllRootElements=queryRemoveAllRootElements,Query.prototype.detachFromIndexer=queryDetachFromIndexer,Query.prototype.addMatches=queryAddMatches,Query.prototype.addProjMatches=queryAddProjMatches,Query.prototype.removeMatches=queryRemoveMatches,Query.prototype.removeProjMatches=queryRemoveProjMatches,Query.prototype.newRootQueryCalc=queryNewRootQueryCalc,Query.prototype.addRootQueryCalcNode=queryAddRootQueryCalcNode,Query.prototype.addPendingRootQueryCalcs=queryAddPendingRootQueryCalcs,Query.prototype.removeRootQueryCalcNode=queryRemoveRootQueryCalcNode,Query.prototype.isSimpleType=queryIsSimpleType,Query.prototype.getParentDataElement=queryGetParentDataElement,Query.prototype.isPathPrefixOf=queryIsPathPrefixOf,Query.prototype.hasSiblings=queryHasSiblings,Query.prototype.getElementPathId=queryGetElementPathId,Query.prototype.getElementEntry=queryGetElementEntry,Query.prototype.removeElementEntry=queryRemoveElementEntry,Query.prototype.increaseChildCountAndUpdateNegation=queryIncreaseChildCountAndUpdateNegation,Query.prototype.decreaseChildCount=queryDecreaseChildCount,Query.prototype.getPathEntry=queryGetPathEntry,Query.prototype.queueUpdatePropagation=queryQueueUpdatePropagation,Query.prototype.addUpdate=queryAddUpdate,Query.prototype.removeUpdate=queryRemoveUpdate,Query.prototype.removeNegationUpdate=queryRemoveNegationUpdate,Query.prototype.removeDominatedUpdate=queryRemoveDominatedUpdate,Query.prototype.removePathEntry=queryRemovePathEntry,Query.prototype.removePropagation=queryRemovePropagation,Query.prototype.repropagateUnder=queryRepropagateUnder,Query.prototype.queueUpdateSourceForPropagation=queryQueueUpdateSourceForPropagation,Query.prototype.propagateUpdate=queryPropagateUpdate,Query.prototype.propagateQueuedPropagations=queryPropagateQueuedPropagations,Query.prototype.removeDominated=queryRemoveDominated,Query.prototype.updateSimpleElement=queryUpdateSimpleElement,Query.prototype.removeSimpleElement=queryRemoveSimpleElement,Query.prototype.completeUpdate=queryCompleteUpdate,Query.prototype.subTreeUpdate=querySubTreeUpdate,Query.prototype.refreshQuery=queryRefreshQuery,Query.prototype.getNegatedIds=queryGetNegatedIds,Query.prototype.updateNegationValue=queryUpdateNegationValue,Query.prototype.addNegation=queryAddNegation,Query.prototype.removeNegation=queryRemoveNegation,Query.prototype.createAllQueryCalcs=queryCreateAllQueryCalcs,Query.prototype.createNewQueryCalcs=queryCreateNewQueryCalcs,Query.prototype.addValueToSimpleQueryCalc=queryAddValueToSimpleQueryCalc,Query.prototype.destroyQueryCalc=queryDestroyQueryCalc,Query.prototype.destroyQueryCalcs=queryDestroyQueryCalcs,Query.prototype.removeSubQueryCalcs=queryRemoveSubQueryCalcs,Query.prototype.getQueryCalcsForElement=queryGetQueryCalcsForElement,Query.prototype.getQueryCalcsForPath=queryGetQueryCalcsForPath,Query.prototype.getQueryCalcsForPathEntry=queryGetQueryCalcsForPathEntry,Query.prototype.updateElementEntryQueryCalcs=queryUpdateElementEntryQueryCalcs,Query.prototype.removeAllElementEntryQueryCalcs=queryRemoveAllElementEntryQueryCalcs,Query.prototype.updatePathEntryQueryCalcs=queryUpdatePathEntryQueryCalcs,Query.prototype.updateDominatedEntryQueryCalcs=queryUpdateDominatedEntryQueryCalcs,Query.prototype.updateTerminalEntryQueryCalcs=queryUpdateTerminalEntryQueryCalcs,Query.prototype.removeAllTerminalEntryQueryCalcs=queryRemoveAllTerminalEntryQueryCalcs,Query.prototype.updateNegationEntryQueryCalcs=queryUpdateNegationEntryQueryCalcs,Query.prototype.updateUnionQueryCalcs=queryUpdateUnionQueryCalcs,Query.prototype.insertUnderUnionQueryCalcs=queryInsertUnderUnionQueryCalcs,Query.prototype.removePathEntryQueryCalcs=queryRemovePathEntryQueryCalcs,Query.prototype.removeDominatedEntryQueryCalcs=queryRemoveDominatedEntryQueryCalcs,Query.prototype.clearQueryCalcsAfterValueChange=queryClearQueryCalcsAfterValueChange,Query.prototype.generateQueryCalcs=queryGenerateQueryCalcs,Query.prototype.generateQueryCalcsFor=queryGenerateQueryCalcsFor;Query.prototype.generateQueryCalcsForNegated=queryGenerateQueryCalcsForNegated;Query.prototype.destroyQueryCalcsForRoot=queryDestroyQueryCalcsForRoot,Query.prototype.destroyQueryCalcsFor=queryDestroyQueryCalcsFor,Query.prototype.destroyQueryCalcAtDominatedEntries=queryDestroyQueryCalcAtDominatedEntries,Query.prototype.destroyQueryCalcForNegated=queryDestroyQueryCalcForNegated,Query.prototype.debugGetQueryDesc=queryDebugGetQueryDesc,Query.prototype.debugPrintQueryAndResults=queryDebugPrintQueryAndResults,inherit(IdQueryCalc,InternalQueryCalc),IdQueryCalc.prototype.destroy=idQueryCalcDestroy,IdQueryCalc.prototype.isProjection=idQueryCalcIsProjection,IdQueryCalc.prototype.isSelection=idQueryCalcIsSelection,IdQueryCalc.prototype.addDataElements=idQueryCalcAddDataElements,IdQueryCalc.prototype.removeDataElements=idQueryCalcRemoveDataElements,IdQueryCalc.prototype.refreshQuery=idQueryCalcRefreshQuery,IdQueryCalc.prototype.refreshQueryAfterSingleUpdate=idQueryCalcRefreshQueryAfterSingleUpdate,IdQueryCalc.prototype.addMatches=idQueryCalcAddMatches,IdQueryCalc.prototype.removeMatches=idQueryCalcRemoveMatches,IdQuery.prototype.destroy=idQueryDestroy,IdQuery.prototype.getId=idQueryGetId,IdQuery.prototype.isActive=idQueryIsActive,IdQuery.prototype.lockActive=idQueryLockActive,IdQuery.prototype.unlockActive=idQueryUnlockActive,IdQuery.prototype.isProjection=idQueryIsProjection,IdQuery.prototype.isPureProjection=idQueryIsPureProjection,IdQuery.prototype.newRootQueryCalc=idQueryNewRootQueryCalc,IdQuery.prototype.addRootQueryCalcNode=idQueryAddNewRootQueryCalcNode,IdQuery.prototype.removeRootQueryCalcNode=idQueryRemoveNewRootQueryCalcNode,IdQuery.prototype.refreshQuery=idQueryRefreshQuery,IdQuery.prototype.addDataElements=idQueryAddDataElements,IdQuery.prototype.removeDataElements=idQueryRemoveDataElements,ElementOrderService.prototype.addResult=elementOrderServiceAddResult,ElementOrderService.prototype.pushInitialValue=elementOrderServicePushInitialValue,ElementOrderService.prototype.removeResult=elementOrderServiceRemoveResult,inherit(MinMaxPosHeap,MinMaxHeap),MinMaxPosHeap.prototype.clear=minMaxPosHeapClear,MinMaxPosHeap.prototype.swap=minMaxPosHeapSwap,MinMaxPosHeap.prototype.assignPos=minMaxPosHeapAssignPos,MinMaxPosHeap.prototype.popLastPos=minMaxPosHeapPopLastPos,MinMaxPosHeap.prototype.addArray=minMaxPosHeapAddArray,MinMaxPosHeap.prototype.getIndex=minMaxPosHeapGetIndex,MinMaxPosHeap.prototype.removeIndex=minMaxPosHeapRemoveIndex,MinMaxPosHeap.prototype.getPositionInHeap=minMaxPosHeapGetPositionInHeap,MinMaxPosHeap.prototype.initWithSortedArray=minMaxPosHeapInitWithSortedArray,MinMaxPosHeap.prototype.inHeap=minMaxPosHeapInHeap,MinMaxPosHeap.prototype.update=minMaxPosHeapUpdate,MinMaxPosHeap.prototype.verify=minMaxPosHeapVerify,OrderRequirement.nextRequirementId=1025,OrderRequirement.prototype.addListener=orderRequirementAddListener,OrderRequirement.prototype.removeListener=orderRequirementRemoveListener,inherit(AtomicAbsOrderRequirement,OrderRequirement),AtomicAbsOrderRequirement.prototype.updateElement=atomicAbsOrderRequirementUpdateElement,AtomicAbsOrderRequirement.prototype.replacedElement=atomicAbsOrderRequirementReplacedElement,AtomicAbsOrderRequirement.prototype.clearAllElements=atomicAbsOrderRequirementClearAllElements,AtomicAbsOrderRequirement.prototype.notifyListeners=atomicAbsOrderRequirementNotifyListeners,inherit(BeginAbsOrderRequirement,AtomicAbsOrderRequirement),BeginAbsOrderRequirement.prototype.getEnd=beginAbsOrderRequirementGetEnd,BeginAbsOrderRequirement.prototype.updateElement=beginAbsOrderRequirementUpdateElement,BeginAbsOrderRequirement.prototype.replacedElement=beginAbsOrderRequirementReplacedElement,BeginAbsOrderRequirement.prototype.clearAllElements=beginAbsOrderRequirementClearAllElements,BeginAbsOrderRequirement.prototype.getForwardRange=beginAbsOrderRequirementGetForwardRange,BeginAbsOrderRequirement.prototype.updateReorderedRange=beginAbsOrderRequirementUpdateReorderedRange,BeginAbsOrderRequirement.prototype.notifyListeners=beginAbsOrderRequirementNotifyListeners,inherit(EndAbsOrderRequirement,AtomicAbsOrderRequirement),EndAbsOrderRequirement.prototype.getBegin=endAbsOrderRequirementGetBegin,EndAbsOrderRequirement.prototype.updateElement=endAbsOrderRequirementUpdateElement,EndAbsOrderRequirement.prototype.replacedElement=endAbsOrderRequirementReplacedElement,EndAbsOrderRequirement.prototype.clearAllElements=endAbsOrderRequirementClearAllElements,EndAbsOrderRequirement.prototype.addRangeElements=endAbsOrderRequirementAddRangeElements,EndAbsOrderRequirement.prototype.notifyListeners=endAbsOrderRequirementNotifyListeners,inherit(RangeOrderRequirement,OrderRequirement),RangeOrderRequirement.prototype.destroy=rangeOrderRequirementDestroy,RangeOrderRequirement.prototype.updateOffsets=rangeOrderRequirementUpdateOffsets,RangeOrderRequirement.prototype.diffAfterReplacement=rangeOrderRequirementDiffAfterReplacement,RangeOrderRequirement.prototype.setOffsetUpdateDiff=rangeOrderRequirementSetOffsetUpdateDiff,RangeOrderRequirement.prototype.setAddedAndRemovedRanges=rangeOrderRequirementSetAddedAndremovedRanges,RangeOrderRequirement.prototype.addElement=rangeOrderRequirementAddElement,RangeOrderRequirement.prototype.addElements=rangeOrderRequirementAddElements,RangeOrderRequirement.prototype.removeElement=rangeOrderRequirementRemoveElement,RangeOrderRequirement.prototype.removeElements=rangeOrderRequirementRemoveElements,RangeOrderRequirement.prototype.addRangeElements=rangeOrderRequirementAddRangeElements,RangeOrderRequirement.prototype.changeInitialUpdates=rangeOrderRequirementChangeInitialUpdates,RangeOrderRequirement.prototype.getMatches=rangeOrderRequirementGetMatches,RangeOrderRequirement.prototype.getOrderedMatches=rangeOrderRequirementGetOrderedMatches,RangeOrderRequirement.prototype.filterMatches=rangeOrderRequirementFilterMatches,RangeOrderRequirement.prototype.updateReorderedRange=rangeOrderRequirementUpdateReorderedRange,RangeOrderRequirement.prototype.notifyListeners=rangeOrderRequirementNotifyListeners,RangeOrderRequirement.prototype.notifyListenersOfOrderedRange=rangeOrderRequirementNotifyListenersOfOrderedRange,inherit(SegmentOrderRequirement,OrderRequirement),SegmentOrderRequirement.prototype.destroy=segmentOrderRequirementDestroy,SegmentOrderRequirement.prototype.getLowOffset=segmentOrderRequirementGetLowOffset,SegmentOrderRequirement.prototype.getHighOffset=segmentOrderRequirementGetHighOffset,SegmentOrderRequirement.prototype.getForwardRange=segmentOrderRequirementGetForwardRange,SegmentOrderRequirement.prototype.getRangeSize=segmentOrderRequirementGetRangeSize,SegmentOrderRequirement.prototype.initializeAtComplementRange=segmentOrderRequirementInitializeAtComplementRange,SegmentOrderRequirement.prototype.updateOffsets=segmentOrderRequirementUpdateOffsets,SegmentOrderRequirement.prototype.replaceRequirements=segmentOrderRequirementReplaceRequirements,SegmentOrderRequirement.prototype.registerNewRequirements=segmentOrderRequirementRegisterNewRequirements,SegmentOrderRequirement.prototype.addElement=segmentOrderRequirementAddElement,SegmentOrderRequirement.prototype.addElements=segmentOrderRequirementAddElements,SegmentOrderRequirement.prototype.removeElement=segmentOrderRequirementRemoveElement,SegmentOrderRequirement.prototype.removeElements=segmentOrderRequirementRemoveElements,SegmentOrderRequirement.prototype.addRangeElements=segmentOrderRequirementAddRangeElements,SegmentOrderRequirement.prototype.clearAllElements=segmentOrderRequirementClearAllElements,SegmentOrderRequirement.prototype.getAllMatches=segmentOrderRequirementGetAllMatches,SegmentOrderRequirement.prototype.updateReorderedRange=segmentOrderRequirementUpdateReorderedRange,SegmentOrderRequirement.prototype.notifyListeners=segmentOrderRequirementNotifyListeners,inherit(ComplementOrderRequirement,OrderRequirement),ComplementOrderRequirement.prototype.destroy=complementOrderRequirementDestroy,ComplementOrderRequirement.prototype.setForwardRange=complementOrderRequirementSetForwardRange,ComplementOrderRequirement.prototype.getForwardRange=complementOrderRequirementGetForwardRange,ComplementOrderRequirement.prototype.getLowOffset=complementOrderRequirementGetLowOffset,ComplementOrderRequirement.prototype.getHighOffset=complementOrderRequirementGetHighOffset,ComplementOrderRequirement.prototype.isEmpty=complementOrderRequirementIsEmpty,ComplementOrderRequirement.prototype.getRangeSize=complementOrderRequirementGetRangeSize,ComplementOrderRequirement.prototype.initializeAtSegmentRange=complementOrderRequirementInitializeAtSegmentRange,ComplementOrderRequirement.prototype.updateOffsets=complementOrderRequirementUpdateOffsets,ComplementOrderRequirement.prototype.registerNewRequirements=complementOrderRequirementRegisterNewRequirements,ComplementOrderRequirement.prototype.replaceRequirements=complementOrderRequirementReplaceRequirements,ComplementOrderRequirement.prototype.moveOffset=complementOrderRequirementMoveOffset,ComplementOrderRequirement.prototype.updateAddElement=complementOrderRequirementUpdateAddElement,ComplementOrderRequirement.prototype.updateRemoveElement=complementOrderRequirementUpdateRemoveElement,ComplementOrderRequirement.prototype.addElement=complementOrderRequirementAddElement,ComplementOrderRequirement.prototype.addElements=complementOrderRequirementAddElements,ComplementOrderRequirement.prototype.removeElement=complementOrderRequirementRemoveElement,ComplementOrderRequirement.prototype.removeElements=complementOrderRequirementRemoveElements,ComplementOrderRequirement.prototype.addRangeElements=complementOrderRequirementAddRangeElements,ComplementOrderRequirement.prototype.clearAllElements=complementOrderRequirementClearAllElements,ComplementOrderRequirement.prototype.getAllMatches=complementOrderRequirementGetAllMatches,ComplementOrderRequirement.prototype.updateReorderedRange=complementOrderRequirementUpdateReorderedRange,ComplementOrderRequirement.prototype.notifyListeners=complementOrderRequirementNotifyListeners,inherit(ComplementEndOrderRequirement,AtomicAbsOrderRequirement),ComplementEndOrderRequirement.prototype.updateElement=complementEndOrderRequirementUpdateElement,ComplementEndOrderRequirement.prototype.updateElementAdded=complementEndOrderRequirementUpdateElementAdded,ComplementEndOrderRequirement.prototype.updateElementRemoved=complementEndOrderRequirementUpdateElementRemoved,ComplementEndOrderRequirement.prototype.replacedElement=complementEndOrderRequirementReplacedElement,ComplementEndOrderRequirement.prototype.clearAllElements=complementEndOrderRequirementClearAllElements,ComplementEndOrderRequirement.prototype.notifyListeners=complementEndOrderRequirementNotifyListeners,inherit(ElementRequirement,OrderRequirement),ElementRequirement.prototype.destroy=elementRequirementDestroy,ElementRequirement.prototype.clearAllElements=elementRequirementClearAllElements,ElementRequirement.prototype.suspend=elementRequirementSuspend,ElementRequirement.prototype.setOffset=elementRequirementSetOffset,ElementRequirement.prototype.addRangeElements=elementRequirementAddRangeElements,ElementRequirement.prototype.updateAddElement=elementRequirementUpdateAddElement,ElementRequirement.prototype.updateRemoveElement=elementRequirementUpdateRemoveElement,ElementRequirement.prototype.updateReorderedRange=elementRequirementUpdateReorderedRange,ElementRequirement.prototype.notifyListeners=elementRequirementNotifyListeners,ElementRequirement.prototype.notifyMatches=elementRequirementNotifyMatches,ElementRequirement.prototype.notifyRangeOrder=elementRequirementNotifyRangeOrder,ElementRequirement.prototype.getForwardRange=elementRequirementGetForwardRange,ElementRequirement.prototype.getOffset=elementRequirementGetOffset,ElementRangeRequirement.prototype.suspend=elementRangeRequirementSuspend,ElementRangeRequirement.prototype.addRangeElements=elementRangeRequirementAddRangeElements,ElementRangeRequirement.prototype.updateAddElement=elementRangeRequirementUpdateAddElement,ElementRangeRequirement.prototype.updateRemoveElement=elementRangeRequirementUpdateRemoveElement,
ElementRangeRequirement.prototype.setAddedAndRemovedMatches=elementRangeRequirementSetAddedAndRemovedMatches,ElementRangeRequirement.prototype.notifyListeners=elementRangeRequirementNotifyListeners,inherit(PartialOrderTree,RedBlackTree),PartialOrderTree.prototype.getSize=partialOrderTreeGetSize,PartialOrderTree.prototype.invertOffset=partialOrderTreeInvertOffset,PartialOrderTree.prototype.insertElement=partialOrderTreeInsertElement,PartialOrderTree.prototype.addInsideHeapNode=partialOrderTreeAddInsideHeapNode,PartialOrderTree.prototype.prefixToHeapNode=partialOrderTreePrefixToHeapNode,PartialOrderTree.prototype.suffixToHeapNode=partialOrderTreeSuffixToHeapNode,PartialOrderTree.prototype.addBeforeNode=partialOrderTreeAddBeforeNode,PartialOrderTree.prototype.addAfterNode=partialOrderTreeAddAfterNode,PartialOrderTree.prototype.findNodeByOffset=partialOrderTreeFindNodeByOffset,PartialOrderTree.prototype.findNodeByForwardOffset=partialOrderTreeFindNodeByForwardOffset,PartialOrderTree.prototype.findNodeByBackwardOffset=partialOrderTreeFindNodeByBackwardOffset,PartialOrderTree.prototype.findNodeByElement=partialOrderTreeFindNodeByElement,PartialOrderTree.prototype.getRangeElements=partialOrderTreeGetRangeElements,PartialOrderTree.prototype.getRangeElementsByOffsets=partialOrderTreeGetRangeElementsByOffsets,PartialOrderTree.prototype.insertNewRootNode=partialOrderTreeInsertNewRootNode,PartialOrderTree.prototype.insertNewLeftChild=partialOrderTreeInsertNewLeftChild,PartialOrderTree.prototype.insertNewRightChild=partialOrderTreeInsertNewRightChild,PartialOrderTree.prototype.rotateRight=partialOrderTreeRotateRight,PartialOrderTree.prototype.rotateLeft=partialOrderTreeRotateLeft,PartialOrderTree.prototype.getVirtualNode=partialOrderTreeGetVirtualNode,PartialOrderTree.prototype.splitHeapNodeAtElement=partialOrderTreeSplitHeapNodeAtElement,PartialOrderTree.prototype.splitHeapNodeAroundElement=partialOrderTreeSplitHeapNodeAroundElement,PartialOrderTree.prototype.splitHeapNodeAtPos=partialOrderTreeSplitHeapNodeAtPos,PartialOrderTree.prototype.insertSplitHeapNodeJustBefore=partialOrderTreeInsertSplitHeapNodeJustBefore,PartialOrderTree.prototype.insertSplitHeapNodeJustAfter=partialOrderTreeInsertSplitHeapNodeJustAfter,PartialOrderTree.prototype.convertMinElementToNode=partialOrderTreeConvertMinElementToNode,PartialOrderTree.prototype.convertMaxElementToNode=partialOrderTreeConvertMaxElementToNode,PartialOrderTree.prototype.convertHeapNodeToElements=partialOrderTreeConvertHeapNodeToElements,PartialOrderTree.prototype.removeElement=partialOrderTreeRemoveElement,PartialOrderTree.prototype.removeElementFromHeap=partialOrderTreeRemoveElementFromHeap,PartialOrderTree.prototype.removeElementNode=partialOrderTreeRemoveElementNode,PartialOrderTree.prototype.removeNode=partialOrderTreeRemoveNode,PartialOrderTree.prototype.removeAllElements=partialOrderTreeRemoveAllElements,PartialOrderTree.prototype.allowsHeap=partialOrderTreeAllowsHeap,PartialOrderTree.prototype.mergeWithNextNode=partialOrderTreeMergeWithNextNode,PartialOrderTree.prototype.notifyAbsForward=partialOrderTreeNotifyAbsForward,PartialOrderTree.prototype.notifyAbsBackward=partialOrderTreeNotifyAbsBackward,PartialOrderTree.prototype.notifyAddRelForward=partialOrderTreeNotifyAddRelForward,PartialOrderTree.prototype.notifyAddRelBackward=partialOrderTreeNotifyAddRelBackward,PartialOrderTree.prototype.notifyRemoveRelForward=partialOrderTreeNotifyRemoveRelForward,PartialOrderTree.prototype.notifyRemoveRelBackward=partialOrderTreeNotifyRemoveRelBackward,PartialOrderTree.prototype.notifyReplaceRelForward=partialOrderTreeNotifyReplaceRelForward,PartialOrderTree.prototype.notifyReplaceRelBackward=partialOrderTreeNotifyReplaceRelBackward;PartialOrderTree.prototype.addForwardTrace=partialOrderTreeAddForwardTrace;PartialOrderTree.prototype.removeForwardTrace=partialOrderTreeRemoveForwardTrace,PartialOrderTree.prototype.removeForwardTraceUpTo=partialOrderTreeRemoveForwardTraceUpTo,PartialOrderTree.prototype.addBackwardTrace=partialOrderTreeAddBackwardTrace,PartialOrderTree.prototype.removeBackwardTrace=partialOrderTreeRemoveBackwardTrace,PartialOrderTree.prototype.removeBackwardTraceUpTo=partialOrderTreeRemoveBackwardTraceUpTo,PartialOrderTree.prototype.transferRequirementsAfterInsertion=partialOrderTreeTransferRequirementsAfterInsertion,PartialOrderTree.prototype.moveForwardRequirementsToPrev=partialOrderTreeMoveForwardRequirementsToPrev,PartialOrderTree.prototype.moveBackwardRequirementsToNext=partialOrderTreeMoveBackwardRequirementsToNext,PartialOrderTree.prototype.notifyComplementRequirementsOfAdd=partialOrderTreeNotifyComplementRequirementsOfAdd,PartialOrderTree.prototype.transferRequirementsAfterRemoval=partialOrderTreeTransferRequirementsAfterRemoval,PartialOrderTree.prototype.moveForwardRequirementsToNext=partialOrderTreeMoveForwardRequirementsToNext,PartialOrderTree.prototype.moveBackwardRequirementsToPrev=partialOrderTreeMoveBackwardRequirementsToPrev,PartialOrderTree.prototype.notifyComplementRequirementsOfRemove=partialOrderTreeNotifyComplementRequirementsOfRemove,PartialOrderTree.prototype.registerAbsRequirement=partialOrderTreeRegisterAbsRequirement,PartialOrderTree.prototype.unregisterAbsRequirement=partialOrderTreeUnregisterAbsRequirement,PartialOrderTree.prototype.addAbsRequirement=partialOrderTreeAddAbsRequirement,PartialOrderTree.prototype.addAbsRequirementToNode=partialOrderTreeAddAbsRequirementToNode,PartialOrderTree.prototype.addEndOfAbsRangeRequirement=partialOrderTreeAddEndOfAbsRangeRequirement,PartialOrderTree.prototype.getNewRangeElements=partialOrderTreeGetNewRangeElements,PartialOrderTree.prototype.moveAbsRequirement=partialOrderTreeMoveAbsRequirement,PartialOrderTree.prototype.addAnchoredRequirement=partialOrderTreeAddAnchoredRequirement,PartialOrderTree.prototype.insertAnchoredRequirement=partialOrderTreeInsertAnchoredRequirement,PartialOrderTree.prototype.insertElementRequirement=partialOrderTreeInsertElementRequirement,PartialOrderTree.prototype.insertRelForward=partialOrderTreeInsertRelForward,PartialOrderTree.prototype.insertRelBackward=partialOrderTreeInsertRelBackward,PartialOrderTree.prototype.addComplementRequirement=partialOrderTreeAddComplementRequirement,PartialOrderTree.prototype.incNoHeapNodes=partialOrderTreeIncNoHeapNodes,PartialOrderTree.prototype.removeAbsRequirement=partialOrderTreeRemoveAbsRequirement,PartialOrderTree.prototype.removeAbsRequirementFromNode=partialOrderTreeRemoveAbsRequirementFromNode,PartialOrderTree.prototype.removeRangeRequirementNoHeapCount=partialOrderTreeRemoveRangeRequirementNoHeapCount,PartialOrderTree.prototype.removeAnchoredRequirement=partialOrderTreeRemoveAnchoredRequirement,PartialOrderTree.prototype.removeElementRequirementTracing=partialOrderTreeRemoveElementRequirementTracing,PartialOrderTree.prototype.removeElementRequirementNoHeapCount=partialOrderTreeRemoveElementRequirementNoHeapCount,PartialOrderTree.prototype.removeRelForward=partialOrderTreeRemoveRelForward,PartialOrderTree.prototype.removeRelBackward=partialOrderTreeRemoveRelBackward,PartialOrderTree.prototype.removeComplementRequirement=partialOrderTreeRemoveComplementRequirement,PartialOrderTree.prototype.decNoHeapNodes=partialOrderTreeDecNoHeapNodes,PartialOrderTree.prototype.suspendRequirement=partialOrderTreeSuspendRequirement,PartialOrderTree.prototype.unsuspendRequirements=partialOrderTreeUnsuspendRequirements,PartialOrderTree.prototype.isSuspendedRequirementAnchor=partialOrderTreeIsSuspendedRequirementAnchor,PartialOrderTree.prototype.updateCompareFunc=partialOrderTreeUpdateCompareFunc,PartialOrderTree.prototype.refreshOrder=partialOrderTreeRefreshOrder,PartialOrderTree.prototype.updateOrderedRangesAfterReordering=partialOrderTreeUpdateOrderedRangesAfterReordering,PartialOrderTree.prototype.reorderSubTree=partialOrderTreeReorderSubTree,PartialOrderTree.prototype.mergeReorderedSubTrees=partialOrderTreeMergeReorderedSubTrees,PartialOrderTree.prototype.mergeReorderedSubTreeTail=partialOrderTreeMergeReorderedSubTreeTail,PartialOrderTree.prototype.replaceNodeElement=partialOrderTreeReplaceNodeElement,PartialOrderTree.prototype.notifyListeners=partialOrderTreeNotifyListeners,PartialOrderNode.prototype.getSize=partialOrderNodeGetSize,PartialOrderNode.prototype.getSubTreeSize=partialOrderNodeGetSubTreeSize,PartialOrderNode.prototype.allowsHeap=partialOrderNodeAllowsHeap,PartialOrderNode.prototype.convertElementToHeap=partialOrderNodeConvertElementToHeap,PartialOrderNode.prototype.convertHeapToElement=partialOrderNodeConvertHeapToElement,PartialOrderNode.prototype.copyContentFromNode=partialOrderNodeCopyContentFromNode,PartialOrderNode.prototype.refreshOrder=partialOrderNodeRefreshOrder,VirtualPartialOrderNode.prototype.isEmpty=virtualPartialOrderNodeIsEmpty,VirtualPartialOrderNode.prototype.getRelNum=virtualPartialOrderNodeGetRelNum,VirtualPartialOrderNode.prototype.notifyAddRel=virtualPartialOrderNodeNotifyAddRel,VirtualPartialOrderNode.prototype.notifyRemoveRel=virtualPartialOrderNodeNotifyRemoveRel,VirtualPartialOrderNode.prototype.notifyReplaceRel=virtualPartialOrderNodeNotifyReplaceRel,VirtualPartialOrderNode.prototype.notifyAddAbsolute=virtualPartialOrderNodeNotifyAddAbsolute,VirtualPartialOrderNode.prototype.notifyRemoveAbsolute=virtualPartialOrderNodeNotifyRemoveAbsolute,VirtualPartialOrderNode.prototype.addAbsRequirement=virtualPartialOrderNodeAddAbsRequirement,VirtualPartialOrderNode.prototype.removeAbsRequirement=virtualPartialOrderNodeRemoveAbsRequirement,VirtualPartialOrderNode.prototype.addRelRequirement=virtualPartialOrderNodeAddRelRequirement,VirtualPartialOrderNode.prototype.removeRelRequirement=virtualPartialOrderNodeRemoveRelRequirement,VirtualPartialOrderNode.prototype.resetAfterClearElements=virtualPartialOrderNodeResetAfterClearElements,RequirementList.prototype.getSize=requirementListGetSize,RequirementList.prototype.add=requirementListAdd,RequirementList.prototype.remove=requirementListRemove,inherit(OrderService,FuncResult),OrderService.prototype.destroy=orderServiceDestroy,OrderService.prototype.isOrder=orderServiceIsOrder,OrderService.prototype.isActive=orderServiceIsActive,OrderService.prototype.getSetSize=orderServiceGetSetSize,OrderService.prototype.refreshIndexerAndPaths=orderServiceRefreshIndexerAndPaths,OrderService.prototype.replaceIndexerAndPaths=orderServiceReplaceIndexerAndPaths,OrderService.prototype.deactivated=orderServiceDeactivated,OrderService.prototype.becameActiveStar=orderServiceBecameActiveStar,OrderService.prototype.refreshOrdering=orderServiceRefreshOrdering,OrderService.prototype.isSuspended=orderServiceIsSuspended,OrderService.prototype.suspend=orderServiceSuspend,OrderService.prototype.unsuspend=orderServiceUnsuspend,OrderService.prototype.addMatches=orderServiceAddMatches,OrderService.prototype.addProjMatches=orderServiceAddProjMatches,OrderService.prototype.doAddMatches=orderServiceDoAddMatches,OrderService.prototype.removeMatches=orderServiceRemoveMatches,OrderService.prototype.removeProjMatches=orderServiceRemoveProjMatches,OrderService.prototype.doRemoveMatches=orderServiceDoRemoveMatches,OrderService.prototype.removeAllMatches=orderServiceRemoveAllMatches,OrderService.prototype.refreshOrderResults=orderServiceRefreshOrderResults,OrderService.prototype.getDominatedIndexer=orderServiceGetDominatedIndexer,OrderService.prototype.getDominatedProjPathId=orderServiceGetDominatedProjPathId,OrderService.prototype.getDominatedProjPathNum=orderServiceGetDominatedProjPathNum,OrderService.prototype.getTerminalProjMatches=orderServiceGetTerminalProjMatches,OrderService.prototype.filterTerminalProjMatches=orderServiceFilterTerminalProjMatches,OrderService.prototype.getDomMatchCount=orderServiceGetDomMatchCount,OrderService.prototype.getDominatedMatches=orderServiceGetDominatedMatches,OrderService.prototype.getDominatedMatchesAsObj=orderServiceGetDominatedMatchesAsObj,OrderService.prototype.filterDominatedMatches=orderServiceFilterDominatedMatches,OrderService.prototype.filterDominatedMatchPositions=orderServiceFilterDominatedMatchPositions,OrderService.prototype.getDominatedIdentification=orderServiceGetDominatedIdentification,OrderService.prototype.addOrderResult=orderServiceAddOrderResult,OrderService.prototype.aboutToAddActiveComposed=orderServiceAboutToAddActiveComposed,OrderService.prototype.removeOrderResult=orderServiceRemoveOrderResult,OrderService.prototype.getRangeRequirement=orderServiceGetRangeRequirement,OrderService.prototype.registerRangeRequirement=orderServiceRegisterRangeRequirement,OrderService.prototype.unregisterRangeRequirement=orderServiceUnregisterRangeRequirement,OrderService.prototype.registerIndexRequirement=orderServiceRegisterIndexRequirement,OrderService.prototype.unregisterIndexRequirement=orderServiceUnregisterIndexRequirement,OrderService.prototype.getRangeMatches=orderServiceGetRangeMatches,OrderService.prototype.getOrderedRangeMatches=orderServiceGetOrderedRangeMatches,OrderService.prototype.filterRangeMatches=orderServiceFilterRangeMatches,OrderService.prototype.setCompareFunc=orderServiceSetCompareFunc,inherit(OrderResult,FuncResult);var debugAllOrderResults=void 0;OrderResult.prototype.destroy=orderResultDestroy,OrderResult.prototype.isOrder=orderResultIsOrder,OrderResult.prototype.isActive=orderResultIsActive,OrderResult.prototype.addOrderTracing=orderResultAddOrderTracing,OrderResult.prototype.removeOrderTracing=orderResultRemoveOrderTracing,OrderResult.prototype.activated=orderResultActivated,OrderResult.prototype.deactivated=orderResultDeactivated,OrderResult.prototype.setData=orderResultSetData,OrderResult.prototype.setTerminalData=orderResultSetTerminalData,OrderResult.prototype.refreshIndexerAndPaths=orderResultRefreshIndexerAndPaths,OrderResult.prototype.replaceIndexerAndPaths=orderResultReplaceIndexerAndPaths,OrderResult.prototype.becameActiveStar=orderResultBecameActiveStar,OrderResult.prototype.addDataObjMatches=orderResultAddDataObjMatches,OrderResult.prototype.removeDataObjMatches=orderResultRemoveDataObjMatches,OrderResult.prototype.addMatches=orderResultAddMatches,OrderResult.prototype.removeMatches=orderResultRemoveMatches,OrderResult.prototype.removeAllMatches=orderResultRemoveAllMatches,OrderResult.prototype.allNotificationsReceived=orderResultAllNotificationsReceived,OrderResult.prototype.getDominatedIndexer=orderResultGetDominatedIndexer,OrderResult.prototype.getDominatedProjPathId=orderResultGetDominatedProjPathId,OrderResult.prototype.getDominatedProjPathNum=orderResultGetDominatedProjPathNum,OrderResult.prototype.getTerminalProjMatches=orderResultGetTerminalProjMatches,OrderResult.prototype.filterTerminalProjMatches=orderResultFilterTerminalProjMatches,OrderResult.prototype.getDomMatchCount=orderResultGetDomMatchCount,OrderResult.prototype.getDominatedMatches=orderResultGetDominatedMatches,OrderResult.prototype.getDominatedMatchesAsObj=orderResultGetDominatedMatchesAsObj,OrderResult.prototype.filterDominatedMatches=orderResultFilterDominatedMatches,OrderResult.prototype.filterDominatedMatchPositions=orderResultFilterDominatedMatchPositions,OrderResult.prototype.getOrderedMatches=orderResultGetOrderedMatches,OrderResult.prototype.getDominatedIdentification=orderResultGetDominatedIdentification,OrderResult.prototype.getDominatedComparison=orderResultGetDominatedComparison,inherit(RangeOrderResult,OrderResult),RangeOrderResult.prototype.updateOffsets=rangeOrderResultUpdateOffsets,RangeOrderResult.prototype.setOrderTracing=rangeOrderResultSetOrderTracing,RangeOrderResult.prototype.registerToOrderService=rangeOrderResultRegisterToOrderService,RangeOrderResult.prototype.unregisterFromOrderService=rangeOrderResultUnregisterFromOrderService,RangeOrderResult.prototype.addMatches=rangeOrderResultAddMatches,RangeOrderResult.prototype.removeMatches=rangeOrderResultRemoveMatches,RangeOrderResult.prototype.removeAllMatches=rangeOrderResultRemoveAllMatches,RangeOrderResult.prototype.updatePos=rangeOrderResultUpdatePos,RangeOrderResult.prototype.getTerminalProjMatches=rangeOrderResultGetTerminalProjMatches,RangeOrderResult.prototype.filterTerminalProjMatches=rangeOrderResultFilterTerminalProjMatches,RangeOrderResult.prototype.getDominatedMatches=rangeOrderResultGetDominatedMatches,RangeOrderResult.prototype.getDominatedMatchesAsObj=rangeOrderResultGetDominatedMatchesAsObj,RangeOrderResult.prototype.filterDominatedMatches=rangeOrderResultFilterDominatedMatches,RangeOrderResult.prototype.filterDominatedMatchPositions=rangeOrderResultFilterDominatedMatchPositions,RangeOrderResult.prototype.getOrderedMatches=rangeOrderResultGetOrderedMatches,inherit(IndexOrderResult,OrderResult),IndexOrderResult.prototype.destroy=indexOrderResultDestroy,IndexOrderResult.prototype.deactivated=indexOrderResultDeactivated,IndexOrderResult.prototype.addOrderTracing=indexOrderResultAddOrderTracing,IndexOrderResult.prototype.removeOrderTracing=indexOrderResultRemoveOrderTracing,IndexOrderResult.prototype.setOrderedData=indexOrderResultSetOrderedData,IndexOrderResult.prototype.setToIndexData=indexOrderResultSetToIndexData,IndexOrderResult.prototype.refreshIndexerAndPaths=indexOrderResultRefreshIndexerAndPaths,IndexOrderResult.prototype.replaceIndexerAndPaths=indexOrderResultReplaceIndexerAndPaths,IndexOrderResult.prototype.addDataObjMatches=indexOrderResultAddDataObjMatches,IndexOrderResult.prototype.removeDataObjMatches=indexOrderResultRemoveDataObjMatches,IndexOrderResult.prototype.aboutToAddActiveComposed=indexOrderResultAboutToAddActiveComposed,IndexOrderResult.prototype.activeComposedFuncRemoved=indexOrderResultActiveComposedFuncRemoved,IndexOrderResult.prototype.registerToOrderService=indexOrderResultRegisterToOrderService,IndexOrderResult.prototype.unregisterFromOrderService=indexOrderResultUnregisterFromOrderService,IndexOrderResult.prototype.updateOffset=indexOrderResultUpdateOffset,IndexOrderResult.prototype.addMatches=indexOrderResultAddMatches,IndexOrderResult.prototype.removeMatches=indexOrderResultRemoveMatches,IndexOrderResult.prototype.removeAllMatches=indexOrderResultRemoveAllMatches,IndexOrderResult.prototype.refreshIndexerAndPaths=indexOrderResultRefreshIndexerAndPaths,IndexOrderResult.prototype.replaceIndexerAndPaths=indexOrderResultReplaceIndexerAndPaths,IndexOrderResult.prototype.getDominatedIndexer=indexOrderResultGetDominatedIndexer,IndexOrderResult.prototype.getDominatedProjPathId=indexOrderResultGetDominatedProjPathId,IndexOrderResult.prototype.getTerminalProjMatches=indexOrderResultGetTerminalProjMatches,IndexOrderResult.prototype.filterTerminalProjMatches=indexOrderResultFilterTerminalProjMatches,IndexOrderResult.prototype.getDominatedMatches=indexOrderResultGetDominatedMatches,IndexOrderResult.prototype.getDominatedMatchesAsObj=indexOrderResultGetDominatedMatchesAsObj,IndexOrderResult.prototype.filterDominatedMatches=indexOrderResultFilterDominatedMatches,IndexOrderResult.prototype.filterDominatedMatchPositions=indexOrderResultFilterDominatedMatchPositions,IndexOrderResult.prototype.getValues=indexOrderResultGetValues,IndexOrderResult.prototype.getOrderedMatches=indexOrderResultGetOrderedMatches;var g_noTryAndCatchUpdate=!0,showRuntimeWarnings=!1,strictnessLevel=0,allowSimpleQueryCache=!0,gRunFmtVersion=2.3,mondriaOnLoadDate,runTests=!1,testLogBreak=void 0,maxTestDuration=24e4,testDurationGuardTime,gProfile=!1,useResultIndexers=!0,allowSetData=!0,linearMultiQuery=!0,possibleLoopDetected=!1,exportCount=void 0,testParamsDescStr,mondriaMutex=!1,debugObjCache=!1,doDebugging=!1,noTimeOut=!1,debugLoadJSTime=!1,numberRegExp=/^ *(\-|\+)? *([0-9]+(\.[0-9]*)?|[0-9]*\.[0-9]+|Infinity) *$/,debugDelayLoad=!1,ProductStatus;!function(e){e[e.development=0]="development",e[e.testing=1]="testing",e[e.qualityAssurance=2]="qualityAssurance",e[e.production=3]="production"}(ProductStatus||(ProductStatus={}));var productStatus=ProductStatus.development,suppressRunningUntil,QueryCache=function(){function e(e){this.result=e,this.cache={}}return e}(),Result=function(){function e(e){void 0===e&&(e=void 0),this.value=e}return e.prototype.size=function(){return this.value instanceof Array?this.value.length:void 0===this.value?0:1},e.prototype.copy=function(e){this.value=e.value,"incremental"in e?(this.incremental=e.incremental,this.added=e.added,this.modified=e.modified,this.removed=e.removed):"incremental"in this&&(delete this.incremental,delete this.added,delete this.modified,delete this.removed),this.copyLabels(e)},e.prototype.clone=function(){var t=new e;return t.copy(this),t},e.prototype.copyMinusUndefinedValues=function(e){var t,i=e.value,r=e.identifiers;if(void 0===i&&(this.value=void 0,this.resetLabels()),void 0===r){t=[];for(var n=0;n<i.length;n++)void 0!==i[n]&&t.push(i[n]);this.value=t,"identifiers"in this&&delete this.identifiers}else{var o=[];t=[];for(var n=0;n<i.length;n++)void 0!==i[n]&&(t.push(i[n]),o.push(r[n]));this.value=t,this.copyLabels(e),this.identifiers=o}"dataSource"in e?this.dataSource=e.dataSource:"dataSource"in this&&delete this.dataSource},e.prototype.resetLabels=function(){"compiledQuery"in this&&delete this.compiledQuery,"atomic"in this&&delete this.atomic,"push"in this&&delete this.push,"queryArguments"in this&&delete this.queryArguments,"nrQueryElements"in this&&delete this.nrQueryElements,"writePaths"in this&&delete this.writePaths,"identifiers"in this&&delete this.identifiers,"dataSource"in this&&delete this.dataSource,"remoteStatus"in this&&delete this.remoteStatus,"foreignInterfaceSource"in this&&delete this.foreignInterfaceSource,"anonymize"in this&&delete this.anonymize,"erase"in this&&delete this.erase},e.prototype.copyLabelsMinusDataSource=function(e,t){return void 0===t&&(t=!1),void 0===e?void this.resetLabels():("compiledQuery"in e?this.compiledQuery=e.compiledQuery:"compiledQuery"in this&&delete this.compiledQuery,"atomic"in e?this.atomic=e.atomic:"atomic"in this&&delete this.atomic,"push"in e?this.push=e.push:"push"in this&&delete this.push,"queryArguments"in e?this.queryArguments=e.queryArguments:"queryArguments"in this&&delete this.queryArguments,"nrQueryElements"in e?this.nrQueryElements=e.nrQueryElements:"nrQueryElements"in this&&delete this.nrQueryElements,"writePaths"in e?this.writePaths=e.writePaths:"writePaths"in this&&delete this.writePaths,"identifiers"in e?this.identifiers=e.identifiers:"identifiers"in this&&delete this.identifiers,!t&&"dataSource"in this&&delete this.dataSource,"remoteStatus"in e?this.remoteStatus=e.remoteStatus:"remoteStatus"in this&&delete this.remoteStatus,"foreignInterfaceSource"in e?this.foreignInterfaceSource=e.foreignInterfaceSource:"foreignInterfaceSource"in this&&delete this.foreignInterfaceSource,"anonymize"in e?this.anonymize=e.anonymize:"anonymize"in this&&delete this.anonymize,void("erase"in e?this.erase=e.erase:"erase"in this&&delete this.erase))},e.prototype.copyLabels=function(e){void 0!==e&&(this.copyLabelsMinusDataSource(e,!0),"dataSource"in e?this.dataSource=e.dataSource:"dataSource"in this&&delete this.dataSource)},e.prototype.copyConst=function(e){this.value=e.value,"compiledQuery"in e?(this.compiledQuery=[e.compiledQuery.compiledFunction],this.queryArguments=[],this.nrQueryElements=[]):"compiledQuery"in this&&(delete this.compiledQuery,delete this.queryArguments,delete this.nrQueryElements)},e.prototype.set=function(e){this.value=e,"compiledQuery"in this&&delete this.compiledQuery,"atomic"in this&&delete this.atomic,"push"in this&&delete this.push,"queryArguments"in this&&delete this.queryArguments,"nrQueryElements"in this&&delete this.nrQueryElements,"writePaths"in this&&delete this.writePaths,"identifiers"in this&&delete this.identifiers,"dataSource"in this&&delete this.dataSource,"remoteStatus"in this&&delete this.remoteStatus,"foreignInterfaceSource"in this&&delete this.foreignInterfaceSource,"anonymize"in this&&delete this.anonymize,"erase"in this&&delete this.erase},e.prototype.setIdentifiers=function(e){void 0!==e?this.identifiers=e:"identifiers"in this&&delete this.identifiers},e.prototype.getLabels=function(){var e=void 0;return"atomic"in this&&(e={atomic:this.atomic}),"push"in this&&(void 0===e?e={push:this.push}:e.push=this.push),"anonymize"in this&&(void 0===e?e={anonymize:this.anonymize}:e.anonymize=this.anonymize),"erase"in this&&(void 0===e?e={del:this.erase}:e.del=this.erase),"compiledQuery"in this&&(void 0===e?e={compiledQuery:this.compiledQuery}:e.compiledQuery=this.compiledQuery,"queryArguments"in this&&(e.queryArguments=this.queryArguments),"nrQueryElements"in this&&(e.nrQueryElements=this.nrQueryElements),"writePaths"in this&&(e.writePaths=this.writePaths)),"identifiers"in this&&(void 0===e?e={identifiers:this.identifiers}:e.identifiers=this.identifiers),"dataSource"in this&&(void 0===e?e={dataSource:this.dataSource}:e.dataSource=this.dataSource),"remoteStatus"in this&&(void 0===e?e={remoteStatus:this.remoteStatus}:e.remoteStatus=this.remoteStatus),"foreignInterfaceSource"in this&&(void 0===e?e={foreignInterfaceSource:this.foreignInterfaceSource}:e.foreignInterfaceSource=this.foreignInterfaceSource),e},e.prototype.hasLabels=function(){return"compiledQuery"in this||"atomic"in this||"push"in this||"queryArguments"in this||"nrQueryElements"in this||"writePaths"in this||"identifiers"in this||"erase"in this||"anonymize"in this||"dataSource"in this||"remoteStatus"in this||"foreignInterfaceSource"in this},e.prototype.equalLabels=function(e){return void 0===e&&void 0===this.compiledQuery&&void 0===this.atomic&&void 0===this.push&&void 0===this.queryArguments&&void 0===this.nrQueryElements&&void 0===this.writePaths&&void 0===this.identifiers&&void 0===this.dataSource&&void 0===this.remoteStatus&&void 0===this.foreignInterfaceSource&&void 0===this.anonymize&&void 0===this.erase||void 0!==e&&this.compiledQuery===e.compiledQuery&&objectEqual(this.atomic,e.atomic)&&objectEqual(this.push,e.push)&&array2Equal(this.queryArguments,e.queryArguments)&&objectEqual(this.nrQueryElements,e.nrQueryElements)&&objectEqual(this.writePaths,e.writePaths)&&valueEqual(this.identifiers,e.identifiers)&&this.dataSource===e.dataSource&&this.remoteStatus===e.remoteStatus&&this.foreignInterfaceSource===e.foreignInterfaceSource&&this.anonymize===e.anonymize&&this.erase===e.del},e.prototype.equal=function(e){return this.equalLabels(e)&&valueEqual(this.value,e.value)},e.prototype.sub=function(t,i){void 0===i&&(i=1);var r=new e(void 0!==this.value?this.value.slice(t,t+i):[]);return"atomic"in this&&(r.atomic=this.atomic),"push"in this&&(r.push=this.push),"compiledQuery"in this&&(r.compiledQuery=this.compiledQuery.slice(t,t+i),"queryArguments"in this&&(r.queryArguments=this.queryArguments.slice(t,t+i)),"nrQueryElements"in this&&(r.nrQueryElements=this.nrQueryElements.slice(t,t+i)),"writePaths"in this&&(r.writePaths=this.writePaths)),"identifiers"in this&&void 0!==this.identifiers&&(r.identifiers=this.identifiers.slice(t,t+i)),"anonymize"in this&&(r.anonymize=this.anonymize),"erase"in this&&(r.erase=this.erase),r},e.prototype.getIdentifiers=function(){return this.value.map(function(e){})},e.prototype.isEqual=function(e){return!(!valueEqual(this.value,e.value)||!valueEqual(this.identifiers,e.identifiers))&&(!("dataSource"in this||"dataSource"in e)||"dataSource"in this&&"dataSource"in e&&this.dataSource.isEqual(e.dataSource))},e.prototype.isLargerThan=function(e,t){return void 0!==this.value&&("identifiers"in this?this.identifiers.length>=e:countObjSize(this.value,t)>=e)},e.prototype.containsDefun=function(){return this.value.some(function(e){return e instanceof DefunReference})},e.prototype.isEmpty=function(){return!("dataSource"in this)&&(void 0===this.value||this.value instanceof Array&&0===this.value.length)},e}();Result.nextUniqueIdPrefix=0;var WriteMode;!function(e){e[e.replace=0]="replace",e[e.merge=1]="merge"}(WriteMode||(WriteMode={}));var MergeAttributes=function(){function e(e,t,i){this.push=e,this.atomic=t,this.erase=i}return e.prototype.extendWithPath=function(t){function i(e){if(void 0!==e)for(var i=t.length-1;i>=0;i--){var r={};r[t[i]]=e,e=r}return e}return void 0===t?this:new e(i(this.push),i(this.atomic),i(this.erase))},e.prototype.popPathElement=function(t){return new e(this.push instanceof Object?this.push[t]:void 0,this.atomic instanceof Object?this.atomic[t]:void 0,this.erase instanceof Object?this.erase[t]:void 0)},e}(),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),constEmptyOS=[],constTrueOS=[!0],constFalseOS=[!1],constEmptyObject={},EFNop=function(){function e(){}return e.make=function(t,i){return e.singleton},e.prototype.destroy=function(){},e.prototype.execute=function(e){return constEmptyOS},e.prototype.executeOS=function(e,t){return constEmptyOS},e.prototype.undefinedSignalsNoChange=function(){return!1},e}();EFNop.singleton=new EFNop;var NonAV=function(){function e(){}return e}(),Projector=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.copy=function(){return this},t.prototype.typeName=function(){return"projector"},t.prototype.toString=function(){return"_"},t.prototype.stringify=function(){return"_"},t.prototype.toJSON=function(){return"_"},t.prototype.toCdl=function(){return _},t.prototype.isEqual=function(e){return e===_},t.prototype.match=function(e){return!0},t.prototype.marshalValue=function(e){return{type:"projector"}},t.unmarshalValue=function(e,t){return _},t}(NonAV),TerminalSymbol=function(e){function t(t){var i=e.call(this)||this;return i.name=t,i}return __extends(t,e),t.prototype.copy=function(){return this},t.prototype.typeName=function(){return"terminalSymbol"},t.prototype.toCdl=function(){return this.name},t.prototype.toString=function(){return this.name},t.prototype.stringify=function(){return this.name},t.prototype.toJSON=function(){return this.name},t.prototype.isEqual=function(e){return this===e},t.prototype.match=function(e){return this===e},t.prototype.marshalValue=function(e){return{type:"terminalSymbol",name:this.name}},t.unmarshalValue=function(e,t){switch(e.name){case"unmatched":return unmatched}},t}(NonAV),BuiltInFunction=function(e){function t(t,i,r,n,o,s,a){void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===a&&(a=!1);var d=e.call(this)||this;return d.name=t,d.minNrArguments=i,d.maxNrArguments=r,d.factory=EFNop.make,d.isLocalWithoutArguments=o,d.dependingOnImplicitArguments=s,d.transientResult=a,d.valueType=n,d}return __extends(t,e),t.prototype.copy=function(){return this},t.prototype.typeName=function(){return"builtInFunction"},t.prototype.stringify=function(){return this.name},t.prototype.toJSON=function(){return this.name},t.prototype.toCdl=function(){return this},t.prototype.isEqual=function(e){return e instanceof t&&this.name===e.name},t.prototype.match=function(e){return e instanceof t&&this.name===e.name},t.prototype.marshalValue=function(e){return{type:"builtInFunction",name:this.name,isLocalWithoutArguments:this.isLocalWithoutArguments,dependingOnImplicitArguments:this.dependingOnImplicitArguments,transientResult:this.transientResult}},t.unmarshalValue=function(e,i){return new t(e.name,e.isLocalWithoutArguments,e.depOnImplArgs,e.transientResult)},t}(NonAV),JavascriptFunction=function(){function e(e,t){this.name=e,this.arguments=t}return e}(),MoonOrderedSetBase=function(e){function t(t){var i=e.call(this)||this;return i.os=t,i}return __extends(t,e),t.prototype.copy=function(){assert(!1,"implement in derived class")},t.prototype.makeNew=function(e){assert(!1,"implement in derived class")},t.prototype.toString=function(){assert(!1,"implement in derived class")},t.prototype.isEqual=function(e){assert(!1,"implement in derived class")},t.prototype.typeName=function(){assert(!1,"implement in derived class")},t.prototype.marshalValue=function(e){return t.marshalValue(this.typeName(),this.os,e)},t.marshalValue=function(e,t,i){
for(var r=[],n=0;n<t.length;n++)r[n]=i.xdrCdlObj(t[n]);return{type:e,os:r}},t.unmarshalOS=function(e,t){var i=e.os;if("undefined"==typeof i)return[];for(var r=[],n=0;n<i.length;n++)r[n]=t.xdrCdlObj(i[n]);return r},t.unmarshalValue=function(e,i){var r=t.unmarshalOS(e,i);return r},t}(NonAV),MoonOrderedSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.copy=function(){return new t(this.os)},t.prototype.makeNew=function(e){return new t(e)},t.prototype.toString=function(){return"o("+this.os.map(flatcdlify).join(",")+")"},t.prototype.stringify=function(){return this.toString()},t.prototype.toJSON=function(){return"o("+this.os.map(cstringify).join(", ")+")"},t.prototype.toCdl=function(){return this},t.prototype.match=function(e){return e instanceof Array?this.os.some(function(t){return e.indexOf(t)>=0}):this.os.indexOf(e)>=0},t.prototype.isEqual=function(e){if(e instanceof t){if(this.os.length!==e.os.length)return!1;for(var i=0;i<this.os.length;i++)if(!objectEqual(this.os[i],e.os[i]))return!1;return!0}return!1},t.prototype.typeName=function(){return"orderedSet"},t}(MoonOrderedSetBase),MoonRange=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.closedLower=i,n.closedUpper=r,n}return __extends(t,e),t.prototype.copy=function(){return new t(this.os,this.closedLower,this.closedUpper)},t.prototype.makeNew=function(e){return new t(e,!0,!0)},t.prototype.min=function(){return Math.min.apply(null,this.os)},t.prototype.max=function(){return Math.max.apply(null,this.os)},t.prototype.typeName=function(){return"range"},t.prototype.match=function(e){throw"not implemented"},t.prototype.isEqual=function(e){if(e instanceof t&&this.closedLower===e.closedLower&&this.closedUpper===e.closedUpper){if(this.os.every(function(e){return isSimpleType(e)})&&e.os.every(function(e){return isSimpleType(e)}))return this.min()===e.min()&&this.max()===e.max();for(var i=0;i<this.os.length;i++){for(var r=!1,n=0;!r&&n<e.os.length;n++)r=objectEqual(this.os[i],e.os[i]);if(!r)return!1}for(var n=0;n<e.os.length;n++){for(var o=!1,i=0;!o&&i<this.os.length;i++)o=objectEqual(this.os[i],e.os[i]);if(!o)return!1}return!0}return!1},t.prototype.toString=function(){var e=this.os.map(safeJSONStringify).join(",");return this.closedLower?this.closedUpper?"r("+e+")":"Rco("+e+")":this.closedUpper?"Roc("+e+")":"Roo("+e+")"},t.prototype.stringify=function(){return this.toString()},t.prototype.toJSON=function(){return this.toString()},t.prototype.toCdl=function(){return this},t.prototype.containsSimpleValue=function(e){for(var t=!1,i=!1,r=0;r<this.os.length;r++){var n=this.os[r];if(!(typeof n in simpleTypes))return;(n===-(1/0)&&"number"==typeof e||n<e||n===e&&this.closedLower)&&(t=!0),(n===1/0&&"number"==typeof e||n>e||n===e&&this.closedUpper)&&(i=!0)}return t&&i},t.prototype.rangesOverlap=function(e){for(var t=0;t<e.os.length;t++){var i=typeof e.os[t]in simpleTypes?this.containsSimpleValue(e.os[t]):void 0;if(void 0===i)return;if(i===!0)return!0}return!1},t.unmarshalValue=function(e,t){return RangeValue.unmarshalRange(e,t)},t}(MoonOrderedSetBase),RangeValue=function(e){function t(t,i,r){var n=this,o=t[0]instanceof Array?t[0][0]:t[0],s=o;n=e.call(this)||this,n.closedLower=i,n.closedUpper=r;for(var a=1;a<t.length;a++)if(t[a]instanceof Array)for(var d=t[a],u=0;u<d.length;u++)o>d[u]&&(o=d[u]),s<d[u]&&(s=d[u]);else o>t[a]&&(o=t[a]),s<t[a]&&(s=t[a]);return n.min=o,n.max=s,n}return __extends(t,e),t.prototype.copy=function(){var e=new t([],this.closedLower,this.closedUpper);return e.min=this.min,e.max=this.max,e},t.prototype.isEqual=function(e){return e instanceof t&&(this.min===e.min&&this.max===e.max)},t.prototype.match=function(e){if(e instanceof t){var i=this.min<e.min?e.min:this.min,r=this.max<e.max?this.max:e.max;return i<r||i===r&&this.match(i)&&e.match(i)}return this.closedLower&&this.closedUpper?this.min<=e&&e<=this.max:this.closedLower&&!this.closedUpper?this.min<=e&&e<this.max:!this.closedLower&&this.closedUpper?this.min<e&&e<=this.max:this.min<e&&e<this.max},t.prototype.isLessThanOrEqualTo=function(e){return e instanceof t?this.closedLower&&this.min<=e.min||e.min>this.min:e>this.min},t.prototype.isGreaterThanOrEqualTo=function(e){return e instanceof t?this.closedUpper&&this.max>=e.max||e.max<this.max:e<this.max},t.prototype.lower=function(e){return this.isLessThanOrEqualTo(e)?this:e},t.prototype.upper=function(e){return this.isGreaterThanOrEqualTo(e)?this:e},t.prototype.intMin=function(){return this.closedLower?this.min:this.min+1},t.prototype.intMax=function(){return this.closedUpper?this.max:this.max-1},t.prototype.intConnectsWith=function(e){var i=this.closedLower?this.min-1:this.min,r=this.closedUpper?this.max+1:this.max;if(e instanceof t){var n=e.closedLower?e.min:e.min+1,o=e.closedUpper?e.max:e.max-1;return n===r||o===i}return e===i||e===r},t.prototype.merge=function(e){return e instanceof t?new t([this.min,this.max,e.min,e.max],this.min<e.min?this.closedLower:e.min<this.min?e.closedLower:this.closedLower||e.closedLower,this.max>e.max?this.closedUpper:e.max>this.max?e.closedUpper:this.closedUpper||e.closedUpper):this.closedLower&&e<this.min||!this.closedLower&&e<=this.min?new t([e,this.max],!0,this.closedUpper):this.closedUpper&&e>this.max||!this.closedUpper&&e>=this.max?new t([this.min,e],this.closedLower,!0):this},t.prototype.typeName=function(){return"range"},t.prototype.stringify=function(){return"r("+safeJSONStringify(this.min)+","+safeJSONStringify(this.max)+")"},t.prototype.toJSON=function(){return"R"+(this.closedLower?"c":"o")+(this.closedUpper?"c":"o")+"("+safeJSONStringify(this.min)+","+safeJSONStringify(this.max)+")"},t.prototype.toCdl=function(){return new MoonRange([this.min,this.max],this.closedLower,this.closedUpper)},t.prototype.marshalValue=function(e){var t=[];t.push(e.xdrCdlObj(this.min)),t.push(e.xdrCdlObj(this.max));var i=e.xdrCdlObj(this.closedLower),r=e.xdrCdlObj(this.closedUpper);return{type:this.typeName(),os:t,closedLower:i,closedUpper:r}},t.unmarshalValue=function(e,i){return t.unmarshalValue(e,i)},t.unmarshalRange=function(e,i){var r=e.os,n=e.closedLower,o=e.closedUpper;if("undefined"==typeof r)return[];for(var s=[],a=0;a<r.length;a++)s[a]=i.xdrCdlObj(r[a]);return new t(s,n,o)},t}(NonAV),Negation=function(e){function t(t){var i=e.call(this)||this;return i.queries=t,i}return __extends(t,e),t.prototype.copy=function(){return new t(deepCopy(this.queries))},t.prototype.match=function(e){throw"not implemented"},t.prototype.isEqual=function(e){if(e instanceof t){if(this.queries.length!==e.queries.length)return!1;for(var i=0;i<this.queries.length;i++)if(!objectEqual(this.queries[i],e.queries[i]))return!1;return!0}return!1},t.prototype.toJSON=function(){return"n("+this.queries.map(cstringify).join(", ")+")"},t.prototype.typeName=function(){return assert(!1,"it doesn't make sense to see negation as a constant"),"negation"},t.prototype.toCdl=function(){return new t(this.queries.map(runtimeValueToCdlExpression))},t.prototype.stringify=function(){return"n("+this.queries.map(cstringify).join(", ")+")"},t.prototype.marshalValue=function(e){return{type:this.typeName(),queries:e.xdrCdlObj(this.queries)}},t.unmarshalValue=function(e,i){var r=i.xdrCdlObj(e.queries);return new t(r)},t}(NonAV),MoonSubstringQuery=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.copy=function(){return new t(this.os)},t.prototype.makeNew=function(e){return new t(e)},t.prototype.toString=function(){return"s("+this.os.map(function(e){return e.toString()})+")"},t.prototype.stringify=function(){return"s("+this.os.map(cstringify).join(", ")+")"},t.prototype.toJSON=function(){return"s("+this.os.map(cstringify).join(", ")+")"},t.prototype.toCdl=function(){return this},t.prototype.typeName=function(){return"substringQuery"},t.prototype.match=function(e){throw"not implemented"},t}(MoonOrderedSetBase),SubStringQuery=function(e){function t(i){var r=e.call(this)||this;return i.some(function(e){return""===e||e instanceof Array&&0===e.length})?(r.strings=constEmptyOS,r.regexps=constEmptyOS,r):(r.strings=i,r.regexps=i.map(function(e){if(e instanceof RegExp)return e;var i="string"==typeof e?e.replace(/[[\]\\()*+?.|^${}]/g,"\\$&"):safeJSONStringify(e);return t.testWordCharStart.test(i)?new RegExp("\\b"+i,"i"):new RegExp(i,"i")}),r)}return __extends(t,e),t.prototype.copy=function(){return new t(this.strings)},t.prototype.isEqual=function(e){if(e instanceof t){var i=this.strings,r=e.strings;return i.every(function(e){return r.indexOf(e)!==-1})&&r.every(function(e){return i.indexOf(e)!==-1})}return!1},t.prototype.match=function(e){if("number"==typeof e&&(e=String(e)),"string"==typeof e){if(0===this.regexps.length)return!0;for(var t=0;t<this.regexps.length;t++)if(this.regexps[t].test(e))return!0}return!1},t.prototype.matchValue=function(e){return assert(!1,"TODO"),!1},t.prototype.typeName=function(){return"subStringQuery"},t.prototype.stringify=function(){return"s("+this.strings.map(safeJSONStringify).join(", ")+")"},t.prototype.toJSON=function(){return"s("+this.strings.map(cstringify).join(", ")+")"},t.prototype.toCdl=function(){return new MoonSubstringQuery(this.strings)},t.prototype.marshalValue=function(e){return{type:this.typeName(),strings:e.xdrCdlObj(this.strings)}},t.unmarshalValue=function(e,i){var r=i.xdrCdlObj(e.strings);return new t(r)},t}(NonAV);SubStringQuery.testWordCharStart=/^\w/;var MoonComparisonFunction=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.copy=function(){return new t(this.os)},t.prototype.makeNew=function(e){return new t(e)},t.prototype.toString=function(){return"c("+this.os.map(flatcdlify).join(",")+")"},t.prototype.stringify=function(){return"c("+this.os.map(cstringify).join(", ")+")"},t.prototype.toCdl=function(){return this},t.prototype.toJSON=function(){return"c("+this.os.map(cstringify).join(", ")+")"},t.prototype.match=function(e){throw"not implemented"},t.prototype.isEqual=function(e){if(e instanceof t){if(this.os.length!==e.os.length)return!1;for(var i=0;i<this.os.length;i++)if(!objectEqual(this.os[i],e.os[i]))return!1;return!0}return!1},t.prototype.typeName=function(){return"comparisonFunction"},t}(MoonOrderedSetBase),ComparisonFunctionValue=function(e){function t(t){var i=e.call(this)||this;return i.elements=t,i}return __extends(t,e),t.prototype.copy=function(){return new t(this.elements)},t.prototype.isEqual=function(e){return e instanceof t&&objectEqual(this.elements,e.elements)},t.prototype.match=function(e){if(e instanceof t&&e.elements.length>=this.elements.length){for(var i=0;i<this.elements.length;i++)if(!interpretedBoolMatch(this.elements[i],e.elements[i]))return!1;return!0}return!1},t.prototype.typeName=function(){return"comparisonFunction"},t.prototype.stringify=function(){return"c("+this.elements.map(safeJSONStringify).join(", ")+")"},t.prototype.toCdl=function(){return this},t.prototype.toJSON=function(){return"c("+this.elements.map(safeJSONStringify).join(", ")+")"},t.prototype.inAscendingOrder=function(){var e=this.elements.length;return 0===e?(Utilities.warn("empty comparison function"),!0):getDeOSedValue(this.elements[e-1])!==descending},t.prototype.orderByValue=function(){var e=this.elements.length;return 1===e||2===e&&(getDeOSedValue(this.elements[1])===ascending||getDeOSedValue(this.elements[1])===descending)},t.prototype.marshalValue=function(e){return{type:this.typeName(),os:this.elements.map(e.xdrCdlObj)}},t.unmarshalValue=function(e,i){var r=e.os;return new t(void 0===r?[]:r.map(i.xdrCdlObj))},t}(NonAV),RuntimeArgument=function(e){function t(t){var i=e.call(this)||this;return i.index=t,i}return __extends(t,e),t.prototype.copy=function(){return this},t.prototype.typeName=function(){throw"do not call"},t.prototype.stringify=function(){return"new RuntimeArgument("+String(this.index)+")"},t.prototype.toCdl=function(){return this},t.prototype.toJSON=function(){return"$"+String(this.index)},t.prototype.match=function(e){throw"not implemented"},t.prototype.isEqual=function(e){return e instanceof t&&e.index===this.index},t.prototype.marshalValue=function(e){throw"cannot be called"},t}(NonAV),NativeObjectWrapper=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.isEqual=function(e){return e instanceof t&&(this.file===e.file&&this.foreignInterfaceConstructor===e.foreignInterfaceConstructor)},t.prototype.match=function(e){if(e instanceof t){if(void 0!==e.file&&void 0!==this.file)return this.file.name===e.file.name&&this.file.size===e.file.size&&this.file.lastModified===e.file.lastModified;if(void 0!==e.foreignInterfaceConstructor&&void 0!==this.foreignInterfaceConstructor)return this.foreignInterfaceConstructor===e.foreignInterfaceConstructor}return!1},t.prototype.copy=function(){var e=new t;return"file"in this&&(e.file=this.file),"foreignInterfaceConstructor"in this&&(e.foreignInterfaceConstructor=this.foreignInterfaceConstructor),e},t.prototype.typeName=function(){return"NativeObjectWrapper"},t.prototype.stringify=function(){return"file"in this&&void 0!==this.file?"File("+this.file.name+")":"foreignInterfaceConstructor"in this?"foreignInterfaceConstructor":"unknown"},t.prototype.toCdl=function(){return this},t.prototype.toJSON=function(){return"file"in this&&void 0!==this.file?JSON.stringify(this.file.name):"foreignInterfaceConstructor"in this?'"foreignInterfaceConstructor"':'"unknown"'},t.prototype.toString=function(){return"file"in this&&void 0!==this.file?this.file.name:""},t.prototype.marshalValue=function(e){return{type:"undefined"}},t.unmarshalValue=function(e,t){},t.prototype.createForeignInterface=function(){return"foreignInterfaceConstructor"in this?new this.foreignInterfaceConstructor:void 0},t}(NonAV),jsIdentifierRegExp=/^[a-zA-Z_][a-zA-Z0-9_]*$/,classDefinitions={},simpleTypes={string:!0,number:!0,boolean:!0},dbglvl=0,Unquote=function(){function e(e){this.str=e}return e.prototype.compare=function(e){return this.str===e.str?0:this.str<e.str?-1:1},e}(),ChildInfo=function(){function e(){}return e}(),ValueTypeDescription=function(){function e(e,t,i){this.type=e,this.av=t,this.elements=i}return e.prototype.matches=function(e){if("any"===this.type&&void 0!==e)return!0;var t=typeof e;if("object"!==t)return t===this.type;if(e instanceof Array){if("os"!==this.type)return e.length<=1&&this.matches(e[0]);for(var i=0;i<e.length;i++){for(var r=e[i],n=0;n<this.elements.length&&!this.elements[n].matches(r);n++);if(n===this.elements.length)return!1}return!0}if(e instanceof Projector)return"projector"===this.type;if(e instanceof RegExp)return"regexp"===this.type;if(e instanceof RangeValue)return"range"===this.type;if(e instanceof NonAV)return!1;for(var o in e){var s=this.av[o];if(void 0===s&&(s=this.av._,void 0===s))return!1;for(var n=0;n<s.length&&!s[n].matches(e[o]);n++);if(n===s.length)return!1}for(var o in this.av)if(!(o in e)&&"_"!==o){for(var s=this.av[o],n=0;n<s.length&&!s[n].matches(void 0);n++);if(n===s.length)return!1}return!0},e}(),ForeignInterface=function(){function e(){this.hasDivSet=!1}return e.prototype.destroy=function(){},e.prototype.setArgument=function(e,t){return void 0===this.arguments&&(this.arguments=[]),this.arguments[e]=t,!0},e.prototype.setDiv=function(e,t){this.displayOfArea=e,this.hasDivSet=!0},e.prototype.allowsEmbedding=function(){return!0},e.prototype.releaseDiv=function(){this.displayOfArea=void 0,this.hasDivSet=!1},e.prototype.wrapUpVisuals=function(){},e.prototype.displayElementVisible=function(){},e.prototype.write=function(e,t,i,r){Utilities.warn("dead-ended write: cannot write through foreign function: "+gWriteAction)},e.prototype.isDisplay=function(){return this.hasDivSet},e.prototype.getDisplayArea=function(){return this.displayOfArea},e.prototype.addChildArea=function(e,t,i){},e.prototype.removeChildArea=function(e,t){},e}(),foreignInterfaceObjects=[],isFeg=!0,mode,showResolution,Utilities;!function(e){function t(e){return 0===Object.keys(e).length}function i(e){return Object.keys(e)[0]}function r(e,t){var i={};for(var r in e)t(r,e[r])&&(i[r]=e[r]);return i}function n(e,t){var i={};for(var r in e)i[r]=t(r,e[r]);return i}function o(e,t,i){for(var r=e,n=0;n<t.length-1;n++)t[n]in r&&r[t[n]]&&r[t[n]]instanceof Object||(r[t[n]]={}),r=r[t[n]];r[t[t.length-1]]=i}function s(e,t,i){void 0===i&&(i=0);var r,n=e;for(r=void 0===i?0:i;r<t.length;r++){if(!(n instanceof Object&&t[r]in n))return;n=n[t[r]]}return n}function a(e,t,i){return void 0===i&&(i=0),void 0!==s(e,t,i)}function d(e){console.log(e)}function u(e){console.log(e)}function h(e){if(e instanceof ElementReference)return new ElementReference(e.getElement());if(e instanceof Array){var t=[];t.length=e.length;for(var i=0;i!==e.length;i++)t[i]=h(e[i]);return t}if(e instanceof Object){var r={};for(var n in e)r[n]=h(e[n]);return r}return e}function l(e){var t=gErrContext.getErrorContext();throw void 0!==t&&(e+=" at "+t),u("error: "+e),new C(e)}function c(t,i,r){void 0===i&&(i=!1),void 0===r&&(r=void 0);var n=gErrContext.getErrorContext(i);void 0!==n&&(t+=" at "+n),void 0!==r&&(t+="\n"+("dump"===mode?"":"// error: ")+r),t in R||(R[t]=!0,"dump"===mode?console.log("error: "+t):console.log("// error: "+t),e.hasSyntaxError=!0)}function p(e,t){var i=gErrContext.getErrorContext();void 0!==i&&(e+=" at "+i),e in R||(R[e]=!0,t<strictnessLevel?console.log("// error: "+e):console.log("// warning: "+e))}function f(e){var t=gErrContext.getErrorContext();void 0!==t&&(e+=" at "+t),e in S||(S[e]=!0)}function v(){S={}}function g(){for(var e in S)"dump"===mode?console.log("error: type error: "+e):console.log("// error: type error: "+e)}function m(e){var t=gErrContext.getErrorContext();void 0!==t&&(e+=" at "+t),d("dump"===mode?"warning: "+e:"// warning: "+e)}function y(e){e in R||(m(e),R[e]=!0)}function I(e){console.log(e)}function b(e){showRuntimeWarnings&&d("warning: "+e)}var C=function(){function e(e){this.msg=e}return e.prototype.toString=function(){return this.msg},e}();e.AssertException=C,e.isEmptyObj=t,e.firstAttribute=i,e.filterObj=r,e.mapObj=n,e.addAssociationPath=o,e.getAssociationPath=s,e.hasAssociationPath=a,e.warnMessage=d,e.errorMessage=u,e.dupObjSafe=h,e.error=l,e.hasSyntaxError=!1,e.syntaxError=c,e.semanticWarning=p;var S;e.typeError=f,e.resetAllTypeErrors=v,e.printAllTypeErrors=g;var R={};e.warn=m,e.warnOnce=y,e.log=I,e.runtimeWarning=b}(Utilities||(Utilities={}));var taskLastId,debugTasks=!1,debugTaskQueueStop,TaskQueue=function(){function e(){this.pendingTasks=new SortedList,this.nextTaskScheduled=!1,this.timeoutId=void 0,this.iterationRunning=!1,this.isSuspended=!1,this.iterationStartTime=void 0,this.iterationTimeout=50,this.yieldToBrowser=!1,this.debugCounter=0}return e.prototype.scheduleTask=function(e,t,i){void 0===i&&(i=!1),assert(void 0!==t,"debugging");var r=e.currentTaskId;void 0===r&&(e.currentTaskId=r=nextTaskId());var n=this.pendingTasks.getNode(r,!0);(void 0===n||n.sortVal<t)&&this.pendingTasks.insert({id:r,task:e},r,t,!0),!this.iterationRunning&&i?this.executePendingTasks(!1):this.scheduleNextIteration()},e.prototype.scheduleNextIteration=function(){if(!this.isSuspended&&!this.nextTaskScheduled){if(void 0!==this.timeoutId)return void(debugTasks&&console.log("repeated scheduling"));debugTasks&&this.yieldToBrowser&&console.log("scheduling after yield"),this.timeoutId=setTimeout(timedExecutePendingTasks,this.yieldToBrowser?2:0),this.nextTaskScheduled=!0}},e.prototype.clearNextIteration=function(){this.nextTaskScheduled&&(this.nextTaskScheduled=!1,clearTimeout(this.timeoutId),this.timeoutId=void 0)},e.prototype.suspend=function(){this.isSuspended=!0,this.clearNextIteration()},e.prototype.resume=function(){this.isSuspended=!1,this.scheduleNextIteration()},e.prototype.executePendingTasks=function(e){e&&(debugTasks&&this.yieldToBrowser&&console.log("end yield"),this.yieldToBrowser=!1,this.timeoutId=void 0),this.pendingTasks.isEmpty()||(gInitPhase?taskQueueInitProgressHook(evaluationQueue.getProgressIndicatorValue()):taskQueueRunningHook()),this.isSuspended||(debugStartTimer("task queue","executing pending tasks"),this.iterationRunning=!0,this.doExecutePendingTasks(e),this.iterationRunning=!1,debugStopTimer("executing pending tasks"),this.pendingTasks.isEmpty()&&(debugStopTimer("total initial configuration"),taskQueueEmptyHook(),debugNoPendingTasksNotification()))},e.prototype.doExecutePendingTasks=function(e){if(e?(this.nextTaskScheduled=!1,this.timeoutId=void 0):this.clearNextIteration(),!this.pendingTasks.isEmpty())for(debugTaskQueueStop&&(this.debugCounter++,this.debugCounter%debugTaskQueueStop===0&&breakIntoDebugger()),this.scheduleNextIteration(),this.iterationStartTime=Date.now();!this.isSuspended;){void 0!==testDurationGuardTime&&Date.now()>testDurationGuardTime&&void 0!==testDurationGuardTime&&Utilities.error("Test runs too long");var t,i=this.pendingTasks.first.entry;if(debugTotalTimeStart(i.task.name),debugTasks&&console.log("execute task",i.task.name),g_noTryAndCatchUpdate)t=i.task.executeTask(this);else try{t=i.task.executeTask(this)}catch(e){t=!0,signalRuntimeException(String(e))}if(debugTotalTimeStop(i.task.name),t&&(this.pendingTasks.remove(i.id),this.pendingTasks.isEmpty()))return void this.clearNextIteration();if(this.timedOut())return void(this.nextTaskScheduled||this.scheduleNextIteration())}},e.prototype.timedOut=function(){if(this.yieldToBrowser)return debugTasks&&console.log("yielding to browser"),!0;if(noTimeOut)return!1;var e=Date.now();return this.iterationRunning&&e-this.iterationStartTime>=this.iterationTimeout},e.prototype.isScheduled=function(e){return void 0!==e.currentTaskId&&void 0!==this.pendingTasks.getNode(e.currentTaskId,!0)},e}();TaskQueue.remotingPriority=130,TaskQueue.contentPriority=120,TaskQueue.geometryPriority=110,TaskQueue.preWritesPriority=100,TaskQueue.commitWritesPriority=90,TaskQueue.nextMessagePriority=85,TaskQueue.reupdatePointerInAreaPriority=82,TaskQueue.areaDisplayUpdatePriority=80,TaskQueue.visualFlushPriority=70,TaskQueue.visualWrapupPriority=60,TaskQueue.queuedEventPriority=50,TaskQueue.debuggerPriority=40,TaskQueue.printPriority=35,TaskQueue.concludeInitPhasePriority=30,TaskQueue.concludeLoopWarningPriority=20,TaskQueue.screenResizePriority=17,TaskQueue.indexerGarbageCollectionPriority=15,TaskQueue.setFocusPriority=12,TaskQueue.testPriority=10;var globalTaskQueue,__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),gContentPositionCycleCount=0,gMaxContentPositionCycleCount=0,nDisplayQueryRecalc=0,maxDisplayQueryRecalc=11,displayQueryRecalcTime=500,displayQueryRecalcTimeFactor=1.3,ScheduledTask=function(){function e(e,t,i,r){this.name=e,this.priority=t,this.checkBlockTaskLoop=i,this.task=r,this.isScheduled=!1,this.inTask=!1}return e.prototype.executeTask=function(e){this.inTask=!0;var t=this.task(e);return this.inTask=!1,this.isScheduled=!t,t},e.prototype.schedule=function(){this.isScheduled||this.checkBlockTaskLoop&&blockTaskLoop&&!forcedSchedule||(this.isScheduled=!0,globalTaskQueue.scheduleTask(this,this.priority))},e}(),blockTaskLoop=!1,forcedSchedule=!1,ContentTask=function(e){function t(){return e.call(this,"content",TaskQueue.contentPriority,!0,void 0)||this}return __extends(t,e),t.prototype.schedule=function(){if(!this.isScheduled){if(globalGeometryTask.isScheduled||globalCommitWritesTask.isScheduled){if(blockTaskLoop&&!forcedSchedule)return;gContentPositionCycleCount++,gContentPositionCycleCount>gMaxContentPositionCycleCount&&(gMaxContentPositionCycleCount=gContentPositionCycleCount),100===gContentPositionCycleCount&&(possibleLoopDetected=!0,console.log("possible content/position cycle"),breakIntoDebugger()),blockTaskLoop=gContentPositionCycleCount>=100}else possibleLoopDetected||(gContentPositionCycleCount=0,possibleLoopDetected=blockTaskLoop);globalTaskQueue.scheduleTask(this,this.priority),this.isScheduled=!0,globalDebuggerTask.schedule()}},t.prototype.executeTask=function(e){this.inTask=!0,logValues&&gSimpleLog.log("run content");var t=evaluationQueue.runQueue(0,e);return globalPosConstraintSynchronizer.isEmpty()&&!globalPos.needToRefresh()||globalGeometryTask.schedule(),possibleLoopDetected?checkAreaCreationCycle():clearAreaCreationState(),globalContentLoopWarningTask.schedule(),this.inTask=!1,this.isScheduled=!t,t},t}(ScheduledTask),globalContentTask=new ContentTask,GeometryTask=function(e){function t(){return e.call(this,"geometry",TaskQueue.geometryPriority,!0,void 0)||this}return __extends(t,e),t.prototype.schedule=function(){if(!this.isScheduled){if(globalContentTask.isScheduled||globalCommitWritesTask.isScheduled){if(blockTaskLoop&&!forcedSchedule)return;gContentPositionCycleCount++,gContentPositionCycleCount>gMaxContentPositionCycleCount&&(gMaxContentPositionCycleCount=gContentPositionCycleCount),100===gContentPositionCycleCount&&(possibleLoopDetected=!0,console.log("possible content/position cycle"),breakIntoDebugger()),blockTaskLoop=gContentPositionCycleCount>=100}else possibleLoopDetected||(gContentPositionCycleCount=0,possibleLoopDetected=blockTaskLoop);globalTaskQueue.scheduleTask(this,this.priority),this.isScheduled=!0,globalDebuggerTask.schedule()}},t.prototype.executeTask=function(e){logValues&&gSimpleLog.log("run positioning",globalPosConstraintSynchronizer.buffer.length),this.inTask=!0,runGeometry(),gZIndex.changes&&gZIndex.updateZ(),globalReupdatePointerInAreaTask.schedule();var t=globalPos.needToRefresh();return this.inTask=!1,this.isScheduled=t,t||globalPositioningDependency.undefer(),!t},t}(ScheduledTask),globalGeometryTask=new GeometryTask,globalPreWriteNotificationTask=new ScheduledTask("preWrite",TaskQueue.preWritesPriority,!0,function(e){return evaluationQueue.preWritesNotification(),globalCommitWritesTask.schedule(),!0}),globalCommitWritesTask=new ScheduledTask("commitWrites",TaskQueue.commitWritesPriority,!0,function(e){return evaluationQueue.commitWrites(),globalEventQueue.clearMessage(),!0}),globalNextMessageTask=new ScheduledTask("nextMessage",TaskQueue.nextMessagePriority,!0,function(e){return evaluationQueue.globalMessageQueue.nextMessage()}),globalDebuggerTask=new ScheduledTask("debugger",TaskQueue.debuggerPriority,!1,function(e){return gDebuggerInfoMgr.update(),!0}),PrintTask=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.printJobs=[],t.printWindow=void 0,t}return __extends(t,e),t.prototype.addPrintTask=function(e){void 0!==e&&this.printJobs.push(e),globalPrintTask.schedule()},t.prototype.setWindow=function(e){this.printWindow=e},t.prototype.printAll=function(){if(0===this.printJobs.length){print();var e={type:["Print"],subType:["end"],time:[Date.now()]};return void queueEvent(new ImpersonatedDomEvent("print"),e,void 0,constEmptyOS,void 0,constEmptyOS,constEmptyOS,void 0,void 0,void 0)}if(this.printWindow){for(var t=this.printJobs[0].getEmbeddingRect(),i="",r=1;r<this.printJobs.length;r++){var n=this.printJobs[r].getEmbeddingRect();t.top=Math.min(t.top,n.top),t.left=Math.min(t.left,n.left)}for(var r=0;r<this.printJobs.length;r++){var o=this.printJobs[r].getEmbeddingRect(),s=this.printJobs[r].getHTMLRepr();void 0!==s&&(i+='<div style="position: absolute; top: '+(o.top-t.top)+"px; left: "+(o.left-t.left)+"px; width: "+o.width+"px; height: "+o.height+'px;">'+s+"</div>")}if(this.printJobs=[],""!==i){var a=document.baseURI.slice(0,document.baseURI.lastIndexOf("/")+1),d="",u=document.getElementsByTagName("head");if(1===u.length)for(var h=u[0].children,r=0;r<h.length;r++){var l=h.item(r);(l instanceof HTMLMetaElement||l instanceof HTMLStyleElement||l instanceof HTMLLinkElement)&&(d+=l.outerHTML)}var c=this.printWindow;this.printWindow=void 0,c.document.write('<html><head><base href="'+a+'">'+d+"</head><body>"+i+"</body></html>"),setTimeout(function(){c.print(),c.close()},1e3)}}},t}(ScheduledTask),globalPrintTask=new PrintTask("print",TaskQueue.printPriority,!1,function(e){return globalPrintTask.printAll(),!0}),globalTestTask=new ScheduledTask("test",TaskQueue.testPriority,!1,function(e){return executeNextTestTask()}),globalScreenAreaSize,globalScreenResizeTask=new ScheduledTask("resizeScreen",TaskQueue.screenResizePriority,!1,function(e){return globalScreenAreaSize=determineScreenAreaSize(),setTimeout(function(){void 0===suppressRunningUntil&&(suppressRunningUntil=Date.now()+100),globalScreenWidthConstraint.newDescription({point1:{type:"left"},point2:{type:"right"},equals:globalScreenAreaSize.width,priority:1e4},1e4),globalScreenHeightConstraint.newDescription({point1:{type:"top"},point2:{type:"bottom"},equals:globalScreenAreaSize.height,priority:1e4},1e4),gDomEvent.resizeScreenArea(globalScreenAreaSize.width,globalScreenAreaSize.height),scheduleGeometryTask(),scheduleDisplayQueryRecalculation()},20),!0}),globalRemotingTask=new ScheduledTask("remoting",TaskQueue.remotingPriority,!1,function(e){return gRemoteMgr.flush(),!0}),globalIndexerGarbageCollectionTask=new ScheduledTask("indexer garbage collection",TaskQueue.indexerGarbageCollectionPriority,!1,function(e){return globalInternalQCM.executeGarbageCollection(e)}),globalReupdatePointerInAreaTask=new ScheduledTask("reupdatePointerInArea",TaskQueue.reupdatePointerInAreaPriority,!1,function(e){return globalEventQueue.reupdatePointerInArea(),!0}),globalAreaDisplayUpdateTask=new ScheduledTask("areaDisplayUpdate",TaskQueue.areaDisplayUpdatePriority,!1,function(e){return allAreaMonitor.areaDisplayUpdate()}),globalVisualFlushTask=new ScheduledTask("visualFlush",TaskQueue.visualFlushPriority,!1,function(e){return allAreaMonitor.updateVisuals()}),globalVisualWrapupTask=new ScheduledTask("visualWrapup",TaskQueue.visualWrapupPriority,!1,function(e){return!!allAreaMonitor.wrapupUpdateVisuals()&&(yieldToBrowser(),!0)}),gInitPhase=!0,globalConcludeInitPhaseTask=new ScheduledTask("concludeInitPhase",TaskQueue.concludeInitPhasePriority,!1,function(e){return gInitPhase=!1,allAreaMonitor.cleanUpUnusedEvaluationNodes(),gRemoteMgr.hasPendingResources()||(hideSplashScreen(),allAreaMonitor.allDisplayElementsVisible()),!0}),globalSetFocusTask=new ScheduledTask("setFocus",TaskQueue.setFocusPriority,!1,function(e){return gDomEvent.updateFocus(),!0}),globalNextQueuedEvent=new ScheduledTask("nextQueuedEvent",TaskQueue.queuedEventPriority,!1,function(e){return globalEventQueue.nextQueuedEvent()}),globalContentLoopWarningTask=new ScheduledTask("concludeLoopWarning",TaskQueue.concludeLoopWarningPriority,!1,function(e){return evaluationQueue.isDeferredEmpty(0)||(runTests?assert(!1,"deferred queue not empty: there is a loop"):console.warn("deferred queue not empty: there is a loop")),!0}),gNumberSuspends=0,nextWatcherId=1025,__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),TestTimer=function(){function e(e){this.accum=0,this.nr=e}return e.prototype.start=function(){this.startTime=Date.now()},e.prototype.stop=function(){"undefined"==typeof this.startTime?console.log("timer:",this.nr,"not started"):(this.accum=Date.now()-this.startTime,this.startTime=void 0,console.log("timer:",this.nr,this.accum,"ms"))},e.prototype.pause=function(){this.accum=Date.now()-this.startTime,this.startTime=void 0},e.prototype.resume=function(){this.startTime=Date.now()},e}(),testTimers={},TestNode=function(){function e(e){this.dataSourceAware=!1,this.evaluationNodes={},this.inputValues={},this.watcherId=getNextWatcherId(),this.deferred=!1,this.scheduledAtPosition=-1,this.active=!1,this.scheduleStep=e}return e.convertArg=function(e){return e instanceof FNRef?getEvaluationNode(refFunctionNode(e),void 0):e},e.prototype.toLogString=function(){},
e.getSingleArea=function(e,t){var i;if(t=getDeOSedValue(t),t instanceof ElementReference){var r=allAreaMonitor.getAreaById(t.getElement());return"undefined"==typeof r&&Utilities.warn(e+": no area for areaId '"+t.getElement()+"'"),r}if(t instanceof Array&&t.length>1){i="";for(var n=0;n<t.length;n++)i+=cdlify(t[n])+" ";Utilities.warn(e+": multiple matches: "+i)}else isFalse(t)?Utilities.warn(e+": no area matched"):Utilities.warn(e+": unexpected argument")},e.getSingleAreaStr=function(e){var t;return e=getDeOSedValue(e),t=e instanceof ElementReference?e.stringify():"??"},e.getFocusArea=function(){var e,t=document.activeElement;t instanceof HTMLElement?e=t:t=void 0;var i=void 0;if(e&&e.parentNode&&e.parentNode.parentNode){var r,n,o=e.parentNode.parentNode;o instanceof HTMLElement&&(r=o,n=r.getAttribute("id")),"string"==typeof n&&(i=allAreaMonitor.getAreaById(n))}return i instanceof DisplayArea?i:void 0},e.prototype.reasonOfFailure=function(){},e.prototype.registerInputs=function(){var e=!0;for(var t in this.inputs){var i=this.inputs[t];if(i instanceof FNRef){var r=getEvaluationNode(refFunctionNode(i),void 0);r.isConstant()?this.inputValues[t]=getDeOSedValue(r.result.value):(this.evaluationNodes[t]=r,r.addWatcher(this,t,!0,!0,!1),e=!1)}else this.inputValues[t]=i}return e},e.prototype.unregisterInputs=function(){for(var e in this.evaluationNodes)this.evaluationNodes[e].removeWatcher(this,!0,!1);this.evaluationNodes=void 0},e.prototype.activate=function(e){this.active=!0,this.testRunner=e,this.registerInputs()},e.prototype.deactivate=function(){this.testRunner=void 0,this.unregisterInputs(),this.active=!1},e.prototype.isActive=function(){return this.active},e.prototype.updateInput=function(e,t){this.inputValues[e]=getDeOSedValue(t.value),this.deferred&&this.undefer(),evaluationQueue.schedule(this,!1)},e.prototype.unlatch=function(){},e.prototype.updateOutput=function(){this.test()&&(testSingleStep||globalTestTask.schedule()),this.deactivate()},e.prototype.test=function(){debugTest&&console.log("Executing TestNode: "+this.toLogString());var e=this.performTest();if(e)debugTest&&console.log("test succeeded");else{var t=this.reasonOfFailure();console.log("test failure: ",this.toLogString()),void 0!==t&&console.log("because:",t),endTest(1)}return this.testRunner.failed=!e,e},e.prototype.isScheduled=function(){return this.scheduledAtPosition!==-1},e.prototype.getScheduleStep=function(){return this.scheduleStep},e.prototype.getSchedulePriority=function(){return 0},e.prototype.defer=function(){this.deferred=!0,evaluationQueue.defer(this);for(var e in this.evaluationNodes){var t=this.evaluationNodes[e];void 0!==t&&t.scheduledAtPosition!==-1&&t.addAwaitingThis(this.watcherId,this)}},e.prototype.undefer=function(){this.deferred=!1,evaluationQueue.undefer(this);for(var e in this.evaluationNodes){var t=this.evaluationNodes[e];void 0!==t&&void 0!==t.awaitingThis&&t.awaitingThis.has(this.watcherId)&&t.removeAwaitingThis(this.watcherId)}evaluationQueue.schedule(this,!1)},e.prototype.isDeferred=function(){return this.deferred},e.prototype.isReady=function(){for(var e in this.evaluationNodes)if(this.evaluationNodes[e].deferred)return!1;return!0},e.prototype.debugName=function(){return"testNode"},e.prototype.getDebugOrigin=function(){return["test node "]},e}(),LogTest=function(e){function t(t,i){var r=e.call(this,t)||this;return r.inputs={log:i},r}return __extends(t,e),t.prototype.performTest=function(){return console.log(this.toLogString()),!0},t.prototype.toLogString=function(){var e=this.inputValues.log,t="string"==typeof e?e:vstringify(e);return void 0!==testLogBreak&&testLogBreak.test(t)&&(testSingleStep=!0,testDurationGuardTime=void 0,console.log("testLogBreak matched output of log")),"log: "+t},t}(TestNode),SleepTest=function(e){function t(t,i){var r=e.call(this,t)||this;return r.inputs={sleep:i},r}return __extends(t,e),t.prototype.performTest=function(){var e=getDeOSedValue(this.inputValues.sleep);if(e>0)suspendScheduledTasks(),setTimeout(function(){resumeScheduledTasks()},e);else if(0!==e)return!1;return!0},t.prototype.toLogString=function(){var e=this.inputValues.sleep;return"sleep: "+("string"==typeof e?e:vstringify(e))},t.prototype.reasonOfFailure=function(){return"sleep time is not a positive number"},t}(TestNode),AssertTest=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.inputs={assert:i,comment:r},n}return __extends(t,e),t.prototype.performTest=function(){return isTrue(this.inputValues.assert)},t.prototype.toLogString=function(){var e=this.inputValues.comment;return"assert: "+("string"==typeof e?e:vstringify(e))},t}(TestNode),TimerTest=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.inputs={timerIndex:i,action:r},n}return __extends(t,e),t.prototype.performTest=function(){var e=this.inputValues.timerIndex,t=this.inputValues.action;switch(e in testTimers||(testTimers[e]=new TestTimer(e)),t){case"start":testTimers[e].start();break;case"stop":testTimers[e].stop();break;case"pause":testTimers[e].pause();break;case"resume":testTimers[e].resume();break;default:console.log("timer",e,"wrong action:",t)}return!0},t.prototype.toLogString=function(){var e=this.inputValues.timerIndex,t=this.inputValues.action;return"timer #"+e+": "+t},t}(TestNode),LogInternalActions=function(e){function t(t,i){var r=e.call(this,t)||this;return r.inputs={logInternalActionsArg:i},r}return __extends(t,e),t.prototype.performTest=function(){var e=stripArray(this.inputValues.logInternalActionsArg);return void 0!==e&&"object"==typeof e&&(void 0!==e.expressions&&(isTrue(e.expressions)?(logValues=!0,logPrototypes=void 0):(logValues=!1,logPrototypes={})),void 0!==e.writes&&(debugWrites=isTrue(e.writes)),void 0!==e.test&&(debugTest=isTrue(e.test)),void 0!==e.areas&&(debugAreaConstruction=isTrue(e.areas)),isTrue(e.printAreaHierarchy)&&console.log(printObjAsTree(areaHierarchy())),isTrue(e.printAllDataSourceApplicationTrees)&&console.log(printObjAsTree(printAllDataSourceApplicationTrees(!1)))),!0},t.prototype.toLogString=function(){var e=this.inputValues.logInternalActionsArg;return"logInternalActions "+e},t}(TestNode),AreaRelativeMouseEventTest=function(e){function t(t,i,r,n,o,s,a){var d=e.call(this,t)||this;return d.inputs={eType:i,btn:r,area:n,x:o,y:s,modifier:a},d}return __extends(t,e),t.prototype.performTest=function(){var e=this.inputValues.eType,i=this.inputValues.btn;if("string"==typeof i){var r=i,n={left:0,middle:1,right:2};i=n[r]}var o=TestNode.getSingleArea("AreaRelativeMouseEventTest",this.inputValues.area),s=getDeOSedValue(this.inputValues.x),a=getDeOSedValue(this.inputValues.y),d=this.inputValues.modifier;if("undefined"==typeof o)return!1;var u=t.getAbsPos(o);void 0!==s&&s!==!1||(s=.5),void 0!==a&&a!==!1||(a=.5);var h=u.left+u.width*s,l=u.top+u.height*a;return void 0===d&&(d=[]),"string"==typeof d&&(d=[d]),this.postEvent(e,i,h,l,d),!0},t.prototype.postEvent=function(e,t,i,r,n){enqueueImpersonatedMouseEvent(e,t,i,r,n)},t.prototype.toLogString=function(){var e=this.inputValues.eType,t=this.inputValues.btn,i=TestNode.getSingleAreaStr(this.inputValues.area),r=this.inputValues.x,n=this.inputValues.y,o=this.inputValues.modifier;return"AreaRelativeMouseEvent "+e+":"+t+"<"+i+">("+r+","+n+") mod:"+String(o)},t.getAbsPos=function(e){for(var t=e.getPos(),i=t.top,r=t.left,n=e.getEmbedding();n;n=n.getEmbedding()){var o=n.getOffsets();"object"==typeof o&&(i+=isNaN(o.top)?0:o.top,r+=isNaN(o.left)?0:o.left);var s=n.getPos();i+=s.top,r+=s.left}return{top:i,left:r,width:t.width,height:t.height}},t.prototype.reasonOfFailure=function(){var e=this.evaluationNodes.area;return void 0!==e?e.reasonForBeingEmpty():void 0},t}(TestNode),FileChoiceEventTest=function(e){function t(t,i,r,n,o,s){var a=e.call(this,t,"",void 0,n,o,s,[])||this;return a.inputs.fileName=i,a.inputs.subType=r,a}return __extends(t,e),t.prototype.postEvent=function(e,t,i,r,n){enqueueImpersonatedDropEvent(this.inputValues.area,i,r,this.inputValues.subType,ensureOS(this.inputValues.fileName))},t.prototype.toLogString=function(){return"FileChoiceEvent: "+cdlify(this.inputValues.fileName)},t}(AreaRelativeMouseEventTest),KeyEventTest=function(e){function t(t,i,r,n,o){var s=e.call(this,t)||this;return s.inputs={eType:i,key:r,eChar:n,modifier:o},s}return __extends(t,e),t.prototype.performTest=function(){var e=this.inputValues.eType,t=this.inputValues.key,i=this.inputValues.eChar,r=this.inputValues.modifier;return"undefined"==typeof r&&(r=[]),"string"==typeof r&&(r=[r]),enqueueImpersonatedKeyEvent(e,t,i,r),!0},t.prototype.toLogString=function(){var e=this.inputValues.eType,t=this.inputValues.key,i=this.inputValues.eChar,r=this.inputValues.modifier;return"KeyEvent "+e+": key="+t+", char="+i+", mod:"+String(r)},t}(TestNode),TestStoreRecord=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.inputs={label:i,value:r},n}return __extends(t,e),t.prototype.performTest=function(){var e=this.inputValues.label,t=this.inputValues.value;return"string"==typeof e?(EFTestStore.updateLabel(e,t),!0):(console.log("TestStoreRecord: label value is not a string"),!1)},t.prototype.toLogString=function(){var e=this.inputValues.label,t=this.inputValues.value;return"TestStoreRecord label="+e+" value="+String(t)},t}(TestNode),TestDebugger=function(e){function t(t,i){var r=e.call(this,t)||this;return r.inputs={debugVal:i},r}return __extends(t,e),t.prototype.performTest=function(){var e=this.inputValues.debugVal;return!!e==!0&&breakIntoDebugger(),!0},t.prototype.toLogString=function(){var e=this.inputValues.debugVal;return"TestDebugger debugVal="+String(e)},t}(TestNode),TextInputTest=function(e){function t(t,i){var r=e.call(this,t)||this;return r.inputs={textInputObj:i},r}return __extends(t,e),t.prototype.performTest=function(){var e=this.inputValues.textInputObj,t=e.value,i=e.selectionStart,r=e.selectionEnd,n=e.selectionDirection,o=TestNode.getFocusArea();if("undefined"==typeof o)return Utilities.warn("TextInputTest: could not identify focus area"),!1;if(!o.display||!o.display.hasActiveInputElement||!o.display.hasActiveInputElement())return Utilities.warn("TextInputTest: focus area does not have an active input element"),!1;var s=o.display;return"undefined"!=typeof t&&s.setInputState("value",t),"undefined"!=typeof i&&s.setInputState("selectionStart",i),"undefined"!=typeof r&&s.setInputState("selectionEnd",r),"undefined"!=typeof n&&s.setInputState("selectionDirection",n),!0},t.prototype.toLogString=function(){var e=this.inputValues.textInputObj,t=e.value,i=e.selectionStart,r=e.selectionEnd,n=e.selectionDirection,o="TextInput:";return"string"==typeof t&&(o+=" value = '"+t+"'"),"string"!=typeof i&&"number"!=typeof i||(o+=" selectionStart = '"+i+"'"),"string"!=typeof r&&"number"!=typeof r||(o+=" selectionEnd = '"+r+"'"),"string"==typeof n&&(o+=" selectionDirection = '"+n+"'"),o},t}(TestNode),FocusTest=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.inputs={focusBlur:i,area:r},n}return __extends(t,e),t.prototype.performTest=function(){var e=this.inputValues.focusBlur,t=TestNode.getSingleArea("FocusTest",this.inputValues.area);return"boolean"!=typeof e?(Utilities.warn("FocusTest: focus/blur is not a boolean"),!1):"undefined"!=typeof t&&(e?t.takeFocus():t.releaseFocus(),!0)},t.prototype.toLogString=function(){var e=this.inputValues.focusBlur,t=TestNode.getSingleAreaStr(this.inputValues.area),i=e===!0?"focus":e===!1?"blur":"???";return"FocusTest: "+i+" area="+t},t}(TestNode),IfThenElseTest=function(e){function t(t,i,r,n){var o=e.call(this,t)||this;return o.inputs={ifClause:i},o.thenBlock=r,o.elseBlock=n,o}return __extends(t,e),t.prototype.performTest=function(){var e,t;return e=isTrue(this.inputValues.ifClause)?this.thenBlock:this.elseBlock,t=new SerialTestBlockMgr(e),this.testRunner.pushBlockMgr(t),!0},t.prototype.toLogString=function(){var e=String(this.inputValues.ifClause);return"IfThenElseTest: if ("+e+") ..."},t}(TestNode),SwitchTest=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.inputs={switchArg:i},n.cases=r,n}return __extends(t,e),t.prototype.performTest=function(){var e,t=this.inputValues.switchArg;if(e=t in this.cases?this.cases[t]:this.cases.default,void 0!==e){var i=new SerialTestBlockMgr(e);this.testRunner.pushBlockMgr(i)}return!0},t.prototype.toLogString=function(){var e=String(this.inputValues.switchArg);return"switch ("+e+") ..."},t}(TestNode),RepeatTest=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.inputs={repeatClause:i},n.doBlock=r,n}return __extends(t,e),t.prototype.performTest=function(){var e=this.inputValues.repeatClause,t=[];assert(!isNaN(e),"repeat count is a number");for(var i=0;i<e;i++)t=cconcat(t,this.doBlock);return this.testRunner.pushBlockMgr(new SerialTestBlockMgr(t)),!0},t.prototype.toLogString=function(){var e=String(this.inputValues.repeatClause);return"RepeatTest: repeat="+e+" do {...}"},t}(TestNode),MondriaPointer=function(){function e(t,i){this.leftAnchor=t,this.topAnchor=i,this.pointerID=e.nextPointerId++,this.position={top:0,left:0},this.display={image:"default"},this.button={left:!1,middle:!1,right:!1},this.modifier={shift:!1,control:!1,meta:!1,alt:!1},this.image="default",this.dragging=[],this.id=this.pointerID,this.leftConstraintId="PointerLeft"+this.pointerID,this.topConstraintId="PointerTop"+this.pointerID,addPointer(this),this.myLeft=labelBySuffix(getPointerRef(this.pointerID).getElement(),leftSuffix(void 0,!1,!1)),this.myTop=labelBySuffix(getPointerRef(this.pointerID).getElement(),topSuffix(void 0,!1,!1))}return e.prototype.destroy=function(){removePointer(this)},e.prototype.setPos=function(e,t){var i=!1;return this.position.top!==t&&(this.position.top=t,globalPos.addSegment(this.topAnchor,this.myTop,this.topConstraintId,strongAutoPosPriority,t,t),i=!0),this.position.left!==e&&(this.position.left=e,globalPos.addSegment(this.leftAnchor,this.myLeft,this.leftConstraintId,strongAutoPosPriority,e,e),i=!0),i&&this.flushUpdate(),i},e.prototype.setImage=function(e){return"string"!=typeof e?void Utilities.warn("pointer image should be a string"):void(this.display.image!==e&&(this.display.image=e,this.flushUpdate()))},e.prototype.setDragState=function(e){valueEqual(this.dragging,e)||(this.dragging=e,this.flushUpdate())},e.prototype.setModifierState=function(e,t,i,r){this.modifier.shift===e&&this.modifier.control===r&&this.modifier.alt===i&&this.modifier.meta===t||(this.modifier.shift=e,this.modifier.meta=t,this.modifier.alt=i,this.modifier.control=r,this.flushUpdate())},e.prototype.getFegValue=function(){var e=[{position:[{top:[this.position.top],left:[this.position.left]}],display:[{image:[this.display.image]}],button:[{left:this.button.left?constTrueOS:constEmptyOS,middle:this.button.middle?constTrueOS:constEmptyOS,right:this.button.right?constTrueOS:constEmptyOS}],modifier:[{shift:this.modifier.shift?constTrueOS:constEmptyOS,control:this.modifier.control?constTrueOS:constEmptyOS,meta:this.modifier.meta?constTrueOS:constEmptyOS,alt:this.modifier.alt?constTrueOS:constEmptyOS}],id:[this.id],dragging:this.dragging}];return e},e.prototype.flushUpdate=function(){var e=globalEvaluationNodes[pointerNodeIndex];e.set(new Result(this.getFegValue()))},e.prototype.setButtonState=function(e,t){var i="down"===t;switch(e){case 0:this.button.left!==i&&(this.button.left=i,this.flushUpdate());break;case 1:this.button.middle!==i&&(this.button.middle=i,this.flushUpdate());break;case 2:this.button.right!==i&&(this.button.right=i,this.flushUpdate())}},e}();MondriaPointer.nextPointerId=1;var gPointerById={},gPointer,__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),QueuedEventState;!function(e){e[e.waiting=0]="waiting",e[e.start=1]="start",e[e.recipients=2]="recipients",e[e.end=3]="end",e[e.done=4]="done"}(QueuedEventState||(QueuedEventState={}));var QueuedEvent=function(){function e(e,t,i,r,n,o,s,a,d,u,h,l,c,p){this.time=e,this.event=t,this.type=i,this.isProtected=r,this.message=n,this.subTypes=o,this.recipients=s,this.buttonStateChanges=a,this.pointer=d,this.dragging=u,this.overlappingAreas=h,this.changes=l,this.checkExistence=c,this.touch=p,this.state=QueuedEventState.waiting,this.handledBy=constEmptyOS,this.abortPropagation=void 0,this.focussedInputElement=void 0,this.hadRecipients=void 0!==s&&s.length>0}return e.prototype.canChangeFocus=function(){var e=this.event;if(e instanceof ImpersonatedDomEvent)switch(e.type){case"MouseDown":case"KeyDown":case"KeyPress":case"KeyUp":return this.hadRecipients}else switch(e.type){case"mousedown":case"keydown":case"keypress":case"keyup":return this.hadRecipients}return!1},e.prototype.dispatchEvent=function(e){if(("mousedown"===this.event.type||"MouseDown"===this.event.type||"mouseup"===this.event.type||"MouseUp"===this.event.type)&&void 0!==e.display.displayElement){var t=MondriaDomEvent.findClickable(e.display.displayElement.content,this.event.clientX,this.event.clientY);if(void 0!==t){debugLogEvent(this.event.type)&&console.log("dispatching",this.event.type,"to",t.offsetParent.id);var i=new MouseEvent(this.event.type,this.event);gDontProcessEvent=i,t.dispatchEvent(i),void 0!==this.subTypes&&this.subTypes.some(function(t){return"Click"===t.value&&t.areas.indexOf(e)>=0})&&(i=new MouseEvent("click",this.event),t.dispatchEvent(i)),gDontProcessEvent=void 0}}},e}(),ImpersonatedDomEvent=function(){function e(e){this.type=e,this.timeStamp=Date.now()}return e.prototype.stopPropagation=function(){},e.prototype.stopImmediatePropagation=function(){},e.prototype.preventDefault=function(){},e}(),ImpersonatedDomEventWithModifier=function(e){function t(t,i){var r=e.call(this,t)||this;if(void 0!==i)for(var n=0;n<i.length;n++){var o=i[n];"alt"===o?r.altKey=!0:"control"===o?r.ctrlKey=!0:"meta"===o?r.metaKey=!0:"shift"===o&&(r.shiftKey=!0)}return r}return __extends(t,e),t}(ImpersonatedDomEvent),ImpersonatedMouseDomEvent=function(e){function t(t,i,r,n,o,s){var a=e.call(this,t,s)||this;return a.subType=i,a.clientX=r,a.clientY=n,a.button=o,a}return __extends(t,e),t}(ImpersonatedDomEventWithModifier),ImpersonatedTouchDomEvent=function(e){function t(t,i){var r=e.call(this,t,[])||this;return r.subType=i,r}return __extends(t,e),t}(ImpersonatedDomEventWithModifier),ImpersonatedMouseGestureExpiredEvent=function(e){function t(t,i,r){return e.call(this,"MouseGestureExpired",t,i,r,void 0,[])||this}return __extends(t,e),t}(ImpersonatedMouseDomEvent),ImpersonatedDropEvent=function(e){function t(t,i,r,n,o){var s=e.call(this,"FileChoice",void 0,i,r,void 0,[])||this;return s.area=t,s.subType=n,s.dataTransfer={files:o},s}return __extends(t,e),t}(ImpersonatedMouseDomEvent),ImpersonatedKeyDomEvent=function(e){function t(t,i,r,n){var o=e.call(this,t,n)||this;return o.key=i,o.char=r,o}return __extends(t,e),t}(ImpersonatedDomEventWithModifier),emptyMessage=[],emptyMessageResult=new Result(emptyMessage),EventQueue=function(){function e(){this.eventQueue=[],this.pointerInAreas={},this.dragInAreas={},this.domEventAreasUnderPointerResult=new Result,this.prevRecipient=void 0,this.lastMousePosition=[0,0],this.dragging=!1,this.subTypeReceivers={}}return e.prototype.setMessage=function(e,t){function i(e,t){e.hasBeenDestroyed()||void 0===e.evaluationNodes[0][areaMessageIndex]||e.evaluationNodes[0][areaMessageIndex].set(t)}var r=new Result(e);if(t instanceof DisplayArea&&1===e.length){var n=singleton(e[0].absX),o=singleton(e[0].absY);if("number"==typeof n){var s=t.getAbsolutePosition();e[0].relX=[n-s.left],e[0].relY=[o-s.top]}}debugLogEvent("message")&&console.log("set message",cdlify(e),t instanceof CoreArea?t.areaId:t),globalEvaluationNodes[globalMessageNodeIndex].set(r),void 0!==this.prevRecipient&&i(this.prevRecipient,emptyMessageResult),t instanceof CoreArea?(i(t,r),this.prevRecipient=t):this.prevRecipient=void 0,globalContentTask.schedule()},e.prototype.sendMessage=function(e,t){var i=void 0;t instanceof ElementReference?i=allAreaMonitor.getAreaById(t.element):"string"==typeof t&&(i=t),void 0!==i&&this.setMessage(e,i)},e.prototype.clearMessage=function(){this.setMessage(constEmptyOS,void 0)},e.prototype.nextQueuedEvent=function(){if(0===this.eventQueue.length)return!0;void 0!==globalDebugTracingLog&&globalDebugTracingLog.newCycle(0);var e=this.eventQueue[0];if(void 0!==e&&e.state===QueuedEventState.done)this.terminateEvent();else if(void 0!==e)if(e.state===QueuedEventState.waiting&&this.startNextEvent(),void 0!==e.message){var t,i=shallowCopy(e.message);switch(e.state){case QueuedEventState.start:t="start",e.state=e.hadRecipients?QueuedEventState.recipients:QueuedEventState.end;break;case QueuedEventState.recipients:t=e.recipients.shift(),e.state=e.recipients.length>0?QueuedEventState.recipients:QueuedEventState.end;break;case QueuedEventState.end:t="end",e.state=QueuedEventState.done;break;default:Utilities.error("error in QueuedEventState")}if(debugLogEvent("message")&&console.log("next recipient",t instanceof CoreArea?t.areaId:t),"string"==typeof t)i.recipient=[t],i.subType=void 0===e.subTypes?constEmptyOS:e.subTypes.map(function(e){return e.value});else{var r=t;if(void 0===r||r.hasBeenDestroyed())return 0===this.eventQueue.length;if(i.recipient=[r.areaReference],r.canReceiveFocus()||r.willHandleClick())e.focussedInputElement=r,debugLogEvent("message")&&console.log("focussed element",r.areaId);else{i.subType=void 0===e.subTypes?constEmptyOS:e.subTypes.filter(function(e){return e.areas.indexOf(r)>=0}).map(function(e){return e.value});for(var n=0;n<i.subType.length;n++){var o=i.subType[n];"mouseup"===e.type&&"Click"===o&&(o in this.subTypeReceivers||(this.subTypeReceivers[o]={}),this.subTypeReceivers[o][r.areaId]=!0)}}"inputchange"===e.event.type&&void 0!==e.changes&&r.updateParamInput(e.changes,!1,e.checkExistence)}i.handledBy=e.handledBy,this.setMessage([i],t),e.handledBy=e.handledBy.concat(i.recipient)}else e.state=QueuedEventState.done;else this.setMessage(emptyMessage,void 0);return 0===this.eventQueue.length},e.prototype.startNextEvent=function(){var e=this.eventQueue[0];if(void 0!==e.buttonStateChanges)for(var t=0;t<e.buttonStateChanges.length;t++){var i=e.buttonStateChanges[t];i.pointer.setButtonState(i.buttonID,i.state)}if(void 0!==e.pointer){var r=e.event;this.updateDragging(e),void 0!==r&&void 0!==r.clientX&&e.pointer.setPos(r.clientX,r.clientY)&&globalGeometryTask.executeTask(void 0),e.pointer.setModifierState(!!r.shiftKey,!!r.metaKey,!!r.altKey,!!r.ctrlKey||!!r.metaKey),void 0!==e.overlappingAreas&&this.updatePointerInArea(e.overlappingAreas,this.dragging),this.lastMousePosition=[r.clientX,r.clientY]}if(void 0!==e.touch){var n=e.touch;void 0!==n&&void 0!==n.clientX&&gPointer.setPos(n.clientX,n.clientY)&&globalGeometryTask.executeTask(void 0),void 0!==e.overlappingAreas&&this.updatePointerInArea(e.overlappingAreas,this.dragging),this.lastMousePosition=[n.clientX,n.clientY]}this.restrictSubTypePropagation(e),e.state=QueuedEventState.start,"undefined"!=typeof Event&&e.event instanceof Event&&clearProgressDiv(),debugLogEvent("message")&&console.log("next event",e.type,cdlify(e.message),e.recipients.map(function(e){return e instanceof CoreArea?e.areaId:e}).join(","))},e.prototype.updateDragging=function(e){if(void 0!==e.dragging){var t=isTrue(e.dragging);e.pointer.setDragState(e.dragging),this.dragging!=t&&(this.dragging=t,globalReupdatePointerInAreaTask.schedule())}},e.prototype.terminateEvent=function(){var e=this.eventQueue.shift(),t=void 0!==e.focussedInputElement?e.focussedInputElement:void 0;assert(e.state===QueuedEventState.done,"debugging"),debugLogEvent("message")&&console.log("end of event"),this.setMessage(emptyMessage,void 0),e.canChangeFocus()&&gDomEvent.setNextFocussedArea(t),void 0!==t&&e.dispatchEvent(t)},e.prototype.restrictSubTypePropagation=function(e){var t=this;if(void 0!==e.subTypes){for(var i=0;i<e.subTypes.length;i++){var r=e.subTypes[i];delete this.subTypeReceivers[r.value]}if("MouseGestureExpired"===e.type){for(var n=[],o={},i=0;i<e.subTypes.length;i++){var r=e.subTypes[i],s="DoubleClick"===r.value&&void 0!==this.subTypeReceivers.Click?r.areas.filter(function(e){return e.areaId in t.subTypeReceivers.Click}):r.areas;if(s.length>0){n.push({value:r.value,areas:s});for(var a=0;a<s.length;a++)o[s[a].areaId]=!0}}e.subTypes=n,e.recipients=e.recipients.filter(function(e){return"string"==typeof e||e.areaId in o}),e.hadRecipients=e.recipients.length>0}}},e.prototype.addPointerInArea=function(e,t){e?(void 0===this.foreignManagedAreasUnderPointer&&(this.foreignManagedAreasUnderPointer={}),this.foreignManagedAreasUnderPointer[t]=!0):void 0!==this.foreignManagedAreasUnderPointer&&delete this.foreignManagedAreasUnderPointer[t]},e.prototype.updatePointerInArea=function(t,i){function r(t,i,r){if(!(t.areaId in n)){var a=t instanceof DisplayArea?t.display:void 0;s.push(t),void 0!==a&&o.push(t.areaReference),n[t.areaId]=t;var d={};d.areaId=t.areaId,d.reason=i,d.propagateTo=void 0===t.propagatePointerInArea||Utilities.isEmptyObj(t.propagatePointerInArea)?"implicit embedding":Object.keys(t.propagatePointerInArea).filter(function(e){return t.propagatePointerInArea[e]}).join(", "),void 0!==r&&(d.from=r),void 0!==a&&(d.display=a.descriptionDisplay),e.debugPPIAInfo.push(d)}}var n={},o=[],s=[];e.debugPPIAInfo=[];for(var a in this.foreignManagedAreasUnderPointer){var d=allAreaMonitor.getAreaById(a);void 0!==d&&(t=[{recipient:d,relX:void 0,relY:void 0}].concat(t.filter(function(e){return e.recipient!==d})))}areaOverlapMonitor.updatePointerOverlap(t);for(var u,h=0;h<t.length;h++){if(u=t[h].recipient,r(u,"z-order",void 0),u.isOpaque()){e.debugPPIAInfo[e.debugPPIAInfo.length-1].reason+=" opaque";break}e.debugPPIAInfo[e.debugPPIAInfo.length-1].reason+=" transparent"}for(;s.length>0;){u=s.pop();var l=u.getAreaId(),c=u.propagatePointerInArea;if(u instanceof DisplayArea&&void 0!==c)for(var p in c)switch(p){case"embedding":u.embedding&&r(u.embedding,"explicit from embedded",l);break;case"expression":u.intersectionChain&&r(u.intersectionChain.expressionArea,"explicit from intersection (expression)",l);break;case"referred":u.intersectionChain&&r(u.intersectionChain.referredArea,"explicit from intersection (referred)",l);break;default:var f=allAreaMonitor.getAreaById(p);void 0!==f&&r(f,"explicit area",l)}else u.embedding&&r(u.embedding,"implicit from embedded",l)}var v=i?this.dragInAreas:this.pointerInAreas;for(var a in v)v[a].hasBeenDestroyed()?delete v[a]:a in n||this.setPtrInArea(v[a],!1,i);for(a in n)a in v||!n[a].hasBeenDestroyed()&&this.setPtrInArea(n[a],!0,i);i?this.dragInAreas=n:this.pointerInAreas=n;var g=i?this.pointerInAreas:this.dragInAreas;for(a in g)!g[a].hasBeenDestroyed()&&this.setPtrInArea(g[a],!1,!i),delete g[a];this.setAreasUnderPointer(o)},e.prototype.reupdatePointerInArea=function(){var e=gDomEvent.getOverlappingAreas(this.lastMousePosition[0],this.lastMousePosition[1]);this.updatePointerInArea(e,this.dragging)},e.prototype.setPtrInArea=function(e,t,i){var r=t?constTrueOS:constFalseOS;e.updateParam(i?"dragInArea":"pointerInArea",r)},e.prototype.clearPtrInArea=function(e){e.updateParam("dragInArea",!1),e.updateParam("pointerInArea",!1),delete this.dragInAreas[e.areaId],delete this.pointerInAreas[e.areaId],globalReupdatePointerInAreaTask.schedule()},e.prototype.setAreasUnderPointer=function(e){if("undefined"!=typeof globalAreasUnderPointerNodeIndex){var t=globalEvaluationNodes[globalAreasUnderPointerNodeIndex];this.domEventAreasUnderPointerResult.value=e,t.set(this.domEventAreasUnderPointerResult)}},e.prototype.addEvent=function(e){function t(e){return"mousemove"===e||"pointermove"===e}this.eventQueue.length>0&&t(e.type)&&t(this.eventQueue[this.eventQueue.length-1].event.type)&&this.eventQueue.pop(),this.eventQueue.push(e),globalNextQueuedEvent.schedule()},e.prototype.cancelEventsOfType=function(e){this.eventQueue=this.eventQueue.filter(function(t){return t.type!==e})},e.prototype.clear=function(){this.eventQueue=[]},e.prototype.abortEvent=function(e,t){function i(e){return"keydown"===e.type||"keypress"===e.type||"keyup"===e.type}var r=this.eventQueue[0];return void 0!==r&&((!t||!i(r.event))&&(void 0===r.abortPropagation&&(r.abortPropagation=e,r.recipients=["end"],!0)))},e}();EventQueue.debugPPIAInfo=[];var globalEventQueue=new EventQueue,lastEventType="",debugTest=!1,TestDOMEventQueue=function(){function e(){this.domEventQueue=[]}return e.prototype.isEmpty=function(){return 0===this.domEventQueue.length},e.prototype.enqueue=function(e){this.domEventQueue.push(e)},e.prototype.injectNextEvent=function(){var t=this.domEventQueue.shift();debugTest&&console.log("injecting dom event: "+JSON.stringify(t)),e.injectNextDomEventByType(t)},e.injectNextDomEventByType=function(e){switch(e.type){case"MouseUp":case"MouseDown":gDomEvent.mouseEventHandler(e,e.type,[]);break;case"MouseGestureExpired":gDomEvent.mouseEventHandler(e,e.type,[]);break;case"MouseMove":gDomEvent.mouseMoveHandler(e);break;case"KeyDown":gDomEvent.keyDownUpHandler(e,void 0,!0);break;case"KeyUp":gDomEvent.keyDownUpHandler(e,void 0,!1);break;case"KeyPress":gDomEvent.keyPressHandlerInt(e,void 0);break;case"FileChoice":var t=e;if("pick"===t.subType)if(t.area instanceof ElementReference){var i=allAreaMonitor.getAreaById(t.area.getElement());i instanceof DisplayArea?gDomEvent.pickFile(t,i,t.dataTransfer.files):console.log("dropEvent:pick: no such area:",t.area.getElement())}else console.log("dropEvent:pick: not a (single) area:",t.area);else gDomEvent.dropHandler(t);break;default:Utilities.error("unknown event type: "+e.type)}},e}(),SerialTestBlockMgr=function(){function e(e){"undefined"==typeof e&&(e=[]),this.testList=e,this.nextIndex=0}return e.prototype.getNextTest=function(){var e;return this.nextIndex<this.testList.length?(e=this.testList[this.nextIndex],this.nextIndex++):e=void 0,e},e.prototype.destroy=function(){this.testList=void 0,this.nextIndex=void 0},e.prototype.getTestIndex=function(){return String(this.nextIndex)},e}(),TestRunner=function(){function e(e){this.failed=!1,this.blockMgrStack=[],this.domEventQueue=new TestDOMEventQueue;var t=new SerialTestBlockMgr(e);this.pushBlockMgr(t)}return e.prototype.execute=function(){if(this.failed)return!0;if(!this.domEventQueue.isEmpty())return this.domEventQueue.injectNextEvent(),testSingleStep;for(var e;this.blockMgrStack.length>0&&(debugTest&&console.log("test step",this.getTestStepIndex()),e=this.getNextTest(),void 0===e););return void 0===e?(console.log("test succeeded"),endTest(0),!0):(printTiming(),e.activate(this),evaluationQueue.schedule(e,!0),!0)},e.prototype.pushBlockMgr=function(e){this.blockMgrStack.push(e)},e.prototype.popBlockMgr=function(){var e;e=this.blockMgrStack.pop(),e.destroy()},e.prototype.getTestStepIndex=function(){return this.blockMgrStack.map(function(e){return e.getTestIndex()}).join(".")},e.prototype.getNextTest=function(){var e=this.blockMgrStack.length,t=this.blockMgrStack[e-1],i=t.getNextTest();return"undefined"==typeof i&&this.popBlockMgr(),i},e.prototype.enqueueDOMEvent=function(e){this.domEventQueue.enqueue(e)},e}(),gTestRunner,testSingleStep=!1,__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ValueReference=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(NonAV),ElementReference=function(e){function t(t){var i=e.call(this)||this;return i.element=t,i}return __extends(t,e),t.prototype.getElement=function(){return this.element},t.prototype.match=function(e){return this.isEqual(e)},t.prototype.isEqual=function(e){if(e instanceof t){var i=e;return this.element===i.element}return!1},t.prototype.copy=function(){return new t(this.element)},t.prototype.stringify=function(){
return"@"+this.element},t.prototype.toJSON=function(){return'new ElementReference("'+this.element+'")'},t.prototype.toCdl=function(){return"@"+this.element},t.prototype.typeName=function(){return"elementReference"},t.prototype.marshalValue=function(e){var t=gPaidMgr.getAreaEntry(this.element),i=e.xdrTemplateId(t.templateId),r=e.xdrIndexId(t.indexId);return{type:"elementReference",templateId:i,indexId:r}},t.unmarshalValue=function(e,i){var r=i.xdrTemplateId(e.templateId),n=i.xdrIndexId(e.indexId),o=gPaidMgr.getAreaId(r,n);return new t(o)},t.prototype.compare=function(e){return this.element===e.element?0:this.element<e.element?-1:1},t}(ValueReference),DefunReference=function(e){function t(t){var i=e.call(this)||this;return i.defun=t,i}return __extends(t,e),t.prototype.typeName=function(){return"defunReference"},t.prototype.isEqual=function(e){return e instanceof t&&this.defun.isEqual(e.defun)},t.prototype.copy=function(){return new t(this.defun)},t.prototype.stringify=function(){return this.defun.prototype.toFullString()},t.prototype.toCdl=function(){return this},t.prototype.toJSON=function(){return"defun("+this.defun.prototype.idStr()+")"},t.prototype.match=function(e){return this===e},t.prototype.marshalValue=function(e){Utilities.error("marshalling a defun is not supported")},t.unmarshalValue=function(e,t){Utilities.error("unmarshalling a defun is not supported")},t.prototype.compare=function(e){return 0},t}(ValueReference),ValueType=function(){function e(){this.unknown=!0}return e.prototype.isPotentiallyMergeable=function(){return"unknown"in this||"object"in this||"anyData"in this||"query"in this||"undef"in this},e.prototype.isData=function(){return"unknown"in this||"object"in this||"anyData"in this||"query"in this||"undef"in this||"string"in this||"number"in this||"range"in this||"boolean"in this||"projector"in this||"defun"in this||"terminalSymbol"in this||"comparisonFunction"in this||"foreignInterface"in this},e.prototype.isStrictlyData=function(){return("object"in this||"anyData"in this||"query"in this||"string"in this||"number"in this||"range"in this||"boolean"in this||"projector"in this||"defun"in this||"comparisonFunction"in this||"terminalSymbol"in this||"foreignInterface"in this)&&!("areas"in this)},e.prototype.isNotData=function(){return"areas"in this},e.prototype.isNotString=function(){return!("anyData"in this||"unknown"in this||"string"in this)},e.prototype.isAreas=function(){return("unknown"in this||"undef"in this)&&!("remote"in this)||"areas"in this},e.prototype.isStrictlyAreas=function(){return"areas"in this},e.prototype.isDataAndAreas=function(){return("object"in this||"anyData"in this||"query"in this||"string"in this||"number"in this||"range"in this||"boolean"in this||"projector"in this||"defun"in this||"comparisonFunction"in this||"terminalSymbol"in this||"foreignInterface"in this)&&"areas"in this},e.prototype.isStrictlyDefun=function(){return!("object"in this||"anyData"in this||"query"in this||"string"in this||"number"in this||"range"in this||"boolean"in this||"projector"in this||"areas"in this||"remote"in this||"comparisonFunction"in this||"terminalSymbol"in this||"foreignInterface"in this)&&"defun"in this},e.prototype.isDefined=function(){return"object"in this||"anyData"in this||"query"in this||"string"in this||"number"in this||"range"in this||"boolean"in this||"projector"in this||"defun"in this||"areas"in this||"comparisonFunction"in this||"terminalSymbol"in this||"foreignInterface"in this},e.prototype.isUndefined=function(){return"undef"in this&&!this.isDefined()},e.prototype.addDataSource=function(){return this.dataSource=!0,this},e.prototype.addAnyData=function(){return"unknown"in this&&delete this.unknown,"undef"in this&&delete this.undef,"string"in this&&delete this.string,"number"in this&&delete this.number,"boolean"in this&&delete this.boolean,"defun"in this&&delete this.defun,"query"in this&&delete this.query,"range"in this&&delete this.range,"projector"in this&&delete this.projector,"object"in this&&delete this.object,"comparisonFunction"in this&&delete this.comparisonFunction,"terminalSymbol"in this&&delete this.terminalSymbol,"foreignInterface"in this&&delete this.foreignInterface,this.anyData=!0,this},e.prototype.addUndefined=function(){return"unknown"in this&&delete this.unknown,this.anyData||(this.undef=!0),this},e.prototype.addRemote=function(){return this.remote=!0,this},e.prototype.addString=function(){return"unknown"in this&&delete this.unknown,this.anyData||(this.string=!0),this},e.prototype.addNumber=function(){return"unknown"in this&&delete this.unknown,this.anyData||(this.number=!0),this},e.prototype.addBoolean=function(){return"unknown"in this&&delete this.unknown,this.anyData||(this.boolean=!0),this},e.prototype.addDefun=function(e){return"unknown"in this&&delete this.unknown,this.anyData||(this.defun=e),this},e.prototype.subDefun=function(){if("defun"in this){var e=this.copy();return delete e.defun,e}return this},e.prototype.addQuery=function(){return"unknown"in this&&delete this.unknown,this.anyData||(this.query=!0),this},e.prototype.addRange=function(){return"unknown"in this&&delete this.unknown,this.anyData||(this.range=!0),this},e.prototype.addProjector=function(){return"unknown"in this&&delete this.unknown,this.anyData||(this.projector=!0),this},e.prototype.addTerminalSymbol=function(){return"unknown"in this&&delete this.unknown,this.anyData||(this.terminalSymbol=!0),this},e.prototype.addForeignInterface=function(){return"unknown"in this&&delete this.unknown,this.anyData||(this.foreignInterface=!0),this},e.prototype.addObject=function(e){if("unknown"in this&&delete this.unknown,!this.anyData)if("object"in this)for(var t in e)t in this.object?this.object[t]=this.object[t].merge(e[t]):this.object[t]=e[t];else this.object=e;return this},e.prototype.addAttribute=function(e,t){return"unknown"in this&&delete this.unknown,this.anyData||("object"in this||(this.object={}),e in this.object?this.object[e]=this.object[e].merge(t):this.object[e]=t),this},e.prototype.removeAttribute=function(e){if("object"in this&&e in this.object){var t=this.copy();return delete t.object[e],t}return this},e.prototype.getAttributeType=function(t){if("anyData"in this)return this;if("object"in this){if(t in this.object)return e.anyAttribute in this.object?this.object[t].merge(this.object[e.anyAttribute]):this.object[t];if(e.anyAttribute in this.object)return this.object[e.anyAttribute]}return emptyValueType},e.prototype.addAreas=function(e,t,i){assert(void 0!==e,"must at least be {}"),"unknown"in this&&delete this.unknown,"areas"in this||(this.areas=new Map);for(var r=0,n=e;r<n.length;r++){var o=n[r],s=o[0],a=o[1];this.areas.has(s)?this.areas.set(s,this.areas.get(s).merge(a)):this.areas.set(s,a),t&&(void 0===i?this.sizes=ValueTypeSize.sumSizes(this.sizes,a.sizes):this.sizes=ValueTypeSize.sumSizes(this.sizes,ValueTypeSize.multiplySizes(a.sizes,i.get(s).sizes)))}return this},e.prototype.addArea=function(t,i){return"unknown"in this&&delete this.unknown,void 0===this.areas&&(this.areas=new Map),this.areas.set(t,(new e).addSizeRanges(i)),this.sizes=ValueTypeSize.sumSizes(this.sizes,i),this},e.prototype.addComparisonFunction=function(e){if("unknown"in this&&delete this.unknown,!this.anyData)if("object"in this)for(var t=0;t<e.length;t++)this.comparisonFunction.length<t?this.comparisonFunction[t]=this.comparisonFunction[t].merge(e[t]):this.comparisonFunction[t]=e[t];else this.comparisonFunction=e;return this},e.prototype.copy=function(){var t=new e;if("remote"in this&&t.addRemote(),"dataSource"in this&&t.addDataSource(),"anyData"in this&&t.addAnyData(),"undef"in this&&t.addUndefined(),"string"in this&&t.addString(),"number"in this&&t.addNumber(),"boolean"in this&&t.addBoolean(),"defun"in this&&t.addDefun(this.defun),"query"in this&&t.addQuery(),"range"in this&&t.addRange(),"projector"in this&&t.addProjector(),"terminalSymbol"in this&&t.addTerminalSymbol(),"foreignInterface"in this&&t.addForeignInterface(),"object"in this&&t.addObject(this.object),"areas"in this){"unknown"in t&&delete t.unknown,t.areas=new Map;for(var i=0,r=this.areas;i<r.length;i++){var n=r[i],o=n[0],s=n[1];t.areas.set(o,s)}}return"comparisonFunction"in this&&(t.comparisonFunction=this.comparisonFunction.slice(0)),t.sizes=void 0===this.sizes?void 0:this.sizes.slice(0),t},e.prototype.deepCopy=function(){var t=new e;if("remote"in this&&t.addRemote(),"anyData"in this&&t.addAnyData(),"undef"in this&&t.addUndefined(),"string"in this&&t.addString(),"number"in this&&t.addNumber(),"boolean"in this&&t.addBoolean(),"defun"in this&&t.addDefun(this.defun),"query"in this&&t.addQuery(),"range"in this&&t.addRange(),"projector"in this&&t.addProjector(),"terminalSymbol"in this&&t.addTerminalSymbol(),"foreignInterface"in this&&t.addForeignInterface(),"object"in this){"unknown"in t&&delete t.unknown,t.object={};for(var i in this.object)t.object[i]=this.object[i].deepCopy()}if("areas"in this){"unknown"in t&&delete t.unknown,t.areas=new Map;for(var r=0,n=this.areas;r<n.length;r++){var o=n[r],s=o[0],a=o[1];t.areas.set(s,a.deepCopy())}}return"comparisonFunction"in this&&(t.comparisonFunction=this.comparisonFunction.map(function(e){return e.deepCopy()})),t.sizes=void 0===this.sizes?void 0:this.sizes.slice(0),t},e.prototype.mergeMinusUndefined=function(e,t){var i=this.copy();if("anyData"in e&&i.addAnyData(),"remote"in e&&i.addRemote(),"dataSource"in e&&i.addDataSource(),"string"in e&&i.addString(),"number"in e&&i.addNumber(),"boolean"in e&&i.addBoolean(),"defun"in e&&("defun"in this?i.addDefun(this.defun.merge(e.defun)):i.addDefun(e.defun)),"query"in e&&i.addQuery(),"range"in e&&i.addRange(),"projector"in e&&i.addProjector(),"terminalSymbol"in e&&i.addTerminalSymbol(),"foreignInterface"in e&&i.addForeignInterface(),"object"in e&&("unknown"in i&&delete i.unknown,!i.anyData))if(void 0===this.object)i.object=e.object;else{i.object=shallowCopy(this.object);for(var r in e.object)r in this.object?i.object[r]=this.object[r].merge(e.object[r]):i.object[r]=e.object[r]}return"areas"in e&&i.addAreas(e.areas,!1,void 0),"comparisonFunction"in e&&i.addComparisonFunction(e.comparisonFunction),t&&(i.sizes=ValueTypeSize.mergeSizes(this.sizes,e.sizes)),i},e.prototype.isEqual=function(e){if(this.unknown!=e.unknown)return!1;if(this.remote!=e.remote)return!1;if(this.dataSource!=e.dataSource)return!1;if(this.anyData!=e.anyData)return!1;if(this.undef!=e.undef)return!1;if(this.string!=e.string)return!1;if(this.number!=e.number)return!1;if(this.boolean!=e.boolean)return!1;if("defun"in this||"defun"in e){if(!("defun"in this&&"defun"in e))return!1;if(!this.defun.isEqual(e.defun))return!1}if(this.query!=e.query)return!1;if(this.range!=e.range)return!1;if(this.projector!=e.projector)return!1;if(this.terminalSymbol!=e.terminalSymbol)return!1;if(this.foreignInterface!=e.foreignInterface)return!1;if("object"in this||"object"in e){if(!("object"in this&&"object"in e))return!1;for(var t in this.object)if(!(t in e.object&&this.object[t].isEqual(e.object[t])))return!1;for(var t in e.object)if(!(t in this.object))return!1}return!(("areas"in this||"areas"in e)&&!("areas"in this&&"areas"in e&&identicalSets(this.areas,e.areas)))&&!(("comparisonFunction"in this||"comparisonFunction"in e)&&!("comparisonFunction"in this&&"comparisonFunction"in e&&arrayEqual(this.comparisonFunction,e.comparisonFunction)))},e.prototype.merge=function(e,t){void 0===t&&(t=!0);var i=this.mergeMinusUndefined(e,t);return"undef"in e&&i.addUndefined(),i},e.prototype.removeDataSource=function(){return"dataSource"in this&&delete this.dataSource,this},e.prototype.isEqualOrUnknown=function(e){if(this.unknown||e.unknown)return!0;if(this.anyData!=e.anyData)return!1;if(this.undef!=e.undef)return!1;if(this.string!=e.string)return!1;if(this.number!=e.number)return!1;if(this.boolean!=e.boolean)return!1;if("defun"in this||"defun"in e){if(!("defun"in this&&"defun"in e))return!1;if(!this.defun.isEqual(e.defun))return!1}if(this.query!=e.query)return!1;if(this.range!=e.range)return!1;if(this.projector!=e.projector)return!1;if(this.terminalSymbol!=e.terminalSymbol)return!1;if(this.foreignInterface!=e.foreignInterface)return!1;if("object"in this||"object"in e){if(!("object"in this&&"object"in e))return!1;for(var t in this.object)if(!(t in e.object&&this.object[t].isEqualOrUnknown(e.object[t])))return!1;for(var t in e.object)if(!(t in this.object))return!1}return!(("areas"in this||"areas"in e)&&!("areas"in this&&"areas"in e&&identicalSets(this.areas,e.areas)))&&!(("comparisonFunction"in this||"comparisonFunction"in e)&&!("comparisonFunction"in this&&"comparisonFunction"in e&&arrayEqual(this.comparisonFunction,e.comparisonFunction)))},e.prototype.subsumes=function(e){if(!this.remote&&e.remote)return!1;if(!this.dataSource&&e.dataSource)return!1;if(this.anyData)return!0;if(e.anyData)return!1;if(!this.string&&e.string)return!1;if(!this.number&&e.number)return!1;if(!this.boolean&&e.boolean)return!1;if(!("defun"in this)&&"defun"in e)return!1;if("defun"in this&&"defun"in e&&!this.defun.subsumes(e.defun))return!1;if(!this.query&&e.query)return!1;if(!this.range&&e.range)return!1;if(!this.projector&&e.projector)return!1;if(!this.terminalSymbol&&e.terminalSymbol)return!1;if(!this.foreignInterface&&e.foreignInterface)return!1;if(!("object"in this)&&"object"in e)return!1;if("object"in this&&"object"in e){for(var t in this.object)if(t in e.object&&!this.object[t].subsumes(e.object[t]))return!1;for(var t in e.object)if(!(t in this.object))return!1}if(!("areas"in this)&&"areas"in e)return!1;if("areas"in this&&"areas"in e&&!subsetOf(e.areas,this.areas))return!1;if(!("comparisonFunction"in this)&&"comparisonFunction"in e)return!1;if("comparisonFunction"in this&&"comparisonFunction"in e){if(this.comparisonFunction.length>e.comparisonFunction.length)return!1;for(var i=0;i<this.comparisonFunction.length;i++)if(!this.comparisonFunction[i].subsumes(e.comparisonFunction[i]))return!1}return!0},e.prototype.checkForSpellingErrors=function(e){if("object"in this&&"object"in e){for(var t=Object.keys(this.object),i=Object.keys(e.object),r=0;r!==t.length;r++)for(var n=0;n<i.length;n++)if(t[r].length+i[n].length>14){var o=levenshtein(t[r],i[n],2);0!==o&&o<2&&Utilities.syntaxError("possible spelling error in attributes: "+t[r]+" vs "+i[n])}for(var s in this.object)s in e.object&&this.object[s].checkForSpellingErrors(e.object[s])}},e.prototype.canMatch=function(t,i){if(this.unknown||t.unknown||t.boolean||this.remote||t.remote)return!0;if(t.projector)return!0;if(this.undef||t.undef)return this.undef===t.undef;if(this.anyData&&t.isData()||this.isData()&&t.anyData)return!0;if(this.boolean&&t.boolean)return!0;if(this.string&&(t.string||t.range))return!0;if(this.number&&(t.number||t.range))return!0;if("defun"in this&&"defun"in t)return!0;if(this.query&&t.query)return!0;if(this.range&&(t.range||t.number||t.string))return!0;if(this.terminalSymbol&&t.terminalSymbol)return!0;if(this.foreignInterface&&t.foreignInterface)return!0;if(void 0!==this.object&&void 0!==t.object){for(var r in this.object)if(r!==e.anyAttribute&&r in t.object&&!this.object[r].canMatch(t.object[r],void 0)&&!(e.anyAttribute in t.object&&this.object[r].canMatch(t.object[e.anyAttribute],void 0)))return!1;if(i&&!(e.anyAttribute in this.object))for(var r in t.object)if(!(r in this.object))return!1}if(void 0!==this.areas&&void 0!==t.areas)for(var n=0,o=this.areas.keys();n<o.length;n++){var s=o[n];if(t.areas.has(s))return!0}if(void 0!==this.comparisonFunction&&void 0!==t.comparisonFunction&&this.comparisonFunction.length<=t.comparisonFunction.length)for(var a=0;a<this.comparisonFunction.length;a++)if(!this.comparisonFunction[a].canMatch(t.comparisonFunction[a],i))return!1;return!1},e.prototype.toString=function(){var e=[];if("remote"in this&&e.push("remote"),"dataSource"in this&&e.push("dataSource"),"anyData"in this&&e.push("anyData"),"unknown"in this&&e.push("unknown"),"undef"in this&&e.push("undef"),"string"in this&&e.push("string"),"number"in this&&e.push("number"),"boolean"in this&&e.push("boolean"),"defun"in this&&e.push("defun("+this.defun.toString()+")"),"query"in this&&e.push("query"),"range"in this&&e.push("range"),"projector"in this&&e.push("projector"),"terminalSymbol"in this&&e.push("terminalSymbol"),"foreignInterface"in this&&e.push("foreignInterface"),"object"in this){var t=[];for(var i in this.object)t.push(i+": "+this.object[i].toString());e.push("{"+t.join(", ")+"}")}if("areas"in this){for(var r="",n=0,o=this.areas.keys();n<o.length;n++){var s=o[n];r.length>0&&(r+=","),r+="@"+s}e.push("areas("+r+")")}"comparisonFunction"in this&&e.push("comparisonFunction("+this.comparisonFunction.map(function(e){return e.toString()})+")");var r=1===e.length?e[0]:"o("+e.join(", ")+")";return void 0!==this.sizes&&(r+="/#="+this.sizes.map(function(e){return e.stringify()}).join(",")),r},e.prototype.isStrictSelection=function(){if("remote"in this||"anyData"in this||"unknown"in this||"undef"in this||"defun"in this||"query"in this||"projector"in this||"areas"in this)return!1;if("object"in this)for(var e in this.object)if(!this.object[e].isStrictSelection())return!1;return!0},e.prototype.applyQueryInt=function(t){if((void 0===t||"undef"in t&&!("remote"in t))&&!("remote"in this))return{sel:!0,proj:void 0};if("anyData"in this||"unknown"in this||"remote"in this)return{sel:!0,proj:this};if("query"in this||"anyData"in t||"unknown"in t||"remote"in t)return{sel:!0,proj:t};var i="boolean"in this||"number"in this||"string"in this||"range"in this,r="projector"in this?t:void 0;if("object"in this&&"object"in t){var n,o=void 0,s=0,a=0,d=0;for(var u in this.object)if(u===e.anyAttribute){var h=void 0,l=0;for(var c in t.object){d++;var p=this.object[e.anyAttribute].applyQueryInt(t.object[c]);p.sel&&l++,void 0!==p.proj&&(h=void 0===h?p.proj:h.merge(p.proj))}0!==l&&(a++,i=!0),void 0!==h&&(s++,1===s?(o=h,n=u):(2===s&&(o=(new e).addAttribute(n,o)),o.addAttribute(u,h)))}else{d++;var p=this.object[u].applyQueryInt(t.object[u]);p.sel&&(a++,i=!0),void 0!==p.proj&&(s++,1===s?(o=p.proj,n=u):(2===s&&(o=(new e).addAttribute(n,o)),o.addAttribute(u,p.proj)))}r=void 0===r?o:r=r.merge(o),0!==a&&s===d&&(r=r.merge(t))}return{sel:i,proj:r}},e.prototype.applyQuery=function(t){var i=this.applyQueryInt(t),r=void 0!==i.proj?i.proj:i.sel?t:new e;return("remote"in t||"dataSource"in t)&&(r=r.copy(),"remote"in t&&r.addRemote(),"dataSource"in t&&r.addDataSource()),r},e.prototype.addSizeRange=function(e){return this.sizes=ValueTypeSize.insertNewSize(this.sizes,e),this},e.prototype.addSizeRanges=function(e){return void 0===this.sizes?this.sizes=e:ValueTypeSize.destructiveMerge(this.sizes,e),this},e.prototype.addSize=function(e,t){return"undefined"==typeof t?this.addSizeRange(new RangeValue([e],!0,!0)):this.addSizeRange(new RangeValue([e,t],!0,!0))},e.prototype.addSizes=function(e){return this.sizes=ValueTypeSize.mergeSizes(this.sizes,e),this},e.prototype.replaceSize=function(e,t){return"undefined"==typeof t?this.sizes=[new RangeValue([e],!0,!0)]:this.sizes=[new RangeValue([e,t],!0,!0)],this},e.prototype.checkConsistency=function(){("anyData"in this||"undef"in this||"string"in this||"number"in this||"boolean"in this||"defun"in this||"query"in this||"range"in this||"projector"in this||"object"in this||"areas"in this||"comparisonFunction"in this||"terminalSymbol"in this||"foreignInterface"in this)&&assert(!("unknown"in this),"ValueType consistency failure")},e.prototype.extractWritePath=function(){var e=void 0;if("projector"in this&&(e=[]),"object"in this)for(var t in this.object){var i=this.object[t].extractWritePath();if(void 0!==i){if(void 0!==e)return;e=[t].concat(i)}}return e},e.prototype.intersectAreas=function(e){if(void 0!==e.areas){var t=this.copy();t.areas=void 0;for(var i=0,r=this.areas;i<r.length;i++){var n=r[i],o=n[0],s=n[1];e.areas.has(o)&&t.addArea(o,ValueTypeSize.minOfSizes(e.areas.get(o).sizes,s.sizes))}return t.sizes=ValueTypeSize.max(t.sizes),t}return this},e.prototype.isExactSize=function(e){return void 0!==this.sizes&&this.sizes.length>0&&this.sizes.every(function(t){return t.intMin()===e&&t.intMax()===e})},e}();ValueType.anyAttribute="<?>";var ValueTypeSize;!function(e){function t(e){for(var t=1;t<e.length;t++)if(e[t].min>e[t].max||e[t-1].max>=e[t].min-1||e[t-1].min>=e[t].min-1)return!1;return!0}function i(e,i){if(void 0===i)return e;if(void 0===e)e=[i];else{for(var r=0;r<e.length;r++){if(e[r].match(i)||e[r].intConnectsWith(i)){for(e[r]=e[r].merge(i);r<e.length-1&&(e[r].match(e[r+1])||e[r].intConnectsWith(e[r+1]));)e[r]=e[r].merge(e[r+1]),e.splice(r+1,1);break}if(i.isLessThanOrEqualTo(e[r])){e.splice(r,0,i);break}}r===e.length&&e.push(i),assert(t(e),"wrong update")}return e}function r(e,t){for(var r=0;r<t.length;r++)i(e,t[r])}function n(e,t){if(void 0===e)return t;if(void 0===t)return e;var i=shallowCopy(e);return r(i,t),i}function o(e,t){if(void 0===e)return t;if(void 0===t)return e;for(var r=void 0,n=0;n<e.length;n++)for(var o=e[n].intMin(),s=e[n].intMax(),a=0;a<t.length;a++)r=i(r,new RangeValue([o+t[a].intMin(),s+t[a].intMax()],!0,!0));return r}function s(e,t){if(void 0===e)return t;if(void 0===t)return e;for(var r=void 0,n=0;n<e.length;n++)for(var o=e[n].intMin(),s=e[n].intMax(),a=0;a<t.length;a++)r=i(r,new RangeValue([o*t[a].intMin(),s*t[a].intMax()],!0,!0));return r}function a(e,t){if(void 0===e||0===e.length)return t;if(void 0===t||0===t.length)return e;var r=void 0,o=e[e.length-1].max,s=t[t.length-1].max;if(o===s)r=n(e,t);else{var a=o<s?e:t,d=o<s?t:e,u=o<s?o:s;r=shallowCopy(a);for(var h=0;h<d.length&&d[h].min<=u;h++){if(!(d[h].max<=u)){i(r,_r(d[h].min,u));break}i(r,d[h])}}return r}function d(e){return void 0===e||e===[]?void 0:[new RangeValue([0,e[e.length-1].max],!0,e[e.length-1].closedUpper)]}function u(e,t){return void 0!==e&&1===e.length&&e[0].min===t&&e[0].max===t&&!e[0].closedLower&&!e[0].closedUpper}function h(e,t){if(void 0!==e){for(var i=[],r=0;r<e.length&&e[r].min<=t;r++){if(!(e[r].max<=t)){i.push(_r(e[r].min,t));break}i.push(e[r])}return i}}e.insertNewSize=i,e.destructiveMerge=r,e.mergeSizes=n,e.sumSizes=o,e.multiplySizes=s,e.minOfSizes=a,e.max=d,e.equalsNumber=u,e.upperLimit=h}(ValueTypeSize||(ValueTypeSize={}));var emptyValueType=(new ValueType).addSize(0),numericValueType=(new ValueType).addNumber(),stringValueType=(new ValueType).addString(),boolValueType=(new ValueType).addBoolean(),numOrStrOrBoolValueType=(new ValueType).addNumber().addString().addBoolean(),anyDataValueType=(new ValueType).addAnyData(),areaZeroValueType=(new ValueType).addArea(0,[_r(1,1)]),_=new Projector,mustBeDefined=o(),unmatched=new TerminalSymbol("unmatched"),ascending="ascending",descending="descending",plus=new BuiltInFunction("plus",2,2,numericValueType),minus=new BuiltInFunction("minus",2,2,numericValueType),mul=new BuiltInFunction("mul",2,2,numericValueType),div=new BuiltInFunction("div",2,2,numericValueType),pow=new BuiltInFunction("pow",2,2,numericValueType),mod=new BuiltInFunction("mod",2,2,numericValueType),remainder=new BuiltInFunction("remainder",2,2,numericValueType),and=new BuiltInFunction("and",2,1/0,boolValueType),ln=new BuiltInFunction("ln",1,1,numericValueType),log10=new BuiltInFunction("log10",1,1,numericValueType),logb=new BuiltInFunction("logb",2,2,numericValueType),exp=new BuiltInFunction("exp",1,1,numericValueType),or=new BuiltInFunction("or",2,1/0,boolValueType),not=new BuiltInFunction("not",1,1,boolValueType),offset=new BuiltInFunction("offset",2,3,numericValueType.copy().addSize(0,1/0),!0,!0),coordinates=new BuiltInFunction("coordinates",1,1,anyDataValueType,!1,!0,!0),lessThan=new BuiltInFunction("lessThan",2,2,boolValueType),lessThanOrEqual=new BuiltInFunction("lessThanOrEqual",2,2,boolValueType),equal=new BuiltInFunction("equal",2,2,boolValueType),notEqual=new BuiltInFunction("notEqual",2,2,boolValueType),greaterThanOrEqual=new BuiltInFunction("greaterThanOrEqual",2,2,boolValueType),greaterThan=new BuiltInFunction("greaterThan",2,2,boolValueType),map=new BuiltInFunction("map",2,2,void 0),filter=new BuiltInFunction("filter",2,2,void 0),first=new BuiltInFunction("first",1,1,void 0),prev=new BuiltInFunction("prev",0,2,void 0,!0,!0),next=new BuiltInFunction("next",0,2,void 0,!0,!0),last=new BuiltInFunction("last",1,1,void 0),sort=new BuiltInFunction("sort",2,2,void 0),prevStar=new BuiltInFunction("prevStar",0,2,void 0,!0,!0),prevPlus=new BuiltInFunction("prevPlus",0,2,void 0,!0,!0),nextStar=new BuiltInFunction("nextStar",0,2,void 0,!0,!0),nextPlus=new BuiltInFunction("nextPlus",0,2,void 0,!0,!0),index=new BuiltInFunction("index",0,2,numericValueType,!0,!0),concatStr=new BuiltInFunction("concatStr",1,2,stringValueType.copy().addSize(1)),subStr=new BuiltInFunction("subStr",2,2,stringValueType.copy().addSize(1)),numberToString=new BuiltInFunction("numberToString",2,2,stringValueType.copy().addSize(1)),bool=new BuiltInFunction("bool",1,1,boolValueType.copy().addSize(1)),notEmpty=new BuiltInFunction("notEmpty",1,1,boolValueType.copy().addSize(1)),empty=new BuiltInFunction("empty",1,1,boolValueType.copy().addSize(1)),sum=new BuiltInFunction("sum",1,1/0,numericValueType.copy().addSize(1)),min=new BuiltInFunction("min",1,1/0,void 0),max=new BuiltInFunction("max",1,1/0,void 0),me=new BuiltInFunction("me",0,0,void 0,!0),embedded=new BuiltInFunction("embedded",0,1,void 0,!0,!0),embeddedStar=new BuiltInFunction("embeddedStar",0,1,void 0,!0,!0),embedding=new BuiltInFunction("embedding",0,1,void 0,!0,!0),embeddingStar=new BuiltInFunction("embeddingStar",0,1,void 0,!0,!0),expressionOf=new BuiltInFunction("expressionOf",0,1,void 0,!0,!0),referredOf=new BuiltInFunction("referredOf",0,1,void 0,!0,!0),intersectionParentOf=new BuiltInFunction("intersectionParentOf",0,1,void 0,!0,!0),debugNodeToStr=new BuiltInFunction("debugNodeToStr",1,2,stringValueType),size=new BuiltInFunction("size",1,1,numericValueType.copy().addSize(1)),pointer=new BuiltInFunction("pointer",0,0,areaZeroValueType.copy().addSize(1)),sequence=new BuiltInFunction("sequence",1,1,numericValueType.copy().addSize(0,1/0)),reverse=new BuiltInFunction("reverse",1,1,void 0),pos=new BuiltInFunction("pos",2,2,void 0),range=new BuiltInFunction("range",2,2,void 0),arg=new BuiltInFunction("arg",2,2,numOrStrOrBoolValueType.copy().addSize(1)),merge=new BuiltInFunction("merge",1,1/0,void 0),mergeWrite=new BuiltInFunction("mergeWrite",1,1/0,void 0),areaOfClass=new BuiltInFunction("areaOfClass",1,1,void 0,!1,!0),allAreas=new BuiltInFunction("allAreas",0,0,void 0,!1,!0),identify=new BuiltInFunction("identify",2,2,void 0),anonymize=new BuiltInFunction("anonymize",1,1,void 0),overlap=new BuiltInFunction("overlap",2,2,boolValueType),time=new BuiltInFunction("time",2,3,numericValueType.copy().addSize(1)),changed=new BuiltInFunction("changed",1,1,boolValueType.copy().addSize(1)),redirect=new BuiltInFunction("redirect",0,0,boolValueType.copy().addSize(0)),systemInfo=new BuiltInFunction("systemInfo",0,0,(new ValueType).addAttribute("url",(new ValueType).addNumber().addSize(1)).addAttribute("language",(new ValueType).addString().addSize(1)).addAttribute("languages",(new ValueType).addString().addSize(0,1/0)).addAttribute("maxTouchPoints",(new ValueType).addNumber().addSize(1)).addAttribute("connectionStatus",(new ValueType).addString().addSize(1)).addAttribute("powerDisconnected",(new ValueType).addNumber().addSize(0,1)).addSize(1)),loginInfo=new BuiltInFunction("loginInfo",0,1,(new ValueType).addAttribute("username",(new ValueType).addString().addSize(1)).addSize(1)),timestamp=new BuiltInFunction("timestamp",1,1,numericValueType.copy().addSize(1)),displayWidth=new BuiltInFunction("displayWidth",0,1,numericValueType.copy().addSize(0,1/0),!0,!0),displayHeight=new BuiltInFunction("displayHeight",0,1,numericValueType.copy().addSize(0,1/0),!0,!0),dateToNum=new BuiltInFunction("dateToNum",2,2,numericValueType),numToDate=new BuiltInFunction("numToDate",2,2,stringValueType),stringToNumber=new BuiltInFunction("stringToNumber",1,1,numericValueType),escapeQuotes=new BuiltInFunction("escapeQuotes",1,1,anyDataValueType),areasUnderPointer=new BuiltInFunction("areasUnderPointer",0,0,void 0),globalDefaults=new BuiltInFunction("globalDefaults",0,0,anyDataValueType.copy().addSize(1)),getRawData=new BuiltInFunction("getRawData",1,1,anyDataValueType.copy().addSize(0,1/0)),download=new BuiltInFunction("download",2,3,(new ValueType).addSize(0)),printArea=new BuiltInFunction("printArea",0,0,(new ValueType).addSize(0)),dayOfWeek=new BuiltInFunction("dayOfWeek",1,1,numericValueType),dayOfMonth=new BuiltInFunction("dayOfMonth",1,1,numericValueType),month=new BuiltInFunction("month",1,1,numericValueType),quarter=new BuiltInFunction("quarter",1,1,numericValueType),year=new BuiltInFunction("year",1,1,numericValueType),hour=new BuiltInFunction("hour",1,1,numericValueType),minute=new BuiltInFunction("minute",1,1,numericValueType),second=new BuiltInFunction("second",1,1,numericValueType),foreignFunctions=new BuiltInFunction("foreignFunctions",0,0,anyDataValueType.copy().addSize(0,1/0)),remoteStatus=new BuiltInFunction("remoteStatus",1,1,(new ValueType).addAttribute("state",(new ValueType).addString().addSize(1)).addSize(0,1)),urlStr=new BuiltInFunction("urlStr",1,1,stringValueType),intersect=new BuiltInFunction("intersect",2,2,void 0),unite=new BuiltInFunction("unite",2,2,void 0),isDisjoint=new BuiltInFunction("isDisjoint",2,2,boolValueType),classOfArea=new BuiltInFunction("classOfArea",1,1,stringValueType.copy().addSize(0,1/0),!1,!0),cond=new BuiltInFunction("cond",2,2,void 0),debugBreak=new BuiltInFunction("debugBreak",0,0,anyDataValueType),defun=new BuiltInFunction("defun",2,2,void 0),using=new BuiltInFunction("using",3,1/0,void 0),message=new BuiltInFunction("message",0,0,void 0,!1,!0),myMessage=new BuiltInFunction("myMessage",0,0,void 0,!0,!0),multiQuery=new BuiltInFunction("multiQuery",2,2,void 0),tempAppStateConnectionInfo=new BuiltInFunction("tempAppStateConnectionInfo",0,0,(new ValueType).addAttribute("errorId",(new ValueType).addNumber().addSize(1)).addAttribute("errorMessage",(new ValueType).addString().addSize(1)).addAttribute("serverAddress",(new ValueType).addString().addSize(0,1)).addAttribute("serverPort",(new ValueType).addString().addSize(0,1)).addAttribute("serverPath",(new ValueType).addString().addSize(0,1)).addAttribute("protocol",(new ValueType).addString().addSize(0,1)).addAttribute("owner",(new ValueType).addString().addSize(0,1)).addAttribute("appName",(new ValueType).addString().addSize(1)).addAttribute("connectionState",(new ValueType).addString().addSize(1)).addAttribute("loginStatus",(new ValueType).addString().addSize(1)).addSize(1)),debuggerAreaInfo=new BuiltInFunction("debuggerAreaInfo",1,1,anyDataValueType.copy().addSize(1)),debuggerContextInfo=new BuiltInFunction("debuggerContextInfo",1,1,anyDataValueType.copy().addSize(1)),datasource=new BuiltInFunction("datasource",1,2,anyDataValueType.copy().addSize(0,1/0)),datasourceInfo=new BuiltInFunction("datasourceInfo",0,0,(new ValueType).addAttribute("name",(new ValueType).addString().addSize(1)).addAttribute("baseName",(new ValueType).addString().addSize(1)).addAttribute("revision",(new ValueType).addAnyData().addSize(0,1/0)).addAttribute("refreshTime",(new ValueType).addNumber().addSize(1)).addAttribute("state",(new ValueType).addString().addSize(1)).addAttribute("attributes",(new ValueType).addAttribute("name",(new ValueType).addString().addSize(1)).addAttribute("originalName",(new ValueType).addString().addSize(1)).addAttribute("type",(new ValueType).addString().addSize(1)).addAttribute("uniqueValues",(new ValueType).addAnyData().addSizeRange(new RangeValue([0,64],!0,!1))).addAttribute("min",(new ValueType).addString().addSize(0,1)).addAttribute("max",(new ValueType).addString().addSize(0,1)).addAttribute("currency",(new ValueType).addString().addSize(0,1)).addSize(0,1/0)).addAttribute("info",(new ValueType).addString().addSize(0,1)).addAttribute("type",(new ValueType).addString().addSize(0,1)).addAttribute("typeCount",(new ValueType).addAttribute("number",(new ValueType).addNumber().addSize(1)).addAttribute("string",(new ValueType).addNumber().addSize(1)).addAttribute("object",(new ValueType).addNumber().addSize(1)).addAttribute("undefined",(new ValueType).addNumber().addSize(1)).addAttribute("boolean",(new ValueType).addNumber().addSize(1)).addAttribute("currency",(new ValueType).addNumber().addSize(1)).addAttribute("nrPositive",(new ValueType).addNumber().addSize(1)).addAttribute("nrNegative",(new ValueType).addNumber().addSize(1)).addAttribute("nrUnique",(new ValueType).addNumber().addSize(1)).addAttribute("nrUniqueValuesPerType",(new ValueType).addAttribute("number",(new ValueType).addNumber().addSize(1)).addAttribute("string",(new ValueType).addNumber().addSize(1)).addAttribute("object",(new ValueType).addNumber().addSize(1)).addAttribute("boolean",(new ValueType).addNumber().addSize(1)).addAttribute("currency",(new ValueType).addNumber().addSize(1)).addSize(1)).addSize(1)).addAttribute("progress",(new ValueType).addString().addSize(0,1)).addSize(0,1/0)),datatable=new BuiltInFunction("datatable",1,2,(new ValueType).addAttribute("name",(new ValueType).addString().addSize(1)).addAttribute("fullName",(new ValueType).addString().addSize(1)).addAttribute("state",(new ValueType).addString().addSize(1)).addAttribute("info",(new ValueType).addString().addSize(1)).addAttribute("revision",(new ValueType).addAnyData().addSize(0,1/0)).addAttribute("lastUpdate",(new ValueType).addNumber().addSize(1)).addAttribute("attributes",(new ValueType).addAttribute("name",(new ValueType).addString().addSize(1)).addAttribute("originalName",(new ValueType).addString().addSize(1)).addAttribute("type",(new ValueType).addString().addSize(1)).addAttribute("typeCount",(new ValueType).addAttribute("number",(new ValueType).addNumber().addSize(1)).addAttribute("date",(new ValueType).addNumber().addSize(1)).addAttribute("string",(new ValueType).addNumber().addSize(1)).addAttribute("object",(new ValueType).addNumber().addSize(1)).addAttribute("undefined",(new ValueType).addNumber().addSize(1)).addAttribute("boolean",(new ValueType).addNumber().addSize(1)).addAttribute("currency",(new ValueType).addNumber().addSize(1)).addAttribute("nrPositive",(new ValueType).addNumber().addSize(1)).addAttribute("nrNegative",(new ValueType).addNumber().addSize(1)).addAttribute("nrUnique",(new ValueType).addNumber().addSize(1)).addAttribute("nrUniqueValuesPerType",(new ValueType).addAttribute("number",(new ValueType).addNumber().addSize(1)).addAttribute("date",(new ValueType).addNumber().addSize(1)).addAttribute("string",(new ValueType).addNumber().addSize(1)).addAttribute("object",(new ValueType).addNumber().addSize(1)).addAttribute("boolean",(new ValueType).addNumber().addSize(1)).addAttribute("currency",(new ValueType).addNumber().addSize(1)).addSize(1)).addSize(1)).addAttribute("uniqueValues",(new ValueType).addAnyData().addSizeRange(new RangeValue([0,64],!0,!1))).addAttribute("min",(new ValueType).addString().addSize(0,1)).addAttribute("max",(new ValueType).addString().addSize(0,1)).addAttribute("currency",(new ValueType).addString().addSize(0,1)).addSize(0,1/0)).addAttribute("data",(new ValueType).addAnyData().addDataSource().addSize(0,1/0)).addSize(1)),database=new BuiltInFunction("database",1,3,(new ValueType).addAnyData().addDataSource().addSize(0,1/0)),databases=new BuiltInFunction("databases",0,0,(new ValueType).addAttribute("name",(new ValueType).addString().addSize(1)).addAttribute("id",(new ValueType).addString().addSize(1)).addAttribute("lastUpdate",(new ValueType).addNumber().addSize(1)).addAttribute("tags",(new ValueType).addString().addSize(1)).addAttribute("metaData",(new ValueType).addAnyData().addSize(0,1/0)).addAttribute("fileSize",(new ValueType).addString().addSize(0,1)).addAttribute("nrRecords",(new ValueType).addString().addSize(0,1)).addAttribute("parameters",(new ValueType).addAttribute("description",(new ValueType).addString().addSize(1)).addAttribute("type",(new ValueType).addString().addSize(1)).addAttribute("min",(new ValueType).addAnyData().addSize(0,1)).addAttribute("max",(new ValueType).addAnyData().addSize(0,1)).addAttribute("discreteValues",(new ValueType).addAnyData().addSize(0,1/0)).addSize(0,1/0)).addAttribute("attributes",(new ValueType).addAttribute("name",(new ValueType).addString().addSize(1)).addAttribute("originalName",(new ValueType).addString().addSize(1)).addAttribute("type",(new ValueType).addString().addSize(1)).addAttribute("typeCount",(new ValueType).addAttribute("number",(new ValueType).addNumber().addSize(1)).addAttribute("string",(new ValueType).addNumber().addSize(1)).addAttribute("object",(new ValueType).addNumber().addSize(1)).addAttribute("undefined",(new ValueType).addNumber().addSize(1)).addAttribute("boolean",(new ValueType).addNumber().addSize(1)).addAttribute("currency",(new ValueType).addNumber().addSize(1)).addAttribute("nrPositive",(new ValueType).addNumber().addSize(1)).addAttribute("nrNegative",(new ValueType).addNumber().addSize(1)).addAttribute("nrUnique",(new ValueType).addNumber().addSize(1)).addAttribute("nrUniqueValuesPerType",(new ValueType).addAttribute("number",(new ValueType).addNumber().addSize(1)).addAttribute("string",(new ValueType).addNumber().addSize(1)).addAttribute("object",(new ValueType).addNumber().addSize(1)).addAttribute("boolean",(new ValueType).addNumber().addSize(1)).addAttribute("currency",(new ValueType).addNumber().addSize(1)).addSize(1)).addSize(1)).addAttribute("uniqueValues",(new ValueType).addAnyData().addSize(0,250)).addAttribute("min",(new ValueType).addString().addSize(0,1)).addAttribute("max",(new ValueType).addString().addSize(0,1)).addAttribute("currency",(new ValueType).addString().addSize(0,1)).addSize(0,1/0)).addAttribute("uploadProgress",(new ValueType).addAttribute("dataTransferred",(new ValueType).addNumber().addSize(1)).addAttribute("state",(new ValueType).addString().addSize(1)).addSize(0,1)).addSize(0,1/0)),internalApply=new BuiltInFunction("internalApply",2,2,void 0),internalPush=new BuiltInFunction("internalPush",1,1,void 0),internalAtomic=new BuiltInFunction("internalAtomic",1,1,void 0),internalDelete=new BuiltInFunction("internalDelete",0,0,(new ValueType).addUndefined().addSize(0)),compareAreasQuery=new BuiltInFunction("compareAreasQuery",2,2,void 0),nCompareAreasQuery=new BuiltInFunction("nCompareAreasQuery",2,2,void 0),internalFilterAreaByClass=new BuiltInFunction("internalFilterAreaByClass",2,2,void 0),internalFilterAreaByClassName=new BuiltInFunction("internalFilterAreaByClassName",2,2,stringValueType),dynamicAttribute=new BuiltInFunction("dynamicAttribute",3,3,anyDataValueType.copy().addSize(1)),verificationFunction=new BuiltInFunction("verificationFunction",2,2,anyDataValueType),makeDefined=new BuiltInFunction("makeDefined",1,1,void 0),singleValue=new BuiltInFunction("singleValue",1,1,void 0),floor=new BuiltInFunction("floor",1,2,numericValueType),ceil=new BuiltInFunction("ceil",1,2,numericValueType),round=new BuiltInFunction("round",1,2,numericValueType),abs=new BuiltInFunction("abs",1,1,numericValueType),sqrt=new BuiltInFunction("sqrt",1,1,numericValueType),sign=new BuiltInFunction("sign",1,1,numericValueType),uminus=new BuiltInFunction("uminus",1,1,numericValueType),evaluateFormula=new BuiltInFunction("evaluateFormula",2,2,numericValueType),testFormula=new BuiltInFunction("testFormula",1,1,boolValueType),evaluateCdlStringValue=new BuiltInFunction("evaluateCdlStringValue",1,1,anyDataValueType),testCdlValueString=new BuiltInFunction("testCdlValueString",1,1,boolValueType),addComputedAttribute=new BuiltInFunction("addComputedAttribute",3,3,void 0),testStore=new BuiltInFunction("testStore",0,0,anyDataValueType.copy().addSize(0,1/0),!1,!0),__extends=this&&this.__extends||function(){
var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),PaidMgr=function(){function e(){this.templateMap={},this.nextTemplateId=2,this.indexMap={},this.nextIndexId=2,this.templateById={1:{parentId:void 0,childType:void 0,childName:void 0,referredId:void 0}},this.indexById={1:{prefixId:void 0}}}return e.prototype.getGlobalPersistentTemplateId=function(){return 0},e.prototype.getScreenAreaTemplateId=function(){return 1},e.prototype.getTemplateId=function(e,t,i,r){void 0===r&&(r=void 0);var n,o=e.getPersistentTemplateId();return"intersection"===t&&(n=r.getPersistentTemplateId()),this.getTemplateByEntry(o,t,i,n)},e.prototype.getTemplateByEntry=function(e,t,i,r){var n=this.getTemplateIdent(e,t,i,r),o=this.templateMap[n];return void 0===o&&(o=this.addTemplateId(n,e,t,i,r)),o},e.prototype.getTemplateIdent=function(e,t,i,r){var n=e+":"+t+":"+i;return"intersection"===t&&(n+=":"+r),n},e.prototype.addTemplateId=function(e,t,i,r,n){var o=this.nextTemplateId++;return this.addTemplateWithId(o,e,t,i,r,n),o},e.prototype.addTemplateWithId=function(e,t,i,r,n,o){this.templateMap[t]=e,this.templateById[e]={parentId:i,childType:r,childName:n,referredId:o}},e.prototype.getTemplatePath=function(e){for(var t=e,i=[];t>1;)i.push(this.templateById[t].childName),t=this.templateById[t].parentId;return i.reverse().join(".")},e.prototype.getGlobalPersistentIndexId=function(){return 0},e.prototype.getScreenAreaIndexId=function(){return 1},e.prototype.getIndexId=function(e,t,i,r){void 0===i&&(i=void 0),void 0===r&&(r=void 0);var n,o,s=e.getPersistentIndexId();return"single"===t?s:("set"===t?n=encodeURIComponent(i):(assert("intersection"===t,"type '"+t+"' is not a known type"),o=r.getPersistentIndexId()),this.getIndexByEntry(s,n,o))},e.prototype.getIndexByEntry=function(e,t,i){var r=this.getIndexIdent(e,t,i),n=this.indexMap[r];return void 0===n&&(n=this.addIndexId(r,e,t,i)),n},e.prototype.getIndexIdent=function(e,t,i){var r;return"undefined"!=typeof t?r=e+":"+t:"undefined"!=typeof i?r=e+";"+i:Utilities.error("getIndexIdent: unexpected identifier"),r},e.prototype.addIndexId=function(e,t,i,r){var n=this.nextIndexId++;return this.addIndexWithId(n,e,t,i,r),n},e.prototype.addIndexWithId=function(e,t,i,r,n){this.indexMap[t]=e;var o=this.indexById[e]={prefixId:i};assert(void 0===n!=(void 0===r),"exactly one of 'referredId' and 'dataIdent' should be undefined"),void 0!==r?o.append=r:o.compose=n},e.prototype.getScreenAreaId=function(){return"1:1"},e.prototype.getAreaId=function(e,t){var i=e+":"+t;return i},e.prototype.preload=function(e,t){for(var i=this.nextTemplateId-1,r=2;r<e.length;r++){var n=e[r];if(void 0!==n){var o=n.parentId,s=n.childType,a=n.childName,d=n.referredId,u=this.getTemplateIdent(o,s,a,d);assert(!(u in this.templateMap)||r===this.templateMap[u],"templateId must not change: ident="+u+", "+r+"("+typeof r+")!="+this.templateMap[u]+"("+typeof this.templateMap[u]+")"),this.addTemplateWithId(r,u,o,s,a,d),i=Math.max(i,r)}}this.nextTemplateId=i+1;for(var h=this.nextIndexId-1,l=2;l<t.length;l++){var c=t[l];if(void 0!==c){var p=c.prefixId,f=c.append,v=c.compose,g=this.getIndexIdent(p,f,v);assert(!(g in this.indexMap)||l===this.indexMap[g],"indexId must not change"),this.addIndexWithId(l,g,p,f,v),h=Math.max(h,l)}}this.nextIndexId=h+1},e.prototype.getAreaEntry=function(e){var t=e.indexOf(":");return t<0?void 0:{templateId:Number(e.slice(0,t)),indexId:Number(e.slice(t+1))}},e.prototype.getTemplateEntry=function(e){return this.templateById[e]},e.prototype.getIndexEntry=function(e){return this.indexById[e]},e}(),gPaidMgr=new PaidMgr,BackingStorePaidMgr=function(e){function t(t){var i=e.call(this)||this;return i.backingStore=t,i}return __extends(t,e),t.prototype.addTemplateId=function(t,i,r,n,o){var s=e.prototype.addTemplateId.call(this,t,i,r,n,o),a=this.templateById[s];return this.backingStore.addTemplate(s,a),s},t.prototype.addIndexId=function(t,i,r,n){var o=e.prototype.addIndexId.call(this,t,i,r,n),s=this.indexById[o];return this.backingStore.addIndex(o,s),o},t}(PaidMgr),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),logValues=!1,dbgAreaSetRepr={},AreaSetStackable=function(){function e(e,t){this.areaSet={},this.areaRefCount={},this.frameZ="",this.displayZ="",this.controller=e,this.areaId=t,this.areaReference=new ElementReference(t),this.zArea=gZIndex.addArea(this,e.parent),dbgAreaSetRepr[this.areaId]=this,void 0!==dbgCreateList&&dbgCreateList.push({cls:"AreaSetStackable",id:this.areaId})}return e.prototype.destroy=function(){delete dbgAreaSetRepr[this.areaId],gZIndex.removeArea(this),this.zArea=void 0},e.prototype.getZArea=function(){return this.zArea},e.prototype.getZAreaRep=function(){return this.zArea},e.prototype.addSetMember=function(e,t){e.areaId in this.areaSet?this.areaRefCount[e.areaId]++:(this.areaSet[e.areaId]=e,this.areaRefCount[e.areaId]=1,e.zArea.setSetRepresentative(this.zArea,t),gZIndex.newEmbedding(e,void 0,this),e.setZIndex(this.frameZ,this.displayZ))},e.prototype.removeSetMember=function(e){this.areaRefCount[e.areaId]--,0===this.areaRefCount[e.areaId]&&(delete this.areaSet[e.areaId],delete this.areaRefCount[e.areaId],void 0!==e.zArea&&(e.zArea.removeSetRepresentative(),gZIndex.newEmbedding(e,void 0,e.getEmbedding())))},e.prototype.setMemberDestruction=function(e){delete this.areaSet[e.areaId],delete this.areaRefCount[e.areaId],void 0!==e.zArea&&e.zArea.removeSetRepresentative()},e.prototype.setZIndex=function(e,t){this.frameZ=e,this.displayZ=t;for(var i in this.areaSet)this.areaSet[i].setZIndex(e,t)},e.prototype.getEmbeddingDepth=function(){return this.controller.getEmbeddingDepth()},e.prototype.getFrameDiv=function(){for(var e in this.areaSet)return this.areaSet[e].getFrameDiv()},e}(),ChildController=function(){function e(e,t,i,r,n){this.watchers=void 0,this.isCurrentlyActive=!1,this.willBeActive=!1,this.dataSourceAware=!1,this.scheduledAtPosition=-1,this.nrQueueResets=0,this.parent=e,this.name=t,this.template=i,this.setIndices=r,this.children=[],this.result=new Result([]),this.watcherId=getNextWatcherId(),gProfile&&(this.totalUpdateInputTime=0,this.attributedTime=0),void 0!==dbgCreateList&&dbgCreateList.push({cls:"ChildController",id:this.name})}return e.prototype.getSchedulePriority=function(){return 0},e.prototype.getScheduleStep=function(){return this.template.scheduleStep},e.prototype.isScheduled=function(){return this.scheduledAtPosition!==-1},e.prototype.isActive=function(){return!0},e.prototype.destroy=function(){if(void 0!==this.areaSetStackable&&(this.areaSetStackable.destroy(),this.areaSetStackable=void 0),void 0!==this.qualifiers){for(var e=0;e!==this.qualifiers.length;e++)for(var t=0;t!==this.qualifiers[e].length;t++)this.qualifierInputs[e][t].removeWatcher(this,!0,!1);this.qualifiers=this.qualifierInputs=void 0}this.result=void 0,this.informWatchers(),this.watchersToParent(),this.isScheduled()&&evaluationQueue.unschedule(this)},e.prototype.setupExistenceQualifiers=function(e){var t=!1;this.qualifiers=[],this.qualifierInputs=[];for(var i=0;i!==e.length;i++){var r=buildQualifiers(e[i],this.parent),n=!0;this.qualifierInputs.push([]),this.qualifiers.push([]);for(var o=0;o!==r.length;o++){var s=r[o].value;switch(this.qualifierInputs[i][o]=s,typeof r[o].match){case"boolean":r[o].match===!0?this.qualifiers[i][o]=new QualifierStateTrue(s.result.value):this.qualifiers[i][o]=new QualifierStateFalse(s.result.value);break;case"number":case"string":this.qualifiers[i][o]=new QualifierStateSimpleValue(s.result.value,r[o].match);break;default:r[o].match instanceof MoonRange?this.qualifiers[i][o]=new QualifierStateMatchRange(s.result.value,r[o].match):r[o].match instanceof MoonOrderedSet?this.qualifiers[i][o]=new QualifierStateMatchOS(s.result.value,r[o].match):(assert(!1,"no implementation"),this.qualifiers[i][o]=new QualifierStateAlwaysFalse(s.result.value))}s.isConstant()||(s.addWatcher(this,[i,o],!1,!0,!1),s.isScheduled()&&(n=!1,s.addForcedUpdate(this)))}n&&allQualifiersHold(this.qualifiers[i])&&(t=!0)}this.setNextExistenceState(t)},e.prototype.updateInput=function(e,t){if(void 0!==this.qualifiers){var i=e[0],r=e[1];for(this.qualifiers[i][r].value=t.value,i=0;i!==this.qualifiers.length;i++)if(allQualifiersHold(this.qualifiers[i]))return void this.setNextExistenceState(!0);this.setNextExistenceState(!1)}},e.prototype.setNextExistenceState=function(e){this.willBeActive=e,e!==this.isCurrentlyActive&&this.markAsChanged()},e.prototype.updateOutput=function(){Utilities.error("to be overridden")},e.prototype.addElement=function(e){this.result.value=this.result.value.concat(e.areaReference),this.informWatchers()},e.prototype.removeElement=function(e){var t=this.result.value;this.result.value=t.slice(0,e).concat(t.slice(e+1)),this.informWatchers()},e.prototype.replaceElements=function(e){valueEqual(this.result.value,e)||(this.result.value=e,this.informWatchers())},e.prototype.addWatcher=function(e,t,i){void 0===i&&(i=!1),assert(!i,"debugging: not supported"),void 0===this.watchers&&(this.watchers=new Map),this.watchers.has(e.watcherId)?this.watchers.get(e.watcherId).pos.push(t):this.watchers.set(e.watcherId,{watcher:e,pos:[t]})},e.prototype.removeWatcher=function(e,t){this.watchers.delete(e.watcherId)},e.prototype.removeWatcherForPos=function(e,t,i,r){var n=this.watchers.get(e.watcherId),o=n.pos.indexOf(t);o>=0&&(1===n.pos.length?this.removeWatcher(e,i):n.pos.splice(o,1))},e.prototype.setWatchers=function(e){this.watchers=e,this.informWatchers()},e.prototype.watchersToParent=function(){var e=this;void 0!==this.watchers&&this.watchers.forEach(function(t,i){for(var r=0;r!==t.pos.length;r++)e.parent.addChildAreaWatcher(e.name,t.watcher,t.pos[r],!0)})},e.prototype.markAsChanged=function(){evaluationQueue.schedule(this,!1)},e.prototype.informWatchers=function(){var e=this;void 0!==this.watchers&&this.watchers.forEach(function(t,i){for(var r=0;r!==t.pos.length;r++)t.watcher.updateInput(t.pos[r],e.result)})},e.prototype.makeAreaSetRepr=function(e){},e.prototype.removeAreaSetRepr=function(){},e.prototype.getAreaSetRepr=function(){return this.areaSetStackable},e.prototype.getEmbeddingDepth=function(){return this.parent.getEmbeddingDepth()+1},e.prototype.explain=function(){var e={};return e["exist === "+this.isCurrentlyActive]=this.getExistExplanation(),e},e.prototype.getExistExplanation=function(){var e,t={};if(void 0===this.qualifiers)return"true";for(var i=0;i!==this.qualifiers.length;i++){var r=String(i)+": "+String(allQualifiersHold(this.qualifiers[i]));if(t[r]={},0===this.qualifierInputs[i].length)e=t[r].qualifier="default";else{e=t[r].qualifier={};for(var n=0;n!==this.qualifierInputs[i].length;n++)e[n+": "+this.qualifierInputs[i][n].debugName()+(this.qualifiers[i][n].holds()?" == ":" != ")+this.qualifiers[i][n].matchValue()]=this.qualifierInputs[i][n].explain(void 0)}}return t},e.prototype.isDeferred=function(){return!1},e.prototype.defer=function(){throw"Should not be called"},e.prototype.undefer=function(){throw"Should not be called"},e.prototype.isReady=function(){return!0},e.prototype.toString=function(){return"@"+this.parent.areaId+"."+this.name},e.prototype.debugName=function(){return"childcontroller("+this.name+")"},e.prototype.getDebugOrigin=function(){return["child controller "+this.name]},e}(),StaticChildController=function(e){function t(t,i,r,n,o){var s=e.call(this,t,i,r,n,o)||this;return o?s.setupExistenceQualifiers(o):(s.willBeActive=!0,s.updateOutput()),s}return __extends(t,e),t.prototype.destroy=function(){0!==this.children.length&&(this.children[0].destroy(),this.children=void 0),e.prototype.destroy.call(this)},t.prototype.add=function(e){this.children[0]=e,this.addElement(e),e.setComment(this.parent.areaId+":single:"+this.name)},t.prototype.remove=function(e){this.children.length=0,this.removeElement(0)},t.prototype.updateOutput=function(){if(this.willBeActive&&!this.isCurrentlyActive){this.isCurrentlyActive=!0;var e=CoreArea.instantiate(this.template,this,this.setIndices);this.add(e)}else if(!this.willBeActive&&this.isCurrentlyActive){this.isCurrentlyActive=!1;var e=this.children[0];this.remove(e),e.destroy()}},t.prototype.copyTransitionsToReferredIntersections=function(e,t){if(1===this.children.length){var i=this.children[0];i instanceof DisplayArea&&void 0===i.display.getTransitions()&&i.copyTransitionsToReferredIntersections(e,t)}},t.prototype.cleanUpUnusedEvaluationNodes=function(){return 0===this.children.length?0:this.children[0].cleanUpUnusedEvaluationNodes()},t.prototype.cleanUpRemovedExportNodes=function(){0!==this.children.length&&this.children[0].cleanUpRemovedExportNodes()},t}(ChildController),SetChildController=function(e){function t(t,i,r,n,o){var s=e.call(this,r,t,i,n,o)||this;return s.childPos=void 0,s.identifier2area=new Map,s.useIdentity=!0,s.eltIDRefCount=new Map,s.indexerTracer=void 0,s.dataSourceAware=!0,o?s.setupExistenceQualifiers(o):s.setNextExistenceState(!0),s}return __extends(t,e),t.prototype.instantiateSetFunctions=function(){var e=this.parent.template.setFunctions[this.name].data,t=this.parent.template.setFunctions[this.name].partner;void 0!==e&&(this.dataEval=getEvaluationNode(e,this.parent),this.dataEval.isConstant()||this.dataEval.addWatcher(this,"data",!1,!1,!0)),void 0!==t&&(this.partnerEval=getEvaluationNode(t,this.parent),this.partnerEval.isConstant()||this.partnerEval.addWatcher(this,"partner",!1,!1,!1),this.partners={},this.intersectionPartners={}),this.childPos={},(void 0!==e&&!this.dataEval.isScheduled()||void 0!==t&&!this.partnerEval.isScheduled())&&this.updateOutput()},t.prototype.destroy=function(){this.setNextExistenceState(!1),void 0!==this.dataEval&&(this.dataEval.removeWatcher(this,!1,!0),this.dataEval=void 0,this.setDataResult(new Result),this.nextData=void 0),void 0!==this.partnerEval&&(this.partnerEval.removeWatcher(this,!1,!1),this.setPartners(new Result),assert(Utilities.isEmptyObj(this.intersectionPartners),"must remove all first"),this.partnerEval=void 0,this.nextPartners=void 0,this.partners=void 0,this.intersectionPartners=void 0),this.children=void 0,this.childPos=void 0,void 0!==this.indexerTracer&&(this.indexerTracer.destroy(),this.indexerTracer=void 0),e.prototype.destroy.call(this)},t.prototype.updateInput=function(t,i){"data"===t?(this.nextData=i,this.useIdentity=!i.anonymize,void 0===i?(this.isCurrentlyActive&&this.dataEval.deactivate(this,!0),this.dataEval.removeWatcher(this,!1,!0),this.dataEval=void 0):this.markAsChanged()):"partner"===t?(this.nextPartners=i,void 0===i?(this.isCurrentlyActive&&this.partnerEval.deactivate(this,!1),this.partnerEval.removeWatcher(this,!1,!1),this.partnerEval=void 0):this.markAsChanged()):e.prototype.updateInput.call(this,t,i)},t.prototype.addIntersectionChild=function(e){this.childPos[e.areaId]=this.children.length,this.children.push(e),e.setComment(this.parent.areaId+":set:"+this.name),this.addElement(e),this.informWatchers()},t.prototype.removeIntersectionChild=function(e){var t=this.childPos[e.areaId];delete this.childPos[e.areaId],this.children.splice(t,1);for(var i in this.childPos)this.childPos[i]>t&&this.childPos[i]--;this.removeElement(t),this.informWatchers()},t.prototype.setNextExistenceState=function(e){this.willBeActive=e,e!==this.isCurrentlyActive&&(e?(this.isCurrentlyActive=!0,void 0===this.childPos&&this.instantiateSetFunctions(),void 0!==this.dataEval?(this.dataEval.activate(this,!0),this.dataEval.scheduledAtPosition!==-1&&this.dataEval.forceUpdate(this,!0),this.nextData=this.dataEval.result):this.nextData=void 0,void 0!==this.partnerEval?(this.partnerEval.activate(this,!1),this.partnerEval.scheduledAtPosition!==-1&&this.partnerEval.forceUpdate(this,!0),this.nextPartners=this.partnerEval.result):this.nextPartners=void 0):(this.isCurrentlyActive=!1,void 0!==this.dataEval&&(this.dataEval.deactivate(this,!0),this.nextData=new Result),void 0!==this.partnerEval&&(this.partnerEval.deactivate(this,!1),this.nextPartners=new Result)),this.markAsChanged())},t.prototype.updateOutput=function(){var e=this.nextData,t=this.nextPartners;this.nextData=void 0,this.nextPartners=void 0,void 0!==e?(this.setDataResult(e),void 0!==this.dataEval&&"dataSource"in this.dataEval.result&&this.updateDataSourceChanges()):void 0!==this.dataSourceInput?this.updateDataSourceChanges():void 0!==t&&this.setPartners(t)},t.prototype.setDataResult=function(e){function i(e){return e}var r=this,n=void 0===e.value?[]:e.value,o=void 0===e.value?void 0:e.identifiers,s=void 0,a={},d=void 0,u=[];if(logValues&&void 0===logPrototypes){var h=JSON.stringify(e.value);void 0!==h&&h.length>=150&&(h=h.substr(0,72)+" ... "+h.substr(-72,72))}if(void 0!==e.dataSource)return void this.setDataSource(e.dataSource);void 0!==this.dataSourceInput&&this.releaseDataSource(),t.creatingAreas++,n.length>200&&Utilities.warnMessage(String(n.length)+" children for @"+this.parent.areaId+"."+this.name);try{for(var l=0,c=0;l!==n.length;l++){var p=n[l],f=this.useIdentity&&void 0!==o?o[l]:c;if(f in a)d=this.identifier2area.get(f),d.addSetDataSameId(p);else{var v=new Result([p]);if(void 0!==o&&(v.identifiers=[f]),a[f]=!0,this.identifier2area.has(f)){d=this.identifier2area.get(f);var g=void 0!==d.param?d.param.attr:new Result([f]);d.updateSetData(g,v),d.updateSetPosition(this.dataEval,c)}else{var m=this.setIndices.concat(i(f));d=this.template.isDisplayArea!==!1?new DisplayArea(this.template,this,m,f,new Result([f]),v,this.dataEval,c):new CalculationArea(this.template,this,m,f,new Result([f]),v,this.dataEval,c),d.setComment(this.parent.areaId+":set:"+this.name),d.finishInstantiation(),this.identifier2area.set(f,d)}areaRelationMonitor.addRelation(d.areaId,"index",[c]),void 0===s?areaRelationMonitor.addRelation(d.areaId,"prev",[]):(areaRelationMonitor.addRelation(d.areaId,"prev",[s.areaReference]),areaRelationMonitor.addRelation(s.areaId,"next",[d.areaReference])),u.push(d.areaReference),s=d,c++}}}finally{t.creatingAreas--}void 0!==s?areaRelationMonitor.addRelation(s.areaId,"next",[]):void 0!==d&&areaRelationMonitor.removeRelation(d.areaId,"next"),this.identifier2area.forEach(function(e,t){t in a||r.destroyChildArea(e,t)},this),this.replaceElements(u)},t.prototype.destroyChildArea=function(e,t){e.releaseDataSourceInput(this),areaRelationMonitor.removeRelation(e.areaId,"prev"),areaRelationMonitor.removeRelation(e.areaId,"next"),areaRelationMonitor.removeRelation(e.areaId,"index"),e.destroy(),this.identifier2area.delete(t)},t.prototype.setPartners=function(e){var i,r={};t.creatingAreas++;try{if(void 0!==e.value)for(var n=0;n<e.value.length;n++){var o=e.value[n];if(o instanceof ElementReference){var s=o;i=s.getElement(),r[i]=allAreaMonitor.getAreaById(i)}}for(i in r){var a=r[i];if(i in this.partners)assert(this.partners[a.areaId]===a,"check");else if(chainsAllowIntersection(a,this.parent,this.name)){var d=a.areaId,u=this.setIndices.concat(d);this.addIntersectionPartner(a,u)}}for(i in this.partners)i in r||this.removeIntersectionPartner(this.partners[i]);this.partners=r}finally{t.creatingAreas--}},t.prototype.addIntersectionPartner=function(e,t){e.areaId in this.intersectionPartners||(this.intersectionPartners[e.areaId]=new IntersectionPartner(this,e,t))},t.prototype.removeIntersectionPartner=function(e){if(e.areaId in this.intersectionPartners){var t=this.intersectionPartners[e.areaId];t.destroy(),delete this.intersectionPartners[e.areaId],assert(this.partners[e.areaId]===e,"check"),delete this.partners[e.areaId]}},t.prototype.makeAreaSetRepr=function(e){if(void 0===this.areaSetStackable){var t=gPaidMgr.getTemplateId(this.parent,"stacking",this.name),i=this.parent.getPersistentIndexId(),r=gPaidMgr.getAreaId(t,i);this.areaSetStackable=new AreaSetStackable(this,r)}return this.areaSetStackable},t.prototype.removeAreaSetRepr=function(){void 0!==this.areaSetStackable&&(this.areaSetStackable.destroy(),this.areaSetStackable=void 0)},t.prototype.setDataSource=function(e){this.dataSourceInput!==e&&(void 0!==this.orderingResultWatcher&&(this.orderingResultWatcher.destroy(),this.areaDataSource.deactivate(),this.dataSourceInput.removeMergeUnderIdentityWithPathApplication(this.areaDataSource),this.areaDataSource.removeResultReceiver(this)),this.orderingResultWatcher=new OrderingResultWatcher(globalInternalQCM,this,void 0),this.orderingResultWatcher.activate(),this.dataSourceInput=e,this.initializeAreaDataSource(e),this.orderingResultWatcher.init(this.areaDataSource))},t.prototype.initializeAreaDataSource=function(e){for(var t=e.applyMergeUnderIdentityWithPath("areaSetContent",this),i=t.funcResult.indexer,r=["pointerInArea","dragInArea","areaSetAttr","input"],n=i.qcm.getRootPathId(),o=0;o<r.length;o++){var s=i.qcm.allocatePathId(n,r[o]);i.addPath(s),i.qcm.releasePathId(s)}this.areaDataSource=t,t.activate()},t.prototype.updateAreaDataSource=function(e,t,i,r){function n(e,t){for(var i in e.children)if("areaSetContent"!==i){var s=e.children[i];n(s,t),o.removeNode(s,r)}}var o=this.areaDataSource.funcResult.indexer,s=o.paths;if(void 0!==e&&(this.eltIDRefCount.has(e)?this.eltIDRefCount.set(e,this.eltIDRefCount.get(e)+1):(s.nodes.has(e)||o.addDataElementNode(s,e,void 0,e,0,e),this.eltIDRefCount.set(e,1)),this.updateAreaDataSourcePathValue(e,t,i)),void 0!==r){var a=this.eltIDRefCount.get(r);1===a?(n(s,r),this.eltIDRefCount.delete(r)):(assert(a>1,"shouldn't happen"),this.eltIDRefCount.set(r,a-1))}},t.prototype.updateAreaDataSourcePathValue=function(e,t,i){var r=this.areaDataSource.funcResult.indexer,n=r.paths,o=r.qcm.allocatePathId(n.pathId,t),s=r.addPath(o);s.nodes.has(e)||r.addNonDataElementNode(s,e),r.setKeyValue(s,e,typeof i,i),r.qcm.releasePathId(o)},t.prototype.releaseDataSource=function(){var e=this;this.identifier2area.forEach(function(t,i){var r=t.getDataElementId();t.releaseDataSourceInput(e),e.updateAreaDataSource(void 0,"areaSetAttr",i,r)},this),this.areaDataSource.deactivate(),this.dataSourceInput.removeMergeUnderIdentityWithPathApplication(this.areaDataSource),this.areaDataSource.removeResultReceiver(this),this.areaDataSource=void 0,this.orderingResultWatcher.destroy(),this.dataSourceInput=void 0,this.orderingResultWatcher=void 0},t.prototype.refreshIndexerAndPaths=function(e,t){},t.prototype.replaceIndexerAndPaths=function(e,t,i,r){},t.prototype.newDataSourceResult=function(e){Utilities.error("not expected to be called")},t.prototype.reextractData=function(e){Utilities.error("not expected to be called")},t.prototype.updateDataElementPosition=function(e,t,i,r){if(this.useIdentity)return void this.markAsChanged();e.length!==this.identifier2area.size&&this.markAsChanged();for(var n=0;n!==e.length;n++){var o=e[n],s=t+n;if(!this.identifier2area.has(s)){this.markAsChanged();break}var a=this.identifier2area.get(s),d=a.getDataElementId();o!==d&&(a.updateDataElementID(o),this.updateAreaDataSource(o,"areaSetAttr",s,d))}},t.prototype.updateDataSourceChanges=function(){var e,i=this,r={},n=void 0!==this.orderingResultWatcher?this.orderingResultWatcher.dataElementIdsInOrder:[],o=[],s=void 0;n.length>200&&Utilities.warnMessage(String(n.length)+" children for @"+this.parent.areaId+"."+this.name),this.useIdentity&&void 0===this.indexerTracer?this.indexerTracer=new IndexerTracer(this.areaDataSource.combinedIndexer,globalInternalQCM.getRootPathId(),this):this.useIdentity||void 0===this.indexerTracer||(this.indexerTracer.destroy(),this.indexerTracer=void 0);try{t.creatingAreas++;for(var a=0;a!==n.length;a++){var d=n[a],u=this.useIdentity?this.getIdentity(d):a;if(!(u in r)){var h,l=this.setIndices.concat(u);if(r[u]=!0,this.identifier2area.has(u)){e=this.identifier2area.get(u);var c=e.getDataElementId();d!==c&&(e.updateDataElementID(d),this.updateAreaDataSource(d,"areaSetAttr",u,c)),globalEventQueue.clearPtrInArea(e)}else h=new Result(emptyDataSourceResult),h.dataSource=this.areaDataSource.applyElementIdQuery([d],this,getNextWatcherId()),e=this.template.isDisplayArea!==!1?new DisplayArea(this.template,this,l,u):new CalculationArea(this.template,this,l,u),e.setComment(this.parent.areaId+":set:"+this.name),e.finishInstantiation(),e.setAreaParam(h,d),this.updateAreaDataSource(d,"areaSetAttr",u,void 0),this.identifier2area.set(u,e);areaRelationMonitor.addRelation(e.areaId,"index",[a]),void 0===s?areaRelationMonitor.addRelation(e.areaId,"prev",[]):(areaRelationMonitor.addRelation(e.areaId,"prev",[s.areaReference]),areaRelationMonitor.addRelation(s.areaId,"next",[e.areaReference])),o.push(e.areaReference),s=e}}}finally{t.creatingAreas--}void 0!==s?areaRelationMonitor.addRelation(s.areaId,"next",[]):void 0!==e&&areaRelationMonitor.removeRelation(e.areaId,"next"),this.identifier2area.forEach(function(e,t){if(!(t in r)){var n=e.getDataElementId();i.destroyChildArea(e,t),i.updateAreaDataSource(void 0,"areaSetAttr",t,n)}}),this.replaceElements(o)},t.prototype.indexerUpdateKeys=function(e,t,i,r,n){this.markAsChanged()},t.prototype.removeAllIndexerMatches=function(){},t.prototype.getIdentity=function(e){if(void 0===this.areaDataSource||void 0===this.areaDataSource.combinedIndexer)return e;var t=this.areaDataSource.combinedIndexer.paths.nodes.get(e);return void 0===t||"string"!==t.type&&"number"!==t.type?e:t.key},t.prototype.explain=function(){var t=e.prototype.explain.call(this);return void 0!==this.dataEval&&(t["data: "+this.dataEval.debugName()]=this.dataEval.explain(void 0)),void 0!==this.partnerEval&&(t["partner: "+this.partnerEval.debugName()]=this.partnerEval.explain(void 0)),t},t.prototype.copyTransitionsToReferredIntersections=function(e,t){for(var i in this.identifier2area){var r=this.identifier2area.get(i);r instanceof DisplayArea&&void 0===r.display.getTransitions()&&r.copyTransitionsToReferredIntersections(e,t)}for(var n in this.intersectionPartners){var o=this.intersectionPartners[n];o.intersectionArea instanceof DisplayArea&&void 0===o.intersectionArea.display.getTransitions()&&(this.template.embeddingInReferred?o.intersectionArea.initializing||(o.intersectionArea.debugTransitionSource=t,o.intersectionArea.display.applyTransitionProperties(e)):o.intersectionArea.copyTransitionsToReferredIntersections(e,t))}},t.prototype.cleanUpUnusedEvaluationNodes=function(){for(var e=0,t=0;t<this.children.length;t++)e+=this.children[t].cleanUpUnusedEvaluationNodes();return this.identifier2area.forEach(function(t){e+=t.cleanUpUnusedEvaluationNodes()}),e},t.prototype.cleanUpRemovedExportNodes=function(){for(var e=0;e<this.children.length;e++)this.children[e].cleanUpRemovedExportNodes();this.identifier2area.forEach(function(e){e.cleanUpRemovedExportNodes()})},t}(ChildController);SetChildController.creatingAreas=0;var AreaIntersectionTrigger=function(){function e(e){this.subTriggerValue=[],this.pairOffset=[],this.posPair=[],this.triggerValue=!1;var t=e.controller.parent.areaReference,i=e.referredArea.areaReference,r=e.lce.areaReference,n=[{point1:{type:"left",visibilityOf:t,relativeTo:r},point2:{type:"right",visibilityOf:i,relativeTo:r}},{point1:{type:"left",visibilityOf:i,relativeTo:r},point2:{type:"right",visibilityOf:t,relativeTo:r}},{point1:{type:"top",visibilityOf:t,relativeTo:r},point2:{type:"bottom",visibilityOf:i,relativeTo:r}},{point1:{type:"top",visibilityOf:i,relativeTo:r},point2:{type:"bottom",visibilityOf:t,relativeTo:r}}];this.intersection=e;for(var o={areaId:e.controller.parent.areaId},s=0;s!==n.length;s++)this.posPair[s]=new PosPair(o,void 0,void 0,s),this.posPair[s].registerHandler(this),this.posPair[s].newDescription(n[s]);globalGeometryTask.schedule(),void 0!==dbgCreateList&&dbgCreateList.push({cls:"AreaIntersectionTrigger",id:o})}return e.prototype.destroy=function(){for(var e=0;e<this.posPair.length;e++)void 0!==this.pairOffset[e]&&this.pairOffset[e].destroy(),this.posPair[e].removeHandler(this),this.posPair[e].destroyPair();globalGeometryTask.schedule()},e.prototype.call=function(e,t,i){var r,n=!1;assert("undefined"!=typeof this.posPair[i],"call.1"),assert(this.posPair[i]===t,"call.2");for(var o=0;o<=1;o++)for(var s in t.changes){var a=t.changes[s];for(var d in a)if(0===o&&"removed"===a[d])assert("undefined"!=typeof this.pairOffset[i],"err"),this.pairOffset[i].destroy(),delete this.pairOffset[i],r=void 0,n=!0;else if(1===o&&"added"===a[d]){assert("undefined"==typeof this.pairOffset[i],"err");var u=new LabelPairOffset(this,i,s,d);this.pairOffset[i]=u,r=u.get(),n=void 0!==r}}n&&this.updateTriggerOffset(i,r)},e.prototype.updateOffset=function(e,t,i,r){this.updateTriggerOffset(e,r)},e.prototype.updateTriggerOffset=function(e,t){var i="number"==typeof t&&t>=1;i!==this.subTriggerValue[e]&&(this.subTriggerValue[e]=i,this.recalcTrigger())},e.prototype.recalcTrigger=function(){var e=!0;if(4==this.posPair.length){for(var t=0;t<this.posPair.length;t++)if(this.subTriggerValue[t]!==!0){e=!1;break}if(this.triggerValue!==e){var i=this.triggerValue;this.triggerValue=e,this.intersection.triggerUpdate(e),assert(i!==this.triggerValue,"can't happen, can it?")}}},e}(),IntersectionPartner=function(){function e(e,t,i){this.controller=e,this.referredArea=t,this.lce=getLCE(t,e.parent),this.setIndices=i,this.intersectionArea=void 0,this.referredArea.addIsReferredOf(e),this.trigger=new AreaIntersectionTrigger(this),void 0!==dbgCreateList&&dbgCreateList.push({cls:"IntersectionPartner"})}return e.prototype.destroy=function(){this.referredArea.removeIsReferredOf(this.controller),this.trigger.destroy(),void 0!==this.intersectionArea&&(this.controller.removeIntersectionChild(this.intersectionArea),this.intersectionArea.destroy())},e.prototype.triggerUpdate=function(e){e?this.addIntersection():this.removeIntersection()},e.prototype.addIntersection=function(){this.intersectionArea=this.controller.template.isDisplayArea!==!1?new DisplayArea(this.controller.template,this.controller,this.setIndices,void 0,void 0,void 0,void 0,void 0,this.referredArea):new CalculationArea(this.controller.template,this.controller,this.setIndices,void 0,void 0,void 0,void 0,void 0,this.referredArea),this.controller.addIntersectionChild(this.intersectionArea),this.intersectionArea.finishInstantiation()},e.prototype.removeIntersection=function(){void 0!==this.intersectionArea&&(this.controller.removeIntersectionChild(this.intersectionArea),this.intersectionArea.destroy(),this.intersectionArea=void 0)},e}(),debugWrites=!1,debugWritesEval=!1,debugWritesString=!0,gWriteAction=void 0,ToMergeEvaluationNode=function(){function e(e,t){this.tmNode=e,this.localEvaluationEnv=t,this.toExpression=void 0,this.mergeExpression=void 0,this.active=!1,this.dataSourceAware=!1,this.writeNode=void 0,this.triggerValue=void 0,this.caseName=void 0,this.deferred=!1,this.watcherId=getNextWatcherId(),this.scheduleStep=e.scheduleStep,gProfile&&(this.totalUpdateInputTime=0,this.attributedTime=0),void 0!==dbgCreateList&&dbgCreateList.push({cls:"ToMergeEvaluationNode",id:this.watcherId})}return e.prototype.destroy=function(){this.active&&(this.toExpression.deactivate(this,!1),this.mergeExpression.deactivate(this,!1),evaluationQueue.unhold(this)),void 0!==this.toExpression&&(this.toExpression.removeWatcher(this,!1,!1),this.mergeExpression.removeWatcher(this,!1,!1),this.toExpression=void 0,this.mergeExpression=void 0),this.active=!1},e.prototype.toString=function(){return"to-merge("+this.writeNode.name+", "+this.caseName+")"},e.prototype.toMsgString=function(){return this.writeNode.name+":"+this.caseName},e.prototype.markForWrite=function(e,t,i){this.writeNode=e,this.triggerValue=t,void 0===this.toExpression&&(this.toExpression=getEvaluationNode(this.tmNode.to,this.localEvaluationEnv),this.mergeExpression=getEvaluationNode(this.tmNode.merge,this.localEvaluationEnv),this.toExpression.addWatcher(this,0,!1,!1,!1),this.mergeExpression.addWatcher(this,1,!1,!1,!1)),this.caseName=i,
this.toExpression.activate(this,!1),this.mergeExpression.activate(this,!1),this.active=!0,evaluationQueue.hold(this)},e.prototype.unmarkForWrite=function(){this.toExpression.deactivate(this,!1),this.mergeExpression.deactivate(this,!1),this.active=!1,evaluationQueue.unhold(this)},e.prototype.updateInput=function(e,t){if(this.active&&debugWrites&&debugWritesEval){var i=void 0===t?void 0:t.value;gSimpleLog.log("update",this.writeNode.name,this.caseName,e,vstringify(i))}},e.prototype.isActive=function(){return this.active},e.prototype.isReady=function(){return!(void 0!==this.toExpression&&this.toExpression.deferred||void 0!==this.mergeExpression&&this.mergeExpression.deferred)},e.prototype.commit=function(){if(this.toExpression.deferred||this.mergeExpression.deferred)return void Utilities.error("result of a loop?");if(this.toExpression.isQualified()&&this.mergeExpression.isQualified()){var e=this.shouldDebugBreak(),t=new MergeAttributes(this.mergeExpression.result.push,this.mergeExpression.result.atomic,this.mergeExpression.result.erase);(debugWrites||e)&&gSimpleLog.log("write",this.writeNode.name,this.caseName,vstringify(this.mergeExpression.result.value),"to",this.toExpression.prototype.idStr()),e&&breakIntoDebugger(),gWriteAction=this.writeNode.name+":"+this.caseName,this.toExpression.write(this.mergeExpression.result,WriteMode.merge,t,void 0),gWriteAction=void 0}this.mergeExpression.deactivate(this,!1),this.toExpression.deactivate(this,!1),this.active=!1},e.prototype.shouldDebugBreak=function(){var e=this.writeNode.name.match(/^@([0-9]+:[0-9]+):(.*)/);return shouldDebugBreak(e[1],e[2],this.caseName)},e.prototype.explain=function(e){var t={};return void 0!==this.toExpression&&(t["to: "+this.toExpression.debugName()]=this.toExpression.explain(getATDBIAttr(e,"to"))),void 0!==this.mergeExpression&&(t["merge: "+this.mergeExpression.debugName()]=this.mergeExpression.explain(getATDBIAttr(e,"merge"))),t},e.prototype.undefer=function(){throw"Should not be called"},e.prototype.defer=function(){throw"Should not be called"},e.prototype.isDeferred=function(){return!1},e.prototype.debugName=function(){return"toMerge("+this.caseName+")"},e.prototype.getDebugOrigin=function(){return["to merge "+this.caseName]},e}(),WriteTriggerNode=function(){function e(e,t,i){this.dataSourceAware=!1,this.currentConditionValue=void 0,this.nextConditionValue=void 0,this.continuePropagation=[void 0,void 0],this.whenBecomesTrue=void 0,this.whenBecomesFalse=void 0,this.currentInput=void 0,this.isOnTimeQueue=!1,this.name=e,this.prototype=t,this.local=i,this.watcherId=getNextWatcherId(),this.upon=getEvaluationNode(t.upon,i);for(var r=[void 0!==t.whenBecomesTrue?t.whenBecomesTrue.continuePropagation:void 0,void 0!==t.whenBecomesFalse?t.whenBecomesFalse.continuePropagation:void 0],n=0;n<r.length;n++)void 0!==r[n]&&(this.continuePropagation[n]=getEvaluationNode(r[n],i),this.continuePropagation[n].addWatcher(this,"continuePropagation",!1,!1,!1));this.scheduleStep=t.scheduleStep,gProfile&&(this.totalUpdateInputTime=0,this.attributedTime=0),this.upon.isConstant()?(this.currentInput=this.upon.result.value,evaluationQueue.addTimeSensitiveNode(this)):this.upon.addWatcher(this,"upon",!1,!1,!1),void 0!==dbgCreateList&&dbgCreateList.push({cls:"WriteTriggerNode",id:this.watcherId})}return e.prototype.destroy=function(){evaluationQueue.removeTimeSensitiveNode(this),this.upon.removeWatcher(this,!0,!1);for(var e=0;e<this.continuePropagation.length;e++)void 0!==this.continuePropagation[e]&&this.continuePropagation[e].removeWatcher(this,!0,!1);for(var t in this.whenBecomesTrue)this.whenBecomesTrue[t].destroy();for(var t in this.whenBecomesFalse)this.whenBecomesFalse[t].destroy();this.upon=void 0,this.whenBecomesFalse=void 0,this.whenBecomesTrue=void 0},e.prototype.toString=function(){return"writenode("+this.name+")"},e.prototype.initialize=function(){this.upon.isConstant()?this.updateInput("upon",this.upon.result):(this.upon.activate(this,!1),this.upon.forceUpdate(this,!0));for(var e=0;e<this.continuePropagation.length;e++)void 0!==this.continuePropagation[e]&&this.continuePropagation[e].activate(this,!1)},e.prototype.updateInput=function(e,t){if("upon"===e)if(this.currentInput=void 0===t?void 0:t.value,evaluationQueue.addTimeSensitiveNode(this),isTrue(this.currentInput)){if(void 0===this.whenBecomesTrue&&void 0!==this.prototype.whenBecomesTrue&&void 0!==this.prototype.whenBecomesTrue.actions){this.whenBecomesTrue={};for(var i in this.prototype.whenBecomesTrue.actions)this.whenBecomesTrue[i]=new ToMergeEvaluationNode(this.prototype.whenBecomesTrue.actions[i],this.local)}}else if(void 0===this.whenBecomesFalse&&void 0!==this.prototype.whenBecomesFalse&&void 0!==this.prototype.whenBecomesFalse.actions){this.whenBecomesFalse={};for(var i in this.prototype.whenBecomesFalse.actions)this.whenBecomesFalse[i]=new ToMergeEvaluationNode(this.prototype.whenBecomesFalse.actions[i],this.local)}},e.prototype.isActive=function(){return!0},e.prototype.isReady=function(){return!0},e.prototype.preWriteNotification=function(e){var t=isTrue(this.currentInput);if(t!==this.nextConditionValue){var i=t?this.whenBecomesTrue:this.whenBecomesFalse,r=t?0:1;debugWrites&&gSimpleLog.log("upon",this.name,"=",t);for(var n in i)i[n].markForWrite(this,t,n);if(this.nextConditionValue!==this.currentConditionValue){var i=this.nextConditionValue?this.whenBecomesTrue:this.whenBecomesFalse;for(var n in i)i[n].unmarkForWrite()}void 0!==this.currentConditionValue&&(void 0===this.continuePropagation[r]?void 0!==i&&abortMessagePropagation(this.name+"(default)/"+t,!0):void 0!==this.continuePropagation[r].result&&isFalseValue(this.continuePropagation[r].result.value)&&abortMessagePropagation(this.name+"(explicit)/"+t,!1)),this.nextConditionValue=t,globalCommitWritesTask.schedule()}},e.prototype.endOfEvaluationCycleNotification=function(e){this.currentConditionValue=this.nextConditionValue},e.prototype.debugName=function(){return"write("+this.name+")"},e.prototype.explain=function(e){var t,i={};if(i["upon: "+this.upon.debugName()]=this.upon.explain(getATDBIAttr(e,"upon")),void 0!==this.continuePropagation[0]&&(i["continuePropagation/false: "+this.continuePropagation[0].debugName()]=this.continuePropagation[0].explain(getATDBIAttr(e,"continuePropagation"))),void 0!==this.continuePropagation[1]&&(i["continuePropagation/true: "+this.continuePropagation[1].debugName()]=this.continuePropagation[1].explain(getATDBIAttr(e,"continuePropagation"))),void 0!==this.whenBecomesTrue){i.true={},t=getATDBIAttr(e,"true");for(var r in this.whenBecomesTrue)i.true[r]=this.whenBecomesTrue[r].explain(getATDBIAttr(t,r))}if(void 0!==this.whenBecomesFalse){i.false={},t=getATDBIAttr(e,"false");for(var r in this.whenBecomesFalse)i.false[r]=this.whenBecomesFalse[r].explain(getATDBIAttr(t,r))}return i},e.prototype.defer=function(){throw"Should not be called"},e.prototype.undefer=function(){throw"Should not be called"},e.prototype.isDeferred=function(){return!1},e.prototype.getDebugOrigin=function(){return["child controller "+this.name]},e}(),debugAreaConstruction=!1,AreaPositionTree=function(){function e(e,t,i,r,n){void 0!==t&&(this.id=e,this.embedding=n,this.embedded=[],"left"in i?(this.left=t.left+i.left,this.top=t.top+i.top,this.width=t.width-i.left-i.right,this.height=t.height-i.top-i.bottom):(this.top=t.top,this.left=t.left,this.width=t.width,this.height=t.height),void 0!==n&&(this.top+=n.top,this.left+=n.left),this.z=r),void 0!==dbgCreateList&&dbgCreateList.push({cls:"AreaPositionTree",id:this.id})}return e.prototype.getOverlappingAreas=function(){},e.prototype.overlaps=function(e){return this.left+this.width>e.left&&e.left+e.width>this.left&&this.top+this.height>e.top&&e.top+e.height>this.top},e.prototype.contains=function(e){return this.left<=e.left&&e.left+e.width<=this.left+this.width&&this.top<=e.top&&e.top+e.height<=this.top+this.height},e}(),areaChangeCounter=0,CoreArea=function(){function e(t,i,r,n,o,s,a,d,u){if(void 0===o&&(o=void 0),void 0===s&&(s=void 0),void 0===a&&(a=void 0),void 0===d&&(d=void 0),void 0===u&&(u=void 0),this.children={},this.exports=void 0,this.localToDefun=0,this.dataSourceAware=!1,this.dataElementId=void 0,this.setIndices=r,this.makeAreaId(t,i,n,u),this.tAreaId=String(t.id)+":"+r.join("."),this.areaReference=new ElementReference(this.areaId),this.seqId=e.nextSeqAreaId++,this.template=t,this.controller=i,this.watcherId=getNextWatcherId(),this.evaluationNodes=[new Array(t.functionNodes.length)],this.result=new Result([this.areaReference]),void 0!==this.template.exports){this.exports={};for(var h in this.template.exports)this.exports[h]=void 0}if(gProfile&&(this.totalUpdateInputTime=0,this.attributedTime=0),void 0!==o&&(this.param={attr:o.value,data:s,source:a,position:d}),t.embeddingInReferred?(assert(void 0!==u,"should not happen"),this.embedding=u,u.addEmbeddedReferred(this)):this.embedding=void 0!==i?i.parent:void 0,areaRelationMonitor.addArea(this.areaId),allAreaMonitor.addArea(this),u){var l=i.parent;this.setIntersectionParents(l,u,i.name)}debugAreaConstruction&&gSimpleLog.log("create","@"+this.areaId,this.tAreaId),void 0!==gDomEvent&&gDomEvent.recordComment("create @"+this.areaId+" "+this.tAreaId),areaChangeCounter++}return e.instantiate=function(e,t,i){var r,n=e.isDisplayArea!==!1?new DisplayArea(e,t,i,void 0):new CalculationArea(e,t,i,void 0);return gProfile&&(r=performance.now()),n.finishInstantiation(),gProfile&&(n.attributedTime+=performance.now()-r),n},e.prototype.destroy=function(){var e=this.embedding;debugAreaConstruction&&gSimpleLog.log("destroy","@"+this.areaId,this.tAreaId),gDomEvent.recordComment("destroy @"+this.areaId+" "+this.tAreaId),this.template.embeddingInReferred&&e.removeEmbeddedReferred(this);for(var t in this.children)this.children[t].destroy(),delete this.children[t];void 0!==this.intersectionChain&&this.removeIntersection();for(var t in this.children)this.children[t].destroy(),delete this.children[t];this.areaReference=void 0,this.result=void 0,this.informWatchers(),this.removeWatchers(),allAreaMonitor.removeArea(this),areaOverlapMonitor.removeArea(this.areaId),this.removeRelations(),areaChangeCounter++},e.prototype.finishInstantiation=function(){this.addWatchers(),this.addRelations(),this.instantiateChildren()},e.prototype.link=function(){return this},e.prototype.unlink=function(){},e.prototype.makeAreaId=function(e,t,i,r){var n,o=void 0===t?void 0:t.parent,s=void 0;if(void 0===o)return this.persistentTemplateId=gPaidMgr.getScreenAreaTemplateId(),this.persistentIndexId=gPaidMgr.getScreenAreaIndexId(),void(this.areaId=gPaidMgr.getScreenAreaId());void 0!==i?(n="set",s=String(i)):n=void 0!==r?"intersection":"single";var a=e.childName;this.persistentTemplateId=gPaidMgr.getTemplateId(o,n,a,r),this.persistentIndexId=gPaidMgr.getIndexId(o,n,s,r),this.areaId=gPaidMgr.getAreaId(this.persistentTemplateId,this.persistentIndexId)},e.prototype.getParent=function(){return void 0===this.controller?void 0:this.controller.parent},e.prototype.getParentWithTemplateId=function(e){return this.parentsByTemplateId[e]},e.prototype.getEmbedding=function(){return this.embedding},e.prototype.getPathFromScreenArea=function(){for(var e=this,t=[];void 0!==e.controller;)t.push(e.template.childName),e=e.controller.parent;return t.reverse()},e.prototype.getRelation=function(e){throw new Error("Should not be called")},e.prototype.isAreaSetMember=function(){return void 0!==this.param},e.prototype.isIntersection=function(){return void 0!==this.intersectionChain},e.prototype.getIntersectionChain=function(){return this.intersectionChain},e.prototype.setIntersectionParents=function(e,t,i){this.intersectionChain=new IntersectionChain(e,t,i),areaRelationMonitor.addRelation(this.areaId,"expressionOf",[e.areaReference]),areaRelationMonitor.addRelation(this.areaId,"referredOf",[t.areaReference]),areaRelationMonitor.addRelation(this.areaId,"intersectionParentOf",[e.areaReference,t.areaReference])},e.prototype.getIntersectionParents=function(){return void 0===this.intersectionChain?void 0:[this.intersectionChain.expressionArea.areaReference,this.intersectionChain.referredArea.areaReference]},e.prototype.getExpressionParent=function(){return void 0===this.intersectionChain?void 0:this.intersectionChain.expressionArea.areaReference},e.prototype.getReferredParent=function(){return void 0===this.intersectionChain?void 0:this.intersectionChain.referredArea.areaReference},e.prototype.removeIntersection=function(){areaRelationMonitor.removeRelation(this.areaId,"expressionOf"),areaRelationMonitor.removeRelation(this.areaId,"referredOf"),areaRelationMonitor.removeRelation(this.areaId,"intersectionParentOf"),this.intersectionChain=void 0},e.prototype.initWatchers=function(){var e=this.evaluationNodes[0],t={pointerInArea:[!1],dragInArea:[!1]};if(void 0===e[0]){var i=getEvaluationNode(this.template.functionNodes[areaParamIndex],this);void 0!==this.param&&(t.areaSetAttr=this.param.attr,t.areaSetContent=this.param.data.value,i.setSource(this.param.source,this.param.position),i.set(new Result([t])))}},e.prototype.addWatchers=function(){if(this.initWatchers(),void 0!==this.template.positionFunctions){this.position={};for(var e in this.template.positionFunctions){var t=getEvaluationNode(this.template.positionFunctions[e],this);this.position[e]=t,t.isConstant()?this.setPosition(e,t.result.value):t.addWatcher(this,["position",e],!0,!0,!1)}}if(void 0!==this.template.writeFunctions){this.writes={};for(var e in this.template.writeFunctions)this.writes[e]=buildWriteTriggerNode(this.template.writeFunctions[e],this,"@"+this.areaId+":"+e)}},e.prototype.removeWatchers=function(){void 0!==this.exports&&void 0!==this.exports[0]&&this.exports[0].removeWatcher(this,!1,!1);for(var e in this.template.writeFunctions)this.writes[e].destroy();if(void 0!==this.position)for(var e in this.position)this.position[e].removeWatcher(this,!0,!1);for(var t=this.evaluationNodes[0],i=t.length-1;i>=0;i--){var r=t[i];void 0!==r&&r.destroy()}t.length=0,this.evaluationNodes.length=0,this.evaluationNodes=void 0},e.prototype.hasBeenDestroyed=function(){return void 0===this.result},e.prototype.cleanUpUnusedEvaluationNodes=function(){var e=this.evaluationNodes[0],t=0;for(var i in this.children)t+=this.children[i].cleanUpUnusedEvaluationNodes();for(var r=e.length-1;r>areaParamIndex;r--){var n=e[r];void 0===n||n.isConstant()||(void 0!==n.watchers&&0===n.watchers.size?(n.destroy(),e[r]=void 0,t++):(n instanceof EvaluationVariant||n instanceof EvaluationVariant1||n instanceof EvaluationBoolGate||n instanceof EvaluationCond)&&n.removeWatcherFromInactiveNodes())}return t},e.prototype.cleanUpRemovedExportNodes=function(){for(var e in this.children)this.children[e].cleanUpRemovedExportNodes();for(var t in this.exports){var i=this.exports[t];void 0!==i&&void 0===i.watchers&&(this.exports[t]=void 0)}},e.prototype.addRelations=function(){if(void 0!==this.controller){areaRelationMonitor.addRelation(this.areaId,"embedding",[this.embedding.areaReference]),areaRelationMonitor.addMultiRelation(this.embedding.areaId,"embedded",this.areaId,this.areaReference);for(var e=this.embedding;void 0!==e;)areaRelationMonitor.addMultiRelation(this.areaId,"embeddingStar",e.areaId,e.areaReference),areaRelationMonitor.addMultiRelation(e.areaId,"embeddedStar",this.areaId,this.areaReference),e=e.embedding}},e.prototype.removeRelations=function(){if(void 0!==this.controller){areaRelationMonitor.removeRelation(this.areaId,"embedding"),areaRelationMonitor.removeMultiRelation(this.embedding.areaId,"embedded",this.areaId);for(var e=this.embedding;void 0!==e;)areaRelationMonitor.removeMultiRelation(this.areaId,"embeddingStar",e.areaId),areaRelationMonitor.removeMultiRelation(e.areaId,"embeddedStar",this.areaId),e=e.embedding}areaRelationMonitor.removeArea(this.areaId)},e.prototype.getExport=function(e){return e in this.template.exports&&void 0===this.exports[e]&&(this.exports[e]=getEvaluationNode(this.template.exports[e],this)),this.exports[e]},e.prototype.updateInput=function(e,t){switch(e[0]){case"position":this.setPosition(e[1],t.value);break;case"stacking":this.setStacking(e[1],t.value);break;default:Utilities.error("area "+this.areaId+"; unknown update position: "+e)}},e.prototype.isActive=function(){return!0},e.prototype.isReady=function(){return!0},e.prototype.updateParam=function(e,t){var i=this.evaluationNodes[0][areaParamIndex],r=void 0!==i.latchedValue?i.latchedValue.value[0]:i.lastUpdate.value[0];if("dataSource"in i.result){var n=this.controller;n.updateAreaDataSourcePathValue(this.dataElementId,e,getDeOSedValue(t))}else if(void 0===r||!valueEqual(r[e],t)){var o=void 0!==r?shallowCopyMinus(r,e):{};o[e]=t,i.latchedValue=new Result([o]),i.latch(),globalCommitWritesTask.schedule()}},e.prototype.getOwnId=function(){return this.areaId},e.prototype.getTemplate=function(){return this.template},e.prototype.getTemplateId=function(){return this.template.id},e.prototype.getEmbeddingDepth=function(){for(var e=0,t=this.embedding;void 0!==t;)e++,t=t.embedding;return e},e.prototype.addChildAreaWatcher=function(e,t,i,r){if(!r&&e in this.children)this.children[e].addWatcher(t,i);else{void 0===this.childAreaWatchers&&(this.childAreaWatchers={}),e in this.childAreaWatchers||(this.childAreaWatchers[e]=new Map);var n=this.childAreaWatchers[e];n.has(t.watcherId)?n.get(t.watcherId).pos.push(i):n.set(t.watcherId,{watcher:t,pos:[i]})}},e.prototype.getChildAreas=function(e){return e in this.children?this.children[e].result:void 0},e.prototype.removeChildAreaWatcher=function(e,t){e in this.children?this.children[e].removeWatcher(t,!1):void 0!==this.childAreaWatchers&&this.childAreaWatchers[e].delete(t.watcherId)},e.prototype.updateDisplay=function(){},e.prototype.updateVisuals=function(){},e.prototype.wrapupUpdateVisuals=function(){},e.prototype.hasNoPosition=function(){return!1},e.prototype.getAbsPreviousPosition=function(){},e.prototype.interpolatePreviousPosition=function(){},e.prototype.setZIndex=function(e,t){assert(!1,"not applicable")},e.prototype.getFrameDiv=function(){assert(!1,"not applicable")},e.prototype.getZArea=function(){},e.prototype.getZAreaRep=function(){},e.prototype.updateSetData=function(e,t){var i=this.evaluationNodes[0][areaParamIndex],r=void 0!==i.lastUpdate.value?i.lastUpdate.value[0]:void 0,n=void 0!==r?shallowCopy(r):{},o=!1;if(void 0===this.param?(o=!0,this.param={attr:e,data:t,source:void 0,position:void 0},n.areaSetAttr=e,n.areaSetContent=t.value):(valueEqual(this.param.attr,e)||(o=!0,this.param.attr=e,n.areaSetAttr=e),t.equal(this.param.data)||(o=!0,this.param.data=t,n.areaSetContent=t.value)),i.isLatched&&o){var s=i.latchedValue.value[0];s.areaSetAttr=e,s.areaSetContent=t.value}o&&i.set(new Result([n]))},e.prototype.updateSetPosition=function(e,t){var i=this.evaluationNodes[0][areaParamIndex];this.param.position=t,i.setSource(e,t)},e.prototype.addSetDataSameId=function(e){var t=this.evaluationNodes[0][areaParamIndex];t.pushToAreaSetContent(e)},e.prototype.getAreaParam=function(){return this.evaluationNodes[0][areaParamIndex].result},e.prototype.setAreaParam=function(e,t){var i=this.evaluationNodes[0][areaParamIndex];this.dataElementId=t,void 0===this.param&&(this.param={attr:void 0,data:void 0,source:void 0,position:void 0}),this.param.attr=t,this.param.data=void 0,i.set(e)},e.prototype.updateDataElementID=function(e){var t=this.evaluationNodes[0][areaParamIndex];t.updateDataElementIds([e]),this.dataElementId=e},e.prototype.getDataElementId=function(){return this.dataElementId},e.prototype.getAreaId=function(){return this.areaId},e.prototype.getPersistentTemplateId=function(){return this.persistentTemplateId},e.prototype.getPersistentIndexId=function(){return this.persistentIndexId},e.prototype.getChildName=function(){return this.template.childName},e.prototype.setComment=function(e){this.comment=e},e.prototype.instantiateChildren=function(){for(var e in this.template.children){var t=this.template.children[e];void 0===this.children&&(this.children={}),void 0!==this.template.setFunctions&&e in this.template.setFunctions?this.children[e]=new SetChildController(e,t,this,this.setIndices,t.existenceQualifiers):this.children[e]=new StaticChildController(this,e,t,this.setIndices,t.existenceQualifiers),void 0!==this.childAreaWatchers&&e in this.childAreaWatchers&&(this.children[e].setWatchers(this.childAreaWatchers[e]),delete this.childAreaWatchers[e])}},e.prototype.getEmbeddedAreaList=function(){return areaRelationMonitor.getRelation(this.areaId,"embedded").map(function(e){return allAreaMonitor.getAreaById(e.getElement())})},e.prototype.explain=function(e){var t,i={},r="undefined"==typeof areaDebugInfo?void 0:areaDebugInfo[this.template.id];EvaluationNode.resetExplainFunctionNodes(),this.getInheritExplanation(i),void 0!==this.exports&&0 in this.exports&&(void 0===this.exports[0]&&this.getExport(0),i.classes=this.explainClasses());for(var n in this.children){var o=this.children[n];void 0===i.children&&(i.children={}),i.children[n]=o.explain()}if(void 0!==this.position){i.position={},t=getATDBIAttr(r,"position");for(var s in this.position)i.position[s+": "+this.position[s].debugName()]=this.position[s].explain(getATDBIAttr(t,s))}if(void 0!==this.exports){i.exports={};for(var a in this.exports)if(void 0!==this.exports[a]){var d="0"===a?"class membership":exportPaths[a].join(".");i.exports[a+": "+d+"="+this.exports[a].debugName()]=this.exports[a].explain(void 0)}else i.exports[a]="<<unwatched>>"}if(i.param=stripArray(this.evaluationNodes[0][areaParamIndex].result.value,!0),this.template.id in debugAreaInfo){var u=debugAreaInfo[this.template.id].context;i.context={},t=getATDBIAttr(r,"context");for(var h in u){var l=u[h];if(l.index!==-1){var c=this.getExprByFNRef(l,e);if(void 0===c)i.context[h]=void 0;else{var p=getATDBIAttr(t,h),f=c.explain(p);if(i.context[h+" = "+c.debugName()]=f,"_definedIn"in f){var v=p.values,g=void 0===v||0===v.length?void 0:allValuesIdentical(v.map(getDeepestDefiningClass))?getDeepestDefiningClass(v[0]):"_mixed";if(void 0===g)g="<<unknown>>";else{var m=g.search("::");m>=0&&(g=g.slice(m+2))}void 0===i.classes&&(i.classes={}),g in i.classes||(i.classes[g]={membership:"<<unknown>>"}),"context"in i.classes[g]||(i.classes[g].context={}),i.classes[g].context[h+" = "+c.debugName()]=f}}}}if(void 0!==debugAreaInfo[this.template.id].content){var l=debugAreaInfo[this.template.id].content;if(l.index!==-1){var c=this.getExprByFNRef(l,e);void 0===c?i.content=void 0:i["content = "+c.debugName()]=c.explain(getATDBIAttr(r,"content"))}}}return i},e.prototype.explainClasses=function(){var e=this.exports[0];if(void 0!==e){var t={};for(var i in e.inputByAttr)t[i]={membership:e.inputByAttr[i].explain(void 0)};return t}},e.prototype.getExprByFNRef=function(e,t,i){void 0===i&&(i=t);var r;if(void 0===e.level)r=globalEvaluationNodes[e.index];else{for(var n=this,o=0;o<e.level;o++)n=n.getParent();r=n.evaluationNodes[0][e.index]}if(void 0===r&&t&&(r=getEvaluationNode(this.getFNByFNRef(e),this)),void 0!==r&&!r.isActive()&&i){try{r.forceActive(this,!0)||console.log("node not evaluated on time:",r.prototype.idStr())}catch(e){if(Utilities.warn(e.toString()),g_noTryAndCatchUpdate)throw e}r.deactivate(this,!0)}return r},e.prototype.getFNByFNRef=function(e){if(void 0===e.level)return FunctionNode.globalFunctionNodes[e.index];for(var t=this.template,i=0;i<e.level;i++)t=t.parent;return t.functionNodes[e.index]},e.prototype.storeExprByFNRef=function(e,t){if(void 0===e.level)globalEvaluationNodes[e.index]=t;else{for(var i=this,r=0;r<e.level;r++)i=i.getParent();i.evaluationNodes[0][e.index]=t}},e.prototype.debugAddContext=function(e,t){function i(e){return void 0===e?void 0:void 0===e.result?"<<removed>>":"dataSource"in e.result?e.result.dataSource.extractDataComplex(void 0,!1):stripArray(e.result.value)}if(this.template.id in debugAreaInfo){var r=debugAreaInfo[this.template.id].context;e.context={};for(var n in r){var o=r[n];if(o.index!==-1){var s=this.getExprByFNRef(o,t);e.context[n]=i(s)}}if(void 0!==debugAreaInfo[this.template.id].content){var o=debugAreaInfo[this.template.id].content;if(o.index!==-1){var s=this.getExprByFNRef(o,t);e.content=i(s)}}}},e.prototype.debugGetContextLabelValue=function(e){if(this.template.id in debugAreaInfo){var t=debugAreaInfo[this.template.id].context;if(e in t){var i=t[e];if(i.index!==-1){var r=this.getExprByFNRef(i,!0);return void 0===r?void 0:void 0===r.result?"<removed>":0===r.nrActiveWatchers?{inactive:stripArray(r.result.value)}:stripArray(r.result.value)}}}return"<unknown>"},e.prototype.debugGetLocalEvaluationNode=function(e){var t=this.evaluationNodes[0][e];return void 0===t?"<out of range>":stripArray(t.result.value)},e.prototype.debugGetExport=function(e){var t=this.exports[e];return void 0===t?"<<unwatched>>":stripArray(t.result.value)},e.prototype.getInheritExplanation=function(e){var t="undefined"==typeof areaDebugInfo?void 0:areaDebugInfo[this.template.id];if(void 0!==t&&"inherit"in t){var i=this.template,r=this.getExport(0),n=Object.keys(r.inputByAttr).sort(function(e,t){return i.classNamePrio[e]-i.classNamePrio[t]});e.inherit={};for(var o=0;o<n.length;o++){var s=n[o];e.inherit[s]=t.inherit[s].map(getClassPath)}}return e},e.prototype.getZ=function(){},e.prototype.getPositionTree=function(e){for(var t=new AreaPositionTree(this.areaId,this.getPos(),this.getOffsets(),this.getZ(),e),i=this.getEmbeddedAreaList(),r=0;r!==i.length;r++)t.embedded.push(i[r].getPositionTree(t));return t},e.prototype.isOpaque=function(){return!0},e.prototype.isDeferred=function(){return!1},e.prototype.defer=function(){throw"Should not be called"},e.prototype.undefer=function(){throw"Should not be called"},e.prototype.getEvaluationArea=function(){return this},e.prototype.addWatcher=function(e,t,i,r,n){"watchers"in this||(this.watchers=new Map),this.watchers.has(e.watcherId)?this.watchers.get(e.watcherId).pos.push(t):this.watchers.set(e.watcherId,{watcher:e,pos:[t]})},e.prototype.removeWatcher=function(e,t){this.watchers.delete(e.watcherId)},e.prototype.removeWatcherForPos=function(e,t,i,r){var n=this.watchers.get(e.watcherId),o=n.pos.indexOf(t);o>=0&&(1===n.pos.length?this.removeWatcher(e,i):n.pos.splice(o,1))},e.prototype.markAsChanged=function(){},e.prototype.informWatchers=function(){var e=this;"watchers"in this&&this.watchers.forEach(function(t,i){for(var r=0;r!==t.pos.length;r++)t.watcher.updateInput(t.pos[r],e.result)})},e.prototype.getDebugAttributeFor=function(e){var t=this.template.id,i=void 0;if(t in debugAreaInfo){var r=debugAreaInfo[t].context;for(var n in r){var o=r[n];o.index!==-1&&this.getExprByFNRef(o,!1)===e&&(void 0===i?i=[n]:i.push(n))}}return i},e.prototype.debugName=function(){return"area("+this.areaId+")"},e.prototype.isValid=function(){return!this.hasBeenDestroyed()},e.prototype.getSource=function(e){},e.prototype.releaseDataSourceInput=function(e){var t=this.evaluationNodes[0][areaParamIndex],i=t.result;if("dataSource"in i){var r=i.dataSource;r.removeResultReceiver(e),delete i.dataSource,void 0!==this.param&&(this.param.attr=void 0,this.param.data=void 0),t.set(void 0)}},e.prototype.getDebugOrigin=function(){return["area "+this.areaId]},e.prototype.getEmbeddingPositionTree=function(){return void 0===this.embedding?void 0:this.embedding.getEmbeddingPositionTree()},e}();CoreArea.nextSeqAreaId=1;var CalculationArea=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.addEmbeddedReferred=function(e){throw new Error("Should not be called.")},t.prototype.removeEmbeddedReferred=function(e){throw new Error("Should not be called.")},t.prototype.setPosition=function(e,t){throw new Error("Should not be called.")},t.prototype.setStacking=function(e,t){throw new Error("Should not be called.")},t.prototype.setIndependentContentPosition=function(e){throw new Error("Should not be called.")},t.prototype.setPropagatePointerInArea=function(e){},t.prototype.canReceiveFocus=function(){return!1},t.prototype.canLoseFocus=function(){return!0},t.prototype.takeFocus=function(){},t.prototype.releaseFocus=function(){},t.prototype.willHandleClick=function(){return!1},t.prototype.updateParamInput=function(e,t,i){},t.prototype.setInputState=function(e,t){throw new Error("Should not be called.")},t.prototype.getPos=function(){throw new Error("Should not be called.")},t.prototype.getOffsets=function(){throw new Error("Should not be called.")},t}(CoreArea),gDontSetPosition=!1,DisplayArea=function(e){function t(t,i,r,n,o,s,a,d,u){void 0===o&&(o=void 0),void 0===s&&(s=void 0),void 0===a&&(a=void 0),void 0===d&&(d=void 0),void 0===u&&(u=void 0);var h=e.call(this,t,i,r,n,o,s,a,d,u)||this;return h.relative=new Relative,h.previousPosition=new Rect,h.initDisplayConfigValue=void 0,h.visualUpdates=void 0,h.initializing=!0,h.areaRegisteredToAbsolutePosManager=!1,h.debugTransitionSource=void 0,h.dependentConstraints={},h.zArea=void 0,h.relative.embedding=void 0===h.embedding?null:h.embedding,h.contentPosManager=new ContentPosManager(h),h.allPosConstraints=new AllPosConstraints(h),h.createDisplay(),h}return __extends(t,e),t.prototype.createDisplay=function(){assert(void 0===this.display,"should not create display twice"),this.display=new Display(this),embedAreaFrameElementAtPos(this,this.relative,!0),this.contentPosManager.registerAllModeChange("display",0,this.display,void 0),void 0!==dbgCreateList&&dbgCreateList.push({cls:"DisplayArea",id:this.areaId})},t.prototype.destroy=function(){for(var t in this.isReferredOf)for(var i in this.isReferredOf[t])this.isReferredOf[t][i].removeIntersectionPartner(this);for(var r in this.embeddedReferred){var n=this.embeddedReferred[r].controller;n.removeIntersectionPartner(this)}void 0!==this.foreignDisplay&&this.setForeignInterface(void 0,!0),this.contentPosManager.unregisterAllModeChange("display",0),this.allPosConstraints.destroy(),globalGeometryTask.schedule(),gZIndex.removeArea(this),this.zArea=void 0,this.removeDisplay(),this.setRenderingForeignDisplay(void 0,!0),e.prototype.destroy.call(this)},t.prototype.removeDisplay=function(){if(void 0!==this.display){var e=this.embedding;this.contentPosManager.unregisterAllModeChange("display",0),this.areaRegisteredToAbsolutePosManager=!1,globalAbsolutePosManager.removeArea(this,e),this.display.destroy(),this.display=void 0,this.visualUpdates=void 0}},t.prototype.updateInput=function(t,i){switch(t[0]){case"display":void 0!==this.renderingForeignDisplay?(this.renderingForeignDisplay.addChildArea(this.areaId,i,this.controller),allAreaMonitor.requestVisualUpdate(this)):this.setDisplay(i.value);break;case"independentContentPosition":this.setIndependentContentPosition(i.value);break;case"propagatePointerInArea":this.setPropagatePointerInArea(i.value);break;case"foreign":this.setForeignInterface(i,!1);break;default:e.prototype.updateInput.call(this,t,i)}},t.prototype.setDisplay=function(e){logValues&&void 0===logPrototypes&&gSimpleLog.log("area",this.areaId,"display =",JSON.stringify(e)),e instanceof Array&&(e=stripArray(e,!0)),void 0===e&&(e=constEmptyObject),void 0===this.visualUpdates?(allAreaMonitor.requestVisualUpdate(this),this.visualUpdates={display:e,position:void 0,frameZ:void 0,displayZ:void 0},"initDisplayConfigValue"in this?this.initDisplayConfigValue=e:this.registerContentOffsets(e,!1)):this.visualUpdates.display=e,"transitions"in e&&allAreaMonitor.requestVisualUpdate(this),this.paramInputDefined()?"text"in e&&"input"in e.text||this.updateParamInput(void 0,!1,!1):"text"in e&&"input"in e.text&&this.updateParamInput({value:e.text.value},!1,!1)},t.prototype.setForeignInterface=function(e,i){var r=void 0===e||isEmptyOS(e.value)&&void 0===e.foreignInterfaceSource?void 0:e.foreignInterfaceSource;if(void 0===r&&void 0===this.intersectionChain&&!i&&this.embedding instanceof t&&void 0!==this.embedding.foreignDisplay)return void this.setRenderingForeignDisplay(this.embedding.foreignDisplay,!1);if(void 0!==this.renderingForeignDisplay&&this.setRenderingForeignDisplay(void 0,i),r!==this.foreignDisplay&&void 0!==this.display.displayElement)if(void 0!==this.foreignDisplay&&(this.foreignDisplay.releaseDiv(),
this.display.setForeignElement(void 0)),this.foreignDisplay=r,void 0!==this.foreignDisplay){var n=this.foreignDisplay.setDiv(this,this.display.displayElement.content);this.display.setForeignElement(n),this.display.setShowEmbedding(r.allowsEmbedding())}else this.display.setShowEmbedding(!0)},t.prototype.setRenderingForeignDisplay=function(e,t){return void 0===e?void(void 0!==this.renderingForeignDisplay&&(this.renderingForeignDisplay.removeChildArea(this.areaId,this.controller),this.renderingForeignDisplay=void 0,t||this.createDisplay())):(this.removeDisplay(),void(e!==this.renderingForeignDisplay&&(void 0!==this.renderingForeignDisplay&&this.renderingForeignDisplay.removeChildArea(this.areaId,this.controller),this.renderingForeignDisplay=e,this.displayEvaluationNode.isConstant()?e.addChildArea(this.areaId,this.displayEvaluationNode.result,this.controller):this.displayEvaluationNode.forceUpdate(this,!1))))},t.prototype.updatePos=function(){void 0===this.visualUpdates?(allAreaMonitor.requestVisualUpdate(this),this.visualUpdates={display:void 0,position:!0,frameZ:void 0,displayZ:void 0}):this.visualUpdates.position=!0},t.prototype.updateDisplay=function(){if(void 0!==this.visualUpdates&&void 0!==this.visualUpdates.display){var e=void 0===this.display.displayElement;this.display.configurationUpdate(this.visualUpdates.display,!1,!1),e&&void 0!==this.foreignInterfaceEvaluationNode&&this.setForeignInterface(this.foreignInterfaceEvaluationNode.result,!1)}},t.prototype.updateVisuals=function(){if(void 0!==this.visualUpdates){if(void 0!==this.visualUpdates.display&&(this.display.configurationUpdate(this.visualUpdates.display,!0,!this.initializing),!this.initializing)){var e=this.display.getTransitions();void 0!==e&&this.copyTransitionsToReferredIntersections(e,this.areaReference)}void 0!==this.display&&void 0!==this.visualUpdates.position&&(void 0!==this.contentPos?this.display.updatePos(this.contentPos,this.displayDivPos):this.display.updateZeroOffsetPos(this.relative),this.display.refreshPos(),embedAreaFrameElementAtPos(this,this.relative)),void 0===this.display||void 0===this.visualUpdates.frameZ&&void 0===this.visualUpdates.displayZ||this.display.setZIndex(this.visualUpdates.frameZ,this.visualUpdates.displayZ),this.visualUpdates=void 0}},t.prototype.wrapupUpdateVisuals=function(){if(void 0!==this.display){if(this.initializing){var e=this.display.getTransitions(),t=!0;void 0===e&&this.template.embeddingInReferred&&(e=this.getTransitionsFromParent(),t=!1),void 0!==e&&(t&&delete this.debugTransitionSource,this.display.applyTransitionProperties(e),this.copyTransitionsToReferredIntersections(e,this.areaReference)),this.initializing=!1}this.foreignDisplay&&this.foreignDisplay.wrapUpVisuals(),this.updatePreviousPosition()}},t.prototype.getTransitionsFromParent=function(){for(var e=this.controller;void 0!==e;){var i=e.parent;if(i instanceof t){var r=i.display.getTransitions();if(void 0!==r)return this.debugTransitionSource=i.areaReference,r}e=i.controller}},t.prototype.copyTransitionsToReferredIntersections=function(e,t){for(var i in this.children)this.children[i].copyTransitionsToReferredIntersections(e,t)},t.prototype.setPosition=function(e,t){var i;if(!gDontSetPosition)if(logValues&&void 0===logPrototypes&&gSimpleLog.log("area",this.areaId,void 0===t||t instanceof Array&&0===t.length?"delete":"_"+e in this.allPosConstraints.constraints?"modify":"add","position."+e+" =",JSON.stringify(t)),void 0===t||t instanceof Array&&0===t.length)if(e in this.dependentConstraints){i=this.dependentConstraints[e];for(var r=0;r!==i.length;r++)this.allPosConstraints.removeConstraintInnerName(i[r]);delete this.dependentConstraints[e]}else this.allPosConstraints.removeConstraintInnerName(e);else{var n=stripArray(t),o={},s=this.translateShorthand(o,e,n)&&void 0!==this.controller;if(t instanceof Array&&1!==t.length&&Utilities.error("one name, one positioning constraint: "+e),e in this.dependentConstraints){i=this.dependentConstraints[e];for(var r=0;r!==i.length;r++){var a=i[r];a in o||this.allPosConstraints.removeConstraintInnerName(a)}s||delete this.dependentConstraints[e]}if(s){i=this.dependentConstraints[e]=[];for(var d in o)this.allPosConstraints.addNewConstraint(d,o),i.push(d)}else e in o&&this.allPosConstraints.addNewConstraint(e,o)}},t.prototype.setStacking=function(e,t){var i=t instanceof Array?t[0]:t;logValues&&void 0===logPrototypes&&gSimpleLog.log("area",this.areaId,"stacking."+e+" =",JSON.stringify(t)),t instanceof Array&&1!==t.length&&Utilities.error("one name, one stacking constraint: "+e),void 0===i?this.zArea.removeConstraint(e):(this.zArea.addConstraint(e,i),this.zArea.updateConstraint(e,this.areaId))},t.prototype.makeAreaSetRepr=function(e){var t;return void 0!==this.controller&&(void 0===this.controller.areaSetStackable&&this.controller.makeAreaSetRepr(e),t=this.controller.areaSetStackable),void 0!==t?(t.addSetMember(this,e),t):this},t.prototype.removeAreaSetRepr=function(){void 0!==this.controller&&void 0!==this.controller.areaSetStackable&&this.controller.areaSetStackable.removeSetMember(this)},t.prototype.setIndependentContentPosition=function(e){this.contentPosManager.independentContentPositionHandler(isTrueValue(e))},t.prototype.setPropagatePointerInArea=function(e){if(void 0===e)this.propagatePointerInArea=void 0;else{e=ensureOS(e),this.propagatePointerInArea={};for(var t=0;t<e.length;t++)"string"==typeof e[t]?this.propagatePointerInArea[e[t]]=!0:e[t]instanceof ElementReference&&(this.propagatePointerInArea[e[t].getElement()]=!0)}},t.prototype.addWatchers=function(){var t=this.embedding;if(e.prototype.addWatchers.call(this),void 0!==this.template.displayFunction&&(this.displayEvaluationNode=getEvaluationNode(this.template.displayFunction,this),this.setDisplay(this.displayEvaluationNode.result.value),this.displayEvaluationNode.addWatcher(this,["display"],!0,!0,!1)),void 0!==this.template.foreignInterfaceDisplayFunction&&(this.foreignInterfaceEvaluationNode=getEvaluationNode(this.template.foreignInterfaceDisplayFunction,this),this.setForeignInterface(this.foreignInterfaceEvaluationNode.result,!1),this.foreignInterfaceEvaluationNode.addWatcher(this,["foreign"],!0,!0,!1)),void 0!==this.template.independentContentPosition&&(this.independentContentPosition=getEvaluationNode(this.template.independentContentPosition,this),this.setIndependentContentPosition(this.independentContentPosition.result.value),this.independentContentPosition.addWatcher(this,["independentContentPosition"],!0,!0,!1)),"propagatePointerInArea"in this.template&&(this.propagatePointerInAreaNode=getEvaluationNode(this.template.propagatePointerInArea,this),this.setPropagatePointerInArea(this.propagatePointerInAreaNode.result.value),this.propagatePointerInAreaNode.addWatcher(this,["propagatePointerInArea"],!0,!0,!1)),this.areaRegisteredToAbsolutePosManager=!0,globalAbsolutePosManager.addArea(this,t),this.zArea=gZIndex.addArea(this,t),void 0!==this.initDisplayConfigValue&&this.registerContentOffsets(this.initDisplayConfigValue,!1),delete this.initDisplayConfigValue,void 0!==this.template.stackingFunctions){this.stacking={};for(var i in this.template.stackingFunctions){var r=getEvaluationNode(this.template.stackingFunctions[i],this);r.isConstant()?this.setStacking(i,r.result.value):r.addWatcher(this,["stacking",i],!0,!0,!1),this.stacking[i]=r}}},t.prototype.removeWatchers=function(){if(void 0!==this.displayEvaluationNode&&this.displayEvaluationNode.removeWatcher(this,!0,!1),void 0!==this.stacking)for(var t in this.stacking)this.stacking[t].removeWatcher(this,!0,!1),void 0!==this.zArea&&this.zArea.removeConstraint(t);void 0!==this.independentContentPosition&&this.independentContentPosition.removeWatcher(this,!0,!1),void 0!==this.propagatePointerInAreaNode&&this.propagatePointerInAreaNode.removeWatcher(this,!0,!1),void 0!==this.foreignInterfaceEvaluationNode&&this.foreignInterfaceEvaluationNode.removeWatcher(this,!0,!1),e.prototype.removeWatchers.call(this)},t.prototype.addIsReferredOf=function(e){var t=e.parent.areaId;"isReferredOf"in this||(this.isReferredOf={}),t in this.isReferredOf||(this.isReferredOf[t]={}),assert(!(e.name in this.isReferredOf[t]),"check"),this.isReferredOf[t][e.name]=e},t.prototype.removeIsReferredOf=function(e){var t=e.parent.areaId;assert(t in this.isReferredOf&&e.name in this.isReferredOf[t],"check"),delete this.isReferredOf[t][e.name]},t.prototype.updateSetPosition=function(e,t){var i=this.evaluationNodes[0][areaParamIndex];this.param.position=t,i.setSource(e,t)},t.prototype.addEmbeddedReferred=function(e){void 0===this.embeddedReferred&&(this.embeddedReferred={}),assert(!(e.areaId in this.embeddedReferred),"added twice?"),this.embeddedReferred[e.areaId]=e},t.prototype.removeEmbeddedReferred=function(e){assert(e.areaId in this.embeddedReferred,"removed twice?"),delete this.embeddedReferred[e.areaId]},t.prototype.registerContentOffsets=function(e,t){var i,r={},n={},o=!1;if(void 0!==e)for(var s in contentOffsetCSSProperties){var a=this.getAndConvertCssOffsetProperty(s,e),d=contentOffsetCSSProperties[s];t&&delete e[s];for(i in d){var u=d[i],h=this.getAndConvertCssOffsetProperty(u,e);void 0===h&&(h=a),void 0!==h?o=!0:h=0,n[u]=h,t&&(e[u]=h+"px"),r[i]=r[i]?r[i]+h:h}}var l=!1;if(o)for(i in r)this.contentPosManager.setContentOffset(i,r[i]?r[i]:0)&&(l=!0);else l=this.contentPosManager.setAllContentOffsets(void 0);return l&&globalGeometryTask.schedule(),n},t.prototype.getAndConvertCssOffsetProperty=function(e,t){if(t&&void 0!==t[e]){var i=this.display?getCssLengthInPixels(t[e],this.display.displayDiv):void 0;return void 0===i&&(Utilities.warn("unit specification not supported: "+e+": "+t[e]),i=0),t[e]=i+"px",i}},t.prototype.getZArea=function(){return this.zArea},t.prototype.getZAreaRep=function(){return void 0!==this.controller&&void 0!==this.controller.areaSetStackable?this.controller.areaSetStackable.getZAreaRep():this.zArea},t.prototype.setZIndex=function(e,t){assert(void 0!==e||void 0!==t,"if this assumption fails, setZIndex in visualUpdate() can go wrong"),void 0===this.visualUpdates?(allAreaMonitor.requestVisualUpdate(this),this.visualUpdates={display:void 0,position:void 0,frameZ:e,displayZ:t}):(this.visualUpdates.frameZ=e,this.visualUpdates.displayZ=t)},t.prototype.getFrameDiv=function(){return this.display.frameDiv},t.prototype.isInZeroContentOffsetMode=function(){return void 0!==this.contentPosManager&&this.contentPosManager.isInZeroOffsetMode()},t.prototype.isInAutoContentOffsetMode=function(){return void 0!==this.contentPosManager&&this.contentPosManager.isInAutoOffsetMode()},t.prototype.isInIndependentContentPositionMode=function(){return void 0!==this.contentPosManager&&this.contentPosManager.isInIndependentContentPositionMode()},t.prototype.getPos=function(){return this.relative},t.prototype.getPosCorrectedForOffset=function(){var e=this.getPos(),t=this.getOffsets(),i=this.display;return void 0!==e&&void 0!==t&&"left"in t?{left:e.left+t.left-i.paddingLeft,top:e.top+t.top-i.paddingTop,width:e.width-t.left-t.right+i.paddingLeft+i.paddingRight,height:e.height-t.top-t.bottom+i.paddingTop+i.paddingBottom}:e},t.prototype.pointInsideDisplay=function(e,t,i){if(void 0!==this.renderingForeignDisplay)return!1;var r=this.getPosCorrectedForOffset(),n=this.hasVisibleBorder()?this.getPos():r;return void 0!==n&&e>=n.left&&t>=n.top&&e<n.left+n.width&&t<n.top+n.height&&(i.left=r.left,i.top=r.top,!0)},t.prototype.getOffsets=function(){return this.contentPosManager.offsets},t.prototype.translateShorthand=function(e,t,i){if("object"==typeof i)return e[t]=i,!1;if(void 0===this.embedding)return!1;switch(t){case"top":case"left":case"vertical-center":case"horizontal-center":return e[t]={point1:{element:this.embedding.areaReference,type:t,content:!0},point2:{element:this.areaReference,type:t},equals:i},!1;case"bottom":case"right":return e[t]={point1:{element:this.areaReference,type:t},point2:{element:this.embedding.areaReference,type:t,content:!0},equals:i},!1;case"height":return e[t]={point1:{element:this.areaReference,type:"top"},point2:{element:this.areaReference,type:"bottom"},equals:i},!1;case"content-height":return e[t]={point1:{element:this.areaReference,type:"top",content:!0},point2:{element:this.areaReference,type:"bottom",content:!0},equals:i},!1;case"width":return e[t]={point1:{element:this.areaReference,type:"left"},point2:{element:this.areaReference,type:"right"},equals:i},!1;case"content-width":return e[t]={point1:{element:this.areaReference,type:"left",content:!0},point2:{element:this.areaReference,type:"right",content:!0},equals:i},!1;case"vertical":return e._vertical_top={point1:{element:this.embedding.areaReference,type:"top",content:!0},point2:{element:this.areaReference,type:"top"},equals:i},e._vertical_bottom={point1:{element:this.areaReference,type:"bottom"},point2:{element:this.embedding.areaReference,type:"bottom",content:!0},equals:i},!0;case"horizontal":return e._horizontal_left={point1:{element:this.embedding.areaReference,type:"left",content:!0},point2:{element:this.areaReference,type:"left"},equals:i},e._horizontal_right={point1:{element:this.areaReference,type:"right"},point2:{element:this.embedding.areaReference,type:"right",content:!0},equals:i},!0;case"frame":return e._frame_top={point1:{element:this.embedding.areaReference,type:"top",content:!0},point2:{element:this.areaReference,type:"top"},equals:i},e._frame_bottom={point1:{element:this.areaReference,type:"bottom"},point2:{element:this.embedding.areaReference,type:"bottom",content:!0},equals:i},e._frame_left={point1:{element:this.embedding.areaReference,type:"left",content:!0},point2:{element:this.areaReference,type:"left"},equals:i},e._frame_right={point1:{element:this.areaReference,type:"right"},point2:{element:this.embedding.areaReference,type:"right",content:!0},equals:i},!0;default:return Utilities.error("unknown shorthand: "+t),!1}},t.prototype.getEmbeddingPositionTree=function(){var e=void 0===this.embedding?void 0:this.embedding.getEmbeddingPositionTree();return new AreaPositionTree(this.areaId,this.getPos(),this.getOffsets(),this.getZ(),e)},t.prototype.inView=function(){function e(e,t){var i=new Rect;return i.top=e.top+Math.max(t.top,0),i.left=e.left+Math.max(t.left,0),i.height=Math.min(e.height,t.top+t.height)-Math.max(t.top,0),i.width=Math.min(e.width,t.left+t.width)-Math.max(t.left,0),i}function i(e){return e.height>0&&e.top>0}for(var r=this,n=r.getPos();void 0!==r.embedding;){var o=r.embedding;if(o instanceof t){var s=o.getPos();n=e(s,n)}r=o}return i(n)},t.prototype.inFullView=function(){function e(e,t){var i=new Rect;return i.top=e.top+Math.max(t.top,0),i.left=e.left+Math.max(t.left,0),i.height=Math.min(e.height,t.top+t.height)-Math.max(t.top,0),i.width=Math.min(e.width,t.left+t.width)-Math.max(t.left,0),i}for(var i=this,r=i.getPos(),n=r;void 0!==i.embedding;){var o=i.embedding;if(o instanceof t){var s=o.getPos();r=e(s,r)}i=o}return r.height===n.height&&r.width===n.width},t.prototype.explain=function(t){var i,r=e.prototype.explain.call(this,t),n="undefined"==typeof areaDebugInfo?void 0:areaDebugInfo[this.template.id];if(void 0!==this.displayEvaluationNode?r["display: "+this.displayEvaluationNode.debugName()]=this.displayEvaluationNode.explain(getATDBIAttr(n,"display")):r.display=void 0,void 0!==this.debugTransitionSource&&(void 0!==this.displayEvaluationNode?r["display: "+this.displayEvaluationNode.debugName()]._transitionSource=this.debugTransitionSource.element:r["display: undefined"]={_transitionSource:this.debugTransitionSource.element}),void 0!==this.independentContentPosition?r["independentContentPosition: "+this.independentContentPosition.debugName()]=this.independentContentPosition.explain(getATDBIAttr(n,"independentContentPosition")):r.independentContentPosition=void 0,void 0!==this.stacking){r.stacking={},i=getATDBIAttr(n,"stacking");for(var o in this.stacking)r.stacking[o+": "+this.stacking[o].debugName()]=this.stacking[o].explain(getATDBIAttr(i,o))}if(void 0!==this.writes){r.writes={},i=getATDBIAttr(n,"write");for(var o in this.writes)r.writes[o+": "+this.writes[o].debugName()]=this.writes[o].explain(getATDBIAttr(i,o))}return void 0!==this.propagatePointerInAreaNode?r["propagatePointerInArea: "+this.propagatePointerInAreaNode.debugName()]=this.propagatePointerInAreaNode.explain(getATDBIAttr(n,"propagatePointerInAreaNode")):r.propagatePointerInArea=void 0,r},t.prototype.canReceiveFocus=function(){return void 0!==this.display&&this.inView()&&this.display.hasActiveInputElement()},t.prototype.canLoseFocus=function(){return void 0!==this.display&&this.display.inputElementIsValid()},t.prototype.takeFocus=function(){this.display.takeFocus()},t.prototype.releaseFocus=function(){this.display.releaseFocus()},t.prototype.willHandleClick=function(){return void 0!==this.display&&this.display.willHandleClick()},t.prototype.paramInputDefined=function(){var e=this.evaluationNodes[0][areaParamIndex],t=e.result.value[0];return void 0!==t&&"input"in t},t.prototype.updateParamInput=function(e,t,i){function r(e){var t="string"==typeof e&&numberRegExp.test(e)?Number.parseFloat(e):NaN;return isNaN(t)?ensureOS(e):[t]}if(!i||this.display.hasActiveInputElement()){debugWrites&&gSimpleLog.log("updateParamInput",this.areaId,JSON.stringify(e));var n,o=this.evaluationNodes[0][areaParamIndex],s=o.lastUpdate.value[0],a=void 0!==o.latchedValue?o.latchedValue.value[0]:void 0;if(void 0===e)n=[];else{n=[{}];for(var d in e)n[0][d]=r(e[d])}var u=[{input:n}];if(t){var h=void 0!==a?a:s,l=mergeCopyValue(u,h,void 0);valueEqual(l,h)||(o.latchedValue=new Result(l),o.latch(),globalCommitWritesTask.schedule())}else void 0!==a&&o.latchedValue.set(mergeCopyValue(u,a,void 0)),o.set(new Result(mergeCopyValue(u,s,void 0)))}},t.prototype.setInputState=function(e,t){return this.display.setInputState(e,t)},t.prototype.getZ=function(){return this.zArea.getZ()},t.prototype.isOpaque=function(){return void 0!==this.display&&this.display.isOpaque()},t.prototype.hasVisibleBorder=function(){return void 0!==this.display&&this.display.hasVisibleBorder()},t.prototype.updatePreviousPosition=function(){this.previousPosition.top=this.relative.top,this.previousPosition.left=this.relative.left,this.previousPosition.width=this.relative.width,this.previousPosition.height=this.relative.height},t.prototype.interpolatePreviousPosition=function(){var e=this.intersectionChain.expressionArea,t=e.getAbsPreviousPosition(),i=this.intersectionChain.referredArea,r=i.getAbsPreviousPosition(),n=this.embedding===e?t:r;this.previousPosition.top=Math.max(t.top,r.top),this.previousPosition.left=Math.max(t.left,r.left),this.previousPosition.height=Math.max(Math.min(t.top+t.height,r.top+r.height)-this.previousPosition.top,0),this.previousPosition.width=Math.max(Math.min(t.left+t.width,r.left+r.width)-this.previousPosition.left,0),this.previousPosition.top-=n.top,this.previousPosition.left-=n.left,updateElementPos(this.display.frameDiv,this.previousPosition)},t.prototype.hasNoPosition=function(){return 0===this.previousPosition.top&&0===this.previousPosition.left&&0===this.previousPosition.width&&0===this.previousPosition.height},t.prototype.getAbsPreviousPosition=function(){var e=new Rect,i=this.embedding;for(void 0!==this.intersectionChain&&this.hasNoPosition()&&this.interpolatePreviousPosition(),e.left=this.previousPosition.left,e.top=this.previousPosition.top,e.height=this.previousPosition.height,e.width=this.previousPosition.width;void 0!==i;)i instanceof t&&(void 0!==i.intersectionChain&&i.hasNoPosition()&&i.interpolatePreviousPosition(),e.top+=i.previousPosition.top,e.left+=i.previousPosition.left),i=i.embedding;return e},t.prototype.displayElementVisible=function(){void 0!==this.foreignDisplay&&this.foreignDisplay.displayElementVisible()},t.prototype.getAbsolutePosition=function(){var e=this.relative.top,i=this.relative.left,r=this.getOffsets();"left"in r&&(e+=r.top,i+=r.left);for(var n=this.embedding;n;n=n.embedding)n instanceof t&&(r=n.getOffsets(),"left"in r&&(e+=r.top,i+=r.left),e+=n.relative.top,i+=n.relative.left);return{top:e,left:i}},t}(CoreArea),cssLengthRegEx=/^\s*(-?\d+(?:\.\d*)?)\s*(|%|px|pt|pc|em|ex|ch|in|cm|mm)\s*$/,contentOffsetCSSProperties={borderWidth:{left:"borderLeftWidth",right:"borderRightWidth",top:"borderTopWidth",bottom:"borderBottomWidth"},padding:{left:"paddingLeft",right:"paddingRight",top:"paddingTop",bottom:"paddingBottom"}},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),AreaMonitorBase=function(){function e(){this.priority=0,this.watchers=void 0,this.result=new Result([]),this.result.added=[],this.result.removed=[],this.result.incremental=!0}return e.prototype.destroy=function(){this.result=void 0,this.informWatchers(),this.watchers=void 0},e.prototype.addWatcher=function(e,t,i){void 0===i&&(i=!1),assert(!i,"debugging: not supported"),void 0===this.watchers&&(this.watchers=new Map),this.watchers.has(e.watcherId)?this.watchers.get(e.watcherId).pos.push(t):this.watchers.set(e.watcherId,{watcher:e,pos:[t]})},e.prototype.removeWatcher=function(e,t){void 0!==this.watchers&&this.watchers.delete(e.watcherId)},e.prototype.removeWatcherForPos=function(e,t,i){var r=this.watchers.get(e.watcherId),n=r.pos.indexOf(t);n>=0&&(1===r.pos.length?this.removeWatcher(e,i):r.pos.splice(n,1))},e.prototype.informWatchers=function(){var e=this;void 0!==this.watchers&&this.watchers.forEach(function(t,i){for(var r=0;r!==t.pos.length;r++)t.watcher.updateInput(t.pos[r],e.result)}),void 0!==this.result&&this.result.incremental&&(this.result.added.length=0,this.result.removed.length=0)},e.prototype.markAsChanged=function(){this.informWatchers()},e}(),AllAreaMonitor=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allAreas={},t.areaPos={},t.callbacks=[],t.areaSpecificWatchers={},t.updating=!1,t.interrupted=!1,t.needsUpdate={},t.hasBeenUpdated={},t.scheduled=!1,t.yieldToBrowserFirst=!1,t}return __extends(t,e),t.prototype.addArea=function(e){var t=e.getEmbedding();assert(!(e.areaId in this.allAreas),"debugging"),this.allAreas[e.areaId]=e,this.areaPos[e.areaId]=this.result.value.length,this.result.value.push(e.areaId),this.result.added.push(e.areaId);for(var i=0;i!==this.callbacks.length;i++)this.callbacks[i].addArea(e,t);if(this.markAsChanged(),e.areaId in this.areaSpecificWatchers){var r=this.areaSpecificWatchers[e.areaId],n=new Result([e.areaId]);for(var o in r)for(var s=r[o],i=0;i!==s.pos.length;i++)s.watcher.updateInput(s.pos[i],n)}},t.prototype.removeArea=function(e){var t=this.areaPos[e.areaId],i=e.getEmbedding();assert(e.areaId in this.allAreas,"debugging");for(var r=0;r!==this.callbacks.length;r++)this.callbacks[r].removeArea(e,i);if(delete this.areaPos[e.areaId],void 0!==t&&removeFromPosList(t,this.result.value,this.areaPos),delete this.allAreas[e.areaId],this.result.removed.push(e.areaId),this.markAsChanged(),e.areaId in this.areaSpecificWatchers){var n=this.areaSpecificWatchers[e.areaId],o=new Result(constEmptyOS);for(var s in n)for(var a=n[s],r=0;r!==a.pos.length;r++)a.watcher.updateInput(a.pos[r],o)}e.areaId in this.needsUpdate&&delete this.needsUpdate[e.areaId]},t.prototype.addAreaSpecificWatcher=function(e,t,i){var r=this.areaSpecificWatchers[e];void 0===r&&(this.areaSpecificWatchers[e]=r={}),t.watcherId in r?r[t.watcherId].pos.push(i):r[t.watcherId]={watcher:t,pos:[i]}},t.prototype.removeAreaSpecificWatcher=function(e,t){delete this.areaSpecificWatchers[e][t.watcherId]},t.prototype.getAreaById=function(e){return this.allAreas[e]},t.prototype.getAllAreaIds=function(){return Object.keys(this.allAreas)},t.prototype.exists=function(e){return e in this.allAreas},t.prototype.addCallBack=function(e){this.callbacks.push(e)},t.prototype.removeCallback=function(e){var t=this.callbacks.indexOf(e);t!==-1&&this.callbacks.splice(t,1)},t.prototype.addAreaSpecificCallBack=function(e,t,i,r){return 0},t.prototype.removeAreaSpecificCallBack=function(e,t){},t.prototype.registerLCE=function(e,t,i,r){var n=void 0;for(var o in e)n=void 0===n?e[o]:getLCE(n,e[o]);return i.call(t,0,n,r),0},t.prototype.unregisterLCE=function(e){},t.prototype.requestVisualUpdate=function(e){this.needsUpdate[e.areaId]=!0,this.scheduled||(globalVisualFlushTask.schedule(),globalAreaDisplayUpdateTask.schedule(),this.scheduled=!0)},t.prototype.signalYieldToBrowserFirst=function(){this.yieldToBrowserFirst=!0},t.prototype.areaDisplayUpdate=function(){for(var e in this.needsUpdate)this.allAreas[e].updateDisplay();return!0},t.prototype.updateVisuals=function(){if(this.updating)this.interrupted=!0;else{this.updating=!0,this.scheduled=!1;do{this.interrupted=!1;for(var e in this.needsUpdate)if(this.allAreas[e].updateVisuals(),this.hasBeenUpdated[e]=!0,delete this.needsUpdate[e],0!==SetChildController.creatingAreas||!evaluationQueue.isEmpty(0)||!globalPosConstraintSynchronizer.isEmpty()||globalPos.needToRefresh())return this.updating=!1,globalVisualWrapupTask.schedule(),!1}while(this.interrupted);this.updating=!1,globalVisualWrapupTask.schedule(),yieldToBrowser()}return!this.scheduled},t.prototype.wrapupUpdateVisuals=function(){if(this.yieldToBrowserFirst)return this.yieldToBrowserFirst=!1,yieldToBrowser(),!1;var e=!1;for(var t in this.hasBeenUpdated)t in this.allAreas&&(this.allAreas[t].wrapupUpdateVisuals(),e=!0);return this.hasBeenUpdated={},e&&yieldToBrowser(),!0},t.prototype.forceTempUpdate=function(){for(var e in this.needsUpdate)this.allAreas[e].updateVisuals()},t.prototype.cleanUpUnusedEvaluationNodes=function(){var e=this.allAreas[gPaidMgr.getScreenAreaId()],t=e.cleanUpUnusedEvaluationNodes();return e.cleanUpRemovedExportNodes(),t},t.prototype.allDisplayElementsVisible=function(){for(var e in this.allAreas){var t=this.allAreas[e];t instanceof DisplayArea&&t.displayElementVisible()}},t}(AreaMonitorBase),allAreaMonitor=new AllAreaMonitor,AreaRelationWatcher=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.setResult=function(e){objectEqual(e,this.result.value)||(this.result.value=e,this.markAsChanged())},t.prototype.getResult=function(){return this.result.value},t.prototype.add=function(e,t){Utilities.error("not to be called")},t.prototype.remove=function(e){Utilities.error("not to be called")},t}(AreaMonitorBase),AreaMultiRelationWatcher=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.id2pos={},t.ids=[],t}return __extends(t,e),t.prototype.setResult=function(e){void 0===e?void 0!==this.result.value&&(this.result.value=void 0,this.markAsChanged()):Utilities.error("not to be called: use add/remove")},t.prototype.add=function(e,t){var i;e in this.id2pos?i=this.id2pos[e]:(i=this.result.value.length,this.id2pos[e]=i,this.result.added.push(t),this.ids.push(e)),this.result.value[i]=t,this.markAsChanged()},t.prototype.remove=function(e){var t=this.id2pos[e];assert(0<=t&&t<this.result.value.length,"debugging"),this.result.removed.push(this.result.value.splice(t,1)[0]),this.ids.splice(t,1),delete this.id2pos[e];for(var i=t;i<this.ids.length;i++){var r=this.ids[i];this.id2pos[r]--}this.markAsChanged()},t}(AreaRelationWatcher),AreaRelationMonitor=function(){function e(){this.areaRelations={}}return e.prototype.addArea=function(e){this.areaRelations[e]={embedding:new AreaRelationWatcher,embedded:new AreaMultiRelationWatcher,embeddingStar:new AreaMultiRelationWatcher,embeddedStar:new AreaMultiRelationWatcher}},e.prototype.removeArea=function(e){var t=!0;for(var i in this.areaRelations[e]){var r=this.areaRelations[e][i];r.setResult(void 0),void 0===r.watchers||0===r.watchers.size?delete this.areaRelations[e][i]:t=!1}t&&delete this.areaRelations[e]},e.prototype.addRelation=function(e,t,i){t in this.areaRelations[e]||(this.areaRelations[e][t]=new AreaRelationWatcher),this.areaRelations[e][t].setResult(i)},e.prototype.addMultiRelation=function(e,t,i,r){t in this.areaRelations[e]||(this.areaRelations[e][t]=new AreaMultiRelationWatcher),this.areaRelations[e][t].add(i,r)},e.prototype.getRelation=function(e,t){return e in this.areaRelations&&void 0!==this.areaRelations[e][t]?this.areaRelations[e][t].getResult():[]},e.prototype.getEmbeddingId=function(e){var t=this.getRelation(e,"embedding");return t instanceof Array?t[0]:t},e.prototype.getExpressionId=function(e){var t=this.getRelation(e,"expressionOf");return t instanceof Array?t[0]:t},e.prototype.getReferredId=function(e){var t=this.getRelation(e,"referredOf");return t instanceof Array?t[0]:t},e.prototype.removeRelation=function(e,t){t in this.areaRelations[e]&&(this.areaRelations[e][t].setResult(void 0),delete this.areaRelations[e][t])},e.prototype.removeMultiRelation=function(e,t,i){t in this.areaRelations[e]&&this.areaRelations[e][t].remove(i)},e.prototype.addWatcher=function(e,t,i,r){e in this.areaRelations||(this.areaRelations[e]={}),t in this.areaRelations[e]||(this.areaRelations[e][t]=new AreaRelationWatcher),this.areaRelations[e][t].addWatcher(i,r)},e.prototype.removeWatcher=function(e,t,i){var r=this.areaRelations[e];void 0!==r&&t in r&&r[t].removeWatcher(i,!1)},e}(),areaRelationMonitor=new AreaRelationMonitor,SingleAreaBoolValueMonitor=function(e){function t(){var t=e.call(this)||this;return t.result.value=new Array(1),t.result.value[0]=!1,t.result.added=void 0,t.result.removed=void 0,t.result.incremental=!1,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SingleAreaBoolValueMonitor"}),t}return __extends(t,e),t.prototype.set=function(e){e!==this.result.value[0]&&(this.result.value[0]=e,this.markAsChanged())},t}(AreaMonitorBase),AreaOverlapMonitor=function(){function e(){this.areasOverlappingWithPointer={},this.monitorPerArea=new Map}return e.prototype.updatePointerOverlap=function(e){for(var t={},i=0;i<e.length;i++)t[e[i].recipient.areaId]=!0;for(var r in this.areasOverlappingWithPointer)r in t||!this.monitorPerArea.has(r)||this.monitorPerArea.get(r).set(!1);for(var r in t)r in this.areasOverlappingWithPointer||!this.monitorPerArea.has(r)||this.monitorPerArea.get(r).set(!0);this.areasOverlappingWithPointer=t},e.prototype.addWatcherFor=function(e,t,i){var r;return this.monitorPerArea.has(e)?r=this.monitorPerArea.get(e):(r=new SingleAreaBoolValueMonitor,this.monitorPerArea.set(e,r),r.set(e in this.areasOverlappingWithPointer)),r.addWatcher(t,i),r.result},e.prototype.removeWatcherFor=function(e,t){this.monitorPerArea.has(e)&&this.monitorPerArea.get(e).removeWatcher(t,!1)},e.prototype.removeArea=function(e){this.monitorPerArea.has(e)&&this.monitorPerArea.get(e).set(!1)},e}(),areaOverlapMonitor=new AreaOverlapMonitor,areaStates=void 0,areaStateHistory=void 0,lastAreaChangeCounter=0,__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ErrorContext=function(){function e(){this.nodes=[],this.values=[]}return e.prototype.getErrorContext=function(e){if(void 0===e&&(e=!1),0!==this.nodes.length){var t=this.nodes[this.nodes.length-1],i=this.values[this.values.length-1];return void 0===i&&1===t.values.length&&(i=t.values[0]),void 0===i?getShortChildPath(t.getPath()):e?i.getFullErrorLocation():i.getShortErrorLocation()}},e.prototype.enter=function(e,t){this.nodes.push(e),this.values.push(t)},e.prototype.leave=function(){this.values.pop(),this.nodes.pop()},e}(),gErrContext=new ErrorContext,ChildExistence=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.toString=function(){return"<exist>"},t}(ChildInfo),ClassName=function(e){function t(t){var i=e.call(this)||this;return i.className=t,i}return __extends(t,e),t.prototype.toString=function(){return"class "+convertValueToString(this.className,"");
},t}(ChildInfo),areaMessageIndex=0,areaParamIndex=areaMessageIndex+1,ToMergeNode=function(){function e(e,t,i){this.scheduleStep=void 0,this.to=e,this.merge=t,this.writeNode=i}return e.prototype.toString=function(){return this.to.idStr()+":="+this.merge.idStr()},e.prototype.toExportString=function(e){return"_tm("+this.to.idExpStr(e)+", "+this.merge.idExpStr(e)+", "+this.scheduleStep+")"},e.prototype.walkFunctionNodes=function(e,t){this.to=t(this.to,e,!0),this.merge=t(this.merge,e,!0),this.scheduleStep=Math.max(this.writeNode.scheduleStep,Math.max(this.to.scheduleStep,this.merge.scheduleStep))+1},e.prototype.markWritablePath=function(){this.to.setPriority(1),this.to.markWritablePath(),this.merge.setPriority(1)},e.prototype.tagExpressionPath=function(e,t,i){this.to.tagExpressionPath(e,t,i+".to"),this.merge.tagExpressionPath(e,t,i+".merge")},e}(),WriteNode=function(){function e(){}return e.strMap=function(e){var t="{";for(var i in e)1!==t.length&&(t+=","),t+=i+":"+e[i].toString();return t+"}"},e.expMap=function(e,t){if(void 0===t)return"undefined";var i="{";for(var r in t)1!==i.length&&(i+=","),i+=r+":"+t[r].toExportString(e);return i+"}"},e.prototype.walkFunctionNodes=function(e,t){function i(i){for(var r in i)i[r].walkFunctionNodes(e,t)}this.upon=t(this.upon,e,!0),this.scheduleStep=this.upon.scheduleStep+1,void 0!==this.whenBecomesTrue&&(void 0!==this.whenBecomesTrue.continuePropagation&&(this.whenBecomesTrue.continuePropagation=t(this.whenBecomesTrue.continuePropagation,e,!0),this.scheduleStep=Math.max(this.scheduleStep,this.whenBecomesTrue.continuePropagation.scheduleStep)+1),i(this.whenBecomesTrue.actions)),void 0!==this.whenBecomesFalse&&(void 0!==this.whenBecomesFalse.continuePropagation&&(this.whenBecomesFalse.continuePropagation=t(this.whenBecomesFalse.continuePropagation,e,!0),this.scheduleStep=Math.max(this.scheduleStep,this.whenBecomesFalse.continuePropagation.scheduleStep)+1),i(this.whenBecomesFalse.actions))},e.prototype.toString=function(){return this.upon.idStr()+"?"+(void 0===this.whenBecomesTrue?"":e.strMap(this.whenBecomesTrue.actions))+":"+(void 0===this.whenBecomesFalse?"":e.strMap(this.whenBecomesFalse.actions))},e.prototype.toExportString=function(t){return this.upon.idExpStr(t)+", "+(void 0===this.whenBecomesTrue||void 0===this.whenBecomesTrue.continuePropagation?"undefined":this.whenBecomesTrue.continuePropagation.idExpStr(t))+", "+(void 0===this.whenBecomesTrue?"undefined":e.expMap(t,shallowCopyMinus(this.whenBecomesTrue.actions,"continuePropagation")))+", "+(void 0===this.whenBecomesFalse||void 0===this.whenBecomesFalse.continuePropagation?"undefined":this.whenBecomesFalse.continuePropagation.idExpStr(t))+", "+(void 0===this.whenBecomesFalse?"undefined":e.expMap(t,shallowCopyMinus(this.whenBecomesFalse.actions,"continuePropagation")))+", "+this.scheduleStep},e.prototype.markWritablePath=function(){if(this.upon.setPriority(1),void 0!==this.whenBecomesTrue)for(var e in this.whenBecomesTrue.actions)this.whenBecomesTrue.actions[e].markWritablePath();if(void 0!==this.whenBecomesFalse)for(var e in this.whenBecomesFalse.actions)this.whenBecomesFalse.actions[e].markWritablePath()},e.prototype.tagExpressionPath=function(e,t,i){if(this.upon.tagExpressionPath(e,t,i+".upon"),void 0!==this.whenBecomesTrue)for(var r in this.whenBecomesTrue.actions)this.whenBecomesTrue.actions[r].tagExpressionPath(e,t,i+".true");if(void 0!==this.whenBecomesFalse)for(var r in this.whenBecomesFalse.actions)this.whenBecomesFalse.actions[r].tagExpressionPath(e,t,i+".False")},e}(),areaTemplates=[],AreaTemplate=function(){function e(t,i,r,n,o){this.exports={},this.children={},this.embeddingInReferred=!1,this.cacheStage=[],this.functionNodes=[],this.defunFunctionNodes={},this.childExistence=[],this.expressionsHaveBeenCached=!1,this.scheduleStep=void 0,this.areaNode=t,this.id=e.nextAreaTemplateId++,this.parent=i,this.childName=r,this.dataExpr=n,this.partnerExpr=o,doCompileTimeChecks&&(this.expressionCache=[new ExpressionCache]),void 0!==this.partnerExpr&&(this.embeddingInReferred="embedding"in t.next&&t.next.embedding.valueEquals("referred"))}return e.prototype.getNrParentIndices=function(){for(var e=this,t=0;void 0!==e;)e.isStaticChild()||t++,e=e.parent;return t},e.prototype.addChild=function(e,t){void 0!==t&&(this.children[e]=t)},e.prototype.isStaticChild=function(){return void 0===this.dataExpr&&void 0===this.partnerExpr},e.prototype.addMyMessageNode=function(){var e=globalMessageNode.valueType.deepCopy();e.object.recipient=(new ValueType).addArea(this.id,[_r(1,1)]),this.functionNodes[areaMessageIndex]=FunctionNode.cacheDirectly(new MessageQueueNode(["message"],this.id,0,e,gUndefinedExpr))},e.prototype.addInternalFunctions=function(){function e(t){return t instanceof VariantFunctionNode?1===t.functionNodes.length&&e(t.functionNodes[0]):t instanceof AVFunctionNode?"element"in t.attributes&&t.attributes.element.isEmptyOS():t instanceof ConstNode?t.value instanceof Object&&"element"in t.value&&objectEqual(t.value.element,[]):t instanceof Object&&("element"in t&&objectEqual(t.element,[]))}function t(i){if(i instanceof VariantFunctionNode)return 1===i.functionNodes.length&&t(i.functionNodes[0]);if(i instanceof AVFunctionNode)return!("point1"in i.attributes&&"point2"in i.attributes)||(e(i.attributes.point1)||e(i.attributes.point2));if(i instanceof ConstNode){if(i.value instanceof Object&&"point1"in i.value&&"point2"in i.value)return e(i.value.point1)||e(i.value.point2)}else if(i instanceof Object&&"point1"in i&&"point2"in i)return e(i.point1)||e(i.point2);return!1}function i(e){if(e instanceof VariantFunctionNode)return 1===e.functionNodes.length&&i(e.functionNodes[0]);if(e instanceof AVFunctionNode){if("pair1"in e.attributes&&"pair2"in e.attributes&&(!t(e.attributes.pair1)||!t(e.attributes.pair2)))return!1;if("point1"in e.attributes&&"point2"in e.attributes)return t(e)}else if(e instanceof ConstNode){if(e.value instanceof Object&&"pair1"in e.value&&"pair2"in e.value&&(!t(e.value.pair1)||!t(e.value.pair2)))return!1;if(e.value instanceof Object&&"point1"in e.value&&"point2"in e.value)return t(e)}return!1}var r,n=this.areaNode.getNodeAtPath(["display"]),o=this.areaNode.getNodeAtPath(["position"]),s=this.areaNode.getNodeAtPath(["display","foreign","value"]),a=this.areaNode.getNodeAtPath(["stacking"]),d=this.areaNode.getNodeAtPath(["independentContentPosition"]),u=this.areaNode.getNodeAtPath(["propagatePointerInArea"]),h=this.areaNode.getNodeAtPath(["write"]);this.doesExist=!0,this.existenceQualifiers=[];for(var l=0;l!==this.childExistence.length;l++){var c=buildQualifier(this.childExistence[l].qualifierTerms,void 0===this.parent?void 0:this.parent.id,void 0,void 0,void 0);if(void 0!==c){for(var p=[],f=0;f<c.qualifiers.length;f++)p=p.concat(c.qualifiers[f].simplifyBooleanVariant());this.existenceQualifiers.push(p)}}if(0===this.existenceQualifiers.length)return void(this.doesExist=!1);if(_suppressSet=!0,void 0!==n&&(r=buildFunctionNode(n,this.id,0,!0),void 0!==r&&(this.displayFunction=r)),void 0!==s&&(r=buildFunctionNode(s,this.id,0,!0),void 0!==r&&(this.foreignInterfaceDisplayFunction=r)),void 0!==o){o.opaque&&Utilities.error("opaque position"),this.positionFunctions={};for(var v in o.next)r=buildFunctionNode(o.next[v],this.id,0,!0),void 0!==r&&(i(r)&&(gErrContext.enter(o,void 0),Utilities.warnOnce("empty positioning constraint: "+v+"@"+this.id),gErrContext.leave()),this.positionFunctions[v]=r)}if(void 0!==a){a.opaque&&Utilities.error("opaque stacking"),this.stackingFunctions={};for(var v in a.next)r=buildFunctionNode(a.next[v],this.id,0,!1),void 0!==r&&(this.stackingFunctions[v]=r)}if(void 0!==h){h.opaque&&Utilities.error("opaque write"),this.writeFunctions={};for(var g in h.next){var m=buildWriteNode(h.next[g],this.id);void 0===m?(gErrContext.enter(h.next[g],void 0),Utilities.warnOnce("write without upon: "+g),gErrContext.leave()):this.writeFunctions[g]=m}}void 0!==d&&(r=buildFunctionNode(d,this.id,0,void 0),void 0!==r&&(this.independentContentPosition=r)),void 0!==u&&(r=buildFunctionNode(u,this.id,0,void 0),void 0!==r&&(this.propagatePointerInArea=r)),_suppressSet=!1,this.determineClassMembership();for(var y in this.children){var I=this.children[y];if(I.isStaticChild()||(void 0===this.setFunctions&&(this.setFunctions={}),y in this.setFunctions||(this.setFunctions[y]={})),void 0!==I.dataExpr&&I.dataExpr.needsResolution()){var b=buildFunctionNode(I.dataExpr,this.id,0,void 0),C=void 0!==b?b.valueType.copy().replaceSize(1):(new ValueType).addSize(1);void 0!==b?this.setFunctions[y].data=b:delete this.setFunctions[y].data,I.functionNodes[areaParamIndex].mergeOutput((new ValueType).addObject({areaSetAttr:(new ValueType).addNumber().addString().addSize(1),areaSetContent:C}).addSize(1))}void 0!==I.partnerExpr&&(I.partnerExpr.needsResolution()?this.setFunctions[y].partner=buildFunctionNode(I.partnerExpr,this.id,0,void 0):this.setFunctions[y].partner=I.partnerExpr.functionNode,void 0===this.setFunctions[y].partner&&delete this.setFunctions[y].partner)}},e.prototype.determineClassMembership=function(){if(void 0!==this.classes&&(void 0===this.exports[0]||this.exports[0].outdated())){var e={},t={},i=void 0;for(var r in this.classes){var n=buildQualifierNode(this.classes[r],this.id,0,void 0,void 0,void 0);void 0===n||n.isAlwaysFalse()||(e[r]=n,t[r]=(new ValueType).addBoolean().addSize(1),i=mergeLocality(i,e[r].localToArea))}this.exports[0]=new AVFunctionNode(e,i,0,(new ValueType).addObject(t).addSize(1),void 0,!1,{})}},e.prototype.determineSetContent=function(){if(void 0===this.parent.setFunctions&&(this.parent.setFunctions={}),this.childName in this.parent.setFunctions||(this.parent.setFunctions[this.childName]={}),void 0!==this.dataExpr&&this.dataExpr.needsResolution()){var e=this.parent.setFunctions[this.childName].data,t=void 0===e?void 0:e.valueType;this.parent.setFunctions[this.childName].data=buildFunctionNode(this.dataExpr,this.parent.id,0,void 0),void 0!==t&&this.parent.setFunctions[this.childName].data.valueType.subsumes(t)||signalOutputChange(void 0,{type:"valueTypeChange",origType:t,newType:this.parent.setFunctions[this.childName].data.valueType})}if(void 0!==this.parent.setFunctions[this.childName].data&&this.functionNodes[areaParamIndex].mergeOutput((new ValueType).addObject({areaSetAttr:(new ValueType).addNumber().addString().addSize(1),areaSetContent:this.parent.setFunctions[this.childName].data.valueType.copy().replaceSize(1)}).addSize(1)),void 0!==this.partnerExpr&&this.partnerExpr.needsResolution()){var i=this.parent.setFunctions[this.childName].partner,t=void 0===i?void 0:i.valueType;this.parent.setFunctions[this.childName].partner=buildFunctionNode(this.partnerExpr,this.parent.id,0,void 0),void 0!==t&&this.parent.setFunctions[this.childName].partner.valueType.subsumes(t)||signalOutputChange(void 0,{type:"valueTypeChange",origType:t,newType:this.parent.setFunctions[this.childName].partner.valueType})}},e.prototype.addParamNodes=function(){var e=new PathTreeNode(this.areaNode,this.areaNode,"param"),t=this.id,i=(new ValueType).addObject({pointerInArea:(new ValueType).addBoolean().addSize(1),dragInArea:(new ValueType).addBoolean().addSize(1)}).addSize(1);if(assert(!("param"in this.areaNode.next),"param already in path"),this.areaNode.next.param=e,void 0!==this.dataExpr&&(i.addAttribute("areaSetAttr",(new ValueType).addNumber().addString().addSize(1)),i.addAttribute("areaSetContent",(new ValueType).addSize(1))),this.hasInput()){var r=this.inputTypes(),n=new ValueType;r.indexOf(void 0)>=0&&n.addAnyData(),(r.indexOf("text")>=0||r.indexOf("password")>=0)&&n.addString(),r.indexOf("number")>=0&&n.addNumber(),i.addAttribute("input",(new ValueType).addObject({value:n.addSize(0,1),focus:(new ValueType).addBoolean().addSize(1),selectionStart:(new ValueType).addNumber().addSize(1),selectionEnd:(new ValueType).addNumber().addSize(1),selectionDirection:(new ValueType).addString().addSize(1)}).addSize(1))}e.functionNode=FunctionNode.cacheDirectly(buildStorageNode(["param"],t,0,i,!0))},e.prototype.hasInput=function(){return void 0!==this.areaNode.getNodeAtPath(["display","text","input"])},e.prototype.inputTypes=function(){var e=this.areaNode.getNodeAtPath(["display","text","input","type"]);return void 0!==e&&void 0!==e.values?e.values.map(function(e){return"string"==typeof e.origExpr?e.origExpr:void 0}):[]},e.prototype.updateCycle=function(){var e=this.functionNodes[areaMessageIndex],t=globalMessageNode.valueType.deepCopy();t.object.recipient=(new ValueType).addArea(this.id,[_r(1,1)]),e.makeCompatible(t),e.updateCycle(),this.functionNodes[areaParamIndex].updateCycle()},e.prototype.addExistence=function(e){if(void 0!==e.values)for(var t=0;t!==e.values.length;t++)e.values[t].expression.type===ExpressionType.childExistence?this.childExistence.push(e.values[t]):e.values[t].expression.type!==ExpressionType.className&&Utilities.error("unknown value type in addExistence")},e.prototype.addClasses=function(e){var t=1;if(void 0!==e.values)for(var i=0;i!==e.values.length;i++)if(e.values[i].expression.type===ExpressionType.className){void 0===this.classes&&(this.classes={},this.classNamePrio={});var r=e.values[i].expression.expression.className;r instanceof MoonOrderedSet?r=r.os:"string"==typeof r||r===superclass?r=[r]:Utilities.error("error in class name: "+JSON.stringify(r));for(var n=0;n!==r.length;n++){var o=r[n];o===superclass&&(o="::superclass"),"string"!=typeof o&&Utilities.error("error in class name: "+JSON.stringify(o)),o in this.classes?this.classes[o].push(e.values[i]):(this.classNamePrio[o]=t++,this.classes[o]=[e.values[i]])}}},e.prototype.walkFunctionNodes=function(e,t,i){function r(e){if(void 0!==e)for(var r=0;r!==e.length;r++)for(var n=0;n!==e[r].length;n++)void 0!==FunctionNode.cacheDbg&&(s.cacheStage[o]="existence "+e[r][n].toSymString()),e[r][n].functionNode=i(e[r][n].functionNode,t,!1)}function n(e){for(var r in e)e[r]=i(e[r],t,!0)}var o,s=this;if(void 0!==FunctionNode.cacheDbg&&(o=FunctionNode.cacheDbg.length,FunctionNode.cacheDbg.push(this)),!this.expressionsHaveBeenCached&&this.doesExist)if(assert(this.expressionsHaveBeenCached===!1,"cycle?"),this.expressionsHaveBeenCached=void 0,void 0!==FunctionNode.cacheDbg&&(this.cacheStage[o]="existence"),r(this.existenceQualifiers),e){for(var a in this.setFunctions)void 0!==FunctionNode.cacheDbg&&(this.cacheStage[o]="setFunction "+a),void 0!==this.setFunctions[a].data&&(this.setFunctions[a].data=i(this.setFunctions[a].data,t,!0)),void 0!==this.setFunctions[a].partner&&(this.setFunctions[a].partner=i(this.setFunctions[a].partner,t,!0));void 0!==FunctionNode.cacheDbg&&(this.cacheStage[o]="displayFunction"),this.displayFunction=i(this.displayFunction,t,!0),void 0!==FunctionNode.cacheDbg&&(this.cacheStage[o]="exports");for(var d in this.exports)void 0===this.exports[d]?delete this.exports[d]:this.exports[d].outdated()&&(Utilities.warn("not exporting "+exportPaths[d].join(".")+" at @"+this.id),delete this.exports[d]);n(this.exports),void 0!==FunctionNode.cacheDbg&&(this.cacheStage[o]="positionFunctions"),n(this.positionFunctions),void 0!==FunctionNode.cacheDbg&&(this.cacheStage[o]="stackingFunctions"),n(this.stackingFunctions);for(var u in this.writeFunctions)void 0!==FunctionNode.cacheDbg&&(this.cacheStage[o]="writeFunction "+u),this.writeFunctions[u].walkFunctionNodes(t,i);void 0!==FunctionNode.cacheDbg&&(this.cacheStage[o]="independentContentPosition"),this.independentContentPosition=i(this.independentContentPosition,t,!0),this.propagatePointerInArea=i(this.propagatePointerInArea,t,!0),this.expressionsHaveBeenCached=!0}else this.expressionsHaveBeenCached=!1;if(e)for(var a in this.children)void 0!==FunctionNode.cacheDbg&&(this.cacheStage[o]="child "+a),this.children[a].walkFunctionNodes(!0,t,i);void 0!==FunctionNode.cacheDbg&&FunctionNode.cacheDbg.pop()},e.prototype.cacheDataSetFunction=function(e,t,i){var r=this.setFunctions[e].data;return void 0!==r&&(r.seqNr in t||(t[r.seqNr]=!0,this.setFunctions[e].data=i(r,t,!0),delete t[r.seqNr]),!0)},e.prototype.cachePartnerSetFunction=function(e,t,i){var r=this.setFunctions[e].partner;return void 0!==r&&(r.seqNr in t||(t[r.seqNr]=!0,this.setFunctions[e].partner=i(r,t,!0),delete t[r.seqNr]),!0)},e.prototype.getScheduleStep=function(e,t){if(void 0!==this.scheduleStep)return this.scheduleStep;var i,r=-1;if(void 0!==FunctionNode.cacheDbg&&(i=FunctionNode.cacheDbg.length,FunctionNode.cacheDbg.push(this),this.cacheStage[i]="getScheduleStep"),void 0!==this.parent&&(r=this.parent.getScheduleStep(e,t)-1,void 0!==this.dataExpr&&this.parent.cacheDataSetFunction(this.childName,e,t)&&this.parent.setFunctions[this.childName].data.scheduleStep>r&&(r=this.parent.setFunctions[this.childName].data.scheduleStep),void 0!==this.partnerExpr&&this.parent.cachePartnerSetFunction(this.childName,e,t)&&this.parent.setFunctions[this.childName].partner.scheduleStep>r&&(r=this.parent.setFunctions[this.childName].partner.scheduleStep)),void 0!==this.existenceQualifiers)for(var n=0;n!==this.existenceQualifiers.length;n++)for(var o=0;o!==this.existenceQualifiers[n].length;o++)this.existenceQualifiers[n][o].functionNode=t(this.existenceQualifiers[n][o].functionNode,e,!0),this.existenceQualifiers[n][o].functionNode.scheduleStep>r&&(r=this.existenceQualifiers[n][o].functionNode.scheduleStep);return this.scheduleStep=r+1,void 0!==FunctionNode.cacheDbg&&FunctionNode.cacheDbg.pop(),this.scheduleStep},e.prototype.toCreateString=function(){return"_ac("+(void 0===this.parent?"undefined":String(this.parent.id))+", "+JSON.stringify(this.childName)+", "+this.scheduleStep+", "+String(this.doesExist)+")"},e.prototype.toAreaExistenceString=function(){function e(e){return"["+e.map(function(e){return"["+e.map(function(e){return e.toExportString(t)}).join(",")+"]"}).join(", ")+"]"}var t=this.id;return!this.doesExist||void 0===this.existenceQualifiers||0===this.existenceQualifiers.length||1===this.existenceQualifiers.length&&0===this.existenceQualifiers[0].length?void 0:"_aeq("+e(this.existenceQualifiers)+")"},e.prototype.toClassNamePrioString=function(){return"_cnp("+JSON.stringify(this.classNamePrio)+")"},e.prototype.getClassNamePriority=function(e){return this.classNamePrio[e]},e.prototype.toIndependentContentPositionString=function(){return void 0===this.independentContentPosition?void 0:"_icp("+this.toId(this.independentContentPosition)+")"},e.prototype.toEmbeddingInReferredString=function(){return this.embeddingInReferred?"_eir()":void 0},e.prototype.toPropagatePointerInAreaString=function(){return void 0===this.propagatePointerInArea?void 0:"_ppia("+this.toId(this.propagatePointerInArea)+")"},e.prototype.toForeignDisplayString=function(){return void 0===this.foreignInterfaceDisplayFunction?void 0:"_afi("+this.toId(this.foreignInterfaceDisplayFunction)+")"},e.prototype.toCreateChildrenString=function(){if(void 0!==this.setFunctions){var e="{";for(var t in this.setFunctions)1!==e.length&&(e+=", "),e+=JSON.stringify(t)+":{data:"+this.toId(this.setFunctions[t].data)+",partner:"+this.toId(this.setFunctions[t].partner)+"}";return e+="}","_acc("+this.id+", "+e+")"}},e.prototype.toIdMap=function(e){if(void 0===e||Utilities.isEmptyObj(e))return"undefined";var t="{";for(var i in e)if(void 0!==e[i]){var r=jsIdentifierRegExp.test(i)&&"class"!==i?i:JSON.stringify(i);1!==t.length&&(t+=", "),t+=r+":"+e[i].idExpStr(this.id)}return t+"}"},e.prototype.toId=function(e){return void 0===e?"undefined":e.idExpStr(this.id)},e.prototype.toExprString=function(){var e;return e=!this.doesExist||Utilities.isEmptyObj(this.exports)?"undefined":this.toIdMap(this.exports),"_ae("+this.id+", "+this.toId(this.displayFunction)+", "+this.toIdMap(this.positionFunctions)+", "+this.toIdMap(this.stackingFunctions)+", "+e+")"},e.prototype.getDebugContextString=function(e){var t=this.areaNode.next.context,i=this.areaNode.next.content,r=void 0!==i&&this.doesExist&&void 0!==i.functionNode?FunctionNode.cache(i.functionNode,e,!0).idExpStr(this.id):"undefined",n="";if(void 0!==t&&this.doesExist){for(var o in t.next){var s=t.next[o];if(void 0!==s.functionNode&&s.functionNode.cycleNr===gCycleNr){var a=FunctionNode.cache(s.functionNode,e,!0);void 0!==a&&(0!==n.length&&(n+=", "),n+=o+":"+a.idExpStr(this.id))}}return"_ctx("+this.id+", "+r+", {"+n+"})"}return"// no context"},e.prototype.buildExprForAllContextLabels=function(){var e=this.areaNode.next.context;if(void 0!==e)for(var t in e.next)buildFunctionNode(e.next[t],this.id,0,void 0)},e.prototype.getWritesString=function(){if(void 0!==this.writeFunctions){var e="";for(var t in this.writeFunctions){var i=this.writeFunctions[t];""!==e&&(e+="\n"),e+="_aw("+this.id+", "+JSON.stringify(t)+", "+i.toExportString(this.id)+")"}return e}},e.prototype.markWritablePath=function(){for(var e in this.writeFunctions)this.writeFunctions[e].markWritablePath()},e.prototype.markNonExistingChildren=function(e){e=e&&this.doesExist;for(var t in this.children)this.children[t].markNonExistingChildren(e);e||(this.doesExist=!1,this.existenceQualifiers=[[new SingleQualifier(buildSimpleFunctionNode(gTrueExpr,void 0,void 0,0,void 0,void 0,void 0,void 0,void 0),"<nonExisting>",!1,void 0)]],this.dataExpr=void 0,this.partnerExpr=void 0,this.exports={},this.children={},this.functionNodes=[],this.defunFunctionNodes={},this.displayFunction=void 0,this.positionFunctions=void 0,this.stackingFunctions=void 0,this.setFunctions=void 0,this.independentContentPosition=void 0,this.propagatePointerInArea=void 0,this.writeFunctions=void 0)},e.prototype.getMaxWriteScheduleStep=function(){function e(e){var t=-1;for(var i in e){var r=e[i];r.scheduleStep>t&&(t=r.scheduleStep)}return t}var t=-1;for(var i in this.writeFunctions){var r=this.writeFunctions[i];if(r.scheduleStep>t&&(t=r.scheduleStep),void 0!==r.whenBecomesTrue){var n=e(r.whenBecomesTrue.actions);n>t&&(t=n)}if(void 0!==r.whenBecomesFalse){var n=e(r.whenBecomesFalse.actions);n>t&&(t=n)}}return t},e.prototype.getMaxScheduleStep=function(e){function t(t){for(var i=-1,r=0;r!==t.length;r++)t[r].prio===e&&t[r].scheduleStep>i&&(i=t[r].scheduleStep);return i}var i=t(this.functionNodes),r=1===e?this.getMaxWriteScheduleStep():-1;r>i&&(i=r),this.scheduleStep>i&&(i=this.scheduleStep);for(var n in this.defunFunctionNodes){var o=t(this.defunFunctionNodes[n]);o>i&&(i=o)}return i},e.prototype.getEmbedding=function(e){for(var t=this,i=0;i<e;i++)t=t.parent;return t},e.prototype.checkDisplayArea=function(){this.isDisplayArea=void 0!==this.displayFunction||void 0!==this.positionFunctions&&!Utilities.isEmptyObj(this.positionFunctions)||void 0!==this.stackingFunctions&&!Utilities.isEmptyObj(this.stackingFunctions)||void 0!==this.propagatePointerInArea;for(var e in this.children)this.children[e].checkDisplayArea(),this.children[e].isDisplayArea&&(this.isDisplayArea=!0)},e.prototype.printGroupedExpressionSubTrees=function(){function e(e){return void 0!==e&&e.localToArea===a.id&&!e.getConstancy()&&!(e instanceof StorageNode||e instanceof AreaOfClassNode||e instanceof DisplayOffsetNode||e instanceof AreaProjectionNode||e instanceof AreaSelectionNode||e instanceof ChildAreasNode||e instanceof FunctionApplicationNode&&(e.builtInFunction.name in{offset:1,allAreas:1,embedded:1,time:1,embeddedStar:1,areaOfClass:1,classOfArea:1}||e.builtInFunction.name in{prev:1,next:1,prevStar:1,nextStar:1,prevPlus:1,nextPlus:1}&&1===e.functionArguments.length))}function t(e,t){if(e.id in n){var i=n[e.id];if(i===t)return;if(s[i]===e.id)return;delete n[e.id],delete o[i][e.id],t=r++,o[t]={},s[t]=e.id}n[e.id]=t,o[t][e.id]=!0}function i(i){if(e(i)&&!(i.id in n)){var a=r++;o[a]={},s[a]=i.id,t(i,a)}}var r=0,n={},o={},s={},a=this;i(this.displayFunction);for(var d in this.positionFunctions)i(this.positionFunctions[d]);for(var d in this.stackingFunctions)i(this.stackingFunctions[d]);for(var d in this.setFunctions)i(this.setFunctions[d].data),i(this.setFunctions[d].partner);i(this.independentContentPosition),i(this.propagatePointerInArea);for(var d in this.writeFunctions){if(i(this.writeFunctions[d].upon),void 0!==this.writeFunctions[d].whenBecomesTrue){i(this.writeFunctions[d].whenBecomesTrue.continuePropagation);for(var u in this.writeFunctions[d].whenBecomesTrue.actions)i(this.writeFunctions[d].whenBecomesTrue.actions[u].to),i(this.writeFunctions[d].whenBecomesTrue.actions[u].merge)}if(void 0!==this.writeFunctions[d].whenBecomesFalse){i(this.writeFunctions[d].whenBecomesFalse.continuePropagation);for(var u in this.writeFunctions[d].whenBecomesFalse.actions)i(this.writeFunctions[d].whenBecomesFalse.actions[u].to),i(this.writeFunctions[d].whenBecomesFalse.actions[u].merge)}}for(var h in this.exports)i(this.exports[h]);for(var l=this.functionNodes.length-1;l>=0;l--){var c=this.functionNodes[l];if(c.id in n||i(c),c.id in n)for(var p=c.allInputs(),f=0;f<p.length;f++)e(p[f])&&t(p[f],n[c.id])}for(var v in o){var g=Object.keys(o[v]);g.length>1&&console.log("subtree",v,"=",g.join(", "))}},e.prototype.getNrVariants=function(){for(var e=0,t=0;t<this.functionNodes.length;t++)this.functionNodes[t]instanceof VariantFunctionNode&&e++;return e},e.prototype.printExpandedVariants=function(){function e(e,t){function i(e,t){for(var i=0;i<t.length;i++){for(var r=0;r<e.length&&!qImply(e[r],t[i]);r++);if(r===e.length)return!1}if(t.length>0)for(var r=0;r<e.length;r++){for(var i=0;i<t.length&&!qImply(e[r],t[i]);i++);if(i===t.length)return!1}return!0}for(var r=[],n=0;n<e.length;n++)n!==t&&i(e[t],e[n])&&r.push(n+1);return r}function t(e){function t(t,i){for(var r=0;r<t.length;r++)if(r!==i&&e[t[r]-1].indexOf(t[i])!==-1)return!0;return!1}for(var i=[],r=0;r<e.length;r++){for(var n=[],o=0;o<e[r].length;o++)t(e[r],o)||n.push(e[r][o]);i.push(n)}return i}for(var i=[],r=[],n=[],o=[],s=0;s<this.functionNodes.length;s++){for(var a=this.functionNodes[s],d=a.getFullQualifierList(this.id,i),u=0;u<r.length&&!qsEqual(d,r[u]);u++);u===r.length?(r.push(d),n.push([a]),o.push(d.map(function(e){return"{"+e.map(SingleQualifier.sToSymString).join(",")+"}"}).join("\n          "))):(d=r[u],n[u].push(a)),i.push(d)}console.log("nr partitions =",r.length);for(var h=[],s=0;s<r.length;s++){var l=e(r,s);h.push(l),console.log("\npartition",s+1,"size="+n[s].length),console.log("specialization from",JSON.stringify(l)),""!==o[s]&&console.log("          "+o[s]);for(var u=0;u<n[s].length;u++){var a=n[s][u];console.log(this.getSymWatcher(a,""),a.idStr()+"="+a.toString())}}var c=t(h);console.log("digraph specialization {");for(var s=0;s<c.length;s++)for(var u=0;u<c[s].length;u++)console.log(c[s][u]+"->"+(s+1)+";");console.log("}")},e.prototype.getSymWatcher=function(e,t){if(this.displayFunction===e)return"["+t+"display]";for(var i in this.positionFunctions)if(this.positionFunctions[i]===e)return"["+t+"position."+i+"]";for(var i in this.stackingFunctions)if(this.stackingFunctions[i]===e)return"["+t+"stacking."+i+"]";for(var r in this.writeFunctions){var n=this.writeFunctions[r];if(n.upon===e)return"["+t+"write."+r+".upon]";if(void 0!==n.whenBecomesTrue){if(n.whenBecomesTrue.continuePropagation===e)return"["+t+"write."+r+".true.continuePropagation]";for(var o in n.whenBecomesTrue.actions){if(n.whenBecomesTrue.actions[o].to===e)return"["+t+"write."+r+".true."+o+".to]";if(n.whenBecomesTrue.actions[o].merge===e)return"["+t+"write."+r+".true."+o+".merge]"}}if(void 0!==n.whenBecomesFalse){if(n.whenBecomesFalse.continuePropagation===e)return"["+t+"write."+r+".true.continuePropagation]";for(var o in n.whenBecomesFalse.actions){if(n.whenBecomesFalse.actions[o].to===e)return"["+t+"write."+r+".true."+o+".to]";if(n.whenBecomesFalse.actions[o].merge===e)return"["+t+"write."+r+".true."+o+".merge]"}}}if(this.independentContentPosition===e)return"["+t+"independentContentPosition]";if(this.exports[0]===e)return"["+t+"class]";if(void 0!==this.exports[0]){var s=this.exports[0];for(var a in s.attributes)if(s.attributes[a]===e)return"["+t+"class."+a+"]"}for(var i in this.exports)if(this.exports[i]===e)return"["+t+exportPaths[i]+"]";for(var d in this.setFunctions){if(this.setFunctions[d].data===e)return"["+t+"child."+d+".data]";if(this.setFunctions[d].partner===e)return"["+t+"child."+d+".partner]"}for(var d in this.children){var u=this.children[d].getSymWatcher(e,t+"child."+d+".");if(""!==u)return u}var h=this.areaNode.next.content;if(void 0!==h&&h.functionNode===e)return"["+t+"content]";var l=this.areaNode.next.context;if(void 0!==l)for(var c in l.next){var p=l.next[c];if(p.functionNode===e)return"["+t+"context."+c+"]"}return""},e.prototype.getNumberOfAreasRangeUnder=function(e){if(this.id==e)return[new RangeValue([1],!0,!0)];if(void 0===this.parent)return[new RangeValue([0],!0,!0)];var t=this.parent.getNumberOfAreasRangeUnder(e),i=void 0!==this.parent&&void 0!==this.parent.setFunctions&&this.childName in this.parent.setFunctions?void 0!==this.parent.setFunctions[this.childName].data&&void 0!==this.parent.setFunctions[this.childName].partner?ValueTypeSize.mergeSizes(this.parent.setFunctions[this.childName].partner.valueType.sizes,this.parent.setFunctions[this.childName].data.valueType.sizes):void 0!==this.parent.setFunctions[this.childName].data?this.parent.setFunctions[this.childName].data.valueType.sizes:void 0!==this.parent.setFunctions[this.childName].data?this.parent.setFunctions[this.childName].partner.valueType.sizes:[new RangeValue([0],!0,!0)]:void 0===this.existenceQualifiers||0===this.existenceQualifiers.length?[_r(0,0)]:1===this.existenceQualifiers.length&&0===this.existenceQualifiers[0].length?[_r(1,1)]:[_r(0,1)];return ValueTypeSize.multiplySizes(i,t)},e.prototype.getChildPath=function(){if(void 0===this.parent)return[];var e=this.parent.getChildPath();return e.push(this.childName),e},e.prototype.alwaysExists=function(){return void 0===this.dataExpr&&void 0===this.partnerExpr&&1===this.childExistence.length&&0===this.childExistence[0].qualifierTerms.length&&(void 0===this.parent||this.parent.alwaysExists())},e.prototype.getExistenceQualifiersWithRespectTo=function(e){if(0!=this.childExistence.length&&void 0!==this.parent&&this.parent.id===e&&void 0===this.dataExpr&&void 0===this.partnerExpr){for(var t=[],i=void 0,r=0;r<this.childExistence.length;r++){var n=this.childExistence[r],o=buildQualifier(n.qualifierTerms,this.parent.id,0,void 0,void 0);if(void 0===o)return;var s=o.qualifiers;t.push(s);for(var a=0;a<s.length;a++)i=mergeLocality(i,s[a].functionNode.localToArea)}return new QualifiersFunctionNode(t,i,0)}},e.prototype.accumulateCallsPerTemplate=function(){gAccumulatedNrCallsPerTemplate[this.id]=void 0!==gNrCallsPerTemplate[this.id]?gNrCallsPerTemplate[this.id]:0;for(var e in this.children){var t=this.children[e];t.accumulateCallsPerTemplate(),gAccumulatedNrCallsPerTemplate[this.id]+=gAccumulatedNrCallsPerTemplate[t.id]}},e}();AreaTemplate.nextAreaTemplateId=1;var templateDifferenceMaps=[{},{}],ParseTree=function(){function e(){}return e}(),ParseResult=function(){function e(){}return e}(),StringParseFormula=function(){function e(){}return e.prototype.parse=function(t){function i(){for(;d<t.length&&" "===t[d];)d++}function r(e){var r=[];if(d++,i(),")"!==t[d]){d--;do{d++;var n=a();if(r.push(n.tree),n.success!==!0)return{success:n.success,tree:{head:e,arguments:r},error:n.error};i()}while(","===t[d])}return{success:!0,tree:{head:e,arguments:r}}}function n(){var o,s;if(i(),"-"===t[d])return d++,o=n(),{success:o.success,tree:{head:"unaryMinus",arguments:[o.tree]},error:o.error};if("("===t[d])return d++,o=a(),i(),d>=t.length?o.success===!0&&(o.success=void 0):")"===t[d]?d++:o.success!==!1&&(o.success=!1,o.error="missing right parenthesis"),o;if(null!==(s=e.attributeRegExp.exec(t.substr(d)))){var u=s[0];return'"'!==u[0]&&"'"!==u[0]||(u=u.substr(1,u.length-2).replace(/\\(.)/g,"$1")),d+=s[0].length,i(),d<t.length&&"("===t[d]?u in e.knownFunctions?(o=r(u),d>=t.length?o.success===!0&&(o.success=void 0):")"===t[d]?(d++,e.knownFunctions[u]>=0&&(void 0===o.tree.arguments||o.tree.arguments.length!==e.knownFunctions[u])&&(o.success=!1,o.error="wrong number of arguments to function")):o.success!==!1&&(o.success=!1,o.error="closing parenthesis expected"),o):{success:!1,tree:{head:u},error:"unknown function"
}:{success:!0,tree:{head:u}}}if(null!==(s=e.numberRegExp.exec(t.substr(d)))){var h=Number(s[0]);return d+=s[0].length,i(),t[d]in e.suffixes&&(h*=e.suffixes[t[d]],d++),{success:!isNaN(h),tree:{head:h},error:isNaN(h)?"incorrectly formatted number":void 0}}return{success:d===t.length&&void 0,tree:{head:h},error:d===t.length?"formula incomplete":"number, name or parenthesis expected"}}function o(){var e,r=n();for(i();r.success&&d<t.length;){var o=t[d];switch(o){case"^":d++,e=n(),r={success:e.success,tree:{head:o,arguments:[r.tree,e.tree]},error:e.error},i();break;default:return r}}return r}function s(){var e,r=o();for(i();r.success&&d<t.length;){var n=t[d];switch(n){case"*":case"/":case"%":d++,e=o(),r={success:e.success,tree:{head:n,arguments:[r.tree,e.tree]},error:e.error},i();break;default:return r}}return r}function a(){var e,r=s();for(i();r.success&&d<t.length;){var n=t[d];switch(n){case"+":case"-":d++,e=s(),r={success:e.success,tree:{head:n,arguments:[r.tree,e.tree]},error:e.error},i();break;default:return r}}return r}var d=0;if("string"!=typeof t)return{success:!1,tree:{head:void 0,result:void 0},error:"not a string"};var u=a();return i(),d===t.length?u:u.success?{success:!1,tree:u.tree,error:"end of expression expected"}:u},e}();StringParseFormula.attributeRegExp=/^(([a-zA-Z_$][a-zA-Z_$0-9]*)|("([^\\"]|\\.)+")|('([^\\']|\\.)+'))/,StringParseFormula.numberRegExp=new RegExp("^[+-]?([0-9]+(\\.[0-9]*)?|[0-9]*\\.[0-9]+)([Ee][0-9]+)?"),StringParseFormula.suffixes={K:1e3,k:1e3,M:1e6,m:1e6,B:1e9,b:1e9,T:1e12,t:1e12},StringParseFormula.knownFunctions={ln:1,log10:1,logb:2,sqrt:1,abs:1,pi:0,e:0,exp:1,avg:-1,sum:-1,min:-1,max:-1,year:1,quarter:1,month:1,dayOfWeek:1,dayOfMonth:1,hour:1,minute:1,second:1};var StringParseCDLValue=function(){function e(){}return e.prototype.parse=function(t){function i(){for(;s<t.length&&" "===t[s];)s++}function r(e){var r=[];if(s++,i(),")"!==t[s]){s--;do{s++;var n=o();if(r.push(n.tree),n.success!==!0)return{success:n.success,tree:{head:e,arguments:r},error:n.error};i()}while(","===t[s])}return{success:!0,tree:{head:e,arguments:r}}}function n(){var e=[],r={};if(s++,i(),")"!==t[s]){s--;do{s++,i();var n=StringParseFormula.attributeRegExp.exec(t.substr(s));if(null===n)return{success:!1,tree:{head:void 0},error:"attribute expected"};var a=n[0];if('"'!==a[0]&&"'"!==a[0]||(a=a.substr(1,a.length-2).replace("\\\\","\\")),s+=n[0].length,i(),":"!==t[s])return{success:!1,tree:{head:void 0},error:"colon expected"};s++,i();var d=o();if(e.push(d.tree),d.success!==!0)return{success:d.success,tree:{head:"",arguments:e},error:d.error};r[a]=d.tree.result,i()}while(","===t[s])}return{success:!0,tree:{head:"",arguments:e,result:r}}}function o(){var o,a;if(i(),s<t.length&&"{"===t[s])return o=n(),s>=t.length?o.success===!0&&(o.success=void 0):"}"===t[s]?s++:o.success!==!1&&(o.success=!1,o.error="closing brace expected"),o;if(null!==(a=e.identifierRegExp.exec(t.substr(s)))){var d=a[0];if(s+=d.length,i(),"true"===d||"false"===d)return{success:!0,tree:{head:d,result:"true"===d}};if("_"===d)return{success:!0,tree:{head:d,result:_}};if(s<t.length&&"("===t[s]){var u=e.knownFunctions[d];return void 0===u?{success:!1,tree:{head:d},error:"unknown function: "+d}:(o=r(d),s>=t.length?o.success===!0&&(o.success=void 0):")"===t[s]?(s++,o.tree.result=u(o.tree.arguments)):o.success!==!1&&(o.success=!1,o.error="closing parenthesis expected"),o)}return{success:!1,tree:{head:d},error:"function call expected"}}if(null!==(a=e.numberRegExp.exec(t.substr(s)))){var h=Number(a[0]);return s+=a[0].length,i(),{success:!isNaN(h),tree:{head:h,result:h},error:isNaN(h)?"incorrectly formatted number":void 0}}if(null!==(a=e.stringRegExp.exec(t.substr(s)))){var l=a[0];return s+=l.length,i(),{success:!0,tree:{head:l,result:l.substr(1,l.length-2).replace("\\\\","\\")}}}return{success:!1,tree:{head:void 0},error:"number, string or function expected"}}var s=0;if("string"!=typeof t)return{success:!1,tree:{head:void 0,result:void 0},error:"not a string"};var a=o();return i(),s===t.length?a:a.success?{success:!1,tree:a.tree,error:"operator expected"}:a},e}();StringParseCDLValue.attributeRegExp=/^(([a-zA-Z_$][a-zA-Z_$0-9]*)|("([^\\"]|\\.)+")|('([^\\']|\\.)+'))/,StringParseCDLValue.identifierRegExp=/^[a-zA-Z_$][a-zA-Z_$0-9]*/,StringParseCDLValue.stringRegExp=/^(("[^"]*")|(\'[^\']*\'))/,StringParseCDLValue.numberRegExp=/^[+-]?([0-9]+(\\.[0-9]*)?|[0-9]*\\.[0-9]+)([Ee][0-9]+)?/,StringParseCDLValue.knownFunctions={o:function(e){return e.map(function(e){return e.result})},r:function(e){return new RangeValue(e.map(function(e){return e.result}),!0,!0)},Rcc:function(e){return new RangeValue(e.map(function(e){return e.result}),!0,!0)},Rco:function(e){return new RangeValue(e.map(function(e){return e.result}),!0,!1)},Roc:function(e){return new RangeValue(e.map(function(e){return e.result}),!1,!0)},Roo:function(e){return new RangeValue(e.map(function(e){return e.result}),!1,!1)}};var AppStateMgrLoginAction;!function(e){e[e.none=0]="none",e[e.clearNotPersistedAppState=1]="clearNotPersistedAppState",e[e.writeCurrentAppState=2]="writeCurrentAppState"}(AppStateMgrLoginAction||(AppStateMgrLoginAction={}));var AppStateMgr=function(){function e(){this.appStateDB={},this.appStateObj={},this.appStateHandle=void 0,this.appStateInfo={errorId:[1],errorMessage:[""],connectionState:["not connected"],serverAddress:[],serverPort:[],serverPath:[],protocol:[],owner:[],appName:[RemoteMgr.getAppName()],loginStatus:["not logged in"]},this.nextInfoConsumerId=1,this.appStateInfoConsumer={},this.dataSourceAware=!1,this.loggedIn=!1,this.remotePaidInterface=new RemotePaidInterface(gPaidMgr),this.loginAction=AppStateMgrLoginAction.none;var e=getArgParser();this.watcherId=getNextWatcherId();var t=!1,i="127.0.0.1",r=8080,n="/",o="anonymous",s=getWindowLocation();s&&s.protocol&&"https:"===s.protocol&&(t=!0,i=s.hostname);var a=e.getArg("remote",t);if(a===!0||"true"===a||1==a){if(s&&s.protocol&&"https:"===s.protocol){var d=CookieAuth.getCookieUserName();"string"==typeof d&&(o=d)}"string"==typeof remoteServerPath?(r=443,n=remoteServerPath):("number"==typeof remoteServerPort&&(r=remoteServerPort),"string"==typeof wwwBaseUrlPath&&(n=wwwBaseUrlPath)),"string"==typeof appStateOwner&&(o=appStateOwner);var u=e.getArg("port",r);this.appStateInfo.serverPort=[e.getArg("appStatePort",u)],this.appStateInfo.serverPath=[e.getArg("appStatePath",n)],this.appStateInfo.owner=[e.getArg("appStateOwner",o)];var h=e.getArg("server",i);this.appStateInfo.serverAddress=[e.getArg("appStateServer",h)],this.appStateInfo.protocol=[e.getArg("protocol","wss")],this.appStateInfoNotify(),gProfile&&(this.totalUpdateInputTime=0,this.attributedTime=0)}}return e.prototype.load=function(){if(0!==this.appStateInfo.serverAddress.length&&"undefined"!=typeof this.appStateInfo.serverAddress[0]){var t={protocol:this.appStateInfo.protocol[0],hostName:this.appStateInfo.serverAddress[0],port:this.appStateInfo.serverPort[0],path:this.appStateInfo.serverPath[0]},i={type:"appState",app:this.appStateInfo.appName[0],owner:this.appStateInfo.owner[0]};assert("undefined"==typeof this.appStateHandle,"load a single appState"),this.appStateHandle=gRemoteMgr.subscribe(this,t,i,XDR.xdrAppStateElement,e.getIdentString,"appState"),gRemoteMgr.registerForLoginStatusUpdates(this),this.appStateInfo.connectionState=["connecting"],this.appStateInfoNotify()}},e.getIdentString=function(e){var t=e.ident;return AppStateIdentifier.getHashStr(t)},e.prototype.resourceUpdate=function(e,t){if(assert("appState"===t,"expecting 'appState' resources"),"appState"===t){void 0!==globalDebugTracingLog&&globalDebugTracingLog.newCycle(0);for(var i in e){var r=e[i].value;r===xdrDeleteIdent?delete this.appStateDB[i]:this.appStateDB[i]=r;var n=this.appStateObj[i];void 0!==n&&(r===xdrDeleteIdent?n.remoteDelete():n.remoteUpdate(r))}}},e.prototype.resourceConnectionStateUpdate=function(e,t,i){assert("appState"===i,"expecting 'appState' resources"),0!==e&&this.resetTemplateIndexIds(),this.appStateInfo.errorId=[e],this.appStateInfo.errorMessage=[t],this.appStateInfo.connectionState=[0===e?"connected":"error"],this.appStateInfoNotify(),0===e?(this.loggedIn=!0,globalSystemEvents.notifyHandlers(["login"])):(this.loggedIn=!1,this.notifyAppStateSubscribersOfError(),this.appStateInfoNotify())},e.prototype.getIdentHashStr=function(e){return AppStateIdentifier.getHashStr(e)},e.prototype.get=function(e){var t=this.getIdentHashStr(e);return this.appStateDB[t]},e.prototype.set=function(e,t){var i=this.getIdentHashStr(e);this.appStateDB[i]=t,void 0!==this.appStateHandle&&this.loggedIn&&gRemoteMgr.write(this.appStateHandle,e,t)},e.prototype.register=function(e,t){var i=this.getIdentHashStr(e);assert(!(i in this.appStateObj),"register each appState element once"),this.appStateObj[i]=t,t.addWatcher(this,e,!1,!0,!1)},e.prototype.unregister=function(e){var t=this.getIdentHashStr(e);this.appStateObj[t].removeWatcher(this,!0,!1),delete this.appStateObj[t]},e.prototype.updateInput=function(e,t){var i=this.getIdentHashStr(e),r=this.appStateObj[i];"write"===r.valueOrigin&&this.set(e,t.value)},e.prototype.notifyAppStateSubscribersOfError=function(){for(var e in this.appStateObj)this.appStateObj[e].remoteError()},e.prototype.appStateInfoRegister=function(e,t){var i=this.nextInfoConsumerId++;return this.appStateInfoConsumer[i]={consumer:e,ident:t},i},e.prototype.appStateInfoUnregister=function(e){delete this.appStateInfoConsumer[e]},e.prototype.getAppStateInfo=function(){return this.appStateInfo},e.prototype.appStateInfoNotify=function(){for(var e in this.appStateInfoConsumer){var t=this.appStateInfoConsumer[e],i=t.consumer;i.appStateInfoUpdate(t.ident,this.appStateInfo)}},e.prototype.allRequestsAcknowledged=function(){},e.prototype.writeAckInfoUpdate=function(e,t){},e.prototype.isActive=function(){return!0},e.prototype.isReady=function(){return!0},e.prototype.isDeferred=function(){return!1},e.prototype.defer=function(){throw"Should not be called"},e.prototype.undefer=function(){throw"Should not be called"},e.prototype.debugName=function(){return"appStateMgr"},e.prototype.getDebugOrigin=function(){return["appStateMgr"]},e.prototype.signalTermination=function(e){throw new Error("Method not implemented.")},e.prototype.getTemplateIndexAdmin=function(){return this.remotePaidInterface},e.prototype.getTemplateIndexIdUpdates=function(){return this.remotePaidInterface.getTemplateIndexIdUpdates()},e.prototype.resetTemplateIndexIds=function(){this.remotePaidInterface.resetChannel()},e.prototype.defineRemoteTemplateIndexIds=function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var i=e[t];isXDRTemplateDefinition(i)?this.remotePaidInterface.addRemoteTemplateDefinition(i):isXDRIndexDefinition(i)?this.remotePaidInterface.addRemoteIndexDefinition(i):RemotingLog.log(4,function(){return"not an XDR template or index definition: "+JSON.stringify(i)})}else RemotingLog.log(4,function(){return"not an XDR template or index definition list: "+JSON.stringify(e)})},e.prototype.logout=function(){this.loginAction=AppStateMgrLoginAction.none,void 0!==this.appStateHandle&&(this.resetTemplateIndexIds(),gRemoteMgr.logout(this.appStateHandle),this.appStateHandle=void 0),this.appStateDB={},this.loggedIn&&(this.loggedIn=!1,globalSystemEvents.notifyHandlers(["logout"])),this.appStateInfo.owner=["anonymous"],0===this.appStateInfo.errorId[0]&&(this.appStateInfo.errorId=[1],this.appStateInfo.errorMessage=[""],this.appStateInfo.connectionState=["not authenticated"],this.appStateInfo.loginStatus=["not logged in"],this.appStateInfoNotify())},e.prototype.login=function(e,t){var i={protocol:this.appStateInfo.protocol[0],hostName:this.appStateInfo.serverAddress[0],port:this.appStateInfo.serverPort[0],path:this.appStateInfo.serverPath[0]};this.logout(),this.loginAction=AppStateMgrLoginAction.clearNotPersistedAppState,gRemoteMgr.login(i,{username:e,password:t})},e.prototype.createAccount=function(e,t,i){var r={protocol:this.appStateInfo.protocol[0],hostName:this.appStateInfo.serverAddress[0],port:this.appStateInfo.serverPort[0],path:this.appStateInfo.serverPath[0]};this.logout(),this.loginAction=AppStateMgrLoginAction.writeCurrentAppState,gRemoteMgr.createAccount(r,{username:e,password:t,email:i})},e.prototype.loginStatusUpdate=function(e,t,i){this.appStateInfo.owner=[e],t?(void 0===this.appStateHandle&&(this.load(),this.resourceConnectionStateUpdate(0,"","appState")),this.appStateInfo.loginStatus=["logged in"]):t||(this.appStateInfo.errorId=[1],this.appStateInfo.errorMessage=["error logging in"],this.appStateInfo.connectionState=["not connected"],this.appStateInfo.loginStatus=[i]),this.appStateInfoNotify()},e.prototype.resourceUpdateComplete=function(e){if(e===this.appStateHandle){switch(this.loginAction){case AppStateMgrLoginAction.clearNotPersistedAppState:this.clearNotPersistedAppState();break;case AppStateMgrLoginAction.writeCurrentAppState:this.writeCurrentAppState()}this.loginAction=AppStateMgrLoginAction.none}},e.prototype.clearNotPersistedAppState=function(){for(var e in this.appStateObj)if(void 0===this.appStateDB[e]){var t=this.appStateObj[e];"write"===t.valueOrigin&&t.reinitialize()}},e.prototype.writeCurrentAppState=function(){for(var e in this.appStateObj){var t=this.appStateObj[e];this.updateInput(t.appStateIdentifier,t.result)}},e}(),gAppStateMgr=new AppStateMgr,__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),debugDataSourceObject={},MinimumResultRequirements;!function(e){e[e.single=0]="single",e[e.simple=1]="simple",e[e.compound=2]="compound",e[e.ordered=3]="ordered"}(MinimumResultRequirements||(MinimumResultRequirements={}));var dsRemoveQueue=void 0,dsDestroyTimeOut=0,DataSource=function(){function e(t,i){this.id=e.nextId++,this.resultReceivers=new Map,this.activatingReceivers=0,this.input=t,this.resultReceivers.set(i.watcherId,i),debugDataSourceObject[this.id]=this}return e.prototype.destroy=function(){assert(this.id in debugDataSourceObject,"don't destroy twice"),delete debugDataSourceObject[this.id],assert(void 0!==this.resultReceivers&&0===this.resultReceivers.size,"debugging"),this.resultReceivers=void 0,this.input=void 0,this.removeEndOfUse()},e.prototype.activate=function(){Utilities.error("implement in derived class 1")},e.prototype.deactivate=function(){Utilities.error("implement in derived class 2")},e.prototype.conditionalDestroy=function(){0===this.resultReceivers.size?(console.log("datasource",this.id,this.debugInfo(),"destroyed"),this.destroy()):(void 0!==dsRemoveQueue&&("number"==typeof this.timeoutId?dsRemoveQueue[this.timeoutId]=void 0:Utilities.error("TODO: resolve different timeoutId type in node")),this.timeoutId=void 0)},e.prototype.markAsChanged=function(){Utilities.error("implement in derived class 4")},e.prototype.checkEndOfUse=function(){0===this.resultReceivers.size&&this.putOnRemoveQueue()},e.prototype.removeEndOfUse=function(){void 0!==this.timeoutId&&("number"==typeof this.timeoutId?void 0===dsRemoveQueue?clearTimeout(this.timeoutId):dsRemoveQueue[this.timeoutId]=void 0:Utilities.error("TODO: resolve different timeoutId type in node"),this.timeoutId=void 0)},e.prototype.putOnRemoveQueue=function(){var e=this;void 0===dsRemoveQueue?(void 0!==this.timeoutId&&("number"==typeof this.timeoutId?clearTimeout(this.timeoutId):Utilities.error("TODO: resolve different timeoutId type in node")),0===dsDestroyTimeOut?this.destroy():this.timeoutId=setTimeout(function(){e.conditionalDestroy()},dsDestroyTimeOut)):(void 0!==this.timeoutId&&("number"==typeof this.timeoutId?dsRemoveQueue[this.timeoutId]=void 0:Utilities.error("TODO: resolve different timeoutId type in node")),this.timeoutId=dsRemoveQueue.length,dsRemoveQueue[this.timeoutId]=this)},e.prototype.addResultReceiver=function(e){assert(!this.resultReceivers.has(e.watcherId),"do not register more than once"),this.resultReceivers.set(e.watcherId,e),this.removeEndOfUse()},e.prototype.removeResultReceiver=function(e){assert(this.resultReceivers.has(e.watcherId),"must be registered"),this.resultReceivers.delete(e.watcherId),this.checkEndOfUse()},e.prototype.belongsUniquelyTo=function(e){return 1===this.resultReceivers.size&&this.resultReceivers.has(e.watcherId)},e.prototype.hasSameSource=function(e){return!1},e.prototype.canMoveTo=function(e,t){return this.belongsUniquelyTo(e)&&!t.isBasedOn(this)},e.prototype.isBasedOn=function(e){for(var t=e;void 0!==t;){if(t===e)return!0;t=t.input}return!1},e.prototype.debugInfo=function(){return"unknown"},e}();DataSource.nextId=1,DataSource.dataSourceFunctions={size:makeSizeDSFunction,not:makeNotDSFunction,empty:makeNotDSFunction,notEmpty:makeNotEmptyDSFunction,sum:makeSumDSFunction,min:makeMinDSFunction,max:makeMaxDSFunction,bool:makeBoolDSFunction,singleValue:makeSingleValueDSFunction,changecount:makeChangeCountDSFunction,changeinform:makeChangeInformerFunction};var IndexerTracer=function(){function e(e,t,i){this.doNotIndex=!0,this.id=InternalQCM.newId(),this.indexer=e,this.pathId=t,e.addQueryCalcToPathNode(this),e.needKeyUpdateForQuery(this),this.parent=i}return e.prototype.destroy=function(){this.indexer.stopKeyUpdateForQuery(this),this.indexer.removeQueryCalcFromPathNode(this),this.indexer=void 0},e.prototype.getId=function(){return this.id},e.prototype.isSelection=function(){return!0},e.prototype.updateKeys=function(e,t,i,r,n){this.parent.indexerUpdateKeys(e,t,i,r,n)},e.prototype.removeAllIndexerMatches=function(){},e}(),IndexerTracerMatchUpdates=function(e){function t(t,i,r){var n=e.call(this,t,i,void 0)||this;return n.parent=r,n}return __extends(t,e),t.prototype.isSelection=function(){return!1},t.prototype.addMatches=function(e,t){this.parent.addMatches(e,t)},t.prototype.removeMatches=function(e,t){this.parent.removeMatches(e,t)},t}(IndexerTracer),DataSourceComposable=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.indexQueryDSMap=new Map,t.nrExtractedElements=0,t}return __extends(t,e),t.prototype.destroy=function(){void 0!==this.funcResult&&(this.funcResult.destroy(),this.funcResult=void 0),this.stopIndexerMonitoring(),e.prototype.destroy.call(this)},t.prototype.stopIndexerMonitoring=function(){for(var e in this.indexerTracers)this.indexerTracers[e].destroy();this.indexerTracers=void 0},t.prototype.conditionalDestroy=function(){void 0!==this.dataQueryDSMap&&0!==this.dataQueryDSMap.size||void 0!==this.orderingDSMap&&0!==this.orderingDSMap.size||void 0!==this.sortDSMap&&0!==this.sortDSMap.size||void 0!==this.elementIdQueryDSMap&&0!==this.elementIdQueryDSMap.size||void 0!==this.functionDSMap&&0!==this.functionDSMap.size||void 0!==this.elementIdTransformationMapDSMap&&0!==this.elementIdTransformationMapDSMap.size||void 0!==this.mergeUnderIdentityWithPathDSMap&&0!==this.mergeUnderIdentityWithPathDSMap.size||void 0!==this.dataSourceMultiplexer?this.removeEndOfUse():e.prototype.conditionalDestroy.call(this)},t.prototype.checkEndOfUse=function(){void 0!==this.dataQueryDSMap&&0!==this.dataQueryDSMap.size||void 0!==this.orderingDSMap&&0!==this.orderingDSMap.size||void 0!==this.sortDSMap&&0!==this.sortDSMap.size||void 0!==this.elementIdQueryDSMap&&0!==this.elementIdQueryDSMap.size||void 0!==this.functionDSMap&&0!==this.functionDSMap.size||void 0!==this.identityDSMap&&0!==this.identityDSMap.size||void 0!==this.elementIdTransformationMapDSMap&&0!==this.elementIdTransformationMapDSMap.size||void 0!==this.mergeUnderIdentityWithPathDSMap&&0!==this.mergeUnderIdentityWithPathDSMap.size||void 0!==this.dataSourceMultiplexer||e.prototype.checkEndOfUse.call(this)},t.prototype.alreadyRegisteredOn=function(e,t){throw"do not call"},t.prototype.moveToDataSource=function(e,t){throw"do not call"},t.createIndexerDataSourceRoot=function(e,t,i){var r,n=e.getId();return n in IndexerDataSource.indexerIdMap?(r=IndexerDataSource.indexerIdMap[n],r.addResultReceiver(t)):IndexerDataSource.indexerIdMap[n]=r=new IndexerDataSource(e,t,i),r},t.createQueryDataSourceRoot=function(e,t){return new QueryDataSource(e,t)},t.prototype.applyDataQuery=function(e,i,r,n){void 0===n&&(n=t.globalId);var o,s,a=cdlifyNormalized(e);return assert("number"==typeof r,"must be a number"),"dataQueryDSMap"in this||(this.dataQueryDSMap=new Map),this.dataQueryDSMap.has(n)?s=this.dataQueryDSMap.get(n):(s=new Map,this.dataQueryDSMap.set(n,s)),s.has(r)?(o=s.get(r),o.updateQuery(e),o.addResultReceiver(i)):(o=new DataSourceQueryByData(e,i.watcherId,a,r,n,this,i),s.set(r,o)),o},t.prototype.removeDataQueryApplication=function(e){assert(void 0!==this.dataQueryDSMap&&this.dataQueryDSMap.has(e.ownerId)&&this.dataQueryDSMap.get(e.ownerId).has(e.querySourceId),"debugging");var t=this.dataQueryDSMap.get(e.ownerId);t.delete(e.querySourceId),0===t.size&&this.dataQueryDSMap.delete(e.ownerId),this.checkEndOfUse()},t.prototype.getQueryApplicationWithSourceId=function(e,i){return void 0===i&&(i=t.globalId),void 0!==this.dataQueryDSMap&&this.dataQueryDSMap.has(i)?this.dataQueryDSMap.get(i).get(e):void 0},t.prototype.applyElementIdQuery=function(e,t,i){var r,n="#"+e.join(",");return"elementIdQueryDSMap"in this||(this.elementIdQueryDSMap=new Map),this.elementIdQueryDSMap.has(i)?(r=this.elementIdQueryDSMap.get(i),r.addResultReceiver(t)):(r=new DataSourceQueryByElementId(e,i,n,this,t),this.elementIdQueryDSMap.set(i,r)),r},t.prototype.removeElementIdQueryApplication=function(e){assert(void 0!==this.elementIdQueryDSMap&&this.elementIdQueryDSMap.has(e.watcherId),"debugging"),this.elementIdQueryDSMap.delete(e.watcherId),this.checkEndOfUse()},t.prototype.applyAggregateFunction=function(e,t){var i;return"functionDSMap"in this||(this.functionDSMap=new Map),this.functionDSMap.has(e)?(i=this.functionDSMap.get(e),i.addResultReceiver(t)):(i=new DataSourceFunctionApplication(e,this,t),this.functionDSMap.set(e,i)),i},t.prototype.removeFunctionApplication=function(e){assert(void 0!==this.functionDSMap&&this.functionDSMap.has(e.functionName),"debugging"),this.functionDSMap.delete(e.functionName),this.checkEndOfUse()},t.prototype.applyOrdering=function(e,t){var i=new DataSourceOrdering(e,t.watcherId,this,t);return"orderingDSMap"in this||(this.orderingDSMap=new Map),assert(!this.orderingDSMap.has(t.watcherId),"don't register twice"),this.orderingDSMap.set(t.watcherId,i),i},t.prototype.removeOrderingApplication=function(e){assert(void 0!==this.orderingDSMap&&this.orderingDSMap.has(e.watcherId),"debugging"),this.orderingDSMap.delete(e.watcherId),this.checkEndOfUse()},t.prototype.applySort=function(e,t){if("sortDSMap"in this||(this.sortDSMap=new Map),this.sortDSMap.has(t.watcherId)){var i=this.sortDSMap.get(t.watcherId);return i.addResultReceiver(t),i}var r=new DataSourceSort(e,t.watcherId,this,t);return this.sortDSMap.set(t.watcherId,r),r},t.prototype.removeSortApplication=function(e){assert(void 0!==this.sortDSMap&&this.sortDSMap.has(e.watcherId),"debugging"),this.sortDSMap.delete(e.watcherId),this.checkEndOfUse()},t.prototype.applyIdentity=function(e,t,i){var r;return"identityDSMap"in this||(this.identityDSMap=new Map),this.identityDSMap.has(e)?(r=this.identityDSMap.get(e),r.addResultReceiver(t)):(r=new DataSourceIdentityApplication(e,this,t,i),this.identityDSMap.set(e,r)),r},t.prototype.removeIdentityApplication=function(e){assert(void 0!==this.identityDSMap&&this.identityDSMap.has(e.identityAttribute),"debugging"),this.identityDSMap.delete(e.identityAttribute),this.checkEndOfUse()},t.prototype.applyElementIdTransformation=function(e,t){var i;if("elementIdTransformationMapDSMap"in this||(this.elementIdTransformationMapDSMap=new Map),this.elementIdTransformationMapDSMap.has(e))i=this.elementIdTransformationMapDSMap.get(e),i.addResultReceiver(t);else{switch(e){case"uniqueById":i=new DataSourceUniqueById(this,t);break;default:Utilities.error("unknown element id transformation: "+e)}this.elementIdTransformationMapDSMap.set(e,i)}return i},t.prototype.removeElementIdTransformation=function(e){assert(void 0!==this.elementIdTransformationMapDSMap&&this.elementIdTransformationMapDSMap.has(e.transformationName),"debugging"),this.elementIdTransformationMapDSMap.delete(e.transformationName),this.checkEndOfUse()},t.prototype.applyMergeUnderIdentityWithPath=function(e,t){var i;return"mergeUnderIdentityWithPathDSMap"in this||(this.mergeUnderIdentityWithPathDSMap=new Map),this.mergeUnderIdentityWithPathDSMap.has(t.watcherId)?i=this.mergeUnderIdentityWithPathDSMap.get(t.watcherId):(i=new DataSourceMergeUnderIdentityWithPath(this,e,t),this.mergeUnderIdentityWithPathDSMap.set(t.watcherId,i)),i},t.prototype.removeMergeUnderIdentityWithPathApplication=function(e){assert(void 0!==this.mergeUnderIdentityWithPathDSMap&&this.mergeUnderIdentityWithPathDSMap.has(e.watcherId),"debugging"),this.mergeUnderIdentityWithPathDSMap.delete(e.watcherId),this.checkEndOfUse()},t.prototype.getDataSourceMultiplexer=function(e){return void 0===this.dataSourceMultiplexer?this.dataSourceMultiplexer=new DataSourceComposableMultiplexer(this,e):this.dataSourceMultiplexer.addResultReceiver(e),this.dataSourceMultiplexer},t.prototype.dumpApplicationStructure=function(e){void 0===e&&(e=!0);var t={};return this.dataQueryDSMap&&this.dataQueryDSMap.forEach(function(i,r){i.forEach(function(i,n){if(!e||i.funcResult.isActiveStar()){var o=0===r?n+": "+i.debugInfo():n+"(owner="+r+"): "+i.debugInfo();t[o]=i.dumpApplicationStructure(e)}})}),this.functionDSMap&&this.functionDSMap.forEach(function(i,r){(!e||i.activatingReceivers>0)&&(t[i.debugInfo()]="")}),this.orderingDSMap&&this.orderingDSMap.forEach(function(i,r){e&&!i.funcResult.isActiveStar()||(t[r+": "+i.debugInfo()]=i.dumpApplicationStructure(e))}),this.sortDSMap&&this.sortDSMap.forEach(function(i,r){e&&!i.funcResult.isActiveStar()||(t[r+": "+i.debugInfo()]=i.dumpApplicationStructure(e))}),this.elementIdQueryDSMap&&this.elementIdQueryDSMap.forEach(function(i,r){e&&!i.funcResult.isActiveStar()||(t["#"+i.queryString+": "+i.debugInfo()]=i.dumpApplicationStructure(e))}),this.identityDSMap&&this.identityDSMap.forEach(function(i,r){e&&!i.funcResult.isActiveStar()||(t[i.debugInfo()]=i.dumpApplicationStructure(e))}),this.elementIdTransformationMapDSMap&&this.elementIdTransformationMapDSMap.forEach(function(i,r){(!e||i.activatingReceivers>0)&&(t[r]=i.dumpApplicationStructure(e))}),this.mergeUnderIdentityWithPathDSMap&&this.mergeUnderIdentityWithPathDSMap.forEach(function(i,r){e&&!i.funcResult.isActiveStar()||(t[r+": "+i.debugInfo()]=i.dumpApplicationStructure(e))}),this.dataSourceMultiplexer&&(e&&!this.dataSourceMultiplexer.funcResult.isActiveStar()||(t[this.dataSourceMultiplexer.debugInfo()]=this.dataSourceMultiplexer.dumpApplicationStructure(e))),this.indexQueryDSMap&&this.indexQueryDSMap.forEach(function(i,r){e&&!i.funcResult.isActiveStar()||(t[r+": "+i.debugInfo()]="-->index")}),t},t.prototype.collectReachableDSIds=function(e){e.has(this.id)||(e.add(this.id),this.dataQueryDSMap&&this.dataQueryDSMap.forEach(function(t){return t.forEach(function(t){return t.collectReachableDSIds(e)})}),this.functionDSMap&&this.functionDSMap.forEach(function(t){return e.add(t.id)}),this.orderingDSMap&&this.orderingDSMap.forEach(function(t){return t.collectReachableDSIds(e)}),this.sortDSMap&&this.sortDSMap.forEach(function(t){return t.collectReachableDSIds(e)}),this.elementIdQueryDSMap&&this.elementIdQueryDSMap.forEach(function(t){return t.collectReachableDSIds(e)}),this.identityDSMap&&this.identityDSMap.forEach(function(t){return t.collectReachableDSIds(e)}),this.elementIdTransformationMapDSMap&&this.elementIdTransformationMapDSMap.forEach(function(t){return t.collectReachableDSIds(e)}),this.mergeUnderIdentityWithPathDSMap&&this.mergeUnderIdentityWithPathDSMap.forEach(function(t){return t.collectReachableDSIds(e)}),this.dataSourceMultiplexer&&this.dataSourceMultiplexer.collectReachableDSIds(e),this.indexQueryDSMap&&this.indexQueryDSMap.forEach(function(t){return t.collectReachableDSIds(e)}))},t.prototype.debugActive=function(){var e=this.funcResult;return(e.isActive()?"+":"-")+this.id+"("+e.id+(e.resultIndexer?":idx:"+e.resultIndexer.id:"")+") "},t.prototype.debugMatchList=function(){var e=this.funcResult.getDominatedMatches();return"["+(e.length>10?e.slice(0,10):e).join(",")+(e.length>10?",...]":"]")+"/"+e.length},t.prototype.extractData=function(e,t){switch(e){case MinimumResultRequirements.single:return this.extractDataSimple(!0);case MinimumResultRequirements.simple:return this.extractDataSimple(!1);case MinimumResultRequirements.compound:return this.extractDataComplex(void 0);case MinimumResultRequirements.ordered:return this.extractDataComplex(t)}return[]},t.prototype.extractDataSimple=function(e){var t=this.funcResult.getDominatedIndexer(),i=this.funcResult.getDominatedProjPathId(),r=t.pathNodesById[i],n=[],o={};o[i]=!0;try{this.funcResult.getDominatedMatchesAsObj().forEach(function(t,i){var o=r.nodes.get(i);if(void 0!==o&&void 0!==o.key&&(n.push(o.key),e))throw 0})}catch(t){if(!e||0!==t)throw t}return this.updateIndexerMonitors(o,t),n},t.prototype.extractDataComplex=function(e,t){function i(e,t,r){var o={};for(var s in e.children){var a=e.children[s],u=a.nodes.get(r);if(void 0!==u){var h=void 0!==u.key?u.key:i(a,t,r);void 0!==h&&(s in o?o[s].push(h):o[s]=[h],a.pathId in d||(d[a.pathId]=!0))}void 0!==t.children&&t.children.has(a.pathId)&&t.children.get(a.pathId).ids.forEach(function(e,t){var r=a.nodes.get(t),e=void 0!==r.key?r.key:i(a,n.dataElements.getEntry(t),t);void 0!==e&&(s in o?o[s].push(e):o[s]=[e],a.pathId in d||(d[a.pathId]=!0))})}return o}function r(e,t){var r=s.nodes.get(t);if(void 0!==r)if(void 0!==r.key)a.push(r.key);else{var o=i(s,n.dataElements.getEntry(t),t);void 0!==o&&a.push(o)}}void 0===t&&(t=!0);var n=this.funcResult.getDominatedIndexer(),o=this.funcResult.getDominatedProjPathId(),s=n.pathNodesById[o],a=[],d={};if(d[o]=!0,void 0===e)this.funcResult.getDominatedMatchesAsObj().forEach(r);else for(var u=0;u<e.dataElementIdsInOrder.length;u++)r(void 0,e.dataElementIdsInOrder[u]);return t&&this.updateIndexerMonitors(d,n),productStatus<=ProductStatus.testing&&(this.nrExtractedElements+=a.length,a.length>=500?Utilities.warn("extracting "+a.length+" elements"):this.nrExtractedElements>=1e4&&Utilities.warn("extracted "+this.nrExtractedElements+" so far")),a},t.prototype.updateIndexerMonitoringForDominatedPath=function(){var e=this.funcResult.getDominatedIndexer(),t=this.funcResult.getDominatedProjPathId();if(void 0!==e&&void 0!==t){var i={};i[t]=!0,this.updateIndexerMonitors(i,e)}},t.prototype.updateIndexerMonitors=function(e,t){for(var i in this.indexerTracers)i in e||(this.indexerTracers[i].destroy(),delete this.indexerTracers[i]);void 0===this.indexerTracers&&(this.indexerTracers={});for(var r in e)r in this.indexerTracers||(this.indexerTracers[r]=new IndexerTracer(t,Number(r),this))},t.prototype.indexerUpdateKeys=function(e,t,i,r,n){var o=this;void 0!==this.resultReceivers&&this.resultReceivers.forEach(function(e){e.reextractData(o)})},t.prototype.removeAllIndexerMatches=function(){},t.prototype.signalNewFuncResultToApplications=function(e){"dataQueryDSMap"in this&&this.dataQueryDSMap.forEach(function(e,t){e.forEach(function(e,t){e.refreshFuncResult()})}),"functionDSMap"in this&&this.functionDSMap.forEach(function(e,t){e.refreshFuncResult()}),"orderingDSMap"in this&&this.orderingDSMap.forEach(function(e,t){e.refreshFuncResult()}),"sortDSMap"in this&&this.sortDSMap.forEach(function(e,t){e.refreshFuncResult()}),"elementIdQueryDSMap"in this&&this.elementIdQueryDSMap.forEach(function(e,t){e.refreshFuncResult()}),"identityDSMap"in this&&this.identityDSMap.forEach(function(e,t){e.refreshFuncResult()}),"elementIdTransformationMapDSMap"in this&&this.elementIdTransformationMapDSMap.forEach(function(e,t){e.refreshFuncResult()}),"mergeUnderIdentityWithPathDSMap"in this&&this.mergeUnderIdentityWithPathDSMap.forEach(function(e,t){e.refreshFuncResult()}),void 0!==this.dataSourceMultiplexer&&this.dataSourceMultiplexer.refreshFuncResult();
},t}(DataSource);DataSourceComposable.indexerIdMap={},DataSourceComposable.globalId=0;var IndexerDataSource=function(e){function t(t,i,r){var n=e.call(this,void 0,i)||this;return n.funcResult=new DataResult(globalInternalQCM,t,globalInternalQCM.getRootPathId()),n.name=r,n}return __extends(t,e),t.prototype.destroy=function(){},t.prototype.isEqual=function(e){return e instanceof t&&this.funcResult.getId()===e.funcResult.getId()},t.prototype.refreshFuncResult=function(){},t.prototype.accumulatedQuery=function(){return{from:this.name}},t.prototype.debugInfo=function(){return this.id+" indexer "+this.funcResult.getId()},t.prototype.getDebugResult=function(){for(var e=0,t=this.resultReceivers.values();e<t.length;e++){var i=t[e];return i.getDebugResult()}return[]},t}(DataSourceComposable),QueryDataSource=function(e){function t(t,i){var r=e.call(this,void 0,i)||this;return r.dataSourceQuery=new DataSourceQueryRefCount(t),r.funcResult=r.dataSourceQuery.queryDesc,r}return __extends(t,e),t.prototype.destroy=function(){this.dataSourceQuery.destroy(),this.dataSourceQuery=void 0,this.funcResult=void 0,e.prototype.destroy.call(this)},t.prototype.isEqual=function(e){return this===e},t.prototype.refreshFuncResult=function(){},t.prototype.accumulatedQuery=function(){return{from:this.dataSourceQuery.queryObj}},t.prototype.debugInfo=function(){return this.id+" queryRoot "+this.funcResult.getId()},t.prototype.getDebugResult=function(){return[this.dataSourceQuery.queryObj]},t}(DataSourceComposable),DataSourceQuery=function(e){function t(t,i,r,n,o){var s=e.call(this,r,n)||this;return s.queryString=t,s.watcherId=i,s.funcResult=new InternalQueryResult(globalInternalQCM,o),s.funcResult.setData(r.funcResult),s}return __extends(t,e),t.prototype.refreshFuncResult=function(){this.funcResult.setData(this.input.funcResult)},t}(DataSourceComposable),DataSourceQueryRefCount=function(){function e(e){this.refCount=0,this.queryObj=e,this.queryIndexer=new FEGReplaceableValueIndexer(globalInternalQCM),this.queryIndexer.alwaysUniqueDataElementId=!0,this.queryIndexer.minimizeDataElementMovement=!0,this.queryIndexer.replaceRawObject(e),this.queryDesc=new DataResult(globalInternalQCM,this.queryIndexer,globalInternalQCM.getRootPathId()),this.query=new Query(globalInternalQCM),this.query.setData(this.queryDesc),this.query.lockActive("DataSource")}return e.prototype.destroy=function(){assert(0===this.refCount,"DEBUGGING"),this.query.unlockActive("DataSource"),this.query.destroy(),this.queryDesc.destroy(),this.queryIndexer.destroy(),this.query=void 0,this.queryDesc=void 0,this.queryIndexer=void 0},e.prototype.update=function(e){objectEqual(this.queryObj,e)||(this.queryObj=e,this.queryIndexer.replaceRawObject(e))},e}(),DataSourceQueryByData=function(e){function t(i,r,n,o,s,a,d){var u=e.call(this,n,r,a,d,o===t._idForSelectionChain)||this;return u.queryObj=i,u.querySourceId=o,u.ownerId=s,t.querySourceIdMap.has(o)?(u.queryRef=t.querySourceIdMap.get(o),u.queryRef.update(i)):(u.queryRef=new DataSourceQueryRefCount(i),t.querySourceIdMap.set(o,u.queryRef)),u.queryRef.refCount++,u.funcResult.setQuery(u.queryRef.query),u}return __extends(t,e),t.prototype.destroy=function(){assert(void 0!==this.queryRef,"do not destroy twice"),assert(this.input.dataQueryDSMap.has(this.ownerId)&&this.input.dataQueryDSMap.get(this.ownerId).has(this.querySourceId),"must be registered on data source"),this.input.removeDataQueryApplication(this),this.queryRef.refCount--,0===this.queryRef.refCount&&(this.queryRef.destroy(),t.querySourceIdMap.delete(this.querySourceId)),this.queryRef=void 0,e.prototype.destroy.call(this)},t.prototype.isEqual=function(e){return this===e||e instanceof t&&(this.funcResult.getId()===e.funcResult.getId()||this.queryString===e.queryString&&this.input.isEqual(e.input))},t.prototype.updateQuery=function(e){if(!objectEqual(this.queryObj,e)){var t=cdlifyNormalized(e);this.queryString=t,this.queryObj=e,this.queryRef.update(e)}},t.prototype.hasSameSource=function(e){return this.querySourceId===e},t.prototype.changeQuerySourceId=function(e){var i=this.querySourceId;if(i!==e){var r=this.input.dataQueryDSMap.get(this.ownerId);assert(this.querySourceId===i&&void 0!==r&&r.has(i)&&!r.has(e),"changeQuerySourceId error"),r.set(e,r.get(i)),r.delete(i),this.querySourceId=e,t.querySourceIdMap.set(e,this.queryRef),t.querySourceIdMap.delete(i)}},t.prototype.canMoveTo=function(e,t){return this.belongsUniquelyTo(e)&&!t.isBasedOn(this)&&!("dataQueryDSMap"in t&&t.dataQueryDSMap.has(this.ownerId)&&t.dataQueryDSMap.get(this.ownerId).has(this.querySourceId))},t.prototype.alreadyRegisteredOn=function(e,t){return t.dataQueryDSMap.has(this.ownerId)&&t.dataQueryDSMap.get(this.ownerId).has(this.querySourceId)},t.prototype.moveToDataSource=function(e,t){var i,r=this.input;this.funcResult.dataObj!==t.funcResult&&(this.input=t,"dataQueryDSMap"in t||(t.dataQueryDSMap=new Map),assert(!t.dataQueryDSMap.has(this.ownerId)||!t.dataQueryDSMap.get(this.ownerId).has(this.querySourceId),"debugging"),t.dataQueryDSMap.has(this.ownerId)?i=t.dataQueryDSMap.get(this.ownerId):(i=new Map,t.dataQueryDSMap.set(this.ownerId,i)),i.set(this.querySourceId,this),t.removeEndOfUse(),this.funcResult.setData(t.funcResult),r.removeDataQueryApplication(this))},t.prototype.debugInfo=function(){var e=[];return this.resultReceivers.forEach(function(t,i){e.push(i)}),this.debugActive()+this.queryString+": "+this.debugMatchList()},t.prototype.accumulatedQuery=function(){function e(t,r){function n(e){"selection"in i||(i.selection=[]),i.selection.push(r.join(".")+" "+e)}function o(e){"projection"in i||(i.projections={}),i.projections[e[e.length-1]]=e}if(t===_||t instanceof Array&&1===t.length&&t[0]===_)o(r);else if(t instanceof RangeValue)n("between "+t.min+" and "+t.max);else if(t instanceof NonAV)n("= "+t.stringify());else if(t instanceof Array)n(0===t.length?"= o()":1===t.length?"= "+safeJSONStringify(t[0]):"in ("+t.join(",")+")");else if(t instanceof Object)for(var s in t)e(t[s],r.concat(s));else n("= "+safeJSONStringify(t))}var t=this.input.accumulatedQuery(),i={from:t};return e(this.queryObj,[]),i},t.prototype.getDebugResult=function(){return interpretedQuery(this.queryObj,this.input.getDebugResult())},t}(DataSourceQuery);DataSourceQueryByData._id=-1,DataSourceQueryByData._idForSelectionChain=-2,DataSourceQueryByData.querySourceIdMap=new Map;var DataSourceQueryByElementId=function(e){function t(t,i,r,n,o){var s=e.call(this,r,i,n,o,!1)||this;return s.elementIDs=t,s.query=new IdQuery(globalInternalQCM),s.query.addDataElements(t),s.funcResult.setQuery(s.query),s}return __extends(t,e),t.prototype.destroy=function(){assert(void 0!==this.query,"do not destroy twice"),this.input.removeElementIdQueryApplication(this),this.query.destroy(),this.query=void 0,e.prototype.destroy.call(this)},t.prototype.updateDataElements=function(e){var t=this,i=this.elementIDs.filter(function(t){return e.indexOf(t)===-1}),r=e.filter(function(e){return t.elementIDs.indexOf(e)===-1});this.query.removeDataElements(i),this.query.addDataElements(r),this.query.refreshQuery(),this.queryString="#"+e.join(","),this.elementIDs=e},t.prototype.isEqual=function(e){return this===e||e instanceof t&&(this.funcResult.getId()===e.funcResult.getId()||this.watcherId===e.watcherId&&this.input.isEqual(e.input))},t.prototype.debugInfo=function(){return this.debugActive()+"element "+this.elementIDs.join(",")},t.prototype.accumulatedQuery=function(){var e=this.input.accumulatedQuery();return{selection:["elementID in ("+this.elementIDs.join(",")+")"],from:e}},t.prototype.getDebugResult=function(){return[]},t}(DataSourceQuery),DataSourceFunctionApplication=function(e){function t(t,i,r){var n=e.call(this,i,r)||this;return n.result=void 0,n.functionName=t,n.funcAppl=DataSource.dataSourceFunctions[t](globalInternalQCM,i.funcResult,n),n}return __extends(t,e),t.prototype.destroy=function(){assert(void 0!==this.functionName,"do not destroy twice"),assert(this.input.functionDSMap.has(this.functionName),"must be registered on data source"),this.input.removeFunctionApplication(this),this.functionName=void 0,this.result=void 0,this.funcAppl.destroy(),this.funcAppl=void 0,e.prototype.destroy.call(this)},t.prototype.activate=function(){this.activatingReceivers++,1===this.activatingReceivers&&this.funcAppl.activated()},t.prototype.deactivate=function(){this.activatingReceivers--,assert(this.activatingReceivers>=0,"too many deactivates"),0===this.activatingReceivers&&this.funcAppl.deactivated()},t.prototype.refreshFuncResult=function(){this.funcAppl.setData(this.input.funcResult)},t.prototype.isEqual=function(e){return this===e||e instanceof t&&(this.functionName===e.functionName&&this.input.isEqual(e.input))},t.prototype.newResult=function(e){objectEqual(this.result,e)||(this.result=e,void 0!==this.resultReceivers&&this.resultReceivers.forEach(function(t){t.newDataSourceResult(e)}))},t.prototype.getResult=function(){return this.result},t.prototype.debugActive=function(){return(this.activatingReceivers>0?"+":"-")+this.id},t.prototype.debugInfo=function(){return this.debugActive()+" "+this.functionName+": "+cdlify(this.result)},t.prototype.accumulatedQuery=function(){var e=this.input.accumulatedQuery();return{function:this.functionName,from:e}},t.prototype.getDebugResult=function(){var e=this.input.getDebugResult();switch(this.functionName){case"size":return[e.length];default:return console.log("not implemented for",this.functionName),[]}},t}(DataSource),DataSourceComposableMultiplexer=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.funcResult=t.funcResult,r}return __extends(t,e),t.prototype.destroy=function(){this.input.dataSourceMultiplexer=void 0,this.input.checkEndOfUse(),this.funcResult=void 0,e.prototype.destroy.call(this)},t.prototype.stopIndexerMonitoring=function(){},t.prototype.updateIndexerMonitoringForDominatedPath=function(){},t.prototype.conditionalDestroy=function(){void 0===this.indexQueryDSMap||0===this.indexQueryDSMap.size?e.prototype.conditionalDestroy.call(this):this.removeEndOfUse()},t.prototype.checkEndOfUse=function(){0===this.resultReceivers.size&&0===this.indexQueryDSMap.size&&this.putOnRemoveQueue()},t.prototype.applyIndexQuery=function(e,t){var i=new DataSourceIndex(this,e,t);return this.indexQueryDSMap.set(i.id,i),i},t.prototype.removeIndexQuery=function(e){assert(this.indexQueryDSMap.has(e.id),"unregistered [index]"),this.indexQueryDSMap.delete(e.id),this.checkEndOfUse()},t.prototype.dumpApplicationStructure=function(t){void 0===t&&(t=!0);var i=e.prototype.dumpApplicationStructure.call(this,t);return this.indexQueryDSMap&&this.indexQueryDSMap.forEach(function(e,r){i[String(r)+": "+e.debugInfo()]=e.dumpApplicationStructure(t)}),i},t.prototype.accumulatedQuery=function(){return this.input.accumulatedQuery()},t.prototype.getDebugResult=function(){return this.input.getDebugResult()},t.prototype.isEqual=function(e){return this===e||e instanceof t&&this.input.isEqual(e.input)},t.prototype.refreshFuncResult=function(){this.indexQueryDSMap&&this.indexQueryDSMap.forEach(function(e){e.refreshFuncResult()})},t.prototype.applyDataQuery=function(e,t,i,r){throw void 0===r&&(r=DataSourceComposable.globalId),"do not call"},t.prototype.removeDataQueryApplication=function(e){throw"do not call"},t.prototype.getQueryApplicationWithSourceId=function(e,t){throw void 0===t&&(t=DataSourceComposable.globalId),"do not call"},t.prototype.applyElementIdQuery=function(e,t,i){throw"do not call"},t.prototype.removeElementIdQueryApplication=function(e){throw"do not call"},t.prototype.applyAggregateFunction=function(e,t){throw"do not call"},t.prototype.removeFunctionApplication=function(e){throw"do not call"},t.prototype.applyOrdering=function(e,t){throw"do not call"},t.prototype.removeOrderingApplication=function(e){throw"do not call"},t.prototype.applySort=function(e,t){throw"do not call"},t.prototype.removeSortApplication=function(e){throw"do not call"},t.prototype.applyIdentity=function(e,t,i){throw"do not call"},t.prototype.removeIdentityApplication=function(e){throw"do not call"},t.prototype.applyElementIdTransformation=function(e,t){throw"do not call"},t.prototype.removeElementIdTransformation=function(e){throw"do not call"},t.prototype.applyMergeUnderIdentityWithPath=function(e,t){throw"do not call"},t.prototype.removeMergeUnderIdentityWithPathApplication=function(e){throw"do not call"},t.prototype.extractData=function(e,t){throw"do not call"},t.prototype.extractDataSimple=function(e){throw"do not call"},t.prototype.extractDataComplex=function(e,t){throw void 0===t&&(t=!0),"do not call"},t.prototype.updateIndexerMonitors=function(e,t){throw"do not call"},t.prototype.indexerUpdateKeys=function(e,t,i,r,n){throw"do not call"},t.prototype.removeAllIndexerMatches=function(){},t.prototype.signalNewFuncResultToApplications=function(e){throw"do not call"},t}(DataSourceComposable),DataSourceIndex=function(e){function t(t,i,r){var n=e.call(this,t,r)||this;return n.indexQuery=i,n.funcResult=new IndexOrderResult(globalInternalQCM),n.funcResult.setOrderedData(n.input.funcResult),n.funcResult.setToIndexData(n.indexQuery.funcResult),n}return __extends(t,e),t.prototype.destroy=function(){this.input.removeIndexQuery(this),this.input=void 0,this.indexQuery=void 0,e.prototype.destroy.call(this)},t.prototype.accumulatedQuery=function(){return{index:this.indexQuery.accumulatedQuery(),from:this.input.accumulatedQuery()}},t.prototype.getDebugResult=function(){},t.prototype.isEqual=function(e){return this===e||e instanceof t&&(this.indexQuery.isEqual(e.indexQuery)&&this.input.isEqual(e.input))},t.prototype.debugInfo=function(){return"index"},t.prototype.refreshFuncResult=function(){this.funcResult.setData(this.input.funcResult)},t}(DataSourceComposable),AggregateDSFunction=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.value=void 0,n.needsKeyUpdates=!1,n.scheduledForCompleteIncrementalUpdateTask=!1,n.completeIncrementalUpdateTaskCancelled=!1,n.parent=r,n.setData(i),n.setIndexerMonitor(),n.init(),n.needsKeyUpdates&&(n.addedMatches=void 0,n.removedMatches=void 0,n.elementIDUpdates=void 0,n.typeUpdates=void 0,n.keyUpdates=void 0,n.prevTypeUpdates=void 0,n.prevKeyUpdates=void 0,n.pathNodePrevKeys=void 0,n.activeDiffUpdateMode=!1),n.markAsChanged(),n}return __extends(t,e),t.prototype.destroy=function(){void 0!==this.indexerMonitor&&(this.indexerMonitor.destroy(),this.indexerMonitor=void 0),e.prototype.destroy.call(this)},t.prototype.markAsChanged=function(){this.parent.newResult(void 0===this.value?constEmptyOS:[this.value])},t.prototype.setValue=function(e){this.value!==e&&(this.value=e,this.markAsChanged())},t.prototype.wrapUp=function(e){},t.prototype.reset=function(){},t.prototype.supportsMultiProj=function(){return!1},t.prototype.isActive=function(){return this.parent.activatingReceivers>0},t.prototype.activated=function(){e.prototype.activated.call(this),this.scheduledForCompleteIncrementalUpdateTask&&this.completeIncrementalUpdateTaskCancelled&&(this.completeIncrementalUpdateTaskCancelled=!1,this.scheduledForCompleteIncrementalUpdateTask=!1,this.completeIncrementalUpdate())},t.prototype.refreshIndexerAndPaths=function(e){this.reset(),this.setIndexerMonitor(),this.needsKeyUpdates&&(this.addedMatches=void 0,this.removedMatches=void 0,this.elementIDUpdates=void 0,this.typeUpdates=void 0,this.keyUpdates=void 0,this.prevTypeUpdates=void 0,this.prevKeyUpdates=void 0,this.pathNodePrevKeys=void 0,this.activeDiffUpdateMode=!1),this.markAsChanged()},t.prototype.replaceIndexerAndPaths=function(e,t,i){this.setIndexerMonitor()},t.prototype.addMatches=function(e,t){if(this.needsKeyUpdates){if(this.activeDiffUpdateMode){if(void 0!==e){for(var i=new Set(this.addedMatches),r=new Set(this.removedMatches),n=0;n<e.length;n++){var o=e[n];r.has(o)?r.delete(o):i.has(o)||this.addedMatches.push(o)}if(r.size!==this.removedMatches.length){var s=[];r.forEach(function(e){s.push(e)}),this.removedMatches=s}}}else this.addedMatches=void 0===this.addedMatches?e:this.addedMatches.concat(e);this.qcm.scheduleCompleteIncrementalUpdate(this)}else this.add(e,void 0),this.markAsChanged()},t.prototype.removeMatches=function(e,t){if(this.needsKeyUpdates){var i=this.dataObj.getDominatedIndexer(),r=this.dataObj.getDominatedProjPathId(),n=i.pathNodesById[r];if(void 0===this.addedMatches)this.removedMatches=void 0===this.removedMatches?e:this.removedMatches.concat(e);else{this.activeDiffUpdateMode=!0,void 0===this.removedMatches&&(this.removedMatches=[]);for(var o=new Set(this.addedMatches),s=new Set(this.removedMatches),a=0;a<e.length;a++){var d=e[a];o.has(d)?o.delete(d):s.has(d)||this.removedMatches.push(d)}if(o.size!==this.addedMatches.length){var u=[];o.forEach(function(e){u.push(e)}),this.addedMatches=u}}void 0===this.pathNodePrevKeys&&(this.pathNodePrevKeys=i.getPrevKeyObj(n)),this.qcm.scheduleCompleteIncrementalUpdate(this)}else this.subtract(e,void 0,void 0),this.markAsChanged()},t.prototype.removeAllMatches=function(e){this.reset(),this.markAsChanged()},t.prototype.addDataObjMatches=function(e,t,i){this.add(this.dataObj.getDominatedMatches(),void 0),this.markAsChanged()},t.prototype.removeDataObjMatches=function(e,t,i){this.reset(),this.markAsChanged()},t.prototype.refreshProjMappings=function(e){},t.prototype.addProjMatches=function(e,t,i){this.addMatches(e,void 0)},t.prototype.removeProjMatches=function(e,t,i){this.removeMatches(e,void 0)},t.prototype.setIndexerMonitor=function(){if(void 0!==this.indexerMonitor&&(this.indexerMonitor.destroy(),this.indexerMonitor=void 0),this.needsKeyUpdates){var e=this.dataObj.getDominatedIndexer(),t=this.dataObj.getDominatedProjPathId();void 0!==e&&void 0!==t&&(this.indexerMonitor=new IndexerTracer(e,t,this))}},t.prototype.indexerUpdateKeys=function(e,t,i,r,n){this.elementIDUpdates=void 0===this.elementIDUpdates?e:this.elementIDUpdates.concat(e),this.typeUpdates=void 0===this.typeUpdates?t:this.typeUpdates.concat(t),this.keyUpdates=void 0===this.keyUpdates?i:this.keyUpdates.concat(i),this.prevTypeUpdates=void 0===this.prevTypeUpdates?r:this.prevTypeUpdates.concat(r),this.prevKeyUpdates=void 0===this.prevKeyUpdates?n:this.prevKeyUpdates.concat(n),this.qcm.scheduleCompleteIncrementalUpdate(this)},t.prototype.removeAllIndexerMatches=function(){assert(!1,"this function should never be called")},t.prototype.completeIncrementalUpdate=function(){var e=this.dataObj.getDominatedIndexer(),t=this.dataObj.getDominatedProjPathId(),i=e.pathNodesById[t];if(void 0!==this.removedMatches){var r=this.pathNodePrevKeys&&this.pathNodePrevKeys.size>0?this.pathNodePrevKeys:void 0;this.subtract(this.removedMatches,r,i.nodes)}if(void 0!==this.addedMatches&&this.add(this.addedMatches,i.nodes),void 0!==this.keyUpdates)for(var n=this.dataObj.filterDominatedMatchPositions(this.elementIDUpdates),o=0===n.length?void 0:void 0===this.addedMatches?new Set:this.addedMatches.reduce(function(e,t){return e.add(t),e},new Set),s=0;s<n.length;s++){var a=n[s],d=this.elementIDUpdates[a];o.has(d)||this.change(d,this.prevTypeUpdates[a],this.prevKeyUpdates[a],this.typeUpdates[a],this.keyUpdates[a])}this.needsKeyUpdates&&this.wrapUp(i),void 0===this.keyUpdates&&void 0===this.removedMatches&&void 0===this.addedMatches||this.markAsChanged(),this.addedMatches=void 0,this.removedMatches=void 0,this.elementIDUpdates=void 0,this.typeUpdates=void 0,this.keyUpdates=void 0,this.prevTypeUpdates=void 0,this.prevKeyUpdates=void 0,this.pathNodePrevKeys=void 0,this.activeDiffUpdateMode=!1},t}(FuncResult),SizeDSFunction=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(){this.value=0},t.prototype.reset=function(){this.value=0},t.prototype.add=function(e,t){this.value=this.value+e.length},t.prototype.subtract=function(e,t,i){this.value=this.value-e.length},t.prototype.change=function(e,t,i,r,n){},t}(AggregateDSFunction),NotDSFunction=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nrTrueElements=0,t.needsKeyUpdates=!0,t}return __extends(t,e),t.prototype.init=function(){this.value=!0,this.nrTrueElements=0},t.prototype.reset=function(){this.value=!0,this.nrTrueElements=0},t.prototype.add=function(e,t){for(var i=0;i<e.length;i++){var r=t.get(e[i]);void 0===r||"boolean"===r.type&&r.key===!1||this.nrTrueElements++}this.setValue(0===this.nrTrueElements)},t.prototype.subtract=function(e,t,i){for(var r=0;r<e.length;r++){var n=dataSourceGetSubtractionKey(t,i,e[r]);"boolean"===n.type&&n.key===!1||this.nrTrueElements--}this.setValue(0===this.nrTrueElements)},t.prototype.change=function(e,t,i,r,n){"boolean"===t&&i===!1||this.nrTrueElements--,"boolean"===r&&n===!1||this.nrTrueElements++,this.setValue(0===this.nrTrueElements)},t}(AggregateDSFunction),NotEmptyDSFunction=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(){this.value=!1,this.nrElements=0},t.prototype.reset=function(){this.value=!1,this.nrElements=0},t.prototype.add=function(e,t){this.nrElements+=e.length,this.value=0!==this.nrElements},t.prototype.subtract=function(e,t,i){this.nrElements-=e.length,this.value=0!==this.nrElements},t.prototype.change=function(e,t,i,r,n){},t}(AggregateDSFunction),SumDSFunction=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.needsKeyUpdates=!0,t}return __extends(t,e),t.prototype.init=function(){this.value=0,this.nrValues=0},t.prototype.reset=function(){this.value=0,this.nrValues=0},t.prototype.add=function(e,t){for(var i=0;i<e.length;i++){var r=t.get(e[i]);void 0!==r&&"number"===r.type&&(this.value+=r.key,this.nrValues++)}},t.prototype.subtract=function(e,t,i){for(var r=0;r<e.length;r++){var n=dataSourceGetSubtractionKey(t,i,e[r]);void 0!==n&&"number"===n.type&&(this.nrValues--,0===this.nrValues?this.value=0:this.value-=n.key)}},t.prototype.change=function(e,t,i,r,n){"number"===t&&(this.value-=i),"number"===r&&(this.value+=n)},t}(AggregateDSFunction),MinDSFunction=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nrMinElements=0,t.needsKeyUpdates=!0,t}return __extends(t,e),t.prototype.init=function(){this.value=void 0,this.nrMinElements=0},t.prototype.reset=function(){this.value=void 0,this.nrMinElements=0},t.prototype.add=function(e,t){for(var i=0;i<e.length;i++){var r=t.get(e[i]);void 0!==r&&(void 0===this.value||r.key<this.value?(this.value=r.key,this.nrMinElements=1):r.key===this.value&&this.nrMinElements++)}},t.prototype.subtract=function(e,t,i){for(var r=0;r<e.length;r++){var n=dataSourceGetSubtractionKey(t,i,e[r]);n.key===this.value&&this.nrMinElements--}0===this.nrMinElements&&this.reset()},t.prototype.change=function(e,t,i,r,n){i===this.value&&this.nrMinElements--,void 0===this.value||n<this.value?(this.value=n,this.nrMinElements=1):n===this.value&&this.nrMinElements++},t.prototype.wrapUp=function(e){0===this.nrMinElements&&this.reset(),void 0===this.value&&this.add(this.dataObj.getDominatedMatches(),e.nodes)},t}(AggregateDSFunction),MaxDSFunction=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nrMaxElements=0,t.needsKeyUpdates=!0,t}return __extends(t,e),t.prototype.init=function(){this.value=void 0,this.nrMaxElements=0},t.prototype.reset=function(){this.value=void 0,this.nrMaxElements=0},t.prototype.add=function(e,t){for(var i=0;i<e.length;i++){var r=t.get(e[i]);void 0!==r&&(void 0===this.value||r.key>this.value?(this.value=r.key,this.nrMaxElements=1):r.key===this.value&&this.nrMaxElements++)}},t.prototype.subtract=function(e,t,i){for(var r=0;r<e.length;r++){var n=dataSourceGetSubtractionKey(t,i,e[r]);n.key===this.value&&this.nrMaxElements--}0===this.nrMaxElements&&this.reset()},t.prototype.change=function(e,t,i,r,n){i===this.value&&this.nrMaxElements--,void 0===this.value||n>this.value?(this.value=n,this.nrMaxElements=1):n===this.value&&this.nrMaxElements++},t.prototype.wrapUp=function(e){0===this.nrMaxElements&&this.reset(),void 0===this.value&&this.add(this.dataObj.getDominatedMatches(),e.nodes)},t}(AggregateDSFunction),BoolDSFunction=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nrTrueElements=0,t.needsKeyUpdates=!0,t}return __extends(t,e),t.prototype.init=function(){this.value=!1,this.nrTrueElements=0},t.prototype.reset=function(){this.value=!1,this.nrTrueElements=0},t.prototype.add=function(e,t){for(var i=0;i<e.length;i++){var r=t.get(e[i]);void 0===r||"boolean"===r.type&&r.key===!1||this.nrTrueElements++}this.setValue(0!==this.nrTrueElements)},t.prototype.subtract=function(e,t,i){for(var r=0;r<e.length;r++){var n=dataSourceGetSubtractionKey(t,i,e[r]);void 0===n||"boolean"===n.type&&n.key===!1||this.nrTrueElements--}this.setValue(0!==this.nrTrueElements)},t.prototype.change=function(e,t,i,r,n){"boolean"===t&&i===!1||this.nrTrueElements--,"boolean"===r&&n===!1||this.nrTrueElements++,this.setValue(0!==this.nrTrueElements)},t}(AggregateDSFunction),SingleValueDSFunction=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=void 0,t.needsKeyUpdates=!0,t.dataElementId=void 0,t}return __extends(t,e),t.prototype.init=function(){},t.prototype.reset=function(){this.value=void 0,this.dataElementId=void 0},t.prototype.add=function(e,t){var i;if(void 0===this.dataElementId){for(var r=0;r<e.length;r++)if(i=t.get(e[r]),void 0!==i){this.dataElementId=e[r];break}void 0!==this.dataElementId&&this.setValue(i.key)}},t.prototype.subtract=function(e,t,i){e.indexOf(this.dataElementId)>=0&&this.reset()},t.prototype.wrapUp=function(e){void 0===this.dataElementId&&this.add(this.dataObj.getDominatedMatches(),e.nodes)},t.prototype.change=function(e,t,i,r,n){e===this.dataElementId&&this.setValue(n)},t}(AggregateDSFunction),SimpleValueMatchDSFunction=function(e){function t(t,i,r,n){var o=e.call(this,i,r,n)||this;return o.nrMatchingElements=0,o.needsKeyUpdates=!0,o.simpleMatchValue=t,o}return __extends(t,e),t.prototype.init=function(){this.value=!1,this.nrMatchingElements=0},t.prototype.reset=function(){this.value=!1,this.nrMatchingElements=0},t.prototype.add=function(e,t){for(var i=0;i<e.length;i++){var r=t.get(e[i]);void 0!==r&&r.key===this.simpleMatchValue&&this.nrMatchingElements++}this.setValue(0!==this.nrMatchingElements)},t.prototype.subtract=function(e,t,i){for(var r=0;r<e.length;r++){var n=dataSourceGetSubtractionKey(t,i,e[r]);n.key===this.simpleMatchValue&&this.nrMatchingElements--}this.setValue(0!==this.nrMatchingElements)},t.prototype.change=function(e,t,i,r,n){i===this.simpleMatchValue&&this.nrMatchingElements--,n===this.simpleMatchValue&&this.nrMatchingElements++,this.setValue(0!==this.nrMatchingElements)},t}(AggregateDSFunction),ChangeCountDSFunction=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.value=0,n.parent=r,n.setData(i),n.markAsChanged(),n}return __extends(t,e),t.prototype.markAsChanged=function(){this.value++,this.parent.newResult([this.value])},t.prototype.supportsMultiProj=function(){return!1},t.prototype.isActive=function(){return this.parent.activatingReceivers>0},t.prototype.refreshIndexerAndPaths=function(e){this.markAsChanged()},t.prototype.replaceIndexerAndPaths=function(e,t,i){},t.prototype.addMatches=function(e,t){this.markAsChanged()},t.prototype.removeMatches=function(e,t){this.markAsChanged()},t.prototype.removeAllMatches=function(e){this.markAsChanged()},t.prototype.addDataObjMatches=function(e,t,i){this.markAsChanged()},t.prototype.removeDataObjMatches=function(e,t,i){this.markAsChanged()},t.prototype.refreshProjMappings=function(e){},t.prototype.addProjMatches=function(e,t,i){this.markAsChanged()},t.prototype.removeProjMatches=function(e,t,i){this.markAsChanged()},t}(FuncResult),ChangeInformerFunction=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.parent=r,n.setData(i),n}return __extends(t,e),t.prototype.supportsMultiProj=function(){return!1},t.prototype.isActive=function(){return this.parent.activatingReceivers>0},t.prototype.refreshIndexerAndPaths=function(e){this.parent.newResult([{operation:"refresh"}])},t.prototype.replaceIndexerAndPaths=function(e,t,i){},t.prototype.addMatches=function(e,t){this.parent.newResult([{operation:"add",elementIDs:e}])},t.prototype.removeMatches=function(e,t){this.parent.newResult([{operation:"remove",elementIDs:e}])},t.prototype.removeAllMatches=function(e){this.parent.newResult([{operation:"removeAll"}])},t.prototype.addDataObjMatches=function(e,t,i){this.parent.newResult([{operation:"add",elementIDs:this.dataObj.getDominatedMatches()}])},t.prototype.removeDataObjMatches=function(e,t,i){this.parent.newResult([{operation:"removeAll"}])},t.prototype.refreshProjMappings=function(e){this.parent.newResult([{operation:"refresh"}])},t.prototype.addProjMatches=function(e,t,i){this.parent.newResult([{operation:"remove",elementIDs:e}])},t.prototype.removeProjMatches=function(e,t,i){this.parent.newResult([{operation:"remove",elementIDs:e}])},t}(FuncResult),DataSourceOrdering=function(e){function t(t,i,r,n){var o=e.call(this,r,n)||this;return o.ordering=void 0,o.orderingString="",o.changeCount=0,o.watcherId=i,o.funcResult=new RangeOrderResult(globalInternalQCM),o.updateOrdering(t),o.refreshFuncResult(),o}return __extends(t,e),t.prototype.destroy=function(){assert(void 0!==this.input,"do not destroy twice"),this.ordering=void 0,this.orderingString=void 0,e.prototype.destroy.call(this)},t.prototype.refreshFuncResult=function(){this.funcResult.setData(this.input.funcResult)},t.prototype.isEqual=function(e){return this===e||e instanceof t&&(this.funcResult.getId()===e.funcResult.getId()||this.orderingString===e.orderingString&&this.input.isEqual(e.input))},t.prototype.updateOrdering=function(e){var t=cdlifyNormalized(e);if(this.orderingString!==t){var i,r=!1,n=!1;e instanceof Array&&(e.length>1&&Utilities.warn("No support for os of ranges in [pos]"),e=e[0]),e instanceof RangeValue?(i=[e.min,e.max],r=!e.closedLower,n=!e.closedUpper):"number"==typeof e?i=[e,e]:(i=[0,0],r=!0,n=!0),this.funcResult.updateOffsets(i,r,n,!1),this.ordering=e,this.orderingString=t}},t.prototype.debugInfo=function(){return this.debugActive()+"pos "+this.orderingString+": "+this.debugMatchList()},t.prototype.accumulatedQuery=function(){var e=this.input.accumulatedQuery();return{position:this.orderingString,from:e}},t.prototype.getDebugResult=function(){return this.input.getDebugResult()},t}(DataSourceComposable),DataSourceSort=function(e){function t(t,i,r,n){var o=e.call(this,r,n)||this;return o.comparisonResults=[],o.comparisonQueries=[],o.pathComparisons=t,o.sortString=o.makeSortString(),o.watcherId=i,o.updateSortKeys(t),o}return __extends(t,e),t.prototype.destroy=function(){assert(void 0!==this.input,"do not destroy twice"),this.destroyComparisonResults(0),this.destroyComparisonQueries(0),this.funcResult===this.input.funcResult&&(this.funcResult=void 0),this.input.removeSortApplication(this),e.prototype.destroy.call(this)},t.prototype.updateComparisonQueries=function(e,t,i){var r,n,o;void 0===e&&(e={comparison:new PartitionComparison(globalInternalQCM),queries:[],queryDescs:[],indexers:[]});for(var s=0;s<i.queries.length;s++)s<e.queries.length?e.indexers[s].replaceRawObject(i.queries[s]):(r=new FEGReplaceableValueIndexer(globalInternalQCM),r.replaceRawObject(i.queries[s]),e.indexers.push(r),n=new DataResult(globalInternalQCM,r,globalInternalQCM.getRootPathId()),e.queryDescs.push(n),o=new Query(globalInternalQCM),o.setData(n),e.queries.push(o));for(;s<e.queries.length;s++)e.queries[s].destroy(),e.queryDescs[s].destroy(),e.indexers[s].destroy();return e.queries.length=i.queries.length,e.queryDescs.length=i.queries.length,e.indexers.length=i.queries.length,e.comparison.setPartition(t,e.queries,i.unmatched===-1?void 0:i.unmatched,i.inAscendingOrder,i.orderByValue?i.inAscendingOrder:void 0),e},t.prototype.destroyComparisonResults=function(e){for(var t=this.comparisonResults.length-1;t>=e;t--)this.comparisonResults[t].destroy();this.comparisonResults.length=e},t.prototype.destroyComparisonQueries=function(e){for(var t=this.comparisonQueries.length-1;t>=e;t--){
for(var i=this.comparisonQueries[t],r=0;r<i.queries.length;r++)i.queries[r].destroy();for(var r=0;r<i.queryDescs.length;r++)i.queryDescs[r].destroy();for(var r=0;r<i.indexers.length;r++)i.indexers[r].destroy()}this.comparisonQueries.length=e},t.prototype.updateSortKeys=function(e){for(var t=this.input.funcResult,i=globalInternalQCM.getRootPathId(),r=0,n=e.length-1;n>=0;n--)for(var o=e[n],s=globalInternalQCM.allocatePathIdFromPath(i,o.path),a=o.comparisons.length-1;a>=0;a--){for(var d=r;d<this.comparisonQueries.length;d++)if(this.comparisonQueries[d].comparison.projPathId==s){if(d==r)break;var u=this.comparisonQueries[r];this.comparisonQueries[r]=this.comparisonQueries[d],this.comparisonQueries[d]=u,this.comparisonResults[r].setComparison(this.comparisonQueries[r].comparison)}if(this.comparisonQueries[r]=this.updateComparisonQueries(this.comparisonQueries[r],s,o.comparisons[a]),r<this.comparisonResults.length)this.comparisonResults[r].setComparison(this.comparisonQueries[r].comparison);else{var h=new CompResult(globalInternalQCM);h.setComparison(this.comparisonQueries[r].comparison),h.setData(t),this.comparisonResults[r]=h}t=this.comparisonResults[r],r++}this.pathComparisons=e,this.sortString=this.makeSortString(),this.funcResult!==t&&(this.funcResult=t,this.signalNewFuncResultToApplications(this.funcResult)),this.comparisonQueries.length>r&&(this.destroyComparisonResults(r),this.destroyComparisonQueries(r))},t.prototype.refreshFuncResult=function(){this.comparisonResults.length>0?this.comparisonResults[0].setData(this.input.funcResult):this.funcResult!==this.input.funcResult&&(this.funcResult=this.input.funcResult,this.signalNewFuncResultToApplications(this.funcResult))},t.prototype.isEqual=function(e){return this===e||e instanceof t&&(this.funcResult.getId()===e.funcResult.getId()||this.sortString===e.sortString&&this.input.isEqual(e.input))},t.prototype.debugInfo=function(){return this.debugActive()+"sort "+this.sortString},t.prototype.accumulatedQuery=function(){var e=this.input.accumulatedQuery();return{sort:this.sortString,from:e}},t.prototype.makeSortString=function(){var e=this.pathComparisons.map(function(e){for(var t=e.comparisons.map(function(e){var t=e.inAscendingOrder?"ascending":"descending";if(e.orderByValue)return"c("+cdlify(e.queries[0])+", "+t+")";var i=e.queries.map(flatcdlify);return e.unmatched>-1&&i.splice(e.unmatched,0,"unmatched"),"c("+i.join(",")+")"}),i=1===t.length?t[0]:"o("+t.join(",")+")",r=e.path.length-1;r>=0;r--)i="{"+e.path[r]+": "+i+"}";return i});return 1===e.length?e[0]:"o("+e.join(", ")+")"},t.prototype.getDebugResult=function(){return this.input.getDebugResult()},t}(DataSourceComposable),DataSourceIdentityApplication=function(e){function t(t,i,r,n){var o=e.call(this,i,r)||this;return o.watcherId=getNextWatcherId(),o.identityAttribute=t,o.funcResult=new IdentityResult(globalInternalQCM,i.funcResult),""===t?o.funcResult.setIdentificationData(i.funcResult):(o.idQuery={},o.idQuery[t]=_,o.idQueryDS=i.applyDataQuery(o.idQuery,o,n),o.funcResult.setIdentificationData(o.idQueryDS.funcResult)),o}return __extends(t,e),t.prototype.destroy=function(){assert(void 0!==this.identityAttribute,"do not destroy twice"),assert(this.input.identityDSMap.has(this.identityAttribute),"must be registered on data source"),void 0!==this.idQueryDS&&(this.idQueryDS.removeResultReceiver(this),this.idQueryDS=void 0),this.input.removeIdentityApplication(this),this.identityAttribute=void 0,e.prototype.destroy.call(this)},t.prototype.refreshFuncResult=function(){this.funcResult.setData(this.input.funcResult)},t.prototype.isEqual=function(e){return this===e||e instanceof t&&(this.identityAttribute===e.identityAttribute&&this.input.isEqual(e.input))},t.prototype.debugInfo=function(){return this.debugActive()+"identify:"+this.identityAttribute},t.prototype.accumulatedQuery=function(){var e=this.input.accumulatedQuery();return{identity:this.identityAttribute,from:e}},t.prototype.getDebugResult=function(){return this.input.getDebugResult()},t.prototype.newDataSourceResult=function(e){},t.prototype.reextractData=function(e){},t}(DataSourceComposable),DataSourceElementIdTransformation=function(e){function t(t,i,r){var n=e.call(this,i,r)||this;return n.transformationName=t,n}return __extends(t,e),t.prototype.destroy=function(){assert(void 0!==this.transformationName,"do not destroy twice"),assert(this.input.elementIdTransformationMapDSMap.has(this.transformationName),"must be registered on data source"),this.input.removeElementIdTransformation(this),this.transformationName=void 0,e.prototype.destroy.call(this)},t.prototype.refreshFuncResult=function(){this.funcResult.setData(this.input.funcResult)},t.prototype.isEqual=function(e){return this===e||e instanceof t&&(this.transformationName===e.transformationName&&this.input.isEqual(e.input))},t.prototype.debugInfo=function(){return this.debugActive()+this.transformationName},t.prototype.accumulatedQuery=function(){var e=this.input.accumulatedQuery();return{transform:this.transformationName,from:e}},t}(DataSourceComposable),DataSourceUniqueById=function(e){function t(t,i){var r=e.call(this,"uniqueById",t,i)||this;return r.watcherId=getNextWatcherId(),r.mergeIndexer=new MergeIndexer(globalInternalQCM),r.sourceIdentificationId=t.funcResult.getDominatedIdentification(),void 0===r.sourceIdentificationId?(r.identify=t.applyIdentity("",r,void 0),r.sourceIdentificationId=r.identify.funcResult.getDominatedIdentification()):r.identify=void 0,r.resultToMerge=new ResultToMerge(globalInternalQCM,r.mergeIndexer,globalInternalQCM.getRootPathId(),0,r.sourceIdentificationId,void 0,!0,!0),r.funcResult=new DataResult(globalInternalQCM,r.mergeIndexer,globalInternalQCM.getRootPathId()),r.resultToMerge.setData(void 0===r.identify?t.funcResult:r.identify.funcResult),r}return __extends(t,e),t.prototype.destroy=function(){this.resultToMerge.destroy(),this.resultToMerge=void 0,this.mergeIndexer.destroy(),this.mergeIndexer=void 0,void 0!==this.identify&&(this.identify.removeResultReceiver(this),this.identify=void 0),e.prototype.destroy.call(this)},t.prototype.getDebugResult=function(){return this.input.getDebugResult()},t.prototype.newDataSourceResult=function(e){},t.prototype.reextractData=function(e){},t}(DataSourceElementIdTransformation),DataSourceMergeUnderIdentityWithPath=function(e){function t(t,i,r){var n=e.call(this,t,r)||this,o=globalInternalQCM.allocatePathId(void 0,i);return n.pathString=i,n.watcherId=r.watcherId,n.combinedIndexer=new MergeIndexer(globalInternalQCM),n.pathNode=n.combinedIndexer.addPath(o),n.resultToMerge=new ResultToMerge(globalInternalQCM,n.combinedIndexer,o,0,0,void 0,!0,!1),n.funcResult=new DataResult(globalInternalQCM,n.combinedIndexer,globalInternalQCM.getRootPathId()),n.resultToMerge.setData(t.funcResult),n}return __extends(t,e),t.prototype.activate=function(){assert(0===this.activatingReceivers,"must be activated only once"),this.combinedIndexer.incPathNodeTracing(this.pathNode),this.activatingReceivers=1},t.prototype.deactivate=function(){assert(1===this.activatingReceivers,"must be deactivated only once"),this.combinedIndexer.decPathNodeTracing(this.pathNode),this.activatingReceivers=0},t.prototype.destroy=function(){assert(0===this.activatingReceivers,"still active"),this.resultToMerge.destroy(),this.resultToMerge=void 0,this.combinedIndexer.destroy(),this.combinedIndexer=void 0,e.prototype.destroy.call(this)},t.prototype.debugInfo=function(){return this.debugActive()+"mergeUnderIdentityWithPath"},t.prototype.refreshFuncResult=function(){this.funcResult.setData(this.input.funcResult)},t.prototype.accumulatedQuery=function(){return{from:this.input.accumulatedQuery(),identity:this.pathString}},t.prototype.isEqual=function(e){return e instanceof t&&(this.pathString===e.pathString&&this.input.isEqual(e.input))},t.prototype.getDebugResult=function(){var e=this.input.getDebugResult(),t={};return t[this.pathString]=e,[t]},t}(DataSourceComposable),FuncResultWatcher=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.active=!1,n.controller=i,n.tag=r,n}return __extends(t,e),t.prototype.supportsMultiProj=function(){return!1},t.prototype.isActive=function(){return this.active},t.prototype.activate=function(){this.active||(this.activated(),this.active=!0)},t.prototype.deactivate=function(){this.active&&(this.deactivated(),this.active=!1)},t.prototype.refreshIndexerAndPaths=function(e){this.controller.refreshIndexerAndPaths(this.tag,e)},t.prototype.replaceIndexerAndPaths=function(e,t,i){this.controller.replaceIndexerAndPaths(this.tag,e,t,i)},t.prototype.refreshProjMappings=function(e){Utilities.error("not expected to be called")},t.prototype.addDataObjMatches=function(e,t,i){if(t)this.addMatches(this.dataObj.getDominatedMatches(),this.dataObj);else{var r=[],n=[];this.dataObj.getDifference(e,r,n),0!==r.length&&this.addMatches(r,this.dataObj),0!==n.length&&this.removeMatches(n,this.dataObj)}},t.prototype.removeDataObjMatches=function(e,t,i){t&&this.controller.removeAllElementIds(this.tag)},t.prototype.addMatches=function(e,t){this.controller.addElementIds(e,this.tag)},t.prototype.removeMatches=function(e,t){this.controller.removeElementIds(e,this.tag)},t.prototype.removeAllMatches=function(e){this.controller.removeAllElementIds(this.tag)},t.prototype.addProjMatches=function(e,t,i){this.controller.addElementIds(e,this.tag)},t.prototype.removeProjMatches=function(e,t,i){this.controller.removeElementIds(e,this.tag)},t}(FuncResult),testReuseOrderResult=!1,OrderingResultWatcher=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.orderResult=void 0,n.rangeOrderResultOwned=!1,n.active=!1,n.dataElementIdsInOrder=[],n.controller=i,n.tag=r,n}return __extends(t,e),t.prototype.destroy=function(){this.orderResult.removeOrderTracing(this),e.prototype.destroy.call(this),this.controller=void 0,this.tag=void 0,this.rangeOrderResultOwned&&(this.orderResult.destroy(),this.rangeOrderResultOwned=!1),this.orderResult=void 0},t.prototype.init=function(e){testReuseOrderResult&&e instanceof DataSourceOrdering?this.orderResult=e.funcResult:(this.orderResult=new RangeOrderResult(globalInternalQCM),this.orderResult.updateOffsets([0,1/0],!1,!1,!0),this.orderResult.setData(e.funcResult),this.rangeOrderResultOwned=!0),this.setData(this.orderResult),this.orderResult.addOrderTracing(this)},t.prototype.supportsMultiProj=function(){return!1},t.prototype.isActive=function(){return this.active},t.prototype.activate=function(){this.active||(this.activated(),this.active=!0)},t.prototype.deactivate=function(){this.active&&(this.deactivated(),this.active=!1)},t.prototype.refreshIndexerAndPaths=function(e){this.controller.refreshIndexerAndPaths(this.tag,e)},t.prototype.replaceIndexerAndPaths=function(e,t,i){this.controller.replaceIndexerAndPaths(this.tag,e,t,i)},t.prototype.updatePos=function(e,t,i,r){var n=this.dataElementIdsInOrder;n=cconcat(n.slice(0,t),e),n.length<r&&(n=cconcat(n,this.dataElementIdsInOrder.slice(i+1,r))),this.dataElementIdsInOrder=n,this.controller.updateDataElementPosition(e,t,i,r)},t.prototype.refreshProjMappings=function(e){Utilities.error("not expected to be called")},t.prototype.addDataObjMatches=function(e,t,i){},t.prototype.removeDataObjMatches=function(e,t,i){},t.prototype.addMatches=function(e,t){},t.prototype.removeMatches=function(e,t){},t.prototype.removeAllMatches=function(e){},t.prototype.addProjMatches=function(e,t,i){},t.prototype.removeProjMatches=function(e,t,i){},t}(FuncResult),globalInternalQCM=new InternalQCM,ContextAttributeTracer=function(){function e(){this.traced={},this.totalUpdateInputTime=0,this.attributedTime=0,this.watcherId=getNextWatcherId(),this.dataSourceAware=!0}return e.prototype.isBeingTraced=function(e,t){return e in this.traced&&t in this.traced[e]},e.prototype.addTraceFor=function(e,t){var i=allAreaMonitor.allAreas[e];if(e in this.traced||(allAreaMonitor.addAreaSpecificWatcher(e,this,["signal",e]),this.traced[e]={}),void 0===i&&""!==e||void 0!==this.traced[e][t])return void(this.traced[e][t]=void 0);var r;if("string"==typeof t){if(""===e)return void console.log("cannot trace attribute names in global nodes");r=debugAreaInfo[i.template.id].context[t]}else r={defunNr:0,index:t,level:0,suppressSet:!1};if(void 0===r)return void console.log("no such attribute:","@"+e,t);var n=""===e?globalEvaluationNodes[r.index]:i.getExprByFNRef(r,!0,!1);return void 0===n?void console.log("no such attribute:","@"+e,t):(this.traced[e][t]=n,n.addWatcher(this,["value",e,t],!1,!0,!1),void(n.isScheduled()?n.addForcedUpdate(this):console.log("trace",e,t,n.result.value)))},e.prototype.removeTraceFor=function(e,t,i){if(void 0===i&&(i=!0),e in this.traced&&t in this.traced[e]){var r=this.traced[e][t];void 0!==r&&r.removeWatcher(this,!0,!1),i?(delete this.traced[e][t],Utilities.isEmptyObj(this.traced[e])&&(delete this.traced[e],allAreaMonitor.removeAreaSpecificWatcher(e,this))):this.traced[e][t]=void 0}},e.prototype.updateInput=function(e,t){var i=e[0],r=e[1];switch(i){case"signal":if(0!==t.value.length){var n=allAreaMonitor.getAreaById(r);n.initWatchers();for(var o in this.traced[r])this.addTraceFor(r,o)}else for(var o in this.traced[r])this.removeTraceFor(r,o,!1),console.log("trace",r,o,"destroyed");break;case"value":var s=e[2];if(void 0!==t)console.log("trace",r,s,t.value);else{var a=this.traced[r][s];a.removeWatcher(this,!0,!1),this.traced[r][s]=void 0,console.log("trace",r,s,"destroyed")}}},e.prototype.isActive=function(){return!0},e.prototype.isReady=function(){return!0},e.prototype.isDeferred=function(){return!1},e.prototype.defer=function(){},e.prototype.undefer=function(){},e.prototype.debugName=function(){return"contextTrace"},e.prototype.getDebugOrigin=function(){return["contextTrace"]},e}(),gContextAttributeTracer=new ContextAttributeTracer,cT=contextTrace,areaDebugBreaks={},gGlobalDefaultChangeList=[{}],dbgCreateList=void 0,SimpleLogger=function(){function e(){this.logs=[],this.print=!0}return e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=e.join(" ");this.print?console.log(i):this.logs.push(i)},e}(),gSimpleLog=new SimpleLogger,logPrototypes={},DataPosition=function(){function e(t,i,r,n,o,s){this.index=t,this.length=i,void 0!==r&&r.length>1?(this.path=[r[0]],this.sub=[new e(0,1,r.slice(1),n)]):(void 0!==r&&(this.path=r),void 0!==n&&(this.sub=n)),void 0!==o&&(this.addedAttributes=o),void 0!==s&&(this.identity=s)}return e.prototype.copy=function(){return new e(this.index,this.length,this.path,this.sub,shallowCopy(this.addedAttributes),this.identity)},e.prototype.addPath=function(t,i){return void 0===this.path?new e(this.index,this.length,t,i):new e(this.index,this.length,this.path,this.sub.map(function(e){return e.addPath(t,i)}))},e.prototype.copyWithOffset=function(t){return new e(this.index-t,this.length,this.path,this.sub,this.addedAttributes,this.identity)},e.prototype.copyWithIdentity=function(t){return assert(void 0===this.identity||this.identity===t,"identity should not be overwritten"),new e(this.index,this.length,this.path,this.sub,this.addedAttributes,t)},e.prototype.copyWithAddedAttributes=function(t){var i=void 0===this.addedAttributes?{}:shallowCopy(this.addedAttributes);for(var r in t){if(r in i&&!objectEqual(t[r],i[r]))return Utilities.warn("non-matching added attributes"),this;i[r]=t[r]}return new e(this.index,this.length,this.path,this.sub,i,this.identity)},e.staticToString=function(t){return void 0===t.path?"("+t.index+", "+t.length+")":"("+t.index+", "+t.length+", "+t.path.join(".")+(void 0===t.identity?"":", "+t.identity)+"="+t.sub.map(e.staticToString).join(";")+")"},e.prototype.toString=function(){return void 0===this.path?"("+this.index+", "+this.length+")":"("+this.index+", "+this.length+", "+this.path.join(".")+"="+this.sub.map(e.staticToString).join(";")+")"},e.prototype.writesToPath=function(e,t){return void 0===t&&(t=0),"sub"in this&&0!==e.length?this.path[0]===e[t]&&this.sub.some(function(i){return i.writesToPath(e,t+1)}):!("sub"in this)&&0===e.length},e.toString=function(t){return void 0===t?"undefined":t.map(e.staticToString).join(",")},e}(),gProfile=!1,gDoCheckCycles=!1,EvaluationNode=function(){function e(t,i){this.isBeingInitialized=!0,this.result=new Result,this.watcherId=void 0,this.dataSourceAware=!1,this.watchers=new Map,this.nrActiveWatchers=0,this.nrNonDataSourceAwareActiveWatchers=0,this.actndsaw={},this.inputHasChanged=!0,this.nrCallsToUpdate=0,this.nrTimesChanged=0,this.scheduledAtPosition=-1,this.deferred=!1,this.watcherId=getNextWatcherId(),this.prototype=t,this.local=i,e.nrNodes++,gProfile&&(this.nrCallsToEval=0,this.totalEvalTime=0,this.totalInformWatchersTime=0,this.totalUpdateInputTime=0,this.nrQueueResets=0,this.attributedTime=0,this.totalAttributedTime=0),void 0!==dbgCreateList&&dbgCreateList.push({cls:"EvaluationNode",id:this.watcherId})}return e.prototype.destroy=function(){if(this.deferred?(this.inputHasChanged=!1,this.undefer()):this.isScheduled()&&(this.deferred?evaluationQueue.undefer(this):evaluationQueue.unschedule(this)),this.result=void 0,void 0!==this.watchers&&this.informAllWatchers(),this.removeAsWatcher(),0!==this.nrActiveWatchers){var t=this.prototype.localToArea;this.watchers.forEach(function(i){var r=i.watcher;r instanceof e?assert(r.prototype.localToDefun&&r.prototype.localToArea===t,"only defuns in same area can be watching after destroy"):Utilities.error("non-evaluation node watching after destroy")})}this.inputs=void 0,this.watchers=void 0,void 0!==this.awaitingThis&&(this.awaitingThis.forEach(function(e){e.undefer(),evaluationQueue.schedule(e,!1)}),this.awaitingThis=void 0),gProfile&&this.accumulateTime(),e.nrNodes--},e.prototype.getScheduleStep=function(){return this.prototype.scheduleStep},e.prototype.getSchedulePriority=function(){return this.prototype.prio},e.prototype.isScheduled=function(){return this.scheduledAtPosition!==-1},e.prototype.updateOutput=function(){assert(!this.isBeingInitialized,"no eval during initialization"),assert(!this.deferred,"cannot evaluate deferred nodes"),this.nrCallsToUpdate++;var e;if(this.nrActiveWatchers>0){if("schedulingError"in this.prototype&&!this.isReady())return void this.defer();e=!!this.inputHasChanged&&this.evalt()}else e=!1;if(!this.deferred)switch(void 0!==e&&void 0!==this.awaitingThis&&(this.awaitingThis.forEach(function(e){e.undefer(),evaluationQueue.schedule(e,!1)}),this.awaitingThis=void 0),e){case!0:this.nrTimesChanged++,logValues&&this.isLogNode()&&gSimpleLog.log(this.logValString(),"=",JSON.stringify(this.result.value)),this.scheduledAtPosition!==-1?this.addAllWatchersToForcedUpdate():this.informAllWatchers();break;case!1:if("forcedUpdate"in this&&!this.deferred){var t=this.forcedUpdate;delete this.forcedUpdate,this.inform(t)}break;case void 0:this.inputHasChanged=!0,evaluationQueue.schedule(this,!1)}},e.prototype.markAsChanged=function(){this.inputHasChanged=!0,this.deferred&&this.undefer(),this.nrActiveWatchers>0&&evaluationQueue.schedule(this,!1)},e.prototype.evalt=function(){var e;if(this.inputHasChanged=!1,g_noTryAndCatchUpdate){if(gProfile){var t=performance.now();e=this.eval();var i=performance.now()-t;return this.totalEvalTime+=i,this.attributedTime+=i,this.nrCallsToEval++,e}return this.eval()}try{if(gProfile){var t=performance.now();e=this.eval();var i=performance.now()-t;return this.totalEvalTime+=i,this.attributedTime+=i,this.nrCallsToEval++,e}return this.eval()}catch(e){console.log("run time error during eval:",e.toString())}return!1},e.prototype.init=function(){this.isConstant()&&(this.eval(),logValues&&this.isLogNode()&&gSimpleLog.log(this.logValString(),"=",JSON.stringify(this.result.value)),this.watchers=void 0)},e.prototype.isConstant=function(){return!1},e.prototype.resultIsTransient=function(){return!1},e.prototype.addWatcher=function(e,t,i,r,n){if(!this.isConstant()){if(this.watchers.has(e.watcherId))this.watchers.get(e.watcherId).pos.push(t);else{var o=new Array(1);o[0]=t,this.watchers.set(e.watcherId,{watcher:e,pos:o})}i&&0===this.prototype.localToDefun&&this.forceUpdate(e,!1),gDoCheckCycles&&singleChangeCycleCheck(this),r&&e.isActive()&&(assert(void 0!==n,"debugging"),this.activate(e,n))}},e.prototype.isActive=function(){return this.nrActiveWatchers>0},e.prototype.forceUpdate=function(e,t){this.isScheduled()||evaluationQueue.schedule(this,t),this.addForcedUpdate(e)},e.prototype.addForcedUpdate=function(e){void 0===this.forcedUpdate&&(this.forcedUpdate=new Map),this.watchers.has(e.watcherId)&&this.forcedUpdate.set(e.watcherId,this.watchers.get(e.watcherId))},e.prototype.addAllWatchersToForcedUpdate=function(){var e=this;void 0===this.forcedUpdate&&(this.forcedUpdate=new Map),this.watchers.forEach(function(t,i){!e.forcedUpdate.has(i)&&e.watchers.has(i)&&e.forcedUpdate.set(i,e.watchers.get(i))})},e.prototype.removeWatcher=function(e,t,i){if(!this.isConstant()&&void 0!==this.watchers&&this.watchers.has(e.watcherId)){var r=this.watchers.get(e.watcherId).pos.length;if(this.watchers.delete(e.watcherId),t&&e.isActive())for(assert(void 0!==i,"debugging");r>0;)this.deactivate(e,i),r--;void 0!==this.awaitingThis&&this.awaitingThis.has(e.watcherId)&&(this.removeAwaitingThis(e.watcherId),e.isDeferred()&&e.undefer()),"forcedUpdate"in this&&this.forcedUpdate.delete(e.watcherId)}},e.prototype.removeWatcherForPos=function(e,t,i,r){if(!this.isConstant()&&void 0!==this.watchers&&this.watchers.has(e.watcherId)){var n=this.watchers.get(e.watcherId),o=n.pos.indexOf(t);assert(o>=0,"DEBUGGING"),1===n.pos.length?this.removeWatcher(e,i,r):(n.pos.splice(o,1),i&&e.isActive()&&(assert(void 0!==r,"debugging"),this.deactivate(e,r)))}},e.prototype.addAwaitingThis=function(e,t){void 0===this.awaitingThis&&(this.awaitingThis=new Map),this.awaitingThis.set(e,t)},e.prototype.removeAwaitingThis=function(e){this.awaitingThis.delete(e),0===this.awaitingThis.size&&(this.awaitingThis=void 0)},e.prototype.activate=function(e,t){this.isBeingInitialized&&console.log(this.watcherId+" did not complete initialization before activation"),this.isConstant()||(t||(dsaw_add(this.actndsaw,e.watcherId,1),this.nrNonDataSourceAwareActiveWatchers++,1===this.nrNonDataSourceAwareActiveWatchers&&this.setDataSourceResultMode(!1)),this.nrActiveWatchers++,assert(this.nrActiveWatchers>=this.nrNonDataSourceAwareActiveWatchers&&this.nrNonDataSourceAwareActiveWatchers>=0,"debugging"),1===this.nrActiveWatchers&&(logValues&&this.isLogNode()&&gSimpleLog.log("activate",this.logValString()),this.activateInputs(),this.inputHasChanged&&!this.isScheduled()&&evaluationQueue.schedule(this,!1)))},e.prototype.activateInputs=function(){if(assert(!this.isConstant(),"debugging"),void 0!==this.inputs)for(var e=0;e!==this.inputs.length;e++)void 0!==this.inputs[e]&&this.inputs[e].activate(this,this.dataSourceAware)},e.prototype.forceActive=function(e,t){return!!this.isConstant()||(this.activate(e,t),this.markAsChanged(),evaluationQueue.runUntil(this),this.isScheduled()&&(assert(this.deferred,"should have been evaluated now"),globalTaskQueue.isScheduled(globalGeometryTask)&&(globalPosConstraintSynchronizer.flushBuffer(),globalPos.reposition(void 0),evaluationQueue.runUntil(this))),!this.isScheduled())},e.prototype.deactivate=function(e,t){this.isConstant()||(assert(this.nrActiveWatchers>0,"too many deactivates"),this.nrActiveWatchers--,void 0!==this.awaitingThis&&this.awaitingThis.has(e.watcherId)&&this.removeAwaitingThis(e.watcherId),0!==this.nrActiveWatchers||this.isConstant()||(logValues&&this.isLogNode()&&gSimpleLog.log(this.logValString(),"deactivate"),this.deactivateInputs(),this.deferred?this.undefer():this.isScheduled()&&evaluationQueue.unschedule(this)),t||(dsaw_sub(this.actndsaw,e.watcherId,1),this.nrNonDataSourceAwareActiveWatchers--,0===this.nrNonDataSourceAwareActiveWatchers&&this.setDataSourceResultMode(!0)),assert(this.nrActiveWatchers>=this.nrNonDataSourceAwareActiveWatchers&&this.nrNonDataSourceAwareActiveWatchers>=0,"debugging"))},e.prototype.deactivateInputs=function(){if(assert(!this.isConstant(),"debugging"),void 0!==this.inputs)for(var e=0;e!==this.inputs.length;e++)void 0!==this.inputs[e]&&this.inputs[e].deactivate(this,this.dataSourceAware)},e.prototype.setDataSourceResultMode=function(e){assert(!this.dataSourceAware,"DEBUGGING")},e.prototype.activeWatcherBecomesDataSourceAware=function(e){this.isConstant()||(dsaw_sub(this.actndsaw,e.watcherId,1),this.nrNonDataSourceAwareActiveWatchers--,assert(this.nrActiveWatchers>=this.nrNonDataSourceAwareActiveWatchers&&this.nrNonDataSourceAwareActiveWatchers>=0,"debugging"),0===this.nrNonDataSourceAwareActiveWatchers&&this.setDataSourceResultMode(!0))},e.prototype.activeWatcherNoLongerIsDataSourceAware=function(e){this.isConstant()||(dsaw_add(this.actndsaw,e.watcherId,1),this.nrNonDataSourceAwareActiveWatchers++,assert(this.nrActiveWatchers>=this.nrNonDataSourceAwareActiveWatchers&&this.nrNonDataSourceAwareActiveWatchers>=0,"debugging"),1===this.nrNonDataSourceAwareActiveWatchers&&this.setDataSourceResultMode(!1))},e.prototype.informAllWatchers=function(){"forcedUpdate"in this&&delete this.forcedUpdate,void 0!==this.watchers&&this.inform(this.watchers)},e.prototype.inform=function(e){var t=this.result;if(void 0!==t&&void 0!==t.dataSource&&t.value!==emptyDataSourceResult,gProfile){var i=performance.now(),r=0,n=[];e.forEach(function(e){var i=e.watcher;i.isActive()&&n.push(i);for(var o=e.pos.length-1;o>=0;o--)try{var s=performance.now();i.updateInput(e.pos[o],t),s=performance.now()-s,i.totalUpdateInputTime+=s,i.attributedTime+=s,r+=s}catch(e){console.log("run time error during updateInput:",e.toString())}});var o=performance.now()-i-r;if(this.totalInformWatchersTime+=o,this.attributedTime+=o,n.length>0){this.totalAttributedTime+=this.attributedTime;var s=this.attributedTime/n.length;this.attributedTime=0;for(var a=0;a<n.length;a++)n[a].attributedTime+=s}}else g_noTryAndCatchUpdate?e.forEach(function(e){for(var i=e.pos.length-1;i>=0;i--)e.watcher.updateInput(e.pos[i],t)}):e.forEach(function(e){for(var i=e.pos.length-1;i>=0;i--)try{e.watcher.updateInput(e.pos[i],t)}catch(e){console.log("run time error during updateInput:",e.toString())}});void 0!==this.result&&"incremental"in this.result&&(this.result.incremental=!1)},e.prototype.removeAsWatcher=function(){if(void 0!==this.inputs){for(var e=0;e!==this.inputs.length;e++)void 0!==this.inputs[e]&&this.inputs[e].removeWatcher(this,!0,this.dataSourceAware);this.inputs=void 0}},e.prototype.write=function(e,t,i,r){Utilities.warn("dead ended write: "+this.prototype.idStr()+" at "+gWriteAction)},e.prototype.isQualified=function(){return!0},e.prototype.isReady=function(){for(var e=this.allInputs(),t=0;t!==e.length;t++)if(void 0!==e[t]&&e[t].scheduledAtPosition>=0)return!1;return!0},e.prototype.isDeferred=function(){return this.deferred},e.prototype.defer=function(){var t=this.allInputs();this.deferred=!0,evaluationQueue.defer(this);for(var i=0;i!==t.length;i++){var r=t[i];void 0!==r&&r.scheduledAtPosition!==-1&&(void 0===r.awaitingThis&&(r.awaitingThis=new Map),r.awaitingThis.set(this.watcherId,this))}this.watchers.forEach(function(t){var i=t.watcher;i instanceof e?"schedulingError"in i.prototype&&!i.isDeferred()&&i.isDeferableInput(t.pos,i)&&(i.isScheduled()&&evaluationQueue.unschedule(i),i.defer()):i instanceof TestNode&&(i.isDeferred()||(i.isScheduled()&&evaluationQueue.unschedule(i),i.defer()))})},e.prototype.undefer=function(){var e=this.allInputs();assert(this.deferred,"then don't call it"),this.deferred=!1,evaluationQueue.undefer(this);for(var t=0;t!==e.length;t++){var i=e[t];void 0!==i&&void 0!==i.awaitingThis&&i.awaitingThis.has(this.watcherId)&&i.removeAwaitingThis(this.watcherId)}if(this.inputHasChanged&&this.isActive())evaluationQueue.schedule(this,!1);else if(void 0!==this.awaitingThis){var r=this.awaitingThis;r.forEach(function(e,t){e.undefer(),evaluationQueue.schedule(e,!1)}),this.awaitingThis=void 0}},e.prototype.isDeferableInput=function(e,t){return!0},e.prototype.allInputs=function(){var e=this.inputs;return void 0===e?[]:e},e.prototype.allLogInputs=function(){return this.allInputs()},e.prototype.debugName=function(){var e=this;return e.__proto__.constructor.name},e.resetExplainFunctionNodes=function(){e.explainFunctionNodes={}},e.prototype.explain=function(t){var i;if(this.watcherId in e.explainFunctionNodes?i=e.explainFunctionNodes[this.watcherId]:(i={},e.explainFunctionNodes[this.watcherId]=i,this.specificExplanation(i,t)),void 0!==t&&"values"in t&&!("_definedIn"in i)){var r=t.values;i._definedIn=stripArray(r.map(getClassPath))}var n=this.getDebugOrigin();return void 0!==n&&(i._origin=1===n.length?n[0]:n),i},e.prototype.getDebugOrigin=function(){if("undefined"!=typeof functionNodeToExpressionPaths&&void 0!==this.prototype){var e=void 0!==this.prototype.localToArea?this.prototype.localToArea:0,t=this.prototype.localToDefun,i=this.prototype.id;if(void 0!==functionNodeToExpressionPaths[e]&&void 0!==functionNodeToExpressionPaths[e][t]&&void 0!==functionNodeToExpressionPaths[e][t][i]){for(var r=this.local.getEvaluationArea(),n=void 0!==r?r.areaId:"global",o=void 0!==r?r.template.id:void 0,s=functionNodeToExpressionPaths[e][t][i],a=[],d=0;d<s.length;d+=2)s[d]===o&&a.push(n+":"+functionNodeToExpressionPathsStringCache[s[d+1]]);return a}}},e.prototype.specificExplanation=function(e,t,i){if(void 0===i&&(i=!1),e._id=this.prototype.idStr(),void 0!==this.result&&"dataSource"in this.result){var r=this.result.dataSource,n=void 0===r.funcResult?void 0:r.funcResult.getDominatedProjPathId();e["_result: dataSource"]={path:void 0===n?"unknown":globalInternalQCM.getPathStrings(n).join("."),nrDataElements:r.debugMatchList(),funcResultId:r.funcResult.id,dataSourceId:r.id}}else e._result=void 0===this.result||this.result.hasLabels()?this.result:this.result.value;if(e._active=this.nrActiveWatchers,!i&&void 0!==this.inputs)for(var o=0;o!==this.inputs.length;o++)void 0!==this.inputs[o]&&(e[o+": "+this.inputs[o].debugName()]=this.inputs[o].explain(void 0));return gProfile&&(e._attributedTime=this.totalAttributedTime),e},e.prototype.toString=function(){return this.prototype.idStr()+"="+this.debugName()+(void 0===this.inputs?" = ":"("+this.inputs.map(function(e){return cdlifyLim(e.result.value,80)}).join(", ")+") = ")+cdlifyLim(this.result.value,80)},e.prototype.toFullString=function(){return(0!==this.nrActiveWatchers||this.isConstant()?this.debugName():"_"+this.debugName())+(void 0===this.inputs?"":"("+this.inputs.map(function(e){return e.toFullString()}).join(", ")+")")+" = "+cdlifyLim(this.result.value,80)},e.register=function(t,i){if(0===i.prototype.localToDefun){var r=void 0===t?"undefined":t.getOwnId();assert(!(i.watcherId in e.regNodes),"error reg"),e.regNodes[i.watcherId]=r,e.regEnvs[r]++}},e.unregister=function(t){0===t.prototype.localToDefun&&(assert(t.watcherId in e.regNodes,"error unreg"),e.regEnvs[e.regNodes[t.watcherId]]--,delete e.regNodes[t.watcherId])},e.registerEnv=function(t){assert(!(t in e.regEnvs),"error regEnv"),e.regEnvs[t]=0},e.unregisterEnv=function(t){assert(0===e.regEnvs[t],"error unregEnv"),delete e.regEnvs[t]},e.prototype.nrSimpleQueryWatchers=function(e){var t=0;return void 0!==this.watchers&&(e instanceof RangeValue?this.watchers.forEach(function(e){var i=e.watcher;i instanceof EvaluationApply&&i.query instanceof RangeValue&&t++}):e instanceof Object&&isAV(e)&&this.watchers.forEach(function(e){var i=e.watcher;i instanceof EvaluationApply&&i.query instanceof Object&&isAV(i.query)&&t++})),t},e.prototype.accumulateTime=function(){var t,i,r,n=this.prototype,o=e.accumulatedTimes;void 0!==o[n.localToArea]?t=o[n.localToArea]:o[n.localToArea]=t=[],void 0!==t[n.localToDefun]?i=t[n.localToDefun]:t[n.localToDefun]=i=[],void 0!==i[n.id]?(r=i[n.id],r.nrInstances++,r.nrCallsToUpdate+=this.nrCallsToUpdate,r.nrCallsToEval+=this.nrCallsToEval,r.nrTimesChanged+=this.nrTimesChanged,r.totalEvalTime+=this.totalEvalTime,r.totalInformWatchersTime+=this.totalInformWatchersTime,r.totalUpdateInputTime+=this.totalUpdateInputTime,r.totalAttributedTime+=this.totalAttributedTime,r.nrQueueResets+=this.nrQueueResets):i[n.id]={
nrInstances:1,nrCallsToUpdate:this.nrCallsToUpdate,nrCallsToEval:this.nrCallsToEval,nrTimesChanged:this.nrTimesChanged,totalEvalTime:this.totalEvalTime,totalInformWatchersTime:this.totalInformWatchersTime,totalUpdateInputTime:this.totalUpdateInputTime,nrQueueResets:this.nrQueueResets,totalAttributedTime:this.totalAttributedTime}},e.prototype.toWatchIdBreakPoint=function(){return"this.watcherId === "+this.watcherId},e.prototype.toProtoBreakPoint=function(){return"this.prototype.id === "+this.prototype.id+" && this.prototype.localToArea === "+this.prototype.localToArea+" && this.prototype.localToDefun === "+this.prototype.localToDefun+' && this.local.areaId === "'+this.local.areaId+'"'},e.prototype.printWatchers=function(t,i){var r=this;void 0===t&&(t=0),void 0===i&&(i=0),this.watchers.forEach(function(n,o){for(var s=n.watcher,a="",d=0;d<i;d++)a+="  ";var u=a,h=s.getDebugOrigin();o in r.actndsaw&&(u+="*** "),void 0!==h&&(u+=h.join(",")+" "),u+="#"+String(o)+" "+s.debugName()+" active="+s.isActive()+" dataSourceAware="+s.dataSourceAware+" pos="+n.pos,console.log(u),i<t&&(s instanceof e?s.printWatchers(t,i+1):console.log(a+"  "+s.debugName()))})},e.prototype.traceActNDSAW=function(t){var i=this;void 0===t&&(t="");var r="";return this.watchers.forEach(function(n,o){if(o in i.actndsaw){var s=n.watcher,a=s.getDebugOrigin();r+="\n"+t,void 0!==a&&(r+=a.join(",")+" "),r+="#"+String(o)+" "+s.debugName()+" pos="+n.pos,s instanceof e&&(r+=s.traceActNDSAW(t+"  "))}}),r},e.prototype.isLargeQuery=function(e,t){return!1},e.prototype.querySourceId=function(){return this.watcherId},e.prototype.multiQuerySourceIds=function(){return[this.watcherId]},e.prototype.collectLoopInfo=function(e,t,i,r){void 0===i&&(i=new Map),void 0===r&&(r=new Map);var n,o=this.local,s=!1;if(!this.deferred||0===e||!this.isActive())return!1;if(r.has(this.watcherId)){if(r.get(this.watcherId)){for(var a="",d=0;d<i.size;d++)a+="  ";return t(a+"**CACHED** #"+this.watcherId),!0}return!1}if(i.has(this.watcherId))return 0===i.get(this.watcherId);n=this.allLogInputs(),i.set(this.watcherId,i.size);for(var d=0;d<n.length;d++)void 0!==n[d]&&n[d].collectLoopInfo(e-1,t,i,r)&&(s=!0);if(r.set(this.watcherId,s),i.delete(this.watcherId),!s)return!1;for(var a="",d=0;d<i.size;d++)a+="  ";if(o instanceof CoreArea){var u=o.getDebugAttributeFor(this);void 0!==u&&(a+="@"+o.areaId+" context: "+u.join(", ")+" ")}return t(a+this.toString()+" #"+this.watcherId),!0},e.prototype.isLogNode=function(){if("logThis"in this||void 0===logPrototypes)return!0;var e=this.prototype;if(!(e.localToArea in logPrototypes))return!1;var t=logPrototypes[e.localToArea];return t===!0||e.localToDefun in t&&(t[e.localToDefun]===!0||e.id in t[e.localToDefun])},e.prototype.logValString=function(){var e,t=this.getDebugOrigin();return void 0!==t?e=t.join(",")+"#"+this.watcherId:(e=(void 0===this.prototype?"<undefined>":this.prototype.idStr())+"#"+this.watcherId,this.local instanceof CoreArea&&(e+="@"+this.local.areaId)),e},e.prototype.logAllInputs=function(e){if(0!==e){var t=this.allLogInputs(),i=void 0===e?void 0:e-1;if("logThis"in this)this.logThis++;else if(this.logThis=1,void 0!==t)for(var r=0;r<t.length;r++)t[r].logAllInputs(i)}},e.prototype.unlogAllInputs=function(){if(this.logThis--,0===this.logThis){var e=this.allLogInputs();if(delete this.logThis,void 0!==e)for(var t=0;t<e.length;t++)e[t].unlogAllInputs()}},e.prototype.reasonForBeingEmpty=function(e){void 0===e&&(e=!0)},e.prototype.printClosestContextLabels=function(t){void 0===t&&(t={});var i=this.prototype.idStr();if(!(i in t)){var r=this.local;if(t[i]=!0,r instanceof CoreArea){var n=r.getDebugAttributeFor(this);if(void 0!==n)return void console.log("@"+r.areaId+" "+r.template.getChildPath().join(".")+".context."+n.join(", "))}this.watchers.forEach(function(i){var r=i.watcher;r instanceof e&&r.printClosestContextLabels(t)})}},e}();EvaluationNode.nrNodes=0,EvaluationNode.explainFunctionNodes={},EvaluationNode.regNodes={},EvaluationNode.regEnvs={undefined:0},EvaluationNode.accumulatedTimes=[];var GlobalEvaluationEnvironment=function(){function e(e){this.localToDefun=0,this.evaluationNodes=[e]}return e.prototype.getOwnId=function(){},e.prototype.getRelation=function(e){},e.prototype.getParent=function(){},e.prototype.getParentWithTemplateId=function(e){},e.prototype.link=function(){return this},e.prototype.unlink=function(){},e.prototype.getEvaluationArea=function(){},e.prototype.isValid=function(){return!0},e.prototype.getSource=function(e){},e}(),globalEvaluationNodes=[],globalEvaluationEnv=new GlobalEvaluationEnvironment(globalEvaluationNodes),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),EvaluationConst=function(e){function t(t){var i=e.call(this,t,void 0)||this;return i.watchers=void 0,i.result.copyConst(t),i}return __extends(t,e),t.prototype.eval=function(){return!1},t.prototype.updateInput=function(){},t.prototype.updateOutput=function(){},t.prototype.activate=function(e){},t.prototype.deactivate=function(e){},t.prototype.setDataSourceResultMode=function(e){},t.prototype.activeWatcherBecomesDataSourceAware=function(e){},t.prototype.activeWatcherNoLongerIsDataSourceAware=function(e){},t.prototype.isConstant=function(){return!0},t.prototype.debugName=function(){return"constant"},t.prototype.toFullString=function(){return cdlifyLim(this.result.value,80)},t.prototype.addForcedUpdate=function(e){},t.prototype.specificExplanation=function(t,i,r){function n(e){var t;if(void 0!==e.values)t=stripArray(e.values.map(getClassPath));else if("next"in e){t={};for(var i in e.next)t[i]=n(e.next[i])}return t}void 0===r&&(r=!1),e.prototype.specificExplanation.call(this,t,i,!0),void 0===i||"values"in i||(t._definedIn=n(i))},t}(EvaluationNode),EvaluationOrderedSet=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.constant=!0,r.inputs=new Array(t.values.length),r.elements=new Array(t.values.length),r.result.value=constEmptyOS,r}return __extends(t,e),t.prototype.addElement=function(e,t){this.inputs[e]=t,this.elements[e]=t.result,t.isConstant()||(this.constant=!1,t.addWatcher(this,e,!1,!0,!1))},t.prototype.updateInput=function(t,i){void 0!==this.elements&&(this.elements[t]=i,void 0===i?(this.elements=void 0,this.isActive()&&e.prototype.deactivateInputs.call(this)):this.markAsChanged())},t.prototype.isConstant=function(){return this.constant},t.prototype.eval=function(){function e(e){return void 0!==e.identifiers}var t=this.result.value;if(void 0===this.elements)this.result.value=constEmptyOS;else{if(1===this.elements.length){var i=this.result.getLabels();return this.result.copy(this.elements[0]),void 0===this.result.value&&(this.result.value=constEmptyOS),!this.result.equalLabels(i)||!valueEqual(t,this.result.value)}var r=!1;this.result.value=[],this.elements.some(e)?(this.result.identifiers=[],r=!0):delete this.result.identifiers;for(var n=0;n!==this.elements.length;n++)void 0!==this.elements[n].value&&(this.result.value=cconcat(this.result.value,this.elements[n].value),r&&(this.result.identifiers=cconcat(this.result.identifiers,this.elements[n].getIdentifiers())))}return!valueEqual(t,this.result.value)},t.prototype.activateInputs=function(){void 0!==this.elements&&e.prototype.activateInputs.call(this)},t.prototype.deactivateInputs=function(){void 0!==this.elements&&e.prototype.deactivateInputs.call(this)},t.prototype.write=function(e,t,i,r){if(this.constant)return void Utilities.warn("dead ended write: writing to constant os at "+gWriteAction);if(void 0===r)for(var n=0;n<this.elements.length;n++)void 0!==this.inputs[n]&&this.inputs[n].write(e,t,i,void 0);else{for(var o=0,s=0,n=0;n<this.elements.length&&s<r.length;n++){var a=this.elements[n].value,d=void 0===a?0:a.length;if(o<=r[s].index&&(0===d||r[s].index<o+d)){for(var u=[];s<r.length&&(0===d||r[s].index<o+d);){var h=r[s];u.push(h.copyWithOffset(o)),s++}if(void 0!==this.inputs[n])return void this.inputs[n].write(e,t,i,u)}o+=d}Utilities.warn("dead ended write: writing outside os at "+gWriteAction)}},t.prototype.debugName=function(){return"orderedSet"},t.prototype.multiQuerySourceIds=function(){for(var e=[],t=0;t<this.inputs.length;t++)void 0===this.elements[t].value||this.elements[t].value instanceof Array&&0===this.elements[t].value.length||(e=cconcat(e,this.inputs[t].multiQuerySourceIds()));return e},t}(EvaluationNode),EvaluationRange=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.eval=function(){for(var e=this.result.value,t=[],i=0;i!==this.elements.length;i++){var r=this.elements[i].value;void 0!==r&&(r instanceof Array?1===r.length?t.push(r[0]):r.length>1&&Array.prototype.push.apply(t,r):t.push(r))}return this.result.value=[new RangeValue(t,this.prototype.closedLower,this.prototype.closedUpper)],!valueEqual(e,this.result.value)},t.prototype.debugName=function(){return"range"},t}(EvaluationOrderedSet),EvaluationNegation=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.constant=!0,r.inputs=new Array(t.queries.length),r.queries=new Array(t.queries.length),r.result.value=constEmptyOS,r.dataSourceAware=!1,r}return __extends(t,e),t.prototype.addElement=function(e,t){this.inputs[e]=t,this.queries[e]=t.result,t.isConstant()||(this.constant=!1,t.addWatcher(this,e,!1,!0,!1))},t.prototype.updateInput=function(e,t){this.queries[e]=t,this.markAsChanged()},t.prototype.isConstant=function(){return this.constant},t.prototype.eval=function(){for(var e,t=this.result.value,i=[],r=0;r!==this.queries.length;r++)void 0!==this.queries[r].value&&(i=cconcat(i,this.queries[r].value));return e=[new Negation(i)],!valueEqual(t,e)&&(this.result.value=e,!0)},t.prototype.debugName=function(){return"negation"},t}(EvaluationNode),EvaluationSubStringQuery=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.eval=function(){for(var e=this.result.value,t=[],i=0;i!==this.elements.length;i++)void 0!==this.elements[i].value&&Array.prototype.push.apply(t,this.elements[i].value);return this.result.value=[new SubStringQuery(t)],!valueEqual(e,this.result.value)},t.prototype.debugName=function(){return"subStringQuery"},t}(EvaluationOrderedSet),EvaluationComparisonFunction=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.eval=function(){for(var e=this.result.value,t=[],i=0;i!==this.elements.length;i++)void 0!==this.elements[i].value&&t.push(this.elements[i].value);return this.result.value=[new ComparisonFunctionValue(t)],!valueEqual(e,this.result.value)},t.prototype.debugName=function(){return"comparisonFunction"},t.prototype.multiQuerySourceIds=function(){return[this.watcherId]},t}(EvaluationOrderedSet),EvaluationCompiledFunction=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.arguments=[],r.compiledFunction=t.compiledFunction,r.result.compiledQuery=[t.compiledFunction],r.result.queryArguments=r.arguments,r.result.nrQueryElements=[0],void 0!==t.writePaths&&(r.result.writePaths=t.writePaths),r.constant=!0,r}return __extends(t,e),t.prototype.setDataRepresentation=function(e){void 0!==e&&(this.dataRepresentation=e,this.result.value=e.result.value,this.result.nrQueryElements=[e.result.size()],e.isConstant()||(this.constant=!1,e.addWatcher(this,void 0,!1,!0,!1)))},t.prototype.removeAsWatcher=function(){void 0!==this.dataRepresentation&&this.dataRepresentation.removeWatcher(this,!0,!1),e.prototype.removeAsWatcher.call(this)},t.prototype.addArgument=function(e,t){void 0===this.inputs&&(this.inputs=[],this.arguments[0]=[]),this.inputs[e]=t,this.arguments[0][e]=makeSimpleQueryWithId(t.result.value,t.result.identifiers),t.isConstant()||(this.constant=!1,t.addWatcher(this,e,!1,!0,!1))},t.prototype.isConstant=function(){return this.constant},t.prototype.updateInput=function(e,t){void 0===e?(this.result.value=t.value,this.result.nrQueryElements=[t.size()]):this.arguments[0][e]=makeSimpleQueryWithId(t.value,t.identifiers),this.markAsChanged()},t.prototype.activateInputs=function(){"dataRepresentation"in this&&this.dataRepresentation.activate(this,!1),e.prototype.activateInputs.call(this)},t.prototype.deactivateInputs=function(){"dataRepresentation"in this&&this.dataRepresentation.deactivate(this,!1),e.prototype.deactivateInputs.call(this)},t.prototype.allInputs=function(){return void 0===this.dataRepresentation?this.inputs:void 0!==this.inputs?this.inputs.concat(this.dataRepresentation):[]},t.prototype.debugName=function(){var e=this.prototype;return e.name},t.prototype.eval=function(){return!0},t.prototype.getSelectionObject=function(){function e(t){if("object"!=typeof t)return t;if(t instanceof RuntimeArgument)return i[t.index].result.value;if(!(t===_||t instanceof Array)){if(t instanceof NonAV)return t;if(t instanceof MoonOrderedSet)return t.os.map(e);if(t instanceof MoonRange)return new RangeValue(t.os.map(e),t.closedLower,t.closedUpper);if(t instanceof MoonComparisonFunction)return new ComparisonFunctionValue(t.os.map(e));if(t instanceof Negation)return new Negation(t.queries.map(e));if(t instanceof MoonSubstringQuery)return new SubStringQuery(t.os.map(e));var r=void 0;for(var n in t){var o=e(t[n]);void 0!==o&&(void 0===r&&(r={}),r[n]=o)}return r}}var t=this.compiledFunction.queryStr,i=this.inputs;return e(t)},t.prototype.specificExplanation=function(t,i,r){if(void 0===r&&(r=!1),e.prototype.specificExplanation.call(this,t,i,!0),t._query=this.compiledFunction.queryStr,void 0!==this.inputs){t._inputs=[];for(var n=0;n<this.inputs.length;n++)t._inputs[n+": "+this.inputs[n].debugName()]=this.inputs[n].explain(void 0)}},t}(EvaluationNode),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),EvaluationBoolGate=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.open=void 0,r.bActive=!1,r.a=void 0,r.b=void 0,r.constant=!1,r.result.value=constEmptyOS,r}return __extends(t,e),t.prototype.setA=function(e){this.a=e,e.isConstant()?this.inputs=[]:(e.addWatcher(this,0,!1,!0,!1),this.inputs=[e])},t.prototype.instantiateB=function(){this.b=getEvaluationNode(this.prototype.b,this.local),this.b.isConstant()?0!==this.nrActiveWatchers||void 0!==this.watchers&&0!==this.watchers.size||(this.watchers=void 0,this.constant=!0):this.b.addWatcher(this,1,!1,!0,!0)},t.prototype.removeAsWatcher=function(){void 0!==this.a&&(this.a.removeWatcher(this,!0,!1),this.a=void 0),void 0!==this.b&&(this.b.removeWatcher(this,!0,!0),this.b=void 0)},t.prototype.isConstant=function(){return this.constant},t.prototype.updateInput=function(e,t){0===e?this.markAsChanged():1===e&&this.open&&this.markAsChanged()},t.prototype.eval=function(){var e=this.result.value;if(this.inputHasChanged=!1,this.open=isTrue(this.a.result.value),this.open){if(void 0===this.b&&this.instantiateB(),!this.b.isConstant()&&(this.b.activate(this,!0),this.bActive=!0,"schedulingError"in this.prototype&&this.inputs.push(this.b),this.b.isScheduled()))return void this.b.forceUpdate(this,!0);this.result.copy(this.b.result)}else this.bActive&&(this.bActive=!1,this.b.deactivate(this,!0),!this.b.isConstant()&&"schedulingError"in this.prototype&&this.inputs.pop()),this.result.set(constEmptyOS);return!valueEqual(e,this.result.value)},t.prototype.isDeferableInput=function(e,t){return 0===e||this.open},t.prototype.activateInputs=function(){this.a.activate(this,!1),this.inputHasChanged=!0},t.prototype.deactivateInputs=function(){void 0!==this.a&&this.a.deactivate(this,!1),void 0!==this.b&&(this.open&&!this.b.isConstant()&&(this.b.deactivate(this,!0),this.bActive=!1,"schedulingError"in this.prototype&&this.inputs.pop()),this.open=!1)},t.prototype.write=function(e,t,i,r){return this.open&&void 0!==this.b?void this.b.write(e,t,i,r):void Utilities.warn("dead ended write: writing to closed bool gate at "+gWriteAction)},t.prototype.debugName=function(){return"boolGate"},t.prototype.multiQuerySourceIds=function(){return this.open?this.inputs[1].multiQuerySourceIds():[]},t.prototype.removeWatcherFromInactiveNodes=function(){this.open||void 0===this.b||this.b.isConstant()||(this.b.removeWatcherForPos(this,1,!1,!0),this.b=void 0,this.bActive=!1)},t}(EvaluationNode),EvaluationBoolMatch=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.constant=!0,r.open=!1,r.simpleQuery=void 0,r.result.value=constEmptyOS,r}return __extends(t,e),t.prototype.setArguments=function(e,t,i){this.inputs=[e,t,i],e.isConstant()||(this.constant=!1,e.addWatcher(this,0,!1,!0,!1)),t.isConstant()||(this.constant=!1,t.addWatcher(this,1,!1,!0,!1)),i.isConstant()||(this.constant=!1,i.addWatcher(this,1,!1,!0,!1))},t.prototype.isConstant=function(){return this.constant},t.prototype.updateInput=function(e,t){1===e&&(this.simpleQuery=void 0),this.markAsChanged()},t.prototype.eval=function(){var e=this.result.value;return void 0===this.simpleQuery&&void 0!==this.inputs[1]&&(this.simpleQuery=makeSimpleQueryWithId(this.inputs[1].result.value,this.inputs[1].result.identifiers)),this.open=void 0!==this.inputs[0]&&void 0!==this.simpleQuery&&this.simpleQuery.testOS(this.inputs[0].result.value),this.result.value=this.open?this.inputs[2].result.value:constEmptyOS,!valueEqual(e,this.result.value)},t.prototype.debugName=function(){return"boolMatch"},t.prototype.multiQuerySourceIds=function(){return this.open?this.inputs[2].multiQuerySourceIds():[]},t}(EvaluationNode),EvaluationAV=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.constant=!0,r.inputByAttr={},r.result.value=constEmptyOS,"schedulingError"in t&&(r.inputs=[]),r}return __extends(t,e),t.prototype.removeAsWatcher=function(){for(var e in this.inputByAttr)this.inputByAttr[e].removeWatcher(this,!0,!1);this.inputByAttr=void 0},t.prototype.addAttribute=function(e,t){this.inputByAttr[e]=t,t.isConstant()||(this.constant=!1,t.addWatcher(this,e,!0,!0,!1),"schedulingError"in this.prototype&&this.inputs.push(t))},t.prototype.updateInput=function(e,t){this.markAsChanged()},t.prototype.isConstant=function(){return this.constant},t.prototype.activateInputs=function(){for(var e in this.inputByAttr)this.inputByAttr[e].activate(this,!1)},t.prototype.deactivateInputs=function(){if(void 0!==this.inputByAttr)for(var e in this.inputByAttr)this.inputByAttr[e].deactivate(this,!1)},t.prototype.eval=function(){var e=this.prototype,t={};for(var i in this.inputByAttr){var r=this.inputByAttr[i].result.value;void 0===r||this.inputByAttr[i].result.erase||(void 0!==this.prototype.suppressSet&&i in e.suppressSetAttr?r instanceof Array&&0===r.length?e.suppressSetAttr[i]&&(t[i]=!1):t[i]=stripArray(r):t[i]=r)}return this.result.value=void 0!==this.prototype.suppressSet?t:[t],!0},t.prototype.write=function(e,t,i,r){if(this.constant)return void Utilities.warn("dead ended write: writing to constant AV at "+gWriteAction);if(void 0!==r&&(1!==r.length||0!==r[0].index||1!==r[0].length))return void Utilities.warn("dead ended write: writing os to single AV at "+gWriteAction);if(void 0===r||void 0===r[0].path){var n=getDeOSedValue(e.value);if(!isAV(n))return void Utilities.warn("dead ended write: writing non-singleton or non AV over AV at "+gWriteAction);for(var o in n)o in this.inputByAttr?this.inputByAttr[o].write(new Result(ensureOS(n[o])),t,i.popPathElement(o),void 0):Utilities.warn("dead ended write: writing to non-existing attribute in non-writable AV at "+gWriteAction)}else for(var s=0;s<r.length;s++)void 0!==r[s].path&&1===r[s].path.length&&r[s].path[s]in this.inputByAttr?this.inputByAttr[r[s].path[s]].write(e,t,i,r[s].sub):Utilities.warn("dead ended write: writing to non existing attribute in AV at "+gWriteAction)},t.prototype.debugName=function(){return"attributeValue"},t.prototype.specificExplanation=function(t,i,r){void 0===r&&(r=!1),e.prototype.specificExplanation.call(this,t,i,!0);for(var n in this.inputByAttr)t[n+": "+this.inputByAttr[n].debugName()]=this.inputByAttr[n].explain(getATDBIAttr(i,n));return t},t.prototype.toString=function(){var e="";for(var t in this.inputByAttr)e.length>0&&(e+=", "),e+=t+":"+cdlifyLim(this.inputByAttr[t].result.value,80);return this.prototype.idStr()+"={"+e+"}"},t.prototype.toFullString=function(){var e=0===this.nrActiveWatchers?"*{":"{";for(var t in this.inputByAttr)e.length>2&&(e+=", "),e+=t+": "+this.inputByAttr[t].toFullString();return e+"}"},t}(EvaluationNode),EvaluationNodeWithArguments=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.addArgument=function(e,t){this.inputs[e]=t,this.arguments[e]=t.result,t.isConstant()?this.updateInput(e,t.result):(this.constant=!1,t.addWatcher(this,e,!0,!0,this.dataSourceAware))},t.prototype.updateInput=function(e,t){throw"don't call"},t.prototype.eval=function(){throw"don't call"},t}(EvaluationNode),EvaluationFunctionApplication=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.bif=t.builtInFunction,r.executableFunction=r.bif.factory(i,r),r.constant=!r.bif.dependingOnImplicitArguments,r.inputs=new Array(t.functionArguments.length),r.arguments=new Array(t.functionArguments.length),r.dataSourceAware=r.bif.name in DataSource.dataSourceFunctions,r.result.value=constEmptyOS,r}return __extends(t,e),t.prototype.destroy=function(){void 0!==this.dataSourceInput&&this.releaseDataSourceInput(),this.executableFunction.destroy(),e.prototype.destroy.call(this)},t.prototype.setDataSourceResultMode=function(e){},t.prototype.setDataSourceInput=function(e){var t,i=!1;this.dataSourceInput!==e&&(void 0!==this.dataSourceInput&&(this.nrActiveWatchers>0&&this.dataSourceFunctionApplication.deactivate(),this.dataSourceFunctionApplication.removeResultReceiver(this),i=!0),this.dataSourceInput=e,this.dataSourceFunctionApplication=e.applyAggregateFunction(this.bif.name,this),this.nrActiveWatchers>0&&this.dataSourceFunctionApplication.activate(),t=this.dataSourceFunctionApplication.getResult(),!i&&valueEqual(this.result.value,t)||(this.result.value=t,this.markAsChanged()))},t.prototype.releaseDataSourceInput=function(){void 0!==this.dataSourceFunctionApplication&&(this.nrActiveWatchers>0&&this.dataSourceFunctionApplication.deactivate(),this.dataSourceFunctionApplication.removeResultReceiver(this),this.dataSourceFunctionApplication=void 0),this.dataSourceInput=void 0},t.prototype.activateInputs=function(){e.prototype.activateInputs.call(this),void 0!==this.dataSourceFunctionApplication&&this.dataSourceFunctionApplication.activate()},t.prototype.deactivateInputs=function(){e.prototype.deactivateInputs.call(this),void 0!==this.dataSourceFunctionApplication&&this.dataSourceFunctionApplication.deactivate()},t.prototype.updateInput=function(e,t){if(0===e&&this.dataSourceAware){if(void 0!==t&&"dataSource"in t)return void(this.inputs[0].isScheduled()||!this.inputs[0].isActive()?this.inputs[0].addForcedUpdate(this):this.setDataSourceInput(t.dataSource));void 0!==this.dataSourceInput&&(this.releaseDataSourceInput(),this.dataSourceInput=void 0)}void 0===t?(this.inputs[e].removeWatcher(this,!1,this.dataSourceAware),this.inputs[e]=void 0,this.arguments=void 0):(this.arguments[e]=t,this.markAsChanged())},t.prototype.newDataSourceResult=function(e){valueEqual(this.result.value,e)||(this.result.value=e,this.markAsChanged())},t.prototype.reextractData=function(){assert(!1,"should not be called")},t.prototype.isConstant=function(){return this.constant},t.prototype.resultIsTransient=function(){return this.bif.transientResult},t.prototype.eval=function(){var e,t=this.result.value;return this.inputHasChanged=this.bif.transientResult,void 0!==this.dataSourceInput||(this.executableFunction instanceof EFNop&&console.log("function",this.bif.name,"is nop"),e=this.executableFunction.execute(this.arguments),this.executableFunction.undefinedSignalsNoChange()?void 0!==e&&(this.result.value=e,!0):(this.result.value=e,!valueEqual(t,e)))},t.prototype.write=function(e,t,i,r){Utilities.warn("dead ended write: cannot write through "+this.bif.name+" at "+gWriteAction)},t.prototype.debugName=function(){return this.bif.name},t}(EvaluationNodeWithArguments),QualifierStateTrue=function(){function e(e){this.value=e}return e.prototype.holds=function(){return void 0!==this.value&&isTrueValue(this.value)},e.prototype.matchValue=function(){return"true"},e}(),QualifierStateFalse=function(){function e(e){this.value=e}return e.prototype.holds=function(){return isFalseValue(this.value)},e.prototype.matchValue=function(){return"false"},e}(),QualifierStateSimpleValue=function(){function e(e,t){this.value=e,this.match=t}return e.prototype.holds=function(){return void 0!==this.value&&this.value.indexOf(this.match)!==-1},e.prototype.matchValue=function(){return String(this.match)},e}(),QualifierStateMatchRange=function(){function e(e,t){this.value=e,this.match=new RangeValue(t.os,t.closedLower,t.closedUpper)}return e.prototype.holds=function(){var e=this;return void 0!==this.value&&this.value.some(function(t){return e.match.match(t)})},e.prototype.matchValue=function(){return String(this.match)},e}(),QualifierStateMatchOS=function(){function e(e,t){this.value=e,this.match=t.os}return e.prototype.holds=function(){var e=this;return void 0!==this.value&&this.value.some(function(t){return e.match.indexOf(t)!==-1})},e.prototype.matchValue=function(){return String(this.match)},e}(),QualifierStateAlwaysFalse=function(){function e(e){this.value=e}return e.prototype.holds=function(){return!1},e.prototype.matchValue=function(){return"<<NOMATCH>>"},e}(),EvaluationQualifiers=function(e){function t(t,i){var r=e.call(this,t,i)||this;r.constant=!0;var n=t.qualifiers.length;return r.qualifiers=new Array(n),r.qualifierInputs=new Array(n),r.qualifiedVariants=new Array(n),r.result.value=constEmptyOS,r.dataSourceResultMode=!0,"schedulingError"in t&&(r.inputs=[]),r}return __extends(t,e),t.prototype.removeAsWatcher=function(){var e=this.qualifierInputs;this.nrActiveWatchers>0&&this.deactivateInputs(),this.qualifiedVariants=void 0,this.qualifierInputs=void 0,this.qualifiers=void 0;for(var t=0;t!==e.length;t++)if(void 0!==e[t])for(var i=0;i!==e[t].length;i++)e[t][i].removeWatcher(this,!1,!1)},t.prototype.addQualifiers=function(e,t){this.qualifierInputs[e]=[],this.qualifiers[e]=[];for(var i=0;i!==t.length;i++){var r=t[i].value;switch(this.qualifierInputs[e][i]=r,typeof t[i].match){case"boolean":t[i].match===!0?this.qualifiers[e][i]=new QualifierStateTrue(r.result.value):this.qualifiers[e][i]=new QualifierStateFalse(r.result.value);break;case"number":case"string":this.qualifiers[e][i]=new QualifierStateSimpleValue(r.result.value,t[i].match);break;default:t[i].match instanceof MoonRange?this.qualifiers[e][i]=new QualifierStateMatchRange(r.result.value,t[i].match):t[i].match instanceof MoonOrderedSet?this.qualifiers[e][i]=new QualifierStateMatchOS(r.result.value,t[i].match):(assert(!1,"no implementation"),this.qualifiers[e][i]=new QualifierStateAlwaysFalse(r.result.value))}r.isConstant()||(this.constant=!1,r.addWatcher(this,[e,i],!1,!0,!1),"schedulingError"in this.prototype&&this.inputs.push(r))}this.qualifiedVariants[e]=allQualifiersHold(this.qualifiers[e]),this.markAsChanged()},t.prototype.updateInput=function(e,t){if(void 0!==t){var i=e[0],r=e[1],n=this.qualifiedVariants[i];this.qualifiers[i][r].value=t.value;var o=allQualifiersHold(this.qualifiers[i]);o!==n&&(this.qualifiedVariants[i]=o,this.markAsChanged())}},t.prototype.isConstant=function(){return this.constant},t.prototype.eval=function(){for(var e=0;e<this.qualifiedVariants.length;e++)if(this.result.value[e]!==this.qualifiedVariants[e])return this.result.value=this.qualifiedVariants.slice(0),!0;return!1},t.prototype.init=function(){if(this.constant){for(var e=0;e!==this.qualifierInputs.length;e++)allQualifiersHold(this.qualifiers[e])?(this.inputHasChanged=!0,this.qualifiedVariants[e]=!0):this.qualifiedVariants[e]=!1;this.eval()}},t.prototype.activateInputs=function(){for(var e=0;e!==this.qualifierInputs.length;e++)for(var t=0;t<this.qualifierInputs[e].length;t++)this.qualifierInputs[e][t].activate(this,!1)},t.prototype.deactivateInputs=function(){for(var e=0;e!==this.qualifierInputs.length;e++)for(var t=0;t<this.qualifierInputs[e].length;t++)this.qualifierInputs[e][t].deactivate(this,!1)},t.prototype.isQualified=function(){for(var e=0;e<this.qualifiedVariants.length;e++)if(this.qualifiedVariants[e])return!0;return!1},t.prototype.isReady=function(){for(var e=0;e!==this.qualifierInputs.length;e++)for(var t=this.qualifierInputs[e],i=0;i<t.length;i++)if(t[i].scheduledAtPosition>=0){for(var r=this.qualifiers[e],n=!0,o=0;n&&o<t.length;o++)t[o].scheduledAtPosition<0&&(n=n&&r[o].holds());if(n)return!1;break}return!0},t.prototype.allInputs=function(){if(void 0===this.inputs){for(var e=[],t=0;t!==this.qualifierInputs.length;t++)for(var i=0;i<this.qualifierInputs[t].length;i++)e.push(this.qualifierInputs[t][i]);return e}return this.inputs},t.prototype.debugName=function(){return"qualifiers"},t.prototype.toString=function(){return this.prototype.idStr()+"=o("+this.qualifiedVariants.join(",")+")"},t.prototype.toFullString=function(){for(var e="",t=0;t!==this.qualifierInputs.length;t++){0!==t&&(e+=" | ");for(var i="",r=0;r!==this.qualifierInputs[t].length;r++)0!==r&&(i+=", "),i+=this.prototype.qualifiers[t][r].toSymString()+(this.qualifiers[t][r].holds()?" == ":" != ")+this.qualifiers[t][r].matchValue();e+="{"+i+"} => "+this.qualifierInputs[t]}return e},t}(EvaluationNode),EvaluationVariant=function(e){function t(t,i){var r=e.call(this,t,i)||this;r.qualifiers=void 0,r.qualifiedVariants=void 0,r.firstActive=-1,r.lastActive=-1,r.nrQualifiedVariants=0,r.prevMerged=[],r.variantChange={};var n=t.functionNodes.length;return r.variantInputs=new Array(n),r.qualifiedVariants=void 0,r.variants=new Array(n),r.isVariantUnmergeable=new Array(n),r.dataSourceResultMode=!0,"schedulingError"in t&&(r.inputs=new Array(n+1)),r}return __extends(t,e),t.prototype.removeAsWatcher=function(){var e=this.variantInputs;this.qualifiers.removeWatcher(this,!1,void 0),this.nrActiveWatchers>0&&this.deactivateInputs(),this.qualifiedVariants=void 0,this.variantInputs=void 0,this.qualifiers=void 0,this.variants=void 0;for(var t=0;t!==e.length;t++)void 0!==e[t]&&e[t].removeWatcher(this,!1,void 0)},t.prototype.addQualifiers=function(e){this.qualifiers=e,this.qualifiedVariants=e.result.value,e.isConstant()||(e.addWatcher(this,-1,!1,!1,!1),"schedulingError"in this.prototype&&(this.inputs[0]=e))},t.prototype.addVariant=function(e,t){this.variantInputs[e]=t,this.variants[e]=t.result,this.isVariantUnmergeable[e]=t.result.atomic&&!t.result.push||isUnmergeable(t.result.value),t.isConstant()||t.addWatcher(this,e,!1,!1,this.dataSourceResultMode)},t.prototype.updateInput=function(e,t){var i=!1;if(void 0!==t){if(e>=0){var r=this.isVariantUnmergeable[e];if(this.variants[e]=t,this.variantChange[this.variantInputs[e].watcherId]=!0,this.isVariantUnmergeable[e]=void 0!==t&&(t.atomic&&!t.push||isUnmergeable(t.value)),this.qualifiedVariants[e])if(r&&!this.isVariantUnmergeable[e]&&this.lastActive===e+1){for(var n=this.lastActive,o=n;o<this.qualifiedVariants.length&&(!this.qualifiedVariants[o]||(n=o+1,!this.isVariantUnmergeable[o]));o++);i=this.updateActiveVariantRange(this.qualifiedVariants,this.firstActive,n),this.markAsChanged()}else!r&&this.isVariantUnmergeable[e]&&this.lastActive>e+1?(i=this.updateActiveVariantRange(this.qualifiedVariants,this.firstActive,e+1),this.markAsChanged()):this.isActiveVariant(e)&&this.markAsChanged()}else if(this.nrActiveWatchers>0){for(var s=t.value,a=-1,n=-1,o=0;o<s.length&&(!s[o]||(a===-1&&(a=o),n=o+1,!this.isVariantUnmergeable[o]));o++);i=this.updateActiveVariantRange(s,a,n)}else this.qualifiedVariants=t.value,
this.markAsChanged();i&&this.deferred&&this.isReady()&&this.undefer()}},t.prototype.isDeferableInput=function(e,t){return e===-1||this.isActiveVariant(e)},t.prototype.setDataSourceResultMode=function(e){if(this.isActive())if(e&&!this.dataSourceResultMode){for(var t=this.firstActive;t<this.lastActive;t++)this.qualifiedVariants[t]&&this.variantInputs[t].activeWatcherBecomesDataSourceAware(this);this.markAsChanged()}else if(!e&&this.dataSourceResultMode){for(var t=this.firstActive;t<this.lastActive;t++)this.qualifiedVariants[t]&&this.variantInputs[t].activeWatcherNoLongerIsDataSourceAware(this);this.markAsChanged()}this.dataSourceResultMode=e},t.prototype.isActiveVariant=function(e){return this.qualifiedVariants[e]&&this.firstActive<=e&&e<this.lastActive},t.prototype.clearActiveVariantRange=function(){for(var e=this.firstActive;e<this.lastActive;e++)this.qualifiedVariants[e]&&this.deactivateVariant(e);this.firstActive=-1,this.lastActive=-1,this.nrQualifiedVariants=0},t.prototype.updateActiveVariantRange=function(e,t,i){var r=Math.max(this.firstActive,t),n=Math.min(this.lastActive,i),o=!1,s=!1;n<=r&&(r=n=e.length);for(var a=t;a<i&&a<r;a++)e[a]&&(this.activateVariant(a),s=!0);for(var a=n;a<i;a++)e[a]&&(this.activateVariant(a),s=!0);for(var a=r;a<n;a++)!this.qualifiedVariants[a]&&e[a]&&(this.activateVariant(a),s=!0);for(var a=this.firstActive;a<this.lastActive&&a<r;a++)this.qualifiedVariants[a]&&(this.deactivateVariant(a),o=!0);for(var a=n;a<this.lastActive;a++)this.qualifiedVariants[a]&&(this.deactivateVariant(a),o=!0);for(var a=r;a<n;a++)this.qualifiedVariants[a]&&!e[a]&&(this.deactivateVariant(a),o=!0);return this.firstActive=t,this.lastActive=i,this.qualifiedVariants=e,(s||o)&&this.markAsChanged(),o},t.prototype.activateVariant=function(e){void 0===this.variantInputs[e]&&this.addVariant(e,getEvaluationNode(this.prototype.functionNodes[e],this.local)),this.variantInputs[e].isConstant()||(this.variantInputs[e].activate(this,this.dataSourceResultMode),"schedulingError"in this.prototype&&(this.inputs[e+1]=this.variantInputs[e])),this.nrQualifiedVariants++},t.prototype.deactivateVariant=function(e){this.variantInputs[e].deactivate(this,this.dataSourceResultMode),"schedulingError"in this.prototype&&(this.inputs[e+1]=void 0),this.nrQualifiedVariants--},t.prototype.isConstant=function(){return!1},t.prototype.eval=function(){for(var e=this.result.value,t=this.result.dataSource,i=void 0,r=0,n=void 0,o=[],s=!1,a=!1,d=this.firstActive;d<this.lastActive;d++)if(this.qualifiedVariants[d]&&void 0!==this.variants[d].value){var u=this.variantInputs[d].watcherId;if((u in this.variantChange||this.prevMerged[o.length]!==u)&&(s=!0),o.push(u),r++,1===r){if("dataSource"in this.variants[d]&&(a=!0),this.isVariantUnmergeable[d])break}else a=!1}if(o.length!==this.prevMerged.length&&(s=!0),!s)return!1;if(r=0,a&&this.dataSourceResultMode){for(var d=this.firstActive;d<this.lastActive;d++)if(this.qualifiedVariants[d]&&void 0!==this.variants[d].value&&void 0===n){n=this.variants[d];break}return(!objectEqual(this.result.value,n.value)||!this.result.equalLabels(n))&&(this.result.copy(n),!0)}for(var d=this.firstActive;d<this.lastActive&&(!this.qualifiedVariants[d]||void 0===this.variants[d].value||(void 0===n&&(n=this.variants[d]),this.variants[d].push?void 0===i?(i=this.variants[d].value,r++):(i instanceof Array||(i=[i]),Array.prototype.push.apply(i,this.variants[d].value)):(i=0===r?this.variants[d].value:1===r?mergeValueCopy(i,this.variants[d].value):mergeValueOverwrite(i,this.variants[d].value),r++),1!==r||!this.isVariantUnmergeable[d]));d++);return 1===r?this.result.copyLabels(n):this.result.resetLabels(),this.result.value=i,this.prevMerged=o,this.variantChange={},this.result.dataSource!==t||!objectEqual(e,this.result.value)},t.prototype.activateInputs=function(){this.qualifiers.activate(this,!1),this.qualifiers.isScheduled()?this.qualifiers.addForcedUpdate(this):(this.updateInput(-1,this.qualifiers.result),this.inputHasChanged||this.markAsChanged())},t.prototype.deactivateInputs=function(){void 0!==this.qualifiers&&(this.clearActiveVariantRange(),this.qualifiers.deactivate(this,!1),this.nrQualifiedVariants=0)},t.prototype.write=function(e,t,i,r){var n=this;0<=this.firstActive&&this.firstActive<this.variantInputs.length?(void 0!==r&&"identifiers"in this.result&&(r=r.map(function(e){return e.copyWithIdentity(n.result.identifiers[e.index])})),this.variantInputs[this.firstActive].write(e,t,i,r)):Utilities.warn("dead ended write: no qualified variant at "+gWriteAction)},t.prototype.isQualified=function(){return 0<=this.firstActive&&this.firstActive<this.variantInputs.length},t.prototype.debugName=function(){return"variant"},t.prototype.specificExplanation=function(t,i,r){void 0===r&&(r=!1);var n,o=this.qualifiers.prototype;e.prototype.specificExplanation.call(this,t,i,!0);for(var s=0;s!==this.variants.length;s++){var a=String(s)+": "+String(this.qualifiedVariants[s]);if(t[a]={},0===this.qualifiers.qualifierInputs[s].length)n=t[a].qualifier="default";else{n=t[a].qualifier={};for(var d=0;d!==this.qualifiers.qualifierInputs[s].length;d++){var u;u=void 0!==o.qualifiers[s][d].attribute?o.qualifiers[s][d].attribute+"@"+o.qualifiers[s][d].localToArea:String(d),n[u+(this.qualifiers.qualifiers[s][d].holds()?" == ":" != ")+this.qualifiers.qualifiers[s][d].matchValue()+": "+this.qualifiers.qualifierInputs[s][d].debugName()]=this.qualifiers.qualifierInputs[s][d].explain(void 0)}}void 0!==this.variantInputs[s]&&(t[a]["variant: "+this.variantInputs[s].debugName()]=this.variantInputs[s].explain(void 0)),void 0!==i&&"values"in i&&void 0!==this.variantInputs[s]&&(t[a]["variant: "+this.variantInputs[s].debugName()]._definedIn=getClassPath(i.values[0]))}return t},t.prototype.toString=function(){for(var e="",t=0;t!==this.variants.length;t++)0!==t&&(e+=" | "),e+=this.qualifiedVariants[t]+" => "+(void 0===this.variantInputs[t]?"undefined":cdlifyLim(this.variantInputs[t].result.value,80));return this.prototype.idStr()+"="+e},t.prototype.toFullString=function(){for(var e="",t=0;t!==this.variants.length;t++){0!==t&&(e+=" | ");for(var i="",r=0;r!==this.qualifiers.qualifierInputs[t].length;r++)0!==r&&(i+=", "),i+=this.qualifiers.prototype.qualifiers[t][r].toSymString()+(this.qualifiers.qualifiers[t][r].holds()?" == ":" != ")+this.qualifiers.qualifiers[t][r].matchValue();e+="{"+i+"} => "+(void 0===this.variantInputs[t]?"undefined":this.variantInputs[t].toFullString())}return e},t.prototype.multiQuerySourceIds=function(){for(var e=void 0,t=0;t<this.variants.length;t++)if(this.qualifiedVariants[t]&&void 0!==this.variants[t].value){if(void 0!==e)return[this.watcherId];if(e=this.variantInputs[t],this.isVariantUnmergeable[t])break}return void 0===e?[]:e.multiQuerySourceIds()},t.prototype.removeWatcherFromInactiveNodes=function(){for(var e=0;e!==this.variantInputs.length;e++)void 0===this.variantInputs[e]||this.isActiveVariant(e)||this.variantInputs[e].isConstant()||(this.variantInputs[e].removeWatcherForPos(this,e,!1,void 0),this.variantInputs[e]=void 0,this.variants[e]=void 0)},t}(EvaluationNode),EvaluationVariant1=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.qualifiers=void 0,r.variantInput=void 0,r.variant=void 0,r.qualifiedVariant=void 0,r.variantChange=!1,r.dataSourceResultMode=!0,"schedulingError"in t&&(r.inputs=[]),r}return __extends(t,e),t.prototype.removeAsWatcher=function(){this.qualifiers.removeWatcher(this,!1,void 0),this.nrActiveWatchers>0&&this.deactivateInputs(),void 0!==this.variantInput&&(this.variantInput.removeWatcher(this,!1,void 0),this.variantInput=void 0),this.qualifiers=void 0,this.variant=void 0},t.prototype.addQualifiers=function(e){this.qualifiers=e,this.qualifiedVariant=!1,e.isConstant()||(e.addWatcher(this,-1,!1,!1,!1),"schedulingError"in this.prototype&&this.inputs.push(e))},t.prototype.addVariant=function(e){this.variantInput=e,this.variant=e.result,e.isConstant()||e.addWatcher(this,0,!1,!1,!0)},t.prototype.updateInput=function(e,t){var i=!1;if(void 0!==t){if(0===e)this.variant=t,this.markAsChanged();else{var r=t.value.some(isTrue);i=this.updateQualified(r)}i&&this.deferred&&this.isReady()&&this.undefer()}},t.prototype.isDeferableInput=function(e,t){return e===-1||this.qualifiedVariant},t.prototype.setDataSourceResultMode=function(e){this.isActive()&&(e&&!this.dataSourceResultMode?(this.qualifiedVariant&&this.variantInput.activeWatcherBecomesDataSourceAware(this),this.markAsChanged()):!e&&this.dataSourceResultMode&&(this.qualifiedVariant&&this.variantInput.activeWatcherNoLongerIsDataSourceAware(this),this.markAsChanged())),this.dataSourceResultMode=e},t.prototype.updateQualified=function(e){var t=!1;return e!==this.qualifiedVariant&&(this.nrActiveWatchers>0&&(e?this.activateVariant():void 0!==this.qualifiedVariant&&(this.deactivateVariant(),t=!0),this.qualifiedVariant=e),this.markAsChanged()),t},t.prototype.activateVariant=function(){void 0===this.variantInput&&this.addVariant(getEvaluationNode(this.prototype.functionNodes[0],this.local)),this.variantInput.activate(this,this.dataSourceResultMode),this.variantInput.isScheduled()&&this.variantInput.addForcedUpdate(this),"schedulingError"in this.prototype&&!this.variantInput.isConstant()&&this.inputs.push(this.variantInput)},t.prototype.deactivateVariant=function(){this.variantInput.deactivate(this,this.dataSourceResultMode),"schedulingError"in this.prototype&&!this.variantInput.isConstant()&&this.inputs.pop()},t.prototype.isConstant=function(){return!1},t.prototype.eval=function(){if(this.qualifiedVariant){if(!objectEqual(this.result.value,this.variant.value)||!this.result.equalLabels(this.variant))return this.result.copy(this.variant),!0}else if(void 0!==this.result.value||this.result.hasLabels())return this.result.set(void 0),!0;return!1},t.prototype.activateInputs=function(){this.qualifiers.activate(this,!1),this.qualifiers.isScheduled()?this.qualifiers.addForcedUpdate(this):(this.updateInput(-1,this.qualifiers.result),this.inputHasChanged||this.markAsChanged())},t.prototype.deactivateInputs=function(){void 0!==this.qualifiers&&(this.qualifiedVariant&&(this.deactivateVariant(),this.qualifiedVariant=void 0),this.qualifiers.deactivate(this,!1))},t.prototype.write=function(e,t,i,r){var n=this;this.qualifiedVariant?(void 0!==r&&"identifiers"in this.result&&(r=r.map(function(e){return e.copyWithIdentity(n.result.identifiers[e.index])})),this.variantInput.write(e,t,i,r)):Utilities.warn("dead ended write: no qualified variant at "+gWriteAction)},t.prototype.isQualified=function(){return this.qualifiedVariant},t.prototype.debugName=function(){return"variant1"},t.prototype.specificExplanation=function(t,i,r){void 0===r&&(r=!1);var n,o=this.qualifiers.prototype;e.prototype.specificExplanation.call(this,t,i,!0);for(var s=0;s!==this.qualifiers.qualifiers.length;s++){var a=String(s)+": "+String(this.qualifiers.qualifiedVariants[s]);if(t[a]={},0===this.qualifiers.qualifierInputs[s].length)n=t[a].qualifier="default";else{n=t[a].qualifier={};for(var d=0;d!==this.qualifiers.qualifierInputs[s].length;d++){var u;u=void 0!==o.qualifiers[s][d].attribute?o.qualifiers[s][d].attribute+"@"+o.qualifiers[s][d].localToArea:String(d),n[u+(this.qualifiers.qualifiers[s][d].holds()?" == ":" != ")+this.qualifiers.qualifiers[s][d].matchValue()+": "+this.qualifiers.qualifierInputs[s][d].debugName()]=this.qualifiers.qualifierInputs[s][d].explain(void 0)}}void 0!==this.variantInput&&(t[a]["variant: "+this.variantInput.debugName()]=this.variantInput.explain(void 0)),void 0!==i&&"values"in i&&void 0!==this.variantInput&&(t[a]["variant: "+this.variantInput.debugName()]._definedIn=getClassPath(i.values[0]))}return t},t.prototype.toString=function(){var e=this.qualifiedVariant+" => "+(void 0===this.variantInput?"undefined":cdlifyLim(this.variantInput.result.value,80));return this.prototype.idStr()+"="+e},t.prototype.toFullString=function(){for(var e="",t=0;t!==this.qualifiers.qualifiers.length;t++){0!==t&&(e+=" ~ ");for(var i="",r=0;r!==this.qualifiers.qualifierInputs[t].length;r++)0!==r&&(i+=", "),i+=this.qualifiers.prototype.qualifiers[t][r].toSymString()+(this.qualifiers.qualifiers[t][r].holds()?" == ":" != ")+this.qualifiers.qualifiers[t][r].matchValue();e+="{"+i+"}"}return e+" => "+this.variantInput.toFullString()},t.prototype.removeWatcherFromInactiveNodes=function(){this.qualifiedVariant||void 0===this.variantInput||this.variantInput.isConstant()||(this.variantInput.removeWatcher(this,!1,void 0),this.variantInput=void 0)},t.prototype.allLogInputs=function(){return void 0===this.variantInput?[this.qualifiers]:[this.qualifiers,this.variantInput]},t}(EvaluationNode),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),EvaluationIdentify=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.constant=!0,r.identificationAttribute=void 0,r.unidentified=new WeakMap,r.nextUniqueId=0,r.inputs=new Array(t.functionArguments.length),r.arguments=new Array(t.functionArguments.length),r.result.value=emptyDataSourceResult,r.dataSourceAware=!0,r}return __extends(t,e),t.prototype.destroy=function(){void 0!==this.dataSourceInput&&this.releaseDataSourceInput(),e.prototype.destroy.call(this)},t.prototype.addArgument=function(e,t){this.inputs[e]=t,this.arguments[e]=t.result,t.isConstant()?this.updateInput(e,t.result):(this.constant=!1,t.addWatcher(this,e,!0,!0,1===e))},t.prototype.setDataSourceResultMode=function(e){this.inputs[1].setDataSourceResultMode(e),this.dataSourceResultMode=e},t.prototype.setDataSourceInput=function(e){this.dataSourceInput!==e&&(this.dataSourceInput=e,this.updateIdentificationQuery())},t.prototype.updateIdentificationQuery=function(){void 0!==this.dataSourceIdentify&&this.dataSourceIdentify.removeResultReceiver(this),void 0===this.identificationAttribute?(this.dataSourceIdentify=void 0,this.result.copy(this.arguments[1])):"string"==typeof this.identificationAttribute&&(this.dataSourceIdentify=this.dataSourceInput.applyIdentity(this.identificationAttribute,this,this.inputs[0].querySourceId()),this.result.dataSource=this.dataSourceIdentify,this.result.value=emptyDataSourceResult),this.markAsChanged()},t.prototype.releaseDataSourceInput=function(){this.dataSourceIdentify.removeResultReceiver(this),this.dataSourceIdentify=void 0,this.dataSourceInput=void 0},t.prototype.updateInput=function(e,t){function i(){var e=t.value;if(e instanceof Array&&1===e.length&&(e=e[0]),e===_)return"";if("object"!=typeof e||e instanceof NonAV)return e;var i=Object.keys(e);if(1===i.length){var r=i[0];return e=e[r],e===_||e instanceof Array&&1===e.length&&e[0]===_?r:void 0}}switch(this.arguments[e]=t,e){case 0:this.identificationAttribute=i(),void 0===this.identificationAttribute?this.identificationQuery=makeSimpleQueryDefault(getDeOSedValue(t.value),void 0):void 0!==this.identificationQuery&&(this.identificationQuery=void 0),this.dataSourceResultMode?this.updateIdentificationQuery():this.markAsChanged();break;case 1:"dataSource"in t?(this.dataSourceResultMode=!0,this.result.value=t.value,this.setDataSourceInput(t.dataSource)):(this.dataSourceResultMode=!1,this.markAsChanged())}},t.prototype.newDataSourceResult=function(e){},t.prototype.reextractData=function(){assert(!1,"should not be called")},t.prototype.isConstant=function(){return this.constant},t.prototype.eval=function(){return this.dataSourceResultMode||(this.result.value=this.arguments[1].value,this.result.copyLabels(this.arguments[1]),this.result.identifiers=this.getIdentifiers(this.arguments[1].value)),!0},t.prototype.getIdentifiers=function(e){var t=this,i=e instanceof Array?e:[e],r=new Array(i.length);if("string"==typeof this.identificationAttribute)for(var n=0;n!==i.length;n++)if(""===this.identificationAttribute)r[n]=this.getUniqueId(i[n]);else{var o=i[n]instanceof ElementReference?i[n].getElement():i[n]instanceof Object?i[n][this.identificationAttribute]:this.getUniqueId(i[n]);o instanceof Array&&(o=1===o.length?o[0]:this.getUniqueId(i[n])),r[n]=o}else r=void 0!==this.identificationQuery?i.map(function(e){var i=getDeOSedValue(t.identificationQuery.execute([e],void 0,void 0,void 0,void 0));return isSimpleType(i)?i:cdlifyNormalized(i)}):i.map(function(e){return t.identificationAttribute});return r},t.prototype.getUniqueId=function(e){if(isAV(e)){if(!this.unidentified.has(e)){var t="id_"+String(this.watcherId)+"_"+this.nextUniqueId++;this.unidentified.set(e,t)}return this.unidentified.get(e)}return e instanceof NonAV?e.stringify():e},t.prototype.write=function(e,t,i,r){var n=this,o=void 0;void 0!==r&&"string"==typeof this.identificationAttribute?o=r.map(function(e){if(void 0!==e.identity){var t=e.copy();return void 0===t.addedAttributes&&(t.addedAttributes={}),t.addedAttributes[n.identificationAttribute]=ensureOS(t.identity),t.identity=void 0,t.index=void 0,t}return e}):void 0!==r&&assert(void 0===this.identificationQuery,"TODO: writing for complex identification"),void 0!==this.inputs[1]&&this.inputs[1].write(e,t,i,o)},t.prototype.debugName=function(){return"identify"},t.prototype.multiQuerySourceIds=function(){return this.inputs[1].multiQuerySourceIds()},t}(EvaluationNodeWithArguments);identify.classConstructor=EvaluationIdentify;var EvaluationSort=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.result.value=constEmptyOS,r.dataSourceAware=!0,r.dataSourceResultMode=!0,r.orderingResultWatcher=void 0,r.result.value=emptyDataSourceResult,t.areaSort&&(r.sortKeyExportIds=void 0,r.sortKeyExportIdMap=void 0,r.areas={}),r}return __extends(t,e),t.prototype.removeAsWatcher=function(){var t=this.inputs[0];e.prototype.removeAsWatcher.call(this);for(var i in this.areas){var r=this.areas[i];for(var n in r){var o=r[n].watched;o.removeWatcher(this,!1,!1),r[n].active&&o!==t&&o.deactivate(this,!1)}}this.areas=void 0},t.prototype.updateInput=function(e,t){if(this.arguments[e]=t,1===e)this.setSortKey(t.value);else if(0===e)!("dataSource"in t||"dataSource"in this.result)||!this.inputs[0].isScheduled()&&this.inputs[0].isActive()?"dataSource"in t?this.setDataSourceInput(t.dataSource):(void 0!==this.dataSourceInput&&(this.releaseDataSourceInput(),this.dataSourceInput=void 0),this.prototype.areaSort?this.prototype.areaSort&&this.nrActiveWatchers>0&&this.setAreas(t.value)&&this.markAsChanged():this.markAsChanged()):this.inputs[0].addForcedUpdate(this);else{var i=e[0],r=e[1];if(void 0!==t)this.areas[i][r].result=t;else{var n=this.areas[i];i in this.sortKeyExportIdMap||delete this.areas[i],n[r].active&&n[r].watched.deactivate(this,!1),n[r].watched.removeWatcher(this,!1,!1),delete n[r]}this.markAsChanged()}},t.prototype.setSortKey=function(e){this.paths=[],this.order=[],this.valueMap=[],this.comparisonFunctions=[],void 0!==e&&this.determineSortKeys(e,[]),void 0!==this.inputs[0]&&void 0!==this.inputs[0].result&&"dataSource"in this.inputs[0].result?this.setDataSourceComparisonQuery(this.inputs[0].result.dataSource):(void 0!==this.dataSourceInput&&this.releaseDataSourceInput(),this.prototype.areaSort&&void 0!==this.inputs[0]&&(this.determineSortKeyExportIds(),this.setAreas(this.inputs[0].result.value)&&this.markAsChanged()),this.markAsChanged())},t.prototype.determineSortKeys=function(e,t){function i(e){return e instanceof Array&&0!==e.length&&e.every(function(e){return isSimpleType(e)})}function r(e){return e instanceof Array&&0!==e.length&&e.every(function(e){return e instanceof ComparisonFunctionValue})}if(!(e instanceof Array)){if(void 0===e)return;e=[e]}for(var n=[],o=[],s=0;s<e.length;s++){var a=e[s];"object"==typeof a&&isAV(a)?o.push(a):n.push(a)}if(i(n)){if(1!==n.length||"ascending"!==n[0]&&"descending"!==n[0]){for(var d={},u=0;u<n.length;u++)d[n[u]]=u;this.paths.push(t),this.order.push(1),this.valueMap.push(d)}else this.paths.push(t),this.order.push("ascending"===n[0]?1:-1),this.valueMap.push(void 0);this.comparisonFunctions.push(void 0)}else r(n)?(this.paths.push(t),this.order=cconcat(this.order,n.map(function(e){return e.inAscendingOrder()?1:-1})),this.valueMap.push(void 0),this.comparisonFunctions.push(n)):0!==n.length&&Utilities.warn("invalid sort key at path '"+t.join(".")+"': "+cdlify(n));for(var s=0;s<o.length;s++)for(var h in o[s])this.determineSortKeys(o[s][h],t.concat(h))},t.prototype.determineSortKeyExportIds=function(){this.sortKeyExportIds=[],this.sortKeyExportIdMap={};for(var e=0;e<this.paths.length;e++)if(0!==this.paths[e].length){var t=normalizePath(this.paths[e]),i=getPathAssociation(t,pathToExportId);void 0===i?Utilities.warn("unknown export id for "+t.join(".")):(this.sortKeyExportIdMap[i]=this.sortKeyExportIds.length,this.sortKeyExportIds.push(i))}},t.prototype.setDataSourceInput=function(e){this.dataSourceInput!==e&&this.setDataSourceComparisonQuery(e)},t.prototype.releaseDataSourceInput=function(){void 0!==this.orderingResultWatcher&&(this.orderingResultWatcher.destroy(),this.orderingResultWatcher=void 0),void 0!==this.sortResultNode&&(this.sortResultNode.removeResultReceiver(this),this.sortResultNode=void 0),this.sortQuery.removeResultReceiver(this),this.sortQuery=void 0,this.dataSourceInput=void 0,delete this.result.dataSource,this.markAsChanged()},t.prototype.setDataSourceComparisonQuery=function(e){var t=this.pathComparisonFunctions();this.dataSourceInput===e?this.sortQuery.updateSortKeys(t):(void 0!==this.dataSourceInput&&(void 0!==this.orderingResultWatcher&&(this.orderingResultWatcher.destroy(),this.orderingResultWatcher=void 0),void 0!==this.sortResultNode&&(this.sortResultNode.removeResultReceiver(this),this.sortResultNode=void 0),this.sortQuery.removeResultReceiver(this)),this.sortQuery=e.applySort(t,this),this.dataSourceResultMode?this.sortResultNode=this.sortQuery.applyDataQuery(_,this,DataSourceQueryByData._id,this.watcherId):(assert(void 0===this.orderingResultWatcher,"debugging"),this.orderingResultWatcher=new OrderingResultWatcher(globalInternalQCM,this,void 0),this.orderingResultWatcher.init(this.sortQuery),this.isActive()&&this.orderingResultWatcher.activate(),this.sortQuery.updateIndexerMonitoringForDominatedPath()),this.dataSourceInput=e,this.markAsChanged())},t.prototype.pathComparisonFunctions=function(){for(var e=new Array(this.paths.length),t=0;t<this.paths.length;t++)void 0===this.comparisonFunctions[t]?e[t]={path:this.paths[t],comparisons:[{queries:[],simpleQueries:void 0,orderByValue:!0,inAscendingOrder:1===this.order[t],unmatched:void 0}]}:e[t]={path:this.paths[t],comparisons:this.buildComparisonElements(this.comparisonFunctions[t])};return e},t.prototype.setDataSourceResultMode=function(e){void 0!==this.dataSourceInput&&(e&&!this.dataSourceResultMode?(assert(void 0===this.sortResultNode,"debugging"),void 0!==this.orderingResultWatcher&&(this.orderingResultWatcher.destroy(),this.orderingResultWatcher=void 0),this.sortResultNode=this.sortQuery.applyDataQuery(_,this,DataSourceQueryByData._id,this.watcherId),void 0!==this.result&&(this.result.value=emptyDataSourceResult),this.sortQuery.stopIndexerMonitoring()):!e&&this.dataSourceResultMode&&(assert(void 0===this.orderingResultWatcher,"debugging"),void 0!==this.sortResultNode&&(this.sortResultNode.removeResultReceiver(this),this.sortResultNode=void 0),this.orderingResultWatcher=new OrderingResultWatcher(globalInternalQCM,this,void 0),this.orderingResultWatcher.init(this.sortQuery),this.isActive()&&this.orderingResultWatcher.activate(),this.sortQuery.updateIndexerMonitoringForDominatedPath(),this.markAsChanged())),this.dataSourceResultMode=e},t.prototype.dontSort=function(){return this.prototype.areaSort?0===this.sortKeyExportIds.length:0===this.paths.length},t.prototype.sortDirectly=function(){return 1===this.paths.length&&0===this.paths[0].length&&void 0===this.valueMap[0]&&void 0===this.comparisonFunctions[0]},t.prototype.extractDataSourceResult=function(){var e=this.result.value,t=this.sortQuery.extractData(MinimumResultRequirements.ordered,this.orderingResultWatcher),i="dataSource"in this.result;return this.result.value=t,i&&delete this.result.dataSource,i||!valueEqual(e,t)},t.prototype.reextractData=function(){assert(!this.dataSourceResultMode,"should have been disabled"),this.markAsChanged()},t.prototype.eval=function(){function e(e){var t=typeof e;return{type:t,value:e,compareKey:"string"===t?e.toLocaleLowerCase():e}}function t(e){return e.value}function i(e,t){return e.type!==t.type?e.type<t.type?-1:1:"number"===e.type?e.compareKey-t.compareKey:e.compareKey!==t.compareKey?e.compareKey<t.compareKey?-1:1:0}function r(e,t){return e.type!==t.type?"undefined"===e.type?1:"undefined"===t.type?-1:e.type<t.type?-1:1:"number"===e.type?t.compareKey-e.compareKey:e.compareKey!==t.compareKey?t.compareKey<e.compareKey?-1:1:0}if(void 0!==this.dataSourceInput)return this.dataSourceResultMode?this.result.dataSource!==this.sortResultNode&&(this.result.dataSource=this.sortResultNode,this.result.value=emptyDataSourceResult,!0):this.extractDataSourceResult();"dataSource"in this.result&&delete this.result.dataSource;var n=this.arguments[0].value instanceof Array?this.arguments[0].value:void 0===this.arguments[0].value?void 0:[this.arguments[0].value],o=this.arguments[0].identifiers,s=this.dontSort()||this.sortDirectly()&&void 0===o?void 0:this.extractKeys(n),a=this.order;if(this.result.copyLabels(this.arguments[0]),void 0!==n)if(n===emptyDataSourceResult&&"dataSource"in this.result)this.result.value=n;else if(this.dontSort())this.result.value=n;else if(this.sortDirectly()&&void 0===o)this.result.value=n.map(e).sort(1===this.order[0]?i:r).map(t);else{for(var d=new Array(n.length),u=0;u<n.length;u++)d[u]={pos:u,elt:n[u],key:s[u],identity:void 0!==o?o[u]:void 0};d.sort(function(e,t){return compareKeys(e,t,a)}),this.result.value=d.map(function(e){return e.elt}),void 0!==o&&(o=d.map(function(e){return e.identity}))}return this.result.setIdentifiers(o),!0},t.prototype.setAreas=function(e){var t=!1,i=!1,r={};void 0===e?e=[]:e instanceof Array||(e=[e]);for(var n=0;n!==e.length;n++)if(e[n]instanceof ElementReference)for(var o=e[n],s=allAreaMonitor.getAreaById(o.element),a=0;a<this.sortKeyExportIds.length;a++){var d=this.sortKeyExportIds[a],u=this.areas[d];if(void 0===u&&(u=this.areas[d]={}),void 0!==s&&void 0!==s.exports&&d in s.exports){var h=s.getExport(d);r[s.areaId]=!0,s.areaId in u||(u[s.areaId]={watched:h,active:!1,result:void 0},h.addWatcher(this,[d,s.areaId],!0,!1,!1)),this.nrActiveWatchers>0&&!h.isConstant()&&!u[s.areaId].active&&(h.activate(this,!1),u[s.areaId].active=!0,h.isScheduled()&&(i=!0,h.forceUpdate(this,!1)),t=!0),u[s.areaId].result=h.result}}for(var l in this.areas){var u=this.areas[l],c=!1;l in this.sortKeyExportIdMap||(delete this.areas[l],c=!0);for(var p in u)!c&&p in r||(u[p].active&&u[p].watched.deactivate(this,!1),u[p].watched.removeWatcher(this,!1,!1),delete u[p],t=!0)}return(i||t)&&"combinedInputs"in this&&(this.combinedInputs=void 0),t&&!i},t.prototype.activateInputs=function(){e.prototype.activateInputs.call(this),this.paths=[],this.order=[],this.valueMap=[],this.comparisonFunctions=[],this.determineSortKeys(this.arguments[1].value,[]),this.prototype.areaSort&&void 0!==this.inputs[0]&&(this.determineSortKeyExportIds(),this.inputs[0].isScheduled()?this.inputs[0].forceUpdate(this,!1):this.setAreas(this.inputs[0].result.value)&&this.markAsChanged())},t.prototype.deactivateInputs=function(){if(e.prototype.deactivateInputs.call(this),void 0!==this.sortQuery&&this.sortQuery.stopIndexerMonitoring(),this.prototype.areaSort)for(var t=0;t<this.sortKeyExportIds.length;t++){var i=this.areas[this.sortKeyExportIds[t]];for(var r in i)i[r].active&&(i[r].watched.deactivate(this,!1),i[r].active=!1)}},t.prototype.allInputs=function(){if(this.prototype.areaSort){if(void 0===this.combinedInputs){for(var e=this.inputs.slice(0),t=0;t<this.sortKeyExportIds.length;t++){var i=this.areas[this.sortKeyExportIds[t]];for(var r in i)i[r].active&&e.push(i[r].watched)}this.combinedInputs=e}return this.combinedInputs}return this.inputs},t.prototype.allLogInputs=function(){if(this.prototype.areaSort){for(var e=this.inputs.slice(0),t=0;t<this.sortKeyExportIds.length;t++){var i=this.areas[this.sortKeyExportIds[t]];for(var r in i)e.push(i[r].watched)}return e}return this.inputs},t.prototype.debugName=function(){return"sort"},t.prototype.extractKeys=function(e){function t(e,t){for(var i=e,r=0;r!==t.length;r++){var n=i instanceof Array?i[0]:i;if(!isAV(n))return;i=n[t[r]]}return i}var i,r=[];if(void 0===e)return constEmptyOS;i=new Array(e.length);for(var n=0;n!==e.length;n++){var o=[];if(this.prototype.areaSort&&e[n]instanceof ElementReference)for(var s=e[n],a=0;a<this.sortKeyExportIds.length;a++){var d=this.sortKeyExportIds[a],u=this.areas[d][s.element];if(void 0!==u){var h=getDeOSedValue(u.result.value);if(void 0!==this.valueMap[a])o.push({value:this.valueMap[a][h],type:"number"});else{var l=typeof h;o.push({value:"string"===l?h.toLocaleLowerCase():h,type:l})}}else o.push({value:void 0,type:void 0})}else for(var a=0;a<this.paths.length;a++){var h=t(e[n],this.paths[a]);if(h instanceof Array&&1===h.length&&(h=h[0]),void 0!==this.comparisonFunctions[a])void 0===r[a]&&(r[a]=this.buildComparisonElements(this.comparisonFunctions[a])),o=cconcat(o,this.applyComparisonFunctions(h,r[a]));else if(void 0!==this.valueMap[a]){var c=this.valueMap[a][h];o.push({value:c,type:void 0===c?"undefined":"number"})}else{var l=typeof h;"object"===l&&(l="undefined",h=void 0),o.push({value:"string"===l?h.toLocaleLowerCase():h,type:l})}}i[n]=o}return i},t.prototype.multiQuerySourceIds=function(){return this.inputs[0].multiQuerySourceIds()},t.prototype.buildComparisonElements=function(e){return e.map(function(e){for(var t=-1,i=e.elements.length,r=[],n=0;n<i;n++){var o=e.elements[n],s=getDeOSedValue(o);s===unmatched?(t!==-1&&Utilities.warn("more than one unmatched in comparison function"),t=n):(n!==i-1||s!==ascending&&s!==descending)&&r.push(o)}return 1===r.length&&r[0]instanceof Array&&r[0].every(function(e){return e instanceof ComparisonFunctionValue})&&(r=r[0].map(function(e){return e.elements.reduce(function(e,t){return e.concat(t)},[])})),{queries:r,simpleQueries:r.map(function(e){return makeSimpleQuery(e,void 0)}),orderByValue:e.orderByValue(),inAscendingOrder:e.inAscendingOrder(),unmatched:t}})},t.prototype.applyComparisonFunctions=function(e,t){for(var i=new Array(t.length),r=0;r<t.length;r++){for(var n=t[r],o=n.simpleQueries,s=0,a=void 0;s<o.length&&!o[s].testSingle(e);)s++;if(s<o.length)if(o[s].isProjection()){for(a=singleton(o[s].execute([e],void 0,void 0,void 0,void 0));void 0===a&&s<o.length;)o[s].isProjection()&&(a=singleton(o[s].execute([e],void 0,void 0,void 0,void 0)));i[r]={value:void 0===a?n.unmatched===-1||s<n.unmatched?s:s+1:singleton(a),type:void 0===a?"number":typeof a}}else{if(n.orderByValue){var d=typeof e;i[r]={value:"string"===d?e.toLocaleLowerCase():e,type:d};break}i[r]={value:n.unmatched===-1||s<n.unmatched?s:s+1,type:"number"}}else n.orderByValue||n.unmatched===-1?i[r]={value:void 0,type:"undefined"}:i[r]={value:n.unmatched,type:"number"}}return i},t.prototype.refreshIndexerAndPaths=function(e,t){this.sortQuery.updateIndexerMonitoringForDominatedPath(),this.markAsChanged()},t.prototype.replaceIndexerAndPaths=function(e,t,i,r){this.sortQuery.updateIndexerMonitoringForDominatedPath(),this.markAsChanged()},t.prototype.updateDataElementPosition=function(e,t,i,r){this.markAsChanged()},t}(EvaluationFunctionApplication),EvaluationPositionFunction=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.orderingQuery=void 0,r.orderingResultWatcher=void 0,r.queryUpdateCounter=0,r.counterAtLastExtraction=-1,r.dataSourceAware=!0,r.dataSourceResultMode=!0,r.result.value=emptyDataSourceResult,r}return __extends(t,e),t.prototype.destroy=function(){this.unsetQuery(),e.prototype.destroy.call(this)},t.prototype.addArgument=function(e,t){this.inputs[e]=t,this.arguments[e]=t.result,t.isConstant()||(this.constant=!1,
t.addWatcher(this,e,!0,!0,1===e)),0===e?void 0!==this.inputs[1]&&this.setQuery(t.result):this.setArgument(t.result)},t.prototype.setQuery=function(e){void 0===this.inputs[1]||!("dataSource"in this.inputs[1].result||"dataSource"in this.result)||!this.inputs[1].isScheduled()&&this.inputs[1].isActive()?void 0!==this.inputs[1]&&"dataSource"in this.inputs[1].result?this.setDataSourceOrderingQuery(e,this.inputs[1].result.dataSource):(void 0!==this.dataSourceInput&&this.releaseDataSourceInput(),this.markAsChanged()):this.inputs[1].addForcedUpdate(this)},t.prototype.unsetQuery=function(){void 0!==this.dataSourceInput&&this.releaseDataSourceInput()},t.prototype.setDataSourceOrderingQuery=function(e,t){this.dataSourceInput===t?this.orderingQuery.updateOrdering(e):(void 0!==this.orderingResultWatcher&&this.orderingResultWatcher.destroy(),void 0!==this.dataSourceInput&&(this.dataSourceInput.removeOrderingApplication(this.orderingQuery),this.orderingQuery.removeResultReceiver(this)),this.orderingQuery=t.applyOrdering(e,this),this.dataSourceInput=t,this.dataSourceResultMode||(this.orderingResultWatcher=new OrderingResultWatcher(globalInternalQCM,this,void 0),this.orderingResultWatcher.init(this.orderingQuery),this.isActive()&&this.orderingResultWatcher.activate(),this.orderingQuery.updateIndexerMonitoringForDominatedPath()),this.markAsChanged())},t.prototype.releaseDataSourceInput=function(){void 0!==this.orderingResultWatcher&&(this.orderingResultWatcher.destroy(),this.orderingResultWatcher=void 0),this.dataSourceInput.removeOrderingApplication(this.orderingQuery),this.orderingQuery.removeResultReceiver(this),this.orderingQuery=void 0,this.dataSourceInput=void 0,this.markAsChanged()},t.prototype.extractDataSourceResult=function(){var e=this.result.value,t=this.orderingQuery.extractData(MinimumResultRequirements.ordered,this.orderingResultWatcher),i="dataSource"in this.result;return this.counterAtLastExtraction=this.queryUpdateCounter,this.result.value=t,i&&delete this.result.dataSource,i||!valueEqual(e,t)},t.prototype.setDataSourceResultMode=function(e){void 0!==this.dataSourceInput&&(e&&!this.dataSourceResultMode?(void 0!==this.orderingResultWatcher&&(this.orderingResultWatcher.destroy(),this.orderingResultWatcher=void 0),void 0!==this.result&&(this.result.value=emptyDataSourceResult),this.orderingQuery.stopIndexerMonitoring()):!e&&this.dataSourceResultMode&&(this.orderingResultWatcher=new OrderingResultWatcher(globalInternalQCM,this,void 0),this.orderingResultWatcher.init(this.orderingQuery),this.isActive()&&this.orderingResultWatcher.activate(),this.orderingQuery.updateIndexerMonitoringForDominatedPath(),this.markAsChanged())),this.dataSourceResultMode=e},t.prototype.setArgument=function(e){void 0!==this.arguments[0]&&this.setQuery(this.arguments[0].value)},t.prototype.eval=function(){var e=this.result.value,t=!1;return void 0!==this.dataSourceInput?this.dataSourceResultMode?this.result.dataSource!==this.orderingQuery&&(this.result.dataSource=this.orderingQuery,this.result.value=emptyDataSourceResult,!0):this.extractDataSourceResult():("dataSource"in this.result&&(delete this.result.dataSource,t=!0),this.execute(),t||!valueEqual(e,this.result.value))},t.prototype.deactivateInputs=function(){void 0!==this.orderingQuery&&this.orderingQuery.stopIndexerMonitoring(),e.prototype.deactivateInputs.call(this)},t.prototype.write=function(e,t,i,r){var n=this.getSelectedPositions(r);return 0===n.length?void Utilities.warn("dead-ended write: empty selection by "+this.bif.name+" at "+gWriteAction):void this.getWritableInput().write(e,t,i,n)},t.prototype.getWritableInput=function(){},t.prototype.getSelectedPositions=function(e){return Utilities.warn("dead-ended write: derived class doesn't implement write at "+gWriteAction),[]},t.prototype.reextractData=function(){this.markAsChanged()},t.prototype.refreshIndexerAndPaths=function(e,t){this.orderingQuery.updateIndexerMonitoringForDominatedPath(),this.markAsChanged()},t.prototype.replaceIndexerAndPaths=function(e,t,i,r){this.orderingQuery.updateIndexerMonitoringForDominatedPath(),this.markAsChanged()},t.prototype.updateDataElementPosition=function(e,t,i,r){this.markAsChanged()},t}(EvaluationFunctionApplication),EvaluationPFFirst=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.updateInput=function(e,t){this.arguments[e]=t,void 0===t?this.unsetQuery():this.setArgument(t)},t.prototype.setQuery=function(e){void 0!==this.inputs[0]&&"dataSource"in this.inputs[0].result?this.setDataSourceOrderingQuery(new RangeValue([0],!0,!0),this.inputs[0].result.dataSource):(void 0!==this.dataSourceInput&&this.releaseDataSourceInput(),this.markAsChanged())},t.prototype.execute=function(){if(1!==this.arguments.length||void 0===this.arguments[0].value)return void this.result.set(constEmptyOS);var e=this.arguments[0].value,t=this.arguments[0].identifiers;assert(e instanceof Array,"argument not os"),this.result.value=0===e.length?[]:[e[0]],void 0!==t?this.result.identifiers=t.slice(0,e.length):"identifiers"in this.result&&delete this.result.identifiers},t.prototype.getWritableInput=function(){return this.inputs[0]},t.prototype.getSelectedPositions=function(e){if(1!==this.arguments.length||void 0===this.arguments[0].value)return Utilities.warn("dead-ended write: undefined or wrong argument at "+gWriteAction),[];if(void 0!==e&&(1!==e.length||0!==e[0].index||1!==e[0].length))return Utilities.warn("dead-ended write: cannot write through first at "+gWriteAction),[];var t=this.arguments[0].value;return 0===t.length?[]:void 0===e?[new DataPosition(0,1)]:e},t}(EvaluationPositionFunction);first.classConstructor=EvaluationPFFirst;var EvaluationPFLast=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.updateInput=function(e,t){this.arguments[e]=t,void 0===t?this.unsetQuery():this.setArgument(t)},t.prototype.setQuery=function(e){void 0!==this.inputs[0]&&"dataSource"in this.inputs[0].result?this.setDataSourceOrderingQuery(new RangeValue([-1],!0,!0),this.inputs[0].result.dataSource):(void 0!==this.dataSourceInput&&this.releaseDataSourceInput(),this.markAsChanged())},t.prototype.execute=function(){if(1!==this.arguments.length||void 0===this.arguments[0].value)return void this.result.set(constEmptyOS);var e=this.arguments[0].value,t=this.arguments[0].identifiers;assert(e instanceof Array,"argument not os"),this.result.value=0===e.length?[]:[e[e.length-1]],void 0!==t?this.result.identifiers=0===e.length?[]:t.slice(-1):"identifiers"in this.result&&delete this.result.identifiers},t.prototype.getWritableInput=function(){return this.inputs[0]},t.prototype.getSelectedPositions=function(e){if(1!==this.arguments.length||void 0===this.arguments[0].value)return Utilities.warn("dead-ended write: undefined or wrong argument at "+gWriteAction),[];if(void 0!==e&&(1!==e.length||0!==e[0].index||1!==e[0].length))return Utilities.warn("dead-ended write: cannot write through last at "+gWriteAction),[];var t=this.arguments[0].value;return 0===t.length?[]:void 0===e?[new DataPosition(t.length-1,1)]:[new DataPosition(t.length-1,1,e[0].path,e[0].sub)]},t}(EvaluationPositionFunction);last.classConstructor=EvaluationPFLast;var EvaluationPFPos=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.updateInput=function(e,t){this.arguments[e]=t,void 0===t?this.unsetQuery():0===e?this.setQuery(t.value):this.setArgument(t)},t.prototype.execute=function(){function e(e){var t=e.min,r=e.max;if(t<0&&(t+=i.length),r<0&&(r+=i.length),t>r){var n=r;r=t,t=n}return e.closedLower||t++,e.closedUpper||r--,r>=i.length&&(r=i.length-1),[t,r]}if(2!==this.arguments.length||void 0===this.arguments[0].value||void 0===this.arguments[1].value)return void this.result.set(constEmptyOS);var t=this.arguments[0].value,i=this.arguments[1].value,r=this.arguments[0].identifiers;assert(t instanceof Array&&i instanceof Array,"argument not os");for(var n=[],o=void 0===r?void 0:[],s=0;s<t.length;s++){var a=t[s];if(a instanceof RangeValue){var d=e(a);Array.prototype.push.apply(n,i.slice(d[0],d[1]+1)),void 0!==r&&Array.prototype.push.apply(o,r.slice(d[0],d[1]+1))}else"number"==typeof a?-i.length<=a&&a<i.length&&(n.push(a<0?i[i.length+a]:i[a]),void 0!==r&&o.push(a<0?r[i.length+a]:r[a])):console.error("not a position:",a)}this.result.value=n,this.result.setIdentifiers(o)},t.prototype.getWritableInput=function(){return this.inputs[1]},t.prototype.getSelectedPositions=function(e){if(2!==this.arguments.length||void 0===this.arguments[0].value||void 0===this.arguments[1].value)return Utilities.warn("dead-ended write: undefined or wrong argument at "+gWriteAction),[];if(void 0!==e&&1!==e.length)return Utilities.warn("dead-ended write: cannot write through pos at "+gWriteAction),[];for(var t=this.arguments[0].value,i=this.arguments[1].size(),r=[],n=0;n<t.length;n++){var o,s,a=t[n];if(a instanceof RangeValue){var d=a,u=d.min,h=d.max;u<0&&(u+=i),h<0&&(h+=i),o=u<h?u:h,s=u<h?h-u+1:u-h+1}else{if(!(a>=-i))return Utilities.warn("dead-ended write: cannot write through pos at "+gWriteAction),[];o=a<0?i+a:a,s=1}void 0===e?r.push(new DataPosition(o,s)):r.push(new DataPosition(e[0].index+o,e[0].length,e[0].path,e[0].sub))}return r},t}(EvaluationPositionFunction);pos.classConstructor=EvaluationPFPos;var EvaluationPositioningDependency=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.scheduledAtPosition=-2,t.isBeingInitialized=!1,t}return __extends(t,e),t.prototype.isReady=function(){return!globalGeometryTask.isScheduled},t.prototype.undefer=function(){if(void 0!==this.awaitingThis){var e=this.awaitingThis;e.forEach(function(e,t){e.undefer(),evaluationQueue.schedule(e,!1)}),this.awaitingThis=void 0}},t.prototype.updateInput=function(e,t){},t.prototype.eval=function(){return assert(!1,"should not be called"),!0},t}(EvaluationNode),globalPositioningDependency=new EvaluationPositioningDependency(void 0,void 0),EvaluationOffset=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.pairDescription={point1:{},point2:{}},r.labelPairs={},r.labelPosInOS={},r.nextPairNum=0,r.offsets={},r.offsetValues=[],r.calledFromEval=!1,r.highPriority=!1,r.me={areaId:i.getOwnId()},r.posPair=void 0,r.result.value=constEmptyOS,r.startWatching(),r}return __extends(t,e),t.prototype.destroy=function(){void 0!==this.posPair&&this.stopWatching(),e.prototype.destroy.call(this)},t.prototype.isConstant=function(){return!1},t.prototype.resultIsTransient=function(){return!0},t.prototype.startWatching=function(){this.posPair=new PosPair(this.me,void 0,this.pairDescription,void 0),this.posPair.registerHandler(this)},t.prototype.stopWatching=function(){for(var e in this.labelPairs)this.labelPairs[e].destroy();this.posPair.destroyPair(),this.posPair=void 0,this.labelPairs={}},t.prototype.allInputs=function(){return this.highPriority?this.removePositioningDependency():this.addPositioningDependency(),this.inputs},t.prototype.addPositioningDependency=function(){this.inputs[this.inputs.length-1]!==globalPositioningDependency&&(this.inputs.push(globalPositioningDependency),this.isActive()&&globalPositioningDependency.activate(this,!1))},t.prototype.removePositioningDependency=function(){this.inputs[this.inputs.length-1]===globalPositioningDependency&&(this.isActive()&&globalPositioningDependency.deactivate(this,!1),this.inputs.pop(),this.deferred&&this.undefer())},t.prototype.markAsChanged=function(){this.highPriority||globalPositioningDependency.isReady()?e.prototype.markAsChanged.call(this):this.deferred||(this.inputHasChanged=!0,this.isScheduled()&&evaluationQueue.unschedule(this),this.defer())},t.prototype.specificExplanation=function(e,t,i){if(void 0===i&&(i=!1),e._id=this.prototype.idStr(),e._result=void 0===this.result||this.result.hasLabels()?this.result:this.result.value,e._active=this.nrActiveWatchers,!i&&void 0!==this.inputs)for(var r=0;r!==this.inputs.length;r++)void 0!==this.inputs[r]&&this.inputs[r]!==globalPositioningDependency&&(e[r+": "+this.inputs[r].debugName()]=this.inputs[r].explain(void 0));return gProfile&&(e._attributedTime=this.totalAttributedTime),e},t.prototype.eval=function(){var e=!1,t=stripArray(this.arguments[0].value,!0),i=stripArray(this.arguments[1].value,!0),r=void 0!==this.arguments[2]&&isTrue(this.arguments[2].value);return objectEqual(t,this.pairDescription.point1)||(this.pairDescription.point1=t,e=!0),objectEqual(i,this.pairDescription.point2)||(this.pairDescription.point2=i,e=!0),this.highPriority!==r&&(this.highPriority=r,e=!0),e&&(this.calledFromEval=!0,this.posPair.newDescription(this.pairDescription),this.calledFromEval=!1,r&&(this.removePositioningDependency(),runGeometry()),globalGeometryTask.schedule()),!this.deferred&&!valueEqual(this.offsetValues,this.result.value)&&(this.result.value=this.offsetValues.slice(0),!0)},t.prototype.call=function(e,t,i){var r=!1;for(var n in this.posPair.changes){var o=this.posPair.changes[n];for(var s in o)"added"==o[s]?this.addPair(n,s)&&(r=!0):this.removePair(n,s)}r?(this.highPriority&&runGeometry(),globalGeometryTask.schedule(),this.highPriority||!this.inputHasChanged||this.deferred||(this.isScheduled()&&evaluationQueue.unschedule(this),this.defer())):this.markAsChanged()},t.prototype.addPair=function(e,t){var i=!1,r=this.addOffset(e,t);if(!(r in this.labelPairs)){var n=new LabelPairOffset(this,r,e,t);this.labelPairs[r]=n;var o=n.get();void 0===o&&(o=globalPos.posCalc.getCurrentValue(e,t)),this.addToOutput(r,o),i=void 0===o}return i},t.prototype.removePair=function(e,t){assert(e in this.offsets,"l1");var i=this.offsets[e];assert(t in i,"l2");var r=i[t];delete i[t],this.removeFromOutput(r),assert(r in this.labelPairs,"pairNum");var n=this.labelPairs[r];n.destroy(),delete this.labelPairs[r],Utilities.isEmptyObj(i)&&delete this.offsets[e]},t.prototype.addOffset=function(e,t){var i;i=e in this.offsets?this.offsets[e]:this.offsets[e]={};var r=i[t];return void 0===r&&(i[t]=r=this.nextPairNum++),r},t.prototype.updateOffset=function(e,t,i,r){var n=this.labelPosInOS[e];r=void 0!==r?Math.round(128*r)/128:void 0,this.offsetValues[n]!==r&&(this.offsetValues[n]=r,logValues&&this.isLogNode()&&gSimpleLog.log("offset",this.logValString(),r,"("+t+";"+i+")"),this.markAsChanged())},t.prototype.addToOutput=function(e,t){var i;t=void 0!==t?Math.round(128*t)/128:void 0,e in this.labelPosInOS?i=this.labelPosInOS[e]:this.labelPosInOS[e]=i=this.offsetValues.length,this.offsetValues[i]!==t&&(this.offsetValues[i]=t,this.calledFromEval?this.deferred&&this.undefer():this.markAsChanged())},t.prototype.removeFromOutput=function(e){var t=this.labelPosInOS[e];assert(void 0!==t,"debugging"),delete this.labelPosInOS[e],this.offsetValues.splice(t,1);for(var i in this.labelPosInOS)this.labelPosInOS[i]>t&&this.labelPosInOS[i]--;this.calledFromEval||this.markAsChanged()},t.prototype.debugName=function(){return"offset"},t}(EvaluationFunctionApplication);offset.classConstructor=EvaluationOffset;var EvaluationOverlap=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.nrOverlapping=0,r.watchedAreas={},r.result.value=constFalseOS,r}return __extends(t,e),t.prototype.updateInput=function(e,t){if(void 0!==this.result)if(0===e||1===e)void 0===t||void 0===t.value?this.setAreas(constEmptyOS):this.setAreas(t.value);else if(void 0!==t||e in this.watchedAreas){var i=void 0!==t&&t.value[0];(e in this.watchedAreas&&this.watchedAreas[e])!==i&&(i?this.incrCount():this.decrCount(),this.watchedAreas[e]=i)}},t.prototype.isConstant=function(){return!1},t.prototype.eval=function(){return!0},t.prototype.setAreas=function(e){function t(e){return e instanceof ElementReference&&e.element===EFPointer.res[0].element}var i,r;if(1!==e.length||!t(e[0])){for(var n={},o=0;o<e.length;o++)t(e[o])?Utilities.warn("EvaluationOverlap: [pointer] mixed with other areas"):(r=e[o].element,r in this.watchedAreas?n[r]=this.watchedAreas[r]:(i=areaOverlapMonitor.addWatcherFor(r,this,r),n[r]=i.value[0],i.value[0]&&this.incrCount()));for(r in this.watchedAreas)r in n||(this.watchedAreas[r]&&this.decrCount(),delete this.watchedAreas[r]);this.watchedAreas=n}},t.prototype.incrCount=function(){this.nrOverlapping++,1===this.nrOverlapping&&(this.result.value=constTrueOS,this.markAsChanged())},t.prototype.decrCount=function(){this.nrOverlapping--,assert(this.nrOverlapping>=0,"too many decrCount()"),0===this.nrOverlapping&&(this.result.value=constFalseOS,this.markAsChanged())},t.prototype.removeAsWatcher=function(){e.prototype.removeAsWatcher.call(this);for(var t in this.watchedAreas)areaOverlapMonitor.removeWatcherFor(t,this)},t}(EvaluationFunctionApplication);overlap.classConstructor=EvaluationOverlap;var EvaluationTime=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.lastInput=void 0,r.lastChangeTime=0,r.interval=1e3,r.maxTime=0,r.startCounting=!0,r.timerId=void 0,r.result.value=[0],r}return __extends(t,e),t.prototype.updateInput=function(e,t){var i=void 0===t?void 0:t.value;switch(e){case 0:objectEqual(this.lastInput,i)||(this.lastInput=i,this.markAsChanged());break;case 1:i=getDeOSedValue(i),"number"==typeof i&&i>0?i*=1e3:i=0,this.interval!==i&&(this.interval=i,this.markAsChanged()),2===this.inputs.length&&this.maxTime!==i&&(this.maxTime=i,this.markAsChanged());break;case 2:i=getDeOSedValue(i),"number"==typeof i&&i>0?i*=1e3:i=0,this.maxTime!==i&&(this.maxTime=i,this.markAsChanged())}},t.prototype.markAsChanged=function(){this.startCounting=!0,e.prototype.markAsChanged.call(this)},t.prototype.eval=function(){var e=this,t=0;return this.startCounting?(this.lastChangeTime=Date.now(),this.startCounting=!1,void 0!==this.timerId&&clearInterval(this.timerId),this.interval>0&&this.maxTime>0&&(this.timerId=setInterval(function(){return e.updateTimer()},this.interval)),t=0):t=(Date.now()-this.lastChangeTime)/1e3,t!==this.result.value[0]&&(this.result.value=[t],!0)},t.prototype.updateTimer=function(){e.prototype.markAsChanged.call(this),Date.now()-this.lastChangeTime>=this.maxTime&&(clearInterval(this.timerId),this.timerId=void 0)},t.prototype.isConstant=function(){return!1},t}(EvaluationFunctionApplication);time.classConstructor=EvaluationTime;var EvaluationChanged=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.lastInput=void 0,r.currentInput=void 0,r.status=!1,r.isOnTimeQueue=!1,r.result.value=constFalseOS,r}return __extends(t,e),t.prototype.destroy=function(){evaluationQueue.removeTimeSensitiveNode(this),e.prototype.destroy.call(this)},t.prototype.updateInput=function(e,t){this.currentInput=void 0===t?void 0:t.value,evaluationQueue.addTimeSensitiveNode(this),this.markAsChanged()},t.prototype.eval=function(){var e=!objectEqual(this.lastInput,this.currentInput);return this.inputHasChanged=!1,e!==this.status&&(this.status=e,this.result.set(e?constTrueOS:constEmptyOS),!0)},t.prototype.preWriteNotification=function(e){},t.prototype.endOfEvaluationCycleNotification=function(e){this.lastInput=this.currentInput,this.status&&this.markAsChanged()},t.prototype.isConstant=function(){return!1},t}(EvaluationFunctionApplication);changed.classConstructor=EvaluationChanged;var EvaluationCompareAreasQuery=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.queryAreaIds={},t.dataAreaIds={},t.resultAreaIds={},t.needsFullUpdate=!1,t.incrementalResult=[],t.needsSort=!1,t}return __extends(t,e),t.prototype.addArgument=function(e,t){this.inputs[e]=t,this.arguments[e]=t.result,t.isConstant()||(this.constant=!1,t.addWatcher(this,e,!1,!0,!1)),this.updateInput(e,t.result)},t.prototype.updateInput=function(e,t){this.arguments[e]=t,this.nrActiveWatchers>0?0===e?this.updateQuery(t):this.updateData(t):(this.needsFullUpdate=!0,this.markAsChanged())},t.prototype.updateQuery=function(e){!this.needsFullUpdate&&e.incremental?this.updateResult(this.queryAreaIds,this.dataAreaIds,e.added,e.removed):(this.needsFullUpdate=!0,this.markAsChanged())},t.prototype.updateData=function(e){!this.needsFullUpdate&&e.incremental?(this.updateResult(this.dataAreaIds,this.queryAreaIds,e.added,e.removed),(e.added.length>0||0===e.removed.length)&&(this.needsSort=!0,this.markAsChanged())):(this.needsFullUpdate=!0,this.markAsChanged())},t.prototype.updateResult=function(e,t,i,r){for(var n,o,s=!1,a=void 0,d=0;d<r.length;d++)n=r[d],n instanceof ElementReference&&(o=n.element,o in e&&(e[o]--,0===e[o]&&(o in t&&(void 0===a?a=[o]:a.push(o)),delete e[o])));void 0!==a&&(s=!0,this.removeFromResult(a));for(var d=0;d<i.length;d++)n=i[d],n instanceof ElementReference&&(o=n.element,o in e?e[o]++:(o in t&&(this.addToResult(o,n),s=!0),e[o]=1));s&&this.markAsChanged()},t.prototype.addToResult=function(e,t){assert(!(e in this.resultAreaIds),"bad update"),this.resultAreaIds[e]=this.incrementalResult.length,this.incrementalResult.push(t)},t.prototype.removeFromResult=function(e){var t=this.resultAreaIds,i=e.map(function(e){return t[e]}).sort(function(e,t){return e-t});assert(i.length>0,"bad update");for(var r=i.length-1;r>=0;r--){var n=i[r];assert(n<this.incrementalResult.length,"bad update");var o=this.incrementalResult[n].element;delete this.resultAreaIds[o],this.incrementalResult.splice(n,1)}for(var r=i[0];r<this.incrementalResult.length;r++)this.resultAreaIds[this.incrementalResult[r].element]=r},t.prototype.eval=function(){if(!this.needsFullUpdate)return this.result.value=this.incrementalResult.slice(0),this.needsSort&&(this.sort(this.result.value),this.needsSort=!1),!0;var e,t=this.result.value,i=this.arguments[0].value,r=this.arguments[1].value,n=[];if(this.queryAreaIds={},this.dataAreaIds={},this.resultAreaIds={},void 0!==i){assert(i instanceof Array,"argument not os");for(var o=0;o!==i.length;o++){var s=i[o];s instanceof ElementReference&&(e=s.element,e in this.queryAreaIds?this.queryAreaIds[e]++:this.queryAreaIds[e]=1)}}if(void 0!==r){assert(r instanceof Array,"argument not os");for(var o=0;o!==r.length;o++){var s=r[o];s instanceof ElementReference&&(e=s.element,e in this.dataAreaIds?this.dataAreaIds[e]++:(this.dataAreaIds[e]=1,e in this.queryAreaIds&&(this.resultAreaIds[e]=n.length,n.push(s))))}}return this.needsFullUpdate=!1,this.needsSort=!1,this.incrementalResult=n,!valueEqual(t,n)&&(this.result.value=n.slice(0),!0)},t.prototype.sort=function(e){for(var t={},i=this.arguments[1].value,r=0;r!==i.length;r++){var n=i[r];if(n instanceof ElementReference){var o=n.element;o in t||(t[o]=r)}}e.sort(function(e,i){return t[e.element]-t[i.element]})},t.prototype.debugName=function(){return"compareAreasQuery"},t}(EvaluationFunctionApplication);compareAreasQuery.classConstructor=EvaluationCompareAreasQuery;var EvaluationDisplayOffset=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.surveyorResult=void 0,r.displayString=void 0,r.me=i.getEvaluationArea().getAreaId(),r.result.value=constEmptyOS,r}return __extends(t,e),t.prototype.destroy=function(){this.releaseSurveyor(),e.prototype.destroy.call(this)},t.prototype.updateInput=function(e,t){void 0===t?(this.inputs[e].removeWatcher(this,!1,!1),this.inputs[e]=void 0,this.arguments=void 0):(this.arguments[e]=t,this.updateSurveyor())},t.prototype.updateSurveyor=function(){!this.isActive()||void 0===this.inputs[0]||this.inputs[0].isScheduled()||1!==this.inputs.length&&(void 0===this.inputs[1]||this.inputs[1].isScheduled())||this.updateOffsets()},t.prototype.activateInputs=function(){e.prototype.activateInputs.call(this),this.updateSurveyor()},t.prototype.deactivateInputs=function(){this.releaseSurveyor(),e.prototype.deactivateInputs.call(this)},t.prototype.eval=function(){assert(this.arguments[0]instanceof Result,"display node must be defined by now");var e=void 0;return this.result&&this.result.value instanceof Array&&(e=this.result.value[0]),e!==this.surveyorResult&&(this.result=new Result(void 0===this.surveyorResult?void 0:[this.surveyorResult]),!0)},t.prototype.updateOffsets=function(){var e=this.arguments[0],i=this.arguments[1],r=void 0===i?{}:stripArray(i.value,!0),n=shallowCopyMinusTree(deOsedMerge(r.display,e.value),t.suppressedAttributes),o=Number(r.width),s=Number(r.height);if(isNaN(o)&&(o=void 0),isNaN(r.height)&&(s=void 0),void 0!==o||void 0!==s){var a="";void 0!==o&&(a+="w"+o),void 0!==s&&(a+="h"+s),n[".tag"]=[a]}if(this.displayString=cdlifyNormalized(n),t.cache.has(this.displayString)){var d=t.cache.get(this.displayString);return this.displayString=d.key,void this.surveyNotification(!0,d.size)}var u=DisplayOffsetSurveyor.getSurveyor(this.displayString,n,r);this.surveyor!==u&&(this.releaseSurveyor(),this.surveyor=u,this.surveyor.register(this))},t.prototype.surveyNotification=function(e,i){var r="displayWidth"===this.bif.name?i[0]:i[1];r!==this.surveyorResult&&(this.surveyorResult=r,this.markAsChanged()),e&&(this.releaseSurveyor(),t.cache.has(this.displayString)||t.cache.set(this.displayString,{key:this.displayString,size:i}))},t.prototype.releaseSurveyor=function(){void 0!==this.surveyor&&(DisplayOffsetSurveyor.releaseSurveyor(this.surveyor,this),this.surveyor=void 0)},t}(EvaluationFunctionApplication);EvaluationDisplayOffset.cache=new Map,EvaluationDisplayOffset.suppressedAttributes={text:{textAlign:!0,verticalAlign:!0,color:!0,textFillColor:!0,textStrokeColor:!0},html:{textAlign:!0,verticalAlign:!0,color:!0,textFillColor:!0,textStrokeColor:!0,handleClick:!0},background:!0,borderRadius:!0,borderTopLeftRadius:!0,borderTopRightRadius:!0,borderBottomLeftRadius:!0,borderBottomRightRadius:!0,borderStyle:!0,borderColor:!0,borderLeftStyle:!0,borderLeftColor:!0,borderRightStyle:!0,borderRightColor:!0,borderTopStyle:!0,borderTopColor:!0,borderBottomStyle:!0,borderBottomColor:!0,opacity:!0,transitions:!0,hoverText:!0,pointerOpaque:!0,windowTitle:!0};var EvaluationDisplayWidth=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(EvaluationDisplayOffset);displayWidth.classConstructor=EvaluationDisplayWidth;var EvaluationDisplayHeight=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(EvaluationDisplayOffset);displayHeight.classConstructor=EvaluationDisplayHeight;var DisplayOffsetSurveyor=function(){function e(e,t){this.clients=new Map,this.displayString=void 0,this.italicizedText=!1,this.fontSize=16,this.containsImage=!1,this.size=void 0,this.survObj=new SurveyDisplay(e,this),this.displayString=t}return e.prototype.destroy=function(){this.survObj.destroy(),this.survObj=void 0},e.prototype.update=function(e,t){var i=Number(t.width),r=Number(t.height);if(isNaN(i)&&(i=void 0),isNaN(t.height)&&(r=void 0),void 0!==e.text&&void 0!==e.text.fontStyle){var n=e.text.fontSize;if(this.italicizedText="italic"===e.text.fontStyle||"oblique"===e.text.fontStyle,"number"==typeof n)this.fontSize=n;else if("string"==typeof n)try{this.fontSize=Number.parseInt(n)}catch(e){}}else void 0!==e.image&&void 0!==e.image.src&&(this.containsImage=!0);this.survObj.update(e,i,r)},e.prototype.register=function(t){assert(!this.clients.has(t.watcherId),"DisplayOffsetSurveyor: client should register only once"),this.clients.set(t.watcherId,t),void 0!==this.size&&t.surveyNotification(e.resourcesLoaded,this.size)},e.prototype.unregister=function(e){assert(this.clients.has(e.watcherId),"DisplayOffsetSurveyor: can only unregister registered clients"),this.clients.delete(e.watcherId)},e.prototype.surveyNotification=function(){var t=this;void 0!==this.survObj&&(this.size=this.survObj.getSize(),this.italicizedText&&(this.size[0]+=Math.floor(1.25*this.fontSize)),this.clients.forEach(function(i){i.surveyNotification(e.resourcesLoaded,t.size)}))},e.prototype.imageSizeNotification=function(e,t){var i=this;void 0!==this.survObj&&(this.size=[e,t],this.clients.forEach(function(e){e.surveyNotification(!0,i.size)}))},e.getSurveyor=function(t,i,r){var n;if(e.surveyorByDisplay.has(t))n=e.surveyorByDisplay.get(t);else{var o="displayOffset"+e.surveyorDivId++;n=new e(o,t),e.surveyorByDisplay.set(t,n),n.update(i,r)}return n},e.releaseSurveyor=function(t,i){t.unregister(i),0===t.clients.size&&(e.surveyorByDisplay.delete(t.displayString),t.destroy())},e.pollAllSurveyor=function(t){var i=0;e.resourcesLoaded=t,e.surveyorByDisplay.forEach(function(e){e.containsImage?i++:e.surveyNotification()}),t&&assert(e.surveyorByDisplay.size===i,"not all text surveyors have been released")},e}();DisplayOffsetSurveyor.surveyorByDisplay=new Map,DisplayOffsetSurveyor.resourcesLoaded=!1,DisplayOffsetSurveyor.surveyorDivId=0;var EvaluationCond=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.altList=[],r.condVarBoolMatch=!0,r.useChanged=!1,r.selectedPos=void 0,r.updatePos=0,r.result.value=constEmptyOS,r.dataSourceResultMode=!0,"schedulingError"in t&&(r.inputs=[]),r}return __extends(t,e),t.prototype.destroy=function(){void 0!==this.boolVarAppl&&this.setCondVarDataSource(void 0),e.prototype.destroy.call(this)},t.prototype.addAltOn=function(e){var t=this.altList.length;e.isConstant()?e.result.value instanceof Array&&1===e.result.value.length&&(e.result.value[0]===!0||e.result.value[0]===!1)||(this.condVarBoolMatch=!1):(e.addWatcher(this,t+1,!1,!0,!1),"schedulingError"in this.prototype&&this.inputs.push(e),this.condVarBoolMatch=!1),this.altList[t]={on:e,use:void 0},this.selectedPos=t+1},t.prototype.setConditionVar=function(e){this.condVar=e,e.isConstant()||(this.condVar.addWatcher(this,0,!1,!0,this.condVarBoolMatch),"schedulingError"in this.prototype&&this.inputs.push(e))},t.prototype.instantiateUse=function(e){var t=getEvaluationNode(this.prototype.altList[e].use,this.local);return t.addWatcher(this,-e-1,!1,!1,!0),this.altList[e].use=t,t},t.prototype.removeAsWatcher=function(){this.nrActiveWatchers>0&&this.deactivateInputs(),this.condVar.removeWatcher(this,!1,this.condVarBoolMatch);for(var e=0;e!==this.altList.length;e++)this.altList[e].on.removeWatcher(this,!1,!1),void 0!==this.altList[e].use&&this.altList[e].use.removeWatcher(this,!1,!0);this.condVar=void 0,this.altList=void 0,this.inputs=void 0},t.prototype.updateInput=function(e,t){if(void 0===t)return this.selectedPos=void 0,void(this.updatePos=void 0);if(void 0===this.selectedPos)return void(this.updatePos=void 0);if(0===e)this.condVarBoolMatch&&this.setCondVarDataSource(t.dataSource),this.updatePos=0,this.markAsChanged();else if(e>0){var i=e-1;i<=this.selectedPos&&(void 0===this.updatePos||this.updatePos>i)&&(this.updatePos=i,this.markAsChanged())}else-e-1===this.selectedPos&&(this.useChanged=!0,this.markAsChanged())},t.prototype.isDeferableInput=function(e,t){return 0===e||e>0&&e-1<=this.selectedPos||e<0&&-e-1===this.selectedPos},t.prototype.setCondVarDataSource=function(e){void 0!==this.boolVarAppl&&this.boolVarAppl.input!==e&&(this.nrActiveWatchers>0&&this.boolVarAppl.deactivate(),this.boolVarAppl.removeResultReceiver(this),this.boolVarAppl=void 0),void 0!==e&&(this.boolVarAppl=e.applyAggregateFunction("bool",this),this.nrActiveWatchers>0&&this.boolVarAppl.activate())},t.prototype.setDataSourceResultMode=function(e){if(this.selectedPos<this.altList.length){var t=this.altList[this.selectedPos].use;e&&!this.dataSourceResultMode?(t.activeWatcherBecomesDataSourceAware(this),this.isActive()&&this.markAsChanged()):!e&&this.dataSourceResultMode&&(t.activeWatcherNoLongerIsDataSourceAware(this),this.isActive()&&this.markAsChanged())}this.dataSourceResultMode=e},t.prototype.newDataSourceResult=function(e){this.updatePos=0,this.markAsChanged()},t.prototype.reextractData=function(e){},t.prototype.eval=function(){var e=this.result.value,t=this.result.getLabels(),i=void 0!==this.boolVarAppl?this.boolVarAppl.getResult():this.condVar.result.value,r=this.useChanged;if(this.useChanged=!1,void 0!==this.updatePos){var n=this.updatePos;for(this.updatePos=void 0;n<this.altList.length;){var o=getDeOSedValue(this.altList[n].on.result.value);if(null===o||interpretedBoolMatch(o,i))break;n++}if(n!==this.selectedPos){if(this.selectedPos<this.altList.length){var s=this.altList[this.selectedPos].use;s.deactivate(this,this.dataSourceResultMode),!s.isConstant()&&"schedulingError"in this.prototype&&this.inputs.pop()}if(this.selectedPos=n,
n<this.altList.length){var s=this.altList[n].use;if(void 0===s&&(s=this.instantiateUse(n)),!s.isConstant())return s.activate(this,this.dataSourceResultMode),s.forceUpdate(this,!0),void("schedulingError"in this.prototype&&this.inputs.push(s))}}else if(!r)return!1}return this.selectedPos<this.altList.length?this.result.copy(this.altList[this.selectedPos].use.result):this.result.set([]),void 0===e||!this.result.equalLabels(t)||!valueEqual(e,this.result.value)},t.prototype.activateInputs=function(){this.condVar.activate(this,this.condVarBoolMatch),this.updatePos=0,this.inputHasChanged=!0,void 0!==this.boolVarAppl&&this.boolVarAppl.activate();for(var e=0;e<this.altList.length;e++)this.altList[e].on.activate(this,!1)},t.prototype.deactivateInputs=function(){if(void 0!==this.boolVarAppl&&this.boolVarAppl.deactivate(),void 0!==this.condVar){this.condVar.deactivate(this,this.condVarBoolMatch);for(var e=0;e<this.altList.length;e++)this.altList[e].on.deactivate(this,!1);this.selectedPos<this.altList.length&&this.altList[this.selectedPos].use.deactivate(this,this.dataSourceResultMode),this.selectedPos=this.altList.length+1}},t.prototype.write=function(e,t,i,r){this.selectedPos<this.altList.length?this.altList[this.selectedPos].use.write(e,t,i,r):Utilities.warn("dead ended write: no active condition at "+gWriteAction)},t.prototype.debugName=function(){return"cond"},t.prototype.toFullString=function(){for(var e="[cond, "+this.condVar.toFullString()+", o(",t=0;t<this.altList.length;t++)0!==t&&(e+=", "),e+="{on: "+this.altList[t].on.toFullString()+", use: "+(void 0===this.altList[t].use?"undefined":this.altList[t].use.toFullString())+"}";return e+=")] = "+cdlifyLim(this.result.value,80)},t.prototype.specificExplanation=function(t,i,r){void 0===r&&(r=!1);var n;e.prototype.specificExplanation.call(this,t,i,!0),t["var: "+this.condVar.debugName()]=this.condVar.explain(void 0),t.alternatives=[];for(var o=0;o<this.selectedPos&&o<this.altList.length;o++)n={},n["on: "+this.altList[o].on.debugName()]=this.altList[o].on.explain(void 0),t.alternatives.push(n);return this.selectedPos<this.altList.length&&(n={},n["on: "+this.altList[o].on.debugName()]=this.altList[o].on.explain(void 0),n["use: "+this.altList[o].use.debugName()]=this.altList[o].use.explain(void 0),t.alternatives.push(n)),t},t.prototype.multiQuerySourceIds=function(){return this.selectedPos<this.altList.length?this.altList[this.selectedPos].use.multiQuerySourceIds():[]},t.prototype.removeWatcherFromInactiveNodes=function(){for(var e=0;e!==this.altList.length;e++)e===this.selectedPos||void 0===this.altList[e].use||this.altList[e].use.isConstant()||(this.altList[e].use.removeWatcherForPos(this,-e-1,!1,void 0),this.altList[e].use=void 0)},t}(EvaluationNode),EvaluationMerge=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.eval=function(){var e,t;if(0===this.arguments.length)t=void 0,e=constEmptyOS;else if(1===this.arguments.length){var i=this.arguments[0].value,r=this.arguments[0].identifiers;if(void 0===r)e=i.slice(0);else{var n=new Map;e=[],t=[];for(var o=0;o<i.length;o++){var s=r[o],a=i[o],d=n.get(s);void 0===d?(n.set(s,e.length),e.push(a),t.push(s)):e[d]=getDeOSedValue(mergeCopyAV(e[d],a,void 0))}}}else{if("identifiers"in this.arguments[0])return this.evalSet();e=this.arguments[0].value,t=this.arguments[0].identifiers;for(var u=1;u!==this.arguments.length;u++)e=mergeCopyValue(e,this.arguments[u].value,void 0),void 0===t&&(t=this.arguments[u].identifiers)}return(!objectEqual(this.result.value,e)||!objectEqual(this.result.identifiers,t))&&(this.result.set(e),void 0!==t&&(this.result.identifiers=t),!0)},t.prototype.evalSet=function(){for(var e=this.result.value,t=this.result.identifiers,i=this.arguments[0].value,r=this.arguments[0].identifiers,n=!1,o=1;o!==this.arguments.length;o++){var s=this.arguments[o].value;if(void 0!==r&&void 0!==this.arguments[o].identifiers){for(var a=this.arguments[o].identifiers,d={},u=0;u<a.length;u++)d[a[u]]=u;for(var h=new Array(i.length),u=0;u<i.length;u++){var l=r[u];l in d?h[u]=getDeOSedValue(mergeCopyAV(i[u],s[d[l]],void 0)):h[u]=i[u]}d={};for(var u=0;u<r.length;u++)d[r[u]]=u;i=h;for(var u=0;u<a.length;u++){var l=a[u];void 0===l||void 0===s[u]||l in d||(i.push(s[u]),n||(r=r.slice(0),n=!0),r.push(l))}}else{for(var c=Math.max(i.length,s.length),h=new Array(c),u=0;u<c;u++)h[u]=getDeOSedValue(mergeCopyAV(i[u],s[u],void 0));i=h}}return(!objectEqual(e,i)||!objectEqual(t,r))&&(this.result.set(i),this.result.identifiers=r,!0)},t}(EvaluationFunctionApplication);merge.classConstructor=EvaluationMerge;var EvaluationMergeWrite=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.eval=function(){var e=this.result.value,t=this.result.identifiers,i=void 0,r=void 0;if(this.arguments.length<1)r=void 0,i=constEmptyOS;else{if("identifiers"in this.arguments[0])return this.evalSet();this.arguments[0].value instanceof Array&&0===this.arguments[0].value.length||(i=this.arguments[0].value,r=this.arguments[0].identifiers);for(var n=1;n!==this.arguments.length;n++)i=mergeCopyValue(i,this.arguments[n].value,void 0),void 0===r&&(r=this.arguments[n].identifiers);void 0===i&&(i=constEmptyOS)}return(!objectEqual(e,i)||!objectEqual(t,r))&&(this.result.set(i),void 0!==r&&(this.result.identifiers=r),!0)},t.prototype.write=function(e,t,i,r){var n=this,o=this.inputs[0];void 0!==o&&(void 0!==r&&"identifiers"in this.result&&(r=r.map(function(e){return e.copyWithIdentity(n.result.identifiers[e.index])})),o.write(e,t,i,r))},t}(EvaluationMerge);mergeWrite.classConstructor=EvaluationMergeWrite;var EvaluationIsDisjoint=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.funcResultWatchers=[new FuncResultWatcher(globalInternalQCM,r,0),new FuncResultWatcher(globalInternalQCM,r,1)],r.dataElements=[new Set,new Set],r.nrCommonElements=0,r.dataSourceAware=!0,r}return __extends(t,e),t.prototype.destroy=function(){this.funcResultWatchers[0].destroy(),this.funcResultWatchers[1].destroy(),e.prototype.destroy.call(this)},t.prototype.updateInput=function(e,t){void 0!==t&&(assert(void 0!==t.dataSource,"not expecting JS data"),this.funcResultWatchers[e].setData(t.dataSource.funcResult))},t.prototype.refreshIndexerAndPaths=function(e,t){this.dataElements[e].clear(),this.nrCommonElements=0,this.markAsChanged()},t.prototype.replaceIndexerAndPaths=function(e,t,i,r){},t.prototype.removeAllElementIds=function(e){this.dataElements[e].clear(),this.nrCommonElements=0,this.markAsChanged()},t.prototype.addElementIds=function(e,t){for(var i=this.dataElements[t],r=this.dataElements[1-t],n=0;n<e.length;n++){var o=e[n];assert(!i.has(o),"error in assumption"),i.add(o),r.has(o)&&this.nrCommonElements++}this.markAsChanged()},t.prototype.removeElementIds=function(e,t){for(var i=this.dataElements[t],r=this.dataElements[1-t],n=0;n<e.length;n++){var o=e[n];assert(i.has(o),"error in assumption"),i.delete(o),r.has(o)&&this.nrCommonElements--}this.markAsChanged()},t.prototype.activateInputs=function(){this.funcResultWatchers[0].activate(),this.funcResultWatchers[1].activate()},t.prototype.deactivateInputs=function(){this.funcResultWatchers[0].deactivate(),this.funcResultWatchers[1].deactivate()},t.prototype.eval=function(){var e=0===this.nrCommonElements?constTrueOS:constEmptyOS;return this.result.value!==e&&(this.result.value=e,!0)},t.prototype.debugName=function(){return"isDisjoint"},t}(EvaluationFunctionApplication);isDisjoint.classConstructor=EvaluationIsDisjoint;var EvaluationVerificationFunction=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.eval=function(){return this.arguments[0].equal(this.arguments[1])||(console.log("verification error"),breakIntoDebugger()),this.result=this.arguments[0],!0},t.prototype.write=function(e,t,i,r){this.inputs[0].write(e,t,i,r)},t.prototype.debugName=function(){return"verificationFunction"},t.prototype.multiQuerySourceIds=function(){return this.inputs[0].multiQuerySourceIds()},t}(EvaluationFunctionApplication);verificationFunction.classConstructor=EvaluationVerificationFunction;var EvaluationMakeDefined=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.eval=function(){if(void 0===this.arguments[0].value){var e=this.result.value.length>0;return this.result.value=constEmptyOS,e}return this.result.value=this.arguments[0].value,!0},t.prototype.write=function(e,t,i,r){this.inputs[0].write(e,t,i,r)},t.prototype.debugName=function(){return"makeDefined"},t.prototype.multiQuerySourceIds=function(){return void 0!==this.arguments[0].value?this.inputs[0].multiQuerySourceIds():[]},t}(EvaluationFunctionApplication);makeDefined.classConstructor=EvaluationMakeDefined;var EFEvaluateFormula=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.parser=new StringParseFormula,t.parseResult=void 0,t}return __extends(t,e),t.prototype.updateInput=function(e,t){if(this.arguments[e]=t,void 0===t)this.inputs[e].removeWatcher(this,!1,!1),this.inputs[e]=void 0;else if(0===e){var i=getDeOSedValue(t.value);"string"!=typeof i?this.parseResult=void 0:this.parseResult=this.parser.parse(i),this.markAsChanged()}else 1===e&&void 0!==this.parseResult&&this.markAsChanged()},t.prototype.eval=function(){var e=this.result.identifiers,t=this.result.value,i=void 0,r=void 0;if(void 0===this.parseResult)i=constEmptyOS;else if(this.parseResult.success&&void 0!==this.arguments[1].value){var n=this.interpret();if(void 0===e)i=n.filter(function(e){return void 0!==e});else{i=[],r=[];for(var o=0;o<n.length;o++){var s=n[o];void 0!==s&&(i.push(s),r.push(e[o]))}}}else i=constEmptyOS;return this.result.value=i,!valueEqual(t,i)||!valueEqual(e,r)},t.prototype.evalSet=function(){var e=this.result.value,t=void 0;return t=void 0===this.parseResult?constEmptyOS:this.parseResult.success&&void 0!==this.arguments[1].value?this.interpret():constEmptyOS,this.result.value=t,this.result.copyLabels(this.arguments[1]),!valueEqual(e,t)},t.prototype.interpret=function(){return interpretParseTree(this.parseResult.tree,ensureOS(this.arguments[1].value),function(e,t){return e.map(function(e){var i="object"==typeof e?getDeOSedValue(e[t]):void 0;return"number"==typeof i?i:void 0})})},t}(EvaluationFunctionApplication);evaluateFormula.classConstructor=EFEvaluateFormula;var EFAddComputedAttribute=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.attribute=void 0,t.indexer=void 0,t.dataPathId=void 0,t.resultPathId=void 0,t.recomputeAll=!1,t.parser=new StringParseFormula,t.parseResult=void 0,t.indexerMonitors={},t.dataSourceAware=!0,t}return __extends(t,e),t.prototype.isPathNodeOwner=function(){return this.watcherId===t.pathNodeRefCount.get(this.resultPathId)[0]},t.prototype.thereIsNoPathNodeOwner=function(){return 0===t.pathNodeRefCount.get(this.resultPathId).length},t.prototype.addToPathNodeRefCount=function(){void 0!==this.resultPathId&&(t.pathNodeRefCount.has(this.resultPathId)||t.pathNodeRefCount.set(this.resultPathId,[]),t.pathNodeRefCount.get(this.resultPathId).push(this.watcherId))},t.prototype.removeFromPathNodeRefCount=function(){if(void 0!==this.resultPathId){var e=t.pathNodeRefCount.get(this.resultPathId),i=e.indexOf(this.watcherId);assert(i!==-1,"EFAddComputedAttribute already removed?"),e.splice(i,1)}},t.prototype.activateInputs=function(){this.addToPathNodeRefCount(),e.prototype.activateInputs.call(this)},t.prototype.deactivateInputs=function(){e.prototype.deactivateInputs.call(this),this.removeFromPathNodeRefCount()},t.prototype.destroy=function(){this.dataSourceInput=void 0,e.prototype.destroy.call(this),this.destroyResult(),this.destroyAllIndexerMonitors(!1),this.indexer=void 0},t.prototype.destroyAllIndexerMonitors=function(e){for(var t in this.indexerMonitors)this.indexerMonitors[t].destroy();this.indexerMonitors=e?{}:void 0},t.prototype.destroyResult=function(){void 0!==this.resultPathId&&(this.thereIsNoPathNodeOwner()&&this.removeResultsForIDs(this.getAllRootDataElementIds()),this.indexer.qcm.releasePathId(this.resultPathId),this.indexer.decPathNodeTracing(this.indexer.pathNodesById[this.resultPathId]),this.resultPathId=void 0)},t.prototype.removeResultsForIDs=function(e){for(var t=this.indexer.pathNodesById[this.resultPathId],i=0;i<e.length;i++)this.indexer.removeNode(t,e[i])},t.prototype.updateInput=function(e,t){if(this.arguments[e]=t,void 0===t)this.inputs[e].removeWatcher(this,!1,this.dataSourceAware),this.inputs[e]=void 0;else switch(e){case 0:this.changeAttribute(getDeOSedValue(t.value));break;case 1:this.changeFormula(getDeOSedValue(t.value));break;case 2:this.changeData(t)}},t.prototype.changeAttribute=function(e){"string"!=typeof e&&(e=void 0),e!==this.attribute&&(this.clearResult(),this.setAttribute(e))},t.prototype.clearResult=function(){void 0!==this.indexer&&(this.markAsChanged(),this.removeFromPathNodeRefCount(),this.destroyResult(),this.destroyAllIndexerMonitors(!0))},t.prototype.setAttribute=function(e){void 0!==e&&void 0!==this.indexer&&void 0!==this.dataPathId&&(this.resultPathId=this.indexer.qcm.allocatePathId(this.dataPathId,e),this.indexer.addPath(this.resultPathId),this.indexer.incPathNodeTracing(this.indexer.pathNodesById[this.resultPathId]),this.recomputeAll=!0,this.addToPathNodeRefCount(),this.markAsChanged()),this.attribute=e},t.prototype.changeFormula=function(e){"string"!=typeof e?this.parseResult=void 0:this.parseResult=this.parser.parse(e),this.recomputeAll=!0,this.destroyAllIndexerMonitors(!0),this.markAsChanged()},t.prototype.changeData=function(e){var t=e.dataSource,i=void 0!==t?t.funcResult.getDominatedIndexer():void 0,r=void 0!==t?t.funcResult.getDominatedProjPathId():void 0;i===this.indexer&&r===this.dataPathId&&void 0!==r||(void 0!==this.indexer&&(this.clearResult(),this.dataSourceInput=void 0),this.indexer=i,this.dataPathId=r,void 0!==i?(this.setAttribute(this.attribute),this.dataSourceInput=t,this.recomputeAll=!0,this.result.dataSource=this.dataSourceInput,this.result.value=emptyDataSourceResult):(Utilities.warn("applying dynamicAttribute to non indexer data"),delete this.result.dataSource,this.result.value=constEmptyOS))},t.prototype.setDataPathId=function(){this.dataPathId=void 0===this.dataSourceInput?void 0:this.dataSourceInput.funcResult.getDominatedProjPathId()},t.prototype.indexerUpdateKeys=function(e,t,i,r,n){this.parseResult.success&&this.recomputeForIds(e)},t.prototype.removeAllIndexerMatches=function(){},t.prototype.eval=function(){return this.recomputeAll&&this.parseResult.success&&(void 0===this.dataPathId&&this.setDataPathId(),void 0===this.resultPathId&&this.setAttribute(this.attribute),void 0!==this.resultPathId&&(this.recomputeForIds(this.getAllRootDataElementIds()),this.recomputeAll=!1)),this.result.dataSource!==this.dataSourceInput&&(void 0===this.dataSourceInput?(delete this.result.dataSource,this.result.value=constEmptyOS):(this.result.dataSource=this.dataSourceInput,this.result.value=emptyDataSourceResult),!0)},t.prototype.getAllRootDataElementIds=function(){var e=[];if(void 0!==this.indexer&&void 0!==this.dataPathId){var t=this.indexer.pathNodesById[this.dataPathId];t.nodes.forEach(function(t,i){e.push(i)})}return e},t.prototype.recomputeForIds=function(e){var t=this;if(this.isPathNodeOwner()){var i=interpretParseTree(this.parseResult.tree,e,function(i,r){var n=t.indexer.qcm.allocatePathId(t.dataPathId,r);n in t.indexerMonitors||(t.indexerMonitors[n]=new IndexerTracerMatchUpdates(t.indexer,n,t)),t.indexer.qcm.releasePathId(n);var o=t.indexer.pathNodesById[n];if(void 0===o)return[];var s=o.nodes;return e.map(function(e){var t=s.get(e);return void 0!==t&&"number"===t.type?t.key:void 0})}),r=this.indexer,n=r.pathNodesById[this.resultPathId],o=0==n.nodes.size;Utilities.isEmptyObj(this.indexerMonitors)&&(this.indexerMonitors[this.dataPathId]=new IndexerTracerMatchUpdates(this.indexer,this.dataPathId,this));for(var s=0;s<i.length;s++){var a=i[s];if(void 0!==a){var d=e[s];n.nodes.has(d)||r.addNonDataElementNode(n,d),r.setKeyValue(n,d,"number",a)}else if(!o){var d=e[s];r.removeNode(n,d)}}}},t.prototype.addMatches=function(e,t){this.recomputeForIds(e)},t.prototype.removeMatches=function(e,t){this.isPathNodeOwner()&&this.removeResultsForIDs(e)},t}(EvaluationFunctionApplication);EFAddComputedAttribute.pathNodeRefCount=new Map,addComputedAttribute.classConstructor=EFAddComputedAttribute;var EvaluationIndex=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.constant=!0,t.inputs=new Array(2),t.arguments=new Array(2),t.dataSourceAware=!0,t.dataSourceResultMode=!0,t.collectionHasChanged=!1,t.indexValueHasChanged=!1,t}return __extends(t,e),t.prototype.destroy=function(){this.unsetDataSourceFunctionApplication(),this.releaseDataSource(),e.prototype.destroy.call(this)},t.prototype.addArgument=function(e,t){this.inputs[e]=t,this.arguments[e]=t.result,t.isConstant()?this.updateInput(e,t.result):(this.constant=!1,t.addWatcher(this,e,!0,!0,0===e))},t.prototype.releaseDataSource=function(){this.releaseIndexQuery(),void 0!==this.inputMultiplexer&&(this.inputMultiplexer.removeResultReceiver(this),this.inputMultiplexer=void 0),this.dataSourceInput=void 0},t.prototype.releaseIndexQuery=function(){void 0!==this.dataSourceFunctionApplication&&this.unsetDataSourceFunctionApplication(),void 0!==this.indexResult&&(this.indexResult.removeResultReceiver(this),this.indexResult=void 0),void 0!==this.indexQuery&&(this.indexQuery.removeResultReceiver(this),this.indexQuery=void 0)},t.prototype.updateInput=function(e,t){void 0!==t&&(this.arguments[e]=t,0===e?this.collectionHasChanged=!0:1===e&&(this.indexValueHasChanged=!0),this.markAsChanged())},t.prototype.setDataSourceResultMode=function(e){this.isActive()&&void 0!==this.dataSourceInput?e&&!this.dataSourceResultMode?(assert(void 0!==this.dataSourceFunctionApplication,"debugging"),this.unsetDataSourceFunctionApplication(),this.dataSourceResultMode=!0,this.markAsChanged()):!e&&this.dataSourceResultMode&&(assert(void 0===this.dataSourceFunctionApplication,"debugging"),this.dataSourceResultMode=!1,this.isActive()&&void 0!==this.dataSourceInput&&this.setDataSourceFunctionApplication(),this.markAsChanged()):this.dataSourceResultMode=e},t.prototype.unsetDataSourceFunctionApplication=function(){void 0!==this.dataSourceFunctionApplication&&(this.isActive()&&(this.indexResult.stopIndexerMonitoring(),this.dataSourceFunctionApplication.deactivate()),this.dataSourceFunctionApplication.removeResultReceiver(this),this.dataSourceFunctionApplication=void 0)},t.prototype.setDataSourceFunctionApplication=function(){this.dataSourceFunctionApplication=this.indexResult.applyAggregateFunction("changeinform",this),this.isActive()&&(this.dataSourceFunctionApplication.activate(),this.indexResult.updateIndexerMonitoringForDominatedPath())},t.prototype.activateInputs=function(){e.prototype.activateInputs.call(this),void 0!==this.dataSourceFunctionApplication&&(this.dataSourceFunctionApplication.activate(),this.indexResult.updateIndexerMonitoringForDominatedPath())},t.prototype.deactivateInputs=function(){e.prototype.deactivateInputs.call(this),void 0!==this.dataSourceFunctionApplication&&(this.dataSourceFunctionApplication.deactivate(),this.indexResult.stopIndexerMonitoring())},t.prototype.setIndexCollection=function(e){"dataSource"in e?this.setIndexCollectionDataSource(e.dataSource):this.setIndexCollectionDataSource(void 0)},t.prototype.setIndexCollectionDataSource=function(e){this.dataSourceInput!==e&&(this.releaseDataSource(),this.dataSourceInput=e,void 0!==e&&(this.inputMultiplexer=e.getDataSourceMultiplexer(this),void 0!==this.inputs[1]&&void 0!==this.inputs[1].result&&this.setIndexQuery(this.inputs[1].result)))},t.prototype.setIndexQuery=function(e){return assert(void 0!==this.inputMultiplexer,"needs inputMultiplexer"),void 0!==this.indexQuery?void this.indexQuery.updateQuery(this.arguments[1].value):(this.indexQuery=this.dataSourceInput.applyDataQuery(this.arguments[1].value,this,this.inputs[1].querySourceId()),this.indexResult=this.inputMultiplexer.applyIndexQuery(this.indexQuery,this),this.dataSourceResultMode||this.setDataSourceFunctionApplication(),void this.markAsChanged())},t.prototype.extractDataSourceResult=function(){var e=this.result.value,t=this.indexResult.extractData(MinimumResultRequirements.simple,void 0),i="dataSource"in this.result;return this.result.value=t,i&&delete this.result.dataSource,i||!valueEqual(e,t)},t.prototype.eval=function(){var e=!1;if(this.collectionHasChanged&&(this.setIndexCollection(this.inputs[0].result),this.collectionHasChanged=!1),this.indexValueHasChanged&&void 0!==this.dataSourceInput&&(this.setIndexQuery(this.inputs[1].result),this.indexValueHasChanged=!1),void 0!==this.dataSourceInput)return this.dataSourceResultMode?this.result.dataSource!==this.indexResult&&(this.result.dataSource=this.indexResult,this.result.value=emptyDataSourceResult,!0):(globalInternalQCM.executeScheduled(),this.extractDataSourceResult());this.releaseDataSource(),"dataSource"in this.result&&(delete this.result.dataSource,e=!0);var t=this.arguments[0].value,i=this.arguments[1].value,r=[];if(void 0!==t&&void 0!==i)for(var n=0;n<i.length;n++)for(var o=0;o<t.length;o++)objectEqual(t[o],i[n])&&r.push(o);return valueEqual(r,this.result.value)?e:(this.result.value=r,!0)},t.prototype.newDataSourceResult=function(e){this.markAsChanged()},t.prototype.reextractData=function(e){this.markAsChanged()},t}(EvaluationNode);index.classConstructor=EvaluationIndex;var EvaluationRedirect=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.eval=function(){return!1},t.prototype.write=function(e,t,i,r){var n=new PositionChangeTracker,o=determineWrite([],e,t,i,r,n);1===o.length&&"string"==typeof o[0]&&(window.location.href=o[0])},t}(EvaluationFunctionApplication);redirect.classConstructor=EvaluationRedirect;var openWindowReferencesPerTarget={},EvaluationSystemInfo=function(e){function t(t,i){var r=e.call(this,t,i)||this;r.powerDisconnected=void 0,r.connectionStatus="unconnected";var n=r;return globalSystemEvents.addHandler("power disconnected",function(e,t){n.powerDisconnected=t,n.markAsChanged()}),globalSystemEvents.addHandler("connection opened",function(){n.connectionStatus="connected",n.markAsChanged()}),globalSystemEvents.addHandler("connection error",function(){n.connectionStatus="error",n.markAsChanged()}),globalSystemEvents.addHandler("connection error cleared",function(){n.connectionStatus="connected",n.markAsChanged()}),globalSystemEvents.addHandler("connection closed",function(){n.connectionStatus="unconnected",n.markAsChanged()}),r.constant=!1,r}return __extends(t,e),t.prototype.eval=function(){var e={url:[window.location.href],language:[navigator.language],languages:ensureOS(navigator.languages),maxTouchPoints:[navigator.maxTouchPoints],connectionStatus:[this.connectionStatus]};return void 0!==this.powerDisconnected&&(e.powerDisconnected=[this.powerDisconnected]),!objectEqual(e,this.result.value[0])&&(this.result.value=[e],!0)},t.prototype.write=function(e,i,r,n){var o=new PositionChangeTracker,s=determineWrite([],e,i,r,n,o);if(1===s.length&&t.writeObjType.matches(s)){var a=singleton(s[0].url),d=s[0].arguments;if(isTrue(s[0].useSameAppState)&&void 0!==gAppStateMgr.appStateHandle&&(d=void 0===d?[]:ensureOS(d),d.push({remote:!0,appStateServer:singleton(gAppStateMgr.appStateInfo.serverAddress),appStatePort:singleton(gAppStateMgr.appStateInfo.serverPort),appStatePath:singleton(gAppStateMgr.appStateInfo.serverPath),protocol:singleton(gAppStateMgr.appStateInfo.protocol),appName:singleton(gAppStateMgr.appStateInfo.appName)})),"string"==typeof a&&d instanceof Array)for(var u=a.indexOf("?")>=0,h=0;h<d.length;h++){var l=d[h];if(l instanceof Object)for(var c in l){var p=l[c];void 0===p||p instanceof Array&&0===p.length||(a+=(u?"&":"?")+encodeURIComponent(c)+"="+encodeURIComponent(singleton(p))),u=!0}}if(isFalse(s[0].newWindow))window.location.href=singleton(a);else{var f=singleton(s[0].target);"string"==typeof f?!openWindowReferencesPerTarget[f]||openWindowReferencesPerTarget[f].closed?openWindowReferencesPerTarget[f]=window.open(singleton(a)):openWindowReferencesPerTarget[f].focus():window.open(singleton(a))}}},t}(EvaluationFunctionApplication);EvaluationSystemInfo.writeObjType=vtd("av",{url:vtd("string"),newWindow:[vtd("boolean"),vtd("undefined")],target:[vtd("string"),vtd("undefined")],arguments:[vtd("av",{_:[vtd("string"),vtd("number"),vtd("boolean")]}),vtd("undefined")],useSameAppState:[vtd("boolean"),vtd("undefined")]}),systemInfo.classConstructor=EvaluationSystemInfo;var EvaluationDownload=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.eval=function(){return!1},t.prototype.write=function(e,t,i,r){function n(e){return e.map(function(e){return JSON.stringify(e)}).join("\n")}function o(e){return"string"!=typeof e?String(e):/[\\",]/.test(e)?'"'+e.replace(/[\\",]/g,"\\$&")+'"':e}function s(){for(var e=0;e<l.length;e++){var t=l[e];if(t instanceof Object&&null!==t){var i=singleton(t.attribute);if("number"!=typeof i&&"boolean"!=typeof i||(i=String(i)),"string"==typeof i){var r=singleton(t.header),n="string"==typeof r?r:i;v[i]=f,g.push(n),f++}}}}function a(e){var t=[];s();for(var i=0;i<e.length;i++){var r=e[i],n=[];if("object"==typeof r&&null!==r){for(var a in r){var d=r[a];if(isSimpleValue(d)){var u;a in v?u=v[a]:(u=f++,v[a]=u,g[u]=a),n[u]=o(getDeOSedValue(d))}}t.push(n.join(","))}}return g.join(",")+"\n"+t.join("\n")}function d(e){return"json"===p?n(e):a(e)}var u=singleton(this.arguments[0].value),h=singleton(this.arguments[1].value),l=void 0!==this.arguments[2]?ensureOS(this.arguments[2].value):constEmptyOS,c="string"==typeof u?u:runtimeEnvironment.appName,p="string"==typeof h?h:"csv",f=0,v={},g=[],m=ensureOS(e.value);if(0!==m.length){var y=m.filter(function(e){return e instanceof ElementReference});if(y.length>0&&"png"===p){var I=allAreaMonitor.getAreaById(y[0].element);if(!(I instanceof DisplayArea))return;domtoimage.toBlob(I.display.frameDiv).then(function(e){saveAs(e,c+"."+p)}).catch(function(e){console.error("Error while copying image:",e)})}else 0===y.length&&saveAs(new Blob([d(m)]),c+"."+p)}},t}(EvaluationFunctionApplication);download.classConstructor=EvaluationDownload;var PrintAreaTask=function(){function e(e){this.area=e}return e.prototype.getEmbeddingRect=function(){if(void 0===this.area||this.area.hasBeenDestroyed()||!(this.area.embedding instanceof DisplayArea))return{left:Number.MAX_SAFE_INTEGER,top:Number.MAX_SAFE_INTEGER,width:0,height:0};if(void 0===this.area.embedding)return{left:0,top:0,width:this.area.relative.width,height:this.area.relative.height};var e=this.area.embedding.getAbsolutePosition();return{left:e.left,top:e.top,width:this.area.embedding.relative.width,height:this.area.embedding.relative.height}},e.prototype.getRelative=function(){return void 0===this.area||this.area.hasBeenDestroyed()?void 0:this.area.relative},e.prototype.getHTMLRepr=function(){return void 0===this.area||this.area.hasBeenDestroyed()?void 0:this.area.display.frameDiv.outerHTML},e}(),EvaluationPrintArea=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.eval=function(){return!1},t.prototype.write=function(e,t,i,r){function n(e){return Object.keys(e).map(function(t){return t+"="+String(e[t])}).join(",")}var o=new PositionChangeTracker,s=determineWrite([],e,t,i,r,o);if(1===s.length&&s[0]===!0){var a={type:["Print"],subType:["start"],time:[Date.now()]};return queueEvent(new ImpersonatedDomEvent("print"),a,void 0,constEmptyOS,void 0,constEmptyOS,constEmptyOS,void 0,void 0,void 0),void globalPrintTask.addPrintTask(void 0)}var d={toolbar:"no",location:"no",directories:"no",status:"no",menubar:"no",scrollbars:"no",resizable:"no"},u=window.open("",document.title,n(d));globalPrintTask.setWindow(u);for(var h=0;h<s.length;h++){var l=s[h];if(l instanceof ElementReference){var c=allAreaMonitor.getAreaById(l.getElement());c instanceof DisplayArea&&globalPrintTask.addPrintTask(new PrintAreaTask(c))}}},t}(EvaluationFunctionApplication);printArea.classConstructor=EvaluationPrintArea;var EvaluationForeignInterfaceFunction=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.constant=!0,r.result.value=foreignInterfaceObjects,r}return __extends(t,e),t.prototype.eval=function(){return!1},t.prototype.write=function(e,t,i,r){console.log("TODO")},t}(EvaluationFunctionApplication);foreignFunctions.classConstructor=EvaluationForeignInterfaceFunction;var EvaluationRemoteStatus=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.eval=function(){var e=void 0;return e=void 0!==this.arguments[0]&&"string"==typeof this.arguments[0].remoteStatus?[{state:[this.arguments[0].remoteStatus]}]:constEmptyOS,!valueEqual(this.result.value,e)&&(this.result.value=e,!0)},t}(EvaluationFunctionApplication);remoteStatus.classConstructor=EvaluationRemoteStatus;var EvaluationLoginInfo=function(e){function t(t,i){var r=e.call(this,t,i)||this,n=r;return globalSystemEvents.addHandler("login",function(){n.markAsChanged()}),globalSystemEvents.addHandler("logout",function(){n.markAsChanged()}),r.constant=!1,r}return __extends(t,e),t.prototype.eval=function(){var e={username:gAppStateMgr.appStateInfo.owner};return!objectEqual(e,this.result.value[0])&&(this.result.value=[e],!0)},t.prototype.write=function(e,i,r,n){var o=new PositionChangeTracker,s=determineWrite([],e,i,r,n,o),a=void 0!==this.arguments[0]&&interpretedBoolMatch({createAccount:_},this.arguments[0].value);if(!a&&1===s.length&&t.loginWriteObjType.matches(s)){var d=singleton(s[0].username),u=singleton(s[0].password);gAppStateMgr.login(d,u)}else if(a&&1===s.length&&t.createAccountWriteObjType.matches(s)){var d=singleton(s[0].username),u=singleton(s[0].password),h=singleton(s[0].email);gAppStateMgr.createAccount(d,u,h)}else isFalse(e.value)&&gAppStateMgr.logout()},t}(EvaluationFunctionApplication);EvaluationLoginInfo.loginWriteObjType=vtd("av",{username:vtd("string"),password:[vtd("string")]}),EvaluationLoginInfo.createAccountWriteObjType=vtd("av",{username:vtd("string"),password:[vtd("string")],email:[vtd("string"),vtd("undefined")]}),loginInfo.classConstructor=EvaluationLoginInfo;var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),EvaluationAppStateConnectionInfo=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.result.value=[gAppStateMgr.getAppStateInfo()],r.appStateRegId=gAppStateMgr.appStateInfoRegister(r,"appState"),r}return __extends(t,e),t.prototype.destroy=function(){"undefined"!=typeof this.appStateRegId&&(gAppStateMgr.appStateInfoUnregister(this.appStateRegId),this.appStateRegId=void 0),e.prototype.destroy.call(this)},t.prototype.isConstant=function(){return!1},t.prototype.eval=function(){return!1},t.prototype.debugName=function(){return"tempAppStateConnectionInfo"},t.prototype.appStateInfoUpdate=function(e,t){this.result.value=[shallowCopy(t)],this.informAllWatchers()},t}(EvaluationFunctionApplication);tempAppStateConnectionInfo.classConstructor=EvaluationAppStateConnectionInfo;var PositionChange=function(){function e(e,t,i,r){void 0===r&&(r=void 0),this.index=e,this.origLength=t,this.newLength=i,this.sub=r,this.origin=[gWriteAction],this.values=[]}return e.prototype.clone=function(){var t=new e(this.index,this.origLength,this.newLength);if(void 0!==this.sub){t.sub={};for(var i in this.sub)t.sub[i]=this.sub[i].clone()}return t.origin=this.origin.slice(0),t.values=this.values.slice(0),t},e.prototype.markProjection=function(e){return assert(this.origLength<=1&&1===this.newLength,"cannot write to multiple positions"),
this.origLength=1,void 0===this.sub&&(this.sub={}),e in this.sub||(this.sub[e]=new PositionChangeTracker),this.sub[e]},e.prototype.allCompatible=function(e,t){switch(t){case WriteMode.replace:return this.values.every(function(t){return objectEqual(t,e)});case WriteMode.merge:return this.values.every(function(t){return objectCompatible(t,e)})}return!1},e}(),PositionChangeTracker=function(){function e(){this.changes=[]}return e.prototype.clone=function(){var t=new e;return t.changes=this.changes.map(function(e){return e.clone()}),t},e.prototype.markShift=function(e,t,i,r,n){var o=binarySearch(this.changes,e,function(e,t){return e.index-t});if(o<0){var s=-(o+2),a=-(o+1);if(s>=0&&this.changes[s].index+this.changes[s].origLength>e)return void console.log("cannot change: overwriting another write (1):",this.changes[s].origin.join(","));if(a<this.changes.length&&e+i.length>this.changes[a].index)return void console.log("cannot change: overwriting another write (2)",this.changes[a].origin.join(","));var d=new PositionChange(e,t,i.length);return d.values.push(i),this.changes.splice(a,0,d),d}var d=this.changes[o];if(r){if(t!==d.origLength||i.length!==d.newLength)return void console.log("different lengths:",d.origin.join(","));d.origin.push(gWriteAction)}else{if(!d.allCompatible(i,n))return void console.log("multiple writes:",d.origin.join(","));d.values.push(i)}return d},e.prototype.getIndex=function(e){for(var t=0,i=0;i<this.changes.length&&this.changes[i].index<e;i++)t+=this.changes[i].newLength-this.changes[i].origLength;return e+t},e.prototype.clear=function(){this.changes=[]},e.prototype.isClean=function(){return 0===this.changes.length},e}(),EvaluationStore=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.lastUpdate=new Result(void 0),r.latchedValue=void 0,r.isLatched=!1,r.source=void 0,r.position=void 0,r.positionChangeTracker=new PositionChangeTracker,r.inputHasChanged=!1,r.result.value=constEmptyOS,r.dataSourceAware=!0,r.dataSourceResultMode=!0,"schedulingError"in t&&(r.inputs=[]),r}return __extends(t,e),t.prototype.destroy=function(){void 0!==this.dataSourceFunctionApplication&&(this.dataSourceFunctionApplication.removeResultReceiver(this),this.dataSourceFunctionApplication=void 0),e.prototype.destroy.call(this)},t.prototype.set=function(e){return void 0===e?(void 0!==this.dataSourceFunctionApplication&&(this.dataSourceFunctionApplication.removeResultReceiver(this),this.dataSourceFunctionApplication=void 0),void 0!==this.dataSourceInput&&(this.dataSourceInput=void 0,this.dataSourceChanged=!0,this.markAsChanged()),void 0!==this.lastUpdate.value?(this.lastUpdate.set(void 0),this.markAsChanged(),!0):this.dataSourceChanged):!this.lastUpdate.equal(e)&&(this.lastUpdate.copy(e),e.dataSource!==this.result.dataSource&&(void 0!==this.dataSourceFunctionApplication&&(this.dataSourceFunctionApplication.removeResultReceiver(this),this.dataSourceFunctionApplication=void 0),"dataSource"in e&&(this.dataSourceFunctionApplication=e.dataSource.applyAggregateFunction("changecount",this),this.isActive()&&!this.dataSourceResultMode&&this.dataSourceFunctionApplication.activate()),this.dataSourceInput=e.dataSource,this.dataSourceChanged=!0),this.markAsChanged(),!0)},t.prototype.pushToAreaSetContent=function(e){void 0!==e&&(this.lastUpdate.value[0].areaSetContent=this.lastUpdate.value[0].areaSetContent.concat(e),this.markAsChanged())},t.prototype.setDataSourceResultMode=function(e){this.isActive()&&void 0!==this.dataSourceInput&&(e&&!this.dataSourceResultMode?(this.dataSourceFunctionApplication.deactivate(),void 0!==this.result&&(this.result.value=emptyDataSourceResult),this.dataSourceInput.stopIndexerMonitoring()):!e&&this.dataSourceResultMode&&(this.dataSourceFunctionApplication.activate(),this.markAsChanged())),this.dataSourceResultMode=e},t.prototype.setSource=function(e,t){this.source=e,this.position=t},t.prototype.updateInput=function(e,t){this.set(this.extractResult(t))},t.prototype.activateInputs=function(){void 0===this.dataSourceFunctionApplication||this.dataSourceResultMode||this.dataSourceFunctionApplication.activate()},t.prototype.deactivateInputs=function(){void 0===this.dataSourceFunctionApplication||this.dataSourceResultMode||this.dataSourceFunctionApplication.deactivate(),void 0!==this.dataSourceInput&&this.dataSourceInput.stopIndexerMonitoring()},t.prototype.newDataSourceResult=function(e){this.dataSourceChanged=!0,this.dataSourceResultMode||this.markAsChanged()},t.prototype.reextractData=function(){assert(!this.dataSourceResultMode,"should have been disabled"),this.markAsChanged()},t.prototype.extractDataSourceResult=function(){var e=this.result.value,t=this.dataSourceInput.extractData(MinimumResultRequirements.compound,void 0),i="dataSource"in this.result;return this.result.value=t,i&&delete this.result.dataSource,i||!valueEqual(e,t)},t.prototype.isConstant=function(){return!1},t.prototype.eval=function(){if(void 0!==this.dataSourceFunctionApplication){var e=this.dataSourceChanged;return this.dataSourceChanged=!1,debugWrites&&0===this.prototype.localToDefun&&console.log("write eval",this.prototype.idStr(),this.prototype.path.toString()),this.dataSourceResultMode?!!e&&(this.result.copy(this.lastUpdate),!0):(this.lastUpdate.value!==emptyDataSourceResult?this.result.equal(this.lastUpdate)||(e=!0,this.result.copy(this.lastUpdate)):this.extractDataSourceResult()&&(e=!0),e)}if(this.result.equal(this.lastUpdate))return!1;if(debugWrites&&debugWritesEval&&0===this.prototype.localToDefun){var t=this.local.getEvaluationArea(),i=void 0===t?"global":"@"+t.areaId;console.log("write eval",i,this.prototype.idStr(),this.prototype.path.toString(),":=",cdlifyLim(this.lastUpdate.value,200))}return this.result.copy(this.lastUpdate),!0},t.prototype.latch=function(){this.inputHasChanged=!0,evaluationQueue.latch(this)},t.prototype.write=function(e,t,i,r){if(void 0!==r&&(1!==r.length||0!==r[0].index))return void Utilities.warn("dead ended write: wrong position for EvaluationStore at "+gWriteAction);if(void 0!==this.source){var n=void 0===this.position?r:void 0===r?[new DataPosition(this.position,1)]:[new DataPosition(this.position,1,r[0].path,r[0].sub)];this.source.write(e,t,i,n)}else{var o=void 0===r||void 0===r[0].path,s=void 0!==this.latchedValue?this.latchedValue:this.lastUpdate,a=determineWrite(s.value,e,t,i,r,new PositionChangeTracker);if(debugWrites&&a!==s.value){var d=debugWritesString?cdlify(s):s,u=debugWritesString?cdlify(a):a;gSimpleLog.log("replaced","@"+this.local.getOwnId()+":"+this.prototype.path.join("."),d),gSimpleLog.log("by",u)}valueEqual(a,s.value)&&(!o||void 0!==this.latchedValue&&this.latchedValue.equalLabels(e))||(this.latchedValue=new Result(a),o&&this.latchedValue.copyLabels(e),this.latch())}},t.prototype.release=function(){this.latchedValue.equal(this.lastUpdate)||(debugWrites&&debugWritesEval&&console.log("unlatch",this.prototype.idStr(),cdlify(this.lastUpdate),"=>",cdlify(this.latchedValue)),this.lastUpdate=this.latchedValue,this.latchedValue=void 0,this.markAsChanged()),this.latchedValue=void 0,this.positionChangeTracker.clear()},t.prototype.extractResult=function(e){return void 0===e?void 0:void 0===this.position?e:e.value instanceof Array&&e.value.length>this.position?e.sub(this.position):0===this.position?e:new Result([])},t.prototype.debugName=function(){return"store"},t.prototype.specificExplanation=function(t,i,r){void 0===r&&(r=!1);var n=this.prototype;return e.prototype.specificExplanation.call(this,t,i),t.path=n.path,void 0!==this.latchedValue&&(t.latchedValue=getDeOSedValue(this.latchedValue.value)),t},t.prototype.toFullString=function(){return"["+pathToQueryString(this.prototype.path,"_")+", [me]] = "+cdlifyLim(this.result.value,80)},t.prototype.multiQuerySourceIds=function(){return void 0!==this.source&&void 0===this.position?this.source.multiQuerySourceIds():[this.watcherId]},t}(EvaluationNode),EvaluationMessageQueue=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.messageQueue=[],r.dataSourceResultMode=!1,r}return __extends(t,e),t.prototype.empty=function(){return 0===this.messageQueue.length},t.prototype.nextMessage=function(){var e=this.messageQueue.shift();(debugWrites||debugLogEvent("message"))&&console.log("set global message",cdlify(e.value));for(var t=0;t<e.value.length;t++){for(var i=("recipient"in e.value[t]?ensureOS(e.value[t].recipient):[]),r=[],n={},o=0;o<i.length;o++){var s=i[o];s instanceof ElementReference?s.element in n||(r.push(allAreaMonitor.getAreaById(s.getElement())),n[s.element]=!0):r.push(s)}queueEvent(new ImpersonatedDomEvent("message"),e.value[t],void 0,r,void 0,void 0,[],void 0,void 0,!1)}return 0===this.messageQueue.length},t.prototype.write=function(e,t,i,r){if(void 0===r||1===r.length&&0===r[0].index&&void 0===r[0].path){var n=new Result(void 0);n.copy(e),debugWrites&&console.log("write to [message]",cdlify(e.value)),this.messageQueue.push(n),globalNextMessageTask.schedule()}else Utilities.warn("dead ended write to message queue at "+gWriteAction)},t}(EvaluationStore);EvaluationMessageQueue.emptyMessage=new Result(constEmptyOS);var browserDependentCursorNames={grab:["-webkit-grab","-moz-grab"],grabbing:["-webkit-grabbing","-moz-grabbing"]},EvaluationPointerStore=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.latchedValue=constEmptyOS,t.isOnTimeQueue=!1,t}return __extends(t,e),t.prototype.write=function(i,r,n,o){var s=new PositionChangeTracker,a=determineWrite([{}],i,r,n,o,s);t.writeObjType.matches(a)?(debugWrites&&console.log("write to [{display: {image: _}}, [pointer]]",cdlify(i.value)),this.latchedValue=a[0].display[0].image,evaluationQueue.addTimeSensitiveNode(this)):e.prototype.write.call(this,i,r,n,o)},t.prototype.endOfEvaluationCycleNotification=function(e){var t=this.latchedValue;if(this.result.value[0].display[0].image=ensureOS(t),t instanceof Array&&(t=t[0]),"string"==typeof t){if(debugWrites&&Utilities.log("writing "+t+" to pointer.display.image"),gDomEvent.setPointerImage(t),t in browserDependentCursorNames)for(var i=browserDependentCursorNames[t],r=0;r<i.length;r++)gDomEvent.setPointerImage(i[r])}else Utilities.warn("non string for mouse image")},t.prototype.preWriteNotification=function(e){},t}(EvaluationStore);EvaluationPointerStore.writeObjType=vtd("av",{display:vtd("av",{image:vtd("string")})});var EvaluationDebugBreak=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.dataSourceResultMode=!1,r}return __extends(t,e),t.prototype.write=function(e,t,i,r){setGDebugBreak()},t}(EvaluationStore),EvaluationParam=function(e){function t(t,i,r){var n=e.call(this,t,r)||this;return n.areaId=i,n.result.value=[{pointerInArea:[!1]}],n.lastUpdate.copy(n.result),n}return __extends(t,e),t.prototype.write=function(e,t,i,r){function n(t,i){var r=void 0!==a.latchedValue?a.latchedValue.value[0]:a.lastUpdate.value[0],n=mergeValueCopy({input:e.value},r);!valueEqual(r,n)&&d.setInputState(t,i[0])&&(a.latchedValue=new Result(n),a.latch())}function o(e,t,i){for(var r=i,n=e.length-1;n>=t;n--){var o=e[n],s={};s[o]=r,r=[s]}return r}function s(i,r,d){if(void 0===d||1===i.length&&"areaSetContent"===i[0])switch(i[0]){case"input":n(i[1],o(i,2,ensureOS(e.value)));break;case"areaSetContent":var u=void 0===d?[new DataPosition(a.position,1)]:[d[0].copyWithOffset(d[0].index-a.position)];a.source.write(e,t,r,u);break;default:Utilities.warn("dead ended write to param in "+a.local.getOwnId()+" at "+gWriteAction)}else if(void 0!==d&&1===d.length&&0===d[0].index&&void 0!==d[0].path)s(i.concat(d[0].path[0]),r.popPathElement(d[0].path[0]),d[0].sub);else if(void 0!==d&&1===d.length&&0===d[0].index&&void 0===d[0].path){var h=getDeOSedValue(e.value);if(h instanceof Array||!isAV(h))s(i,r,void 0);else{a.lastUpdate.value[0]=shallowCopy(a.lastUpdate.value[0]);for(var l in h)s(i.concat(l),r.popPathElement(l),void 0)}}else Utilities.warn("dead ended write to param in "+a.local.getOwnId()+" at "+gWriteAction)}var a=this,d=allAreaMonitor.getAreaById(this.areaId);s([],i,r),debugWrites&&console.log("write to param",cdlify(e.value))},t.prototype.updateDataElementIds=function(e){"dataSource"in this.lastUpdate&&this.lastUpdate.dataSource.updateDataElements(e),"dataSource"in this.result&&this.result.dataSource.updateDataElements(e)},t}(EvaluationStore),EvaluationDefunParameter=function(e){function t(t,i){var r=e.call(this,t,i)||this;r.constant=!1;var n=i.getSource(t);return r.setSource(n.node,n.position),r}return __extends(t,e),t.prototype.isConstant=function(){return this.constant},t.prototype.setDataSourceResultMode=function(t){var i=this.dataSourceResultMode;e.prototype.setDataSourceResultMode.call(this,t),this.dataSourceResultMode!==i&&this.isActive()&&(this.dataSourceResultMode?this.source.activeWatcherBecomesDataSourceAware(this):this.source.activeWatcherNoLongerIsDataSourceAware(this))},t.prototype.setSource=function(e,t){this.source=e,this.position=t,this.constant=e.isConstant(),this.constant&&this.set(e.result)},t.prototype.activateInputs=function(){e.prototype.activateInputs.call(this),this.source.activate(this,this.dataSourceResultMode)},t.prototype.deactivateInputs=function(){this.source.deactivate(this,this.dataSourceResultMode),e.prototype.deactivateInputs.call(this)},t}(EvaluationStore),gAppStateChangeList=[],EvaluationWrite=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.initialValue=void 0,r.latchedValue=void 0,r.isLatched=!1,r.positionChangeTracker=new PositionChangeTracker,r.appStateIdentifier=void 0,"schedulingError"in t&&(r.inputs=[]),r}return __extends(t,e),t.prototype.setInitialValue=function(e,t,i,r,n){"undefined"==typeof i?this.appStateIdentifier=void 0:this.appStateIdentifier=new AppStateIdentifier(i,r,String(n));var o=void 0;"undefined"!=typeof this.appStateIdentifier?(gAppStateMgr.register(this.appStateIdentifier,this),o=gAppStateMgr.get(this.appStateIdentifier),this.result.remoteStatus="waiting"):this.result.remoteStatus="local",void 0!==o?(this.result.value=o,this.result.remoteStatus="remote",this.valueOrigin="remote"):void 0!==e?(this.initialValue=getEvaluationNode(e,t),this.result.value=this.initialValue.result.value,this.initialValue.isConstant()?void 0!==this.result.value&&this.markAsChanged():(this.initialValue.activate(this,!1),this.initialValue.addWatcher(this,"initialValue",!0,!1,!1),"schedulingError"in this.prototype&&this.inputs.push(this.initialValue)),this.valueOrigin="init"):this.inputHasChanged=!1,this.lastUpdate=this.result.value},t.prototype.reinitialize=function(){var e,t;gAppStateMgr.unregister(this.appStateIdentifier),this.prototype.remoteWritable&&(this.local instanceof CoreArea?(e=this.local.getPersistentTemplateId(),t=this.local.getPersistentIndexId()):(e=gPaidMgr.getGlobalPersistentTemplateId(),t=gPaidMgr.getGlobalPersistentIndexId())),this.lastUpdate=void 0,this.latchedValue=void 0,this.isLatched=!1,this.valueOrigin=void 0,this.appStateIdentifier=void 0,this.setInitialValue(this.prototype.initialValue,this.local,e,t,this.prototype.path)},t.prototype.destroy=function(){"undefined"!=typeof this.appStateIdentifier&&gAppStateMgr.unregister(this.appStateIdentifier),e.prototype.destroy.call(this)},t.prototype.activateInputs=function(){},t.prototype.deactivateInputs=function(){},t.prototype.write=function(e,t,i,r){var n,o=void 0!==this.latchedValue?this.latchedValue:this.lastUpdate,s=this.positionChangeTracker.clone();if(debugWrites&&debugWritesEval&&console.log("WRITE",this.prototype.idStr(),cdlify(e.value)),n=determineWrite(o,e,t,i,r,this.positionChangeTracker),debugWrites&&n!==o){var a=debugWritesString?cdlify(o):o,d=debugWritesString?cdlify(n):n;gSimpleLog.log("replaced","@"+this.local.getOwnId()+":"+this.prototype.path.join("."),a),gSimpleLog.log("by",d)}valueEqual(n,o)?this.positionChangeTracker=s:(this.latchedValue=n,this.valueOrigin="write",this.latch())},t.prototype.latch=function(){this.inputHasChanged=!0,evaluationQueue.latch(this)},t.prototype.release=function(){valueEqual(this.latchedValue,this.lastUpdate)||(debugWrites&&debugWritesEval&&console.log("unlatch",this.prototype.idStr(),cdlify(this.lastUpdate),"=>",cdlify(this.latchedValue)),this.lastUpdate=this.latchedValue,this.latchedValue=void 0,this.markAsChanged(),gAppStateChangeList.push({areaId:this.local.getOwnId(),path:this.prototype.path,value:this.lastUpdate})),this.latchedValue=void 0,this.positionChangeTracker.clear()},t.prototype.isConstant=function(){return!1},t.prototype.updateInput=function(e,t){void 0!==this.latchedValue||valueEqual(t.value,this.lastUpdate)||(this.lastUpdate=t.value,this.markAsChanged()),this.unregisterInitialValue()},t.prototype.unregisterInitialValue=function(){void 0!==this.initialValue&&(this.initialValue.removeWatcher(this,!1,!1),this.initialValue.deactivate(this,!1),this.initialValue=void 0,"schedulingError"in this.prototype&&(this.inputs.length=0))},t.prototype.eval=function(){if(debugWrites&&debugWritesEval&&0===this.prototype.localToDefun){var e=this.local.getEvaluationArea(),t=void 0===e?"global":"@"+e.areaId;console.log("write eval",this.valueOrigin,t,this.prototype.idStr(),this.prototype.path.toString(),":=",cdlifyLim(this.lastUpdate,200))}return this.result.value=this.lastUpdate,!0},t.prototype.debugName=function(){return"write"},t.prototype.specificExplanation=function(t,i,r){void 0===r&&(r=!1);var n=this.prototype;return e.prototype.specificExplanation.call(this,t,i),t.path=n.path,void 0!==this.latchedValue&&(t.latchedValue=getDeOSedValue(this.latchedValue)),t},t.prototype.remoteUpdate=function(e){var t=void 0!==this.latchedValue?this.latchedValue:this.lastUpdate;assert(void 0!==e,"remoteUpdate: undefined values should not reach this point"),gAppStateChangeList.push({areaId:this.local.getOwnId(),path:this.prototype.path,value:this.lastUpdate}),this.unregisterInitialValue(),valueEqual(e,t)||(this.lastUpdate=e,this.latchedValue=void 0,this.isLatched=!1,this.markAsChanged()),this.valueOrigin="remote",this.result.remoteStatus="remote"},t.prototype.remoteDelete=function(){var e=constEmptyOS;void 0===this.initialValue&&(this.initialValue=getEvaluationNode(this.prototype.initialValue,this.local)),void 0!==this.initialValue?(this.initialValue.isConstant()?void 0!==this.result.value&&this.markAsChanged():(this.initialValue.activate(this,!1),this.initialValue.addWatcher(this,"initialValue",!0,!1,!1),"schedulingError"in this.prototype&&this.inputs.push(this.initialValue)),e=this.initialValue.result.value):this.markAsChanged(),this.lastUpdate=e,this.valueOrigin="reinitialized",this.result.remoteStatus="local"},t.prototype.remoteError=function(){this.result.remoteStatus="error"},t.prototype.toFullString=function(){return"["+pathToQueryString(this.prototype.path,"_")+", [me]] = "+cdlifyLim(this.result.value,80)},t}(EvaluationNode),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),EvaluationDefun=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.environment=i.link(),r.result.value=[new DefunReference(r)],r}return __extends(t,e),t.prototype.destroy=function(){this.environment.unlink(),e.prototype.destroy.call(this)},t.prototype.isEqual=function(e){return e instanceof t&&(this.prototype===e.prototype&&this.environment===e.environment)},t.prototype.isConstant=function(){return!0},t.prototype.updateInput=function(){},t.prototype.eval=function(){return!1},t.prototype.debugName=function(){return"defun"},t}(EvaluationNode),LocalEvaluationEnvironment=function(){function e(e,t,i,r){this.refCount=1,this.parentEnv=e.link(),this.template=e.template,this.evaluationNodes=e.evaluationNodes.slice(0),this.evaluationNodes[t]=this.cache=new Array(i),this.localToDefun=t,this.parameterSources=r}return e.prototype.destroy=function(){var e=this.cache;this.parentEnv.unlink();for(var t=e.length-1;t>=0;t--)e[t].destroy();this.cache.length=0,this.cache=void 0,this.evaluationNodes=void 0},e.prototype.link=function(){return this.refCount++,this},e.prototype.unlink=function(){assert(this.refCount>0,"debugging"),this.refCount--,0===this.refCount&&this.destroy()},e.prototype.getOwnId=function(){},e.prototype.getRelation=function(e){},e.prototype.getParent=function(){return this.parentEnv},e.prototype.getParentWithTemplateId=function(e){return this.parentEnv.getParentWithTemplateId(e)},e.prototype.getEvaluationArea=function(){return this.parentEnv.getEvaluationArea()},e.prototype.isValid=function(){return this.parentEnv.isValid()},e.prototype.getSource=function(e){return this.parameterSources[e.id]},e}(),emptyDataSourceResult=[],EvaluationApply=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.state=0,r.active=!1,r.testSimpleQuery=!1,r.arguments=[],r.prevResultFromSameDefun=!1,r.resultRequirements=MinimumResultRequirements.ordered,r.queryUpdateCounter=0,r.counterAtLastExtraction=-1,r.inputHasChanged=!1,r.dataSourceAware=!0,r.dataSourceResultMode=!0,r.result.value=emptyDataSourceResult,r}return __extends(t,e),t.prototype.destroy=function(){"fun"in this&&this.unsetFunction(),"query"in this&&this.unsetQuery(),"foreignInterface"in this&&this.unsetForeignInterface(),e.prototype.destroy.call(this)},t.prototype.removeAsWatcher=function(){if(void 0!==this.inputs){var e=this.inputs;this.inputs=void 0,void 0!==e[0]&&e[0].removeWatcher(this,!0,!1),void 0!==e[1]&&e[1].removeWatcher(this,"query"in this,!0);for(var t=2;t<e.length;t++)void 0!==e[t]&&e[t].removeWatcher(this,!1,"fun"in this)}},t.prototype.addArgument=function(e,t){this.inputs[e]=t,t.isConstant()||(this.constant=!1,t.addWatcher(this,e,!0,!0,e>0)),0===e?this.setFunctionOrQuery(t.result):this.setArgument(t.result,e-1)},t.prototype.updateInput=function(e,t){void 0===t?("fun"in this&&this.unsetFunction(),"query"in this&&this.unsetQuery(),"foreignInterface"in this&&this.unsetForeignInterface()):"result"===e?(this.bodyResult=t,this.markAsChanged()):0===e?this.setFunctionOrQuery(t):this.setArgument(t,e-1)},t.prototype.setFunctionOrQuery=function(e){var t=e.value instanceof Array&&1===e.value.length?e.value[0]:e.value;if(t instanceof DefunReference){var i=t;this.constant=!1,"query"in this&&this.unsetQuery(),"foreignInterface"in this&&this.unsetForeignInterface(),this.setFunction(i)}else t instanceof NativeObjectWrapper&&void 0!==t.foreignInterfaceConstructor?("fun"in this&&this.unsetFunction(),"query"in this&&this.unsetQuery(),this.setForeignInterface(t)):void 0!==t?("fun"in this&&this.unsetFunction(),"foreignInterface"in this&&this.unsetForeignInterface(),this.setQuery(t,e)):("fun"in this&&this.unsetFunction(),"query"in this&&this.unsetQuery(),this.result.set(void 0));this.nrActiveWatchers>0&&!this.active&&this.activateFun()},t.prototype.setQuery=function(e,t){"query"in this||!this.isActive()||void 0===this.inputs[1]||this.inputs[1].activate(this,!0),this.query=e,this.queryIds=t.identifiers,this.testSimpleQuery=!0,delete this.simpleQuery,this.queryIsProjection=this.query!==_&&nrProjSitesInQuery(this.query)>0,void 0!==t.compiledQuery&&1===t.compiledQuery.length?(this.compiledQuery=t.compiledQuery[0],this.compiledQueryArguments=t.queryArguments[0]):(this.compiledQuery=void 0,this.compiledQueryArguments=void 0),void 0!==this.arguments[0]&&(void 0===this.inputs[1]||!("dataSource"in this.inputs[1].result||"dataSource"in this.result)||!this.inputs[1].isScheduled()&&this.inputs[1].isActive()?void 0!==this.inputs[1]&&"dataSource"in this.inputs[1].result?this.setDataSourceInput(this.inputs[1].result.dataSource):this.markAsChanged():this.inputs[1].addForcedUpdate(this))},t.prototype.unsetQuery=function(){void 0!==this.dataSourceInput&&(this.dataSourceQuery.removeResultReceiver(this),void 0!==this.orderingResultWatcher&&(this.orderingResultWatcher.destroy(),this.orderingResultWatcher=void 0),this.dataSourceInput=void 0,this.dataSourceQuery=void 0),"query"in this&&this.isActive()&&void 0!==this.inputs[1]&&this.inputs[1].deactivate(this,!0),delete this.query,delete this.queryIds,delete this.queryIsProjection,delete this.compiledQuery,delete this.compiledQueryArguments,delete this.simpleQuery,this.testSimpleQuery=!1,this.markAsChanged()},t.prototype.setForeignInterface=function(e){if(this.constant=!1,"foreignInterface"in this)this.foreignInterface.destroy();else if(this.isActive())for(var t=1;t<this.inputs.length;t++)this.inputs[t].activate(this,!1);this.foreignInterface=e.createForeignInterface(),this.foreignInterface.local=this.local.getOwnId(),this.result.foreignInterfaceSource=this.foreignInterface;for(var t=1;t<this.inputs.length;t++)this.foreignInterface.setArgument(t-1,this.arguments[t]);this.markAsChanged()},t.prototype.unsetForeignInterface=function(){if(this.foreignInterface.destroy(),delete this.foreignInterface,this.isActive())for(var e=1;e<this.inputs.length;e++)this.inputs[e].deactivate(this,!1);delete this.result.foreignInterfaceSource,this.markAsChanged()},t.prototype.setDataSourceInput=function(e){var t=this.inputs[0].querySourceId();this.dataSourceInput===e&&this.dataSourceQuery instanceof DataSourceQueryByData&&this.dataSourceQuery.hasSameSource(t)&&this.query!==_?this.dataSourceQuery.updateQuery(this.query):this.dataSourceInput===e&&this.dataSourceQuery instanceof DataSourceElementIdTransformation&&this.query===_||(allowSetData&&void 0!==this.dataSourceQuery&&this.dataSourceQuery.hasSameSource(t)&&this.dataSourceQuery.canMoveTo(this,e)?this.moveToDataSource(e):this.changeDataSource(e,t))},t.prototype.moveToDataSource=function(e){this.dataSourceQuery.moveToDataSource(this,e),this.dataSourceInput=e},t.prototype.changeDataSource=function(e,t){void 0!==this.dataSourceInput&&(this.dataSourceQuery.removeResultReceiver(this),void 0!==this.orderingResultWatcher&&(this.orderingResultWatcher.destroy(),this.orderingResultWatcher=void 0)),this.dataSourceInput=e,this.dataSourceQuery=this.query!==_?e.applyDataQuery(this.query,this,t):e.applyElementIdTransformation("uniqueById",this),this.isActive()&&!this.dataSourceResultMode&&(assert(void 0===this.orderingResultWatcher,"debugging"),this.addOrderingResultWatcher(),this.dataSourceQuery.updateIndexerMonitoringForDominatedPath()),this.markAsChanged()},t.prototype.releaseDataSourceInput=function(){void 0!==this.orderingResultWatcher&&(this.orderingResultWatcher.destroy(),this.orderingResultWatcher=void 0),this.dataSourceQuery.stopIndexerMonitoring(),this.dataSourceQuery.removeResultReceiver(this),this.dataSourceQuery=void 0,this.dataSourceInput=void 0,this.markAsChanged()},t.prototype.setMinimumResultRequirements=function(e){this.resultRequirements=e,this.addOrderingResultWatcher()},t.prototype.addOrderingResultWatcher=function(){this.resultRequirements===MinimumResultRequirements.ordered&&void 0===this.orderingResultWatcher&&(this.orderingResultWatcher=new OrderingResultWatcher(globalInternalQCM,this,void 0),this.orderingResultWatcher.init(this.dataSourceQuery),this.orderingResultWatcher.activate())},t.prototype.newDataSourceResult=function(e){Utilities.error("should not be called")},t.prototype.reextractData=function(){this.dataSourceResultMode||this.markAsChanged()},t.prototype.updateDataElementPosition=function(e,t,i,r){this.dataSourceResultMode||this.markAsChanged()},t.prototype.refreshIndexerAndPaths=function(e,t){this.dataSourceResultMode||(this.dataSourceQuery.updateIndexerMonitoringForDominatedPath(),this.markAsChanged())},t.prototype.replaceIndexerAndPaths=function(e,t,i,r){this.dataSourceResultMode||(this.dataSourceQuery.updateIndexerMonitoringForDominatedPath(),this.markAsChanged())},t.prototype.extractDataSourceResult=function(){var e=this.result.value,t=this.dataSourceQuery.extractData(this.resultRequirements,this.orderingResultWatcher),i="dataSource"in this.result;return this.counterAtLastExtraction=this.queryUpdateCounter,this.result.value=t,i&&delete this.result.dataSource,i||!valueEqual(e,t)},t.prototype.setArgument=function(e,t){this.arguments[t]=e,"fun"in this?(this.changedArguments[t]=!0,this.markAsChanged()):"query"in this?!("dataSource"in e||"dataSource"in this.result)||!this.inputs[1].isScheduled()&&this.inputs[1].isActive()?"dataSource"in e?this.setDataSourceInput(e.dataSource):(void 0!==this.dataSourceInput&&this.releaseDataSourceInput(),this.markAsChanged()):this.inputs[1].addForcedUpdate(this):"foreignInterface"in this&&this.foreignInterface.setArgument(t,e)&&this.markAsChanged()},t.prototype.activateInputs=function(){if(void 0!==this.inputs[0]&&this.inputs[0].activate(this,!1),"query"in this&&void 0!==this.inputs[1]&&this.inputs[1].activate(this,!0),this.dataSourceResultMode||void 0===this.dataSourceQuery||(assert(void 0===this.orderingResultWatcher,"debugging"),this.orderingResultWatcher=new OrderingResultWatcher(globalInternalQCM,this,void 0),this.orderingResultWatcher.init(this.dataSourceQuery),this.orderingResultWatcher.activate()),"foreignInterface"in this)for(var e=1;e<this.inputs.length;e++)this.inputs[e].activate(this,!1);void 0===this.inputs[0]||this.inputs[0].isScheduled()?(this.unsetFunction(),this.activateFun(),void 0!==this.inputs[0]&&this.inputs[0].forceUpdate(this,!1)):this.activateFun()},t.prototype.deactivateInputs=function(){if(void 0!==this.orderingResultWatcher&&(this.orderingResultWatcher.destroy(),this.orderingResultWatcher=void 0),void 0!==this.dataSourceQuery&&this.dataSourceQuery.stopIndexerMonitoring(),this.deactivateFun(),void 0!==this.inputs)if(void 0!==this.inputs[0]&&this.inputs[0].deactivate(this,!1),"query"in this&&void 0!==this.inputs[1])this.inputs[1].deactivate(this,!0);else if("foreignInterface"in this)for(var e=1;e<this.inputs.length;e++)this.inputs[e].deactivate(this,!1)},t.hasSuitableCache=function(e,t){if(!("simpleQueryCache"in e)||e.simpleQueryCache.result!==e.value)return!1;if(t instanceof RangeValue)return"range"in e.simpleQueryCache.cache;if(isAV(t)){for(var i in t)if(!(isSimpleValue(t[i])&&"simplevalue_"+i in e.simpleQueryCache.cache))return!1;return!0}return!1},t.prototype.setDataSourceResultMode=function(e){this.isActive()&&void 0!==this.dataSourceInput?e&&!this.dataSourceResultMode?(void 0!==this.orderingResultWatcher&&(this.orderingResultWatcher.destroy(),this.orderingResultWatcher=void 0),void 0!==this.result&&(this.result.value=emptyDataSourceResult),this.dataSourceQuery.stopIndexerMonitoring(),this.dataSourceResultMode=!0,this.markAsChanged()):!e&&this.dataSourceResultMode&&(assert(void 0===this.orderingResultWatcher,"debugging"),this.dataSourceResultMode=!1,this.isActive()&&void 0!==this.dataSourceQuery&&(this.orderingResultWatcher=new OrderingResultWatcher(globalInternalQCM,this,void 0),this.orderingResultWatcher.init(this.dataSourceQuery),this.orderingResultWatcher.activate(),this.dataSourceQuery.updateIndexerMonitoringForDominatedPath()),this.markAsChanged()):this.dataSourceResultMode=e,"body"in this&&this.isActive()&&(e?this.body.activeWatcherBecomesDataSourceAware(this):this.body.activeWatcherNoLongerIsDataSourceAware(this))},t.prototype.eval=function(){var e=!1;if("fun"in this){for(var i=!1,r=0;r<this.parameters.length;r++)this.changedArguments[r]!==!1&&(this.parameters[r].set(this.arguments[r]),this.changedArguments[r]=!1,i=!0);if(void 0!==this.bodyResult){if(i)return;var n=this.bodyResult;if(this.bodyResult=void 0,!this.result.equal(n))return this.result.copy(n),!0}return!1}if(this.prevResultFromSameDefun=!1,"foreignInterface"in this)return this.evalForeignInterface();if(void 0!==this.dataSourceInput)return this.dataSourceResultMode?this.result.dataSource!==this.dataSourceQuery&&(this.result.dataSource=this.dataSourceQuery,this.result.value=emptyDataSourceResult,!0):this.extractDataSourceResult();if("dataSource"in this.result&&(delete this.result.dataSource,e=!0),1!==this.arguments.length||void 0===this.arguments[0].value)return!(!e&&void 0!==this.result.value&&0===this.result.value.length)&&(this.result.set(constEmptyOS),!0);var o,s,a=this.result.clone(),d=this.arguments[0].value,u=this.arguments[0].identifiers;
this.queryIsProjection||void 0===u?(s=void 0,u=void 0):s=[],this.prototype.writable&&(this.selectedPositions=[]);var h=!this.prototype.writable&&d.length>30&&(t.hasSuitableCache(this.arguments[0],this.query)||this.inputs[1].nrSimpleQueryWatchers(this.query)>=4)&&this.setSimpleQuery()&&this.simpleQuery.canCache();if(h)this.result.copyLabelsMinusDataSource(this.arguments[0]),this.result.value=this.simpleQuery.executeAndCache(this.arguments[0],s,this.selectedPositions);else if(void 0===this.compiledQuery||this.prototype.writable)if(this.setSimpleQuery())this.result.copyLabelsMinusDataSource(this.arguments[0]),this.result.value=this.simpleQuery.execute(d,u,s,this.selectedPositions,void 0);else if("query"in this){o=constEmptyOS;for(var r=0;r!==d.length;r++){var l=interpretedQuery(this.query,d[r]);void 0!==l&&(void 0!==s&&s.push(u[r]),l instanceof Array&&0===l.length||Array.prototype.push.apply(o,l),this.prototype.writable&&this.selectedPositions.push(new DataPosition(r,l instanceof Array?l.length:void 0!==l?1:0)))}this.result.copyLabelsMinusDataSource(this.arguments[0]),this.result.value=o}else this.prototype.writable&&(this.selectedPositions=[]),this.result.set([]),s=void 0;else this.result.copyLabelsMinusDataSource(this.arguments[0]),this.result.value=this.compiledQuery(d,this.compiledQueryArguments,u,s);return this.result.setIdentifiers(s),e||!a.isEqual(this.result)},t.prototype.evalForeignInterface=function(){function e(e,o){e===r&&valueEqual(o,n)||(t.foreignResultChanged=!0,t.result.value=o,t.result.remoteStatus=e,i||t.markAsChanged()),i=!1}var t=this,i=!0,r=this.result.remoteStatus,n=this.result.value;if(this.foreignResultChanged)return this.foreignResultChanged=!1,!0;if(this.foreignInterface.execute(e)&&this.foreignInterface.isDisplay()&&allAreaMonitor.requestVisualUpdate(this.foreignInterface.getDisplayArea()),this.foreignResultChanged)return this.foreignResultChanged=!1,!0;var o=i?"waiting":this.result.remoteStatus;return i=!1,o!==r&&(this.result.remoteStatus=o,!0)},t.prototype.write=function(e,t,i,r){var n,o=extractProjectionPaths(this.query);if("foreignInterface"in this)return void this.foreignInterface.write(e,t,i,r);if(!("query"in this))return void Utilities.warn("dead-ended write: cannot write through defun at "+gWriteAction);if(void 0!==o&&o.length>1)return void Utilities.warn("dead-ended write: cannot write to multiple projections at "+gWriteAction);var s=void 0!==o?o[0]:void 0;if(i=i.extendWithPath(s),n=void 0===s?getSelectedWritePositionsNoPath(r,this.selectedPositions):getSelectedWritePositionsWithPath(r,this.selectedPositions,s),void 0!==this.selectedPositions&&0===this.selectedPositions.length){var a=n.filter(function(e){return 0!==e.path.length});if(a.length<n.length)return assert(0===a.length,"expecting all positions from the same source"),void Utilities.warn("dead ended write: cannot write non-projections through empty selection at "+gWriteAction);var d=this.getSelectionObject();void 0!==d&&(n=0!==n.length?n.map(function(e){return e.copyWithAddedAttributes(d)}):[new DataPosition(0,1,void 0,void 0,d)])}this.inputs[1].write(e,t,i,n)},t.prototype.setSimpleQuery=function(){if(this.testSimpleQuery){var e=makeSimpleQueryWithId(this.query,this.queryIds);return this.testSimpleQuery=!1,void 0!==e?(this.simpleQuery=e,!0):(delete this.simpleQuery,!1)}return"simpleQuery"in this},t.prototype.activateFun=function(){switch(this.active=!0,this.state){case 0:this.state=1;break;case 2:this.buildFunctionNodes(),this.activateBody(),this.state=4;break;case 3:this.activateBody(),this.state=4;break;default:assert(!1,"already active?")}},t.prototype.deactivateFun=function(){if(this.active)switch(this.active=!1,this.state){case 1:this.state=0;break;case 4:this.deactivateBody(),this.state=3;break;default:assert(!1,"already inactive?")}},t.prototype.setFunction=function(e){switch(this.changedArguments=new Array(this.inputs.length-1),this.state){case 0:this.fun=e.defun,this.state=2;break;case 1:this.fun=e.defun,this.buildFunctionNodes(),this.activateBody(),this.state=4;break;case 2:this.fun=e.defun,this.state=2;break;case 3:assert(0===this.body.nrActiveWatchers,"must be inactive in S3"),this.removeFunctionNodes(),this.fun=e.defun,this.state=2;break;case 4:this.deactivateBody(),this.removeFunctionNodes(),this.fun=e.defun,this.buildFunctionNodes(),this.activateBody(),this.state=4}},t.prototype.unsetFunction=function(){switch(delete this.changedArguments,this.state){case 0:this.state=0;break;case 1:this.state=1;break;case 2:delete this.fun,this.state=0;break;case 3:this.removeFunctionNodes(),delete this.fun,this.state=0;break;case 4:this.deactivateBody(),this.removeFunctionNodes(),delete this.fun,this.state=1;break;default:assert(!1,"wrong state")}},t.prototype.buildFunctionNodes=function(){var e=this,t=this.fun.prototype,i=t.defunNr,r=this.fun.prototype.localToArea,n=areaTemplates[r],o=n.defunFunctionNodes[i],s=this.inputs,a=t.parameterNodes.map(function(e,t){return{node:s[t+1],position:void 0}});if(!this.fun.environment.isValid())return void(this.body=void 0);this.environment=new LocalEvaluationEnvironment(this.fun.environment,i,o.length,a);for(var d=0;d!==o.length;d++)buildEvaluationNode(o[d],this.environment);this.parameters=t.parameterNodes.map(function(t){return getEvaluationNode(t,e.environment)}),this.body=getEvaluationNode(t.body,this.environment),this.body.isConstant()?(this.body.setDataSourceResultMode(this.dataSourceResultMode),this.result.copy(this.body.result),this.informAllWatchers()):this.body.addWatcher(this,"result",!1,!1,this.dataSourceResultMode),this.parameters.length!==this.inputs.length-1&&Utilities.warn("difference between parameters and arguments in defun application")},t.prototype.activateBody=function(){for(var e=0;e<this.parameters.length&&e<this.arguments.length;e++)this.parameters[e].set(this.arguments[e]);this.body.activate(this,this.dataSourceResultMode)},t.prototype.removeFunctionNodes=function(){this.body.isConstant()||this.body.removeWatcher(this,!1,this.dataSourceResultMode),this.environment.unlink(),this.body=void 0,this.environment=void 0,this.parameters=void 0},t.prototype.deactivateBody=function(){this.body.deactivate(this,this.dataSourceResultMode)},t.prototype.specificExplanation=function(t,i,r){return void 0===r&&(r=!1),e.prototype.specificExplanation.call(this,t,i),void 0!==this.body&&(t["_body: "+this.body.debugName()]=this.body.explain(void 0)),t},t.prototype.isLargeQuery=function(e,t){return void 0!==this.query&&(this.inputs[0].result.isLargerThan(e,!0)||!t&&this.inputs[1].result.isLargerThan(e,!1))},t.prototype.getSelectionObject=function(){function e(t){if(t instanceof Array){if(1!==t.length)return;return e(t[0])}if(t!==_){if("object"!=typeof t||t instanceof NonAV)return[t];var i=void 0;for(var r in t){var n=e(t[r]);void 0!==n&&(void 0===i&&(i={}),i[r]=n)}return i}}return e(this.query)},t.prototype.allInputs=function(){return void 0!==this.body?this.inputs.concat(this.body):this.inputs},t}(EvaluationFunctionApplication);internalApply.classConstructor=EvaluationApply;var EvaluationMap=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.result.value=constEmptyOS,r.constant=!1,delete r.arguments,r}return __extends(t,e),t.prototype.destroy=function(){this.destroyFunctionNodes(),e.prototype.destroy.call(this)},t.prototype.destroyFunctionNodes=function(){if(void 0!==this.arguments){var e=this.arguments.length;if(this.nrActiveWatchers>0&&this.deactivateSingleFun(0,e),void 0!==this.bodies)for(var t=0;t<e;t++)void 0!==this.bodies[t]&&(this.bodies[t].removeWatcher(this,!1,!0),this.environments[t].unlink())}delete this.environments,delete this.arguments,delete this.identifiers,delete this.bodies,delete this.fun,delete this.parameters},t.prototype.addArgument=function(e,t){this.inputs[e]=t,t.isConstant()||t.addWatcher(this,e,!1,!0,1===e),0===e?this.setFunction(t.result.value):this.setArgument(t.result)},t.prototype.updateInput=function(e,t){var i=void 0!==t?t.value:void 0;switch(e){case 0:this.setFunction(i),this.markAsChanged();break;case 1:this.setArgument(t);break;case 2:this.markAsChanged();break;default:var r=-e-1;assert(0<=r&&r<this.arguments.length,"DEBUGGING"),this.values[r]=t,this.markAsChanged()}},t.prototype.setFunction=function(e){var t=e instanceof Array&&1===e.length?e[0]:e;if(this.destroyFunctionNodes(),void 0===this.inputs[1]||this.inputs[1].isScheduled()||this.setArgument(this.inputs[1].result),t instanceof DefunReference){var i=t,r=i.defun.prototype;"query"in this&&delete this.query,1===r.parameterNodes.length?(this.fun=i.defun,void 0!==this.arguments&&this.instantiateSingleFun(0,this.arguments.length)):Utilities.warn("map: wrong arguments to defun")}else void 0!==t?this.query=t:"query"in this&&delete this.query},t.prototype.multiQuerySourceIds=function(){return void 0===this.bodies?[this.watcherId]:this.bodies.map(function(e){return e.watcherId})},t.prototype.instantiateSingleFun=function(e,t){var i=this.fun.prototype,r=i.defunNr,n=this.fun.prototype.localToArea,o=n>0?areaTemplates[n]:void 0,s=n>0?o.defunFunctionNodes[r]:FunctionNode.globalDefunFunctionNodes[r],a=this.inputs[1].isConstant();if(void 0===this.parameters&&(this.parameters=new Array(t),this.bodies=new Array(t),this.environments=new Array(t),this.values=new Array(t),a?this.identifiers=this.inputs[1].result.identifiers:void 0===this.identifiers?this.identifiers=new Array(t):this.identifiers.length=t),this.fun.environment.isValid()){for(var d=i.parameterNodes[0],u=d.id,h=!0,l=e;l<t;l++){var c=[{node:this.inputs[1],position:l}],p=new LocalEvaluationEnvironment(this.fun.environment,r,s.length,c);this.environments[l]=p,this.parameters[l]=d.makeEvaluationNode(p),this.parameters[l].setSource(this.inputs[1],l),this.setSingleParameter(l,l+1),this.parameters[l].init(),this.parameters[l].isBeingInitialized=!1;for(var f=0;f!==s.length;f++)f!==u&&buildEvaluationNode(s[f],p);this.bodies[l]=getEvaluationNode(i.body,p),this.bodies[l].isConstant()?(this.values[l]=this.bodies[l].result,this.markAsChanged()):(this.bodies[l].addWatcher(this,-l-1,!1,!1,!0),h=!1)}a&&h?this.funResultIsConstant=!0:this.activateSingleFun(e,t)}},t.prototype.deinstantiateSingleFun=function(e,t){this.nrActiveWatchers>0&&this.deactivateSingleFun(e,t);for(var i=e;i<t;i++)void 0===this.bodies[i]||this.bodies[i].isConstant()||(this.bodies[i].removeWatcher(this,!1,!0),this.environments[i].unlink());this.bodies.splice(e,t-e),this.environments.splice(e,t-e),this.parameters.splice(e,t-e),this.values.splice(e,t-e)},t.prototype.setArgument=function(e){var t=void 0!==e?e.value:void 0,i=void 0!==this.arguments?this.arguments.length:0;this.result.copyLabelsMinusDataSource(e),void 0!==e&&(this.identifiers=e.identifiers),void 0===t?this.arguments=[]:t instanceof Array?this.arguments=t:this.arguments=[t],void 0!==this.fun&&(i<this.arguments.length?(this.setSingleParameter(0,i),this.instantiateSingleFun(i,this.arguments.length)):(this.setSingleParameter(0,this.arguments.length),i>0&&(this.deinstantiateSingleFun(this.arguments.length,i),this.markAsChanged())))},t.prototype.setSingleParameter=function(e,t){for(var i=e;i<t;i++){var r=new Result([this.arguments[i]]);void 0!==this.identifiers&&void 0!==this.identifiers[i]&&(r.identifiers=[this.identifiers[i]]),this.parameters[i].set(r)}},t.prototype.activateInputs=function(){e.prototype.activateInputs.call(this),void 0!==this.arguments&&this.activateSingleFun(0,this.arguments.length)},t.prototype.activateSingleFun=function(e,t){if(this.nrActiveWatchers>0&&void 0!==this.bodies)for(var i=e;i<t;i++){var r=new Result([this.arguments[i]]);void 0!==this.identifiers&&void 0!==this.identifiers[i]&&(r.identifiers=[this.identifiers[i]]),this.parameters[i].set(r),this.bodies[i].activate(this,!0)}},t.prototype.deactivateInputs=function(){void 0!==this.arguments&&this.deactivateSingleFun(0,this.arguments.length),e.prototype.deactivateInputs.call(this)},t.prototype.deactivateSingleFun=function(e,t){if(void 0!==this.bodies)for(var i=e;i<t;i++)this.bodies[i].deactivate(this,!0)},t.prototype.eval=function(){var e,t=this.result.value,i=this.result.identifiers,r=void 0;if("fun"in this){if(void 0!==this.values){e=[];for(var n=0;n<this.values.length;n++)if(void 0!==this.values[n]&&void 0!==this.values[n].value){var o=this.values[n];if(1===o.value.length)void 0!==o.identifiers&&(void 0===r&&(r=new Array(e.length+1)),r[e.length]=o.identifiers[0]),e.push(o.value[0]);else if(o.value.length>1){if(void 0!==o.identifiers){void 0===r&&(r=new Array(e.length+o.value.length));for(var s=0;s<o.identifiers.length;s++)r[n+s]=o.identifiers[s]}Array.prototype.push.apply(e,o.value)}}this.result.copyLabelsMinusDataSource(this.inputs[1].result),this.result.value=e,this.result.setIdentifiers(r),this.funResultIsConstant&&(this.destroyFunctionNodes(),this.funResultIsConstant=!1)}}else if("query"in this&&1===this.arguments.length){var a=this.inputs[0].result;this.result.copyLabelsMinusDataSource(this.inputs[1].result),void 0!==a.identifiers?(this.result.identifiers=[],this.result.value=interpretedQueryWithIdentifiers(this.query,this.arguments,a.identifiers,this.result.identifiers)):(this.result.value=interpretedQuery(this.query,this.arguments),"identifiers"in this.result&&delete this.result.identifiers)}else this.result.set([]);return!valueEqual(t,this.result.value)||!valueEqual(i,this.result.identifiers)},t.prototype.specificExplanation=function(t,i,r){if(void 0===r&&(r=!1),e.prototype.specificExplanation.call(this,t,i),void 0!==this.bodies){for(var n={},o=0;o<this.bodies.length;o++)n[o+": "+this.bodies[o].debugName()]=this.bodies[o].explain(void 0);t._bodies=n}return t},t.prototype.allInputs=function(){return void 0!==this.bodies?this.inputs.concat(this.bodies):this.inputs},t}(EvaluationFunctionApplication);map.classConstructor=EvaluationMap;var EvaluationFilter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.setArgument=function(t){e.prototype.setArgument.call(this,t),this.markAsChanged()},t.prototype.eval=function(){var e=this.result.value,t=this.result.identifiers;if("fun"in this){var i,r,n,o=[];if(void 0!==this.values){i=this.arguments,r=this.inputs[1].result.identifiers,n=void 0===r?void 0:[];for(var s=0;s<this.values.length;s++)void 0!==this.values[s]&&isTrue(this.values[s].value)&&(o.push(i[s]),void 0!==r&&n.push(r[s]))}this.result.copyLabels(this.inputs[1].result),this.result.value=o,this.result.setIdentifiers(n),this.funResultIsConstant&&(this.destroyFunctionNodes(),this.funResultIsConstant=!1)}else"query"in this&&1===this.arguments.length?void 0!==this.identifiers?(this.result.identifiers=[],this.result.value=interpretedQueryWithIdentifiers(this.query,this.arguments,this.identifiers,this.result.identifiers)):this.result.value=interpretedQuery(this.query,this.arguments):this.result.set([]);return!valueEqual(e,this.result.value)||!valueEqual(t,this.result.identifiers)},t.prototype.multiQuerySourceIds=function(){if(void 0===this.bodies)return[this.watcherId];for(var e=[],t=0;t<this.values.length;t++)void 0!==this.values[t]&&isTrue(this.values[t].value)&&e.push(this.bodies[t].watcherId);return e},t}(EvaluationMap);filter.classConstructor=EvaluationFilter;var EvaluationMultiQuery=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.funList=void 0,r.defuns=[],r.parameters=[],r.bodies=[],r.environments=[],r.lastFunOutput=void 0,r.queries=[],r.querySourceIds=[],r.simpleQueries=[],r.compiledQueries=[],r.compiledQueryArguments=[],r.firstQueryChanged=0,r.queryResults=[],r.argument=void 0,r.identifiers=void 0,r.dataSourceQuerySet=new Map,r.dataSourceChainEnd=void 0,r.result.value=constEmptyOS,r.dataSourceAware=!0,r.dataSourceResultMode=!0,r}return __extends(t,e),t.prototype.destroy=function(){"query"in this&&this.setDataSourceInput(void 0),linearMultiQuery&&void 0!==this.dataSourceChainEnd&&this.dataSourceChainEnd.removeResultReceiver(this),this.argument=void 0,this.clearFunctions(0),this.clearQueries(0),e.prototype.destroy.call(this)},t.prototype.addArgument=function(e,t){this.inputs[e]=t,t.isConstant()?0===e?this.setFunctionList(t.result):1===e?this.setArgument(t.result):Utilities.warn("too many arguments to multiQuery"):(this.constant=!1,t.addWatcher(this,e,!0,!0,!0))},t.prototype.updateInput=function(e,t){0===e?(this.setFunctionList(t),this.markAsChanged()):1===e?this.setArgument(t):e===-this.bodies.length?(this.lastFunOutput=t,this.firstQueryChanged=0,this.markAsChanged()):this.parameters.length>-e&&this.parameters[-e].set(t)},t.prototype.setFunctionList=function(e){var t=0,i=this.firstQueryChanged;if(void 0!==this.inputs[1]&&("dataSource"in this.inputs[1].result||"dataSource"in this.result)&&(this.inputs[1].isScheduled()||!this.inputs[1].isActive()))return void this.inputs[1].addForcedUpdate(this);if(void 0!==this.inputs[1]&&"dataSource"in this.inputs[1].result)return this.setDataSourceInput(this.inputs[1].result.dataSource),void this.markAsChanged();if(void 0!==this.dataSourceInput&&(this.setDataSourceQueryList([],[]),this.setDataSourceInput(void 0),this.markAsChanged()),this.funList=e.value,void 0===this.funList)return this.clearFunctions(0),this.clearQueries(0),void 0!==this.dataSourceInput&&(delete this.result.dataSource,this.setDataSourceQueryList([],[]),this.setDataSourceInput(void 0)),void this.markAsChanged();var r=0,n=this.inputs[1];for(t=0;t<this.funList.length;)if(this.funList[t]instanceof DefunReference){if(r===this.defuns.length||!this.defuns[r].isEqual(this.funList[t]))break;n=this.bodies[r],t++,r++}else t+=void 0!==e.compiledQuery&&void 0!==e.nrQueryElements[t]?e.nrQueryElements[t]:1;var o=r;for(this.clearFunctions(r);t<this.funList.length;)if(this.funList[t]instanceof DefunReference){var s=this.funList[t].defun;if(!s.environment.isValid())continue;var a=s.prototype,d=a.defunNr,u=a.localToArea,h=areaTemplates[u],l=h.defunFunctionNodes[d],c=[{node:n,position:void 0}],p=new LocalEvaluationEnvironment(s.environment,d,l.length,c);this.environments[r]=p,this.defuns[r]=this.funList[t];for(var f=0;f!==l.length;f++)buildEvaluationNode(l[f],p);this.parameters[r]=getEvaluationNode(a.parameterNodes[0],p),this.bodies[r]=getEvaluationNode(a.body,p),this.bodies[r].isConstant()?this.updateInput(-r-1,this.bodies[r].result):this.bodies[r].addWatcher(this,-r-1,!1,!1,!0),n=this.bodies[r],t++,r++}else t+=void 0!==e.compiledQuery&&void 0!==e.nrQueryElements[t]?e.nrQueryElements[t]:1;r!==o&&this.parameters[o].set(this.lastFunOutput);var v,g=[],m=new Array(this.queries.length+1);for(t=0;t<this.funList.length;)if(this.funList[t]instanceof DefunReference)t++;else{for(var y=void 0!==e.compiledQuery&&void 0!==e.nrQueryElements[t]?e.nrQueryElements[t]:1,I=1===y?this.funList[t]:this.funList.slice(t,y),v=0;v<this.queries.length&&!objectEqual(this.queries[v],I);v++);m[v]=g.length,g.push({dataRepr:I,compiledQueries:void 0!==e.compiledQuery?e.compiledQuery[t]:void 0,compiledQueryArguments:void 0!==e.compiledQuery?e.queryArguments[t]:void 0,newToOldPos:v}),t+=y}for(var t=0;t<this.queries.length&&t<i;t++){if(void 0===m[t]){i=t;break}g[m[t]].dataRepr=void 0}g.sort(function(e,t){return e.newToOldPos-t.newToOldPos}),this.clearQueries(i);for(var v=0;v<g.length;v++)void 0!==g[v].dataRepr&&(void 0!==e.compiledQuery&&(this.compiledQueries.push(g[v].compiledQueries),this.compiledQueryArguments.push(g[v].compiledQueryArguments)),this.queries.push(g[v].dataRepr),this.simpleQueries.push(makeSimpleQuery(g[v].dataRepr,void 0)));i<this.firstQueryChanged&&(this.firstQueryChanged=i),this.markAsChanged(),this.activateFuns()},t.prototype.clearFunctions=function(e){if(e!==this.bodies.length){if(void 0!==this.funList){this.nrActiveWatchers>0&&this.deactivateFuns(e);for(var t=e;t<this.bodies.length;t++)void 0!==this.bodies[t]&&this.bodies[t].removeWatcher(this,!1,!0),this.environments[t].unlink()}this.defuns.length=e,this.bodies.length=e,this.environments.length=e,this.parameters.length=e,this.lastFunOutput=0===e?this.argument:this.bodies[e-1].result,this.firstQueryChanged=0}},t.prototype.clearQueries=function(e){this.queries.length=e,this.simpleQueries.length=e,this.compiledQueries.length=e,this.compiledQueryArguments.length=e,this.queryResults.length=e},t.prototype.setDataSourceInput=function(e){this.dataSourceInput!==e&&(void 0!==this.dataSourceInput&&this.setDataSourceQueryList([],[]),this.dataSourceInput=e,linearMultiQuery&&void 0===this.dataSourceChainEnd&&(this.dataSourceChainEnd=e.applyDataQuery(_,this,DataSourceQueryByData._idForSelectionChain,this.watcherId)),this.markAsChanged())},t.prototype.setDataSourceQueryList=function(e,t){linearMultiQuery?(void 0===this.querySourceIdPosition&&(this.querySourceIdPosition=new Map,this.querySourceIdOrder=[]),this.setDataSourceQueryListInChain(e,t)):this.setDataSourceQueryListInTree(e,t)},t.prototype.setDataSourceQueryListInTree=function(e,t){for(var i=this,r=new Map,n=e.length-1;n>=0;n--){var o=e[n];o instanceof ComparisonFunctionValue&&(1===o.elements.length?o=o.elements[0]:(o.elements.length>1&&Utilities.warn("too many elements in c()"),o=void 0)),void 0===o||o instanceof DefunReference||r.has(t[n])||r.set(t[n],o)}this.dataSourceQuerySet.forEach(function(e,t){r.has(t)||(e.removeResultReceiver(i),i.dataSourceQuerySet.delete(t))}),this.dataSourceChainEnd=this.inputs[1].result.dataSource;for(var s=findMaxLenSrcIdPath(this.dataSourceChainEnd,r),n=0;n<s.length;n++){var a=s[n],d=this.dataSourceChainEnd.getQueryApplicationWithSourceId(a);this.dataSourceQuerySet.has(a)&&d===this.dataSourceQuerySet.get(a)?d.updateQuery(r.get(a)):(this.dataSourceQuerySet.has(a)&&this.dataSourceQuerySet.get(a).removeResultReceiver(this),d=this.dataSourceChainEnd.applyDataQuery(r.get(a),this,a),this.dataSourceQuerySet.set(a,d)),r.delete(a),this.dataSourceChainEnd=d}r.forEach(function(e,t){i.dataSourceQuerySet.has(t)&&i.dataSourceQuerySet.get(t).removeResultReceiver(i);var r=i.dataSourceChainEnd.applyDataQuery(e,i,t);i.dataSourceQuerySet.set(t,r),i.dataSourceChainEnd=r})},t.prototype.setDataSourceQueryListInChain=function(e,t){for(var i=this,r=[],n=[],o=new Map,s=[],a=0;a<e.length;a++){var d=e[a];if(d instanceof ComparisonFunctionValue&&(1===d.elements.length?d=d.elements[0]:(d.elements.length>1&&Utilities.warn("too many elements in c()"),d=void 0)),void 0!==d&&!(d instanceof DefunReference)){var u=t[a];o.set(u,d),this.querySourceIdPosition.has(u)?s.push({queryDS:this.dataSourceQuerySet.get(u),query:d}):r.push(u)}}this.querySourceIdPosition.forEach(function(e,t){o.has(t)||n.push(t)});for(var h=[],l=[];r.length>0&&n.length>0;){var c=r.pop(),p=n.pop(),f=this.dataSourceQuerySet.get(p);assert(f.ownerId===this.watcherId,"must own queryDS before altering it"),f.querySourceId===p?(f.updateQuery(o.get(c)),this.changeQuerySourceId(f,p,c)):f.querySourceId===c?this.changeQuerySourceId(f,p,c):(h.push(c),l.push(p))}if(r=r.concat(h),n=n.concat(l),n.length>0){for(var v=n.map(function(e){return i.querySourceIdPosition.get(e)}).sort(function(e,t){return e-t}),a=0;a<v.length;){var g=v[a],m=g+1;for(a++;a<v.length&&v[a]===m;)m++,a++;var y=g>0?this.dataSourceQuerySet.get(this.querySourceIdOrder[g-1]):this.dataSourceInput,I=m<this.querySourceIdOrder.length?this.dataSourceQuerySet.get(this.querySourceIdOrder[m]):this.dataSourceChainEnd;I.alreadyRegisteredOn(this,y)||I.moveToDataSource(this,y);for(var b=g;b<m;b++)this.querySourceIdOrder[b]=void 0}this.querySourceIdOrder=this.querySourceIdOrder.filter(function(e){return void 0!==e}),this.querySourceIdPosition.clear();for(var a=0;a<this.querySourceIdOrder.length;a++)this.querySourceIdPosition.set(this.querySourceIdOrder[a],a);for(var a=0;a<n.length;a++){var C=n[a],f=this.dataSourceQuerySet.get(C);this.dataSourceQuerySet.delete(C),f.removeResultReceiver(this)}}for(var S=this.querySourceIdOrder.length,R=0===S?this.dataSourceInput:this.dataSourceQuerySet.get(this.querySourceIdOrder[S-1]),a=0;a<r.length;a++){var c=r[a],f=R.applyDataQuery(o.get(c),this,c,this.watcherId);this.dataSourceQuerySet.set(c,f),this.querySourceIdPosition.set(c,S),this.querySourceIdOrder[S]=c,R=f,S++}for(var a=0;a<s.length;a++)assert(s[a].queryDS.ownerId===this.watcherId,"must own queryDS before altering it"),s[a].queryDS.updateQuery(s[a].query);void 0!==this.dataSourceChainEnd&&this.dataSourceChainEnd.moveToDataSource(this,R)},t.prototype.changeQuerySourceId=function(e,t,i){var r=this.querySourceIdPosition.get(t);this.dataSourceQuerySet.set(i,e),this.querySourceIdPosition.set(i,r),this.querySourceIdOrder[r]=i,this.dataSourceQuerySet.delete(t),this.querySourceIdPosition.delete(t),e.changeQuerySourceId(i)},t.prototype.newDataSourceResult=function(e){Utilities.error("should not be called")},t.prototype.reextractData=function(){assert(!1,"should not be called")},t.prototype.setArgument=function(e){this.argument=e,0!==this.parameters.length?this.parameters[0].set(e):!("dataSource"in e||"dataSource"in this.result)||!this.inputs[1].isScheduled()&&this.inputs[1].isActive()?"dataSource"in e?this.setDataSourceInput(e.dataSource):(void 0!==this.dataSourceInput&&this.setDataSourceInput(void 0),this.lastFunOutput=e,this.firstQueryChanged=0,this.markAsChanged()):this.inputs[1].addForcedUpdate(this)},t.prototype.activateInputs=function(){this.activateFuns(),e.prototype.activateInputs.call(this)},t.prototype.activateFuns=function(){if(void 0!==this.funList){0!==this.bodies.length&&this.parameters[0].set(this.argument);for(var e=0;e!==this.bodies.length;e++)this.bodies[e].activate(this,!0)}},t.prototype.deactivateInputs=function(){this.deactivateFuns(0),e.prototype.deactivateInputs.call(this)},t.prototype.deactivateFuns=function(e){if(void 0!==this.funList)for(var t=e;t!==this.bodies.length;t++)void 0!==this.bodies[t]&&this.bodies[t].deactivate(this,!0)},t.prototype.setDataSourceResultMode=function(e){},t.prototype.extractDataSourceResult=function(){return this.result.value=emptyDataSourceResult,Utilities.warn("TODO: IMPLEMENT"),!1},t.prototype.eval=function(){var e=!1,t=this.result.clone();if(void 0!==this.dataSourceInput)return this.setDataSourceQueryList(this.inputs[0].result.value,this.inputs[0].multiQuerySourceIds()),this.result.value=emptyDataSourceResult,this.result.dataSource!==this.dataSourceChainEnd&&(this.result.dataSource=this.dataSourceChainEnd,!0);if("dataSource"in this.result&&(delete this.result.dataSource,e=!0),void 0===this.lastFunOutput)return valueEqual(this.result.value,void 0)?e:(this.result.set(void 0),!0);var i,r=0===this.firstQueryChanged?this.lastFunOutput.value:this.queryResults[this.firstQueryChanged-1].value,n=0===this.firstQueryChanged?this.lastFunOutput.identifiers:this.queryResults[this.firstQueryChanged-1].identifiers;if(void 0!==r)for(var o=this.firstQueryChanged;o<this.queries.length;o++){if(void 0!==this.simpleQueries[o]&&(void 0===this.compiledQueries[o]||this.simpleQueries[o].canCache()&&r.length>30))if(void 0!==n&&(i=n,n=[]),this.simpleQueries[o].canCache()){var s=0===o?this.lastFunOutput:this.queryResults[o-1];r=this.simpleQueries[o].executeAndCache(s,n,void 0)}else r=this.simpleQueries[o].execute(r,i,n,void 0,void 0);else void 0!==n?(i=n,n=[],r=void 0!==this.compiledQueries[o]?this.compiledQueries[o](r,this.compiledQueryArguments[o],i,n):interpretedQueryWithIdentifiers(this.queries[o],r,i,n)):r=void 0!==this.compiledQueries[o]?this.compiledQueries[o](r,this.compiledQueryArguments[o]):interpretedQuery(this.queries[o],r);this.queryResults[o]=new Result(r),this.queryResults[o].identifiers=n}return this.result.value=r,void 0!==n?this.result.identifiers=n:delete this.result.identifiers,"dataSource"in this.lastFunOutput?this.result.dataSource=this.lastFunOutput.dataSource:delete this.result.dataSource,this.firstQueryChanged=this.queries.length,e||!t.isEqual(this.result)},t.prototype.specificExplanation=function(t,i,r){if(void 0===r&&(r=!1),e.prototype.specificExplanation.call(this,t,i),void 0!==this.bodies){for(var n={},o=0;o<this.bodies.length;o++)n[o+": "+this.bodies[o].debugName()]=this.bodies[o].explain(void 0);t._bodies=n}return t},t.prototype.allInputs=function(){return void 0!==this.bodies?this.inputs.concat(this.bodies):this.inputs},t}(EvaluationFunctionApplication);multiQuery.classConstructor=EvaluationMultiQuery;var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),EvaluationClassRegisteringFunction=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.registrationChanges=void 0,r.className=void 0,r.newClassName=void 0,r.resultChanged=!1,r.added=void 0,r.removed=void 0,r.elementRefs={},r.areaIdToPos={},r.areaIdInResult={},r.watchedExpressions={},r.inputNotReady=!1,r.constant=!1,r.result.incremental=!1,r.result.added=[],r.result.removed=[],r.result.value=[],r}return __extends(t,e),t.prototype.destroy=function(){this.unregisterAllMembership(),e.prototype.destroy.call(this)},t.prototype.setNewClassName=function(e){this.newClassName=e,typeof this.newClassName in{string:!0,number:!0,boolean:!0}||(this.newClassName=void 0),this.className!==this.newClassName&&this.markAsChanged()},t.prototype.updateAreaInput=function(e,t){void 0===t?(this.removeAreaFromResult(e),this.unregisterMembership(e)):isTrueValue(t.value)?this.addAreaToResult(e):this.removeAreaFromResult(e),this.markAsChanged()},t.prototype.incrementalAreaSetUpdate=function(e){var t,i=!1;void 0===this.registrationChanges&&(this.registrationChanges={});for(var r=0;r<e.removed.length;r++)t=e.removed[r],t in this.registrationChanges?this.registrationChanges[t]&&delete this.registrationChanges[t]:t in this.elementRefs&&(this.nrActiveWatchers>0?this.registrationChanges[t]=!1:(this.removeAreaFromResult(t),this.unregisterMembership(t)),i=!0);for(var r=0;r<e.added.length;r++)t=e.added[r],t in this.registrationChanges?this.registrationChanges[t]||delete this.registrationChanges[t]:t in this.elementRefs||(this.registrationChanges[t]=!0,i=!0);i&&this.markAsChanged()},t.prototype.nonincrementalAreaSetUpdate=function(e){var t,i=!1,r={};if(void 0===this.registrationChanges&&(this.registrationChanges={}),void 0!==e&&void 0!==e.value)for(var n=0;n<e.value.length;n++){var o=e.value[n];o instanceof ElementReference&&(r[o.element]=!0)}for(t in this.elementRefs)t in r||(this.nrActiveWatchers>0?this.registrationChanges[t]=!1:(this.removeAreaFromResult(t),this.unregisterMembership(t)),i=!0);for(t in r)t in this.elementRefs||(this.registrationChanges[t]=!0,i=!0);this.orderChange(e)&&(i=!0),i&&this.markAsChanged()},t.prototype.orderChange=function(e){var t=!1;if(void 0!==e&&void 0!==e.value)for(var i=0;i<e.value.length;i++){var r=e.value[i];r instanceof ElementReference&&this.areaIdToPos[r.element]!==i&&(this.areaIdToPos[r.element]=i,this.resultChanged=!0,t=!0)}return t},t.prototype.eval=function(){if(this.inputNotReady=!1,this.handleRegistrationChanges(),!this.inputNotReady){var e=this.added,t=this.removed;if(this.added=void 0,this.removed=void 0,this.result.incremental=!0,this.result.added.length=0,this.result.removed.length=0,this.resultChanged){var i=this.getResult();if(this.resultChanged=!1,!objectEqual(this.result.value,i)){this.result.value=i;for(var r in e)this.result.added.push(e[r]);for(var r in t)this.result.removed.push(t[r]);return!0}}return!1}},t.prototype.handleRegistrationChanges=function(){if(this.className!==this.newClassName)this.unregisterAllMembership(),this.className=this.newClassName,this.registerAllMembership();else if(void 0!==this.registrationChanges)for(var e in this.registrationChanges)this.registrationChanges[e]?(assert(!(e in this.elementRefs),"admin error?"),this.registerArea(e)):e in this.elementRefs&&(this.removeAreaFromResult(e),this.unregisterMembership(e));this.registrationChanges=void 0},t.prototype.deactivateInputs=function(){e.prototype.deactivateInputs.call(this);for(var t in this.registrationChanges)this.registrationChanges[t]===!1&&t in this.watchedExpressions&&(this.removeAreaFromResult(t),
this.unregisterMembership(t),delete this.registrationChanges[t])},t.prototype.registerArea=function(e){var t=this.registerMembership(e);void 0!==t&&this.addAreaToResult(e)},t.prototype.getResult=function(){var e=this,t=[];for(var i in this.areaIdInResult)t.push(this.areaIdInResult[i]);return t.sort(function(t,i){return e.areaIdToPos[t.element]-e.areaIdToPos[i.element]})},t.prototype.addAreaToResult=function(e){e in this.areaIdInResult||(this.areaIdInResult[e]=this.elementRefs[e],void 0===this.added&&(this.added={}),this.added[e]=this.elementRefs[e],void 0!==this.removed&&e in this.removed&&(delete this.removed[e],void 0!==this.registrationChanges&&delete this.registrationChanges[e]),this.resultChanged=!0)},t.prototype.removeAreaFromResult=function(e){e in this.areaIdInResult&&(delete this.areaIdInResult[e],void 0===this.removed&&(this.removed={}),this.removed[e]=this.elementRefs[e],void 0!==this.added&&e in this.added&&(delete this.added[e],void 0!==this.registrationChanges&&delete this.registrationChanges[e]),this.resultChanged=!0)},t.prototype.registerMembership=function(e){var t=allAreaMonitor.getAreaById(e);if(void 0!==t&&(this.elementRefs[t.areaId]=t.areaReference,void 0!==t.exports)){var i=t.getExport(0);if(void 0!==i){var r=i.inputByAttr[this.className];if(void 0!==r)return r.addWatcher(this,e,!1,!1,!1),r.activate(this,!1),this.watchedExpressions[e]=r,r.isScheduled()&&(this.inputNotReady=!0),void 0!==this.combinedInputs&&this.combinedInputs.push(r),isTrueValue(r.result.value)?t:void 0}}},t.prototype.unregisterMembership=function(e){if(delete this.elementRefs[e],delete this.areaIdToPos[e],e in this.watchedExpressions){var t=this.watchedExpressions[e];t.removeWatcherForPos(this,e,!1,!1),t.deactivate(this,!1),delete this.watchedExpressions[e],void 0!==this.combinedInputs&&(this.combinedInputs=void 0)}},t.prototype.registerAllMembership=function(){assert(!1,"implement in derived class 9")},t.prototype.unregisterAllMembership=function(){for(var e in this.watchedExpressions)this.unregisterMembership(e)},t.prototype.allInputs=function(){if(void 0===this.combinedInputs){var e=this.inputs.slice(0);for(var t in this.watchedExpressions)e.push(this.watchedExpressions[t]);this.combinedInputs=e}return this.combinedInputs},t}(EvaluationFunctionApplication),EvaluationAreaOfClass=function(e){function t(t,i){var r=e.call(this,t,i)||this;return allAreaMonitor.addWatcher(r,void 0),r.result.value=constEmptyOS,r}return __extends(t,e),t.prototype.destroy=function(){allAreaMonitor.removeWatcher(this,!1),e.prototype.destroy.call(this)},t.prototype.updateInput=function(e,t){0===e?this.setNewClassName(singleton(t.value)):void 0===e?void 0!==this.className&&this.incrementalAreaSetUpdate(t):this.updateAreaInput(e,t)},t.prototype.activateInputs=function(){e.prototype.activateInputs.call(this),void 0!==this.inputs[0]&&(this.inputs[0].isScheduled()?this.inputs[0].addForcedUpdate(this):this.inputs[0].isConstant()||this.updateInput(0,this.inputs[0].result))},t.prototype.debugName=function(){return"areaOfClass"},t.prototype.registerAllMembership=function(){for(var e in allAreaMonitor.allAreas)this.registerArea(e)},t.prototype.reasonForBeingEmpty=function(e){if(void 0===e&&(e=!0),!(void 0!==this.result.value&&this.result.value.length>0))return"there is no area of class "+this.className},t}(EvaluationClassRegisteringFunction);areaOfClass.classConstructor=EvaluationAreaOfClass;var EvaluationFilterAreaByClass=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.updateInput=function(e,t){0===e?this.setNewClassName(singleton(t.value)):1===e?this.nonincrementalAreaSetUpdate(t):this.updateAreaInput(e,t)},t.prototype.debugName=function(){return"internalFilterAreaByClass"},t.prototype.activateInputs=function(){e.prototype.activateInputs.call(this),void 0!==this.inputs[0]&&(this.inputs[0].isScheduled()?this.inputs[0].addForcedUpdate(this):this.inputs[0].isConstant()||this.updateAreaInput(0,this.inputs[0].result)),void 0!==this.inputs[1]&&(this.inputs[1].isScheduled()?this.inputs[1].addForcedUpdate(this):this.inputs[1].isConstant()||this.updateInput(1,this.inputs[1].result))},t.prototype.registerAllMembership=function(){var e=this.inputs[1].result.value;if(void 0!==e)for(var t=0;t<e.length;t++){var i=e[t];i instanceof ElementReference&&this.registerArea(i.element)}},t.prototype.reasonForBeingEmpty=function(e){if(void 0===e&&(e=!0),!(void 0!==this.result.value&&this.result.value.length>0))return"there is no area of class "+this.className},t}(EvaluationClassRegisteringFunction);internalFilterAreaByClass.classConstructor=EvaluationFilterAreaByClass;var EvaluationFilterAreaByClassName=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.debugName=function(){return"internalFilterAreaByClassName"},t.prototype.orderChange=function(e){return!1},t.prototype.eval=function(){if(this.handleRegistrationChanges(),this.resultChanged){this.resultChanged=!1;var e=Utilities.isEmptyObj(this.areaIdInResult)?constEmptyOS:[this.className];if(!objectEqual(this.result.value,e))return this.result.value=e,!0}return!1},t}(EvaluationFilterAreaByClass);internalFilterAreaByClassName.classConstructor=EvaluationFilterAreaByClassName;var EvaluationAreaProjection=function(e){function t(t,i,r){var n=e.call(this,t,r)||this;return n.watchedProducers={},n.activeProducers={},n.producerPos={},n.values=[],n.inputAreas=constEmptyOS,n.destroyedAreas=new Map,n.externalDataSourceResultMode=!0,n.exportId=i,n.result.value=constEmptyOS,n.dataSourceAware=!0,n.dataSourceResultMode=!0,n}return __extends(t,e),t.prototype.destroy=function(){this.isActive()&&0!==this.destroyedAreas.size&&allAreaMonitor.removeWatcher(this,!1),e.prototype.destroy.call(this)},t.prototype.setData=function(e){this.inputs=[e],e.isConstant()?this.setAreas(e.result.value):e.addWatcher(this,void 0,!0,!0,!1)},t.prototype.removeAsWatcher=function(){var e=this.inputs[0];for(var t in this.watchedProducers){var i=this.watchedProducers[t];i.removeWatcher(this,!1,this.dataSourceResultMode),i instanceof EvaluationNode&&t in this.activeProducers&&i!==e&&i.deactivate(this,this.dataSourceResultMode)}e.removeWatcher(this,!1,!1),this.isActive()&&e.deactivate(this,!1),this.activeProducers=void 0,this.watchedProducers=void 0,this.producerPos=void 0,this.values=void 0,this.inputs=void 0},t.prototype.updateInput=function(e,t){if(void 0===e)void 0===t?(this.setAreas(constEmptyOS),this.inputs[0].removeWatcherForPos(this,e,!0,!1),this.inputs[0]=void 0):this.nrActiveWatchers>0&&this.setAreas(t.value)&&this.markAsChanged();else if(""===e){if(void 0!==t.added)for(var i=0;i<t.added.length;i++){var r=t.added[i];this.destroyedAreas.has(r)&&(this.registerArea(r,this.destroyedAreas.get(r)),this.destroyedAreas.delete(r),0===this.destroyedAreas.size&&allAreaMonitor.removeWatcher(this,!1))}}else if(void 0!==this.producerPos){var n=this.producerPos[e];if(void 0===t){var o=this.watchedProducers[e];if(this.nrActiveWatchers>0){0===this.destroyedAreas.size&&allAreaMonitor.addWatcher(this,"",!1);var r=o instanceof EvaluationNode?this.activeProducers[e]:o.areaId;this.destroyedAreas.set(r,this.producerPos[e])}e in this.activeProducers&&(delete this.activeProducers[e],o instanceof EvaluationNode&&o.deactivate(this,this.dataSourceResultMode)),o.removeWatcherForPos(this,e,!1,this.dataSourceResultMode),delete this.watchedProducers[e],delete this.producerPos[e]}this.values[n]=t,this.markAsChanged()}},t.prototype.isConstant=function(){return!1},t.prototype.eval=function(){var e=this.result.value,t=this.result.getLabels();if(0===this.values.length)this.result.set([]);else if(1===this.values.length)void 0!==this.values[0]&&void 0!==this.values[0].value?this.result.copy(this.values[0]):this.result.set(constEmptyOS);else{for(var i=void 0,r=void 0,n=void 0,o=void 0,s=[],a=0;a!==this.values.length;a++)if(void 0!==this.values[a]){var d=this.values[a].value;if(void 0!==d&&0!==d.length&&(1!==d.length||void 0!==d[0])){if(void 0!==this.values[a].compiledQuery)void 0===r&&(r=new Array(s.length),n=new Array(s.length),o=new Array(s.length)),Array.prototype.push.apply(r,this.values[a].compiledQuery),Array.prototype.push.apply(n,this.values[a].queryArguments),Array.prototype.push.apply(o,this.values[a].nrQueryElements);else if(void 0!==r){var u=this.values[a].value.length;r.length+=u,n.length+=u,o.length+=u}if(void 0!==this.values[a].identifiers){if(void 0===i){i=[];for(var h=0;h!==a;h++)Array.prototype.push.apply(i,this.values[h].getIdentifiers())}Array.prototype.push.apply(i,this.values[a].identifiers)}else void 0!==i&&Array.prototype.push.apply(i,this.values[a].getIdentifiers());Array.prototype.push.apply(s,d)}}this.result.value=s,this.result.resetLabels(),void 0!==i&&(this.result.identifiers=i),void 0!==r&&(this.result.compiledQuery=r,this.result.queryArguments=n,this.result.nrQueryElements=o)}return!this.result.equalLabels(t)||!valueEqual(e,this.result.value)},t.prototype.setAreas=function(e){var t=!1,i=!1,r={};void 0===e?e=[]:e instanceof Array||(e=[e]),0!==this.destroyedAreas.size&&(allAreaMonitor.removeWatcher(this,!1),this.destroyedAreas.clear()),this.inputAreas=e,this.values.length=e.length,this.internalSetDataSourceResultMode(this.externalDataSourceResultMode&&e.length<=1);for(var n=0;n!==e.length;n++){assert(e[n]instanceof ElementReference,"should be");var o=e[n],s=allAreaMonitor.getAreaById(o.element);if(void 0!==s&&void 0!==s.exports&&this.exportId in s.exports){var a=s.getExport(this.exportId),d=s.areaId+"#"+a.watcherId;if(r[d]=!0,this.producerPos[d]!==n&&(this.producerPos[d]=n,t=!0),!(d in this.watchedProducers)){var u=a.isConstant()?s:a;this.watchedProducers[d]=u,u.addWatcher(this,d,!1,!1,this.dataSourceResultMode),t=!0}if(this.nrActiveWatchers>0&&!a.isConstant()&&!(d in this.activeProducers)){if(a.activate(this,this.dataSourceResultMode),void 0===this.activeProducers)return!1;this.activeProducers[d]=s.areaId,a.isScheduled()&&(i=!0,a.forceUpdate(this,!1)),t=!0}this.values[n]=a.result}else void 0!==s||this.destroyedAreas.has(o.element)||(this.nrActiveWatchers>0&&0===this.destroyedAreas.size&&allAreaMonitor.addWatcher(this,"",!1),this.destroyedAreas.set(o.element,n)),this.values[n]=void 0}for(var h in this.watchedProducers)if(!(h in r)){var u=this.watchedProducers[h];delete this.watchedProducers[h],delete this.producerPos[h],u.removeWatcherForPos(this,h,!1,this.dataSourceResultMode),h in this.activeProducers&&(delete this.activeProducers[h],u instanceof EvaluationNode&&u.deactivate(this,this.dataSourceResultMode)),t=!0}return(i||t)&&"combinedInputs"in this&&(this.combinedInputs=void 0),t&&!i},t.prototype.registerArea=function(e,t){var i=allAreaMonitor.getAreaById(e),r=!1;if(void 0!==i&&void 0!==i.exports&&this.exportId in i.exports){var n=i.getExport(this.exportId),o=i.areaId+"#"+n.watcherId;if(this.producerPos[o]!==t&&(this.producerPos[o]=t,r=!0),!(o in this.watchedProducers)){var s=n.isConstant()?i:n;this.watchedProducers[o]=s,s.addWatcher(this,o,!1,!1,this.dataSourceResultMode),r=!0}if(this.nrActiveWatchers>0&&!n.isConstant()&&!(o in this.activeProducers)){if(n.activate(this,this.dataSourceResultMode),void 0===this.activeProducers)return;this.activeProducers[o]=i.areaId,n.isScheduled()&&n.forceUpdate(this,!1),r=!0}this.values[t]=n.result}else this.values[t]=void 0;r&&this.markAsChanged()},t.prototype.setDataSourceResultMode=function(e){this.externalDataSourceResultMode=e,this.internalSetDataSourceResultMode(e&&this.inputAreas.length<=1)},t.prototype.internalSetDataSourceResultMode=function(e){if(e&&!this.dataSourceResultMode){for(var t in this.activeProducers){var i=this.watchedProducers[t];i instanceof EvaluationNode&&i.activeWatcherBecomesDataSourceAware(this)}this.isActive()&&this.markAsChanged()}else if(!e&&this.dataSourceResultMode){for(var t in this.activeProducers){var i=this.watchedProducers[t];i instanceof EvaluationNode&&i.activeWatcherNoLongerIsDataSourceAware(this)}this.isActive()&&this.markAsChanged()}this.dataSourceResultMode=e},t.prototype.activateInputs=function(){void 0!==this.inputs[0]&&(this.inputs[0].activate(this,!1),this.inputs[0].isScheduled()?this.inputs[0].forceUpdate(this,!1):this.setAreas(this.inputs[0].result.value)&&this.markAsChanged())},t.prototype.deactivateInputs=function(){if(void 0!==this.inputs&&void 0!==this.inputs[0]&&this.inputs[0].deactivate(this,!1),void 0!==this.watchedProducers){for(var e in this.activeProducers){var t=this.watchedProducers[e];t instanceof EvaluationNode&&t.deactivate(this,this.dataSourceResultMode)}this.activeProducers={}}0!==this.destroyedAreas.size&&(allAreaMonitor.removeWatcher(this,!1),this.destroyedAreas.clear())},t.prototype.write=function(e,t,i,r){var n,o,s,a,d,u=void 0!==this.inputs[0]&&this.inputs[0].result.value,h=0;if(void 0===u?u=[]:u instanceof Array||(u=[u]),void 0===r)for(d=0;d!==u.length;d++)assert(u[d]instanceof ElementReference,"should be"),n=u[d],o=allAreaMonitor.getAreaById(n.element),s=o.getExport(this.exportId),void 0!==s&&(a=[new DataPosition(0,this.values[d].size())],s.write(e,t,i,a));else{var l=0;for(d=0;d<u.length&&h<r.length;){var c=this.values[d].value,p=void 0===c?0:c.length;if(l<=r[h].index&&(0===p||r[h].index<l+p)){for(assert(u[d]instanceof ElementReference,"areaData must be array of ElementReference"),n=u[d],o=allAreaMonitor.getAreaById(n.element),s=o.getExport(this.exportId),assert(void 0!==s,"if result is defined, exportNode must be too"),a=[];h<r.length&&(0===p||r[h].index<l+p);){var f=r[h];a.push(f.copyWithOffset(l)),h++}s.write(e,t,i,a)}1===p&&void 0===c[0]||(l+=p),d++}}},t.prototype.allInputs=function(){if(void 0===this.combinedInputs){var e=this.inputs.slice(0);for(var t in this.activeProducers){var i=this.watchedProducers[t];i instanceof EvaluationNode&&e.push(i)}this.combinedInputs=e}return this.combinedInputs},t.prototype.allLogInputs=function(){var e=this.inputs.slice(0);for(var t in this.watchedProducers){var i=this.watchedProducers[t];i instanceof EvaluationNode&&e.push(i)}return e},t.prototype.debugName=function(){return"areaProjection "+(0===this.exportId?"class":exportPaths[this.exportId].join("."))},t.prototype.toFullString=function(){var e="[proj, "+exportPaths[this.exportId].join(".")+", "+this.inputs.map(function(e){return e.toFullString()}).join(", ")+"]";if(t.fuller){var i=[];for(var r in this.producerPos){var n=this.watchedProducers[r];n instanceof EvaluationNode?i[this.producerPos[r]]="@"+this.activeProducers[r]+":"+n.toFullString():i[this.producerPos[r]]="@"+this.activeProducers[r]+":const"}e+=" = o("+i.join(", ")+")"}return e+=" = "+cdlifyLim(this.result.value,80)},t.prototype.multiQuerySourceIds=function(){var e=[];for(var t in this.producerPos){var i=this.producerPos[t];if(void 0!==this.values[i].value&&!(this.values[i].value instanceof Array&&0===this.values[i].value.length)){var r=this.watchedProducers[t];r instanceof EvaluationNode&&(e[i]=r.multiQuerySourceIds())}}return e.reduce(function(e,t){return void 0===t?e:cconcat(e,t)},[])},t.prototype.specificExplanation=function(t,i,r){void 0===r&&(r=!1),e.prototype.specificExplanation.call(this,t,i,!0),t.watchedAreas={},t["areas: "+this.inputs[0].debugName()]=this.inputs[0].explain(void 0);for(var n in this.watchedProducers){var o=this.watchedProducers[n],s=n.substr(0,n.lastIndexOf("#"));o instanceof EvaluationNode?t.watchedAreas[s+": "+o.debugName()]=o.explain(void 0):t.watchedAreas[s]="<<unknown producer>>"}return t},t}(EvaluationNode);EvaluationAreaProjection.fuller=!1;var EvaluationClassOfArea=function(e){function t(t,i){var r=e.call(this,t,0,i)||this;return r.result.value=constEmptyOS,r}return __extends(t,e),t.prototype.setAreas=function(t){return this.areaData=t,e.prototype.setAreas.call(this,t)},t.prototype.eval=function(){for(var e=this.result.value,t={},i=[],r=0;r<this.values.length;r++)if(void 0!==this.values[r]){var n=getDeOSedValue(this.values[r].value),o=allAreaMonitor.getAreaById(this.areaData[r].getElement());for(var s in n)s in t||!isTrue(n[s])||(t[s]=!0,i.push({className:s,prio:o.template.classNamePrio[s]}))}return this.result.value=i.sort(function(e,t){return e.prio-t.prio}).map(function(e){return e.className}),!valueEqual(e,this.result.value)},t.prototype.write=function(e,t,i,r){Utilities.warn("dead-ended write: cannot write through classOfArea at "+gWriteAction)},t}(EvaluationAreaProjection),EvaluationAreaSelection=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.watchedProducers={},r.activeProducers={},r.producerPos={},r.values=[],r.inputAreas=[],r.destroyedAreas=new Map,r.exportId=t.exportId,r.positive=t.select.positive,r.result.value=constEmptyOS,r}return __extends(t,e),t.prototype.destroy=function(){this.isActive()&&0!==this.destroyedAreas.size&&allAreaMonitor.removeWatcher(this,!1),e.prototype.destroy.call(this)},t.prototype.setSelectionAndData=function(e,t){this.inputs=[e,t],void 0!==e?(e.isConstant()||e.addWatcher(this,"selection",!1,!0,!1),this.setSelection(e.result.value,e.result.identifiers)):this.setSelection(_,void 0),t.isConstant()?this.setAreas(t.result.value):t.addWatcher(this,"data",!0,!0,!1)},t.prototype.removeAsWatcher=function(){var t=this.inputs[0],i=this.inputs[1];e.prototype.removeAsWatcher.call(this);for(var r in this.watchedProducers){var n=this.watchedProducers[r];n.removeWatcher(this,!1,!1),n instanceof EvaluationNode&&r in this.activeProducers&&n!==t&&n!==i&&n.deactivate(this,!1)}this.activeProducers=void 0,this.watchedProducers=void 0,this.producerPos=void 0,this.values=void 0},t.prototype.isConstant=function(){return!1},t.prototype.updateInput=function(e,t){if("data"===e)void 0===t?(this.setAreas(constEmptyOS),this.inputs[1].removeWatcherForPos(this,e,!0,!1),this.inputs[1]=void 0):this.nrActiveWatchers>0&&this.setAreas(t.value)&&this.markAsChanged();else if("selection"===e)void 0===t&&(this.inputs[0].removeWatcherForPos(this,e,!0,!1),this.inputs[0]=void 0),this.setSelection(t.value,t.identifiers);else if(""===e){if(void 0!==t.added)for(var i=0;i<t.added.length;i++){var r=t.added[i];this.destroyedAreas.has(r)&&(this.registerArea(r,this.destroyedAreas.get(r)),this.destroyedAreas.delete(r),0===this.destroyedAreas.size&&allAreaMonitor.removeWatcher(this,!1))}}else{var n=this.producerPos[e];void 0===t?this.markAreaDestroyed(e,n):this.values[n]=t.value,this.markAsChanged()}},t.prototype.markAreaDestroyed=function(e,t){var i=this.watchedProducers[e];if(this.nrActiveWatchers>0){0===this.destroyedAreas.size&&allAreaMonitor.addWatcher(this,"",!1);var r=i instanceof EvaluationNode?this.activeProducers[e]:i.areaId;this.destroyedAreas.set(r,this.producerPos[e])}e in this.activeProducers&&(delete this.activeProducers[e],i instanceof EvaluationNode&&i.deactivate(this,!1)),i.removeWatcherForPos(this,e,!1,!1),delete this.watchedProducers[e],delete this.producerPos[e],this.values[t]=void 0},t.prototype.eval=function(){var e=this.result.value;if(this.result.value=[],void 0!==this.selectionQuery)for(var t=0;t!==this.values.length;t++){var i=this.values[t];this.matches(i)&&this.result.value.push(this.inputAreas[t])}return!valueEqual(e,this.result.value)},t.prototype.setSelection=function(e,t){objectEqual(this.selectionValue,e)||(this.selectionValue=e,this.selectionQuery=makeSimpleQueryDefault(e,t),this.markAsChanged())},t.prototype.setAreas=function(e){var t=!1,i=!1,r={};void 0===e&&(e=[]),0!==this.destroyedAreas.size&&(allAreaMonitor.removeWatcher(this,!1),this.destroyedAreas.clear()),this.values.length=e.length,this.inputAreas.length=e.length;for(var n=0;n!==e.length;n++){assert(e[n]instanceof ElementReference,"should be");var o=e[n],s=allAreaMonitor.getAreaById(o.element);if(void 0!==s)if(this.inputAreas[n]=s.areaReference,void 0!==s.exports&&this.exportId in s.exports){var a=s.getExport(this.exportId),d=s.areaId+"#"+a.watcherId;if(r[d]=!0,this.producerPos[d]!==n&&(this.producerPos[d]=n,t=!0),!(d in this.watchedProducers)){var u=a.isConstant()?s:a;this.watchedProducers[d]=u,u.addWatcher(this,d,!1,!1,!1),t=!0}if(this.nrActiveWatchers>0&&!a.isConstant()&&!(d in this.activeProducers)){if(a.activate(this,!1),void 0===this.activeProducers)return!1;this.activeProducers[d]=s.areaId,a.isScheduled()&&(i=!0,a.forceUpdate(this,!1)),t=!0}this.values[n]=a.result.value}else this.values[n]=void 0;else this.destroyedAreas.has(o.element)||(this.nrActiveWatchers>0&&0===this.destroyedAreas.size&&allAreaMonitor.addWatcher(this,"",!1),this.destroyedAreas.set(o.element,n))}for(var h in this.watchedProducers)if(!(h in r)){var u=this.watchedProducers[h];delete this.watchedProducers[h],delete this.producerPos[h],u.removeWatcherForPos(this,h,!1,!1),h in this.activeProducers&&(delete this.activeProducers[h],u instanceof EvaluationNode&&u.deactivate(this,!1)),t=!0}return(i||t)&&"combinedInputs"in this&&(this.combinedInputs=void 0),t&&!i},t.prototype.registerArea=function(e,t){var i=allAreaMonitor.getAreaById(e),r=!1;if(void 0!==i)if(this.inputAreas[t]=i.areaReference,void 0!==i.exports&&this.exportId in i.exports){var n=i.getExport(this.exportId),o=i.areaId+"#"+n.watcherId;if(this.producerPos[o]!==t&&(this.producerPos[o]=t,r=!0),!(o in this.watchedProducers)){var s=n.isConstant()?i:n;this.watchedProducers[o]=s,s.addWatcher(this,o,!1,!1,!1),r=!0}if(this.nrActiveWatchers>0&&!n.isConstant()&&!(o in this.activeProducers)){if(n.activate(this,!1),void 0===this.activeProducers)return;this.activeProducers[o]=i.areaId,n.isScheduled()&&n.forceUpdate(this,!1),r=!0}this.values[t]=n.result.value}else this.values[t]=void 0;r&&this.markAsChanged()},t.prototype.activateInputs=function(){void 0!==this.inputs[0]&&void 0!==this.inputs[1]&&(e.prototype.activateInputs.call(this),this.setSelection(this.inputs[0].result.value,this.inputs[0].result.identifiers),this.inputs[1].isScheduled()?this.inputs[1].forceUpdate(this,!1):this.setAreas(this.inputs[1].result.value)&&this.markAsChanged())},t.prototype.deactivateInputs=function(){if(e.prototype.deactivateInputs.call(this),0!==this.destroyedAreas.size&&(allAreaMonitor.removeWatcher(this,!1),this.destroyedAreas.clear()),void 0!==this.watchedProducers){for(var t in this.activeProducers){var i=this.watchedProducers[t];i instanceof EvaluationNode&&i.deactivate(this,!1)}this.activeProducers={}}},t.prototype.matches=function(e){var t=void 0!==e&&this.selectionQuery.testOS(e);return this.positive?t:!t},t.prototype.allInputs=function(){if(void 0===this.combinedInputs){var e=this.inputs.slice(0);for(var t in this.activeProducers){var i=this.watchedProducers[t];i instanceof EvaluationNode&&e.push(i)}this.combinedInputs=e}return this.combinedInputs},t.prototype.allLogInputs=function(){var e=this.inputs.slice(0);for(var t in this.watchedProducers){var i=this.watchedProducers[t];i instanceof EvaluationNode&&e.push(i)}return e},t.prototype.debugName=function(){return"areaSelection "+exportPaths[this.exportId].join(".")+" = "+JSON.stringify(this.selectionValue)},t.prototype.reasonForBeingEmpty=function(e){if(void 0===e&&(e=!0),!(void 0!==this.result.value&&this.result.value.length>0)){if(0===this.values.length){var t=this.inputs[1].reasonForBeingEmpty(!0);return void 0===t?"the area os is empty":t}return"no area in "+cdlify(this.inputs[1].result.value)+" matched {"+exportPaths[this.exportId].join(".")+": "+cdlify(this.inputs[0].result.value)+"}"}},t.prototype.specificExplanation=function(t,i,r){void 0===r&&(r=!1),e.prototype.specificExplanation.call(this,t,i,!0),t.watchedAreas={},t["selection: "+this.inputs[0].debugName()]=this.inputs[0].explain(void 0),t["areas: "+this.inputs[1].debugName()]=this.inputs[1].explain(void 0);for(var n in this.watchedProducers){var o=this.watchedProducers[n],s=n.substr(0,n.lastIndexOf("#"));o instanceof EvaluationNode?t.watchedAreas[s+": "+o.debugName()]=o.explain(void 0):t.watchedAreas[s]="<<unknown producer>>"}return t},t}(EvaluationNode),EvaluationChildAreas=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.watchedAreas={},r.areaPos={},r.values=[],r.inputAreas=[],r.childName=t.childName,r.result.value=constEmptyOS,r}return __extends(t,e),t.prototype.setData=function(e){this.inputs=[e],e.isConstant()?this.setAreas(e.result.value):(e.addWatcher(this,"data",!0,!0,!1),this.result.value=[])},t.prototype.destroy=function(){for(var t in this.watchedAreas)this.watchedAreas[t].removeChildAreaWatcher(this.childName,this);e.prototype.destroy.call(this)},t.prototype.updateInput=function(e,t){if("data"===e){if(!this.setAreas(t.value))return}else if(void 0!==t){var i=this.areaPos[e];this.values[i]=t.value}else{var i=this.areaPos[e];delete this.areaPos[e],this.values.splice(i,1),delete this.watchedAreas[e],removeFromPosList(i,this.inputAreas,this.areaPos)}this.markAsChanged()},t.prototype.eval=function(){for(var e=this.result.value,t=[],i=0;i!==this.values.length;i++){var r=this.values[i];void 0!==r&&0!==r.length&&(t=cconcat(t,r))}return this.result.value=t,!valueEqual(e,this.result.value)},t.prototype.activateInputs=function(){void 0!==this.inputs[0]&&(this.inputs[0].activate(this,!1),this.inputs[0].isScheduled()?this.inputs[0].forceUpdate(this,!1):this.setAreas(this.inputs[0].result.value)&&this.markAsChanged())},t.prototype.deactivateInputs=function(){e.prototype.deactivateInputs.call(this)},t.prototype.setAreas=function(e){var t={},i=!1;void 0===e&&(e=constEmptyOS),this.areaPos={},this.values.length!==e.length&&(i=!0),this.values.length=e.length,this.inputAreas.length=e.length;for(var r=0;r!==e.length;r++){assert(e[r]instanceof ElementReference,"should be");var n=e[r],o=allAreaMonitor.getAreaById(n.element);if(void 0!==o){var s=o.getChildAreas(this.childName),a=void 0!==s?s.value:void 0;t[o.areaId]=!0,this.areaPos[o.areaId]=r,this.inputAreas[r]=o.areaId,valueEqual(this.values[r],a)||(this.values[r]=a,i=!0),o.areaId in this.watchedAreas||(o.addChildAreaWatcher(this.childName,this,o.areaId,!1),this.watchedAreas[o.areaId]=o)}else void 0!==this.values[r]&&(this.values[r]=void 0,i=!0)}for(var d in this.watchedAreas)d in t||(this.watchedAreas[d].removeChildAreaWatcher(this.childName,this),delete this.watchedAreas[d],i=!0);return i},t.prototype.debugName=function(){return"childAreas: "+this.childName},t}(EvaluationNode),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),EvaluationDataSource=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.data=constEmptyOS,r.indexer=void 0,r.dataPathNode=void 0,r.sourceName="",r.queueRunning=!0,r.dataPerFacet=void 0,r.attributes=void 0,r.nrDataRows=0,r.topLevelDataElementId=void 0,r.result=new Result(r.data),r.result.value=constEmptyOS,r.constant=!1,r}return __extends(t,e),t.prototype.destroy=function(){"indexer"in this&&(this.releaseDataPathNode(),void 0!==this.result.dataSource&&this.result.dataSource.removeResultReceiver(this),this.indexer.destroy(),delete this.result.dataSource),EvaluationDatasourceInfo.infoRemove(this.watcherId),this.queueRunning||(resumeScheduledTasks(),this.queueRunning=!0),e.prototype.destroy.call(this)},t.prototype.releaseDataPathNode=function(){void 0!=this.dataPathNode&&(this.indexer.decPathNodeTracing(this.dataPathNode),this.dataPathNode=void 0)},t.prototype.infoUpdate=function(e,t,i,r,n){EvaluationDatasourceInfo.infoUpdate(this.watcherId,this.uri instanceof NativeObjectWrapper?this.uri:this.sourceName,extractBaseName(this.sourceName),this.revision,Date.now(),e,t,n,i,r)},t.prototype.resumeQueue=function(){this.queueRunning||(resumeScheduledTasks(),this.queueRunning=!0)},t.prototype.suspendQueue=function(){this.queueRunning&&(suspendScheduledTasks(),this.queueRunning=!1)},t.prototype.endedLoading=function(e,t){this.infoUpdate(e,t,this.debugName(),void 0)},t.prototype.setData=function(e,t){if(this.data=e,this.endedLoading("loaded",t),this.dataSourceResultMode){if(this.releaseDataPathNode(),this.indexer.clear(),void 0!==this.data)for(var i=0;i<e.length;i++)this.indexer.addRawObject(this.data[i],void 0)}else this.result.value=e,this.informAllWatchers()},t.prototype.provideDataSupplier=function(e,t,i){var r={state:"loaded",fullName:this.uri instanceof NativeObjectWrapper?this.uri.file.name:this.sourceName,name:extractBaseName(this.sourceName),revision:getDeOSedValue(this.revision),lastUpdate:Date.now(),attributes:i,data:[]};this.dataPerFacet=t,this.nrDataRows=e,this.attributes=i,this.releaseDataPathNode(),void 0!==this.indexer?this.indexer.clear():this.createIndexer();var n=this.indexer.qcm.getRootPathId(),o=this.indexer.qcm.allocatePathId(n,"data");this.topLevelDataElementId=this.indexer.setTopLevelAttributeValue(r,void 0),this.indexer.setDataSupplier(this),this.indexer.announceNewDataElementsForPathId(o,this.topLevelDataElementId,0,e),this.dataPathNode=this.indexer.pathNodesById[o],this.indexer.incPathNodeTracing(this.dataPathNode),this.endedLoading("loaded",i)},t.prototype.setDataSourceResultMode=function(e){this.isActive()&&void 0!==this.dataSourceInput&&(e&&!this.dataSourceResultMode?this.result.value=emptyDataSourceResult:!e&&this.dataSourceResultMode&&(this.result.value=this.data,delete this.result.dataSource),this.markAsChanged()),this.dataSourceResultMode=e},t.prototype.createIndexer=function(){void 0===this.indexer&&(this.indexer=new FEGValueIndexer(globalInternalQCM),this.indexer.addPath(globalInternalQCM.getRootPathId()),this.result.dataSource=IndexerDataSource.createIndexerDataSourceRoot(this.indexer,this,this.uri),this.setDataSourceResultMode(!0),this.result.value=emptyDataSourceResult)},t.prototype.newDataSourceResult=function(e){Utilities.error("should not be called")},t.prototype.reextractData=function(){assert(!1,"should not be called")},t.prototype.errorInLoading=function(e){this.queueRunning||(resumeScheduledTasks(),this.queueRunning=!0),this.infoUpdate("error",void 0,this.debugName(),void 0,e)},t.prototype.canFillPathNode=function(e){var t=this.indexer.qcm.getPathStrings(e.pathId);return 2===t.length&&"data"===t[0]&&t[1]in this.dataPerFacet},t.prototype.fillPathNode=function(e,t){var i=this.indexer.qcm.getPathStrings(e.pathId);if(2===i.length&&"data"===i[0]){var r=this.dataPerFacet[i[1]];if(void 0!==r)for(var n=0;n<t.length;n++){var o=t[n];this.indexer.addColumnRange(e,r.slice(o.rowNr,o.rowNr+o.nrDataElements),o.firstDataElementId)}}},t.prototype.unloadPathNode=function(e){},t.prototype.getRawDataDescription=function(){for(var e=[],t=[],i=0;i<this.attributes.length;i++){var r=this.attributes[i],n=void 0===r.uniqueValues?void 0:r.uniqueValues.slice(0).sort(compareSimpleValues),o=compressRawData(this.dataPerFacet[r.name[0]],n);e.push({path:r.name,indexedValues:n,pathValuesRanges:o}),t.push(this.attributes[i].name)}return[{mapping:{rowNr:0,nrDataElements:this.nrDataRows,firstDataElementId:0,paths:t},values:e}]},t}(EvaluationFunctionApplication),EvaluationDataSourceFunction=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.scriptElem=void 0,r.dataSourceAware=!1,r}return __extends(t,e),t.prototype.updateInput=function(e,t){if(0===e){var i,r;i="object"!=typeof t?[]:t.value instanceof Array?t.value:[],1===i.length&&"string"==typeof i[0]?(r=i[0],r!==this.sourceName&&(this.sourceName=r,this.reload())):(r=void 0,this.data=constEmptyOS,this.markAsChanged())}else 1===e&&(objectEqual(t.value,this.revision)||(this.revision=t.value,this.reload()))},t.prototype.eval=function(){return!!this.dataSourceResultMode||!objectEqual(this.data,this.result.value)&&(this.result.value=this.data,!0)},t.prototype.onLoadError=function(e){var t="("+this.sourceName+")";window.onerror=this.windowErrorHandler,this.errorTriggered=!0,"string"==typeof e&&(t+=": "+e),this.errorInLoading(t),console.log("EvaluationDataSourceFunction: error: failed to load '"+this.actualSrcHint+"' "+t)},t.prototype.onLoad=function(){window.onerror=this.windowErrorHandler,this.resumeQueue(),this.errorTriggered||(void 0!==this.baseName?this.data=g_datasource[this.baseName]:this.data=g_datasource[this.sourceName],
void 0!==this.data&&this.setData(normalizeObject(this.data),void 0),this.endedLoading("loaded",void 0))},t.prototype.reload=function(){this.suspendQueue(),"undefined"!=typeof requireFS()?this.nodejsReload():this.browserReload()},t.prototype.browserReload=function(){var e,t,i=this;t=this.makeDataSrc(),this.actualSrcHint=t,this.infoUpdate(void 0===this.scriptElem?"initialLoad":"reload",void 0,this.debugName(),0),"undefined"!=typeof this.scriptElem&&(this.scriptElem.parentNode.removeChild(this.scriptElem),this.scriptElem=void 0),this.windowErrorHandler=window.onerror,this.errorTriggered=!1,window.onerror=function(e){i.onLoadError(e)},e=document.createElement("script"),e.type="text/javascript",e.onerror=function(e){i.onLoadError(e)},e.onload=function(){i.onLoad()};var r=document.head;"undefined"==typeof r&&(r=document.getElementsByTagName("head")[0]),this.scriptElem=e,r.appendChild(this.scriptElem),this.scriptElem.src=t},t.prototype.nodejsReload=function(){var e=this,t=this.getDataSourceFilename(),i=requireFS();this.infoUpdate(void 0===this.actualSrcHint?"initialLoad":"reload",void 0,this.debugName(),0),this.actualSrcHint=t,i.readFile(t,"utf8",function(t,i){if(t)e.onLoadError(t);else{var r=i.indexOf("[");if(r<0)return void e.onLoadError("Invalid Format: '['");var n,o,s=i.slice(0,r);if(o=new RegExp("^g_datasource[.]([a-zA-Z0-9_]*)[ \t\n]*=[ \t\n]*$","m"),n=o.exec(s),2!==n.length)return void e.onLoadError("Invalid Format: datasource name");i=i.slice(r),o=new RegExp("^[ \t\n;]*$","m");var a;for(a=0;a<i.length;a++){var d;if(d=o.exec(i.slice(-a-2,-1)),null===d)break;if(d[0].length<a)break}i=i.slice(0,-a-1);var u=n[1];try{g_datasource[u]=JSON.parse(i)}catch(t){return void e.onLoadError("Invalid format: not JSON")}e.onLoad()}})},t.prototype.makeDataSrc=function(){var e=new RegExp("^(file|https?|[st]?ftp)://.*/(.*).js$","m"),t=e.exec(this.sourceName);if(null!==t&&3===t.length)return this.baseName=t[2],this.sourceName;var i,r=getWindowLocation(),n=r.protocol;i="file:"===n?5:1;var o=r.pathname.split("/").slice(0,-i).join("/");return n+"//"+r.host+o+"/data/"+encodeURIComponent(this.sourceName+".js")},t.prototype.getDataSourceFilename=function(){var e=requirePath(),t=__dirname,i=t.split(e.sep).slice(0,-4).join(e.sep);return[i,"data",this.sourceName+".js"].join(e.sep)},t.prototype.debugName=function(){return"datasource"},t}(EvaluationDataSource);datasource.classConstructor=EvaluationDataSourceFunction;var g_datasource={},DataSourceInfo=function(){function e(){}return e}(),EvaluationDatasourceInfo=function(e){function t(i,r){var n=e.call(this,i,r)||this;return n.constant=!1,t.instances[n.watcherId]=n,n.result.value=constEmptyOS,n}return __extends(t,e),t.prototype.destroy=function(){delete t.instances[this.watcherId],e.prototype.destroy.call(this)},t.prototype.eval=function(){var e,i=[];e=t.info;for(var r in e)i.push(e[r]);return this.result=new Result(i),!0},t.prototype.debugName=function(){return"datasourceInfo"},t.infoUpdate=function(e,i,r,n,o,s,a,d,u,h){var l=new DataSourceInfo;l.name=[i],l.baseName=[r],l.revision=n,l.refreshTime=[o],l.state=[s],l.attributes=a,l.type=[u],l.progress=void 0===h?constEmptyOS:[h],void 0!==d&&(l.info=[d]),t.info[e]=l,t.notifyAll()},t.infoRemove=function(e){e in t.info&&(delete t.info[e],t.notifyAll())},t.notifyAll=function(){for(var e in t.instances)t.instances[e].markAsChanged()},t.hasDataloadInProgress=function(){for(var e in t.info){var i=t.info[e].state[0];if("initialLoad"===i||"reload"===i)return!0}return!1},t}(EvaluationFunctionApplication);EvaluationDatasourceInfo.info={},EvaluationDatasourceInfo.instances={},datasourceInfo.classConstructor=EvaluationDatasourceInfo;var DataSourceFileType;!function(e){e[e.unknown=0]="unknown",e[e.text=1]="text",e[e.csv=2]="csv",e[e.json=3]="json"}(DataSourceFileType||(DataSourceFileType={}));var dataTableMaxNrRows=void 0,dataTableMaxNrColumns=void 0,dataTableFacetRestriction=void 0,EvaluationDataTable=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.errorInLoad=!1,r.dataParsed=!1,r.uri=void 0,r.revision=0,r.onlyFirstBlock=!0,r.customArg=void 0,r.queueRunning=!0,r.waitForReply=!1,r.createIndexer(),r}return __extends(t,e),t.prototype.updateInput=function(e,t){function i(e,t){var i;return"object"!=typeof r.customArg||r.customArg instanceof Array||r.customArg instanceof NonAV||void 0===r.customArg[t]?e:(i=getDeOSedValue(r.customArg[t]),r.revision++,r.markAsChanged(),i)}var r=this;if(this.arguments[e]=t,void 0===t)this.inputs[e].removeWatcher(this,!1,!1),this.inputs[e]=void 0;else if(0===e){var n=getDeOSedValue(t.value);this.result.dataSource instanceof IndexerDataSource&&(this.result.dataSource.name=n),n instanceof Array||this.uri===n||(this.uri=n,this.sourceName=this.uri instanceof NativeObjectWrapper?this.uri.file.name:this.uri,this.markAsChanged())}else 1===e&&(objectEqual(t.value,this.customArg)||(this.customArg=getDeOSedValue(t.value),this.onlyFirstBlock=i(this.onlyFirstBlock,"onlyFirstBlock"),this.withCredentialsFlag=i(this.withCredentialsFlag,"withCredentials"),this.waitForReply=i(this.waitForReply,"waitForReply")))},t.prototype.setResult=function(e,t,i,r){var n={state:[e],fullName:[this.uri],name:[extractBaseName(this.sourceName)],revision:ensureOS(this.revision),lastUpdate:[Date.now()]};void 0!==t&&(n.info=t),void 0!==i&&(n.attributes=i),void 0!==r&&(n.data=r),this.result.set([n])},t.prototype.resumeQueue=function(){this.queueRunning||(resumeScheduledTasks(),this.queueRunning=!0)},t.prototype.suspendQueue=function(){this.queueRunning&&(suspendScheduledTasks(),this.queueRunning=!1)},t.prototype.abort=function(){this.errorInLoad=!0,console.log("load aborted",getDeOSedValue(this.arguments[0].value)),this.setResult("error","load aborted",void 0,void 0),this.infoUpdate("error",[],"datatable",void 0,"load aborted"),this.client=void 0,this.resumeQueue()},t.prototype.error=function(e){var t=getDeOSedValue(this.arguments[0].value);this.errorInLoad=!0,console.log("error loading",t),this.setResult("error","no such file: "+this.sourceName,void 0,void 0),this.infoUpdate("error",[],"datatable",void 0,"no such file: "+this.sourceName),this.client=void 0,this.resumeQueue()},t.prototype.load=function(e,t){if(this.fileMode===DataSourceFileType.unknown){var i=e[0];"["===i||"{"===i||" "===i?this.fileMode=DataSourceFileType.json:this.fileMode=DataSourceFileType.text}switch(this.fileMode){case DataSourceFileType.json:this.loadJSON(e);break;default:this.loadMatrix(e)}t&&(this.resumeQueue(),this.informAllWatchers())},t.prototype.loadJSON=function(e){var t,i={},r=[],n=[],o=[],s=[],a=0,d=[],u=[],h=[],l=[],c=[],p=0,f={},v=!0;try{t=ensureOS(JSON.parse(e))}catch(i){try{t=e.split(/[\n\r]+/).map(function(e,t){if(""!==e&&!e.startsWith("//"))try{return JSON.parse(e)}catch(e){throw e+" in line "+String(t+1)}})}catch(e){return void this.setResult("error",e,void 0,void 0)}}var g=Math.max(t.length/50,12*Math.log(t.length));f.recordId=[];for(var m=0;m<t.length;m++){var y=t[m],I=!0;for(var b in y){var C=y[b],S=i[b];void 0===S&&(S=a++,i[b]=S,o[S]="undefined",s[S]={number:0,string:0,object:0,undefined:0,boolean:0,currency:0},h[S]=[],l[S]={},c[S]=!0,n[S]=b,f[b]=[]);var R=o[S];if(null===C||void 0===C||C instanceof Object&&!(C instanceof Array&&1===C.length))null!==C&&void 0!==C&&(v=!1),P="undefined";else{C instanceof Array&&(C=C[0]);var P=typeof C;if("number"!==P){var A=Number(C);isNaN(A)||(C=A,P="number")}!c[S]||"number"===P&&C===Math.floor(C)||(c[S]=!1),I=!1,f[b][p]=C}R!==P?"undefined"===R?(o[S]=P,"number"===P&&(d[S]=C,u[S]=C),"object"===P&&(h[S]=void 0,l[S]=void 0)):"mixed"!==R&&(o[S]="mixed",d[S]=void 0,u[S]=void 0):"number"===P&&(d[S]>C&&(d[S]=C),u[S]<C&&(u[S]=C)),s[S][P]++,void 0!==l[S]&&(C in l[S]?l[S][C]++:"undefined"!==P&&(h[S].length>g?(h[S]=void 0,l[S]=void 0):(h[S].push(C),l[S][C]=1)))}I||(f.recordId[p]=p,p++)}for(var S=0;S<a;S++){var M=n[S],x={name:void 0===M?[]:[M],type:"number"===o[S]&&c[S]?["integer"]:[o[S]],typeCount:normalizeObject(s[S])};void 0!==d[S]&&(x.min=[d[S]],x.max=[u[S]]),void 0!==h[S]&&(x.uniqueValues=h[S]),r.push(x)}r.push({name:["recordId"],type:["integer"],min:[1],max:[t.length],typeCount:[{number:[t.length],string:[0],object:[0],undefined:[0],boolean:[0],currency:[0]}]}),this.endedLoading("loaded",r),void 0!==this.arguments[1]&&isTrue(interpretedQuery({noIndexer:_},this.arguments[1].value))?this.setNoIndexerData(r,t):v?(this.dataPerFacet=f,this.provideDataSupplier(p,f,r)):(this.indexer.clear(),this.indexer.addRawObject({attributes:r,data:t},void 0),this.endedLoading("loaded",r))},t.prototype.setNoIndexerData=function(e,t){void 0!==this.indexer&&(this.indexer.destroy(),delete this.indexer),delete this.result.dataSource,this.dataSourceResultMode=!1,this.result.value=[{state:"loaded",fullName:this.uri instanceof NativeObjectWrapper?this.uri.file.name:this.sourceName,name:extractBaseName(this.sourceName),revision:getDeOSedValue(this.revision),lastUpdate:Date.now(),attributes:e,data:normalizeObject(t)}],this.endedLoading("loaded",e),this.informAllWatchers()},t.prototype.loadMatrix=function(e){function i(e){return e.every(function(e){return void 0!==e&&/[^0-9]/.test(e)})}function r(e){return e.every(function(e){return void 0===e})}function n(e){for(var t=0;t<e.length-2&&r(e[t]);)t++;for(;t<e.length-2&&e[t].length<e[t+1].length&&i(e[t+1]);)t++;return 0===t?e:e.slice(t)}function o(){var e=[];for(var t in f)for(var i=f[t],r=0;r<i.length;r++){var n=i[r];void 0!==n&&(void 0===e[r]&&(e[r]={}),e[r][t]=n)}return e}function s(e){if(""===e&&(e="unknown"),!(e in b))return b[e]=e,e;var t,i=0;do i++,t=e+" "+i;while(t in b);return b[t]=e,t}function a(e,t,i){for(var r=0;r<e-1;r++)t[r]=h[r+1][i]}function d(){function e(e){var t=new Date(1,0);return t.setDate(Number(e[1])),t.setMonth(Number(e[2])-1),t.setFullYear(Number(e[3])),t.getTime()/1e3}function t(e){var t=new Date(1,0);return t.setDate(Number(e[2])),t.setMonth(Number(e[1])-1),t.setFullYear(Number(e[3])),t.getTime()/1e3}function i(e){var t=new Date(1,0);return t.setDate(Number(e[3])),t.setMonth(Number(e[2])-1),t.setFullYear(Number(e[1])),t.getTime()/1e3}for(var r,n=Number.MAX_VALUE,o=Number.MAX_VALUE,s=Number.MAX_VALUE,a=0,d=0,u=0,l=/^([0-9][0-9]?)[\/-]([0-9][0-9]?)[\/-]([0-9][0-9][0-9][0-9])$/,c=0;c<P.length;c++)if(P[c])for(var v=1;v<=y;v++){var g=h[v][c];if("string"==typeof g){var m=l.exec(g);if(null!==m){var I=Number(m[1]),b=Number(m[2]),C=Number(m[3]);I>a&&(a=I),I<n&&(n=I),b>d&&(d=b),b<o&&(o=b),C>u&&(u=C),C<s&&(s=C)}}}if(12<a&&a<=31&&d<=12&&1500<=u&&u<=2100||a===n&&1===o&&12===d&&1500<=u&&u<=2100)r=e;else if(12<d&&d<=31&&a<=12&&1500<=u&&u<=2100||d===o&&1===n&&12===a&&1500<=u&&u<=2100)r=t;else{if(!(12<u&&u<=31&&d<=12&&1500<=a&&a<=2100||u===s&&1===o&&12===d&&1500<=a&&a<=2100))return;r=i}for(var c=0;c<P.length;c++)if(P[c]){var S=Number.MAX_VALUE,R=-Number.MAX_VALUE,M=p[c],x=M.typeCount[0],E=f[A[c]];p[c].type=["date"],x.date=x.string,x.string=[0],x.nrUniqueValuesPerType[0].date=x.nrUniqueValuesPerType[0].string,x.nrUniqueValuesPerType[0].string=[0];for(var v=1;v<=y;v++){var g=h[v][c];if("string"==typeof g){var m=l.exec(g),T=r(m);E[v-1]=T,T<S&&(S=T),T>R&&(R=T)}}p[c].min=[S],p[c].max=[R],void 0!==p[c].uniqueValues&&(p[c].uniqueValues=p[c].uniqueValues.map(function(e){return"string"==typeof e?r(l.exec(e)):e}))}}function u(e){var t;if(null!==(t=C.exec(e))||null!==(t=S.exec(e))){var i=void 0===t[1]?"":t[1];return i+=t[2],void 0!==t[3]&&(i+=t[3].replace(/,/g,"")),void 0!==t[5]&&(i+="."+t[5].substr(1)),Number(i)}return e}var h=n(this.parseResponse(e)),l=h[0].map(function(e,t){return void 0===e?"column "+t:e}),c={"":1,$:1,"":1,"":1},p=[],f={},v=12*Math.log(h.length-1),g=[],m=void 0,y=void 0!==dataTableMaxNrRows&&dataTableMaxNrRows<h.length?dataTableMaxNrRows:h.length-1,I=new Map,b={recordId:"recordId"},C=t.angloNumberFormat,S=t.euroNumberFormat,R=t.dateTest,P=[],A=[];if(this.dataParsed=!0,this.onlyFirstBlock)for(var M=1;M<=y;M++){var x=h[M];if(x.every(function(e){return void 0===e})){y=M-1;break}}if(void 0!==dataTableFacetRestriction){var E=dataTableFacetRestriction.split(",");m={};for(var M=0;M<E.length;M++){var T=E[M],N="+"===T[0]?new RangeValue([1,1/0],!0,!1):0,w=T.slice(1);m[w]=N}}for(var D=0;D<l.length;D++){var O=l[D],Q=s(O),F=new Array(y),q="undefined",j=void 0,k=!0,V=void 0,G=void 0,B=new Map,U=[],L=0,z={number:0,string:0,object:0,undefined:0,boolean:0,currency:0,nrPositive:0,nrNegative:0,nrUnique:0,nrUniqueValuesPerType:{number:0,string:0,object:0,boolean:0,currency:0}};A.push(Q);for(var M=0;M<y;M++){var W=h[M+1][D];if("NULL"!==W&&""!==W&&"undefined"!==W&&void 0!==W){var H,K=Number(W),Z=void 0;if("mixed"!==q&&void 0!==W&&isNaN(K))if(Z=W.charAt(0),Z in c){var X=W.substr(1);K=Number(X),isNaN(K)&&(K=u(X))}else Z=void 0,K=u(W);isNaN(K)||K===-(1/0)||K===1/0?(H="string",I.has(W)?W=I.get(W):I.set(W,W),R.test(W)&&L++,F[M]=W):(W=K,void 0===Z?(H="number",F[M]=K):(H="currency",void 0===j?(j=Z,F[M]=K):""!==j&&j!==Z?(a(M,F,D),j="",H="string",F[M]=W):F[M]=K),k&&K!==Math.floor(K)&&(k=!1))}else H="undefined";if(q!==H?"undefined"===q?(q=H,"number"!==H&&"currency"!==H||(V=K,G=K)):void 0!==W&&"mixed"!==q&&("currency"===q?(a(M,F,D),j="",q="string"!==H?"mixed":"string"):q="mixed",V=void 0,G=void 0):"number"!==H&&"currency"!==H||(V>K&&(V=K),G<K&&(G=K)),z[H]++,"number"!==H&&"currency"!==H||(K>0?z.nrPositive++:K<0&&z.nrNegative++),"undefined"!==H){var J=B.get(W);void 0!==J?B.set(W,J+1):(B.set(W,1),z.nrUnique++,z.nrUniqueValuesPerType[H]++,void 0!==U&&(U.length>v?U=void 0:U.push(W)))}}if(void 0===m||interpretedBoolMatch(m,z)){f[Q]=F;var Y={name:[Q],type:"number"===q&&k?["integer"]:[q],typeCount:normalizeObject(z)};if(Q!==O&&(Y.originalName=[O]),void 0!==V&&(Y.min=[V],Y.max=[G]),void 0!==U&&"currency"!==q&&(Y.uniqueValues=U),"currency"===q&&(Y.currency=[j]),p.push(Y),P.push(L===z.string&&0===z.number&&0===z.object&&0===z.boolean&&0===z.currency),p.length>=dataTableMaxNrColumns)break}}d();for(var M=0;M<y;M++)g.push(M);f.recordId=g,p.push({name:["recordId"],type:["integer"],min:[1],max:[y],typeCount:[{number:[y],string:[0],object:[0],undefined:[0],boolean:[0],currency:[0],nrPositive:[y],nrNegative:[0],nrUnique:[y],nrUniqueValuesPerType:[{number:[y],string:0,object:0,boolean:0,currency:0}]}]}),void 0!==this.arguments[1]&&isTrue(interpretedQuery({noIndexer:_},this.arguments[1].value))?this.setNoIndexerData(p,o()):this.provideDataSupplier(y,f,p)},t.prototype.parseResponse=function(e){function t(){void 0!==s&&(o.push(s),s=void 0)}function i(){var t;if(void 0===a||void 0===d)t=void 0;else if(u!==d)t=e.substring(a,d+1),r&&(t=t.replace(/""/g,'"'));else{var i=Number(e.substring(a,d));isNaN(i)||i===1/0||i===-(1/0)?(t=e.substring(a,d+1),r&&(t=t.replace(/""/g,'"'))):t=i/100}void 0===s?s=[t]:s.push(t),a=void 0,d=void 0}if(this.fileMode!==DataSourceFileType.csv)return e.split(/\r?\n/).map(function(e){return e.split("\t")});for(var r,n,o=[],s=void 0,a=void 0,d=void 0,u=void 0,h=e.length,l=0,c=0;c!==h;c++){var p=e[c];switch(l){case 0:switch(r=!1,u=void 0,p){case'"':a=c+1,l=1;break;case",":i();break;case"\n":case"\r":"\n"!==n&&"\r"!==n&&(i(),t());case" ":case"\t":break;default:a=d=c,l=3}break;case 1:switch(p){case'"':d=c-1,l=2}break;case 2:switch(p){case'"':r=!0,l=1;break;case",":i(),l=0;break;case"\n":case"\r":"\n"!==n&&"\r"!==n&&(i(),t()),l=0}break;case 3:switch(p){case",":i(),l=0;break;case" ":case"\t":break;case"%":u=c,d=c;break;case"\n":case"\r":"\n"!==n&&"\r"!==n&&(i(),t()),l=0;break;default:d=c}}n=p}return"\n"!==n&&"\r"!==n&&(i(),t()),o},t.prototype.eval=function(){var e=this;if(this.errorInLoad=!1,this.dataParsed=!1,this.uri instanceof NativeObjectWrapper&&void 0!==this.uri.file)this.infoUpdate("loading",[],"datatable",0,void 0),this.determineFileMode(this.uri.file.name,!1),this.fileReader=new FileReader,this.fileReader.onabort=function(){e.abort()},this.fileReader.onerror=function(t){e.error(t)},this.fileReader.onloadend=function(){void 0!==e.fileReader&&(e.load(e.fileReader.result,!0),e.fileReader=void 0)},this.waitForReply&&this.suspendQueue(),this.fileReader.readAsText(this.uri.file);else if("string"==typeof this.uri){this.infoUpdate("loading",[],"datatable",0,void 0);var t=/^\.\.?\//.test(this.uri)?combineFilePath(runtimeEnvironment.dirName,this.uri):this.uri;this.determineFileMode(t,!0),this.client=new XMLHttpRequest,this.withCredentialsFlag&&(this.client.withCredentials=!0),this.client.onerror=function(t){e.error(t)},this.client.open("GET",t,!0),this.client.onabort=function(){e.abort()},this.client.onloadend=function(){void 0!==e.client&&(e.load(e.client.responseText,!0),e.client=void 0)},this.client.send("{}"),this.errorInLoad?(this.infoUpdate("error",[],"datatable",void 0,"opening file not allowed by browser"),this.setResult("error","opening datatable not allowed by browser: "+t,void 0,void 0),console.log("opening datatable not allowed by browser",t)):this.waitForReply&&this.suspendQueue()}else if(!valueEqual(this.result.value,constEmptyOS))return this.result.set(constEmptyOS),!0;return!1},t.prototype.determineFileMode=function(e,t){if(void 0!==this.arguments[1]){var i=getDeOSedValue(interpretedQuery({fileType:_},this.arguments[1].value));switch(i){case"csv":return void(this.fileMode=DataSourceFileType.csv);case"json":return void(this.fileMode=DataSourceFileType.json);case"txt":case"tsv":return void(this.fileMode=DataSourceFileType.text);case!1:case void 0:break;default:return void(this.fileMode=DataSourceFileType.unknown)}}t?this.fileMode=/\.[Cc][Ss][Vv](\?.*)?$/.test(e)?DataSourceFileType.csv:/\.[Jj][Ss][Oo][Nn](\?.*)?$/.test(e)?DataSourceFileType.json:/\.[Tt][SsXx][VvTt](\?.*)?$/.test(e)?DataSourceFileType.text:DataSourceFileType.unknown:this.fileMode=/\.[Cc][Ss][Vv]$/.test(e)?DataSourceFileType.csv:/\.[Jj][Ss][Oo][Nn]$/.test(e)?DataSourceFileType.json:/\.[Tt][SsXx][VvTt]$/.test(e)?DataSourceFileType.text:DataSourceFileType.unknown},t.prototype.debugName=function(){return"datatable"},t.prototype.getDebugResult=function(){for(var e=this,t=[],i=this.attributes.map(function(e){return e.name[0]}),r=i.reduce(function(t,i){var r=e.dataPerFacet[i].length;return r>t?r:t},0),n=0;n<r;n++){for(var o={},s=0;s<i.length;s++){var a=i[s],d=this.dataPerFacet[a][n];void 0!==d&&(o[a]=d)}t.push(o)}return[{state:["loaded"],fullName:[this.sourceName],name:[extractBaseName(this.sourceName)],revision:[getDeOSedValue(this.revision)],lastUpdate:[Date.now()],attributes:this.attributes,data:t}]},t}(EvaluationDataSource);EvaluationDataTable.angloNumberFormat=/^([+-])?([0-9][0-9]?[0-9]?)((,[0-9][0-9][0-9])*)(\.[0-9]*)?$/,EvaluationDataTable.euroNumberFormat=/^([+-])?([0-9][0-9]?[0-9]?)((\.[0-9][0-9][0-9])*)(,[0-9]*)?$/,EvaluationDataTable.dateTest=/^[0-9][0-9]?[\/-][0-9][0-9]?[\/-][0-9][0-9][0-9][0-9]$/,datatable.classConstructor=EvaluationDataTable;var EvaluationRemoteData=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dataHandle=void 0,t}return __extends(t,e),t.prototype.destroy=function(){this.releaseDataHandle(),e.prototype.destroy.call(this)},t.prototype.releaseDataHandle=function(){void 0!==this.dataHandle&&(gRemoteMgr.unsubscribe(this.dataHandle),this.dataHandle=void 0)},t.prototype.isConstant=function(){return!1},t.prototype.allRequestsAcknowledged=function(){},t.prototype.writeAckInfoUpdate=function(e,t){},t.prototype.signalTermination=function(e){throw new Error("Method not implemented.")},t.prototype.getTemplateIndexAdmin=function(){},t.prototype.getTemplateIndexIdUpdates=function(){},t.prototype.resetTemplateIndexIds=function(){},t.prototype.defineRemoteTemplateIndexIds=function(e){},t.prototype.loginStatusUpdate=function(e,t){},t.prototype.resourceUpdateComplete=function(e){},t}(EvaluationFunctionApplication),EvaluationDataBase=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.table=void 0,r.attributes=void 0,r.subscriptions={},r.idsPerPathNode={},r.nrPathsLoading=0,r.pathIdsLoading={},r.paths=void 0,r.connected=!1,r.indexer=new FEGValueIndexer(globalInternalQCM),r.indexer.addPath(globalInternalQCM.getRootPathId()),r.result.dataSource=IndexerDataSource.createIndexerDataSourceRoot(r.indexer,r,"database"),r.result.value=emptyDataSourceResult,r.dataSourceResultMode=!0,r}return __extends(t,e),t.prototype.destroy=function(){EvaluationDatasourceInfo.infoRemove(this.watcherId),gRemoteMgr.unregisterForLoginStatusUpdates(this),this.releaseSubscriptions(),void 0!==this.indexer&&(this.result.dataSource.removeResultReceiver(this),delete this.result.dataSource,this.indexer.clear()),e.prototype.destroy.call(this)},t.prototype.releaseSubscriptions=function(){for(var e in this.subscriptions)gRemoteMgr.unsubscribe(this.subscriptions[e]),delete this.subscriptions[e],delete this.idsPerPathNode[e]},t.prototype.infoUpdate=function(e,t,i,r){EvaluationDatasourceInfo.infoUpdate(this.watcherId,this.table,this.table,[1],Date.now(),e,t,r,"database",i)},t.prototype.provideDataSupplier=function(e){this.nrDataRows=e,this.indexer.setDataSupplier(this),this.indexer.announceNewDataElements(0,e),this.indexer.incPathNodeTracing(this.indexer.paths)},t.prototype.eval=function(){var e=getDeOSedValue(this.arguments[0].value),t=void 0===this.arguments[1]?void 0:stripArray(this.arguments[1].value,!0),i=isAV(t)?t.parameters:void 0;return e===this.table&&objectEqual(i,this.queryParameters)||(this.table=e,this.queryParameters=i,this.indexer.clear(),"string"==typeof e?this.subscribeToTable():EvaluationDatasourceInfo.infoRemove(this.watcherId)),!1},t.prototype.subscribeToTable=function(){var e={protocol:gAppStateMgr.appStateInfo.protocol[0],hostName:gAppStateMgr.appStateInfo.serverAddress[0],port:gAppStateMgr.appStateInfo.serverPort[0],path:gAppStateMgr.appStateInfo.serverPath[0]},t=this.indexer.qcm.getRootPathId(),i=String(t),r={type:"table",app:this.table,path:[],owner:gAppStateMgr.appStateInfo.owner[0],params:this.queryParameters};this.releaseSubscriptions(),this.indexer.clear();var n=gRemoteMgr.subscribe(this,e,r,XDR.xdrTableElement,function(e){return i},i);gRemoteMgr.registerForLoginStatusUpdates(this),void 0!==n?(this.subscriptions[t]=n,this.doInfoUpdate(t,!1),this.connected=!0):(this.infoUpdate("error",[],void 0),this.connected=!1)},t.prototype.resourceUpdate=function(e,t){if("object"==typeof e){var i=e[t],r=Number(t),n=this.indexer.pathNodesById[r];if(r in this.pathIdsLoading&&this.indexer.decPathNodeTracing(n),this.doInfoUpdate(r,!0),i instanceof Array)for(var o=0;o<i.length;o++){var s=i[o];s.path instanceof Array&&(debugDelayLoad?(void 0===this.delayedResources&&(this.delayedResources=new Map),this.delayedResources.set(r,s)):this.loadResource(r,s))}}},t.prototype.loadResource=function(e,t){var i=this.indexer.pathNodesById[e];if("mapping"in t&&0===t.path.length){var r=t.mapping;if(this.provideDataSupplier(r.nrDataElements),r.paths instanceof Array)this.paths=r.paths;else{this.paths=[];for(var n in r.paths)this.paths.push([n])}}else if("pathValuesRanges"in t){var o=t,s=this.idsPerPathNode[e];this.indexer.addColumnRange(i,decompressRawData(o.pathValuesRanges,o.indexedValues),s[0].firstDataElementId)}this.markAsChanged()},t.prototype.delayedResourceLoad=function(e){for(var t=e instanceof Array?e:[e],i=0;i<t.length;i++){var r=t[i];this.delayedResources.has(r)?(this.loadResource(r,this.delayedResources.get(r)),this.delayedResources.delete(r)):console.warn("path id not in delayed resources:",r)}},t.prototype.canFillPathNode=function(e){var t=this.indexer.qcm.getPathStrings(e.pathId);return void 0!==this.paths&&this.paths.some(function(e){return valueEqual(t,e)})},t.prototype.fillPathNode=function(e,t){var i=e.pathId,r=this.indexer.qcm.getPathStrings(e.pathId),n={protocol:gAppStateMgr.appStateInfo.protocol[0],hostName:gAppStateMgr.appStateInfo.serverAddress[0],port:gAppStateMgr.appStateInfo.serverPort[0],path:gAppStateMgr.appStateInfo.serverPath[0]},o={type:"table",app:this.table,path:r,owner:gAppStateMgr.appStateInfo.owner[0],params:this.queryParameters};if(!(i in this.subscriptions)){var s=gRemoteMgr.subscribe(this,n,o,XDR.xdrTableElement,function(e){return String(i)},String(i));gRemoteMgr.registerForLoginStatusUpdates(this),void 0!==s&&(this.indexer.incPathNodeTracing(e),this.subscriptions[i]=s,this.idsPerPathNode[i]=t,this.doInfoUpdate(i,!1))}},t.prototype.unloadPathNode=function(e){var t=e.pathId;t in this.subscriptions&&(gRemoteMgr.unsubscribe(this.subscriptions[t]),delete this.subscriptions[t],this.doInfoUpdate(t,!0))},t.prototype.doInfoUpdate=function(e,t){if(t){if(!(e in this.pathIdsLoading))return;this.nrPathsLoading--,delete this.pathIdsLoading[e],0===this.nrPathsLoading&&this.infoUpdate("loaded",[],void 0),assert(this.nrPathsLoading>=0,"nrPathsLoading is negative")}else 0===this.nrPathsLoading&&this.infoUpdate("loading",[],0),e in this.pathIdsLoading||(this.pathIdsLoading[e]=1,this.nrPathsLoading++)},t.prototype.resourceConnectionStateUpdate=function(e,t,i){},t.prototype.allRequestsAcknowledged=function(){},t.prototype.writeAckInfoUpdate=function(e,t){},t.prototype.getRawDataDescription=function(){return[]},t.prototype.loginStatusUpdate=function(e,t){t&&!this.connected&&this.subscribeToTable()},t}(EvaluationRemoteData);database.classConstructor=EvaluationDataBase;var EvaluationDatabases=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dataHandle=void 0,t.revision=void 0,t}return __extends(t,e),t.prototype.destroy=function(){gRemoteMgr.unregisterForLoginStatusUpdates(this),this.releaseDataHandle(),e.prototype.destroy.call(this)},t.prototype.releaseDataHandle=function(){void 0!==this.dataHandle&&(gRemoteMgr.unregisterForLoginStatusUpdates(this),gRemoteMgr.releaseResource(this.dataHandle),gRemoteMgr.unsubscribe(this.dataHandle))},t.prototype.isConstant=function(){return!1},t.prototype.eval=function(){return this.listCollections(),!1},t.prototype.listCollections=function(){var e={protocol:gAppStateMgr.appStateInfo.protocol[0],hostName:gAppStateMgr.appStateInfo.serverAddress[0],port:gAppStateMgr.appStateInfo.serverPort[0],path:gAppStateMgr.appStateInfo.serverPath[0]},t={type:"metadata",app:"any",owner:gAppStateMgr.appStateInfo.owner[0]};this.dataHandle=gRemoteMgr.subscribe(this,e,t,XDR.xdrMetadataElement,this.getIdentStringFun(),"metadata"),gRemoteMgr.registerForLoginStatusUpdates(this),void 0!==this.dataHandle?this.infoUpdate("loading",0):this.infoUpdate("error",void 0)},t.prototype.getIdentStringFun=function(){return function(e){return e.ident}},t.prototype.infoUpdate=function(e,t){EvaluationDatasourceInfo.infoUpdate(this.watcherId,"databases","databases",[1],Date.now(),e,[],void 0,"databases",t)},t.prototype.resourceUpdate=function(e,t){var i=this.result.isEmpty()?[]:[].concat(this.result.value),r=!1;for(var n in e){for(var o=!e[n].value||e[n].value===xdrDeleteIdent,s=normalizeObject(e[n].value),a=i.length,d=0,u=i.length;d<u;++d){var h=i[d];if(void 0!==h.id&&h.id[0]==n){a=d;break}}o?a<i.length&&(i.splice(a,1),r=!0):objectEqual(i[a],s[0])||(i[a]=s[0],r=!0)}r&&(this.result.set(i),this.informAllWatchers()),this.infoUpdate("loaded",void 0)},t.prototype.writeAckInfoUpdate=function(e,t){if(!this.result.isEmpty()){var i=this.result.isEmpty()?[]:[].concat(this.result.value),r=!1;for(var n in t){var o=t[n];if(void 0!==o){for(var s=void 0,a=void 0,d=0,u=i.length;d<u;++d){var h=i[d];if(void 0!==h.id&&void 0!==h.id[0]){if(h.id[0]==o&&(s=d,void 0!==a))break}else if(void 0!==h.name&&h.name[0]==n&&(a=d,void 0!==s))break}if(void 0!==s)void 0!==a&&(i.splice(a,1),r=!0);else if(void 0!==a){var l=shallowCopy(i[a]);l.id=[o],delete l.uploadProgress,i[a]=l,r=!0}}}r&&(this.result.set(i),this.informAllWatchers())}},t.prototype.resourceConnectionStateUpdate=function(e,t,i){0!==e&&(console.log("connection error:",t),this.infoUpdate("loaded",void 0))},t.prototype.write=function(e,t,i,r){if((void 0===r||1===r.length&&1===r[0].length)&&void 0!==e&&void 0!==e.value&&e.value instanceof Array&&1===e.value.length)if(debugWrites&&console.log("write to [databases]",e.value),void 0!==r&&void 0!==r[0].path){var n=r[0].index,o=new PositionChangeTracker,s=r[0].copyWithOffset(n),a=this.result.value[n];void 0===a&&(a={});var d=stripArray(determineWrite([a],e,t,i,[s],o),!0);this.updateMetaData(d,[new DataPosition(n,1)])}else this.updateMetaData(e.value[0],r);else Utilities.warn("dead ended write to [databases]; writing through projection or areaSetContent? at "+gWriteAction)},t.prototype.updateMetaData=function(e,t){var i=stripArray(shallowCopyMinus(e,"data"),!0),r=void 0===t?void 0:getDeOSedValue(this.result.value[t[0].index].id);i.data=e.data,"id"in i||void 0===r||(i=shallowCopy(i),i.id=r),"id"in i||"data"in i||Utilities.warn("possibly wrong write [databases]; no id nor data");var n="id"in i?i.id:i.name;if(void 0!==this.dataHandle?gRemoteMgr.write(this.dataHandle,n,i):Utilities.warn("no remote connection"),!("id"in i)){var o={name:[i.name],uploadProgress:[{dataTransferred:[0],state:["sending"]}]},s=this.result.isEmpty()?[o]:this.result.value.concat(o);this.result.set(s),this.informAllWatchers()}},t.prototype.outboundProgressUpdate=function(e,t,i,r){if(void 0!==e&&void 0!==t){for(var n=this.result.isEmpty()?[]:[].concat(this.result.value),o=!1,s=Math.round(i/r*100)/100,a=0,d=e.length;a<d;++a){for(var u=e[a],h=void 0,l=!0,c=0,p=n.length;c<p;++c){var f=n[c];if(void 0!==f.id&&void 0!==f.id[0]){if(f.id[0]!=u)continue;h=c,l=!1;break}if(void 0!==f.name&&f.name[0]==u){h=c;break}}if(l&&void 0!==h&&(!n[h].uploadProgress||n[h].uploadProgress[0].dataTransferred[0]!=s)){var v=shallowCopy(n[h]);v.uploadProgress=[{dataTransferred:[s],state:[i==r?"finalizing":"sending"]}],n[h]=v,o=!0}}o&&(this.result.set(n),this.informAllWatchers())}},t.prototype.loginStatusUpdate=function(e,t){t&&void 0===this.dataHandle&&this.listCollections()},t}(EvaluationRemoteData);databases.classConstructor=EvaluationDatabases;var EvaluationGetRawData=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.inputs=new Array(t.functionArguments.length),r.arguments=new Array(t.functionArguments.length),r.result.value=constEmptyOS,r.dataSourceAware=!0,r.dataSourceResultMode=!1,r}return __extends(t,e),t.prototype.addArgument=function(e,t){this.inputs[e]=t,this.arguments[e]=t.result,t.isConstant()?this.updateInput(e,t.result):(this.constant=!1,t.addWatcher(this,e,!0,!0,!0))},t.prototype.setDataSourceResultMode=function(e){},t.prototype.updateInput=function(e,t){this.arguments[e]=t},t.prototype.isConstant=function(){return!1},t.prototype.eval=function(){var e=this.arguments[0];if(void 0===e||void 0===e.value)return this.result.value=e,!0;if(!("dataSource"in e)){var t=new SingleAttributeProjection("data");return this.result.value=convertToRawDataDescription(t.execute(e.value,void 0,void 0,void 0,void 0)),!0}var i=e.dataSource,r=i.funcResult.getDominatedIndexer();return r instanceof FEGValueIndexer?(this.result.value=r.getRawDataDescription(),!0):(this.result.value=constEmptyOS,!0)},t.prototype.activateInputs=function(){e.prototype.activateInputs.call(this),this.inputHasChanged=!0},t}(EvaluationNodeWithArguments);getRawData.classConstructor=EvaluationGetRawData;var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),EvaluationDebuggerInfo=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.areaIdList=[],r.resultIdList=[],r.infoList=[],r.areaIdPos={},r.updatedInfo={},r.resultObj={},r.result.value=constEmptyOS,r}return __extends(t,e),t.prototype.destroy=function(){this.updateAreaList([]),e.prototype.destroy.call(this)},t.prototype.updateInput=function(e,t){if(0===e){for(var i=[],r="undefined"==typeof t?[]:t.value instanceof Array?t.value:[],n=0;n<r.length;n++)if("string"==typeof r[n])i.push(r[n]);else if(r[n]instanceof ElementReference){var o=r[n];i.push(o.getElement())}else Utilities.warnOnce("debuggerInfo: expecting area references");this.updateAreaList(i)}else if(e instanceof Array){var s=e[1];this.updatedInfo[s]=!0,this.resultObj[s]=t,this.markAsChanged()}},t.prototype.updateAreaList=function(e){
var t,i={},r=[],n=!1;e.length!==this.areaIdList.length&&(n=!0);for(var o=0;o<e.length;o++){t=e[o],i[t]=o;var s,a=this.areaIdPos[t];"undefined"==typeof a?(s=gDebuggerInfoMgr.getInfo(this.infoType,t),s.addWatcher(this,["info",t],!0,!0,!1),n=!0):a!==o?(s=this.infoList[a],n=!0):s=this.infoList[o],r[o]=s}if(n){for(t in this.areaIdPos)if(!(t in i)){var a=this.areaIdPos[t];this.infoList[a].removeWatcher(this,!0,!1),gDebuggerInfoMgr.releaseInfo(this.infoType,t),delete this.updatedInfo[t],delete this.resultObj[t],delete this.areaIdPos[t]}this.areaIdList=e,this.areaIdPos=i,this.infoList=r,this.markAsChanged()}},t.prototype.isConstant=function(){return!1},t.prototype.eval=function(){for(var e=!1,t=[],i=[],r=0;r<this.areaIdList.length;r++){var n=this.areaIdList[r];i[r]=n;var o=this.resultObj[n];(n!==this.resultIdList[r]||n in this.updatedInfo)&&(e=!0),void 0!==o&&void 0!==o.value&&t.push(o.value)}return this.updatedInfo={},e&&(this.result=new Result(t),this.resultIdList=i),e},t.prototype.activateInputs=function(){e.prototype.activateInputs.call(this);for(var t=0;t<this.infoList.length;t++){var i=this.infoList[t];i.activate(this,!1)}},t.prototype.deactivateInputs=function(){e.prototype.deactivateInputs.call(this);for(var t=0;t<this.infoList.length;t++){var i=this.infoList[t];i.deactivate(this,!1)}},t.prototype.allInputs=function(){return this.inputs.concat(this.infoList)},t.prototype.debugName=function(){return"debuggerInfo"},t}(EvaluationFunctionApplication),EvaluationDebuggerAreaInfo=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.infoType="areaInfo",r}return __extends(t,e),t.prototype.debugName=function(){return"debuggerAreaInfo"},t}(EvaluationDebuggerInfo);debuggerAreaInfo.classConstructor=EvaluationDebuggerAreaInfo;var EvaluationDebuggerContextInfo=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.infoType="contextInfo",r}return __extends(t,e),t.prototype.debugName=function(){return"debuggerContextInfo"},t}(EvaluationDebuggerInfo);debuggerContextInfo.classConstructor=EvaluationDebuggerContextInfo;var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),EvaluationLabeler=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.constant=!0,r.result.value=constEmptyOS,r}return __extends(t,e),t.prototype.updateInput=function(e,t){this.arguments[0]=t,this.markAsChanged()},t.prototype.resultIsTransient=function(){return!1},t.prototype.multiQuerySourceIds=function(){return this.inputs[0].multiQuerySourceIds()},t}(EvaluationFunctionApplication),EvaluationAtomic=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.eval=function(){return this.result.copyLabels(this.arguments[0]),this.result.value=this.arguments[0].value,this.result.atomic=!0,!0},t.prototype.debugName=function(){return"internalAtomic"},t}(EvaluationLabeler);internalAtomic.classConstructor=EvaluationAtomic;var EvaluationPush=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.eval=function(){return this.result.copyLabels(this.arguments[0]),this.result.value=this.arguments[0].value,this.result.push=!0,!0},t.prototype.debugName=function(){return"internalPush"},t}(EvaluationLabeler);internalPush.classConstructor=EvaluationPush;var EvaluationDelete=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.result.value=constEmptyOS,r.result.erase=!0,r}return __extends(t,e),t.prototype.eval=function(){return!1},t.prototype.debugName=function(){return"internalDelete"},t}(EvaluationLabeler);internalDelete.classConstructor=EvaluationDelete;var EvaluationAnonymize=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.dataSourceAware=!0,r}return __extends(t,e),t.prototype.eval=function(){var e=this.result.clone();return this.inputHasChanged=!1,this.result.copy(this.arguments[0]),this.result.setIdentifiers(void 0),this.result.anonymize=!0,!this.result.equal(e)},t.prototype.debugName=function(){return"internalAnonymize"},t}(EvaluationLabeler);anonymize.classConstructor=EvaluationAnonymize;var gCycleCheckNr=0,gCycleCheckQueue=new Array(3e4),gCycleCheckUp=new Array(3e4),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),EFNSetOperator=function(){function e(){}return e.prototype.destroy=function(){},e.prototype.execute=function(e){var t=this.compute(e.map(function(e){return void 0===e||void 0===e.value?constEmptyOS:e.value}));return void 0===t?constEmptyOS:t},e.prototype.executeOS=function(e,t,i){for(var r,n=new Array(e.length),o=[],s=o,a=0;a<e.length;a++)t[a]?(n[a]=[],groupResultById(e[a],n[a],s),s=void 0):n[a]=void 0;if(s===o)return this.execute(e);r=[];for(var a=0;a<o.length;a++){var d=this.computeUndef(n.map(function(t,i){return void 0!==t?t[a]:e[i].value}));void 0===d||0===d.length||"number"==typeof d[0]&&isNaN(d[0])?(r.push(void 0),i.push(o[a])):(Array.prototype.push.apply(r,d),repeatId(i,o[a],d.length))}return r},e.prototype.undefinedSignalsNoChange=function(){return!1},e}(),EFUnaryOperator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.compute=function(e){if(void 0!==e[0]){for(var t=e[0],i=[],r=0;r!==t.length;r++){var n=this.op(t[r]);void 0===n||"number"==typeof n&&isNaN(n)||i.push(n)}return i}return constEmptyOS},t.prototype.computeUndef=function(e){if(void 0!==e[0]){for(var t=e[0],i=[],r=0;r!==t.length;r++)i.push(this.op(t[r]));return i}return constEmptyOS},t}(EFNSetOperator),EFBinaryOperator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.compute=function(e){var t,i,r=e[0],n=e[1];if(void 0!==r&&void 0!==n){if(r.length===n.length)for(t=[],i=0;i!==r.length;i++){var o=this.op(r[i],n[i]);void 0===o||"number"==typeof o&&isNaN(o)||t.push(o)}else if(1===r.length)for(t=[],i=0;i!==n.length;i++){var o=this.op(r[0],n[i]);void 0===o||"number"==typeof o&&isNaN(o)||t.push(o)}else if(1===n.length)for(t=[],i=0;i!==r.length;i++){var o=this.op(r[i],n[0]);void 0===o||"number"==typeof o&&isNaN(o)||t.push(o)}else t=[];return t}},t.prototype.computeUndef=function(e){var t,i,r=e[0],n=e[1];if(void 0!==r&&void 0!==n){if(r.length===n.length)for(t=[],i=0;i!==r.length;i++)t.push(this.op(r[i],n[i]));else if(1===r.length)for(t=[],i=0;i!==n.length;i++)t.push(this.op(r[0],n[i]));else if(1===n.length)for(t=[],i=0;i!==r.length;i++)t.push(this.op(r[i],n[0]));else t=[];return t}},t}(EFNSetOperator),EFPlus=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e,t){return void 0===e||void 0===t?void 0:Number(e)+Number(t)},t}(EFBinaryOperator);EFPlus.singleton=new EFPlus,plus.factory=EFPlus.make;var EFMinus=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e,t){return void 0===e||void 0===t?void 0:e-t},t}(EFBinaryOperator);EFMinus.singleton=new EFMinus,minus.factory=EFMinus.make;var EFMul=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e,t){return void 0===e||void 0===t?void 0:e*t},t}(EFBinaryOperator);EFMul.singleton=new EFMul,mul.factory=EFMul.make;var EFDiv=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e,t){return void 0===e||void 0===t||0===t?void 0:e/t},t}(EFBinaryOperator);EFDiv.singleton=new EFDiv,div.factory=EFDiv.make;var EFMod=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e,t){return void 0===e||void 0===t||0===t?void 0:(e%t+t)%t},t}(EFBinaryOperator);EFMod.singleton=new EFMod,mod.factory=EFMod.make;var EFRemainder=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e,t){return void 0===e||void 0===t||0===t?void 0:e%t},t}(EFBinaryOperator);EFRemainder.singleton=new EFRemainder,remainder.factory=EFRemainder.make;var EFPow=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e,t){return void 0===e||void 0===t?void 0:Math.pow(e,t)},t}(EFBinaryOperator);EFPow.singleton=new EFPow,pow.factory=EFPow.make;var EFLn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){return void 0===e?void 0:Math.log(e)},t}(EFUnaryOperator);EFLn.singleton=new EFLn,ln.factory=EFLn.make;var EFExp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){return void 0===e?void 0:Math.exp(e)},t}(EFUnaryOperator);EFExp.singleton=new EFExp,exp.factory=EFExp.make;var EFLog10=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){return void 0===e?void 0:Math.log(e)/Math.LN10},t}(EFUnaryOperator);EFLog10.singleton=new EFLog10,log10.factory=EFLog10.make;var EFLogB=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e,t){return void 0===e||void 0===t?void 0:Math.log(e)/Math.log(t)},t}(EFBinaryOperator);EFLogB.singleton=new EFLogB,logb.factory=EFLogB.make;var EFRounding=function(){function e(){}return e.genRounding=function(e){return function(t,i){return"undefined"==typeof i||0===+i?e(t):(t=+t,i=+i,isNaN(t)||"number"!=typeof i||i%1!==0?NaN:(t=t.toString().split("e"),t=e(+(t[0]+"e"+(t[1]?+t[1]+i:i))),t=t.toString().split("e"),+(t[0]+"e"+(t[1]?+t[1]-i:-i))))}},e.prototype.destroy=function(){},e.prototype.execute=function(e){var t,i,r=e[0].value,n=e.length>1?e[1].value:[0];if(void 0!==r)if(assert(r instanceof Array,"'value' argument must be an os"),"undefined"==typeof n&&(n=[0]),assert(n instanceof Array,"'exp' argument must be a (single-element) os"),0===n.length&&(n=[0]),1===n.length){var o=n[0];t=new Array(r.length);for(var i=0;i!==r.length;i++)t[i]=void 0===r[i]?void 0:this.roundingFunc(r[i],o)}else t=r;else t=constEmptyOS;return t},e.prototype.executeOS=function(e,t,i){return Array.prototype.push.apply(i,e[0].identifiers),this.execute(e)},e.prototype.undefinedSignalsNoChange=function(){return!1},e}(),EFRound=function(e){function t(){var i=e.call(this)||this;return i.roundingFunc=t.genRounding(Math.round),i}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.undefinedSignalsNoChange=function(){return!1},t}(EFRounding);EFRound.singleton=new EFRound,round.factory=EFRound.make;var EFCeil=function(e){function t(){var t=e.call(this)||this;return t.roundingFunc=EFRound.genRounding(Math.ceil),t}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.undefinedSignalsNoChange=function(){return!1},t}(EFRounding);EFCeil.singleton=new EFCeil,ceil.factory=EFCeil.make;var EFFloor=function(e){function t(){var t=e.call(this)||this;return t.roundingFunc=EFRound.genRounding(Math.floor),t}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.undefinedSignalsNoChange=function(){return!1},t}(EFRounding);EFFloor.singleton=new EFFloor,floor.factory=EFFloor.make;var EFAbs=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){return void 0===e?void 0:Math.abs(e)},t}(EFUnaryOperator);EFAbs.singleton=new EFAbs,abs.factory=EFAbs.make;var EFUMinus=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){return void 0===e?void 0:-e},t}(EFUnaryOperator);EFUMinus.singleton=new EFUMinus,uminus.factory=EFUMinus.make;var EFSqrt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){return void 0===e?void 0:Math.sqrt(e)},t}(EFUnaryOperator);EFSqrt.singleton=new EFSqrt,sqrt.factory=EFSqrt.make;var EFSign=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){return e<0?-1:0===e?0:e>0?1:void 0},t}(EFUnaryOperator);EFSign.singleton=new EFSign,sign.factory=EFSign.make;var EFCoordinates=function(){function e(){}return e.make=function(t,i){return e.singleton},e.prototype.destroy=function(){},e.prototype.execute=function(e){var t=e[0].value,i=[];if(void 0!==t){assert(t instanceof Array,"argument not os");for(var r=0;r!==t.length;r++)if(t[r]instanceof ElementReference){var n=allAreaMonitor.getAreaById(t[r].getElement()),o=n.getPos();i.push({x:[o.left],y:[o.top]})}}return i},e.prototype.executeOS=function(e){return this.execute(e)},e.prototype.undefinedSignalsNoChange=function(){return!1},e}();EFCoordinates.singleton=new EFCoordinates,coordinates.factory=EFCoordinates.make;var actualArgumentValues={},EFArg=function(){function e(){}return e.make=function(t,i){return e.singleton},e.prototype.destroy=function(){},e.prototype.execute=function(e){if(2!==e.length||void 0===e[0].value||void 0===e[1].value)return constEmptyOS;var t=gArgParser.getArg(e[0].value[0],void 0);return actualArgumentValues[e[0].value[0]]=t?JSON.stringify(t):JSON.stringify(e[1].value),void 0===t?e[1].value:t===!1||"false"===t?constEmptyOS:t===!0||"true"===t?constTrueOS:!isNaN(parseFloat(t))&&isFinite(t)?[Number(t)]:normalizeObject(t)},e.prototype.executeOS=function(e,t,i){return Utilities.runtimeWarning("no OS implementation for EFArg"),this.execute(e)},e.prototype.undefinedSignalsNoChange=function(){return!1},e}();EFArg.singleton=new EFArg,arg.factory=EFArg.make;var EFPointer=function(){function e(){}return e.make=function(t,i){return e.singleton},e.prototype.destroy=function(){},e.prototype.execute=function(t){return e.res},e.prototype.executeOS=function(e,t,i){return this.execute(e)},e.prototype.undefinedSignalsNoChange=function(){return!1},e}();EFPointer.singleton=new EFPointer,EFPointer.res=[new ElementReference("p1")],pointer.factory=EFPointer.make;var EFMe=function(){function e(e){this.me=[e]}return e.make=function(t,i){return new e(new ElementReference(t.getOwnId()))},e.prototype.destroy=function(){this.me=void 0},e.prototype.execute=function(e){return this.me},e.prototype.executeOS=function(e,t,i){return Utilities.runtimeWarning("no OS implementation for [me]"),this.me},e.prototype.undefinedSignalsNoChange=function(){return!1},e}();me.factory=EFMe.make;var EFAreaRelation=function(){function e(e,t){this.dataSourceAware=!1,this.watchedAreas={},this.local=e,this.watcherId=getNextWatcherId(),this.owner=t,gProfile&&(this.totalUpdateInputTime=0,this.attributedTime=0)}return e.make=function(e,t){assert(!1,"no derived implementation?")},e.prototype.destroy=function(){var e=this.relation();for(var t in this.watchedAreas)areaRelationMonitor.removeWatcher(t,e,this);this.watchedAreas=void 0},e.prototype.relation=function(){assert(!1,"no derived implementation?")},e.prototype.getRelationAtPos=function(e,t){assert(!1,"no derived implementation?")},e.prototype.getRelationElementAtPos=function(e,t){assert(!1,"no derived implementation?")},e.prototype.onlyFirstTarget=function(){return!1},e.prototype.onlyLastTarget=function(){return!1},e.prototype.execute=function(e){var t;if(2===e.length){var i=e[0].value,r=e[1].value;if(void 0!==i&&void 0!==r&&i.length>0&&r.length>0)if(this.onlyFirstTarget()){for(var n=0;n<i.length;n++)for(var o=0;o<r.length;o++)if(objectEqual(i[n],r[o]))return this.getRelationAtPos(i,n)}else{if(!this.onlyLastTarget()){for(var s=[],n=0;n<i.length;n++)for(var o=0;o<r.length;o++)if(objectEqual(i[n],r[o])){var a=this.getRelationElementAtPos(i,n);void 0!==a&&s.push(a)}return s}for(var n=i.length-1;n>=0;n--)for(var o=0;o<r.length;o++)if(objectEqual(i[n],r[o]))return this.getRelationAtPos(i,n)}return constEmptyOS}if(e.length<2){var d={},u=this.relation(),h=[];if(0===e.length){if(t=this.local.getOwnId(),void 0===t)return this.local.getRelation(u);allAreaMonitor.exists(t)&&(d[t]=!0)}else{var l=e[0].value;if(void 0!==l)for(var n=0;n!==l.length;n++)t=l[n].element,allAreaMonitor.exists(t)&&(d[t]=!0)}for(t in d)t in this.watchedAreas||(this.watchedAreas[t]=!0,areaRelationMonitor.addWatcher(t,u,this,void 0)),h=cconcat(h,areaRelationMonitor.getRelation(t,u));for(t in this.watchedAreas)t in d||(areaRelationMonitor.removeWatcher(t,u,this),delete this.watchedAreas[t]);return h}return constEmptyOS},e.prototype.executeOS=function(e,t,i){return Utilities.error("should not be called in setMode"),this.execute(e)},e.prototype.updateInput=function(e,t){this.owner.markAsChanged()},e.prototype.isActive=function(){return this.owner.isActive()},e.prototype.isReady=function(){return!0},e.prototype.isDeferred=function(){return!1},e.prototype.defer=function(){throw"Should not be called"},e.prototype.undefer=function(){throw"Should not be called"},e.prototype.undefinedSignalsNoChange=function(){return!1},e.prototype.debugName=function(){return"areaRelation("+this.owner.debugName()+")"},e.prototype.getDebugOrigin=function(){return[this.debugName()]},e}(),EFEmbedding=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return new t(e,i)},t.prototype.relation=function(){return"embedding"},t.prototype.undefinedSignalsNoChange=function(){return!1},t}(EFAreaRelation);embedding.factory=EFEmbedding.make;var EFEmbeddingStar=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return new t(e,i)},t.prototype.relation=function(){return"embeddingStar"},t.prototype.undefinedSignalsNoChange=function(){return!1},t}(EFAreaRelation);embeddingStar.factory=EFEmbeddingStar.make;var EFEmbedded=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return new t(e,i)},t.prototype.relation=function(){return"embedded"},t.prototype.undefinedSignalsNoChange=function(){return!1},t}(EFAreaRelation);embedded.factory=EFEmbedded.make;var EFEmbeddedStar=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return new t(e,i)},t.prototype.relation=function(){return"embeddedStar"},t.prototype.undefinedSignalsNoChange=function(){return!1},t}(EFAreaRelation);embeddedStar.factory=EFEmbeddedStar.make;var EFPrev=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return new t(e,i)},t.prototype.relation=function(){return"prev"},t.prototype.getRelationAtPos=function(e,t){return t>0?[e[t-1]]:constEmptyOS},t.prototype.getRelationElementAtPos=function(e,t){return e[t-1]},t.prototype.undefinedSignalsNoChange=function(){return!1},t}(EFAreaRelation);prev.factory=EFPrev.make;var EFPrevStar=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return new t(e,i)},t.prototype.relation=function(){return"prevStar"},t.prototype.getRelationAtPos=function(e,t){return e.slice(0,t+1)},t.prototype.onlyLastTarget=function(){return!0},t.prototype.undefinedSignalsNoChange=function(){return!1},t}(EFAreaRelation);prevStar.factory=EFPrevStar.make;var EFPrevPlus=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return new t(e,i)},t.prototype.relation=function(){return"prevPlus"},t.prototype.getRelationAtPos=function(e,t){return e.slice(0,t)},t.prototype.onlyLastTarget=function(){return!0},t.prototype.undefinedSignalsNoChange=function(){return!1},t}(EFAreaRelation);prevPlus.factory=EFPrevPlus.make;var EFNext=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return new t(e,i)},t.prototype.relation=function(){return"next"},t.prototype.getRelationAtPos=function(e,t){return t<e.length-1?[e[t+1]]:constEmptyOS},t.prototype.getRelationElementAtPos=function(e,t){return e[t+1]},t.prototype.undefinedSignalsNoChange=function(){return!1},t}(EFAreaRelation);next.factory=EFNext.make;var EFNextStar=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return new t(e,i)},t.prototype.relation=function(){return"nextStar"},t.prototype.getRelationAtPos=function(e,t){return e.slice(t)},t.prototype.onlyFirstTarget=function(){return!0},t.prototype.undefinedSignalsNoChange=function(){return!1},t}(EFAreaRelation);nextStar.factory=EFNextStar.make;var EFNextPlus=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return new t(e,i)},t.prototype.relation=function(){return"nextPlus"},t.prototype.getRelationAtPos=function(e,t){return e.slice(t+1)},t.prototype.onlyFirstTarget=function(){return!0},t.prototype.undefinedSignalsNoChange=function(){return!1},t}(EFAreaRelation);nextPlus.factory=EFNextPlus.make;var EFExpressionOf=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return new t(e,i)},t.prototype.relation=function(){return"expressionOf"},t.prototype.undefinedSignalsNoChange=function(){return!1},t}(EFAreaRelation);expressionOf.factory=EFExpressionOf.make;var EFReferredOf=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return new t(e,i)},t.prototype.relation=function(){return"referredOf"},t.prototype.undefinedSignalsNoChange=function(){return!1},t}(EFAreaRelation);referredOf.factory=EFReferredOf.make;var EFNot=function(){function e(){}return e.make=function(t,i){return e.singleton},e.prototype.destroy=function(){},e.prototype.execute=function(e){return assert(void 0===e[0].value||e[0].value instanceof Array,"argument not os"),boolValue(isFalseValue(e[0].value))},e.prototype.executeOS=function(e,t,i){var r=[];return groupResultById(e[0],r,i),r.map(isFalseValue)},e.prototype.undefinedSignalsNoChange=function(){return!1},e}();EFNot.singleton=new EFNot,not.factory=EFNot.make;var EFDebugNodeToStr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){},t.prototype.execute=function(e){return[cdlify(e[0].value)]},t.prototype.executeOS=function(e,t,i){var r=[];return groupResultById(e[0],r,i),r.map(function(e){return cdlify(e)})},t}(EFUnaryOperator);EFDebugNodeToStr.singleton=new EFDebugNodeToStr,debugNodeToStr.factory=EFDebugNodeToStr.make;var EFAllAreas=function(){function e(){this.allAreas=[],this.dataSourceAware=!1,this.watcherId=getNextWatcherId(),gProfile&&(this.totalUpdateInputTime=0,this.attributedTime=0)}return e.prototype.destroy=function(){e.singleton.input=void 0,e.singleton.allAreas=void 0,e.singleton.owner=void 0,allAreaMonitor.removeWatcher(e.singleton,!1)},e.make=function(t,i){return allAreaMonitor.addWatcher(e.singleton,void 0),void 0===e.singleton.input&&(e.singleton.input=allAreaMonitor.result,e.singleton.allAreas=allAreaMonitor.result.value.map(makeElementReference),e.singleton.owner=i),e.singleton},e.prototype.updateInput=function(e,t){this.input=t,this.owner.markAsChanged()},e.prototype.isActive=function(){return!0},e.prototype.isReady=function(){return!0},e.prototype.execute=function(e){return this.allAreas=this.input.value.map(makeElementReference),0===e.length?this.allAreas:constEmptyOS},e.prototype.executeOS=function(e,t,i){return Utilities.error("should not be called in setMode"),this.execute(e)},e.prototype.undefinedSignalsNoChange=function(){return!0},e.prototype.isDeferred=function(){return!1},e.prototype.defer=function(){throw"Should not be called"},e.prototype.undefer=function(){throw"Should not be called"},e.prototype.debugName=function(){return"allAreas"},e.prototype.getDebugOrigin=function(){return["allAreas"]},e}();EFAllAreas.singleton=new EFAllAreas,allAreas.factory=EFAllAreas.make;var EFEqual=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.compute=function(e){var t=e[0],i=e[1];if(void 0!==t&&void 0!==i){if(t.length!==i.length)return constFalseOS;for(var r=0;r!==t.length;r++)if(!objectEqual(t[r],i[r]))return constFalseOS;return constTrueOS}return void 0!==t&&0!==t.length||void 0!==i&&0!==i.length?constFalseOS:constTrueOS},t.prototype.computeUndef=function(e){return this.compute(e)},t}(EFNSetOperator);EFEqual.singleton=new EFEqual,equal.factory=EFEqual.make;var EFNotEqual=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e,t){},t.prototype.compute=function(e){var t=e[0],i=e[1];if(void 0!==t&&void 0!==i){if(t.length!==i.length)return constTrueOS;for(var r=0;r!==t.length;r++)if(!objectEqual(t[r],i[r]))return constTrueOS;return constFalseOS}return void 0!==t&&0!==t.length||void 0!==i&&0!==i.length?constTrueOS:constFalseOS},t.prototype.computeUndef=function(e){return this.compute(e)},t}(EFBinaryOperator);EFNotEqual.singleton=new EFNotEqual,notEqual.factory=EFNotEqual.make;var EFBool=function(){function e(){}return e.make=function(t,i){return e.singleton},e.prototype.destroy=function(){},e.prototype.execute=function(e){return isTrueValue(e[0].value)?constTrueOS:constEmptyOS},e.prototype.executeOS=function(e,t,i){var r=[];return groupResultById(e[0],r,i),r.map(isTrue)},e.prototype.undefinedSignalsNoChange=function(){return!1},e}();EFBool.singleton=new EFBool,bool.factory=EFBool.make;var EFSequence=function(){function e(){}return e.make=function(t,i){return e.singleton},e.prototype.destroy=function(){},e.prototype.compute1=function(e,t){var i=[];if(void 0!==e&&1===e.length&&e[0]instanceof RangeValue){var r=e[0].min,n=e[0].max;if("number"!=typeof r&&"number"!=typeof n)Utilities.runtimeWarning("sequence on other than numeric values");else if(isNaN(r)||r===-(1/0)||isNaN(n)||n===1/0)Utilities.runtimeWarning("ill-defined sequence: r("+safeJSONStringify(r)+", "+safeJSONStringify(n)+")");else{var o=Math.ceil(r),s=Math.floor(n);e[0].closedLower||r!==o||(o+=1),e[0].closedUpper||n!==s||(s-=1);for(var a=o;a<=s;a++)i.push(a)}}return i},e.prototype.execute=function(e){return this.compute1(e[0].value,void 0)},e.prototype.executeOS=function(e,t,i){var r=this,n=[];return groupResultById(e[0],n,i),n.map(function(e){return r.compute1(e,void 0)})},e.prototype.undefinedSignalsNoChange=function(){return!1},e}();EFSequence.singleton=new EFSequence,sequence.factory=EFSequence.make;var EFOr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.compute=function(e){return boolValue(e.some(isTrueValue))},t.prototype.computeUndef=function(e){return this.compute(e)},t}(EFNSetOperator);EFOr.singleton=new EFOr,or.factory=EFOr.make;var EFAnd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.compute=function(e){return boolValue(e.every(isTrueValue))},t.prototype.computeUndef=function(e){return this.compute(e)},t}(EFNSetOperator);EFAnd.singleton=new EFAnd,and.factory=EFAnd.make;var EFNCompareAreasQuery=function(){function e(){}return e.make=function(t,i){return e.singleton},e.prototype.destroy=function(){},e.prototype.execute=function(e){var t,i=e[0].value,r=e[1].value;if(void 0===i)t=r;else if(void 0!==r){assert(i instanceof Array&&r instanceof Array,"argument not os");var n={};t=[];for(var o=0;o!==i.length;o++){var s=i[o];s instanceof ElementReference&&(n[s.getElement()]=!0)}for(var o=0;o!==r.length;o++){var s=r[o];s instanceof ElementReference&&!(s.getElement()in n)&&t.push(s)}}return t},e.prototype.executeOS=function(e,t,i){return Utilities.error("should not be called in setMode"),this.execute(e)},e.prototype.undefinedSignalsNoChange=function(){return!1},e}();EFNCompareAreasQuery.singleton=new EFNCompareAreasQuery,nCompareAreasQuery.factory=EFNCompareAreasQuery.make;var EFEmpty=function(){function e(){}return e.make=function(t,i){return e.singleton},e.prototype.destroy=function(){},e.prototype.execute=function(e){var t=e[0].value;return void 0!==t&&0===t.length?constTrueOS:constEmptyOS},e.prototype.executeOS=function(e,t,i){var r=[];return groupResultById(e[0],r,i),r.map(function(e){return void 0===e||0===e.length})},e.prototype.undefinedSignalsNoChange=function(){return!1},e}();EFEmpty.singleton=new EFEmpty,empty.factory=EFEmpty.make;var EFNotEmpty=function(){function e(){}return e.make=function(t,i){return e.singleton},e.prototype.destroy=function(){},e.prototype.execute=function(e){var t=e[0].value;return void 0===t||t instanceof Array&&0===t.length?constEmptyOS:constTrueOS},e.prototype.executeOS=function(e,t,i){var r=[];return groupResultById(e[0],r,i),r.map(function(e){return void 0!==e&&0!==e.length})},e.prototype.undefinedSignalsNoChange=function(){return!1},e}();EFNotEmpty.singleton=new EFNotEmpty,notEmpty.factory=EFNotEmpty.make;var EFSize=function(){function e(){}return e.make=function(t,i){return e.singleton},e.prototype.destroy=function(){},e.prototype.execute=function(e){var t=e[0].value;return void 0!==t?[t.length]:[0]},e.prototype.executeOS=function(e,t,i){var r=[];return groupResultById(e[0],r,i),r.map(function(e){return void 0===e?0:e.length})},e.prototype.undefinedSignalsNoChange=function(){return!1},e}();EFSize.singleton=new EFSize,size.factory=EFSize.make;var EFGreaterThan=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e,t){return void 0===e||void 0===t?void 0:e>t},t}(EFBinaryOperator);EFGreaterThan.singleton=new EFGreaterThan,greaterThan.factory=EFGreaterThan.make;var EFGreaterThanOrEqual=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e,t){return void 0===e||void 0===t?void 0:e>=t},t}(EFBinaryOperator);EFGreaterThanOrEqual.singleton=new EFGreaterThanOrEqual,greaterThanOrEqual.factory=EFGreaterThanOrEqual.make;var EFLessThan=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e,t){return void 0===e||void 0===t?void 0:e<t},t}(EFBinaryOperator);EFLessThan.singleton=new EFLessThan,lessThan.factory=EFLessThan.make;var EFLessThanOrEqual=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e,t){return void 0===e||void 0===t?void 0:e<=t},t}(EFBinaryOperator);EFLessThanOrEqual.singleton=new EFLessThanOrEqual,lessThanOrEqual.factory=EFLessThanOrEqual.make;var EFConcatStr=function(){function e(){}return e.make=function(t,i){return e.singleton},e.prototype.destroy=function(){},e.prototype.execute=function(e){var t,i,r,n=e[0].value,o=e.length>1?getDeOSedValue(e[1].value):void 0;
if("string"==typeof o?i=o:isAV(o)&&(t=getDeOSedValue(o.prefix),i=getDeOSedValue(o.infix),r=getDeOSedValue(o.postfix)),void 0!==n){assert(n instanceof Array,"argument not os");for(var s=[],a=0;a<n.length;a++){var d=n[a];switch(typeof d){case"string":case"number":case"boolean":s[a]=String(d);break;case"object":d instanceof Date?s[a]=d.toString():null!==d&&"stringify"in d&&"function"==typeof d.stringify?s[a]=d.stringify():s[a]=""}}return[(isSimpleType(t)&&void 0!==t?t:"")+s.join(isSimpleType(i)&&void 0!==i?i:"")+(isSimpleType(r)&&void 0!==r?r:"")]}return constEmptyOS},e.prototype.executeOS=function(e,t,i){return Utilities.error("should not be called in setMode"),this.execute(e)},e.prototype.undefinedSignalsNoChange=function(){return!1},e}();EFConcatStr.singleton=new EFConcatStr,concatStr.factory=EFConcatStr.make;var EFNumberToString=function(){function e(){}return e.make=function(t,i){return e.singleton},e.prototype.destroy=function(){},e.prototype.execute=function(t){for(var i=t[0].value,r=stripArray(t[1].value,!0),n=[],o=0;o<i.length;o++)n.push(e.convert(i[o],r));return n},e.prototype.executeOS=function(e,t,i){return Utilities.error("should not be called in setMode"),this.execute(e)},e.prototype.undefinedSignalsNoChange=function(){return!1},e.convert=function(e,t){var i;if("number"!=typeof e)return e;if(t=suppressSet(t),"object"==typeof t&&void 0!==t&&(0<=t.numberOfDigits&&t.numberOfDigits<=20||void 0===t.numberOfDigits||"intl"===t.type))switch(t.type){case"fixed":i=e.toFixed(t.numberOfDigits);break;case"exponential":i=e.toExponential(t.numberOfDigits);break;case"precision":i=0===t.numberOfDigits?e.toPrecision():e.toPrecision(t.numberOfDigits);break;case"hexadecimal":case"HEXADECIMAL":for(i=e.toString(16),"HEXADECIMAL"===t.type&&(i=i.toUpperCase());i.length<t.numberOfDigits;)i="0"+i;break;case"intl":try{var r=t.locale,n=new Intl.NumberFormat(r,t);i=n.format(e)}catch(t){i=String(e)}break;default:i=String(e)}else if(void 0!==t){var t=t;switch(t.type){case"fixed":i=e.toFixed();break;case"exponential":i=e.toExponential();break;case"precision":i=e.toPrecision();break;case"hexadecimal":case"HEXADECIMAL":i=e.toString(16),"HEXADECIMAL"===t.type&&(i=i.toUpperCase());break;default:i=String(e)}}else i=String(e);return i},e}();EFNumberToString.singleton=new EFNumberToString,numberToString.factory=EFNumberToString.make;var EFRange=function(){function e(){}return e.make=function(t,i){return e.singleton},e.prototype.destroy=function(){},e.prototype.execute=function(e){var t,i,r=e[0].value,n=e[1].value;if(void 0!==r&&void 0!==n){for(var o=0;o<n.length;o++)for(var s=0;s<r.length;s++)if(objectEqual(r[s],n[o])){void 0===t?t=i=o:i=o;break}if(void 0!==t)return n.slice(t,i+1)}return constEmptyOS},e.prototype.executeOS=function(e,t,i){return Utilities.error("should not be called in setMode"),this.execute(e)},e.prototype.undefinedSignalsNoChange=function(){return!1},e}();EFRange.singleton=new EFRange,range.factory=EFRange.make;var EFMax=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.compute=function(e){for(var t=void 0,i=0;i<e.length;i++){var r=e[i];if(void 0!==r)for(var n=0;n<r.length;n++){var o=r[n]instanceof RangeValue?r[n].max:r[n];(void 0===t||t<o)&&(t=o)}}return void 0===t?constEmptyOS:[t]},t.prototype.computeUndef=function(e){return this.compute(e)},t}(EFNSetOperator);EFMax.singleton=new EFMax,max.factory=EFMax.make;var EFMin=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.compute=function(e){for(var t=void 0,i=0;i<e.length;i++){var r=e[i];if(void 0!==r)for(var n=0;n<r.length;n++){var o=r[n]instanceof RangeValue?r[n].min:r[n];(void 0===t||t>o)&&(t=o)}}return void 0===t?constEmptyOS:[t]},t.prototype.computeUndef=function(e){return this.compute(e)},t}(EFNSetOperator);EFMin.singleton=new EFMin,min.factory=EFMin.make;var EFSum=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.compute=function(e){for(var t,i=0,r=0;r!==e.length;r++){var n=e[r];if(void 0!==n)for(var o=0;o<n.length;o++)t=n[o],"number"==typeof t&&(i+=t)}return[i]},t.prototype.computeUndef=function(e){return this.compute(e)},t}(EFNSetOperator);EFSum.singleton=new EFSum,sum.factory=EFSum.make;var EFTestStore=function(){function e(){this.owner=void 0}return e.prototype.destroy=function(){EFAllAreas.singleton.owner=void 0},e.make=function(t,i){return"undefined"==typeof e.singleton.owner&&(e.singleton.owner=i),e.singleton},e.prototype.execute=function(t){var i={},r=e.testStore;for(var n in r)i[n]=r[n];return[i]},e.prototype.executeOS=function(e,t,i){return this.execute(e)},e.updateLabel=function(t,i){i instanceof Array||(i=[i]),e.testStore[t]=i,"undefined"!=typeof e.singleton.owner&&e.singleton.owner.markAsChanged()},e.prototype.undefinedSignalsNoChange=function(){return!1},e}();EFTestStore.testStore={},EFTestStore.singleton=new EFTestStore,testStore.factory=EFTestStore.make;var EFReverse=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.compute=function(e){return void 0!==e[0]?e[0].slice(0).reverse():constEmptyOS},t.prototype.computeUndef=function(e){return this.compute(e)},t}(EFNSetOperator);EFReverse.singleton=new EFReverse,reverse.factory=EFReverse.make;var EFDynamicAttribute=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.compute=function(e){var t=e[0],i=e[1],r=e[2],n=void 0;if(void 0!==t&&void 0!==i&&void 0!==arg){var o=getDeOSedValue(t),s=getDeOSedValue(r);if("string"!=typeof o)return constEmptyOS;if(s instanceof Array||!(s instanceof Object)||s instanceof NonAV)return s instanceof Array?s:[s];n=shallowCopyMinus(s,o),o in s?n[o]=mergeCopyValue(i,s[o],void 0):n[o]=i}return void 0===n?constEmptyOS:[n]},t.prototype.computeUndef=function(e){return this.compute(e)},t}(EFNSetOperator);EFDynamicAttribute.singleton=new EFDynamicAttribute,dynamicAttribute.factory=EFDynamicAttribute.make;var EFDateToNum=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e,i){if("string"==typeof e&&"string"==typeof i){var r=new Date(1,0),n=e.split(t.sepSeq),o=i.split(t.sepSeq);if(n.length===o.length)for(var s=0;s<o.length;s++){var a=Number(n[s]);switch(o[s]){case"M":case"MM":r.setMonth(a-1);break;case"d":case"dd":r.setDate(a);break;case"y":case"yyyy":r.setFullYear(a);break;case"yy":r.setFullYear(a>=100?a:a+(t.currentYear-t.currentYear%100)+(a%100>t.currentYear%100+25?-100:0));break;case"h":case"hh":r.setHours(a);break;case"m":case"mm":r.setMinutes(a);break;case"s":case"ss":r.setSeconds(a);break;case"_":break;default:return void console.log("error in date format",i)}}return r.getTime()/1e3}},t}(EFBinaryOperator);EFDateToNum.singleton=new EFDateToNum,EFDateToNum.sepSeq=/[ :.,\/-]+/,EFDateToNum.currentYear=(new Date).getFullYear(),dateToNum.factory=EFDateToNum.make;var EFNumToDate=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e,i){function r(e){return e<10?"0"+e:String(e)}if("number"==typeof e&&"string"==typeof i){for(var n=new Date(1e3*e),o=i,s="";""!==o;){var a=o.match(t.alphaSeq)[0];if(0===a.length)s+=o.charAt(0),o=o.substr(1);else{switch(a){case"M":case"MM":s+=n.getMonth()+1;break;case"d":case"dd":s+=n.getDate();break;case"y":case"yyyy":s+=n.getFullYear();break;case"yy":s+=r(n.getFullYear()%100);break;case"h":s+=n.getHours();break;case"hh":s+=r(n.getHours());break;case"m":s+=n.getMinutes();break;case"mm":s+=r(n.getMinutes());break;case"s":s+=n.getSeconds();break;case"ss":s+=r(n.getSeconds());break;case"_":break;default:return void console.log("error in date format",i)}o=o.substr(a.length)}}return s}},t}(EFBinaryOperator);EFNumToDate.singleton=new EFNumToDate,EFNumToDate.alphaSeq=/[a-zA-Z]*/,numToDate.factory=EFNumToDate.make;var EFTestFormula=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){if("string"!=typeof e)return!1;var t=new StringParseFormula,i=t.parse(e);return i.success===!0},t}(EFUnaryOperator);EFTestFormula.singleton=new EFTestFormula,testFormula.factory=EFTestFormula.make;var EFEvaluatateCDLValueString=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){if("string"==typeof e){var t=new StringParseCDLValue,i=t.parse(e);return singleton(i.tree.result)}},t}(EFUnaryOperator);EFEvaluatateCDLValueString.singleton=new EFEvaluatateCDLValueString,evaluateCdlStringValue.factory=EFEvaluatateCDLValueString.make;var EFTestCDLValueString=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){if("string"!=typeof e)return!1;var t=new StringParseCDLValue,i=t.parse(e);return i.success===!0},t}(EFUnaryOperator);EFTestCDLValueString.singleton=new EFTestCDLValueString,testCdlValueString.factory=EFTestCDLValueString.make;var EFSubString=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e,t){if("string"==typeof t){if("number"==typeof e)return t.substr(e,1);if(e instanceof RangeValue){var i=e.min,r=e.max;return i<0&&(i+=t.length),r<0&&(r+=t.length),i<r?t.substr(i,r-i+1):t.substr(r,i-r+1)}}},t}(EFBinaryOperator);EFSubString.singleton=new EFSubString,subStr.factory=EFSubString.make;var EFStringToNumber=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){if("string"==typeof e){var t=Number(e);return isNaN(t)?e:t}return e},t}(EFUnaryOperator);EFStringToNumber.singleton=new EFStringToNumber,stringToNumber.factory=EFStringToNumber.make;var EFSingleValue=function(){function e(){}return e.make=function(t,i){return e.singleton},e.prototype.destroy=function(){},e.getSingleValue=function(e){if(void 0!==e)for(var t=0;t<e.length;t++){var i=e[t];if(isSimpleType(i)||i instanceof NonAV)return[i]}return constEmptyOS},e.prototype.execute=function(t){return e.getSingleValue(t[0].value)},e.prototype.executeOS=function(t,i,r){var n=[];return groupResultById(t[0],n,r),n.map(e.getSingleValue)},e.prototype.undefinedSignalsNoChange=function(){return!1},e}();EFSingleValue.singleton=new EFSingleValue,singleValue.factory=EFSingleValue.make;var EFTimeStamp=function(){function e(){}return e.make=function(t,i){return e.singleton},e.prototype.destroy=function(){},e.prototype.execute=function(e){return[Date.now()/1e3]},e.prototype.executeOS=function(e,t,i){return[Date.now()/1e3]},e.prototype.undefinedSignalsNoChange=function(){return!1},e}();EFTimeStamp.singleton=new EFTimeStamp,timestamp.factory=EFTimeStamp.make;var EFEscapeQuotes=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){return"string"==typeof e?e.replace(/(["'\\])/g,"\\$1"):e},t}(EFUnaryOperator);EFEscapeQuotes.singleton=new EFEscapeQuotes,escapeQuotes.factory=EFEscapeQuotes.make;var EFSecond=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){if("number"==typeof e){var t=new Date(1e3*e).getSeconds();return isNaN(t)?void 0:t}},t}(EFUnaryOperator);EFSecond.singleton=new EFSecond,second.factory=EFSecond.make;var EFMinute=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){if("number"==typeof e){var t=new Date(1e3*e).getMinutes();return isNaN(t)?void 0:t}},t}(EFUnaryOperator);EFMinute.singleton=new EFMinute,minute.factory=EFMinute.make;var EFHour=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){if("number"==typeof e){var t=new Date(1e3*e).getHours();return isNaN(t)?void 0:t+1}},t}(EFUnaryOperator);EFHour.singleton=new EFHour,hour.factory=EFHour.make;var EFDayOfWeek=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){if("number"==typeof e){var t=new Date(1e3*e).getDay();return isNaN(t)?void 0:t+1}},t}(EFUnaryOperator);EFDayOfWeek.singleton=new EFDayOfWeek,dayOfWeek.factory=EFDayOfWeek.make;var EFDayOfMonth=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){if("number"==typeof e){var t=new Date(1e3*e).getDate();return isNaN(t)?void 0:t}},t}(EFUnaryOperator);EFDayOfMonth.singleton=new EFDayOfMonth,dayOfMonth.factory=EFDayOfMonth.make;var EFMonth=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){if("number"==typeof e){var t=new Date(1e3*e).getMonth();return isNaN(t)?void 0:t+1}},t}(EFUnaryOperator);EFMonth.singleton=new EFMonth,month.factory=EFMonth.make;var EFQuarter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){if("number"==typeof e){var t=new Date(1e3*e).getMonth();return isNaN(t)?void 0:Math.trunc(t/3)+1}},t}(EFUnaryOperator);EFQuarter.singleton=new EFQuarter,quarter.factory=EFQuarter.make;var EFYear=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){if("number"==typeof e){var t=new Date(1e3*e).getFullYear();return isNaN(t)?void 0:t}},t}(EFUnaryOperator);EFYear.singleton=new EFYear,year.factory=EFYear.make;var EFURLStr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.make=function(e,i){return t.singleton},t.prototype.op=function(e){if("string"==typeof e)return encodeURI(e);if(isAV(e)){var t="protocol"in e?singleton(e.protocol)+"://":"http://";if(!(e.path instanceof Array)||e.path.some(function(e){return"string"!=typeof e&&"number"!=typeof e}))return;if(t+=e.path.map(encodeURI).join("/"),"query"in e)for(var i=t.indexOf("?")>=0,r=0;r<e.query.length;r++){var n=e.query[r];if(isAV(n)){var o={};for(var s in n)if(!(s in o)){var a=n[s];o[s]=!0,void 0===a||a instanceof Array&&0===a.length||(t+=(i?"&":"?")+encodeURIComponent(s)+"="+encodeURIComponent(singleton(a))),i=!0}}}return t}},t}(EFUnaryOperator);EFURLStr.singleton=new EFURLStr,urlStr.factory=EFURLStr.make;var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),IdentityQuery=function(){function e(e,t){this.query=void 0,this.ids={},this.data=t;for(var i=0;i<e.length;i++)this.ids[e[i]]=i;void 0!==dbgCreateList&&dbgCreateList.push({cls:"IdentityQuery"})}return e.prototype.init=function(){this.query=makeSimpleQueryDefault(this.data,void 0)},e.prototype.execute=function(e,t,i,r,n){if(void 0!==t){for(var o=[],s=0;s!==e.length;s++)t[s]in this.ids&&(this.data[this.ids[t[s]]]===e[s]||this.testSingle(e[s]))&&(i.push(t[s]),o.push(e[s]),void 0!==r&&r.push(void 0!==n?n[s]:new DataPosition(s,1)));return o}return void 0===this.query&&this.init(),this.query.execute(e,void 0,void 0,r,void 0)},e.prototype.testSingle=function(e){return void 0===this.query&&this.init(),this.query.testSingle(e)},e.prototype.testOS=function(e){return void 0===this.query&&this.init(),this.query.testOS(e)},e.prototype.isEqual=function(t){return t instanceof e&&(void 0===this.query&&this.init(),void 0===t.query&&t.init(),objectEqual(this.ids,t.ids)&&this.query.isEqual(t.query))},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SimplePassThrough=function(){function e(){}return e.prototype.execute=function(e,t,i,r,n){if(void 0!==t){var o={},s=[];assert(e.length===t.length,"number of identifiers should match number of data elements");for(var a=0;a<e.length;a++){var d=t[a];d in o||(o[d]=!0,s.push(e[a]),i.push(d),void 0!==r&&r.push(void 0!==n?n[a]:new DataPosition(a,1)))}return s}for(var u=new Set,s=[],a=0;a<e.length;a++){var h=e[a];u.has(h)||(u.add(h),s.push(e[a]),void 0!==r&&r.push(void 0!==n?n[a]:new DataPosition(a,1)))}return s},e.prototype.testSingle=function(e){return!0},e.prototype.testOS=function(e){return!0},e.prototype.isEqual=function(t){return t instanceof e},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SimpleSelectNone=function(){function e(){}return e.prototype.execute=function(e,t,i,r,n){return[]},e.prototype.testSingle=function(e){return!1},e.prototype.testOS=function(e){return!1},e.prototype.isEqual=function(t){return t instanceof e},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SingleAttributeProjection=function(){function e(e){this.attr=e,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SingleAttributeProjection"})}return e.prototype.execute=function(e,t,i,r,n){for(var o=[],s=0;s!==e.length;s++){var a=e[s][this.attr];if(void 0!==a&&(a instanceof Array?1===a.length?o.push(a[0]):0!==a.length&&(o=o.concat(a)):o.push(a),void 0!==r)){var d=new DataPosition(void 0===n?s:n[s].index,a instanceof Array?a.length:void 0!==a?1:0);r.push(d)}}return o},e.prototype.testSingle=function(e){return isTrue(e[this.attr])},e.prototype.testOS=function(e){if(void 0!==e)for(var t=0;t<e.length;t++)if(isTrue(e[t][this.attr]))return!0;return!1},e.prototype.isEqual=function(t){return t instanceof e&&this.attr===t.attr},e.prototype.isProjection=function(){return!0},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),DoubleAttributeProjection=function(){function e(e,t){this.attr1=e,this.attr2=t,void 0!==dbgCreateList&&dbgCreateList.push({cls:"DoubleAttributeProjection"})}return e.prototype.execute=function(e,t,i,r,n){for(var o=[],s=0;s!==e.length;s++){var a=e[s];if("object"==typeof a){var d=e[s][this.attr1];if(void 0!==d)for(var u=0;u<d.length;u++){var h=d[u][this.attr2];if(void 0!==h&&(h instanceof Array?1===h.length?o.push(h[0]):0!==h.length&&(o=o.concat(h)):o.push(h),void 0!==r)){var l=new DataPosition(void 0===n?s:n[s].index,1,[this.attr1],[new DataPosition(u,h instanceof Array?h.length:void 0!==h?1:0)]);r.push(l)}}}}return o},e.prototype.testSingle=function(e){return this.testOS2(e[this.attr1])},e.prototype.testOS=function(e){if(void 0!==e)for(var t=0;t<e.length;t++)if(this.testOS2(e[t][this.attr1]))return!0;return!1},e.prototype.testOS2=function(e){if(void 0!==e)for(var t=0;t<e.length;t++)if(isTrue(e[t][this.attr2]))return!0;return!1},e.prototype.isEqual=function(t){return t instanceof e&&this.attr1===t.attr1&&this.attr2===t.attr2},e.prototype.isProjection=function(){return!0},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SimpleTrueSelection=function(){function e(){}return e.prototype.execute=function(e,t,i,r,n){for(var o=[],s=0;s!==e.length;s++)e[s]!==!1&&void 0!==e[s]&&(void 0!==t&&i.push(t[s]),o.push(e[s]),void 0!==r&&r.push(void 0!==n?n[s]:new DataPosition(s,1)));return o},e.prototype.testSingle=function(e){return isTrue(e)},e.prototype.testOS=function(e){return isTrue(e)},e.prototype.isEqual=function(t){return t instanceof e},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SingleAttributeTrueSelection=function(){function e(e){this.attr=e,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SingleAttributeTrueSelection"})}return e.prototype.execute=function(e,t,i,r,n){for(var o=[],s=0;s!==e.length;s++)isTrue(e[s][this.attr])&&(void 0!==t&&i.push(t[s]),o.push(e[s]),void 0!==r&&r.push(void 0!==n?n[s]:new DataPosition(s,1)));return o},e.prototype.testSingle=function(e){return isTrue(e[this.attr])},e.prototype.testOS=function(e){if(void 0!==e)for(var t=0;t<e.length;t++)if(isTrue(e[t][this.attr]))return!0;return!1},e.prototype.isEqual=function(t){return t instanceof e&&this.attr===t.attr},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SimpleFalseSelection=function(){function e(){}return e.prototype.execute=function(e,t,i,r,n){for(var o=[],s=0;s!==e.length;s++)e[s]!==!1&&void 0!==e[s]||(void 0!==t&&i.push(t[s]),o.push(e[s]),void 0!==r&&r.push(void 0!==n?n[s]:new DataPosition(s,1)));return o},e.prototype.testSingle=function(e){return isFalse(e)},e.prototype.testOS=function(e){return isFalse(e)},e.prototype.isEqual=function(t){return t instanceof e},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SingleAttributeFalseSelection=function(){function e(e){this.attr=e,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SingleAttributeFalseSelection"})}return e.prototype.execute=function(e,t,i,r,n){for(var o=[],s=0;s!==e.length;s++)isFalse(e[s][this.attr])&&(void 0!==t&&i.push(t[s]),o.push(e[s]),void 0!==r&&r.push(void 0!==n?n[s]:new DataPosition(s,1)));return o},e.prototype.testSingle=function(e){return isFalse(e[this.attr])},e.prototype.testOS=function(e){if(void 0!==e)for(var t=0;t<e.length;t++)if(isTrue(e[t][this.attr]))return!1;return!0},e.prototype.isEqual=function(t){return t instanceof e&&this.attr===t.attr},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SimpleValueSelection=function(){function e(e){this.comp=e,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SimpleValueSelection"})}return e.prototype.execute=function(e,t,i,r,n){for(var o=[],s=this.comp,a=0;a!==e.length;a++)(e[a]===s||e[a]instanceof RangeValue&&e[a].match(s))&&(void 0!==t&&i.push(t[a]),o.push(e[a]),void 0!==r&&r.push(void 0!==n?n[a]:new DataPosition(a,1)));return o},e.prototype.testSingle=function(e){return e===this.comp||e instanceof RangeValue&&e.match(this.comp)},e.prototype.testOS=function(e){return simpleValueMatchInOS(e,this.comp)},e.prototype.isEqual=function(t){return t instanceof e&&this.comp===t.comp},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SimpleSubstringSelection=function(){function e(e){this.substr=e,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SimpleSubstringSelection"})}return e.prototype.execute=function(e,t,i,r,n){var o=[],s=this.substr;if(1===s.strings.length)for(var a=s.regexps[0],d=0;d!==e.length;d++)"object"!=typeof e[d]&&a.test(String(e[d]))&&(void 0!==t&&i.push(t[d]),o.push(e[d]),void 0!==r&&r.push(void 0!==n?n[d]:new DataPosition(d,1)));else for(var d=0;d!==e.length;d++)"object"!=typeof e[d]&&s.match(String(e[d]))&&(void 0!==t&&i.push(t[d]),o.push(e[d]),void 0!==r&&r.push(void 0!==n?n[d]:new DataPosition(d,1)));return o},e.prototype.testSingle=function(e){return"object"!=typeof e&&this.substr.match(String(e))},e.prototype.testOS=function(e){var t=this;if(void 0===e)return!1;if(1===this.substr.strings.length){var i=this.substr.regexps[0];return e.some(function(e){return"object"!=typeof e&&i.test(String(e))})}return e.some(function(e){return"object"!=typeof e&&t.substr.match(String(e))})},e.prototype.isEqual=function(t){return t instanceof e&&this.substr.isEqual(t.substr)},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),ElementReferenceSelection=function(){function e(e){this.element=e.element,void 0!==dbgCreateList&&dbgCreateList.push({cls:"ElementReferenceSelection"})}return e.prototype.execute=function(e,t,i,r,n){for(var o=[],s=0;s!==e.length;s++)e[s]instanceof ElementReference&&e[s].element===this.element&&(void 0!==t&&i.push(t[s]),o.push(e[s]),void 0!==r&&r.push(void 0!==n?n[s]:new DataPosition(s,1)));return o},e.prototype.testSingle=function(e){return e instanceof ElementReference&&e.element===this.element},e.prototype.testOS=function(e){if(void 0!==e)for(var t=0;t<e.length;t++)if(e[t]instanceof ElementReference&&e[t].element===this.element)return!0;return!1},e.prototype.isEqual=function(t){return t instanceof e&&this.element===t.element},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SingleAttributeSimpleValueSelection=function(){function e(e,t){this.attr=e,this.comp=t,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SingleAttributeSimpleValueSelection"})}return e.prototype.execute=function(e,t,i,r,n){for(var o=[],s=0;s!==e.length;s++){var a=e[s];"object"==typeof a&&this.attr in a&&simpleValueMatchInOS(a[this.attr],this.comp)&&(void 0!==t&&i.push(t[s]),o.push(a),void 0!==r&&r.push(void 0!==n?n[s]:new DataPosition(s,1)))}return o},e.prototype.testSingle=function(e){return"object"==typeof e&&this.attr in e&&simpleValueMatchInOS(e[this.attr],this.comp)},e.prototype.testOS=function(e){if(void 0!==e)for(var t=0;t<e.length;t++)if("object"==typeof e[t]&&this.attr in e[t]&&simpleValueMatchInOS(e[t][this.attr],this.comp))return!0;return!1},e.prototype.isEqual=function(t){return t instanceof e&&this.attr===t.attr&&this.comp===t.comp},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return allowSimpleQueryCache},e.prototype.checkCache=function(e){var t=this.attr,i="simplevalue_"+t;if("simpleQueryCache"in e&&e.simpleQueryCache.result===e.value||(e.simpleQueryCache=new QueryCache(e.value)),!(i in e.simpleQueryCache.cache)){for(var r=e.value,n=e.identifiers,o={},s=!1,a=0;a<e.value.length&&!s;a++){var d=r[a];if(t in d)for(var u=d[t],h=0;h<u.length;h++){var l=u[h];l instanceof RangeValue?s=!0:l in o?o[l].push({key:void 0,value:d,index:a,identifier:void 0===n?void 0:n[a]}):o[l]=[{key:void 0,value:d,index:a,identifier:void 0===n?void 0:n[a]}]}}e.simpleQueryCache.cache[i]=s?void 0:o}},e.prototype.executeAndCache=function(e,t,i){var r="simplevalue_"+this.attr;this.checkCache(e);var n=e.simpleQueryCache.cache[r];return void 0!==n?SortedCacheElement.extractResults(e,t,n[this.comp]):this.execute(e.value,e.identifiers,t,i,void 0)},e}(),SingleAttributeSelection=function(){function e(e){this.attr=e,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SingleAttributeSelection"})}return e.prototype.execute=function(e,t,i,r,n){for(var o=[],s=0;s!==e.length;s++)"object"==typeof e[s]&&this.attr in e[s]&&(void 0!==t&&i.push(t[s]),o.push(e[s]),void 0!==r&&r.push(void 0!==n?n[s]:new DataPosition(s,1)));return o},e.prototype.testSingle=function(e){return"object"==typeof e&&this.attr in e},e.prototype.testOS=function(e){if(void 0!==e)for(var t=0;t<e.length;t++)if("object"==typeof e[t]&&this.attr in e[t])return!0;return!1},e.prototype.isEqual=function(t){return t instanceof e&&this.attr===t.attr},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SingleAttributeAbsentSelection=function(){function e(e){this.attr=e,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SingleAttributeAbsentSelection"})}return e.prototype.execute=function(e,t,i,r,n){for(var o=[],s=0;s!==e.length;s++)"object"==typeof e[s]&&this.attr in e[s]||(void 0!==t&&i.push(t[s]),o.push(e[s]),void 0!==r&&r.push(void 0!==n?n[s]:new DataPosition(s,1)));return o},e.prototype.testSingle=function(e){return!("object"==typeof e&&this.attr in e)},e.prototype.testOS=function(e){if(void 0!==e)for(var t=0;t<e.length;t++)if(!("object"==typeof e[t]&&this.attr in e[t]))return!0;return!1},e.prototype.isEqual=function(t){return t instanceof e&&this.attr===t.attr},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SingleAttributeSimpleValueMultipleSelection=function(){function e(e,t){this.comp=void 0,this.attr=e,this.compOS=t,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SingleAttributeSimpleValueMultipleSelection"})}return e.prototype.init=function(){var e=this.compOS;this.comp={};for(var t=0;t<e.length;t++)this.comp[e[t]]=!0},e.prototype.execute=function(e,t,i,r,n){var o=[],s=this.comp,a=this.compOS;void 0===s&&(this.init(),s=this.comp);for(var d=0;d!==e.length;d++){var u=e[d];"object"==typeof u&&this.attr in u&&u[this.attr].some(function(e){return e in s||e instanceof RangeValue&&a.some(function(t){return e.match(t)})})&&(void 0!==t&&i.push(t[d]),o.push(u),void 0!==r&&r.push(void 0!==n?n[d]:new DataPosition(d,1)))}return o},e.prototype.testSingle=function(e){var t=this;return void 0===this.comp&&this.init(),"object"==typeof e&&this.attr in e&&e[this.attr].some(function(e){return e in t.comp||e instanceof RangeValue&&t.compOS.some(function(t){return e.match(t)})})},e.prototype.testOS=function(e){var t=this;if(void 0!==e){void 0===this.comp&&this.init();for(var i=0;i<e.length;i++)if("object"==typeof e[i]&&this.attr in e[i]&&e[i][this.attr].some(function(e){return e in t.comp||e instanceof RangeValue&&t.compOS.some(function(t){return e.match(t)})}))return!0}return!1},e.prototype.isEqual=function(t){return t instanceof e&&(void 0===this.comp&&this.init(),void 0===t.comp&&t.init(),this.attr===t.attr&&objectEqual(this.comp,t.comp))},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SingleAttributeSimpleValueInvSelection=function(){function e(e,t){this.attr=e,this.comp=t,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SingleAttributeSimpleValueInvSelection"})}return e.prototype.execute=function(e,t,i,r,n){for(var o=[],s=this.comp,a=0;a!==e.length;a++){var d=e[a];"object"==typeof d&&this.attr in d&&!onlySimpleValueInOS(d[this.attr],s)&&(void 0!==t&&i.push(t[a]),o.push(d),void 0!==r&&r.push(void 0!==n?n[a]:new DataPosition(a,1)))}return o},e.prototype.testSingle=function(e){return"object"==typeof e&&this.attr in e&&!onlySimpleValueInOS(e[this.attr],this.comp)},e.prototype.testOS=function(e){if(void 0!==e)for(var t=this.comp,i=0;i<e.length;i++){var r=e[i];if("object"==typeof r&&this.attr in r&&!onlySimpleValueInOS(r[this.attr],t))return!0}return!1},e.prototype.isEqual=function(t){return t instanceof e&&this.attr===t.attr&&this.comp===t.comp},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SingleAttributeSimpleValueInvMultipleSelection=function(){function e(e,t){this.attr=e,this.compOS=t,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SingleAttributeSimpleValueInvMultipleSelection"});
}return e.prototype.init=function(){var e=this.compOS;this.comp={};for(var t=0;t<e.length;t++)this.comp[e[t]]=!0},e.prototype.execute=function(e,t,i,r,n){var o=[],s=this.comp,a=this.compOS;void 0===s&&(this.init(),s=this.comp);for(var d=0;d!==e.length;d++){var u=e[d];"object"==typeof u&&this.attr in u&&!u[this.attr].every(function(e){return e in s||e instanceof RangeValue&&a.some(function(t){return e.match(t)})})&&(void 0!==t&&i.push(t[d]),o.push(u),void 0!==r&&r.push(void 0!==n?n[d]:new DataPosition(d,1)))}return o},e.prototype.testSingle=function(e){var t=this.comp,i=this.compOS;return void 0===t&&(this.init(),t=this.comp),"object"==typeof e&&this.attr in e&&!e[this.attr].every(function(e){return e in t||e instanceof RangeValue&&i.some(function(t){return e.match(t)})})},e.prototype.testOS=function(e){if(void 0!==e){var t=this.comp,i=this.compOS;void 0===t&&(this.init(),t=this.comp);for(var r=0;r<e.length;r++){var n=e[r];if("object"==typeof n&&this.attr in n&&!n[this.attr].every(function(e){return e in t||e instanceof RangeValue&&i.some(function(t){return e.match(t)})}))return!0}}return!1},e.prototype.isEqual=function(t){return t instanceof e&&(void 0===this.comp&&this.init(),void 0===t.comp&&t.init(),this.attr===t.attr&&objectEqual(this.comp,t.comp))},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SingleAttributeSubStringQuery=function(){function e(e,t){this.attr=e,this.substr=t,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SingleAttributeSubStringQuery"})}return e.prototype.execute=function(e,t,i,r,n){for(var o=this,s=[],a=0;a!==e.length;a++){var d=e[a];"object"==typeof d&&this.attr in d&&d[this.attr].some(function(e){return o.substr.match(e)})&&(void 0!==t&&i.push(t[a]),s.push(d),void 0!==r&&r.push(void 0!==n?n[a]:new DataPosition(a,1)))}return s},e.prototype.testSingle=function(e){var t=this;return"object"==typeof e&&this.attr in e&&e[this.attr].some(function(e){return t.substr.match(e)})},e.prototype.testOS=function(e){var t=this;if(void 0!==e)for(var i=0;i<e.length;i++)if("object"==typeof e[i]&&this.attr in e[i]&&e[i][this.attr].some(function(e){return t.substr.match(e)}))return!0;return!1},e.prototype.isEqual=function(t){return t instanceof e&&(this.attr===t.attr&&this.substr.isEqual(t.substr))},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SortedCacheElement=function(){function e(){}return e.compareIndices=function(e,t){return e.index-t.index},e.extractValue=function(e){return e.value},e.extractIdentifier=function(e){return e.identifier},e.compareNumericKeys1=function(e,t){return e.key-t},e.compareNumericKeys2=function(e,t){return e.key-t.key},e.extractResults=function(t,i,r){return void 0===r?constEmptyOS:(void 0!==i&&Array.prototype.push.apply(i,r.map(e.extractIdentifier)),r.map(e.extractValue))},e.extractResultRange=function(t,i,r,n,o){if(o<=n)return constEmptyOS;if(0===n&&o===t.value.length)return void 0!==i&&Array.prototype.push.apply(i,t.identifiers),t.value;var s=r.slice(n,o);return s.sort(e.compareIndices),void 0!==i&&Array.prototype.push.apply(i,s.map(e.extractIdentifier)),s.map(e.extractValue)},e}(),SimpleRangeSelection=function(){function e(e){this.lowestIndexInCache=void 0,this.highestIndexInCache=void 0,this.comp=e,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SimpleRangeSelection"})}return e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return allowSimpleQueryCache},e.prototype.execute=function(e,t,i,r,n){Utilities.error("do not call")},e.prototype.testSingle=function(e){Utilities.error("do not call")},e.prototype.testOS=function(e){Utilities.error("do not call")},e.prototype.isEqual=function(e){Utilities.error("do not call")},e.prototype.checkCache=function(e){"simpleQueryCache"in e&&e.simpleQueryCache.result===e.value||(e.simpleQueryCache=new QueryCache(e.value)),"range"in e.simpleQueryCache.cache||(e.simpleQueryCache.cache.range=e.value.filter(function(e){return"number"==typeof e&&!isNaN(e)}).map(function(e,t){return{value:e,key:e,index:t,identifier:void 0}}).sort(SortedCacheElement.compareNumericKeys2)),e.simpleQueryCache.cache.range.length===e.value.length?(this.lowestIndexInCache=binarySearchMin(e.simpleQueryCache.cache.range,this.comp.min,SortedCacheElement.compareNumericKeys1),this.highestIndexInCache=binarySearchMax(e.simpleQueryCache.cache.range,this.comp.max,SortedCacheElement.compareNumericKeys1)):(this.lowestIndexInCache=void 0,this.highestIndexInCache=void 0)},e.prototype.executeAndCache=function(e,t,i){if(this.checkCache(e),void 0!==this.lowestIndexInCache){var r=this.comp.min===-(1/0)?0:this.lowestIndexInCache>=0?this.comp.closedLower?this.lowestIndexInCache:this.lowestIndexInCache+1:-this.lowestIndexInCache-1,n=this.comp.max===1/0?e.simpleQueryCache.cache.range.length:this.highestIndexInCache>=0?this.comp.closedUpper?this.highestIndexInCache+1:this.highestIndexInCache:-this.highestIndexInCache-1;return SortedCacheElement.extractResultRange(e,t,e.simpleQueryCache.cache.range,r,n)}return this.execute(e.value,e.identifiers,t,i,void 0)},e}(),SimpleRangeCCSelection=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.execute=function(e,t,i,r,n){for(var o=this.comp.min,s=this.comp.max,a=[],d=0;d!==e.length;d++){var u=e[d];u instanceof RangeValue?this.comp.match(u)&&(void 0!==t&&i.push(t[d]),a.push(u),void 0!==r&&r.push(void 0!==n?n[d]:new DataPosition(d,1))):o<=u&&u<=s&&(void 0!==t&&i.push(t[d]),a.push(u),void 0!==r&&r.push(void 0!==n?n[d]:new DataPosition(d,1)))}return a},t.prototype.testSingle=function(e){return e instanceof RangeValue?this.comp.match(e):this.comp.min<=e&&e<=this.comp.max},t.prototype.testOS=function(e){if(void 0!==e)for(var t=0;t<e.length;t++){var i=e[t];if(i instanceof RangeValue?this.comp.match(i):this.comp.min<=i&&i<=this.comp.max)return!0}return!1},t.prototype.isEqual=function(e){return e instanceof t&&this.comp.isEqual(e.comp)},t}(SimpleRangeSelection),SimpleRangeCOSelection=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.execute=function(e,t,i,r,n){for(var o=this.comp.min,s=this.comp.max,a=[],d=0;d!==e.length;d++){var u=e[d];u instanceof RangeValue?this.comp.match(u)&&(void 0!==t&&i.push(t[d]),a.push(u),void 0!==r&&r.push(void 0!==n?n[d]:new DataPosition(d,1))):o<=u&&u<s&&(void 0!==t&&i.push(t[d]),a.push(u),void 0!==r&&r.push(void 0!==n?n[d]:new DataPosition(d,1)))}return a},t.prototype.testSingle=function(e){return e instanceof RangeValue?this.comp.match(e):this.comp.min<=e&&e<this.comp.max},t.prototype.testOS=function(e){if(void 0!==e)for(var t=0;t<e.length;t++){var i=e[t];if(i instanceof RangeValue?this.comp.match(i):this.comp.min<=i&&i<this.comp.max)return!0}return!1},t.prototype.isEqual=function(e){return e instanceof t&&this.comp.isEqual(e.comp)},t}(SimpleRangeSelection),SimpleRangeOCSelection=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.execute=function(e,t,i,r,n){for(var o=this.comp.min,s=this.comp.max,a=[],d=0;d!==e.length;d++){var u=e[d];u instanceof RangeValue?this.comp.match(u)&&(void 0!==t&&i.push(t[d]),a.push(u),void 0!==r&&r.push(void 0!==n?n[d]:new DataPosition(d,1))):o<u&&u<=s&&(void 0!==t&&i.push(t[d]),a.push(u),void 0!==r&&r.push(void 0!==n?n[d]:new DataPosition(d,1)))}return a},t.prototype.testSingle=function(e){return e instanceof RangeValue?this.comp.match(e):this.comp.min<e&&e<=this.comp.max},t.prototype.testOS=function(e){if(void 0!==e)for(var t=0;t<e.length;t++){var i=e[t];if(i instanceof RangeValue?this.comp.match(i):this.comp.min<i&&i<=this.comp.max)return!0}return!1},t.prototype.isEqual=function(e){return e instanceof t&&this.comp.isEqual(e.comp)},t}(SimpleRangeSelection),SimpleRangeOOSelection=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.execute=function(e,t,i,r,n){for(var o=this.comp.min,s=this.comp.max,a=[],d=0;d!==e.length;d++){var u=e[d];u instanceof RangeValue?this.comp.match(u)&&(void 0!==t&&i.push(t[d]),a.push(u),void 0!==r&&r.push(void 0!==n?n[d]:new DataPosition(d,1))):o<u&&u<s&&(void 0!==t&&i.push(t[d]),a.push(u),void 0!==r&&r.push(void 0!==n?n[d]:new DataPosition(d,1)))}return a},t.prototype.testSingle=function(e){return e instanceof RangeValue?this.comp.match(e):this.comp.min<e&&e<this.comp.max},t.prototype.testOS=function(e){if(void 0!==e)for(var t=0;t<e.length;t++){var i=e[t];if(i instanceof RangeValue?this.comp.match(i):this.comp.min<i&&i<this.comp.max)return!0}return!1},t.prototype.isEqual=function(e){return e instanceof t&&this.comp.isEqual(e.comp)},t}(SimpleRangeSelection),SimpleValueMultipleSelection=function(){function e(e){this.comp=void 0,this.compOS=e,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SimpleValueMultipleSelection"})}return e.prototype.init=function(){var e=this.compOS;this.comp={};for(var t=0;t<e.length;t++)this.comp[e[t]]=!0},e.prototype.execute=function(e,t,i,r,n){var o=[],s=this.comp,a=this.compOS;void 0===this.comp&&(this.init(),s=this.comp);for(var d=0;d!==e.length;d++){var u=e[d];(u in s||u instanceof RangeValue&&a.some(function(e){return u.match(e)}))&&(void 0!==t&&i.push(t[d]),o.push(u),void 0!==r&&r.push(void 0!==n?n[d]:new DataPosition(d,1)))}return o},e.prototype.testSingle=function(e){return void 0===this.comp&&this.init(),e in this.comp||e instanceof RangeValue&&this.compOS.some(function(t){return e.match(t)})},e.prototype.testOS=function(e){if(void 0!==e){var t=this.comp,i=this.compOS;void 0===this.comp&&(this.init(),t=this.comp);for(var r=0;r<e.length;r++){var n=e[r];if(n in t||n instanceof RangeValue&&i.some(function(e){return n.match(e)}))return!0}}return!1},e.prototype.isEqual=function(t){return t instanceof e&&(void 0===this.comp&&this.init(),void 0===t.comp&&t.init(),objectEqual(this.comp,t.comp))},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return allowSimpleQueryCache},e.prototype.checkCache=function(e){var t="simplevalue";if("simpleQueryCache"in e&&e.simpleQueryCache.result===e.value||(e.simpleQueryCache=new QueryCache(e.value)),!(t in e.simpleQueryCache.cache)){for(var i=e.value,r=e.identifiers,n={},o=!1,s=0;s<e.value.length&&!o;s++){var a=i[s];if(isSimpleType(a))a in n?n[a].push({key:void 0,value:a,index:s,identifier:void 0===r?void 0:r[s]}):n[a]=[{key:void 0,value:a,index:s,identifier:void 0===r?void 0:r[s]}];else if(a instanceof RangeValue){o=!0;break}}e.simpleQueryCache.cache[t]=o?void 0:n}},e.prototype.executeAndCache=function(e,t,i){this.checkCache(e);var r=e.simpleQueryCache.cache.simplevalue;if(void 0!==r){for(var n=[],o=new Set,s=0;s<this.compOS.length;s++){var a=this.compOS[s];!o.has(a)&&a in r&&(Array.prototype.push.apply(n,r[a]),o.add(a))}return SortedCacheElement.extractResults(e,t,n)}return this.execute(e.value,e.identifiers,t,i,void 0)},e}(),SimpleValueInvMultipleSelection=function(){function e(e){this.comp=void 0,this.compOS=e,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SimpleValueInvMultipleSelection"})}return e.prototype.init=function(){var e=this.compOS;this.comp={};for(var t=0;t<e.length;t++)this.comp[e[t]]=!0},e.prototype.execute=function(e,t,i,r,n){var o=[],s=this.comp,a=this.compOS;void 0===this.comp&&(this.init(),s=this.comp);for(var d=0;d!==e.length;d++){var u=e[d];u in s||u instanceof RangeValue&&a.some(function(e){return u.match(e)})||(void 0!==t&&i.push(t[d]),o.push(u),void 0!==r&&r.push(void 0!==n?n[d]:new DataPosition(d,1)))}return o},e.prototype.testSingle=function(e){return void 0===this.comp&&this.init(),!(e in this.comp||e instanceof RangeValue&&this.compOS.some(function(t){return e.match(t)}))},e.prototype.testOS=function(e){if(void 0!==e){var t=this.compOS,i=this.comp;void 0===i&&(this.init(),i=this.comp);for(var r=0;r<e.length;r++){var n=e[r];if(!(n in i||n instanceof RangeValue&&t.some(function(e){return n.match(e)})))return!0}}return!1},e.prototype.isEqual=function(t){return t instanceof e&&(void 0===this.comp&&this.init(),void 0===t.comp&&t.init(),objectEqual(this.comp,t.comp))},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),ElementReferenceMultipleSelection=function(){function e(e){this.elements=void 0,this.compOS=e,void 0!==dbgCreateList&&dbgCreateList.push({cls:"ElementReferenceMultipleSelection"})}return e.prototype.init=function(){var e=this.compOS;this.elements={},this.compOS=void 0;for(var t=0;t<e.length;t++)this.elements[e[t].element]=!0},e.prototype.execute=function(e,t,i,r,n){var o=[],s=this.elements;void 0===s&&(this.init(),s=this.elements);for(var a=0;a!==e.length;a++)e[a]instanceof ElementReference&&e[a].element in s&&(void 0!==t&&i.push(t[a]),o.push(e[a]),void 0!==r&&r.push(void 0!==n?n[a]:new DataPosition(a,1)));return o},e.prototype.testSingle=function(e){return void 0===this.elements&&this.init(),e instanceof ElementReference&&e.element in this.elements},e.prototype.testOS=function(e){if(void 0!==e){void 0===this.elements&&this.init();for(var t=0;t<e.length;t++)if(e[t]instanceof ElementReference&&e[t].element in this.elements)return!0}return!1},e.prototype.isEqual=function(t){return t instanceof e&&(void 0===this.elements&&this.init(),void 0===t.elements&&t.init(),objectEqual(this.elements,t.elements))},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SingleAttributeRangeSelection=function(){function e(e,t){this.attr=e,this.comp=t,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SingleAttributeRangeSelection"})}return e.prototype.execute=function(e,t,i,r,n){for(var o=this,s=[],a=0;a!==e.length;a++){var d=e[a];"object"==typeof d&&this.attr in d&&d[this.attr].some(function(e){return o.comp.match(e)})&&(void 0!==t&&i.push(t[a]),s.push(d),void 0!==r&&r.push(void 0!==n?n[a]:new DataPosition(a,1)))}return s},e.prototype.testSingle=function(e){var t=this;return"object"==typeof e&&this.attr in e&&e[this.attr].some(function(e){return t.comp.match(e)})},e.prototype.testOS=function(e){var t=this;if(void 0!==e)for(var i=0;i<e.length;i++)if("object"==typeof e[i]&&this.attr in e[i]&&e[i][this.attr].some(function(e){return t.comp.match(e)}))return!0;return!1},e.prototype.isEqual=function(t){return t instanceof e&&this.attr===t.attr&&objectEqual(this.comp,t.comp)},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return allowSimpleQueryCache},e.prototype.checkCache=function(e){var t=this.attr,i="range_"+t;if("simpleQueryCache"in e&&e.simpleQueryCache.result===e.value||(e.simpleQueryCache=new QueryCache(e.value)),!(i in e.simpleQueryCache.cache)){for(var r=e.value,n=e.identifiers,o=[],s=!1,a=0;a<e.value.length&&!s;a++){var d=r[a];if(t in d)for(var u=d[t],h=0;h<u.length;h++){var l=u[h];"number"!=typeof l||isNaN(l)?l instanceof RangeValue&&(s=!0):o.push({key:l,value:d,index:a,identifier:void 0===n?void 0:n[a]})}}e.simpleQueryCache.cache[i]=s?void 0:o.sort(SortedCacheElement.compareNumericKeys2)}void 0!==e.simpleQueryCache.cache[i]?(this.lowestIndexInCache=binarySearchMin(e.simpleQueryCache.cache[i],this.comp.min,SortedCacheElement.compareNumericKeys1),this.highestIndexInCache=binarySearchMax(e.simpleQueryCache.cache[i],this.comp.max,SortedCacheElement.compareNumericKeys1)):(this.lowestIndexInCache=void 0,this.highestIndexInCache=void 0)},e.prototype.executeAndCache=function(e,t,i){if(this.checkCache(e),void 0!==this.lowestIndexInCache){var r=this.comp.min===-(1/0)?0:this.lowestIndexInCache>=0?this.comp.closedLower?this.lowestIndexInCache:this.lowestIndexInCache+1:-this.lowestIndexInCache-1,n=this.comp.max===1/0?e.value.length:this.highestIndexInCache>=0?this.comp.closedUpper?this.highestIndexInCache+1:this.highestIndexInCache:-this.highestIndexInCache-1;return SortedCacheElement.extractResultRange(e,t,e.simpleQueryCache.cache["range_"+this.attr],r,n)}return this.execute(e.value,e.identifiers,t,i,void 0)},e}(),gSimpleQueryMap,SimpleQueryInterpretedQuery=function(){function e(e){this.query=getDeOSedValue(e),void 0!==dbgCreateList&&dbgCreateList.push({cls:"SimpleQueryInterpretedQuery"})}return e.prototype.execute=function(e,t,i,r,n){for(var o=[],s=0;s!==e.length;s++){var a=interpretedQuery(this.query,e[s]);void 0!==a&&(a===e[s]?(void 0!==t&&i.push(t[s]),o.push(a)):a instanceof Array?1===a.length?o.push(a[0]):a.length>1&&(o=cconcat(o,a)):o.push(a),void 0!==r&&r.push(void 0!==n?n[s]:new DataPosition(s,1)))}return o},e.prototype.testSingle=function(e){return interpretedBoolMatch(this.query,e)},e.prototype.testOS=function(e){return interpretedBoolMatch(this.query,e)},e.prototype.isEqual=function(t){return t instanceof e&&objectEqual(this.query,t.query)},e.prototype.isProjection=function(){return nrProjSitesInQuery(this.query)>0},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SimpleOrSelection=function(){function e(e){this.simpleQueries=e,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SimpleOrSelection"})}return e.prototype.execute=function(e,t,i,r,n){for(var o=[],s=0;s!==e.length;s++)this.testSingle(e[s])&&(void 0!==t&&i.push(t[s]),o.push(e[s]),void 0!==r&&r.push(void 0!==n?n[s]:new DataPosition(s,1)));return o},e.prototype.testSingle=function(e){return this.simpleQueries.some(function(t){return t.testSingle(e)})},e.prototype.testOS=function(e){return this.simpleQueries.some(function(t){return t.testOS(e)})},e.prototype.isEqual=function(t){if(t instanceof e){if(t.simpleQueries.length!==this.simpleQueries.length)return!1;for(var i=0;i<this.simpleQueries.length;i++)if(!this.simpleQueries[i].isEqual(t.simpleQueries[i]))return!1}return!1},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SimpleQueryChain=function(){function e(e){this.simpleQueries=e,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SimpleQueryChain"})}return e.prototype.execute=function(e,t,i,r,n){for(var o,s,a=e,d=t,u=n,h=0;0!==a.length&&h<this.simpleQueries.length;h++)h===this.simpleQueries.length-1?(o=i,s=r):(o=void 0===t?void 0:[],s=void 0===r?void 0:[]),a=this.simpleQueries[h].execute(a,d,o,s,u),d=o,u=s;return a},e.prototype.testSingle=function(e){return this.simpleQueries.every(function(t){return t.testSingle(e)})},e.prototype.testOS=function(e){return this.simpleQueries.every(function(t){return t.testOS(e)})},e.prototype.isEqual=function(t){if(t instanceof e){if(t.simpleQueries.length!==this.simpleQueries.length)return!1;for(var i=0;i<this.simpleQueries.length;i++)if(!this.simpleQueries[i].isEqual(t.simpleQueries[i]))return!1}return!1},e.prototype.isProjection=function(){return this.simpleQueries.length>1&&this.simpleQueries[this.simpleQueries.length-1].isProjection()},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),SimpleNegation=function(){function e(e){this.simpleQueries=e,void 0!==dbgCreateList&&dbgCreateList.push({cls:"SimpleNegation"})}return e.prototype.execute=function(e,t,i,r,n){for(var o=[],s=0;s!==e.length;s++)this.testSingle(e[s])&&(void 0!==t&&i.push(t[s]),o.push(e[s]),void 0!==r&&r.push(void 0!==n?n[s]:new DataPosition(s,1)));return o},e.prototype.testSingle=function(e){return this.simpleQueries.every(function(t){return!t.testSingle(e)})},e.prototype.testOS=function(e){return this.simpleQueries.every(function(t){return!t.testOS(e)})},e.prototype.isEqual=function(t){if(t instanceof e){if(t.simpleQueries.length!==this.simpleQueries.length)return!1;for(var i=0;i<this.simpleQueries.length;i++)if(!this.simpleQueries[i].isEqual(t.simpleQueries[i]))return!1}return!1},e.prototype.isProjection=function(){return!1},e.prototype.canCache=function(){return!1},e.prototype.executeAndCache=function(e,t,i){Utilities.error("do not call")},e}(),maxEvaluationsPerSlice=Number.MAX_VALUE,gDebugBreak=!1,gProgressValue=0,EvaluatorList=function(){function e(){this.nodes=[],this.pos=0,this.end=0}return e.prototype.push=function(e){var t=this.end++;return this.nodes[t]=e,t},e.prototype.pop=function(){var e=this.nodes[this.pos];return this.nodes[this.pos]=void 0,this.pos++,e},e.prototype.isEmpty=function(){return this.pos>=this.end},e.prototype.isNotEmpty=function(){return this.pos<this.end},e.prototype.reset=function(){this.pos=0,this.end=0},e.prototype.addCompact=function(e){return this.pos>0?(this.pos--,this.nodes[this.pos]=e,this.pos):this.push(e)},e.prototype.clearAndCompact=function(e){if(this.nodes[e]=void 0,this.pos===e){for(;this.pos<this.end&&void 0===this.nodes[this.pos];)this.pos++;this.pos>=this.end&&this.reset()}else if(this.pos===this.end-1)do this.end--;while(void 0===this.nodes[this.end-1])},e}(),SinglePriorityQueue=function(){function e(e,t){this.low=0,this.high=-1,this.interrupt=!1,this.nrProcessed=0,this.maxResetStep=-1,this.nrMaxReset=0;var i=[];this.priority=e,this.queue=i;for(var r=0;r<=t;r++)i.push(new EvaluatorList)}return e.prototype.runQueue=function(e){for(void 0===e&&(e=void 0),this.interrupt=!1,this.nrProcessed=0,logValues&&void 0===logPrototypes&&gSimpleLog.log("runQueue",this.priority);this.low<=this.high&&this.interrupt===!1;){for(var t=this.low,i=this.queue[t];i.isNotEmpty()&&this.low===t&&this.interrupt===!1;){var r=i.pop();void 0!==r&&(r.scheduledAtPosition=-1,r.updateOutput(),this.nrProcessed++,gProgressValue++,void 0!==e&&(this.nrProcessed>=maxEvaluationsPerSlice||e.timedOut())&&(this.interrupt=void 0))}i.pos===i.end&&(i.reset(),this.low===t&&this.low++,globalInternalQCM.executeScheduled())}return logValues&&void 0===logPrototypes&&gSimpleLog.log("runQueue end",this.low>this.high,this.interrupt),this.low>this.high&&(this.low=0,this.high=-1,this.maxResetStep=-1,this.nrMaxReset=0),void 0===this.interrupt?void 0:!this.interrupt},e.prototype.runUntil=function(e,t){var i;for(this.interrupt=!1,logValues&&void 0===logPrototypes&&gSimpleLog.log("runUntil",this.priority);this.low<=this.high&&this.low<=t&&this.interrupt===!1;){var r=this.low,n=this.queue[r];for(logValues&&void 0===logPrototypes&&n.end>n.pos&&gSimpleLog.log("step",r);n.isNotEmpty()&&this.low===r&&this.interrupt===!1;){var o=n.pop();void 0!==o&&(o.scheduledAtPosition=-1,o.updateOutput(),this.nrProcessed++,e.isScheduled()||(this.interrupt=void 0))}n.pos===n.end&&(n.reset(),this.low===r&&this.low++)}return logValues&&void 0===logPrototypes&&gSimpleLog.log("runUntil end",this.low>this.high,this.interrupt),this.low>this.high?(this.low=0,this.high=-1,i=void 0!==this.interrupt||void 0,this.interrupt=!1):this.low<=this.high&&this.low<=t?(i=void 0===this.interrupt&&void 0,this.interrupt=!0):e.isScheduled()&&(i=!1),i},e.prototype.schedule=function(e,t){var i=e.getScheduleStep();assert(i>=0,"task not meant for scheduling?"),i<this.low&&(this.low=i),this.high<i&&(this.high=i),e.scheduledAtPosition=this.queue[i].push(e)},e.prototype.unschedule=function(e){var t=e.getScheduleStep();assert(t>=0,"task not meant for scheduling?"),this.queue[t].nodes[e.scheduledAtPosition]=void 0,e.scheduledAtPosition=-1},e.prototype.defer=function(e){var t=e.getScheduleStep();logValues&&void 0===logPrototypes&&gSimpleLog.log("defer",e.toString()),t<this.low&&(this.low=t),this.high<t&&(this.high=t),e.scheduledAtPosition=this.queue[t].addCompact(e)},e.prototype.undefer=function(e){var t=e.getScheduleStep();logValues&&void 0===logPrototypes&&gSimpleLog.log("undefer",e.toString()),this.queue[t].clearAndCompact(e.scheduledAtPosition),e.scheduledAtPosition=-1},e.prototype.isEmpty=function(){return this.low>this.high},e.prototype.allInactive=function(){for(var e=this.low;e<=this.high;e++){var t=this.queue[e];if(void 0!==t)for(var i=t.pos;i<t.end;i++){var r=t.nodes[i];if(void 0!==r&&r.isActive())return!1}}return!0},e.prototype.compact=function(){for(;this.low<=this.high&&this.queue[this.low].isEmpty();)this.queue[this.low].reset(),this.low++;this.low>this.high&&(this.low=0,this.high=-1)},e}(),EvaluationQueue=function(){function e(){this.cycle=1,this.priorityQueues=[],this.deferredQueues=[],this.prio=-1,this.running=!1,this.nrProcessed=0,this.scheduleTaskCalled=!1,this.disabled=0,this.uncommitedWrites=[],this.latchedWrites=[],this.timeSensitiveNodes=[],this.suspendAllEvaluations=!1}return e.prototype.init=function(e,t){this.priorityQueues[e]=new SinglePriorityQueue(e,t),this.deferredQueues[e]=new SinglePriorityQueue(e,t)},e.prototype.setGlobalMessageQueue=function(e){this.globalMessageQueue=e},e.prototype.runQueue=function(e,t){if(this.suspendAllEvaluations)return!0;for(this.running=!0;this.prio>=e;){var i=this.priorityQueues[this.prio],r=i.runQueue(t);if(r===!0&&this.prio>=e&&this.prio--,this.nrProcessed+=i.nrProcessed,void 0===r&&gInitPhase){var n=(this.priorityQueues[0].high===-1?this.priorityQueues[0].queue.length:this.priorityQueues[0].low)+(this.priorityQueues[1].high===-1?this.priorityQueues[1].queue.length:this.priorityQueues[1].low),o=this.priorityQueues[0].queue.length+this.priorityQueues[1].queue.length;this.setProgressIndicatorValue(n/o*100);break}if(this.suspendAllEvaluations||void 0!==t&&t.timedOut())break}return this.running=!1,!!(this.prio<e&&(this.scheduleTaskCalled=!1,this.isEmpty(0)))&&(globalPosConstraintSynchronizer.isEmpty()||globalPosConstraintSynchronizer.flushBuffer(),!0)},e.prototype.runUntil=function(e){var t=e.getSchedulePriority(),i=this.running,r=this.prio;if(!(e.scheduledAtPosition<0)){for(;this.prio<t;)this.priorityQueues[this.prio].interrupt=!0,this.prio++;for(this.running=!0;this.prio>=t;){var n=e.isDeferred()||this.prio>t?1/0:e.getScheduleStep(),o=this.priorityQueues[this.prio],s=o.runUntil(e,n);if(this.nrProcessed+=o.nrProcessed,void 0===s)break;if(s===!0){if(e.scheduledAtPosition<0)break;this.prio>=t&&this.prio--}else if(this.isEmpty(t))break}this.running=i,this.prio=r}},e.prototype.suspendScheduling=function(){this.disabled++},e.prototype.resumeScheduling=function(){this.disabled--},e.prototype.schedule=function(e,t){if(0===this.disabled&&e.scheduledAtPosition===-1){var i=e.getSchedulePriority();if(this.priorityQueues[i].schedule(e,t),i>this.prio){if(logValues&&void 0===logPrototypes&&gSimpleLog.log("priority to",i),this.running)for(var r=this.prio;r<i;r++)this.priorityQueues[r].interrupt=!0;this.prio=i}this.scheduleTaskCalled||(globalContentTask.schedule(),this.scheduleTaskCalled=!0)}},e.prototype.unschedule=function(e){e.scheduledAtPosition>-1&&this.priorityQueues[e.getSchedulePriority()].unschedule(e)},e.prototype.hold=function(e){this.uncommitedWrites.push(e)},e.prototype.unhold=function(e){var t=this.uncommitedWrites.indexOf(e);assert(t>=0,"node should be on hold list"),this.uncommitedWrites.splice(t,1)},e.prototype.commitWrites=function(){gDebugBreak&&(breakIntoDebugger(),gDebugBreak=!1);for(var e=0;e!==this.uncommitedWrites.length;e++)debugWritesEval&&gSimpleLog.log("release",this.uncommitedWrites[e].toString()),this.uncommitedWrites[e].commit();this.uncommitedWrites.length=0,this.releaseLatched(),this.markEndOfEvaluationMoment()},e.prototype.latch=function(e){e.isLatched||(this.latchedWrites.push(e),e.isLatched=!0)},e.prototype.releaseLatched=function(){for(var e=0;e!==this.latchedWrites.length;e++){var t=this.latchedWrites[e];t.isLatched&&(debugWritesEval&&gSimpleLog.log("unlatch",t.toString()),t.isLatched=!1,t.release())}this.latchedWrites.length=0},e.prototype.addTimeSensitiveNode=function(e){e.isOnTimeQueue||(this.timeSensitiveNodes.push(e),e.isOnTimeQueue=!0,globalPreWriteNotificationTask.schedule())},e.prototype.removeTimeSensitiveNode=function(e){e.isOnTimeQueue&&(e.isOnTimeQueue=!1)},e.prototype.preWritesNotification=function(){for(var e=0;e<this.timeSensitiveNodes.length;e++){var t=this.timeSensitiveNodes[e];t.isOnTimeQueue&&(debugWritesEval&&gSimpleLog.log("preWriteNotify",t.toString()),t.preWriteNotification(this.cycle))}},e.prototype.markEndOfEvaluationMoment=function(){for(var e=[],t=0;t<this.timeSensitiveNodes.length;t++){var i=this.timeSensitiveNodes[t];i.isOnTimeQueue&&(i.isOnTimeQueue=!1,e.push(i))}this.timeSensitiveNodes.length=0;for(var t=0;t<e.length;t++){var i=e[t];debugWritesEval&&gSimpleLog.log("endOfEvaluation",i.toString()),i.endOfEvaluationCycleNotification(this.cycle)}this.cycle++},e.prototype.isEmpty=function(e){for(var t=e;t<this.priorityQueues.length;t++)if(!this.priorityQueues[t].isEmpty())return!1;return!0},e.prototype.isReady=function(){return 0===this.timeSensitiveNodes.length&&0===this.latchedWrites.length&&this.isEmpty(0)},e.prototype.defer=function(e){var t=e.getSchedulePriority();assert(e.scheduledAtPosition===-1,"unschedule before deferring"),this.deferredQueues[t].defer(e)},e.prototype.undefer=function(e){var t=e.getSchedulePriority();assert(e.scheduledAtPosition!==-1,"cannot undefer"),this.deferredQueues[t].undefer(e)},e.prototype.isDeferredEmpty=function(e){for(var t=e;t<this.deferredQueues.length;t++)if(this.deferredQueues[t].compact(),!this.deferredQueues[t].isEmpty()&&!this.deferredQueues[t].allInactive())return!1;return!0},e.prototype.printStatus=function(){function e(e){for(var t=0;t<e.length;t++)for(var i=e[t],r=i.low;r<=i.high;r++){var n=i.queue[r];if(void 0!==n)for(var o=n.pos;o<n.end;o++){var s=n.nodes[o];void 0!==s&&console.log(String(t),r,o,s.toString())}}}function t(e){for(var t=0;t<e.length;t++)for(var i=e[t],r=i.low;r<=i.high;r++){var n=i.queue[r];if(void 0!==n)for(var o=n.pos;o<n.end;o++){var s=n.nodes[o];if(void 0!==s){var a;a=s instanceof EvaluationNode?"#"+s.watcherId+"->"+s.allInputs().filter(function(e){return void 0!==e&&e.scheduledAtPosition!==-1}).map(function(e){return"#"+e.watcherId}).join(","):"unknown",s.isActive()||(a="*inactive* "+a),console.log(String(t),r,o,s.toString(),a)}}}}console.log("scheduled"),e(this.priorityQueues),console.log("deferred"),t(this.deferredQueues)},e.prototype.suspend=function(){this.suspendAllEvaluations=!0;for(var e=0;e<this.priorityQueues.length;e++)this.priorityQueues[e].interrupt=!0},e.prototype.resume=function(){this.suspendAllEvaluations=!1},e.prototype.setProgressIndicatorValue=function(e){this.progressIndicatorValue=e},e.prototype.getProgressIndicatorValue=function(){return this.progressIndicatorValue},e.prototype.printLoops=function(e,t){void 0===e&&(e=1/0),void 0===t&&(t=1/0);for(var i=this.deferredQueues,r="",n=0,o=0;o<i.length;o++)for(var s=i[o],a=s.low;a<=s.high;a++){var d=s.queue[a];if(void 0!==d)for(var u=d.pos;u<d.end;u++){var h=d.nodes[u];if(h instanceof EvaluationNode&&h.isActive()){var l="";if(h.collectLoopInfo(t,function(e){l+=e+"\n"})&&(r+=l+"\n",n++,n>=e))return r}}}return r},e}(),evaluationQueue=new EvaluationQueue,__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Point=function(){function e(){this.top=0,this.left=0}return e}(),Rect=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.width=0,t.height=0,t}return __extends(t,e),t}(Point),EdgeRect=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.right=0,t.bottom=0,t}return __extends(t,e),t}(Point),ContentPos=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Rect),Relative=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.error=new Point,t.exact=new Rect,t}return __extends(t,e),t}(ContentPos),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){
function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),FunctionNodeType;!function(e){e[e.none=0]="none",e[e.av=1]="av",e[e.boolGate=2]="boolGate",e[e.boolMatch=3]="boolMatch",e[e.qualifiers=4]="qualifiers",e[e.variant=5]="variant",e[e.functionApplication=6]="functionApplication",e[e.compiledFunctionApplication=7]="compiledFunctionApplication",e[e.query=8]="query",e[e.const=9]="const",e[e.orderedSet=10]="orderedSet",e[e.range=11]="range",e[e.subStringQuery=12]="subStringQuery",e[e.comparisonFunction=13]="comparisonFunction",e[e.storage=14]="storage",e[e.pointerStorage=15]="pointerStorage",e[e.messageQueue=16]="messageQueue",e[e.debugBreak=17]="debugBreak",e[e.paramStorage=18]="paramStorage",e[e.write=19]="write",e[e.project=20]="project",e[e.select=21]="select",e[e.cond=22]="cond",e[e.childAreas=23]="childAreas",e[e.stub=24]="stub",e[e.queryCycle=25]="queryCycle",e[e.defun=26]="defun",e[e.negation=27]="negation",e[e.classOfArea=28]="classOfArea",e[e.verificationFunction=29]="verificationFunction"}(FunctionNodeType||(FunctionNodeType={}));var gOutputChanged,PickQualifiedExpressionStrategy;!function(e){e[e.dont=0]="dont",e[e.pickOnlyTopVariant=1]="pickOnlyTopVariant",e[e.pickOnlyVariantAndEliminate=2]="pickOnlyVariantAndEliminate",e[e.alwaysPickDefun=3]="alwaysPickDefun",e[e.alwaysPick=4]="alwaysPick"}(PickQualifiedExpressionStrategy||(PickQualifiedExpressionStrategy={}));var pickQualifiedExpressionStrategy=PickQualifiedExpressionStrategy.pickOnlyTopVariant,logTypeChanges=!1,gCycleNr=0,maxNrCycles=void 0,exportLevel=0,gBuildSeqBreak={},gWritableMap={},FunctionNode=function(){function e(t,i,r,n){this.prio=0,this.writable=!1,this.hasWritableReference=!1,this.containsQualifiedExpression=!0,this.id=-1,this.localToArea=t,this.localToDefun=i,this.valueType=r,this.origExpr=n,this.cycleNr=gCycleNr,this.seqNr=e.seqNr++,this.seqNr in gBuildSeqBreak}return e.prototype.toString=function(){return"unknown FunctionNode"},e.prototype.toErrorString=function(){return void 0!==this.origExpr?this.origExpr.toCdlString():this.toString()},e.prototype.toFullString=function(){return this.toString()},e.prototype.formatList=function(e,t,i,r){if(0===e.length)return r;for(var n="string"==typeof e[0]?e[0]:e[0].toCDLString(void 0),o=void 0!==i?i+"    ":void 0,s=void 0===i||t?r[0]+n:r[0]+"\n"+o+n,a=1;a<e.length;a++)s+=void 0===i?", ":",\n"+o,s+="string"==typeof e[a]?e[a]:e[a].toCDLString(o);return void 0===i||1===e.length&&t?s+r[1]:s+"\n"+i+r[1]},e.prototype.formatArray=function(e,t,i){return this.formatList(e,t,i,"[]")},e.prototype.formatCDLFunctionCall=function(e,t,i){return this.formatArray([e].concat(t),!0,i)},e.prototype.formatCDLConstructor=function(e,t,i){return e+this.formatList(t,!1,i,"()")},e.prototype.constructPrototypeFunctionCall=function(e){var t=this.toExportString(e);return this.writable&&this.isWritableAware()&&(t+="\n_owp("+this.localityString()+")"),0===this.prio||this instanceof ConstNode||(t+="\n_sp("+(this.localToDefun?String(this.localToDefun):"0")+", "+this.prio+")"),"schedulingError"in this&&(t+="\n_se("+this.localityString()+")"),t},e.prototype.type=function(){return FunctionNodeType.none},e.prototype.hasSameVariantLocalityAs=function(e){return 0===this.localToDefun&&0===e.localToDefun||this.localToArea===e.localToArea&&this.localToDefun===e.localToDefun},e.prototype.isEqual=function(e){return this===e||this.type()===e.type()&&this.localToArea===e.localToArea&&this.localToDefun===e.localToDefun&&(this.id>=0&&e.id>=0&&this.id===e.id||!(this.id>=0&&e.id>=0)&&this.specificEqual(e))},e.prototype.specificEqual=function(e){return!1},e.prototype.maxScheduleStep=function(e,t){return assert(this.prio>=e,"inputs should not have lower priority"),this.prio>e?t:this.scheduleStep>t?this.scheduleStep:t},e.prototype.isScheduledBefore=function(e){return this.prio>e.prio||this.prio===e.prio&&this.scheduleStep<e.scheduleStep},e.prototype.isScheduledProperly=function(){var e=this;return this.allInputs().every(function(t){return!("schedulingError"in t)&&t.isScheduledBefore(e)})},e.prototype.setSchedulingError=function(){this.schedulingError||(this.schedulingError=!0,this.allInputs().forEach(function(e){e.setSchedulingError()}))},e.prototype.isEmptyOS=function(){return!1},e.prototype.isAlwaysTrue=function(){return!1},e.prototype.isAlwaysFalse=function(){return!1},e.prototype.isUnmergeable=function(){return!1},e.prototype.isNull=function(){return!1},e.prototype.isAlwaysUndefined=function(){return!1},e.prototype.conditionalSingleArea=function(){},e.prototype.replaceConditionalResult=function(e,t){return this},e.prototype.dependsOn=function(e,t){return!1},e.cache2str=function(){return e.cacheDbg.map(function(t,i){var r;return r=t instanceof e?String(i)+". "+t.idStr()+" "+t.toString():t instanceof AreaTemplate?String(i)+". template "+t.id+" "+getShortChildPath(t.areaNode.getPath())+" stage: "+t.cacheStage[i]:"<unknown>"}).reverse().join("\n")},e.printCycleError=function(t){for(var i=e.cacheDbg.length-t;i<e.cacheDbg.length;i++){var r,n=e.cacheDbg[i];r=n instanceof e?String(i)+". "+n.idStr()+" "+n.toErrorString():n instanceof AreaTemplate?String(i)+". template "+n.id+" "+getShortChildPath(n.areaNode.getPath())+" stage: "+n.cacheStage[i]:"<unknown>",console.log("// loop:",r)}},e.cycleAnalysis=function(){for(var t=e.cacheDbg,i=t.length,r=1;r<i/2;r++){for(var n=!0,o=i-r,s=i-2*r,a=0;n&&a<r;a++)n=t[o+a]===t[s+a];if(n)return Utilities.syntaxError("Cycle error"),e.printCycleError(r),!0}return!1},e.findInCacheStack=function(t,i){for(var r=e.cacheDbg.length-i-1;r>=0;r--)if(e.cacheDbg[r]===t)return e.cacheDbg.length-r;return-1},e.variantCycleCheck=function(t,i,r){if(assert(void 0===t||t.cycleNr===gCycleNr,"debugging"),void 0===t||t.id===-6||t.id>=0)return t;if(void 0!==e.cacheDbg&&(e.cacheDbg.push(t),e.cacheDbg.length>=e.maxCacheDepth&&e.cycleAnalysis()))return t;if(t instanceof StubFunctionNode)return e.variantCycleCheck(t.resolution,i,r);try{t.getMaximumInputId(i,e.variantCycleCheck,!1)}catch(t){throw void 0!==e.cacheDbg&&e.cacheDbg.pop(),t}return t.id=-6,t.postCache(i,e.variantCycleCheck),void 0!==e.cacheDbg&&e.cacheDbg.pop(),t},e.cache=function(t,i,r){if(assert(void 0===t||t.cycleNr===gCycleNr,"debugging"),void 0===t||t.id>=0)return t;if(void 0!==e.cacheDbg&&(e.cacheDbg.push(t),e.cacheDbg.length>=e.maxCacheDepth&&e.cycleAnalysis()))return t;if(t instanceof StubFunctionNode)return e.cache(t.resolution,i,r);var n;if(t.localToArea){var o=areaTemplates[t.localToArea];assert(o.doesExist,"no cache for non-existing templates"),t.localToDefun?t.localToDefun in o.defunFunctionNodes?n=o.defunFunctionNodes[t.localToDefun]:(n=[],o.defunFunctionNodes[t.localToDefun]=n):n=o.functionNodes}else t.localToDefun?t.localToDefun in e.globalDefunFunctionNodes?n=e.globalDefunFunctionNodes[t.localToDefun]:e.globalDefunFunctionNodes[t.localToDefun]=n=[]:n=e.globalFunctionNodes;for(var s=t.getMaximumInputId(i,e.cache,!0),a=s+1;a<n.length;a++){var d=n[a];if(t.isEqual(d))return r||t.valueType.isEqualOrUnknown(d.valueType)||t.isEmptyOS()&&d.isEmptyOS()||Utilities.error("different valueType in cache for #"+t.seqNr+" and #"+d.seqNr+": "+d.toString()),void 0!==e.cacheDbg&&e.cacheDbg.pop(),d}return t.id=n.length,n.push(t),t.isScheduledProperly()||(t.schedulingError=!0),t.postCache(i,e.cache),void 0!==e.cacheDbg&&e.cacheDbg.pop(),t},e.prototype.postCache=function(e,t){},e.cacheDirectly=function(t){for(var i=t.localToArea?areaTemplates[t.localToArea].functionNodes:e.globalFunctionNodes,r=0;r<i.length;r++){var n=i[r];if(t.isEqual(n))return t.valueType.isEqualOrUnknown(n.valueType)||Utilities.error("different valueType in cache"),n}return t.id=i.length,i.push(t),t},e.prototype.idStr=function(){return(this.id!==-1?"%"+this.id:"#"+this.seqNr)+(this.localToArea?"L"+this.localToArea:"G")+(this.localToDefun?"D"+this.localToDefun:"")+(this.writable?"<W>":"")},e.prototype.localityString=function(){return String(this.scheduleStep)+", "+(this.localToDefun?String(this.localToDefun):"0")},e.prototype.idExpStr=function(e,t){void 0===t&&(t=void 0);var i="_n";switch(t){case!1:i+="f";break;case!0:i+="t"}return this.localToDefun&&(i+="d"),assert(this.id>=0,"should be cached by now"),i+"("+String(this.getEmbeddingLevel(e))+(this.localToDefun?","+String(this.localToDefun)+",":",")+this.id+")"},e.prototype.getEmbeddingLevel=function(e){if(void 0!==this.localToArea){for(var t=0;e!==this.localToArea;)e=areaTemplates[e].parent.id,t++;return t}},e.prototype.outputStr=function(){return void 0===this.valueType?"<UNDEFINED>":this.valueType.toString()},e.prototype.isSingleString=function(){return!1},e.prototype.updateOutput=function(e){void 0!==this.valueType&&this.valueType.isEqual(e)||(signalOutputChange(void 0,{type:"valueTypeChange",origType:this.valueType,newType:e}),this.valueType=e)},e.prototype.mergeOutput=function(e){if(void 0===this.valueType)signalOutputChange(void 0,{type:"valueTypeChange",origType:void 0,newType:e}),this.valueType=e;else if(!this.valueType.subsumes(e)){var t=this.valueType.merge(e);signalOutputChange(void 0,{type:"valueTypeChange",origType:this.valueType,newType:t}),this.valueType=t}},e.prototype.outdated=function(){return this.cycleNr!==gCycleNr},e.prototype.updateCycle=function(){this.cycleNr!==gCycleNr&&(this.cycleNr=gCycleNr,this.writable=!1)},e.prototype.isWritableAware=function(){return!1},e.prototype.writabilityUndetermined=function(){return!this.writeCheckStatus&&(this.writeCheckStatus=!0,!0)},e.prototype.makeEvaluationNode=function(e){},e.prototype.allLocalInputs=function(){return this.allInputs()},e.prototype.functionIsConstant=function(){return!0},e.prototype.getConstancy=function(){var e;if("isConstant"in this)return this.isConstant;this.isConstant=!1,e=this.functionIsConstant();for(var t=this.allInputs(),i=0;i!==t.length;i++)if(void 0!==t[i])switch(t[i].getConstancy()){case void 0:e===!0&&(e=void 0);break;case!1:e=!1}return this.isConstant=e,e},e.prototype.canMergeUnderQualifier=function(e){return!1},e.prototype.mergeUnderQualifier=function(e){Utilities.error("implement in derived class when canMergeUnderQualifier returns true")},e.prototype.valueUnderQualifier=function(e,t){return this},e.prototype.pickQualifiedExpression=function(e,t,i){return this},e.prototype.checkForQualifiedExpressions=function(){if(doCompileTimeChecks){for(var e=this.allLocalInputs(),t=0;t<e.length;t++){var i=e[t];if(i.containsQualifiedExpression)return void(this.containsQualifiedExpression=!0)}this.containsQualifiedExpression=!1}},e.prototype.isQualifiedFor=function(e){return void 0!==e&&this.containsQualifiedExpression},e.prototype.getSortKeys=function(){return Utilities.syntaxError("area sorting only supported with known paths"),[]},e.prototype.getBoolInterpretation=function(){return"dataSource"in this.valueType?FunctionApplicationNode.buildFunctionApplication(bool,[this],this.localToArea,this.localToDefun,void 0,void 0):this},e.prototype.setDefunArgTypes=function(e,t){},e.prototype.removePairPointElementMe=function(e,t){return this},e.prototype.getFullQualifierList=function(e,t){if(this.localToArea!==e)return[];if(void 0!==t[this.id])return t[this.id];assert(t.length===this.id,"debug"),t.push([]);for(var i=[],r=this.allLocalInputs(),n=0;n<r.length;n++){var o=r[n].getFullQualifierList(e,t);if(0!==o.length)if(0===i.length)i=o;else{for(var s=[],a=0;a<o.length;a++)for(var d=0;d<i.length;d++)qOr(s,qAnd(o[a],i[d]),void 0,void 0);i=s}}return t.pop(),assert(t.length===this.id,"debug"),qSimplify(i,void 0)},e.prototype.traceDataSource=function(e){var t=this.getDataSourceInputs(),i={};if(!(this.seqNr in e)){var r=this;e[this.seqNr]=!0,console.log(this.seqNr+' [label="'+this.idStr()+'"];');for(var n=0;n<t.length;n++){var o=t[n];if(!(o.seqNr in i)){var s=void 0;i[o.seqNr]=!0,r instanceof VariantFunctionNode&&(s=r.qualifiers.qualifiersToCDLString(n)),console.log(this.seqNr+" -> "+o.seqNr+(void 0===s?"":' [label="'+s+'"]')+";"),o.traceDataSource(e)}}}},e.prototype.markAsResolution=function(e){return this},e.prototype.getExistenceConditionForTemplate=function(e){},e.prototype.isStrictSelection=function(){return this.valueType.isStrictSelection()},e.prototype.extractWritableDestinations=function(e,t){return[]},e.prototype.localityCompatibleWith=function(e){return testMergeLocality(this.localToArea,e.localToArea)&&testMergeDefunLocality(this.localToDefun,e.localToDefun)},e.prototype.mightChange=function(){return this},e.prototype.tagExpressionPath=function(e,t,i){this.setExpressionPathTag(i)},e.prototype.setExpressionPathTag=function(e){var t=void 0===this.localToArea?0:this.localToArea,i=this.localToDefun,r=this.id,n=functionNodeToExpressionPaths[t],o=n[i];void 0===o&&(o=n[i]=[]);var s=o[r];void 0===s&&(s=o[r]=[]);for(var a=0;a<s.length;a+=2)if(s[a]===t&&functionNodeToExpressionPathsStringCache[s[a+1]]===e)return;s.push(t),s.push(this.getFunctionNodeStringCacheId(e))},e.prototype.getFunctionNodeStringCacheId=function(t){var i=e.functionNodeStringCacheMap[t];return void 0===i&&(i=functionNodeToExpressionPathsStringCache.length,e.functionNodeStringCacheMap[t]=i,functionNodeToExpressionPathsStringCache.push(t)),i},e}();FunctionNode.globalFunctionNodes=[],FunctionNode.globalDefunFunctionNodes={},FunctionNode.seqNr=1,FunctionNode.cacheDbg=[],FunctionNode.maxCacheDepth=2500,FunctionNode.writabilityQueue=[],FunctionNode.functionNodeStringCacheMap={};var AVFunctionNode=function(e){function t(t,i,r,n,o,s,a){var d=e.call(this,i,r,n,o)||this;return d.attributes=t,d.suppressSet=s,d.suppressSetAttr=a,d.checkForQualifiedExpressions(),d}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.av},t.prototype.specificEqual=function(e){if(!!this.suppressSet!=!!e.suppressSet)return!1;for(var t in e.attributes)if(!(t in this.attributes))return!1;for(var t in this.attributes)if(!(t in e.attributes&&this.attributes[t].isEqual(e.attributes[t])))return!1;return!0},t.prototype.getMaximumInputId=function(e,t,i){var r=-1,n=this.localToArea?areaTemplates[this.localToArea].getScheduleStep(e,t):-1;for(var o in this.attributes)this.attributes[o]=t(this.attributes[o],e,!1),this.attributes[o].localToArea===this.localToArea&&this.attributes[o].id>r&&(r=this.attributes[o].id),n=this.attributes[o].maxScheduleStep(this.prio,n);return i&&(this.scheduleStep=n+1),r},t.prototype.toString=function(){var e="{";for(var t in this.attributes)1!==e.length&&(e+=", "),e+=t+":"+this.attributes[t].idStr();return e+"}"},t.prototype.toFullString=function(){var e="{";for(var t in this.attributes)1!==e.length&&(e+=", "),e+=t+":"+this.attributes[t].toFullString();return e+"}"},t.prototype.toCDLString=function(e){void 0===e&&(e=void 0);var t="{",i=void 0!==e?e+"  ":void 0,r=void 0!==e?e+"    ":void 0;for(var n in this.attributes)void 0!==i?(1!==t.length&&(t+=","),t+="\n"+i):1!==t.length&&(t+=", "),t+=n+": "+this.attributes[n].toCDLString(r);return void 0===e?t+"}":t+"\n"+e+"}"},t.prototype.toExportString=function(e){var t="_a("+this.localityString()+", {",i=!0;for(var r in this.attributes){var n=jsIdentifierRegExp.test(r)&&"class"!==r?r:JSON.stringify(r);i?i=!1:t+=", ",t+=n+":"+this.attributes[r].idExpStr(e,this.suppressSetAttr[r])}return t+"}, "+String(this.suppressSet)+")"},t.prototype.markWritablePath=function(){if(this.writabilityUndetermined()){this.writable=!0;for(var e in this.attributes)this.attributes[e].markWritablePath();FunctionNode.writabilityQueue.push(this)}},t.prototype.checkWritability=function(){for(var e in this.attributes)if(this.attributes[e].writable)return void(this.writable=!0)},t.prototype.setPriority=function(e){this.prio=e;for(var t in this.attributes)this.attributes[t].setPriority(e)},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationAV(this,e);e.evaluationNodes[this.localToDefun][this.id]=t;for(var i in this.attributes)t.addAttribute(i,getEvaluationNode(this.attributes[i],e));return t},t.prototype.allInputs=function(){return objValues(this.attributes)},t.prototype.canMergeUnderQualifier=function(e){if(!(e instanceof t)||this.localToArea!==e.localToArea||this.localToDefun!==e.localToDefun||this.isConstant!==e.isConstant||this.suppressSet!==e.suppressSet)return!1;var i,r=e;for(i in this.suppressSetAttr)if(i in r.suppressSetAttr&&this.suppressSetAttr[i]!==r.suppressSetAttr[i])return!1;for(i in this.attributes)if(i in r.attributes&&!this.attributes[i].canMergeUnderQualifier(r.attributes[i]))return!1;return!0},t.prototype.mergeUnderQualifier=function(e){var i,r={},n=this.localToArea,o=this.localToDefun,s=this.valueType.merge(e.valueType),a=this.suppressSet,d={},u=e;for(i in this.suppressSetAttr)d[i]=this.suppressSetAttr[i];for(i in u.suppressSetAttr)d[i]=u.suppressSetAttr[i];for(i in this.attributes)i in u.attributes?r[i]=this.attributes[i].mergeUnderQualifier(u.attributes[i]):r[i]=this.attributes[i];for(i in u.attributes)i in this.attributes||(r[i]=u.attributes[i]);return new t(r,n,o,s,e.origExpr,a,d)},t.build=function(e,i,r,n){var o=void 0,s=0,a={},d=!0,u=!0;for(var h in e){var l=e[h];l instanceof ConstNode?u=u&&l.wontChangeValue:(d=!1,l.valueType.dataSource&&(i||r[h])&&(e[h]=new FunctionApplicationNode(singleValue,[l],l.localToArea,l.localToDefun,l.valueType.copy().removeDataSource(),l.origExpr,void 0))),a[h]=l.valueType,o=mergeLocality(o,l.localToArea),s=mergeDefunLocality(s,l.localToDefun)}if(d){var c={};for(var h in e){var l=e[h];c[h]=l.value}return buildConstNode(c,u,i,0,n)}return new t(e,o,s,(new ValueType).addObject(a).addSize(1),n,i,r)},t.prototype.pickQualifiedExpression=function(e,i,r){var n={},o=!1;if(pickQualifiedExpressionStrategy<PickQualifiedExpressionStrategy.alwaysPick&&(pickQualifiedExpressionStrategy!==PickQualifiedExpressionStrategy.alwaysPickDefun||0===this.localToDefun))return this;for(var s in this.attributes){var a=this.attributes[s].containsQualifiedExpression&&this.attributes[s].hasSameVariantLocalityAs(this)?this.attributes[s].pickQualifiedExpression(e,i,r):this.attributes[s];this.attributes[s]!==a&&(o=!0),void 0===a||a.isAlwaysUndefined()||(n[s]=a)}return o?t.build(n,this.suppressSet,this.suppressSetAttr,this.origExpr):this},t.prototype.isAlwaysTrue=function(){return!0},t.prototype.getSortKeys=function(){var e=[];for(var t in this.attributes){var i=this.attributes[t];if("object"in i.valueType){var r=this.attributes[t].getSortKeys();e=e.concat(r.map(function(e){return[t].concat(e)}))}else e.push([t])}return e},t.prototype.getDataSourceInputs=function(){return[]},t.prototype.isStrictSelection=function(){for(var e in this.attributes)if(!this.attributes[e].isStrictSelection())return!1;return!0},t.prototype.extractWritableDestinations=function(e,t){var i;return this.seqNr in t?[]:(e.length>0&&e[0]in this.attributes?(t[this.seqNr]=!0,i=this.attributes[e[0]].extractWritableDestinations(e.slice(1),t),delete t[this.seqNr]):i=[],i)},t.buildAV=function(e,i,r,n,o,s,a,d){if(n){var u={};for(var h in e){var l=e[h];void 0!==l.value&&(u[h]=l.value)}return new ConstNode(u,getValueTypeFromConstant(u),d,s,o)}var c={};for(var h in e){var p=e[h];c[h]=p.valueType,p.valueType.dataSource&&(s||a[h])&&(e[h]=new FunctionApplicationNode(singleValue,[p],p.localToArea,p.localToDefun,p.valueType.copy().removeDataSource(),p.origExpr,void 0))}return new t(e,i,r,(new ValueType).addObject(c).addSize(1),d,s,a)},t.prototype.tagExpressionPath=function(t,i,r){e.prototype.tagExpressionPath.call(this,t,i,r);for(var n in this.attributes)this.attributes[n].tagExpressionPath(t,i,r+"."+n)},t}(FunctionNode),BoolGateNode=function(e){function t(t,i,r,n,o){var s=e.call(this,r,n,i.valueType,o)||this;return s.a=t,s.b=i,doCompileTimeChecks&&(s.checkForQualifiedExpressions(),s.hasWritableReference=i.hasWritableReference),s}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.boolGate},t.prototype.specificEqual=function(e){return this.a.isEqual(e.a)&&this.b.isEqual(e.b)},t.prototype.getMaximumInputId=function(e,t,i){var r=-1,n=this.localToArea?areaTemplates[this.localToArea].getScheduleStep(e,t):-1;return this.a=t(this.a,e,!1),this.a.localToArea===this.localToArea&&this.a.id>r&&(r=this.a.id),n=this.a.maxScheduleStep(this.prio,n),this.b=t(this.b,e,!1),this.b.localToArea===this.localToArea&&this.b.id>r&&(r=this.b.id),i&&(n=this.b.maxScheduleStep(this.prio,n),this.scheduleStep=n+1),r},t.prototype.toString=function(){return this.a.idStr()+" => "+this.b.idStr()},t.prototype.toFullString=function(){return this.a.toFullString()+" => "+this.b.toFullString()},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),this.formatCDLFunctionCall("gate",[this.a,this.b],e)},t.prototype.toExportString=function(e){return"_bg("+this.localityString()+", "+this.a.idExpStr(e)+", "+this.b.idExpStr(e)+")"},t.prototype.markWritablePath=function(){this.writabilityUndetermined()&&(this.writable=!0,this.b.markWritablePath(),FunctionNode.writabilityQueue.push(this))},t.prototype.checkWritability=function(){this.b.writable&&(this.writable=!0)},t.prototype.setPriority=function(e){e<=this.prio||(this.prio=e,this.a.setPriority(e),this.b.setPriority(e))},t.prototype.isUnmergeable=function(){return this.b.isUnmergeable()},t.prototype.conditionalSingleArea=function(){var e=levelOfEmbeddingFun(this.b,this.b.localToArea);return void 0===e||e.min!==e.max?void 0:areaTemplates[this.b.localToArea].getEmbedding(e.min).id},t.prototype.replaceConditionalResult=function(e,i){return t.build(this.a,e,this.origExpr)},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationBoolGate(this,e);return e.evaluationNodes[this.localToDefun][this.id]=t,t.setA(getEvaluationNode(this.a,e)),t},t.prototype.allInputs=function(){return[this.a,this.b]},t.prototype.pickQualifiedExpression=function(e,i,r){if(pickQualifiedExpressionStrategy<PickQualifiedExpressionStrategy.alwaysPick&&(pickQualifiedExpressionStrategy!==PickQualifiedExpressionStrategy.alwaysPickDefun||0===this.localToDefun))return this;var n=this.a.containsQualifiedExpression&&this.a.hasSameVariantLocalityAs(this)?this.a.pickQualifiedExpression(e,i,r).getBoolInterpretation():this.a,o=this.b.containsQualifiedExpression&&this.b.hasSameVariantLocalityAs(this)?this.b.pickQualifiedExpression(e,i,r):this.b;return n===this.a&&o===this.b?this:t.build(n,o,this.origExpr)},t.build=function(e,i,r){if(e.isAlwaysTrue())return i;if(e.isAlwaysFalse()||i.isAlwaysFalse())return buildConstNode([],inputsWontChangeValue([e,i]),void 0,0,r);if(e instanceof VariantFunctionNode){for(var n=[],o=!0,s=e,a=0;o&&a<s.functionNodes.length;a++)s.functionNodes[a].isAlwaysTrue()?n.push(a):s.functionNodes[a].isAlwaysFalse()||(o=!1);if(o&&(1===n.length||n.length>1&&i.isUnmergeable())){for(var d=[],u=[],a=0;a<n.length;a++)d.push(s.qualifiers.qualifiers[n[a]]),u.push(i);return VariantFunctionNode.build(d,u,0,void 0,!1,void 0)}}else e instanceof t&&i.isAlwaysTrue()&&(e=e.a);var h=mergeLocality(e.localToArea,i.localToArea),l=mergeDefunLocality(e.localToDefun,i.localToDefun);return new t(e.getBoolInterpretation(),i,h,l,r)},t.prototype.getBoolInterpretation=function(){return this.b.isAlwaysTrue()?this.a:this.b.isAlwaysFalse()?this.b.getBoolInterpretation():this},t.prototype.setDefunArgTypes=function(e,t){this.seqNr in t||(t[this.seqNr]=!0,this.b.setDefunArgTypes(e,t),delete t[this.seqNr])},t.prototype.getDataSourceInputs=function(){return[this.b]},t.prototype.extractWritableDestinations=function(e,t){var i;return this.seqNr in t?[]:(t[this.seqNr]=!0,i=this.b.extractWritableDestinations(e,t),delete t[this.seqNr],i)},t}(FunctionNode),BoolMatchNode=function(e){function t(t,i,r,n,o,s,a){var d=e.call(this,n,o,s,a)||this;return d.a=t,d.b=i,d.c=r,doCompileTimeChecks&&(d.hasWritableReference=r.hasWritableReference,d.checkForQualifiedExpressions()),d}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.boolMatch},t.prototype.specificEqual=function(e){return this.a.isEqual(e.a)&&this.b.isEqual(e.b)&&this.c.isEqual(e.c)},t.prototype.getMaximumInputId=function(e,t,i){var r=-1,n=this.localToArea?areaTemplates[this.localToArea].getScheduleStep(e,t):-1;return this.a=t(this.a,e,!1),this.a.localToArea===this.localToArea&&this.a.id>r&&(r=this.a.id),this.b=t(this.b,e,!1),this.b.localToArea===this.localToArea&&this.b.id>r&&(r=this.b.id),this.c=t(this.c,e,!1),this.c.localToArea===this.localToArea&&this.c.id>r&&(r=this.c.id),i&&(this.scheduleStep=Math.max(n,Math.max(this.a.scheduleStep,Math.max(this.b.scheduleStep,this.c.scheduleStep)))+1),r},t.prototype.toString=function(){return this.a.idStr()+" ~= "+this.b.idStr()+" -> "+this.c.idStr()},t.prototype.toFullString=function(){return this.a.toFullString()+" ~= "+this.b.toFullString()+" -> "+this.c.toFullString()},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),this.formatCDLFunctionCall("match",[this.a,this.b,this],e)},t.prototype.toExportString=function(e){return"_bm("+this.localityString()+", "+this.a.idExpStr(e)+", "+this.b.idExpStr(e)+", "+this.c.idExpStr(e)+")"},t.prototype.markWritablePath=function(){Utilities.warnOnce("cannot write through bool match")},t.prototype.setPriority=function(e){e<=this.prio||(this.prio=e,this.a.setPriority(e),this.b.setPriority(e),this.c.setPriority(e))},t.prototype.isUnmergeable=function(){return this.c.isUnmergeable()},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationBoolMatch(this,e);return e.evaluationNodes[this.localToDefun][this.id]=t,t.setArguments(getEvaluationNode(this.a,e),getEvaluationNode(this.b,e),getEvaluationNode(this.c,e)),t},t.prototype.allInputs=function(){return[this.a,this.b,this.c]},t.prototype.pickQualifiedExpression=function(e,i,r){if(pickQualifiedExpressionStrategy<PickQualifiedExpressionStrategy.alwaysPick&&(pickQualifiedExpressionStrategy!==PickQualifiedExpressionStrategy.alwaysPickDefun||0===this.localToDefun))return this;var n=this.a.containsQualifiedExpression&&this.a.hasSameVariantLocalityAs(this)?this.a.pickQualifiedExpression(e,i,r):this.a,o=this.b.containsQualifiedExpression&&this.b.hasSameVariantLocalityAs(this)?this.b.pickQualifiedExpression(e,i,r):this.b,s=this.c.containsQualifiedExpression&&this.c.hasSameVariantLocalityAs(this)?this.c.pickQualifiedExpression(e,i,r):this.c,a=mergeLocality(n.localToArea,mergeLocality(o.localToArea,s.localToArea)),d=mergeDefunLocality(n.localToDefun,mergeDefunLocality(o.localToDefun,s.localToDefun));return n===this.a&&o===this.b&&s===this.c?this:new t(n,o,s,a,d,s.valueType,this.origExpr)},t.prototype.setDefunArgTypes=function(e,t){this.seqNr in t||(t[this.seqNr]=!0,this.c.setDefunArgTypes(e,t),delete t[this.seqNr])},t.prototype.getDataSourceInputs=function(){return[this.c]},t.prototype.extractWritableDestinations=function(e,t){var i;return this.seqNr in t?[]:(t[this.seqNr]=!0,i=this.c.extractWritableDestinations(e,t),delete t[this.seqNr],i)},t.prototype.checkWritability=function(){this.c.writable&&(this.writable=!0)},t}(FunctionNode),SingleQualifier=function(){function e(e,t,i,r,n,o){this.functionNode=doCompileTimeChecks&&"boolean"==typeof i?e.getBoolInterpretation():e,this.attribute=t,this.value=i,"object"==typeof i&&(i instanceof MoonOrderedSet?i.os.every(function(e){return typeof e in simpleTypes})||Utilities.syntaxError("only constant, simple values in qualifier os"):i instanceof MoonRange?i.os.every(function(e){return typeof e in simpleTypes})||Utilities.syntaxError("only const, simple values in qualifier range"):Utilities.syntaxError("only simple value queries in qualifiers")),void 0===n?(this.originalAttribute=t,this.originalValue=i):(this.originalAttribute=n,this.originalValue=o),this.localToArea=r}return e.prototype.isEqualSym=function(t){return this.attribute===t.attribute&&e.equalValue(this.value,t.value)&&this.localToArea===t.localToArea},e.prototype.mismatch=function(t){return this.originalAttribute===t.originalAttribute&&e.match(this.originalValue,t.originalValue)===!1&&this.localToArea===t.localToArea},e.prototype.getOriginatingAreaTemplate=function(){return areaTemplates[this.localToArea]},e.prototype.isEqual=function(t){return this.attribute===t.attribute&&e.equalValue(this.value,t.value)&&this.localToArea===t.localToArea&&this.functionNode.isEqual(t.functionNode)},e.prototype.toString=function(){return this.functionNode.idStr()+":"+String(this.value)},e.prototype.toSymString=function(){return this.originalAttribute+"@"+(this.localToArea>0?String(this.localToArea):"global")+":"+cdlify(this.originalValue)},e.prototype.toFullString=function(){return this.functionNode.toFullString()+":"+String(this.value)},e.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),this.originalAttribute+":"+cdlify(this.originalValue)},e.sToSymString=function(e){return e.toSymString()},e.prototype.toExportString=function(e){var t=this.value instanceof MoonRange?this.value.toString():this.value instanceof MoonOrderedSet?this.value.toString():safeJSONStringify(this.value);return addDebugInformation>0?"_gx("+this.functionNode.idExpStr(e)+", "+JSON.stringify(this.attribute)+", "+this.localToArea+", "+t+")":"_g("+this.functionNode.idExpStr(e)+", "+t+")"},e.prototype.copy=function(){return new e(this.functionNode,this.attribute,this.value,this.localToArea,this.originalAttribute,this.originalValue)},e.prototype.setPriority=function(e){this.functionNode.setPriority(e)},e.isGlobal=function(e){return void 0===e.functionNode.localToArea},e.locality=function(e){for(var t=void 0,i=0;i<e.length;i++)t=mergeLocality(t,e[i].functionNode.localToArea);return t},e.getQualifierValue=function(e,t,i){if(void 0!==e)for(var r=0;r<e.length;r++)if(e[r].originalAttribute===t&&e[r].localToArea===i)return e[r].originalValue},e.match=function(e,t){if(e instanceof MoonOrderedSet){if(t instanceof MoonOrderedSet){var i=t.os.filter(function(t){return e.os.indexOf(t)>=0});return i.length===t.os.length||0!==i.length&&void 0}return t instanceof MoonRange?e.os.some(function(e){return t.containsSimpleValue(e)}):e.os.indexOf(t)>=0}return e===!0?!!isCDLTrue(t)||!isCDLFalse(t)&&void 0:e===!1?!isCDLTrue(t)&&(!!isCDLFalse(t)||void 0):t instanceof MoonOrderedSet?!!(t.os.length>0&&t.os.every(function(t){return t===e}))||void 0:e instanceof MoonRange&&t instanceof MoonRange?e.rangesOverlap(t):t instanceof MoonRange&&isSimpleType(e)?void 0:e instanceof MoonRange&&isSimpleType(t)?e.containsSimpleValue(t):(assert(isSimpleType(e)&&isSimpleType(t),"expecting simple values"),e===t)},e.prototype.matchAgainst=function(t,i){var r=e.getQualifierValue(t,this.originalAttribute,this.localToArea);if(void 0!==r){var n=e.match(this.originalValue,r);if(void 0!==n)return n}if(void 0!==i)for(var o=0;o<i.length;o++)if(1===i[o].length&&this.isEqualSym(i[o][0]))return!1},e.equalValue=function(e,t){return e instanceof MoonOrderedSet&&t instanceof MoonOrderedSet?t.os.every(function(t){return e.os.some(function(e){return e===t})})&&e.os.every(function(e){return t.os.some(function(t){return e===t})}):e instanceof MoonOrderedSet?e.os.length>0&&e.os.every(function(e){return e===t}):t instanceof MoonOrderedSet?t.os.length>0&&t.os.every(function(t){return e===t}):e instanceof MoonRange&&t instanceof MoonRange?e.isEqual(t):!(!isSimpleType(e)||!isSimpleType(t))&&e===t},e.notAlwaysTrue=function(e){var t=e.functionNode;return t instanceof ConstNode?!interpretedBoolMatch(e.value,t.value):e.value===!0?!t.isAlwaysTrue():e.value!==!1||!t.isAlwaysFalse()},e.alwaysFalse=function(e){var t=e.functionNode;return t instanceof ConstNode?!interpretedBoolMatch(e.value,t.value):e.value===!0?t.isAlwaysFalse():e.value===!1&&t.isAlwaysTrue()},e.prototype.simplifyBooleanVariant=function(){return this.value===!0&&this.functionNode instanceof VariantFunctionNode&&1===this.functionNode.functionNodes.length&&this.functionNode.functionNodes[0].isAlwaysTrue()?this.functionNode.qualifiers.qualifiers[0]:[this]},e}(),QualifiersFunctionNode=function(e){function t(t,i,r){var n=e.call(this,i,r,boolValueType,void 0)||this;return n.qualifiers=t,doCompileTimeChecks&&(n.containsQualifiedExpression=t.length>1||1===t.length&&t[0].length>0),n}return __extends(t,e),t.prototype.add=function(e){this.qualifiers.push(e)},t.prototype.type=function(){return FunctionNodeType.qualifiers},t.prototype.identicalQualifiers=function(e){
if(this.qualifiers.length!==e.qualifiers.length)return!1;for(var t=0;t!==this.qualifiers.length;t++){if(this.qualifiers[t].length!==e.qualifiers[t].length)return!1;for(var i=0;i<this.qualifiers[t].length;i++)if(!this.qualifiers[t][i].isEqual(e.qualifiers[t][i]))return!1}return!0},t.prototype.specificEqual=function(e){return this.qualifiers.length===e.qualifiers.length&&this.identicalQualifiers(e)},t.prototype.getMaximumInputId=function(e,t,i){for(var r=-1,n=this.localToArea?areaTemplates[this.localToArea].getScheduleStep(e,t):-1,o=0;o!==this.qualifiers.length;o++)for(var s=0;s!==this.qualifiers[o].length;s++)this.qualifiers[o][s].functionNode=t(this.qualifiers[o][s].functionNode,e,!1),this.qualifiers[o][s].functionNode.localToArea===this.localToArea&&this.qualifiers[o][s].functionNode.id>r&&(r=this.qualifiers[o][s].functionNode.id),n=this.qualifiers[o][s].functionNode.maxScheduleStep(this.prio,n);return i&&(this.scheduleStep=n+1),r},t.prototype.qualifiersToString=function(e){return"{"+this.qualifiers[e].map(function(e){return e.toString()}).join(", ")+"}"},t.prototype.qualifiersToFullString=function(e){return"{"+this.qualifiers[e].map(function(e){return e.toFullString()}).join(", ")+"}"},t.prototype.qualifiersToCDLString=function(e){return"{"+this.qualifiers[e].map(function(e){return e.toCDLString()}).join(", ")+"}"},t.prototype.exportQualifiersToString=function(e,t){return"["+this.qualifiers[t].map(function(t){return t.toExportString(e)}).join(", ")+"]"},t.prototype.toString=function(){for(var e="",t=0;t!==this.qualifiers.length;t++)0!==t&&(e+=" ~ "),e+=this.qualifiersToString(t);return e},t.prototype.toErrorString=function(){return"qualifierNode"},t.prototype.toFullString=function(){for(var e="",t=0;t!==this.qualifiers.length;t++)0!==t&&(e+=" ~ "),e+=this.qualifiersToFullString(t);return e},t.prototype.toCDLString=function(e){void 0===e&&(e=void 0);for(var t="[qualifiers",i=0;i!==this.qualifiers.length;i++)t+=", "+this.qualifiersToCDLString(i);return t+"]"},t.prototype.allQualifiersTrue=function(){for(var e=0;e!==this.qualifiers.length;e++)if(0!==this.qualifiers[e].length)return!1;return!0},t.prototype.toExportString=function(e){var t;t="_q("+this.localityString()+", [";for(var i=0;i!==this.qualifiers.length;i++)0!==i&&(t+=", "),t+=this.exportQualifiersToString(e,i);return t+="])"},t.prototype.setPriority=function(e){if(!(e<=this.prio)){this.prio=e;for(var t=0;t!==this.qualifiers.length;t++)for(var i=0;i!==this.qualifiers[t].length;i++)this.qualifiers[t][i].setPriority(e)}},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationQualifiers(this,e);e.evaluationNodes[this.localToDefun][this.id]=t;for(var i=0;i!==this.qualifiers.length;i++)t.addQualifiers(i,buildQualifiers(this.qualifiers[i],e));return t},t.prototype.allInputs=function(){for(var e=[],t=0;t!==this.qualifiers.length;t++)for(var i=0;i!==this.qualifiers[t].length;i++)e.push(this.qualifiers[t][i].functionNode);return e},t.prototype.getDataSourceInputs=function(){return[]},t.prototype.checkWritability=function(){Utilities.error("do not call")},t.prototype.markWritablePath=function(){Utilities.error("do not call")},t}(FunctionNode),VariantFunctionNode=function(e){function t(t,i,r,n,o,s,a){var d=e.call(this,r,n,o,s)||this;return d.visitedAtExportLevel=-1,d.qualifiers=t,d.functionNodes=i,d.node=a,doCompileTimeChecks&&(d.containsQualifiedExpression=t.containsQualifiedExpression,d.hasWritableReference=i.some(function(e){return e.hasWritableReference})),d}return __extends(t,e),t.prototype.add=function(e){this.functionNodes.push(e),this.hasWritableReference=this.hasWritableReference||e.hasWritableReference},t.prototype.type=function(){return FunctionNodeType.variant},t.prototype.identicalQualifiers=function(e){return this.qualifiers.identicalQualifiers(e.qualifiers)},t.prototype.specificEqual=function(e){return this.functionNodes.length===e.functionNodes.length&&this.qualifiers.isEqual(e.qualifiers)&&arrayEqual(this.functionNodes,e.functionNodes)},t.prototype.getMaximumInputId=function(e,i,r){var n=-1,o=this.localToArea?areaTemplates[this.localToArea].getScheduleStep(e,i):-1;if(this.visitedAtExportLevel===exportLevel){if(t.repairCycle)throw this.seqNr;var s="cycle in VariantFunctionNode";void 0!==this.node?gErrContext.enter(this.node,void 0):s+=": "+this.idStr()+"(consult your local FEG expert)",Utilities.syntaxError(s),void 0!==this.node&&gErrContext.leave();var a=FunctionNode.findInCacheStack(this,1);return a>-1?FunctionNode.printCycleError(a):Utilities.error("no cycle length?"),-1}var d=this.visitedAtExportLevel;this.visitedAtExportLevel=exportLevel;try{this.qualifiers=i(this.qualifiers,e,!1),this.qualifiers.localToArea===this.localToArea&&this.qualifiers.id>n&&(n=this.qualifiers.id),o=this.qualifiers.maxScheduleStep(this.prio,o);for(var u=0;u!==this.functionNodes.length;u++)this.functionNodes[u]=i(this.functionNodes[u],e,!1),this.functionNodes[u].localToArea===this.localToArea&&this.functionNodes[u].id>n&&(n=this.functionNodes[u].id),o=this.functionNodes[u].maxScheduleStep(this.prio,o)}catch(o){if(o===this.seqNr){for(var u=0;u<this.functionNodes.length;u++)this.functionNodes[u]=this.functionNodes[u].pickQualifiedExpression(this.qualifiers.qualifiers[u],this.qualifiers.qualifiers.slice(0,u),this.localToArea);t.repairCycle=!1,this.visitedAtExportLevel=d;var n=this.getMaximumInputId(e,i,r);return t.repairCycle=!0,n}throw o}return this.visitedAtExportLevel=d,r&&(this.scheduleStep=o+1),n},t.prototype.toString=function(){for(var e=this.qualifiers.idStr()+" => ",t=0;t!==this.functionNodes.length;t++)0!==t&&(e+=" ~ "),e+=this.functionNodes[t].idStr();return e},t.prototype.toErrorString=function(){return"variant "+this.qualifiers.toCDLString()},t.prototype.toFullString=function(){for(var e=this.qualifiers.toFullString()+" => ",t=0;t!==this.functionNodes.length;t++)0!==t&&(e+=" ~ "),e+=this.functionNodes[t].toFullString();return e},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),this.formatCDLFunctionCall("variant",[this.qualifiers].concat(this.functionNodes),e)},t.prototype.allFunctionNodesIdentical=function(){if(this.functionNodes.length>0){for(var e=1;e!==this.functionNodes.length;e++)if(this.functionNodes[e]!==this.functionNodes[0])return!1;return!0}return!1},t.prototype.allQualifiersTrue=function(){return this.qualifiers.allQualifiersTrue()},t.prototype.isAlwaysFalse=function(){return void 0===this.alwaysFalse&&(this.alwaysFalse=this.functionNodes.every(function(e){return e.isAlwaysFalse()})),this.alwaysFalse},t.prototype.toExportString=function(e){var t;if(assert(this.functionNodes.length===this.qualifiers.qualifiers.length,"debugging"),this.allFunctionNodesIdentical())return"_m1("+this.localityString()+", "+this.qualifiers.idExpStr(e)+", "+this.functionNodes[0].idExpStr(e)+")";t="_m("+this.localityString()+", "+this.qualifiers.idExpStr(e)+", [";for(var i=0;i!==this.functionNodes.length;i++)0!==i&&(t+=", "),t+=this.functionNodes[i].idExpStr(e);return t+="])"},t.prototype.conditionalSingleArea=function(){var e,t;if(0!==this.functionNodes.length){for(var i=0;i!==this.functionNodes.length;i++){if(this.functionNodes[i]instanceof WritableNode)return;var r=levelOfEmbeddingFun(this.functionNodes[i],this.functionNodes[i].localToArea);if(void 0===r||r.min!==r.max)return;if(0===i)e=r.min,t=this.functionNodes[i].localToArea;else if(r.min!==e||r.max!==e||t!==this.functionNodes[i].localToArea)return}return areaTemplates[t].getEmbedding(e).id}},t.prototype.replaceConditionalResult=function(e,i){for(var r=new Array(this.functionNodes.length),n=0;n<r.length;n++)r[n]=e;return t.build(this.qualifiers.qualifiers,r,0,void 0,this.suppressSet,this.node)},t.prototype.markWritablePath=function(){if(this.writabilityUndetermined()){this.writable=!0;for(var e=0;e!==this.functionNodes.length;e++)this.functionNodes[e].markWritablePath();FunctionNode.writabilityQueue.push(this)}},t.prototype.checkWritability=function(){this.writable=this.functionNodes.some(function(e){return e.writable})},t.prototype.setPriority=function(e){if(!(e<=this.prio)){this.prio=e,this.qualifiers.setPriority(e);for(var t=0;t!==this.functionNodes.length;t++)this.functionNodes[t].setPriority(e)}},t.prototype.makeEvaluationNode=function(e){var t=1===this.functionNodes.length?new EvaluationVariant1(this,e):new EvaluationVariant(this,e);return e.evaluationNodes[this.localToDefun][this.id]=t,t.addQualifiers(getEvaluationNode(this.qualifiers,e)),t},t.prototype.allInputs=function(){return this.functionNodes.concat(this.qualifiers)},t.prototype.valueUnderQualifier=function(e,i){for(var r=this.qualifiers.qualifiers,n=[],o=[],s=0;s!==r.length;s++)if(sqsImplies(e,r[s])){if(n.push([]),o.push(this.functionNodes[s]),this.functionNodes[s].isUnmergeable()||!this.functionNodes[s].valueType.isPotentiallyMergeable())break}else i.some(function(e){return sqsImplies(r[s],e)})||sqsMismatch(r[s],e)||(n.push(r[s].filter(function(t){return!sqInSQs(t,e)})),o.push(this.functionNodes[s]));return o.length===this.functionNodes.length?this:t.build(n,o,0,void 0,this.suppressSet,this.node)},t.prototype.pickQualifiedExpression=function(e,t,i){function r(i){for(var r=0;r!==i.length;r++){var n=i[r].matchAgainst(e,t);if(!n)return n}return!0}if(pickQualifiedExpressionStrategy<PickQualifiedExpressionStrategy.alwaysPick&&(pickQualifiedExpressionStrategy!==PickQualifiedExpressionStrategy.alwaysPickDefun||0===this.localToDefun))return this;for(var n,o=this.qualifiers.qualifiers,s=void 0,a=0;a!==o.length;a++){var d=r(o[a]);if(d!==!1){if(void 0!==s){n=!1;break}if(s=this.functionNodes[a],n=d,d===!0&&(s.isUnmergeable()||!s.valueType.isPotentiallyMergeable()))break}}return void 0===s?buildConstNode([],!1,void 0,0,gEmptyOSExpr):n===!0?s.containsQualifiedExpression?s.pickQualifiedExpression(e,t,i):s:pickQualifiedExpressionStrategy===PickQualifiedExpressionStrategy.pickOnlyTopVariant?this:this.eliminateQualifiers(e,t,i)},t.prototype.eliminateQualifiers=function(e,i,r){for(var n=this.qualifiers.qualifiers,o=[],s=[],a=!1,d=[],u=0;u!==n.length;u++){for(var h=n[u],l=[],c=!0,p=0;c&&p!==h.length;p++)switch(h[p].matchAgainst(e,i)){case!0:a=!0;break;case!1:c=!1,a=!0;break;case void 0:l.push(h[p])}if(c){for(var f=void 0===e?l:l.concat(e),v=void 0===i?d:d.concat(i),p=0;p<l.length;p++){var g;l[p].functionNode.containsQualifiedExpression&&l[p].functionNode.hasSameVariantLocalityAs(this)&&(g=l[p].functionNode.pickQualifiedExpression(e,v,r))!=l[p].functionNode&&(l[p]=new SingleQualifier(g,l[p].attribute,l[p].value,l[p].localToArea,l[p].originalAttribute,l[p].originalValue),a=!0)}var m=this.functionNodes[u].containsQualifiedExpression&&this.functionNodes[u].hasSameVariantLocalityAs(this)?this.functionNodes[u].pickQualifiedExpression(f,v,r):this.functionNodes[u];this.functionNodes[u]!==m&&(a=!0),o.push(l),s.push(m),u<n.length-1&&d.length===o.length&&(m.isUnmergeable()||!m.valueType.isPotentiallyMergeable())&&d.push(n[u])}else d.push(n[u])}return a?t.build(o,s,0,void 0,this.suppressSet,this.node):this},t.build=function(e,i,r,n,o,s){function a(){if(c.some(function(e){return 0===e.length}))return!0;for(var e={},t=0,i=0;i<c.length;i++){if(i>0&&c[i].length!==c[0].length)return!1;for(var r=0;r<c[i].length;r++){if(c[i][r].value!==!0&&c[i][r].value!==!1)return!1;c[i][r].attribute in e||(e[c[i][r].attribute]=t++)}}for(var n=c.map(function(t){return t.reduce(function(t,i){return i.value===!1?t:t+(1<<e[i.attribute])},0)}).sort(function(e,t){return e-t}),o=-1,i=0;i<n.length;i++){if(n[i]!==o+1)return!1;o=n[i]}return o===(1<<t)-1}var d=(new ValueType).addSize(0),u=!0,h=!0,l=[],c=[];assert(e.length===i.length,"error");for(var p=0;p!==i.length;p++){var f=i[p],v=e[p].filter(SingleQualifier.notAlwaysTrue);v.some(SingleQualifier.alwaysFalse)||(c.push(v),l.push(f),l.length>0&&!f.isEqual(l[0])&&(u=!1),0!==v.length&&(h=!1),d=d.merge(f.valueType))}return r>1&&mergeWritables(c,l,n,s),0===c.length?buildConstNode(void 0,!1,o,0,gUndefinedExpr):u&&(h||a())?l[0].mightChange():t.build2(c,l,d,void 0,s)},t.build2=function(e,i,r,n,o){for(var s=void 0,a=0,d=void 0,u=0,h=0;h!==i.length;h++){s=mergeLocality(s,i[h].localToArea),a=mergeDefunLocality(a,i[h].localToDefun);for(var l=0;l<e[h].length;l++)d=mergeLocality(d,e[h][l].functionNode.localToArea),u=mergeDefunLocality(u,e[h][l].functionNode.localToDefun)}var c=new QualifiersFunctionNode(e,d,u);return new t(c,i,mergeLocality(s,d),mergeDefunLocality(a,u),r,n,o)},t.prototype.setDefunArgTypes=function(e,t){if(!(this.seqNr in t)){t[this.seqNr]=!0;for(var i=0;i<this.functionNodes.length;i++)this.functionNodes[i].setDefunArgTypes(e,t);delete t[this.seqNr]}},t.prototype.getFullQualifierList=function(e,t){var i=this.qualifiers.qualifiers;if(this.localToArea!==e)return[];if(void 0!==t[this.id])return t[this.id];assert(t.length===this.id,"debug"),t.push([]);for(var r=[],n=[],o=0;o<i.length;o++){for(var s=[[]],a=0;a<i[o].length;a++){var d,u=i[o][a];if(u.functionNode.localToArea===e)if(d=i[o][a].functionNode.getFullQualifierList(e,t),0===d.length)d=[[u]];else for(var h=0;h<d.length;h++)d[h].push(u);else d=[[u]];var l=s;s=[];for(var c=0;c<l.length;c++)for(var h=0;h<d.length;h++)qOr(s,qAnd(l[c],d[h]),void 0,void 0)}var p=this.functionNodes[o].getFullQualifierList(e,t);if(0===p.length)for(var c=0;c<s.length;c++)qOr(r,s[c],n,this.functionNodes[o]);else for(var c=0;c<s.length;c++)for(var h=0;h<p.length;h++)qOr(r,qAnd(s[c],p[h]),n,this.functionNodes[o])}return t.pop(),assert(t.length===this.id,"debug"),qSimplify(r,n)},t.prototype.getDataSourceInputs=function(){return this.functionNodes},t.prototype.getSortKeys=function(){for(var e=[],t=0;t<this.functionNodes.length;t++)for(var i=this.functionNodes[t].getSortKeys(),r=0;r<i.length;r++){for(var n=0;n<e.length&&!valueEqual(i[r],e[n]);n++);n===e.length&&e.push(i[r])}return e},t.prototype.markAsResolution=function(e){for(var i=void 0,r=void 0,n=0;n<this.functionNodes.length;n++)this.functionNodes[n]===e?void 0===i&&(i=this.qualifiers.qualifiers.slice(0,n-1),r=this.functionNodes.slice(0,n-1)):void 0!==i&&(i.push(this.qualifiers.qualifiers[n]),r.push(this.functionNodes[n]));return void 0===i?this:t.build(i,r,0,void 0,!1,this.node)},t.prototype.isStrictSelection=function(){return this.functionNodes.every(function(e){return e.isStrictSelection()})},t.prototype.extractWritableDestinations=function(e,t){var i;return this.seqNr in t?[]:(t[this.seqNr]=!0,i=this.functionNodes.map(function(i){return i.extractWritableDestinations(e,t)}).reduce(function(e,t){return t.length>0?e.concat(t):e},[]),delete t[this.seqNr],i)},t.prototype.tagExpressionPath=function(t,i,r){e.prototype.tagExpressionPath.call(this,t,i,r),this.qualifiers.tagExpressionPath(t,i,r);for(var n=0;n<this.functionNodes.length;n++)this.functionNodes[n].tagExpressionPath(t,i,r)},t}(FunctionNode);VariantFunctionNode.repairCycle=!1;var FunctionApplicationNode=function(e){function t(t,i,r,n,o,s,a){var d=e.call(this,r,n,o,s)||this;if(d.builtInFunction=t,d.functionArguments=i,void 0!==a&&(d.origin=a),doCompileTimeChecks){d.checkForQualifiedExpressions();var u=d.writeDestination();void 0!==u&&(d.hasWritableReference=u.hasWritableReference)}return d}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.functionApplication},t.prototype.specificEqual=function(e){return this.builtInFunction===e.builtInFunction&&arrayEqual(this.functionArguments,e.functionArguments)},t.prototype.getMaximumInputId=function(e,t,i){for(var r=-1,n=this.localToArea?areaTemplates[this.localToArea].getScheduleStep(e,t):-1,o=0;o!==this.functionArguments.length;o++)this.functionArguments[o]=t(this.functionArguments[o],e,!1),this.functionArguments[o].localToArea===this.localToArea&&this.functionArguments[o].id>r&&(r=this.functionArguments[o].id),n=this.functionArguments[o].maxScheduleStep(this.prio,n);return i&&(this.scheduleStep=n+1),r},t.prototype.isScheduledProperly=function(){switch(this.builtInFunction.name){case"offset":return!1}return e.prototype.isScheduledProperly.call(this)},t.prototype.toString=function(){return this.builtInFunction.name+"("+this.functionArguments.map(function(e){return e.idStr()}).join(", ")+")"},t.prototype.toFullString=function(){return this.builtInFunction.name+"("+this.functionArguments.map(function(e){return e.toFullString()}).join(", ")+")"},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),this.formatCDLFunctionCall(this.builtInFunction.name,this.functionArguments,e)},t.prototype.toExportString=function(e){return"_f("+this.localityString()+", "+this.builtInFunction.name+", ["+this.functionArguments.map(function(t){return t.idExpStr(e)}).join(", ")+"])"},t.prototype.writeDestination=function(){switch(this.builtInFunction.name){case"databases":case"download":case"loginInfo":return this;case"first":case"last":case"makeDefined":case"mergeWrite":return this.functionArguments[0];case"prev":case"next":case"pos":case"identify":case"executeCompiledQuery":case"interpretQuery":case"internalApply":case"filter":case"multiQuery":case"sort":return this.functionArguments[1];default:return}},t.prototype.markWritablePath=function(){var e=this.writeDestination();void 0!==e?this.writabilityUndetermined()&&(this.writable=!0,e.markWritablePath(),FunctionNode.writabilityQueue.push(this)):Utilities.warnOnce("cannot write through "+this.builtInFunction.name)},t.prototype.checkWritability=function(){this.writable=this.writeDestination().writable},t.prototype.isWritableAware=function(){switch(this.builtInFunction.name){case"executeCompiledQuery":case"internalApply":return!0}return!1},t.prototype.isAlwaysTrue=function(){switch(this.builtInFunction.name){case"offset":case"me":case"size":case"sum":case"pointer":case"allAreas":case"time":return!0;case"makeDefined":return this.functionArguments[0].isAlwaysTrue();case"embedding":case"embeddingStar":return 0===this.functionArguments.length&&1!==this.localToArea||this.functionArguments[0].valueType.isStrictlyAreas()&&!this.functionArguments[0].valueType.areas.has(1)}return!1},t.prototype.isUnmergeable=function(){switch(this.builtInFunction.name){case"internalAtomic":case"offset":case"size":case"me":case"embedding":case"embeddingStar":case"embedded":case"embeddedStar":case"plus":case"minus":case"mul":case"div":case"pow":case"mod":case"ln":case"log10":case"logb":case"exp":case"and":case"or":case"not":case"lessThan":case"lessThanOrEqual":case"equal":case"notEqual":case"greaterThanOrEqual":case"greaterThan":case"index":case"concatStr":case"numberToString":case"bool":case"notEmpty":case"empty":case"sum":case"min":case"max":case"expressionOf":case"referredOf":case"intersectionParentOf":case"debugNodeToStr":case"pointer":case"allAreas":case"areaOfClass":case"classOfArea":case"time":case"changed":case"makeDefined":case"databases":case"database":case"download":return!0;case"first":case"prev":case"next":case"last":case"prevStar":case"prevPlus":case"nextStar":case"nextPlus":return 0===this.functionArguments.length||this.functionArguments[0].valueType.isStrictlyAreas()}return!1},t.prototype.setPriority=function(e){if(!(e<=this.prio)){this.prio=e;for(var t=0;t!==this.functionArguments.length;t++)this.functionArguments[t].setPriority(e);if("areaOfClass"===this.builtInFunction.name)for(var i=this.functionArguments[0],r=getDeOSedValue(i.value),n=1;n!==areaTemplates.length;n++){var o=areaTemplates[n];if(void 0!==o.exports&&0 in o.exports){var s=o.exports[0];r in s.attributes&&s.attributes[r].setPriority(e)}}}},t.prototype.setDefunArgTypes=function(e,t){if(!(this.seqNr in t)){switch(t[this.seqNr]=!0,this.builtInFunction.name){case"filter":case"map":case"multiQuery":case"internalApply":2===this.functionArguments.length&&this.functionArguments[0].setDefunArgTypes(this.functionArguments.slice(1),t)}delete t[this.seqNr]}},t.prototype.makeEvaluationNode=function(e){var t=void 0===this.builtInFunction.classConstructor?new EvaluationFunctionApplication(this,e):new this.builtInFunction.classConstructor(this,e);e.evaluationNodes[this.localToDefun][this.id]=t;for(var i=0;i!==this.functionArguments.length;i++)t.addArgument(i,getEvaluationNode(this.functionArguments[i],e));return t},t.prototype.allInputs=function(){return this.functionArguments},t.prototype.functionIsConstant=function(){var e=this.builtInFunction.name;return!(this.builtInFunction.dependingOnImplicitArguments||this.builtInFunction.transientResult||e in t.nonConstantFunctionNames)},t.buildFunctionApplication=function(e,i,r,n,o,s){function a(){return substituteEmbeddingChain(new t(e,i,r,n,getValueType(e,i,r),s,o))}function d(e,i){var r=levelOfEmbeddingFun(e,o),a=levelOfEmbeddingFun(i,o);if(void 0!==r&&void 0!==a&&r.match(a)){var d=Math.min(r.intMax(),a.intMax()),u=Math.max(r.intMin(),a.intMin());if(d===u){var h=getParent(o,d);return new t(me,[],h,n,getValueType(me,[],h),s,o)}}}if(void 0===n){n=0;for(var u=0;u!==i.length;u++)r=mergeLocality(r,i[u].localToArea),n=mergeDefunLocality(n,i[u].localToDefun)}var h=checkConstantResult(e,i,s);if(void 0!==h)return h;switch(e.name){case"areaOfClass":return AreaOfClassNode.build(i,r,n,o,s);case"dynamicAttribute":return t.buildDynamicAttribute(i,r,n,o,s);case"displayWidth":case"displayHeight":return DisplayOffsetNode.build(e.name,i,r,n,o,s);case"sort":return SortNode.build(i,r,n,s);case"internalApply":return t.buildInternalApply(i,getValueType(e,i,r),r,n,s);case"compareAreasQuery":if(h=d(i[0],i[1]),void 0!==h)return h;break;case"first":var l=i[0];if(l instanceof t&&"compareAreasQuery"===l.builtInFunction.name){var c=l.functionArguments[0],p=l.functionArguments[1];if(h=buildAreaOfClassQuery("first",c,p,o,s),void 0!==h)return h}else if(l instanceof t&&l.builtInFunction===me)return l;break;case"last":var f=i[0];if(f instanceof t&&"compareAreasQuery"===f.builtInFunction.name){var c=f.functionArguments[0],p=f.functionArguments[1];if(h=buildAreaOfClassQuery("last",c,p,o,s),void 0!==h)return h}else if(f instanceof t&&f.builtInFunction===me)return l;break;case"pos":var v=i[0],g=i[1];if(v instanceof ConstNode&&g instanceof t&&"compareAreasQuery"===g.builtInFunction.name&&(sveq(v.value,0)||sveq(v.value,1))){var c=g.functionArguments[0],p=g.functionArguments[1];if(h=buildAreaOfClassQuery(sveq(v.value,0)?"first":"last",c,p,o,s),void 0!==h)return h}}return a()},t.buildDynamicAttribute=function(e,i,r,n,o){var s=e[0],a=e[2],d=void 0;if(s instanceof ConstNode&&a instanceof ConstNode&&(s.value instanceof Array&&1===s.value.length&&"string"==typeof s.value[0]?d=s.value[0]:"string"==typeof s.value&&(d=s.value),a.value instanceof Array&&1===a.value.length&&"object"==typeof a.value[0]&&Utilities.isEmptyObj(a.value[0])||"object"==typeof s.value&&Utilities.isEmptyObj(a.value)||(d=void 0)),void 0===d)return new t(dynamicAttribute,e,i,r,getValueType(dynamicAttribute,e,i),o,n);var u={};return u[d]=e[1],AVFunctionNode.build(u,void 0,{},o)},t.buildInternalApply=function(e,i,r,n,o){return new t(internalApply,e,r,n,i,o)},t.prototype.pickQualifiedExpression=function(e,i,r){if(pickQualifiedExpressionStrategy<PickQualifiedExpressionStrategy.alwaysPick&&(pickQualifiedExpressionStrategy!==PickQualifiedExpressionStrategy.alwaysPickDefun||0===this.localToDefun))return this;var n=this.builtInFunction,o=new Array(this.functionArguments.length),s=void 0,a=0,d=!1;n.isLocalWithoutArguments&&0===o.length?s=this.localToArea:n.dependingOnImplicitArguments&&(s=getLocalToAreaOfBuiltInFunction(n,this.localToArea));for(var u=0;u!==this.functionArguments.length;u++){var h=this.functionArguments[u].containsQualifiedExpression&&this.functionArguments[u].hasSameVariantLocalityAs(this)?this.functionArguments[u].pickQualifiedExpression(e,i,r):this.functionArguments[u];s=mergeLocality(s,h.localToArea),a=mergeDefunLocality(a,h.localToDefun),this.functionArguments[u]!==h&&(d=!0),o[u]=h}return d?t.buildFunctionApplication(n,o,s,a,r,this.origExpr):this},t.prototype.getDataSourceInputs=function(){switch(this.builtInFunction.name){case"multiQuery":case"executeCompiledQuery":case"sort":case"identify":case"internalApply":return 2===this.functionArguments.length?[this.functionArguments[1]]:[];default:return[]}},t.prototype.getBoolInterpretation=function(){switch(this.builtInFunction.name){case"allAreas":case"pointer":case"me":case"sum":case"displayWidth":case"displayHeight":case"defun":return buildConstNode([!0],!0,void 0,0,gTrueExpr);case"embedding":case"embeddingStar":return 1===this.localToArea?buildConstNode([],!0,void 0,0,gEmptyOSExpr):buildConstNode([!0],!0,void 0,0,gTrueExpr)}return e.prototype.getBoolInterpretation.call(this)},t.prototype.extractWritableDestinations=function(e,t){var i;if(this.seqNr in t)return[];if(t[this.seqNr]=!0,this.builtInFunction===internalApply){var r=this.functionArguments[0].valueType.extractWritePath();i=void 0!==r?this.functionArguments[1].extractWritableDestinations(r.concat(e),t):[]}else i=this.builtInFunction===identify||this.builtInFunction===sort||this.builtInFunction===pos?this.functionArguments[1].extractWritableDestinations(e,t):this.builtInFunction===last||this.builtInFunction===first?this.functionArguments[0].extractWritableDestinations(e,t):[];return delete t[this.seqNr],i},t}(FunctionNode);FunctionApplicationNode.nonConstantFunctionNames={arg:!0,datasource:!0,datatable:!0,databases:!0,database:!0,overlap:!0,time:!0,changed:!0,datasourceInfo:!0,testStore:!0,loginInfo:!0,tempAppStateConnectionInfo:!0};var AreaOfClassNode=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getMaximumInputId=function(t,i,r){var n=e.prototype.getMaximumInputId.call(this,t,i,r),o=this.scheduleStep-1,s=this.functionArguments[0],a=getDeOSedValue(s.value);t[this.seqNr]=!0;for(var d=1;d!==areaTemplates.length;d++){var u=areaTemplates[d];if(void 0!==u.exports&&0 in u.exports){var h=u.exports[0];if(a in h.attributes){var l,c=h.attributes[a].seqNr;c in t?(Utilities.warnOnce("class membership "+a+" for @"+d+" depends on itself"),l=h.attributes[a]):(t[c]=!0,l=i(h.attributes[a],t,!1),h.attributes[a]=l,delete t[c]),l.localToArea===this.localToArea&&l.id>n&&(n=l.id),o=l.maxScheduleStep(this.prio,o)}}}return delete t[this.seqNr],r&&(this.scheduleStep=o+1),n},t.prototype.setPriority=function(t){if(!(t<=this.prio)){e.prototype.setPriority.call(this,t);for(var i=this.functionArguments[0],r=getDeOSedValue(i.value),n=1;n!==areaTemplates.length;n++){var o=areaTemplates[n];if(void 0!==o.exports&&0 in o.exports){var s=o.exports[0];r in s.attributes&&s.attributes[r].setPriority(t)}}}},t.prototype.toString=function(){return this.builtInFunction.name+"("+this.functionArguments.map(function(e){return e.toString()}).join(", ")+")"},t.prototype.allInputs=function(){for(var e=this.functionArguments.slice(),t=this.functionArguments[0],i=getDeOSedValue(t.value),r=1;r!==areaTemplates.length;r++){var n=areaTemplates[r];if(void 0!==n.exports&&0 in n.exports){var o=n.exports[0];i in o.attributes&&e.push(o.attributes[i])}}return e},t.getValueType=function(e){var t=new ValueType;if(1===e.length&&e[0].isSingleString())for(var i=e[0],r=i.value instanceof Array?i.value[0]:i.value,n=1;n!==areaTemplates.length;n++){var o=areaTemplates[n];if(void 0!==o.classes&&r in o.classes){var s=o.getNumberOfAreasRangeUnder(1),a=o.exports[0];void 0!==a&&r in a.attributes&&a.attributes[r].isAlwaysTrue()||(s=ValueTypeSize.max(s)),t.addArea(o.id,s)}}else Utilities.syntaxError("wrong arguments for areaOfClass: "+e.map(function(e){return e.toString()}));return t.unknown&&(t.sizes=[_r(0,0)]),t},t.build=function(e,i,r,n,o){var s=t.getValueType(e),a=void 0;if(s.unknown)return s.checkConsistency(),buildConstNode([],!1,void 0,0,gEmptyOSExpr);for(var d=0,u=s.areas.keys();d<u.length;d++){var h=u[d];if(void 0!==a){a=void 0;break}a=areaTemplates[h]}if(void 0!==n&&void 0!==a&&0===a.getNrParentIndices()&&void 0!==getLevelDifference(n,a.id,!1)){var l=buildSimpleFunctionNode(gMeExpr,void 0,a.id,0,void 0,void 0,void 0,o,a.id);return l}return new t(areaOfClass,e,i,r,s,o)},t.prototype.isAlwaysTrue=function(){var e=this.functionArguments[0],t=e.value instanceof Array?e.value[0]:e.value;assert("string"==typeof t,"error in assumption");for(var i=1;i!==areaTemplates.length;i++){var r=areaTemplates[i];if(0===r.getNrParentIndices()&&void 0!==r.exports&&0 in r.exports){var n=r.exports[0];if(t in n.attributes&&n.attributes[t].isAlwaysTrue())return!0}}return!1},t.prototype.isUnmergeable=function(){return!0},t.prototype.getDataSourceInputs=function(){return[]},t.prototype.getExistenceConditionForTemplate=function(e){var t,i=this.functionArguments[0],r=i.value instanceof Array?i.value[0]:i.value;return e.determineClassMembership(),t=e.exports[0],r in t.attributes?t.attributes[r]:buildConstNode([],!0,void 0,0,gEmptyOSExpr)},t}(FunctionApplicationNode),DisplayOffsetNode=function(e){function t(t,i,r,n,o,s,a){var d,u=this;if(2==i.length)d=i;else if(d=[],d.push(a),assert(0==i.length||1==i.length,"displayWidth/displayHeight must have 0 or 1 arguments"),0==i.length){var h;h=buildConstNode([],!0,void 0,0,gEmptyOSExpr),d.push(h)}else d.push(i[0]);return u=e.call(this,t,d,r,n,o,s)||this}return __extends(t,e),t.build=function(e,i,r,n,o,s){var a=new ValueType;a.addNumber().addSize(1);var d,u=areaTemplates[o],h=u.areaNode.getNodeAtPath(["display"]);assert("displayWidth"===e||"displayHeight"===e,"dim must be either 'displayWidth' or 'displayHeight'"),d="displayWidth"===e?displayWidth:displayHeight;var l=void 0!==h?buildFunctionNode(h,o,n,!0):buildConstNode({},!1,!0,0,gEmptyAVExpr);return new t(d,i,r,n,a,s,l)},t.prototype.getDataSourceInputs=function(){return[]},t.prototype.pickQualifiedExpression=function(e,t,i){return this},t}(FunctionApplicationNode),CompiledFunctionNode=function(e){function t(t,i,r,n,o,s,a,d,u,h,l){var c=e.call(this,u,h,void 0,l)||this;return c.name=t,c.compiledFunction=i,c.arguments=r,c.writePaths=n,c.query=o,c.isSelection=s,c.isProjection=a,c.dataRepresentation=d,doCompileTimeChecks&&(c.valueType=(new ValueType).addQuery(),void 0!==d&&(c.valueType=c.valueType.merge(d.valueType)),c.checkForQualifiedExpressions()),c}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.compiledFunctionApplication},t.prototype.specificEqual=function(e){return this.name===e.name&&this.compiledFunction===e.compiledFunction&&(this.dataRepresentation===e.dataRepresentation||void 0!==this.dataRepresentation&&void 0!==e.dataRepresentation&&this.dataRepresentation.isEqual(e.dataRepresentation))&&arrayEqual(this.arguments,e.arguments)},t.prototype.getMaximumInputId=function(e,t,i){var r=-1,n=this.localToArea?areaTemplates[this.localToArea].getScheduleStep(e,t):-1;void 0!==this.dataRepresentation&&(this.dataRepresentation=t(this.dataRepresentation,e,!1),this.dataRepresentation.localToArea===this.localToArea&&this.dataRepresentation.id>r&&(r=this.dataRepresentation.id),n=this.dataRepresentation.maxScheduleStep(this.prio,n));for(var o=0;o!==this.arguments.length;o++)this.arguments[o]=t(this.arguments[o],e,!1),this.arguments[o].localToArea===this.localToArea&&this.arguments[o].id>r&&(r=this.arguments[o].id),n=this.arguments[o].maxScheduleStep(this.prio,n);return i&&(this.scheduleStep=n+1),r},t.prototype.toString=function(){var e="function "+this.name+"("+this.arguments.map(function(e){return e.idStr()}).concat(JSON.stringify(this.writePaths)).join(", ")+")";return void 0===this.dataRepresentation?e:e+"/"+this.dataRepresentation.toString()},t.prototype.toFullString=function(){var e="function "+this.name+"("+this.arguments.map(function(e){return e.toFullString()}).join(", ")+", "+JSON.stringify(this.writePaths)+")";return void 0===this.dataRepresentation?e:e+"/"+this.dataRepresentation.toFullString()},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),void 0!==this.dataRepresentation?this.dataRepresentation.toCDLString(void 0):void 0!==this.query?this.query.toCdlString():void 0===this.compiledFunction.queryStr?"unknownquery":this.compiledFunction.queryStr},t.prototype.toExportString=function(e){var t=this.localityString()+", "+this.name+", ["+this.arguments.map(function(t){return t.idExpStr(e)}).join(", ")+"], "+JSON.stringify(this.writePaths)+", "+(this.dataRepresentation?this.dataRepresentation.idExpStr(e):"undefined");
return"_c("+t+")"},t.prototype.markWritablePath=function(){Utilities.warnOnce("cannot write through compiled function")},t.prototype.setPriority=function(e){if(!(e<=this.prio)){this.prio=e;for(var t=0;t!==this.arguments.length;t++)this.arguments[t].setPriority(e);void 0!==this.dataRepresentation&&this.dataRepresentation.setPriority(e)}},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationCompiledFunction(this,e);e.evaluationNodes[this.localToDefun][this.id]=t,t.setDataRepresentation(getEvaluationNode(this.dataRepresentation,e));for(var i=0;i!==this.arguments.length;i++)t.addArgument(i,getEvaluationNode(this.arguments[i],e));return t},t.prototype.allInputs=function(){return this.arguments},t.prototype.isAlwaysTrue=function(){return!0},t.prototype.getDataSourceInputs=function(){return[]},t.prototype.isStrictSelection=function(){return this.isSelection&&!this.isProjection},t.prototype.checkWritability=function(){Utilities.error("do not call")},t}(FunctionNode),SortNode=function(e){function t(t,i,r,n,o,s){var a=e.call(this,sort,t,i,r,o,s)||this;return a.areaSort=!1,a.areaSort=n,a}return __extends(t,e),t.prototype.toExportString=function(e){return"_srt("+this.localityString()+", "+this.areaSort+", ["+this.functionArguments.map(function(t){return t.idExpStr(e)}).join(", ")+"])"},t.prototype.getMaximumInputId=function(e,t,i){for(var r=-1,n=this.localToArea?areaTemplates[this.localToArea].getScheduleStep(e,t):-1,o=0;o!==this.functionArguments.length;o++)this.functionArguments[o]=t(this.functionArguments[o],e,!1),this.functionArguments[o].localToArea===this.localToArea&&this.functionArguments[o].id>r&&(r=this.functionArguments[o].id),n=this.functionArguments[o].maxScheduleStep(this.prio,n);if(this.areaSort)for(var s=0,a=this.functionArguments[0].valueType.areas.keys();s<a.length;s++){var d=a[s],u=areaTemplates[d];ensureTemplateDependency(u,e,t);for(var o=0;o<this.sortKeyExportIds.length;o++){var h=this.sortKeyExportIds[o],l=u.exports[h];if(void 0!==l){if(!(l.seqNr in e)){var c;void 0!==FunctionNode.cacheDbg&&(c=FunctionNode.cacheDbg.length,u.cacheStage[c]="export "+exportPaths[h],FunctionNode.cacheDbg.push(u)),e[l.seqNr]=!0,u.exports[h]=l=t(l,e,!1),void 0!==FunctionNode.cacheDbg&&FunctionNode.cacheDbg.pop(),delete e[l.seqNr]}n=l.maxScheduleStep(this.prio,n)}}}return i&&(this.scheduleStep=n+1),r},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationSort(this,e);e.evaluationNodes[this.localToDefun][this.id]=t;for(var i=0;i!==this.functionArguments.length;i++)t.addArgument(i,getEvaluationNode(this.functionArguments[i],e));return t},t.prototype.allInputs=function(){var t=e.prototype.allInputs.call(this).slice(0);if(this.areaSort)for(var i=0,r=this.functionArguments[0].valueType.areas.keys();i<r.length;i++)for(var n=r[i],o=areaTemplates[n],s=0;s<this.sortKeyExportIds.length;s++){var a=this.sortKeyExportIds[s],d=o.exports[a];void 0!==d&&t.push(d)}return t},t.prototype.allLocalInputs=function(){return e.prototype.allLocalInputs.call(this)},t.build=function(e,i,r,n){var o=new t(e,i,r,!1,e[0].valueType,n);if(e[0].valueType.isStrictlyAreas()){var s=e[1].getSortKeys();o.areaSort=!0,o.sortKeyExportIds=[];for(var a=0;a<s.length;a++)o.sortKeyExportIds.push(getExportId(normalizePath(s[a]),e[0].valueType.areas))}return o},t.prototype.pickQualifiedExpression=function(e,i,r){if(pickQualifiedExpressionStrategy<PickQualifiedExpressionStrategy.alwaysPick&&(pickQualifiedExpressionStrategy!==PickQualifiedExpressionStrategy.alwaysPickDefun||0===this.localToDefun))return this;for(var n=new Array(this.functionArguments.length),o=void 0,s=0,a=!1,d=0;d!==this.functionArguments.length;d++){var u=this.functionArguments[d].containsQualifiedExpression&&this.functionArguments[d].hasSameVariantLocalityAs(this)?this.functionArguments[d].pickQualifiedExpression(e,i,r):this.functionArguments[d];o=mergeLocality(o,u.localToArea),s=mergeDefunLocality(s,u.localToDefun),this.functionArguments[d]!==u&&(a=!0),n[d]=u}return a?t.build(n,o,s,this.origExpr):this},t.prototype.setDefunArgTypes=function(e,t){this.seqNr in t||(t[this.seqNr]=!0,this.functionArguments[0].setDefunArgTypes(e,t),delete t[this.seqNr])},t.prototype.getDataSourceInputs=function(){return[this.functionArguments[1]]},t.prototype.setPriority=function(t){if(!(t<=this.prio)&&(e.prototype.setPriority.call(this,t),this.areaSort))for(var i=0,r=this.functionArguments[0].valueType.areas.keys();i<r.length;i++)for(var n=r[i],o=areaTemplates[n],s=0;s<this.sortKeyExportIds.length;s++){var a=this.sortKeyExportIds[s],d=o.exports[a];void 0!==d&&d.setPriority(t)}},t}(FunctionApplicationNode),StorageNode=function(e){function t(t,i,r,n,o,s){var a=e.call(this,i,r,o,s)||this;return a.path=t,a.scheduleStep=0,a.pathInfo=n,a.hasWritableReference=!0,doCompileTimeChecks&&(a.containsQualifiedExpression=!1,storeWritableNode(i,r,t,a)),a}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.storage},t.prototype.specificEqual=function(e){return objectEqual(this.path,e.path)},t.prototype.getMaximumInputId=function(e,t,i){return i&&(this.scheduleStep=this.localToArea?areaTemplates[this.localToArea].getScheduleStep(e,t)+1:0),-1},t.prototype.toString=function(){return"store(["+(this.path?this.path.toString():"<>")+"])"},t.prototype.toExportString=function(e){return"_st("+this.localityString()+", "+JSON.stringify(this.path)+")"},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),"["+pathToQueryString(this.path,"_")+", [storage]]"},t.prototype.makeCompatible=function(e){if(!this.valueType.subsumes(e)){this.valueType.checkForSpellingErrors(e);var t=this.valueType.merge(e);signalOutputChange(void 0,{type:"valueTypeChange",origType:this.valueType,newType:t}),this.valueType=t}if(void 0!==this.pathInfo&&(void 0===this.pathInfo.valueType||!this.pathInfo.valueType.subsumes(e))){var t=void 0===this.pathInfo.valueType?e:this.pathInfo.valueType.merge(e);signalOutputChange(void 0,{type:"valueTypeChange",origType:this.pathInfo.valueType,newType:t}),this.pathInfo.valueType=t}},t.prototype.markWritablePath=function(){this.writabilityUndetermined()&&(this.writable=!0,FunctionNode.writabilityQueue.push(this))},t.prototype.checkWritability=function(){this.writable=!0},t.prototype.setPriority=function(e){if(!(e<=this.prio)&&(this.prio=e,"param"===this.path[0]&&"areaSetContent"===this.path[1])){var t=areaTemplates[this.localToArea];void 0!==t.parent.setFunctions[t.childName]&&void 0!==t.parent.setFunctions[t.childName].data&&t.parent.setFunctions[t.childName].data.setPriority(e)}},t.prototype.makeEvaluationNode=function(e){var t=0===this.localToDefun?new EvaluationStore(this,e):new EvaluationDefunParameter(this,e);return e.evaluationNodes[this.localToDefun][this.id]=t,t},t.prototype.allInputs=function(){return[]},t.prototype.functionIsConstant=function(){return!1},t.prototype.getDataSourceInputs=function(){return[]},t.prototype.extractWritableDestinations=function(e,t){return[{functionNode:this,path:e}]},t}(FunctionNode),MessageQueueNode=function(e){function t(t,i,r,n,o){return e.call(this,t,i,r,void 0,n,o)||this}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.messageQueue},t.prototype.toString=function(){return"messageQueue()"},t.prototype.toExportString=function(e){return"_mq("+this.localityString()+", "+JSON.stringify(this.path)+")"},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationMessageQueue(this,e);return e.evaluationNodes[this.localToDefun][this.id]=t,t},t}(StorageNode),PointerStorageNode=function(e){function t(t,i,r,n,o){return e.call(this,t,i,r,void 0,n,o)||this}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.pointerStorage},t.prototype.toString=function(){return"pointer()"},t.prototype.toExportString=function(e){return"_ptr("+this.localityString()+", "+JSON.stringify(this.path)+")"},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationPointerStore(this,e);return e.evaluationNodes[this.localToDefun][this.id]=t,t},t}(StorageNode),DebugBreakNode=function(e){function t(t){return e.call(this,t,void 0,0,void 0,(new ValueType).addSize(1),void 0)||this}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.debugBreak},t.prototype.toString=function(){return"debugBreak()"},t.prototype.toExportString=function(e){return"_dB("+this.localityString()+", "+JSON.stringify(this.path)+")"},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationDebugBreak(this,e);return e.evaluationNodes[this.localToDefun][this.id]=t,t},t}(StorageNode),ParamStorageNode=function(e){function t(t,i,r,n,o){return e.call(this,t,i,r,void 0,n,o)||this}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.paramStorage},t.prototype.toExportString=function(e){return"_par("+this.localityString()+", "+JSON.stringify(this.path)+")"},t.prototype.markWritablePath=function(){if(this.writabilityUndetermined()){var e=areaTemplates[this.localToArea],t=e.parent,i=void 0!==t&&void 0!==t.setFunctions?t.setFunctions[e.childName]:void 0;this.writable=!0,void 0!==i&&void 0!==i.data&&i.data.markWritablePath(),FunctionNode.writabilityQueue.push(this)}},t.prototype.checkWritability=function(){this.writable=!0},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationParam(this,e.getOwnId(),e);return e.evaluationNodes[this.localToDefun][this.id]=t,t},t.prototype.extractWritableDestinations=function(e,t){var i;if(this.seqNr in t)return[];if(this.path.length>=1&&"areaSetContent"===this.path[0]){var r=areaTemplates[this.localToArea];r.determineSetContent(),i=void 0!==r.parent.setFunctions[r.childName].data?r.parent.setFunctions[r.childName].data.extractWritableDestinations(e.slice(1),t):[]}else i=[];return delete t[this.seqNr],i},t}(StorageNode),WritableNode=function(e){function t(t,i,r,n,o,s,a){var d=e.call(this,t,r,n,o,s,a)||this;return d.initialValue=i,doCompileTimeChecks&&d.pathInfo.remoteWritable&&(d.valueType=(new ValueType).addRemote().addSize(0,1/0)),d}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.write},t.prototype.specificEqual=function(e){return objectEqual(this.path,e.path)&&(this.initialValue===e.initialValue||void 0!==this.initialValue&&void 0!==e.initialValue&&this.initialValue.isEqual(e.initialValue))},t.prototype.getMaximumInputId=function(e,t,i){var r=-1,n=this.localToArea?areaTemplates[this.localToArea].getScheduleStep(e,t):-1;return this.initialValue=t(this.initialValue,e,!1),this.initialValue.localToArea===this.localToArea&&this.initialValue.id>r&&(r=this.initialValue.id),n=this.initialValue.maxScheduleStep(this.prio,n),i&&(this.scheduleStep=n+1),r},t.prototype.toString=function(){return"write(["+(this.path?this.path.toString():"<>")+"], "+(this.initialValue&&this.initialValue.idStr())+")"},t.prototype.toFullString=function(){return"write(["+(this.path?this.path.toString():"<>")+"], "+(this.initialValue&&this.initialValue.toFullString())+")"},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),this.formatCDLFunctionCall("writable("+this.path.join(".")+")",[this.initialValue],e)},t.prototype.toExportString=function(e){return"_w("+this.localityString()+", "+JSON.stringify(this.path)+", "+(void 0==this.initialValue?"undefined":this.initialValue.idExpStr(e))+","+JSON.stringify(!!this.pathInfo.remoteWritable)+")"},t.prototype.markWritablePath=function(){this.writable=!0},t.prototype.setRemoteWritability=function(e){this.remoteWritable=e},t.prototype.setPriority=function(e){e<=this.prio||(this.prio=e,this.initialValue instanceof ConstNode||(this.initialValue.setPriority(e),this.initialValue.setSchedulingError()))},t.prototype.makeEvaluationNode=function(e){var t,i;this.remoteWritable&&(e instanceof CoreArea?(t=e.getPersistentTemplateId(),i=e.getPersistentIndexId()):(t=gPaidMgr.getGlobalPersistentTemplateId(),i=gPaidMgr.getGlobalPersistentIndexId()));var r=new EvaluationWrite(this,e);return e.evaluationNodes[this.localToDefun][this.id]=r,r.isBeingInitialized=void 0,r.setInitialValue(this.initialValue,e,t,i,this.path),r},t.prototype.allInputs=function(){return[this.initialValue]},t.prototype.functionIsConstant=function(){return!1},t.prototype.updateInitialValue=function(e){this.initialValue=e,this.makeCompatible(e.valueType)},t.prototype.setDefunArgTypes=function(e,t){this.seqNr in t||(t[this.seqNr]=!0,this.initialValue.setDefunArgTypes(e,t),delete t[this.seqNr])},t.prototype.tagExpressionPath=function(t,i,r){e.prototype.tagExpressionPath.call(this,t,i,r),this.initialValue.tagExpressionPath(t,i,r+".initialValue")},t}(StorageNode),QueryComponent=function(){function e(e){this.path=e}return e.prototype.isEqual=function(e){return!1},e.prototype.toString=function(){return"undefined"},e}(),QueryComponentProject=function(e){function t(t){var i=e.call(this,t)||this;return i.destination=[],i}return __extends(t,e),t.prototype.isEqual=function(e){if(e instanceof t){var i=e;return objectEqual(this.path,i.path)&&objectEqual(this.destination,i.destination)}return!1},t}(QueryComponent),QueryComponentSelect=function(e){function t(t,i,r,n){var o=e.call(this,t)||this;return o.selectionExpression=i,o.selectionFunction=n,o.positive=r,o}return __extends(t,e),t.prototype.toString=function(){return(this.positive?"":"!")+"qs(["+(this.path?this.path.toString():"<>")+"], "+this.selectionFunction.idStr()+")"},t.prototype.toFullString=function(){return(this.positive?"":"!")+"qs(["+(this.path?this.path.toString():"<>")+"], "+this.selectionFunction.toFullString()+")"},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),this.selectionFunction.toCDLString(e)},t.prototype.toExportString=function(e){return this.selectionFunction.idExpStr(e)+", "+this.positive},t.prototype.isEqual=function(e){if(e instanceof t){var i=e;return this.selectionFunction.isEqual(i.selectionFunction)&&this.positive===i.positive&&objectEqual(this.path,i.path)}return!1},t}(QueryComponent),AreaProjectionNode=function(e){function t(t,i,r,n,o,s,a,d,u){var h=e.call(this,r,n,a,d)||this;return h.exportId=t,h.path=i,h.data=o,doCompileTimeChecks&&(h.allExportNodes=u,h.hasWritableReference=u.some(function(e){return e.hasWritableReference}),h.checkForQualifiedExpressions()),h.onAllAreasOfClass=s,h.checkForQualifiedExpressions(),h}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.project},t.prototype.specificEqual=function(e){return this.exportId===e.exportId&&this.data.isEqual(e.data)},t.prototype.getMaximumInputId=function(e,t,i){var r=-1,n=this.localToArea?areaTemplates[this.localToArea].getScheduleStep(e,t):-1;exportLevel++,this.data=t(this.data,e,!1),this.data.localToArea===this.localToArea&&this.data.id>r&&(r=this.data.id),n=this.data.maxScheduleStep(this.prio,n);for(var o=0,s=this.data.valueType.areas.keys();o<s.length;o++){var a=s[o],d=areaTemplates[a];if(d.doesExist){ensureTemplateDependency(d,e,t);var u=d.exports[this.exportId];if(void 0!==u){if(!(u.seqNr in e)){var h;void 0!==FunctionNode.cacheDbg&&(h=FunctionNode.cacheDbg.length,d.cacheStage[h]="export "+exportPaths[this.exportId],FunctionNode.cacheDbg.push(d)),e[u.seqNr]=!0,d.exports[this.exportId]=u=t(u,e,!1),void 0!==FunctionNode.cacheDbg&&FunctionNode.cacheDbg.pop(),delete e[u.seqNr]}n=u.maxScheduleStep(this.prio,n)}}}return i&&(this.scheduleStep=n+1),exportLevel--,r},t.prototype.toString=function(){return"project(#"+this.exportId+"="+exportPaths[this.exportId].toString()+", "+this.data.idStr()+")"},t.prototype.toFullString=function(){return"project(#"+this.exportId+"="+exportPaths[this.exportId].toString()+", "+this.data.toFullString()+")"},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),void 0===e?"["+pathToQueryString(exportPaths[this.exportId],"_")+", "+this.data.toCDLString(void 0)+"]":"["+pathToQueryString(exportPaths[this.exportId],"_")+",\n"+e+"    "+this.data.toCDLString(void 0)+"\n"+e+"]"},t.prototype.toExportString=function(e){return"_p("+this.localityString()+", "+this.exportId+", "+this.data.idExpStr(e)+")"},t.prototype.markWritablePath=function(){if(this.writabilityUndetermined()){this.writable=!0;for(var e=0,t=this.data.valueType.areas.keys();e<t.length;e++){var i=t[e],r=areaTemplates[i],n=r.exports[this.exportId];void 0!==n&&n.markWritablePath()}FunctionNode.writabilityQueue.push(this)}},t.prototype.checkWritability=function(){for(var e=0,t=this.data.valueType.areas.keys();e<t.length;e++){var i=t[e],r=areaTemplates[i],n=r.exports[this.exportId];if(void 0!==n&&n.writable)return void(this.writable=!0)}},t.prototype.isUnmergeable=function(){for(var e=0,t=this.data.valueType.areas.keys();e<t.length;e++){var i=t[e],r=areaTemplates[i],n=r.exports[this.exportId];if(void 0===n&&!n.isUnmergeable())return!1}return!0},t.prototype.setPriority=function(e){if(!(e<=this.prio)){this.prio=e,this.data.setPriority(e);for(var t=0,i=this.data.valueType.areas.keys();t<i.length;t++){var r=i[t],n=areaTemplates[r],o=n.exports[this.exportId];void 0!==o&&o.setPriority(e)}}},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationAreaProjection(this,this.exportId,e);return e.evaluationNodes[this.localToDefun][this.id]=t,t.setData(getEvaluationNode(this.data,e)),t},t.prototype.allInputs=function(){for(var e=[this.data],t=0,i=this.data.valueType.areas.keys();t<i.length;t++){var r=i[t],n=areaTemplates[r],o=n.exports[this.exportId];void 0!==o&&e.push(o)}return e},t.prototype.allLocalInputs=function(){return[this.data]},t.prototype.functionIsConstant=function(){for(var e=!0,t=0,i=this.data.valueType.areas.keys();t<i.length;t++){var r=i[t],n=areaTemplates[r],o=n.exports[this.exportId];if(void 0!==o){switch(o.getConstancy()){case void 0:e===!0&&(e=void 0);break;case!1:e=!1}if(e===!1)break}}return e===!0?this.data.getConstancy():e},t.build=function(e,i,r,n,o,s){var a=new ValueType,d=!1,u=0,h=void 0,l=!1,c=r.conditionalSingleArea(),p=[];if(void 0!==c){var f=pathToQuery(i),v=void 0;return"param"===i[0]?Utilities.syntaxError("cannot project parameter queries"):v="class"===i[0]?buildClassQuery(f,c,r.localToDefun,s):resolveLocalQuery(f,c,0,c,s),void 0===v?buildConstNode([],!1,void 0,0,gEmptyOSExpr):r.replaceConditionalResult(v,o)}if(r.valueType.isDataAndAreas()&&Utilities.error("cannot project "+i.join(".")+" on areas and data"),void 0!==r.valueType.areas)for(var g=0,m=r.valueType.areas;g<m.length;g++){var y=m[g],I=y[0],b=y[1],C=areaTemplates[I],S=C.exports[e];void 0!==S&&(void 0===S.valueType&&objectEqual(i,["param","areaSetContent"])&&C.determineSetContent(),gErrContext.enter(C.areaNode.getNodeAtPath(i),void 0),S instanceof QueryCycle?a=a.addAnyData():(a=a.merge(S.valueType,!1),a.sizes=ValueTypeSize.sumSizes(a.sizes,ValueTypeSize.multiplySizes(S.valueType.sizes,b.sizes))),gErrContext.leave(),d=!0,S instanceof ConstNode&&(h=S,0===C.getNrParentIndices()&&C.alwaysExists()&&(l=!0)),p.push(S)),u++}return d?1===u&&l&&n?h:new t(e,i,r.localToArea,r.localToDefun,r,n,a,s,p):(Utilities.warnOnce("no projection: "+i.join(".")+" for "+r.toString()+" @ "+r.valueType.toString()),new ConstNode([],new ValueType,gEmptyOSExpr,void 0,!1))},t.prototype.pickQualifiedExpression=function(e,i,r){if(pickQualifiedExpressionStrategy<PickQualifiedExpressionStrategy.alwaysPick&&(pickQualifiedExpressionStrategy!==PickQualifiedExpressionStrategy.alwaysPickDefun||0===this.localToDefun))return this;var n=this.data.containsQualifiedExpression&&this.data.hasSameVariantLocalityAs(this)?this.data.pickQualifiedExpression(e,i,r):this.data;return n===this.data?this:t.build(this.exportId,this.path,n,this.onAllAreasOfClass,r,this.origExpr)},t.prototype.setDefunArgTypes=function(e,t){if(!(this.seqNr in t)){t[this.seqNr]=!0;for(var i=0,r=this.data.valueType.areas.keys();i<r.length;i++){var n=r[i],o=areaTemplates[n].exports[this.exportId];void 0!==o&&o.setDefunArgTypes(e,t)}delete t[this.seqNr]}},t.prototype.getSortKeys=function(){return[]},t.prototype.getDataSourceInputs=function(){for(var e=[],t=0,i=this.data.valueType.areas.keys();t<i.length;t++){var r=i[t],n=areaTemplates[r].exports[this.exportId];void 0!==n&&e.push(n)}return e},t.prototype.getBoolInterpretation=function(){return FunctionApplicationNode.buildFunctionApplication(bool,[this],this.localToArea,this.localToDefun,void 0,void 0)},t.prototype.extractWritableDestinations=function(e,t){var i=[];if(this.seqNr in t)return[];t[this.seqNr]=!0;for(var r=0,n=this.data.valueType.areas.keys();r<n.length;r++){var o=n[r],s=areaTemplates[o];if(this.exportId in s.exports){var a=s.exports[this.exportId].extractWritableDestinations(e,t);void 0!==a&&(i=i.concat(a))}}return delete t[this.seqNr],i},t}(FunctionNode),ClassOfAreaNode=function(e){function t(t,i,r,n,o,s){return e.call(this,0,void 0,t,i,r,!1,n,o,s)||this}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.classOfArea},t.prototype.specificEqual=function(e){return this.data.isEqual(e.data)},t.prototype.toString=function(){return"classOfArea("+this.data.idStr()+")"},t.prototype.toFullString=function(){return"classOfArea("+this.data.toFullString()+")"},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),this.formatCDLFunctionCall("classOfArea",[this.data],e)},t.prototype.toExportString=function(e){return"_coa("+this.localityString()+", "+this.data.idExpStr(e)+")"},t.prototype.markWritablePath=function(){Utilities.warnOnce("cannot write through classOfArea")},t.prototype.isUnmergeable=function(){return!0},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationClassOfArea(this,e);return e.evaluationNodes[this.localToDefun][this.id]=t,t.setData(getEvaluationNode(this.data,e)),t},t.prototype.pickQualifiedExpression=function(e,i,r){if(pickQualifiedExpressionStrategy<PickQualifiedExpressionStrategy.alwaysPick&&(pickQualifiedExpressionStrategy!==PickQualifiedExpressionStrategy.alwaysPickDefun||0===this.localToDefun))return this;var n=this.data.containsQualifiedExpression&&this.data.hasSameVariantLocalityAs(this)?this.data.pickQualifiedExpression(e,i,r):this.data;return n===this.data?this:t.buildClassOfAreaNode(n,this.origExpr)},t.buildClassOfAreaNode=function(e,i){var r=e.localToArea,n=e.localToDefun,o=[],s={},a=0,d=[];if(void 0!==e&&e.valueType.isAreas()){if(void 0!==e.valueType.areas){for(var u=0,h=e.valueType.areas.keys();u<h.length;u++){var l=h[u],c=areaTemplates[l];c.determineClassMembership();var p=c.exports[0];d.push(p);for(var f in c.classes)f in p.attributes&&(f in s||(s[f]=!0,a++),p.attributes[f].isAlwaysTrue()?void 0!==o&&o.push(f):o=void 0)}if(!("unknown"in e.valueType)&&void 0!==o)return buildConstNode(o,!1,void 0,0,i);var v=(new ValueType).addString().addSize(0,a);return new t(r,n,e,v,i,d)}return buildConstNode([],!1,void 0,0,gEmptyOSExpr)}return Utilities.syntaxError("classOfArea takes an area os"),buildConstNode([],!1,void 0,0,gEmptyOSExpr)},t.prototype.getDataSourceInputs=function(){return[]},t}(AreaProjectionNode),AreaSelectionNode=function(e){function t(t,i,r,n,o,s,a){var d=e.call(this,r,n,s,a)||this;return d.exportId=t,d.select=i,d.data=o,d.checkForQualifiedExpressions(),d}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.select},t.prototype.specificEqual=function(e){return this.exportId===e.exportId&&this.select.isEqual(e.select)&&this.data.isEqual(e.data)},t.prototype.getMaximumInputId=function(e,t,i){var r=-1,n=this.localToArea?areaTemplates[this.localToArea].getScheduleStep(e,t):-1,o=void 0;exportLevel++,e[this.seqNr]=!0,this.data=t(this.data,e,!1),this.data.localToArea===this.localToArea&&this.data.id>r&&(r=this.data.id),n=this.data.maxScheduleStep(this.prio,n);for(var s=0,a=this.data.valueType.areas.keys();s<a.length;s++){var d=a[s],u=areaTemplates[d];if(u.doesExist){var h;ensureTemplateDependency(u,e,t),(void 0===o||o>(h=u.getScheduleStep(e,t)))&&(o=h);var l=u.exports[this.exportId];if(void 0!==l){if(!(l.seqNr in e)){var c;void 0!==FunctionNode.cacheDbg&&(c=FunctionNode.cacheDbg.length,u.cacheStage[c]="export "+exportPaths[this.exportId],FunctionNode.cacheDbg.push(u)),e[l.seqNr]=!0,u.exports[this.exportId]=l=t(l,e,!1),void 0!==FunctionNode.cacheDbg&&FunctionNode.cacheDbg.pop(),delete e[l.seqNr]}n=l.maxScheduleStep(this.prio,n)}}}return 0===this.prio&&o>n?n=o:this.prio>0&&Utilities.warnOnce("area scheduling late for "+this.idStr()),this.select.selectionFunction=t(this.select.selectionFunction,e,!1),this.select.selectionFunction.localToArea===this.localToArea&&this.select.selectionFunction.id>r&&(r=this.select.selectionFunction.id),n=this.select.selectionFunction.maxScheduleStep(this.prio,n),i&&(this.scheduleStep=n+1),delete e[this.seqNr],exportLevel--,r},t.prototype.toString=function(){return"select(#"+this.exportId+", "+this.select.toString()+", "+this.data.idStr()+")"},t.prototype.toFullString=function(){return"select(#"+this.exportId+", "+this.select.toFullString()+", "+this.data.toFullString()+")"},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),this.formatArray([pathToQueryString(exportPaths[this.exportId],this.select.toCDLString(void 0)),this.data],!0,e)},t.prototype.toExportString=function(e){return"_s("+this.localityString()+", "+this.exportId+", "+this.select.toExportString(e)+", "+this.data.idExpStr(e)+")"},t.prototype.markWritablePath=function(){this.writabilityUndetermined()&&(this.writable=!0,this.data.markWritablePath(),FunctionNode.writabilityQueue.push(this))},t.prototype.checkWritability=function(){this.writable=this.data.writable},t.prototype.isUnmergeable=function(){return!0},t.prototype.setPriority=function(e){if(!(e<=this.prio)){this.prio=e,this.data.setPriority(e),this.select.selectionFunction.setPriority(e);for(var t=0,i=this.data.valueType.areas.keys();t<i.length;t++){var r=i[t],n=areaTemplates[r],o=n.exports[this.exportId];void 0!==o&&o.setPriority(e)}}},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationAreaSelection(this,e);return e.evaluationNodes[this.localToDefun][this.id]=t,t.setSelectionAndData(getEvaluationNode(this.select.selectionFunction,e),getEvaluationNode(this.data,e)),t},t.prototype.allInputs=function(){for(var e=[this.data,this.select.selectionFunction],t=0,i=this.data.valueType.areas.keys();t<i.length;t++){var r=i[t],n=areaTemplates[r],o=n.exports[this.exportId];void 0!==o&&e.push(o)}return e},t.prototype.allLocalInputs=function(){return[this.data,this.select.selectionFunction]},t.prototype.functionIsConstant=function(){for(var e=!0,t=0,i=this.data.valueType.areas.keys();t<i.length;t++){var r=i[t],n=areaTemplates[r],o=n.exports[this.exportId];if(void 0!==o){switch(o.getConstancy()){case void 0:e===!0&&(e=void 0);break;case!1:e=!1}if(e===!1)break}}switch(this.data.getConstancy()){case void 0:e===!0&&(e=void 0);break;case!1:e=!1}switch(this.select.selectionFunction.getConstancy()){case void 0:e===!0&&(e=void 0);break;case!1:e=!1}return e},t.build=function(e,i,r){function n(e,t){return e.valueType.canMatch(t.valueType,!0)}function o(e,t){return!1}var s,a,d,u=new ValueType;if(s=getExportId(e.path,i.valueType.areas),a=mergeLocality(e.selectionFunction.localToArea,i.localToArea),d=mergeDefunLocality(e.selectionFunction.localToDefun,i.localToDefun),i.valueType.isDataAndAreas()&&Utilities.error("cannot select "+e.toString()+" on areas and data"),void 0!==i.valueType.areas)for(var h=0,l=i.valueType.areas;h<l.length;h++){var c=l[h],p=c[0],f=c[1],v=areaTemplates[p],g=v.exports[s];(e.positive&&void 0!==g&&n(g,e.selectionFunction)||!e.positive&&(void 0===g||!o(g,e.selectionFunction)))&&u.addArea(p,f.sizes)}return u.unknown?(u.checkConsistency(),buildConstNode([],!1,void 0,0,gEmptyOSExpr)):new t(s,e,a,d,i,u,r)},t.prototype.pickQualifiedExpression=function(e,i,r){if(pickQualifiedExpressionStrategy<PickQualifiedExpressionStrategy.alwaysPick&&(pickQualifiedExpressionStrategy!==PickQualifiedExpressionStrategy.alwaysPickDefun||0===this.localToDefun))return this;var n=this.select.selectionFunction.containsQualifiedExpression&&this.select.selectionFunction.hasSameVariantLocalityAs(this)?this.select.selectionFunction.pickQualifiedExpression(e,i,r):this.select.selectionFunction,o=this.data.containsQualifiedExpression&&this.data.hasSameVariantLocalityAs(this)?this.data.pickQualifiedExpression(e,i,r):this.data;return n===this.select.selectionFunction&&o===this.data?this:t.build(new QueryComponentSelect(this.select.path,this.select.selectionExpression,this.select.positive,n),o,this.origExpr)},t.prototype.getDataSourceInputs=function(){return[]},t}(FunctionNode),ChildAreasNode=function(e){function t(t,i,r,n){var o=e.call(this,i.localToArea,0,r,n)||this;return o.childName=t,o.data=i,o.checkForQualifiedExpressions(),o}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.childAreas},t.prototype.specificEqual=function(e){return this.childName===e.childName&&this.data.isEqual(e.data)},t.prototype.isUnmergeable=function(){return!0},t.prototype.getMaximumInputId=function(e,t,i){var r=-1,n=-1;if(this.data=t(this.data,e,!1),this.data.localToArea===this.localToArea&&this.data.id>r&&(r=this.data.id),n=this.data.maxScheduleStep(this.prio,n),0===this.prio)for(var o=0,s=this.data.valueType.areas.keys();o<s.length;o++){var a=s[o],d=areaTemplates[a],u=d.children[this.childName];void 0!==u&&(ensureTemplateDependency(u,e,t),u.getScheduleStep(e,t)>n&&(n=u.getScheduleStep(e,t)))}else Utilities.warnOnce("area scheduling late for "+this.idStr());return i&&(this.scheduleStep=n+1),r},t.prototype.toString=function(){return"child("+this.childName+", "+this.data.idStr()+")"},t.prototype.toFullString=function(){return"child("+this.childName+", "+this.data.toFullString()+")"},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),this.formatArray(["{children: {"+this.childName+": _}}",this.data],!0,e)},t.prototype.toExportString=function(e){return"_d("+this.localityString()+", "+JSON.stringify(this.childName)+", "+this.data.idExpStr(e)+")"},t.prototype.markWritablePath=function(){Utilities.warnOnce("cannot write through child queries")},t.prototype.setPriority=function(e){e<=this.prio||(this.prio=e,this.data.setPriority(e))},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationChildAreas(this,e);return e.evaluationNodes[this.localToDefun][this.id]=t,t.setData(getEvaluationNode(this.data,e)),t},t.prototype.allInputs=function(){return[this.data]},t.prototype.functionIsConstant=function(){for(var e=0,t=this.data.valueType.areas.keys();e<t.length;e++){var i=t[e],r=areaTemplates[i],n=r.children[this.childName];if(void 0!==n&&0!==n.getNrParentIndices())return!1}return!0},t.prototype.pickQualifiedExpression=function(e,i,r){if(pickQualifiedExpressionStrategy<PickQualifiedExpressionStrategy.alwaysPick&&(pickQualifiedExpressionStrategy!==PickQualifiedExpressionStrategy.alwaysPickDefun||0===this.localToDefun))return this;var n=this.data.containsQualifiedExpression&&this.data.hasSameVariantLocalityAs(this)?this.data.pickQualifiedExpression(e,i,r):this.data;return n===this.data?this:new t(this.childName,n,this.valueType,this.origExpr)},t.prototype.getDataSourceInputs=function(){return[]},t.prototype.checkWritability=function(){Utilities.error("do not call")},t}(FunctionNode),OrderedSetNode=function(e){function t(t,i,r,n,o,s){var a=e.call(this,i,r,n,o)||this;return a.alwaysOS=!1,a.values=t,a.alwaysOS=s,a.checkForQualifiedExpressions(),a}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.orderedSet},t.prototype.specificEqual=function(e){return arrayEqual(this.values,e.values)},t.prototype.isUnmergeable=function(){for(var e=0;e!==this.values.length;e++)if(this.values[e].isUnmergeable())return!0;return!1},t.prototype.getMaximumInputId=function(e,t,i){for(var r=-1,n=this.localToArea?areaTemplates[this.localToArea].getScheduleStep(e,t):-1,o=0;o!==this.values.length;o++)this.values[o]=t(this.values[o],e,!1),this.values[o].localToArea===this.localToArea&&this.values[o].id>r&&(r=this.values[o].id),n=this.values[o].maxScheduleStep(this.prio,n);return i&&(this.scheduleStep=n+1),r},t.prototype.toString=function(){return"o("+this.values.map(function(e){return e.idStr()}).join(", ")+")"},t.prototype.toFullString=function(){return"o("+this.values.map(function(e){return e.toFullString()}).join(", ")+")"},t.prototype.toCDLString=function(e){
return void 0===e&&(e=void 0),this.formatCDLConstructor("o",this.values,e)},t.prototype.toExportString=function(e){return"_o("+this.localityString()+", ["+this.values.map(function(t){return t.idExpStr(e)}).join(", ")+"])"},t.prototype.markWritablePath=function(){if(this.writabilityUndetermined()){this.writable=!0;for(var e=0;e!==this.values.length;e++)this.values[e].markWritablePath();FunctionNode.writabilityQueue.push(this)}},t.prototype.checkWritability=function(){for(var e=0;e!==this.values.length;e++)if(this.values[e].writable)return void(this.writable=!0)},t.prototype.setPriority=function(e){if(!(e<=this.prio)){this.prio=e;for(var t=0;t!==this.values.length;t++)this.values[t].setPriority(e)}},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationOrderedSet(this,e);e.evaluationNodes[this.localToDefun][this.id]=t;for(var i=0;i!==this.values.length;i++)t.addElement(i,getEvaluationNode(this.values[i],e));return t},t.prototype.allInputs=function(){return this.values},t.prototype.pickQualifiedExpression=function(e,i,r){if(pickQualifiedExpressionStrategy<PickQualifiedExpressionStrategy.alwaysPick&&(pickQualifiedExpressionStrategy!==PickQualifiedExpressionStrategy.alwaysPickDefun||0===this.localToDefun))return this;for(var n=new Array(this.values.length),o=!1,s=0;s<this.values.length;s++)n[s]=this.values[s].containsQualifiedExpression&&this.values[s].hasSameVariantLocalityAs(this)?this.values[s].pickQualifiedExpression(e,i,r):this.values[s],n[s]!==this.values[s]&&(o=!0);return o?t.buildOrderedSet(n,r,this.origExpr,this.alwaysOS):this},t.buildOrderedSet=function(e,i,r,n){var o=void 0,s=0,a=new ValueType,d=void 0,u=!0,h=!0;if(0===e.length)return buildConstNode([],!0,void 0,0,r);if(1!==e.length||n){for(var l=0;l<e.length;l++)a=a.merge(e[l].valueType),e[l]instanceof ConstNode?h=h&&e[l].wontChangeValue:u=!1,o=mergeLocality(o,e[l].localToArea),s=mergeDefunLocality(s,e[l].localToDefun);if(a.sizes=d,u){for(var c=[],l=0;l!==e.length;l++){var p=e[l];c=c.concat(p.value)}return new ConstNode(c,getValueTypeFromConstant(c),r,void 0,h)}return new t(e,o,s,a,r,n)}return e[0]},t.prototype.getSortKeys=function(){for(var e=[],t=0;t<this.values.length;t++)e=e.concat(this.values[t].getSortKeys());return e},t.prototype.setDefunArgTypes=function(e,t){if(!(this.seqNr in t)){t[this.seqNr]=!0;for(var i=0;i<this.values.length;i++)this.values[i].setDefunArgTypes(e,t);delete t[this.seqNr]}},t.prototype.getDataSourceInputs=function(){return this.values},t.prototype.isAlwaysTrue=function(){for(var e=0;e<this.values.length;e++)if(this.values[e].isAlwaysTrue())return!0;return!1},t.prototype.isAlwaysFalse=function(){for(var e=0;e<this.values.length;e++)if(!this.values[e].isAlwaysFalse())return!1;return!0},t.prototype.getBoolInterpretation=function(){return FunctionApplicationNode.buildFunctionApplication(bool,[this],this.localToArea,this.localToDefun,void 0,void 0)},t.prototype.isOrderedSetNode=function(){return!0},t.prototype.extractWritableDestinations=function(e,t){var i;return this.seqNr in t?[]:(t[this.seqNr]=!0,i=this.values.map(function(i){return i.extractWritableDestinations(e,t)}).reduce(function(e,t){return t.length>0?e.concat(t):e},[]),delete t[this.seqNr],i)},t}(FunctionNode),RangeNode=function(e){function t(t,i,r,n,o,s,a){var d=e.call(this,t,n,o,s,a,void 0)||this;return d.closedLower=i,d.closedUpper=r,d}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.range},t.prototype.specificEqual=function(e){var t=this.values;if(this.closedLower!==e.closedLower||this.closedUpper!==e.closedUpper)return!1;for(var i=0;i!==t.length;i++)if(!e.values.some(function(e){return e.isEqual(t[i])}))return!1;for(var i=0;i!==e.values.length;i++)if(!t.some(function(t){return t.isEqual(e.values[i])}))return!1;return!0},t.prototype.isUnmergeable=function(){return!0},t.prototype.toString=function(){return"R"+(this.closedLower?"c":"o")+(this.closedUpper?"c":"o")+"("+this.values.map(function(e){return e.idStr()}).join(", ")+")"},t.prototype.toFullString=function(){return"R"+(this.closedLower?"c":"o")+(this.closedUpper?"c":"o")+"("+this.values.map(function(e){return e.toFullString()}).join(", ")+")"},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),this.formatCDLConstructor("R"+(this.closedLower?"c":"o")+(this.closedUpper?"c":"o"),this.values,e)},t.prototype.toExportString=function(e){return"_r"+(this.closedLower?"c":"o")+(this.closedUpper?"c":"o")+"("+this.localityString()+", ["+this.values.map(function(t){return t.idExpStr(e)}).join(", ")+"])"},t.prototype.markWritablePath=function(){Utilities.warnOnce("cannot write through ranges")},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationRange(this,e);e.evaluationNodes[this.localToDefun][this.id]=t;for(var i=0;i!==this.values.length;i++)t.addElement(i,getEvaluationNode(this.values[i],e));return t},t.prototype.pickQualifiedExpression=function(e,i,r){if(pickQualifiedExpressionStrategy<PickQualifiedExpressionStrategy.alwaysPick&&(pickQualifiedExpressionStrategy!==PickQualifiedExpressionStrategy.alwaysPickDefun||0===this.localToDefun))return this;for(var n=new Array(this.values.length),o=!1,s=0;s<this.values.length;s++)n[s]=this.values[s].containsQualifiedExpression&&this.values[s].hasSameVariantLocalityAs(this)?this.values[s].pickQualifiedExpression(e,i,r):this.values[s],n[s]!==this.values[s]&&(o=!0);return o?t.buildRange(n,this.closedLower,this.closedUpper,r,this.origExpr):this},t.buildRange=function(e,i,r,n,o){for(var s=void 0,a=0,d=0;d<e.length;d++)s=mergeLocality(s,e[d].localToArea),a=mergeDefunLocality(a,e[d].localToDefun);return new t(e,i,r,s,a,(new ValueType).addRange().addSize(1),o)},t.prototype.getDataSourceInputs=function(){return[]},t.prototype.isOrderedSetNode=function(){return!1},t}(OrderedSetNode),NegationNode=function(e){function t(t,i,r,n,o){var s=e.call(this,i,r,n,o)||this;return s.queries=t,s.checkForQualifiedExpressions(),s}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.negation},t.prototype.specificEqual=function(e){return arrayEqual(this.queries,e.queries)},t.prototype.isUnmergeable=function(){return!0},t.prototype.getMaximumInputId=function(e,t,i){for(var r=-1,n=this.localToArea?areaTemplates[this.localToArea].getScheduleStep(e,t):-1,o=0;o<this.queries.length;o++)this.queries[o]=t(this.queries[o],e,!1),this.queries[o].localToArea===this.localToArea&&this.queries[o].id>r&&(r=this.queries[o].id),n=this.queries[o].maxScheduleStep(this.prio,n);return i&&(this.scheduleStep=n+1),r},t.prototype.toString=function(){return"n("+this.queries.map(function(e){return e.idStr()}).join(", ")+")"},t.prototype.toFullString=function(){return"n("+this.queries.map(function(e){return e.toFullString()}).join(", ")+")"},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),this.formatCDLConstructor("n",this.queries,e)},t.prototype.toExportString=function(e){return"_neg("+this.localityString()+", ["+this.queries.map(function(t){return t.idExpStr(e)}).join(", ")+"])"},t.prototype.markWritablePath=function(){Utilities.warnOnce("cannot write through n()")},t.prototype.setPriority=function(e){if(!(e<=this.prio)){this.prio=e;for(var t=0;t<this.queries.length;t++)this.queries[t].setPriority(e)}},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationNegation(this,e);e.evaluationNodes[this.localToDefun][this.id]=t;for(var i=0;i!==this.queries.length;i++)t.addElement(i,getEvaluationNode(this.queries[i],e));return t},t.prototype.allInputs=function(){return this.queries},t.prototype.pickQualifiedExpression=function(e,i,r){if(pickQualifiedExpressionStrategy<PickQualifiedExpressionStrategy.alwaysPick&&(pickQualifiedExpressionStrategy!==PickQualifiedExpressionStrategy.alwaysPickDefun||0===this.localToDefun))return this;for(var n=new Array(this.queries.length),o=!1,s=0;s<this.queries.length;s++)n[s]=this.queries[s].containsQualifiedExpression&&this.queries[s].hasSameVariantLocalityAs(this)?this.queries[s].pickQualifiedExpression(e,i,r):this.queries[s],n[s]!==this.queries[s]&&(o=!0);return o?t.build(n,r,this.origExpr):this},t.build=function(e,i,r){for(var n=void 0,o=0,s=0;s<e.length;s++)n=mergeLocality(n,e[s].localToArea),o=mergeDefunLocality(o,e[s].localToDefun);return new t(e,n,o,(new ValueType).addQuery().addSize(1),r)},t.prototype.getDataSourceInputs=function(){return[]},t.prototype.checkWritability=function(){Utilities.error("do not call")},t}(FunctionNode),SubStringQueryNode=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.subStringQuery},t.prototype.specificEqual=function(e){for(var t=this.values,i=0;i!==t.length;i++)if(!e.values.some(function(e){return e.isEqual(t[i])}))return!1;for(var i=0;i!==e.values.length;i++)if(!t.some(function(t){return t.isEqual(e.values[i])}))return!1;return!0},t.prototype.isUnmergeable=function(){return!0},t.prototype.toString=function(){return"s("+this.values.map(function(e){return e.idStr()}).join(", ")+")"},t.prototype.toFullString=function(){return"s("+this.values.map(function(e){return e.toFullString()}).join(", ")+")"},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),this.formatCDLConstructor("s",this.values,e)},t.prototype.toExportString=function(e){return"_substr("+this.localityString()+", ["+this.values.map(function(t){return t.idExpStr(e)}).join(", ")+"])"},t.prototype.markWritablePath=function(){Utilities.warnOnce("cannot write through substring query")},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationSubStringQuery(this,e);e.evaluationNodes[this.localToDefun][this.id]=t;for(var i=0;i!==this.values.length;i++)t.addElement(i,getEvaluationNode(this.values[i],e));return t},t.prototype.pickQualifiedExpression=function(e,i,r){if(pickQualifiedExpressionStrategy<PickQualifiedExpressionStrategy.alwaysPick&&(pickQualifiedExpressionStrategy!==PickQualifiedExpressionStrategy.alwaysPickDefun||0===this.localToDefun))return this;for(var n=new Array(this.values.length),o=!1,s=0;s<this.values.length;s++)n[s]=this.values[s].containsQualifiedExpression&&this.values[s].hasSameVariantLocalityAs(this)?this.values[s].pickQualifiedExpression(e,i,r):this.values[s],n[s]!==this.values[s]&&(o=!0);return o?t.buildSubStringQuery(n,r,this.origExpr):this},t.buildSubStringQuery=function(e,i,r){for(var n=void 0,o=0,s=0;s<e.length;s++)n=mergeLocality(n,e[s].localToArea),o=mergeDefunLocality(o,e[s].localToDefun);return new t(e,n,o,(new ValueType).addQuery().addSize(1),r,void 0)},t.prototype.getDataSourceInputs=function(){return[]},t.prototype.isOrderedSetNode=function(){return!1},t}(OrderedSetNode),ComparisonFunctionNode=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.comparisonFunction},t.prototype.specificEqual=function(e){return arrayEqual(this.values,e.values)},t.prototype.isUnmergeable=function(){return!0},t.prototype.toString=function(){return"c("+this.values.map(function(e){return e.idStr()}).join(", ")+")"},t.prototype.toFullString=function(){return"c("+this.values.map(function(e){return e.toFullString()}).join(", ")+")"},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),this.formatCDLConstructor("c",this.values,e)},t.prototype.toExportString=function(e){return"_cf("+this.localityString()+", ["+this.values.map(function(t){return t.idExpStr(e)}).join(", ")+"])"},t.prototype.markWritablePath=function(){Utilities.warnOnce("cannot write through comparison function")},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationComparisonFunction(this,e);e.evaluationNodes[this.localToDefun][this.id]=t;for(var i=0;i!==this.values.length;i++)t.addElement(i,getEvaluationNode(this.values[i],e));return t},t.prototype.pickQualifiedExpression=function(e,i,r){if(pickQualifiedExpressionStrategy<PickQualifiedExpressionStrategy.alwaysPick&&(pickQualifiedExpressionStrategy!==PickQualifiedExpressionStrategy.alwaysPickDefun||0===this.localToDefun))return this;for(var n=new Array(this.values.length),o=!1,s=0;s<this.values.length;s++)n[s]=this.values[s].containsQualifiedExpression&&this.values[s].hasSameVariantLocalityAs(this)?this.values[s].pickQualifiedExpression(e,i,r):this.values[s],n[s]!==this.values[s]&&(o=!0);return o?t.buildComparisonFunction(n,r,this.origExpr):this},t.buildComparisonFunction=function(e,i,r){for(var n=void 0,o=0,s=0;s<e.length;s++)n=mergeLocality(n,e[s].localToArea),o=mergeDefunLocality(o,e[s].localToDefun);return new t(e,n,o,(new ValueType).addQuery().addSize(1),r,void 0)},t.prototype.isOrderedSetNode=function(){return!1},t}(OrderedSetNode),ConstNode=function(e){function t(t,i,r,n,o){var s,a=this;return void 0!==n?(s=t instanceof Array&&0===t.length?n!==!0&&[]:t instanceof Array&&1===t.length?t[0]:t,doCompileTimeChecks&&i.addSize(s instanceof Array?s.length:1)):(s=void 0===t?void 0:t instanceof Array?t:[t],doCompileTimeChecks&&i.addSize(void 0!==s?s.length:0)),a=e.call(this,void 0,0,i,r)||this,a.value=s,a.scheduleStep=-1,a.suppressSet=n,doCompileTimeChecks&&(a.wontChangeValue=o,a.containsQualifiedExpression=!1),a.prio=1,a}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.const},t.prototype.isEmptyOS=function(){return void 0===this.value||this.value instanceof Array&&0===this.value.length},t.prototype.isAlwaysTrue=function(){return isTrue(this.value)},t.prototype.isAlwaysFalse=function(){return isFalse(this.value)},t.prototype.isAlwaysUndefined=function(){return void 0===this.value},t.prototype.isUnmergeable=function(){return isSimpleValue(this.value)&&isUnmergeable(this.value)},t.prototype.isNull=function(){return null===this.value||this.value instanceof Array&&1===this.value.length&&null===this.value[1]},t.prototype.specificEqual=function(e){if(this.suppressSet!==e.suppressSet)return!1;if(void 0!==this.compiledQuery||void 0!==e.compiledQuery){if(void 0===this.compiledQuery||void 0===e.compiledQuery)return!1;if(!this.compiledQuery.isEqual(e.compiledQuery))return!1}return typeof this.value==typeof e.value&&("object"==typeof this.value?objectEqual(this.value,e.value):this.value===e.value)},t.prototype.getMaximumInputId=function(e,t,i){var r=-1;if(void 0!==this.compiledQuery){var n=t(this.compiledQuery,e,!1);this.compiledQuery=n,this.compiledQuery.localToArea===this.localToArea&&this.compiledQuery.id>r&&(r=this.compiledQuery.id)}return r},t.prototype.setSchedulingError=function(){},t.prototype.toString=function(){var e;if(void 0!==this.suppressSet){var t=getDeOSedValue(this.value);e=vstringify(t)}else{var i=this.value instanceof Array?this.value:[this.value];e="o("+i.map(vstringify).join(",")+")"}return e},t.prototype.toFullString=function(){var e;if(void 0!==this.suppressSet){var t=getDeOSedValue(this.value);e=vstringify(t)}else{var i=this.value instanceof Array?this.value:[this.value];e="o("+i.map(vstringify).join(",")+")"}return e},t.prototype.toCDLString=function(e){void 0===e&&(e=void 0);var t=getDeOSedValue(this.value);return t instanceof Array?"o("+t.map(vstringify).join(",")+")":vstringify(t)},t.prototype.toExportString=function(e){var t,i;if(void 0!==this.suppressSet){var r=this.value instanceof Array&&1===this.value.length?this.value[0]:this.value;i=String(this.suppressSet),t=cstringify(r)}else if(this.value instanceof Array&&0===this.value.length||void 0===this.value)t="constEmptyOS",i="undefined";else{var n=this.value instanceof Array?this.value:[this.value];t="["+n.map(cstringify).join(",")+"]",i="undefined"}return void 0===this.compiledQuery?"_v("+t+", "+i+")":"_vcq("+t+", "+this.compiledQuery.idExpStr(e)+", "+i+")"},t.prototype.setCompiledQuery=function(e){this.compiledQuery=e},t.prototype.isSingleString=function(){return"string"==typeof this.value||this.value instanceof Array&&1===this.value.length&&"string"==typeof this.value[0]},t.prototype.markWritablePath=function(){Utilities.warnOnce("cannot write to const")},t.prototype.setPriority=function(e){},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationConst(this);return e.evaluationNodes[this.localToDefun][this.id]=t,t},t.prototype.allInputs=function(){return[]},t.prototype.canMergeUnderQualifier=function(e){if(!(e instanceof t))return!1;var i=e;return void 0===this.compiledQuery&&void 0===i.compiledQuery&&this.suppressSet===e.suppressSet},t.prototype.mergeUnderQualifier=function(e){var i=e,r=mergeConst(this.value,i.value),n=this.valueType.merge(e.valueType);return new t(r,n,expressionStore.get(runtimeValueToCdlExpression(r),void 0),this.suppressSet,this.wontChangeValue&&i.wontChangeValue)},t.prototype.getSortKeys=function(){function e(t,i){var r;if(t instanceof Array){r=[];for(var n=0;n<t.length;n++)r=r.concat(e(t[n],i));return r}if(isSimpleValue(t)||t instanceof NonAV)r=[i];else{r=[];for(var o in t)r=r.concat(e(t[o],i.concat(o)))}return r}return e(this.value,[])},t.prototype.getDataSourceInputs=function(){return[]},t.prototype.getBoolInterpretation=function(){return new t(isTrue(this.value),(new ValueType).addBoolean().addSize(1),void 0,this.suppressSet,this.wontChangeValue)},t.prototype.isStrictSelection=function(){function e(t){if(t instanceof Array)return t.every(e);if(t instanceof NonAV)return!(t instanceof OrderedSetNode);if(isSimpleValue(t))return void 0!==t;if("object"==typeof t){for(var i in t)if(!e(t[i]))return!1;return!0}return!1}return e(this.value)},t.prototype.checkWritability=function(){Utilities.error("do not call")},t.prototype.mightChange=function(){return this.wontChangeValue?new t(this.value,this.valueType,this.origExpr,this.suppressSet,!1):this},t.prototype.tagExpressionPath=function(e,t,i){},t}(FunctionNode),CondNode=function(e){function t(t,i,r,n,o,s){var a=e.call(this,r,n,o,s)||this;return a.condVar=t,a.altList=i,doCompileTimeChecks&&(a.hasWritableReference=i.some(function(e){return void 0!==e.use&&e.use.hasWritableReference}),a.checkForQualifiedExpressions()),a}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.cond},t.prototype.specificEqual=function(e){if(this.altList.length!==e.altList.length||!this.condVar.isEqual(e.condVar))return!1;for(var t=0;t!==this.altList.length;t++)if(!this.altList[t].on.isEqual(e.altList[t].on)||!this.altList[t].use.isEqual(e.altList[t].use))return!1;return!0},t.prototype.isAlwaysTrue=function(){for(var e=!1,t=0;t!==this.altList.length;t++)if(this.altList[t].on.isNull()&&(e=!0),!this.altList[t].use.isAlwaysTrue())return!1;return e},t.prototype.isUnmergeable=function(){for(var e=0;e!==this.altList.length;e++)if(!this.altList[e].use.isUnmergeable())return!1;return!0},t.prototype.conditionalSingleArea=function(){var e,t;if(0!==this.altList.length){for(var i=0;i!==this.altList.length;i++){var r=levelOfEmbeddingFun(this.altList[i].use,this.altList[i].use.localToArea);if(void 0===r||r.min!==r.max)return;if(0===i)e=r.min,t=this.altList[i].use.localToArea;else if(r.min!==e||r.max!==e||t!==this.altList[i].use.localToArea)return}return areaTemplates[t].getEmbedding(e).id}},t.prototype.replaceConditionalResult=function(e,i){return t.build(this.condVar,this.altList.map(function(t){return{on:t.on,use:e}}),i,this.origExpr)},t.prototype.getMaximumInputId=function(e,t,i){var r=-1,n=this.localToArea?areaTemplates[this.localToArea].getScheduleStep(e,t):-1;this.condVar=t(this.condVar,e,!1),this.condVar.localToArea===this.localToArea&&this.condVar.id>r&&(r=this.condVar.id),n=this.condVar.maxScheduleStep(this.prio,n);for(var o=0;o!==this.altList.length;o++)this.altList[o].on=t(this.altList[o].on,e,!1),this.altList[o].on.localToArea===this.localToArea&&this.altList[o].on.id>r&&(r=this.altList[o].on.id),n=this.altList[o].on.maxScheduleStep(this.prio,n),this.altList[o].use=t(this.altList[o].use,e,!1),this.altList[o].use.localToArea===this.localToArea&&this.altList[o].use.id>r&&(r=this.altList[o].use.id),n=this.altList[o].use.maxScheduleStep(this.prio,n);return i&&(this.scheduleStep=n+1),r},t.prototype.toString=function(){return"[cond, "+this.condVar.idStr()+", o("+this.altList.map(function(e){return"{on:"+e.on.idStr()+", use:"+e.use.idStr()+"}"}).join(", ")+")]"},t.prototype.toFullString=function(){return"[cond, "+this.condVar.toFullString()+", o("+this.altList.map(function(e){return"{on:"+e.on.toFullString()+", use:"+e.use.toFullString()+"}"}).join(", ")+")]"},t.prototype.toCDLString=function(e){void 0===e&&(e=void 0);for(var t="[cond, "+this.condVar.toCDLString(void 0)+", o(",i=void 0!==e?e+"    ":void 0,r=0;r<this.altList.length;r++){var n=this.altList[r];r>0&&(t+=", "),t+="{",void 0!==i&&(t+="\n"+i),t+="on: "+n.on.toCDLString(void 0)+", use:"+n.use.toCDLString(void 0),void 0!==e&&(t+="\n"+e),t+="}"}return t+")]"},t.prototype.toExportString=function(e){return"_co("+this.localityString()+", "+this.condVar.idExpStr(e)+", ["+this.altList.map(function(t){return"{on:"+t.on.idExpStr(e)+", use:"+t.use.idExpStr(e)+"}"}).join(", ")+"])"},t.prototype.markWritablePath=function(){if(this.writabilityUndetermined()){this.writable=!0;for(var e=0;e!==this.altList.length;e++)this.altList[e].use.markWritablePath();FunctionNode.writabilityQueue.push(this)}},t.prototype.checkWritability=function(){for(var e=0;e!==this.altList.length;e++)if(this.altList[e].use.writable)return void(this.writable=!0)},t.prototype.setPriority=function(e){if(!(e<=this.prio)){this.prio=e,this.condVar.setPriority(e);for(var t=0;t!==this.altList.length;t++)this.altList[t].on.setPriority(e),this.altList[t].use.setPriority(e)}},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationCond(this,e);e.evaluationNodes[this.localToDefun][this.id]=t,t.setConditionVar(getEvaluationNode(this.condVar,e));for(var i=0;i!==this.altList.length;i++)t.addAltOn(getEvaluationNode(this.altList[i].on,e));return t},t.prototype.allInputs=function(){for(var e=[this.condVar],t=0;t!==this.altList.length;t++)e.push(this.altList[t].on),e.push(this.altList[t].use);return e},t.prototype.pickQualifiedExpression=function(e,i,r){if(pickQualifiedExpressionStrategy<PickQualifiedExpressionStrategy.alwaysPick&&(pickQualifiedExpressionStrategy!==PickQualifiedExpressionStrategy.alwaysPickDefun||0===this.localToDefun))return this;for(var n=this.condVar.containsQualifiedExpression&&this.condVar.hasSameVariantLocalityAs(this)?this.condVar.pickQualifiedExpression(e,i,r):this.condVar,o=new Array(this.altList.length),s=!1,a=0;a<this.altList.length;a++){var d=this.altList[a].on.containsQualifiedExpression&&this.altList[a].on.hasSameVariantLocalityAs(this)?this.altList[a].on.pickQualifiedExpression(e,i,r):this.altList[a].on,u=this.altList[a].use.containsQualifiedExpression&&this.altList[a].use.hasSameVariantLocalityAs(this)?this.altList[a].use.pickQualifiedExpression(e,i,r):this.altList[a].use;o[a]={on:d,use:u},d===this.altList[a].on&&u===this.altList[a].use||(s=!0)}return s?t.build(n,o,r,this.origExpr):this},t.build=function(e,i,r,n){var o=new ValueType,s=e.localToArea,a=e.localToDefun,d=!0;if(e instanceof ConstNode){var u=!0;d=e.wontChangeValue;for(var h=0;u&&h!==i.length;h++){var l=i[h].on;if(!(l instanceof ConstNode)){u=!1;break}var c=getDeOSedValue(l.value);if(d=d&&l.wontChangeValue,null===c||interpretedBoolMatch(c,e.value))return d?i[h].use:i[h].use.mightChange()}if(u)return buildConstNode([],d,void 0,0,gEmptyOSExpr)}for(var p=!0,h=0;h!==i.length;h++){var l=i[h].on,f=i[h].use;if(p)if(l instanceof ConstNode)if(l.value===!0||l.value instanceof Array&&l.value[0]===!0){if(e.isAlwaysTrue())return f}else if(l.value===!1||l.value instanceof Array&&(0===l.value.length||l.value[0]===!1)){if(e.isAlwaysFalse())return f}else p=!1;else p=!1;s=mergeLocality(s,l.localToArea),s=mergeLocality(s,f.localToArea),a=mergeDefunLocality(a,l.localToDefun),a=mergeDefunLocality(a,f.localToDefun),o=o.merge(f.valueType)}return 2===i.length&&i[0].on instanceof ConstNode&&(i[0].on.value===!0||objectEqual(i[0].on.value,[!0]))&&i[1].on instanceof ConstNode&&(i[1].on.value===!1||objectEqual(i[1].on.value,[])||objectEqual(i[1].on.value,[!1]))&&i[1].use instanceof ConstNode&&objectEqual(i[1].use.value,[])?BoolGateNode.build(e,i[0].use,n):2===i.length&&i[1].on instanceof ConstNode&&(i[1].on.value===!0||objectEqual(i[1].on.value,[!0]))&&i[0].on instanceof ConstNode&&(i[0].on.value===!1||objectEqual(i[0].on.value,[])||objectEqual(i[0].on.value,[!1]))&&i[0].use instanceof ConstNode&&objectEqual(i[0].use.value,[])?BoolGateNode.build(e,i[1].use,n):(p&&(e=e.getBoolInterpretation()),new t(e,i,s,a,o,n))},t.prototype.setDefunArgTypes=function(e,t){if(!(this.seqNr in t)){t[this.seqNr]=!0;for(var i=0;i<this.altList.length;i++)this.altList[i].use.setDefunArgTypes(e,t);delete t[this.seqNr]}},t.prototype.getDataSourceInputs=function(){return this.altList.map(function(e){return e.use})},t.prototype.isStrictSelection=function(){return this.altList.every(function(e){return e.use.isStrictSelection()})},t.prototype.extractWritableDestinations=function(e,t){var i;return this.seqNr in t?[]:(t[this.seqNr]=!0,i=this.altList.map(function(i){return i.use.extractWritableDestinations(e,t)}).reduce(function(e,t){return t.length>0?e.concat(t):e},[]),delete t[this.seqNr],i)},t}(FunctionNode),dbgcnt=0,StubFunctionNode=function(e){function t(t,i,r){var n=e.call(this,t,i,void 0===r?new ValueType:r,void 0)||this;return n.stubCycleNr=gStubCycleNr,n.stopped=!1,n.id=-3,n.checkForQualifiedExpressions(),n}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.stub},t.prototype.specificEqual=function(e){var t=e;dbgcnt++;var i=void 0!==this.resolution&&void 0!==t.resolution&&this.resolution.isEqual(t.resolution);return dbgcnt--,i},t.prototype.isAlwaysTrue=function(){return void 0!==this.resolution&&this.resolution.isAlwaysTrue()},t.prototype.isAlwaysFalse=function(){return void 0!==this.resolution&&this.resolution.isAlwaysFalse()},t.prototype.isUnmergeable=function(){return void 0!==this.resolution&&this.resolution.isUnmergeable()},t.prototype.getMaximumInputId=function(e,t,i){var r=-1;return this.seqNr in e||(e[this.seqNr]=!0,void 0===this.resolution&&(r=this.resolution.getMaximumInputId(e,t,i)),delete e[this.seqNr]),r},t.prototype.resolve=function(e){assert(this!==e,"resolve cycle"),this.resolution=e,this.id=-4,void 0!==e?(this.valueType=e.valueType,this.localToArea=e.localToArea,this.localToDefun=e.localToDefun,this.containsQualifiedExpression=e.containsQualifiedExpression,e.markAsResolution(this),this.hasWritableReference=e.hasWritableReference):(this.valueType=new ValueType,this.localToArea=void 0,this.localToDefun=0,this.containsQualifiedExpression=!1,this.hasWritableReference=!1)},t.prototype.resetResolution=function(){this.cycleNr!==gCycleNr&&(this.cycleNr=gCycleNr,this.stopped=!1,this.id=-3)},t.prototype.idStr=function(){return this.resolution?this.resolution.idStr():"<UNDEFINED>"},t.prototype.toString=function(){return void 0===this.resolution?"Stub(<undefined>)":"Stub("+this.resolution.idStr()+")"},t.prototype.toFullString=function(){return void 0===this.resolution?"stub(<undefined>)":"stub("+this.resolution.toFullString()+")"},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),void 0===this.resolution?"[stub]":this.formatCDLFunctionCall("stub",[this.resolution],e)},t.prototype.toExportString=function(e){return this.resolution.toExportString(e)},t.prototype.markWritablePath=function(){this.writabilityUndetermined()&&(this.writable=!0,this.resolution.markWritablePath(),FunctionNode.writabilityQueue.push(this))},t.prototype.checkWritability=function(){this.writable=this.resolution.writable},t.prototype.setPriority=function(e){this.resolution.setPriority(e)},t.prototype.allInputs=function(){return void 0!==this.resolution?[this.resolution]:[]},t.prototype.pickQualifiedExpression=function(e,t,i){return pickQualifiedExpressionStrategy<PickQualifiedExpressionStrategy.alwaysPick&&(pickQualifiedExpressionStrategy!==PickQualifiedExpressionStrategy.alwaysPickDefun||0===this.localToDefun)?this:void 0===this.resolution?this:this.resolution.containsQualifiedExpression&&this.resolution.hasSameVariantLocalityAs(this)?this.resolution.pickQualifiedExpression(e,t,i):this.resolution},t.prototype.getDataSourceInputs=function(){return void 0===this.resolution?[]:[this.resolution]},t.prototype.extractWritableDestinations=function(e,t){var i;return this.seqNr in t?[]:(t[this.seqNr]=!0,i=this.resolution.extractWritableDestinations(e,t),delete t[this.seqNr],i)},t.prototype.getConstancy=function(){return void 0===this.resolution&&this.resolution.getConstancy()},t}(FunctionNode),QueryCycle=function(e){function t(t,i,r,n){var o=e.call(this,i,r,new ValueType,void 0)||this;return o.path=t,o.cycleInfo=n,o.id=-5,o}return __extends(t,e),t.prototype.type=function(){return FunctionNodeType.queryCycle},t.prototype.specificEqual=function(e){var t=e;return objectEqual(this.path,t.path)},t.prototype.getMaximumInputId=function(e,t,i){return-1},t.prototype.toString=function(){return"QueryCycle("+this.path.toString()+")"},t.prototype.toFullString=function(){return"cycle("+this.path.toString()+")"},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),"[cycle]"},t.prototype.toExportString=function(e){assert(!1,"export not allowed")},t.prototype.getDataSourceInputs=function(){return[]},t.prototype.checkWritability=function(){Utilities.error("do not call")},t.prototype.allInputs=function(){Utilities.error("do not call")},t.prototype.markWritablePath=function(){Utilities.error("do not call")},t.prototype.setPriority=function(e){Utilities.error("do not call")},t}(FunctionNode),DefunNode=function(e){function t(t,i,r,n,o,s,a){var d=e.call(this,t,i,void 0===s?void 0:(new ValueType).addDefun(s.valueType).addSize(1),a)||this;return d.inUse=!1,d.defunNr=r,d.parameters=n,d.parameterNodes=o,d.body=s,d.orig=a,doCompileTimeChecks&&(d.containsQualifiedExpression=d.body.containsQualifiedExpression),d}return __extends(t,e),t.prototype.setBody=function(e){this.body=e},t.prototype.type=function(){return FunctionNodeType.defun},t.prototype.specificEqual=function(e){var t=e;return this.defunNr===t.defunNr},t.prototype.isAlwaysTrue=function(){return!0},t.prototype.isUnmergeable=function(){return!0},t.prototype.getMaximumInputId=function(e,t,i){var r=-1,n=this.localToArea?areaTemplates[this.localToArea].getScheduleStep(e,t):-1;0===this.body.localToDefun&&(this.body=t(this.body,e,!1),this.body.localToArea===this.localToArea&&this.body.id>r&&(r=this.body.id),n=this.body.maxScheduleStep(this.prio,n));for(var o=0;o!==this.parameterNodes.length;o++)this.parameterNodes[o]=t(this.parameterNodes[o],e,!1),this.parameterNodes[o].localToArea===this.localToArea&&this.parameterNodes[o].id>r&&(r=this.parameterNodes[o].id),n=this.parameterNodes[o].maxScheduleStep(this.prio,n);return i&&(this.scheduleStep=n+1),r},t.prototype.postCache=function(e,t){0!==this.body.localToDefun&&(assert(!this.inUse,"cannot be called recursively"),this.inUse=!0,t(this.body,e,!1),this.scheduleStep=this.body.scheduleStep+1,this.inUse=!1)},t.prototype.setSchedulingError=function(){},t.prototype.isScheduledProperly=function(){return this.body.isScheduledProperly()},t.prototype.toString=function(){return"defun("+JSON.stringify(this.parameters)+", "+this.body.idStr()+")"},t.prototype.toFullString=function(){return"defun("+JSON.stringify(this.parameters)+")"},t.prototype.toCDLString=function(e){return void 0===e&&(e=void 0),this.formatArray(["defun, o("+Object.keys(this.parameters).join(",")+")",this.body],!0,e)},t.prototype.toExportString=function(e){if(0===this.body.localToDefun)return"_def("+this.localityString()+", "+this.defunNr+", ["+this.parameterNodes.map(function(t){return t.idExpStr(e)}).join(", ")+"], "+this.body.idExpStr(e)+", function () {\n"+this.parameterNodes.map(function(t){return t.constructPrototypeFunctionCall(e)}).join("\n    ")+"\n    })";var t=this.localToArea>0?areaTemplates[this.localToArea].defunFunctionNodes[this.defunNr]:FunctionNode.globalDefunFunctionNodes[this.defunNr];return void 0===t?(Utilities.warn("defun "+this.idStr()+" undefined"),"_v(constEmptyOS, undefined)"):"_def("+this.localityString()+", "+this.defunNr+", ["+this.parameterNodes.map(function(t){return t.idExpStr(e);
}).join(", ")+"], "+this.body.idExpStr(e)+", function () {\n"+t.map(function(t){return t.constructPrototypeFunctionCall(e)}).join("\n    ")+"\n    })"},t.prototype.markWritablePath=function(){Utilities.warnOnce("cannot write through defun")},t.prototype.setPriority=function(e){if(!(e<=this.prio)){this.prio=e;for(var t=0;t!==this.parameterNodes.length;t++)this.parameterNodes[t].setPriority(e);this.body.setPriority(e)}},t.prototype.makeEvaluationNode=function(e){var t=new EvaluationDefun(this,e);return e.evaluationNodes[this.localToDefun][this.id]=t,t},t.prototype.allInputs=function(){return[]},t.prototype.valueUnderQualifier=function(e,i){gDefunStack.push(this.defunNr);var r=this.body.valueUnderQualifier(e,i);return gDefunStack.pop(),r===this.body?this:new t(this.localToArea,this.localToDefun,this.defunNr,this.parameters,this.parameterNodes,r,this.orig)},t.prototype.pickQualifiedExpression=function(e,i,r){if(this.body.containsQualifiedExpression){gDefunStack.push(this.defunNr);var n=pickQualifiedExpressionStrategy;pickQualifiedExpressionStrategy<PickQualifiedExpressionStrategy.alwaysPick&&(pickQualifiedExpressionStrategy=PickQualifiedExpressionStrategy.alwaysPickDefun);var o=this.body.pickQualifiedExpression(e,i,r);if(pickQualifiedExpressionStrategy=n,gDefunStack.pop(),o!==this.body)return new t(this.localToArea,this.localToDefun,this.defunNr,this.parameters,this.parameterNodes,o,this.orig)}return this},t.prototype.setDefunArgTypes=function(e,t){if(!(this.seqNr in t)){if(t[this.seqNr]=!0,e.length!==this.parameterNodes.length)return void Utilities.syntaxError("mismatch nr parameters");this.orig.setDefunArgTypes(e),delete t[this.seqNr]}},t.prototype.getDataSourceInputs=function(){return[]},t.prototype.checkWritability=function(){Utilities.error("do not call")},t.prototype.tagExpressionPath=function(t,i,r){e.prototype.tagExpressionPath.call(this,t,i,r);for(var n=0;n<this.parameterNodes.length;n++){var o=this.parameterNodes[n];o.tagExpressionPath(t,this.defunNr,r+".defun."+o.path[0])}this.body.tagExpressionPath(t,this.defunNr,r+".defun")},t}(FunctionNode),VerificationFunctionNode=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.getValueType=function(e){return e[0].valueType},t.build=function(e,i){var r=mergeLocality(e.localToArea,i.localToArea),n=mergeDefunLocality(e.localToDefun,i.localToDefun);return new t(verificationFunction,[e,i],r,n,e.valueType,void 0)},t.prototype.isAlwaysTrue=function(){return this.functionArguments[0].isAlwaysTrue()},t.prototype.isUnmergeable=function(){return this.functionArguments[0].isUnmergeable()},t}(FunctionApplicationNode),suppressMoveAndKey=!1,logEventTimes=!1,logEventHistory=!1,logEventComments=!1,debugEvents=!1,gAppInFront=!0;"undefined"!=typeof window&&(window.onblur=function(){gAppInFront=!1},window.onfocus=function(){gAppInFront=!0});var inMouseDown=!1,gExpTaskTimeCheck=0,gDontProcessEvent=void 0,domEventEmptyOS=[],domEventTrueResult=new Result(constTrueOS),domEventFalseResult=new Result(constEmptyOS),MondriaDomEvent=function(){function e(e,t){this.pointerObj=e,this.rootAreaId=t,this.lastKeyDownIdentifier=void 0,this.eventHistory=[],this.dragCounter=0,this.lastIgnoredMouseMoveTime=void 0,this.domEventAreasUnderPointerResult=new Result,this.areaChangeCounter=areaChangeCounter,this.areaWithFocus=void 0,this.nextAreaWithFocus=[],this.eventDiv=void 0,this.debugAbortId=void 0,this.mouseOverScreenArea=!0,this.topDivState=0,this.eventAutomaton=new EventAutomaton,this.checkClickExpirationTask=void 0,this.dragValue=constEmptyOS,this.firstTouchId=0,this.rootArea=allAreaMonitor.getAreaById(t),this.lastKeyDownIdentifier=void 0,this.createDiv(),this.addEventHandlers(this.eventDiv),this.addGlobalEventHandlers()}return e.prototype.addEventHandlers=function(e){for(var t=[{type:"mousedown",handler:this.mouseDownHandler},{type:"mouseup",handler:this.mouseUpHandler},{type:"mousemove",handler:this.mouseMoveHandler},{type:"keydown",handler:this.keyDownHandler},{type:"keyup",handler:this.keyUpHandler},{type:"keypress",handler:this.keyPressHandler},{type:"wheel",handler:this.wheelHandler},{type:"mouseleave",handler:this.mouseOutHandler},{type:"mouseenter",handler:this.mouseInHandler},{type:"touchstart",handler:this.touchStartHandler},{type:"touchend",handler:this.touchEndHandler},{type:"touchcancel",handler:this.touchCancelHandler},{type:"touchmove",handler:this.touchMoveHandler}],i=0;i<t.length;i++){var r=t[i];this.addEventHandler(r.type,r.handler,e)}},e.prototype.addGlobalEventHandlers=function(){for(var e=[{type:"dragenter",handler:this.dragEnterHandler},{type:"dragleave",handler:this.dragLeaveHandler},{type:"dragover",handler:this.dragOverHandler},{type:"drop",handler:this.dropHandler},{type:"dragEnd",handler:this.dragEndHandler},{type:"mouseup",handler:this.mouseUpHandler},{type:"pointermove",handler:this.mouseMoveHandler}],t=0;t<e.length;t++){var i=e[t];this.addEventHandler(i.type,i.handler,window)}},e.prototype.createDiv=function(){this.eventDiv=document.getElementById("mondriaRootDiv"),this.eventDiv.style.cursor="default",this.eventDiv.style.outline="none",this.eventDiv.setAttribute("tabindex","0"),this.setGlobalFocus()},e.prototype.setGlobalFocus=function(){this.eventDiv.focus&&(this.eventDiv.focus(),this.recordComment("globalFocus"))},e.prototype.addEventHandler=function(e,t,i){function r(e){if(gDontProcessEvent!==e){if(mondriaMutex)return void Utilities.runtimeWarning("suppressing re-entrancy");mondriaMutex=!0,debugTotalTimeStop("timed-out task delay"),debugTotalTimeStart("event handling");try{t.call(n,e),debugTotalTimeStop("event handling"),debugTotalTimeStart("timed-out task delay")}finally{mondriaMutex=!1}}}var n=this;i.addEventListener(e,r,!1)},e.prototype.startExpirationTask=function(){var e=this;runTests||(this.checkClickExpirationTask=setTimeout(function(){e.checkClickExpired(Date.now(),0,0,!0,"timeout")},this.eventAutomaton.maxClickDelta),gExpTaskTimeCheck=Date.now())},e.prototype.cancelExpirationTask=function(){void 0!==this.checkClickExpirationTask&&(clearTimeout(this.checkClickExpirationTask),this.checkClickExpirationTask=void 0)},e.prototype.mouseDownHandler=function(e){inMouseDown=!0,runTests||(this.cancelExpirationTask(),this.startExpirationTask()),blockTaskLoop&&resumeTaskProcessing(),this.mouseEventHandler(e,"MouseDown",[{pointer:this.pointerObj,pointerID:-1,buttonID:e.button,state:"down"}])},e.prototype.mouseUpHandler=function(e){inMouseDown=!1,runTests||(this.cancelExpirationTask(),this.startExpirationTask()),blockTaskLoop&&resumeTaskProcessing(),this.mouseEventHandler(e,"MouseUp",[{pointer:this.pointerObj,pointerID:-1,buttonID:e.button,state:"up"}])},e.prototype.mouseMoveHandler=function(t){if(!suppressMoveAndKey&&(gAppInFront||t instanceof ImpersonatedDomEvent)&&!blockTaskLoop){inMouseDown&&markEventStart("mouse move",100),logEventHistory&&this.eventHistory.push({type:"mousemove",absX:t.clientX,absY:t.clientY,time:Date.now(),shiftKey:t.shiftKey,metaKey:t.metaKey,altKey:t.altKey,ctrlKey:t.ctrlKey}),this.checkClickExpired(Date.now(),t.clientX,t.clientY,!1,"mousemove");var i=this.getOverlappingAreas(t.clientX,t.clientY),r=!0;if(i.length>0){var n=i[0].recipient;n instanceof DisplayArea&&void 0!==n.display&&void 0!==n.display.displayElement&&e.findClickable(n.display.displayElement.content,t.clientX,t.clientY)&&(r=!1)}r&&t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),queueEvent(t,void 0,void 0,domEventEmptyOS,this.pointerObj,i,void 0,void 0,void 0,void 0)}},e.prototype.inEventDivCoordinates=function(e,t){var i=this.eventDiv.getBoundingClientRect();return i.top<=t&&t<i.bottom&&i.left<=e&&e<i.right},e.prototype.mouseOutHandler=function(e){if(!blockTaskLoop&&this.mouseOverScreenArea&&!this.inEventDivCoordinates(e.clientX,e.clientY)){this.cancelExpirationTask(),this.checkClickExpired(0,0,0,!0,"mouseout"),this.mouseOverScreenArea=!1,this.recordComment("MouseOut");var t={type:["MouseOut"],time:[Date.now()]};queueEvent(e,t,void 0,[],this.pointerObj,void 0,void 0,void 0,void 0,void 0)}},e.prototype.clearDragState=function(){return 0!==this.dragCounter&&(this.dragCounter=0,this.dragValue=constEmptyOS,queueEvent(new ImpersonatedDomEvent("cleardragstate"),void 0,void 0,[],this.pointerObj,void 0,domEventEmptyOS,void 0,void 0,void 0),!0)},e.prototype.mouseInHandler=function(e){if(!blockTaskLoop&&!this.mouseOverScreenArea&&this.inEventDivCoordinates(e.clientX,e.clientY)){this.mouseOverScreenArea=!0,this.recordComment("MouseIn"),this.clearDragState(),inMouseDown&&0===e.buttons&&this.mouseUpHandler(new ImpersonatedMouseDomEvent("mouseup",void 0,e.clientX,e.clientY,void 0,[]));var t={type:["MouseIn"],time:[Date.now()]};queueEvent(e,t,void 0,[],this.pointerObj,void 0,void 0,void 0,void 0,void 0)}},e.prototype.dragEnterHandler=function(e){if(!blockTaskLoop){if(e.preventDefault(),0===this.dragCounter){if(this.dragValue=[],void 0===e.dataTransfer.files||0===e.dataTransfer.files.length)if("items"in e.dataTransfer)for(var t=0;t<e.dataTransfer.items.length;t++)this.dragValue.push({kind:e.dataTransfer.items[t].kind,type:e.dataTransfer.items[t].type});else this.dragValue.push({kind:"unknown"});else for(var t=0;t<e.dataTransfer.files.length;t++){var i=shallowCopy(e.dataTransfer.files[t]);"items"in e.dataTransfer?i.kind=e.dataTransfer.items[t].kind:i.kind="file",this.dragValue.push(i)}queueEvent(e,void 0,void 0,domEventEmptyOS,this.pointerObj,void 0,this.dragValue,void 0,void 0,void 0)}this.dragCounter=1}},e.prototype.dragLeaveHandler=function(e){blockTaskLoop||(e.preventDefault(),0!==this.dragCounter||this.inEventDivCoordinates(e.clientX,e.clientY)||this.clearDragState())},e.prototype.dragOverHandler=function(e){if(e.preventDefault(),!blockTaskLoop){markEventStart("dragover"),logEventHistory&&this.eventHistory.push({type:"dragover",absX:e.clientX,absY:e.clientY,time:Date.now(),shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,ctrlKey:e.ctrlKey}),this.cancelExpirationTask(),this.checkClickExpired(Date.now(),e.clientX,e.clientY,!1,"mousemove");var t=this.getOverlappingAreas(e.clientX,e.clientY);queueEvent(e,void 0,void 0,domEventEmptyOS,this.pointerObj,t,this.dragValue,void 0,void 0,void 0)}},e.prototype.dragEndHandler=function(e){blockTaskLoop||(e.preventDefault(),this.clearDragState())},e.prototype.dropHandler=function(e){blockTaskLoop||(e.preventDefault(),markEventStart("drop"),this.fileChoice(e,"drop",e.dataTransfer.files,this.getOverlappingAreas(e.clientX,e.clientY)),this.clearDragState())},e.prototype.pickFile=function(e,t,i){e.preventDefault(),markEventStart("pick"),this.fileChoice(e,"pick",i,[{recipient:t,relX:0,relY:0}])},e.prototype.fileChoice=function(e,t,i,r){var n=e.clientX,o=e.clientY,s=Date.now(),a=this.getDomModifier(e),d=r.map(function(e){return e.recipient});logEventHistory&&this.eventHistory.push({type:e.type,absX:n,absY:o,modifier:a,time:s}),this.eventAutomaton.reset();for(var u=[],h=0;h<i.length;h++){var l=i[h];if(l instanceof File){var c=new NativeObjectWrapper;c.file=l,u.push({fileHandle:[c],lastModified:ensureOS(l.lastModified),lastModifiedDate:ensureOS(l.lastModifiedDate),fullName:[l.name],size:[l.size],type:[l.type],name:[extractBaseName(l.name)]})}else"string"==typeof l&&u.push({fileHandle:[l],lastModified:constEmptyOS,lastModifiedDate:constEmptyOS,fullName:[l],size:void 0,type:[extractExtension(l)],name:[extractBaseName(l)]})}var p={type:["FileChoice"],time:[s],modifier:a,absX:[n],absY:[o],files:u};queueEvent(e,p,[{value:t,areas:d.slice(0)}],d,void 0,r,void 0,void 0,void 0,void 0),queueEvent(new ImpersonatedMouseDomEvent("mousemove",void 0,n,o,void 0,[]),void 0,void 0,domEventEmptyOS,this.pointerObj,r,void 0,void 0,void 0,void 0)},e.prototype.translateKeyPressEvent=function(t){var i;if(void 0!==t.key){if(0===t.charCode)return;i=t.key}else i=t.charCode<32?t.keyIdentifier?t.keyIdentifier:this.lastKeyDownIdentifier:String.fromCharCode(t.charCode);return i in e.keyTranslate?e.keyTranslate[i]:i},e.prototype.keyDownHandler=function(e){return this.keyDownUpHandler(e,void 0,!0)},e.prototype.keyPressHandler=function(e){return this.keyPressHandlerInt(e,void 0)},e.prototype.keyUpHandler=function(e){return this.keyDownUpHandler(e,void 0,!1)},e.prototype.keyDownUpHandler=function(t,i,r){var n=t.key||t.keyIdentifier,o=n in e.keyTranslate?e.keyTranslate[n]:n,s=String.fromCharCode(t.keyCode),a=r?"KeyDown":"KeyUp";return!!suppressMoveAndKey||("key"in t||(this.lastKeyDownIdentifier=n),n in e.keyTranslate?this.keyEventHandler(t,a,o,s,i):this.keyEventHandler(t,a,s,n,i),!0)},e.prototype.keyPressHandlerInt=function(e,t){var i=this.translateKeyPressEvent(e),r=String.fromCharCode(e.charCode);return!(!suppressMoveAndKey&&void 0!==i)||(this.keyEventHandler(e,"KeyPress",i,r,t),!0)},e.prototype.wheelHandler=function(e){suppressMoveAndKey||this.wheelEventHandler(e)},e.prototype.touchStartHandler=function(e){inMouseDown=!0,runTests||(this.cancelExpirationTask(),this.startExpirationTask()),blockTaskLoop&&resumeTaskProcessing(),void 0===this.firstTouchId&&e.changedTouches.length>0&&(this.firstTouchId=e.changedTouches[0].identifier),this.touchEventHandler(e,["TouchDown","MouseDown"])},e.prototype.touchEndHandler=function(e){inMouseDown=!1,runTests||(this.cancelExpirationTask(),this.startExpirationTask()),blockTaskLoop&&resumeTaskProcessing(),this.touchEventHandler(e,["TouchUp","MouseUp"]),0===e.touches.length&&(this.firstTouchId=void 0)},e.prototype.touchEventHandler=function(t,i){if(gAppInFront||t instanceof ImpersonatedDomEvent){var r=t.changedTouches[0];if(r){var n=r.clientX,o=r.clientY,s=Date.now(),a=this.getDomModifier(t);assert(0===domEventEmptyOS.length,"I'm counting on this, you know"),markEventStart("mouse "+i);var d,u=this.extendOverlappingAreas(this.getOverlappingAreas(n,o)),h=u.map(function(e){return e.recipient});d=runTests&&t instanceof ImpersonatedTouchDomEvent?void 0===t.subType?domEventEmptyOS:[{areas:u.map(function(e){return e.recipient}),value:t.subType}]:this.eventAutomaton.step(i[1],s,n,o,u),logEventHistory&&this.eventHistory.push({type:i,absX:n,absY:o,modifier:a,time:s,subTypes:void 0===d?void 0:d.map(function(e){return e.value})});var l={type:r.identifier===this.firstTouchId?i:[i[0]],time:[s],modifier:a,absX:[n],absY:[o],touchID:[r.identifier]};"MouseGestureExpired"===i[1]&&t instanceof ImpersonatedMouseGestureExpiredEvent&&(l.reason=[t.reason]);var c=!0;if(h.length>0){var p=h[0];p instanceof DisplayArea&&void 0!==p.display&&void 0!==p.display.displayElement&&e.findClickable(p.display.displayElement.content,n,o)&&(c=!1)}c&&t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),queueEvent(t,l,d,h,void 0,u,void 0,void 0,void 0,void 0,copyTouch(r)),0===t.touches.length&&queueEvent(t,void 0,void 0,[],void 0,[],void 0,void 0,void 0,void 0,copyTouch(r))}}},e.prototype.touchCancelHandler=function(e){inMouseDown=!1,runTests||(this.cancelExpirationTask(),this.startExpirationTask()),blockTaskLoop&&resumeTaskProcessing(),this.touchEventHandler(e,["TouchUp","MouseUp"])},e.prototype.touchMoveHandler=function(t){if(!suppressMoveAndKey&&(gAppInFront||t instanceof ImpersonatedDomEvent)&&!blockTaskLoop&&(inMouseDown&&markEventStart("mouse move",100),0!==t.touches.length)){var i=t.touches[0],r=i.clientX,n=i.clientY;logEventHistory&&this.eventHistory.push({type:"mousemove",absX:r,absY:n,time:Date.now(),shiftKey:t.shiftKey,metaKey:t.metaKey,altKey:t.altKey,ctrlKey:t.ctrlKey}),this.checkClickExpired(Date.now(),r,n,!1,"mousemove");var o=this.getOverlappingAreas(r,n),s=!0;if(o.length>0){var a=o[0].recipient;a instanceof DisplayArea&&void 0!==a.display&&void 0!==a.display.displayElement&&e.findClickable(a.display.displayElement.content,r,n)&&(s=!1)}s&&t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),queueEvent(t,void 0,void 0,domEventEmptyOS,this.pointerObj,o,void 0,void 0,void 0,void 0,copyTouch(i))}},e.prototype.checkClickExpired=function(e,t,i,r,n){"timeout"===n&&e-gExpTaskTimeCheck<this.eventAutomaton.maxClickDelta&&console.log("premature time out for clicks",e-gExpTaskTimeCheck),this.eventAutomaton.canEmitClick()&&(r||this.eventAutomaton.clickExpired(e,t,i))&&(this.cancelExpirationTask(),this.eventAutomaton.moveToExpiration(),runTests||this.mouseEventHandler(new ImpersonatedMouseGestureExpiredEvent(n,this.eventAutomaton.lastX,this.eventAutomaton.lastY),"MouseGestureExpired",void 0))},e.prototype.addTargetAreaForNextEvent=function(e,t){void 0===this.foreignManagedAreasForEvent&&(this.foreignManagedAreasForEvent={}),e in this.foreignManagedAreasForEvent||(this.foreignManagedAreasForEvent[e]={}),this.foreignManagedAreasForEvent[e][t]=!0},e.prototype.extendOverlappingAreas=function(e){if(void 0!==this.foreignManagedAreasForEvent&&event.type in this.foreignManagedAreasForEvent){for(var t in this.foreignManagedAreasForEvent[event.type]){var i=allAreaMonitor.getAreaById(t);void 0!==i&&(e=[{recipient:i,relX:void 0,relY:void 0}].concat(e.filter(function(e){return e.recipient!==i})))}this.foreignManagedAreasForEvent=void 0}return e},e.prototype.mouseEventHandler=function(t,i,r){if(gAppInFront||t instanceof ImpersonatedDomEvent){var n=t.clientX,o=t.clientY,s=Date.now(),a=this.getDomModifier(t);assert(0===domEventEmptyOS.length,"I'm counting on this, you know"),markEventStart("mouse "+i);var d,u=this.extendOverlappingAreas(this.getOverlappingAreas(n,o)),h=u.map(function(e){return e.recipient});d=runTests&&t instanceof ImpersonatedMouseDomEvent?void 0===t.subType?domEventEmptyOS:[{areas:u.map(function(e){return e.recipient}),value:t.subType}]:this.eventAutomaton.step(i,s,n,o,u),logEventHistory&&this.eventHistory.push({type:i,absX:n,absY:o,modifier:a,time:s,subTypes:void 0===d?void 0:d.map(function(e){return e.value})});var l={type:[i],time:[s],modifier:a,absX:[n],absY:[o]};"MouseGestureExpired"===i&&t instanceof ImpersonatedMouseGestureExpiredEvent&&(l.reason=[t.reason]);var c=!0;if(h.length>0){var p=h[0];p instanceof DisplayArea&&void 0!==p.display&&void 0!==p.display.displayElement&&e.findClickable(p.display.displayElement.content,n,o)&&(c=!1)}c&&t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),queueEvent(t,l,d,h,"MouseGestureExpired"!==i?this.pointerObj:void 0,u,void 0,r,void 0,void 0)}},e.prototype.wheelEventHandler=function(e){if(gAppInFront||e instanceof ImpersonatedDomEvent){var t=e.clientX,i=e.clientY,r=Date.now(),n=this.extendOverlappingAreas(this.getOverlappingAreas(t,i)),o=this.getDomModifier(e),s=2===e.deltaMode?"page":1===e.deltaMode?"line":"pixel",a=n.map(function(e){return e.recipient});markEventStart("wheel"),logEventHistory&&this.eventHistory.push({type:e.type,absX:t,absY:i,deltaX:e.deltaX,deltaY:e.deltaY,deltaZ:e.deltaZ,deltaMode:s,modifier:o,time:r});var d={type:["Wheel"],deltaX:[e.deltaX],deltaY:[e.deltaY],deltaZ:[e.deltaZ],deltaMode:[s],time:[r],modifier:o};e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),queueCancelEventsOfType("wheel"),queueEvent(e,d,[],a,void 0,n,void 0,void 0,void 0,void 0)}},e.findClickable=function(t,i,r){if(t instanceof HTMLAnchorElement||t instanceof HTMLDivElement&&("true"===t.contentEditable||""===t.contentEditable)||t instanceof HTMLInputElement){var n=t.getBoundingClientRect();return n.top<=r&&r<=n.bottom&&n.left<=i&&i<=n.right?t:void 0}if(void 0!==t&&void 0!==t.children)for(var o=0;o<t.children.length;o++){var s=e.findClickable(t.children[o],i,r);if(void 0!==s)return s}},e.prototype.getOverlappingAreas=function(e,t){var i=[],r={left:0,top:0};if(this.rootArea instanceof DisplayArea&&this.rootArea.pointInsideDisplay(e,t,r)){var n={recipient:this.rootArea,relX:e,relY:t};this.rGetOverlappingAreas(i,n)}return i.sort(function(e,t){return ZArea.compare(t.recipient.getZAreaRep(),e.recipient.getZAreaRep())})},e.prototype.rGetOverlappingAreas=function(e,t){for(var i=this.getOverlappingEmbeddedArea(t),r=0;r<i.length;r++){var n=i[r];this.rGetOverlappingAreas(e,n)}e.push(t)},e.prototype.getOverlappingEmbeddedArea=function(e){for(var t=e.relX,i=e.relY,r=[],n=areaRelationMonitor.getRelation(e.recipient.getAreaId(),"embedded"),o=0;o<n.length;o++){var s=allAreaMonitor.getAreaById(n[o].getElement());if(void 0!==s){var a={left:0,top:0};s instanceof DisplayArea&&s.pointInsideDisplay(t,i,a)&&r.push({recipient:s,relX:t-a.left,relY:i-a.top})}else console.log(e.recipient.getAreaId(),"missing",n[o].getElement())}return r},e.prototype.setNextFocussedArea=function(e){this.nextAreaWithFocus.push(e),globalSetFocusTask.schedule()},e.prototype.updateFocus=function(){var e=this.nextAreaWithFocus;this.nextAreaWithFocus=[];for(var t=0;t<e.length;t++){var i=e[t];if(void 0!==i&&!i.hasBeenDestroyed()&&i.canReceiveFocus())return void i.takeFocus()}this.eventDiv.focus()},e.prototype.getDomModifier=function(t){var i=[];for(var r in e.modifierTable)t[r]&&i.push(e.modifierTable[r]);return i},e.prototype.setPointerImage=function(e){this.eventDiv.style.setProperty("cursor",e,"")},e.prototype.keyEventHandler=function(t,i,r,n,o){if(gAppInFront||t instanceof ImpersonatedDomEvent){var s=new Date,a=s.getTime();markEventStart("key "+i);var d=this.getDomModifier(t);logEventHistory&&this.eventHistory.push({type:i,key:t.key,char:t.char,which:t.which,charCode:t.charCode,location:t.location,repeat:t.repeat,modifier:d,time:a});var u=["standard","left","right","numpad","mobile","joystick"],h={key:[r],char:[n],type:[i],time:[a],modifier:d,repeat:[t.repeat],location:[u[t.location]]};if("string"==typeof h.key[0]){var l={};for(var c in e.modifierTable){var p=!!t[c];h.key[0].toLowerCase()===e.modifierTable[c]&&(p="KeyUp"!==i),l[c]=p}this.pointerObj.setModifierState(l.shiftKey,l.metaKey,l.altKey,l.ctrlKey||l.metaKey),this.pointerObj.flushUpdate()}debugLogEvent(i)&&console.log("type="+h.type[0]+", key="+h.key[0],"char="+h.char[0]),this.blockDefaultBrowserAction(r,l)&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()),queueEvent(t,h,void 0,void 0===o?["global"]:[o,"global"],void 0,[],void 0,void 0,void 0,void 0)}},e.prototype.blockDefaultBrowserAction=function(e,t){return"Tab"===e||("s"===e||"S"===e)&&(t.ctrlKey||t.metaKey)},e.prototype.resizeScreenArea=function(e,t){logEventHistory&&this.eventHistory.push({type:"resizeScreenArea",width:e,height:t,time:Date.now()})},e.prototype.recordHandlerCalled=function(e){logEventHistory&&logEventComments&&this.eventHistory.push({type:"comment",comment:"handlerCalled",name:e,time:Date.now()})},e.prototype.recordShowRunningDiv=function(e){this.topDivState=e,logEventHistory&&logEventComments&&this.eventHistory.push({type:"comment",comment:"runningDiv",state:e,time:Date.now()})},e.prototype.recordUnhandledEvent=function(e){logEventHistory&&this.eventHistory.push({type:"comment",comment:"unhandledEvent",name:e,time:Date.now()})},e.prototype.recordComment=function(e){logEventHistory&&logEventComments&&this.eventHistory.push({type:"comment",comment:e,time:Date.now()})},e}();MondriaDomEvent.keyTranslate={"U+0008":"Backspace","U+0009":"Tab","U+000A":"Return","U+001B":"Esc",ArrowLeft:"Left",ArrowUp:"Up",ArrowRight:"Right",ArrowDown:"Down",Delete:"Del",Enter:"Return",Left:"Left",Up:"Up",Right:"Right",Down:"Down",Del:"Del",Return:"Return","U+007F":"Del",ZoomToggle:"Zoom",Escape:"Esc",ScrollLock:"Scroll",Backspace:"Backspace",Tab:"Tab",Clear:"Clear",Shift:"Shift",Control:"Control",Alt:"Alt",Pause:"Pause",CapsLock:"CapsLock",Esc:"Esc",PageUp:"PageUp",PageDown:"PageDown",End:"End",Home:"Home",Select:"Select",Execute:"Execute",PrintScreen:"PrintScreen",Insert:"Insert",Help:"Help",Win:"Win",Apps:"Apps",NumLock:"NumLock",Scroll:"Scroll",VolumeMute:"VolumeMute",VolumeDown:"VolumeDown",VolumeUp:"VolumeUp",MediaNextTrack:"MediaNextTrack",MediaPreviousTrack:"MediaPreviousTrack",MediaStop:"MediaStop",MediaPlayPause:"MediaPlayPause",LaunchMail:"LaunchMail",SelectMedia:"SelectMedia",LaunchApplication1:"LaunchApplication1",LaunchApplication2:"LaunchApplication2",Play:"Play",Zoom:"Zoom",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12"},MondriaDomEvent.modifierTable={altKey:"alt",ctrlKey:"control",metaKey:"control",shiftKey:"shift"};var lastEventDescription=void 0,EventAutomatonState={initialState:0,firstMouseDown:1,click:2,secondMouseDown:3,clickExpiredState:4,doubleClickExpiredState:5},nrClicks=0,EventAutomaton=function(){function e(){this.maxClickDelta=700,this.maxClickMouseMovement=3,this.maxInterClickDelta=700,this.lastT=-this.maxClickDelta-1,this.lastX=-this.maxClickMouseMovement-1,this.lastY=-this.maxClickMouseMovement-1,this.lastOverlappingAreaList=void 0,this.goto(EventAutomatonState.initialState)}return e.prototype.reset=function(){this.goto(EventAutomatonState.initialState),this.lastT=-this.maxClickDelta-1,this.lastX=-this.maxClickMouseMovement-1,this.lastY=-this.maxClickMouseMovement-1},e.prototype.goto=function(e){this.state=e},e.prototype.step=function(e,t,i,r,n){var o=t-this.lastT,s=Math.abs(i-this.lastX),a=Math.abs(r-this.lastY),d=[];switch(this.state){case EventAutomatonState.initialState:"MouseDown"===e&&(this.goto(EventAutomatonState.firstMouseDown),this.lastOverlappingAreaList=n);break;case EventAutomatonState.firstMouseDown:"MouseUp"===e&&(o<=this.maxClickDelta||testSingleStep)&&s<=this.maxClickMouseMovement&&a<=this.maxClickMouseMovement?(nrClicks++,d.push({value:"Click",areas:this.getLastOverlappingAreas()}),this.goto(EventAutomatonState.click)):this.goto(EventAutomatonState.initialState);break;case EventAutomatonState.click:"MouseDown"===e&&(o<=this.maxInterClickDelta||testSingleStep)&&s<=this.maxClickMouseMovement&&a<=this.maxClickMouseMovement?this.goto(EventAutomatonState.secondMouseDown):(this.goto(EventAutomatonState.firstMouseDown),this.lastOverlappingAreaList=n);break;case EventAutomatonState.secondMouseDown:"MouseUp"===e&&o<=this.maxClickDelta&&s<=this.maxClickMouseMovement&&a<=this.maxClickMouseMovement&&(nrClicks++,d.push({value:"DoubleClick",areas:this.getLastOverlappingAreas()})),this.goto(EventAutomatonState.initialState);break;case EventAutomatonState.clickExpiredState:d.push({value:"Click",areas:this.getLastOverlappingAreas()}),this.goto(EventAutomatonState.initialState);break;case EventAutomatonState.doubleClickExpiredState:d.push({value:"DoubleClick",areas:this.getLastOverlappingAreas()}),this.goto(EventAutomatonState.initialState);break;default:assert(!1,"Error in eventAutomaton's state")}return this.lastT=t,this.lastX=i,this.lastY=r,d},e.prototype.getLastOverlappingAreas=function(){return this.lastOverlappingAreaList.map(function(e){return e.recipient}).filter(function(e){return void 0!==e&&void 0!==e.areaReference})},e.prototype.canEmitClick=function(){return this.state===EventAutomatonState.firstMouseDown||this.state===EventAutomatonState.click||this.state===EventAutomatonState.secondMouseDown},e.prototype.canEmitDoubleClick=function(){return this.state===EventAutomatonState.secondMouseDown},e.prototype.clickExpired=function(e,t,i){return e-this.lastT>this.maxInterClickDelta&&!testSingleStep||Math.abs(t-this.lastX)>this.maxClickMouseMovement||Math.abs(i-this.lastY)>this.maxClickMouseMovement},e.prototype.moveToExpiration=function(){this.goto(this.state===EventAutomatonState.firstMouseDown?EventAutomatonState.clickExpiredState:EventAutomatonState.doubleClickExpiredState)},e}(),gDomEvent,gZIndex,doCompileTimeChecks=!1,FNRef=function(){function e(){}return e}(),debugAreaInfo={},gCurAreaTemplate=void 0,gCurTemplateId=void 0,gCurGeneric=!1,gCurLocalFunctionNodes=FunctionNode.globalFunctionNodes,gCurLocalDefunFunctionNodes=FunctionNode.globalDefunFunctionNodes,bodyCreateFuns,__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),DebuggerClassNameNPriority=function(){function e(){}return e}(),DebuggerInfoFN=function(e){function t(){var t=this,i=new ValueType;return i.addAnyData(),t=e.call(this,void 0,0,i,void 0)||this}return __extends(t,e),t.getSingleton=function(){return t.singleton},t.prototype.getDataSourceInputs=function(){},t.prototype.allInputs=function(){Utilities.error("do not call")},t.prototype.toCDLString=function(e){Utilities.error("do not call")},t.prototype.toExportString=function(e){Utilities.error("do not call")},t.prototype.getMaximumInputId=function(e,t,i){Utilities.error("do not call")},t.prototype.markWritablePath=function(){Utilities.error("do not call")},t.prototype.checkWritability=function(){Utilities.error("do not call")},t.prototype.setPriority=function(e){Utilities.error("do not call")},t}(FunctionNode);DebuggerInfoFN.singleton=new DebuggerInfoFN;var DebuggerInfoEN=function(e){function t(t){var i=e.call(this,DebuggerInfoFN.getSingleton(),void 0)||this;return i.areaId=t,i}return __extends(t,e),t.prototype.eval=function(){this.inputHasChanged=!1;var e=this.createDebuggerInfo(this.areaId);return"undefined"==typeof e&&(e=constEmptyOS),!valueEqual([e],[this.result.value])&&(this.result=new Result(e),!0)},t.prototype.evalSet=function(){throw"Should not be called"},t.prototype.createDebuggerInfo=function(e){assert(!1,"must be overridden")},t.prototype.activate=function(t,i){0===this.nrActiveWatchers&&gDebuggerInfoMgr.addWatcher(this,"debugCycle",!1,!0,!1),e.prototype.activate.call(this,t,i)},t.prototype.deactivate=function(t,i){e.prototype.deactivate.call(this,t,i),0===this.nrActiveWatchers&&gDebuggerInfoMgr.removeWatcher(this,!0,!1)},t.prototype.updateInput=function(e,t){this.markAsChanged()},t.prototype.getScheduleStep=function(){return 0},t.prototype.getSchedulePriority=function(){return 0},t}(EvaluationNode),DebuggerAreaInfoEN=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createDebuggerInfo=function(e){var i=allAreaMonitor.getAreaById(e);if("undefined"!=typeof i){var r={},n=debugObjAbsAreaPosition(i);for(var o in n)r[o]=[n[o]];for(var s=[],a=i.getEmbeddedAreaList(),d=0;d<a.length;d++){var u=a[d];s.push({name:[u.getChildName()],areaId:[u.areaId]})}var h=i.getEmbedding(),l=void 0;"undefined"!=typeof h&&(l=h.areaId);var c,p=i,f="undefined"!=typeof p.display?p.display.debugGetDescription():void 0;c="undefined"==typeof i.controller?"root":i.isIntersection()?"intersection":i.isAreaSetMember()?"areaSet":"single";var v=i.getChildName(),g=this.getClassList(i),m={areaId:[i.areaId],tAreaId:[i.tAreaId],position:[r],embedded:s,embedding:[l],display:void 0===f?[]:[f],childType:[c],childName:[v],classes:g};if(p.isIntersection()){var y=p.getReferredParent(),I=p.getExpressionParent();m.referredParent=[y.getElement()],m.expressionParent=[I.getElement()]}if(p.isAreaSetMember()||p.isIntersection()){var b=t.getRelation(p,"prev"),C=t.getRelation(p,"next");"undefined"!=typeof b&&(m.prev=[b.getElement()]),"undefined"!=typeof C&&(m.next=[C.getElement()])}if(void 0!==p.param){var S=p.param.attr;S&&S.value&&(m.areaSetAttr=S.value);var R=p.param.data;R&&R.value&&(m.areaSetContent=R.value)}return m}},t.getRelation=function(e,t){var i=areaRelationMonitor.getRelation(e.areaId,t);return i instanceof Array&&(0===i.length?i=void 0:1===i.length?i=i[0]:(Utilities.error("DebuggerAreaInfoEN.getRelation: area '"+e.areaId+"' has multiple("+i.length+") "+t+" areas"),i=void 0)),assert("undefined"==typeof i||i instanceof ElementReference,"DebuggerAreaInfoEN.getRelation: ref is either undefined or an ElementReference"),i},t.prototype.getClassList=function(e){var t=debugObjClasses(e,void 0),i=[],r=e.getTemplate();for(var n in t){var o=r.getClassNamePriority(n);i.push({className:n,priority:o})}i.sort(function(e,t){return e.priority-t.priority});for(var s=[],a=0;a<i.length;a++)s.push(i[a].className);return s},t}(DebuggerInfoEN),DebuggerContextInfoEN=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createDebuggerInfo=function(e){var t=allAreaMonitor.getAreaById(e);if("undefined"!=typeof t){var i={};t.debugAddContext(i,!1);var r=[],n={};for(var o in i.context){var s=i.context[o];"undefined"!=typeof s&&(n[o]=[s],
r.push({name:[o],value:[s]}))}var a={areaId:[e],context:[n],contextOS:r};return"content"in i&&i.content&&(a.content=[i.content]),a}},t}(DebuggerInfoEN),DebuggerInfoMgr=function(){function e(){this.result=new Result([1]),this.watchers={},this.areaInfo={},this.contextInfo={}}return e.prototype.update=function(){var e=this.result.value;e[0]+=1,this.informWatchers()},e.prototype.getInfo=function(e,t){return"areaInfo"===e?(t in this.areaInfo||this.createAreaInfo(t),this.areaInfo[t]):"contextInfo"===e?(t in this.contextInfo||this.createContextInfo(t),this.contextInfo[t]):void 0},e.prototype.releaseInfo=function(e,t){},e.prototype.createAreaInfo=function(e){var t=new DebuggerAreaInfoEN(e);t.isBeingInitialized=!1,this.areaInfo[e]=t},e.prototype.createContextInfo=function(e){var t=new DebuggerContextInfoEN(e);t.isBeingInitialized=!1,this.contextInfo[e]=t},e.prototype.addWatcher=function(e,t,i,r,n){if(e.watcherId in this.watchers)this.watchers[e.watcherId].pos.push(t);else{var o=new Array(1);o[0]=t,this.watchers[e.watcherId]={watcher:e,pos:o}}},e.prototype.removeWatcher=function(e,t,i){e.watcherId in this.watchers&&delete this.watchers[e.watcherId]},e.prototype.removeWatcherForPos=function(e,t,i,r){if(e.watcherId in this.watchers){var n=this.watchers[e.watcherId],o=n.pos.indexOf(t);o>=0&&(1===n.pos.length?delete this.watchers[e.watcherId]:n.pos.splice(o,1))}},e.prototype.markAsChanged=function(){},e.prototype.informWatchers=function(){for(var e in this.watchers)for(var t=this.watchers[e],i=0;i!==t.pos.length;i++)t.watcher.updateInput(t.pos[i],this.result)},e}(),gDebuggerInfoMgr=new DebuggerInfoMgr,IntExpressionType;!function(e){e[e.builtInFunction=0]="builtInFunction",e[e.attributeValue=1]="attributeValue",e[e.query=2]="query",e[e.functionApplication=3]="functionApplication",e[e.jsFunctionApplication=4]="jsFunctionApplication",e[e.range=5]="range",e[e.subStringQuery=6]="subStringQuery",e[e.orderedSet=7]="orderedSet",e[e.negation=8]="negation",e[e.projector=9]="projector",e[e.terminalSymbol=10]="terminalSymbol",e[e.comparisonFunction=11]="comparisonFunction",e[e.string=12]="string",e[e.number=13]="number",e[e.boolean=14]="boolean",e[e.undefined=15]="undefined",e[e.false=16]="false",e[e.null=17]="null",e[e.unknown=18]="unknown"}(IntExpressionType||(IntExpressionType={}));var intFuncMap={plus:EFPlus.singleton,minus:EFMinus.singleton,mul:EFMul.singleton,div:EFDiv.singleton,mod:EFMod.singleton,remainder:EFRemainder.singleton,pow:EFPow.singleton,ln:EFLn.singleton,exp:EFExp.singleton,log10:EFLog10.singleton,logb:EFLogB.singleton,round:EFRound.singleton,ceil:EFCeil.singleton,floor:EFFloor.singleton,abs:EFAbs.singleton,uminus:EFUMinus.singleton,sqrt:EFSqrt.singleton,sign:EFSign.singleton,coordinates:EFCoordinates.singleton,arg:EFArg.singleton,pointer:EFPointer.singleton,not:EFNot.singleton,debugNodeToStr:EFDebugNodeToStr.singleton,equal:EFEqual.singleton,notEqual:EFNotEqual.singleton,bool:EFBool.singleton,sequence:EFSequence.singleton,or:EFOr.singleton,and:EFAnd.singleton,nCompareAreasQuery:EFNCompareAreasQuery.singleton,empty:EFEmpty.singleton,notEmpty:EFNotEmpty.singleton,size:EFSize.singleton,greaterThan:EFGreaterThan.singleton,greaterThanOrEqual:EFGreaterThanOrEqual.singleton,lessThan:EFLessThan.singleton,lessThanOrEqual:EFLessThanOrEqual.singleton,concatStr:EFConcatStr.singleton,numberToString:EFNumberToString.singleton,range:EFRange.singleton,max:EFMax.singleton,min:EFMin.singleton,sum:EFSum.singleton,testStore:EFTestStore.singleton,reverse:EFReverse.singleton,dynamicAttribute:EFDynamicAttribute.singleton,dateToNum:EFDateToNum.singleton,numToDate:EFNumToDate.singleton,testFormula:EFTestFormula.singleton,subStr:EFSubString.singleton,stringToNumber:EFStringToNumber.singleton},gDebugObjClassesInactive=0,replayStartTime=void 0,replayEventTime=void 0,replayHistory=void 0,replayTimeoutId=void 0,replayProgress=void 0,replayPosition=void 0;FakeDomEvent.prototype.preventDefault=fakeDomEventPreventDefault,FakeDomEvent.prototype.stopPropagation=fakeDomEventStopPropagation,FakeDomEvent.prototype.stopImmediatePropagation=fakeDomEventStopImmediatePropagation;var splashScreenRefreshRateCheck=750,splashScreenRefreshRateAnimation=750;SplashScreenController.prototype.refresh=splashScreenControllerRefresh,SplashScreenController.prototype.hide=splashScreenControllerHide,SplashScreenController.prototype.feedback=splashScreenControllerFeedback;var gSplashScreenController=new SplashScreenController;globalSystemEvents.addHandler("connection error",function(){gSplashScreenController.feedback("Connection error")}),globalSystemEvents.addHandler("connection error cleared",function(){gSplashScreenController.feedback(void 0)});var gProgressDiv=void 0,gProgressIndicator=void 0,gRunningDiv=void 0,gSpinnerElt=void 0,gTimeQueueStarted=void 0,gOpacitySet=!1,gEventDiv=void 0,gEventDivStyleCursor=void 0,gRunIndicatorHidden1=!0,gRunIndicatorHidden2=!0,suppressRunningUntil=void 0,lastProgressIndicator=0;
